{"version":3,"sources":["threejs/RoundedBoxGeometry.js","editorObjects/Editor.tsx","EventEmitter.tsx","threejs/renderThreejs.ts","editorObjects/Point.ts","editorObjects/Bead.ts","components/colors.ts","editorObjects/Line.ts","immerReducers/BeadSnapperImmerReducer.tsx","immerReducers/DraggableOperationsImmerReducer.tsx","immerReducers/PersistImmerReducer.tsx","immerReducers/ChangeEditorModeImmerReducer.tsx","immerReducers/MainImmerReducer.tsx","immerReducers/MouseSelectionImmerReducer.tsx","immerReducers/ToolbarImmerReducer.tsx","immerReducers/TopbarImmerReducer.tsx","immerReducers/PaintImmerReducer.tsx","immerReducers/store.tsx","components/Toolbar/EditorModes.tsx","components/Bead/DisplayBead.tsx","components/operations/MapValuesToCss.tsx","components/Toolbar/ui/FieldBeadPreview.tsx","components/Toolbar/ui/ToolbarField.tsx","components/Toolbar/ui/ToolbarFieldSet.tsx","components/Toolbar/ui/FieldColorPicker.tsx","components/Toolbar/ui/FieldColor.tsx","components/Toolbar/ui/FieldsetColor.tsx","components/Toolbar/ui/FieldBeadTypePicker.tsx","components/Toolbar/ui/FieldsetBeadType.tsx","components/Toolbar/ui/FieldSliderWithLabel.tsx","components/Toolbar/ui/FieldCheckbox.tsx","components/Toolbar/ui/FieldsetWidthAndHeight.tsx","components/Toolbar/ui/FieldSlider.tsx","components/Toolbar/ui/FieldsetBeadRotate.tsx","components/Toolbar/Modes/ToolbarEditBeads.tsx","components/Toolbar/Modes/ToolbarIdle.tsx","components/Topbar/TopbarMain.tsx","components/Toolbar/EditorChangeState.tsx","components/Topbar/TopbarSecoundary.tsx","components/Toolbar/ui/FieldsetSize.tsx","components/Toolbar/Modes/ToolbarPaint.tsx","components/Toolbar/Modes/ToolbarAddBeads.tsx","components/Editor.tsx","immerReducers/appStore.tsx","App.tsx","index.tsx"],"names":["module","exports","THREE","RoundedBoxGeometry","width","height","depth","radius","radiusSegments","BufferGeometry","call","this","type","isNaN","Math","max","floor","edgeHalfWidth","min","edgeHalfHeight","edgeHalfDepth","parameters","rs1","totalVertexCount","positions","BufferAttribute","Float32Array","normals","cornerVerts","cornerNormals","vertex","Vector3","vertexPool","normalPool","indices","lastVertex","cornerVertNumber","cornerLayout","j","push","PIhalf","PI","cornerOffset","y","va","cosVa","cos","sinVa","sin","x","ha","z","vert","clone","multiplyScalar","add","norm","normalize","set","i","length","multiply","doVertices","a","b","c","d","doFaces","flips","lastRowOffset","v","r1","r2","u","u1","doCorners","cOffset","cRowOffset","needsFlip","doHeightEdges","end","cStarts","cEnds","cStart","cEnd","doWidthEdges","urs1","u1rs1","doDepthEdges","index","setXYZ","setIndex","Uint16Array","addAttribute","prototype","Object","create","constructor","BeadTypes","EditorMode","EditorMenuMain","EditorGridType","BrushType","internalEventEmiter","el","buildPoint","immerable","point","sqrt","getLength","useLen","scale","scalar","getDistanceBetweenPoints","start","contain","p1","p2","p","buildBead","props","defaults","id","generate","position","BasicEllipse","rotate","lineRotate","color","keepAspectRatio","merge","buildLine","__defaults","beadIds","settings","beadsCount","beadsAutoCount","beadsSpacing","beadsAutoSpacing","defaultBead","getPointFromStartLine","startX","startY","endX","endY","distance","BeadSnapperImmerReducer","lineId","currentLine","draftState","appData","lines","count","getLineBeadsCount","currentCount","remaining","addRemainingBeads","overflow","removeOverflowBeads","modifyBeadsPosition","modifyBeadsRotate","lineLen","beadsWidths","beadsWidth","forEach","beadId","beads","defaultBeadWidth","remainingSpace","remainingCount","ui","lineSettings","undefined","bead","overflowCount","arrLen","lastItemBeadId","splice","currentDistance","newPosition","standardLineHeight","avaiableSpace","dynamicBeadsSpacing","lineRotateRadian","atan2","ImmerReducer","EventEmitter","_events","name","listener","listenerToRemove","Error","filter","data","state","console","log","callback","warn","getEventEmitter","DraggableOperationsImmerReducer","event","sceneWrapperPosition","sceneWrapperWidth","sceneWrapperHeight","saveInfo","saved","haveUnsavedChanges","line","mode","EditLines","updateBeadsPositions","editorAppDataHasChanged","key","grid","snapEnabled","hexSize","Box","round","Hex","hSpace","hexHeight","vSpace","changeX","vLine","changeY","lineStart","lineEnd","deltaX","deltaY","newX","newY","keys","selectedLinesIds","selectedLinesIdsCount","action_onClickLine","selectedBeadsIds","selectedBeadsIdsCount","currentBeadChain","isDragEnabled","beadsTemplate","len","lastBeadId","lastBead","lastPosition","vec","sub","scaled","_x","_y","emit","PersistImmerReducer","b1","window","localStorage","setItem","JSON","stringify","info","ChangeEditorModeImmerReducer","clearSelectedBeads","clearSelectedLines","newEditorMode","newValue","MainImmerReducer","MouseSelectionImmerReducer","mouseSelection","isDragStarted","isDragged","abs","p3","beadsIds","prevSelectedIds","diffStates","_","xor","map","includes","ToolbarImmerReducer","deg","value","firstLineId","firstLine","newLinesIds","newLine","newBead","ratio","currLine","updateLineFromSelectedBeads","currBead","results","indexOf","brush","size","TopbarImmerReducer","currentMenuMainOpen","File","None","Grid","Background","isVisible","background","image","url","opacity","PaintImmerReducer","Color","mousePoint","centerPoint","defaultAppData","angle","top","left","Idle","Actions","Main","createActionCreators","Draggable","Persist","ChangeEditorMode","MouseSelection","Toolbar","Topbar","Paint","eventEmitter","reducerForEventEmitter","produce","action","payload","store","composeReducers","createReducerFunction","EditorModes","editorMode","dispatch","useDispatch","onChangeEditorMode","action_onChangeEditorMode","className","label","icon","faArrowsAlt","onClick","isSelected","faEdit","EditBeads","faPaintBrush","AddBeads","PaintBeads","DeleteBeads","StateButton","DisplayBead","zIndex","isSelectable","isOpacity","isZindex","translate3d","getTranslate3dCss","rotateCss","styles","transform","border","borderRadius","action_onClickBead","style","FieldBeadPreview","displayBead","marginTop","marginBottom","display","justifyContent","alignItems","boxSizing","ToolbarField","onToggle","cursor","marginRight","flexDirection","paddingLeft","paddingRight","ToolbarFieldSet","selected","children","useState","isPickerOpen","setIsPickerOpen","borderTop","React","cloneElement","FieldColorPicker","onChange","colors","material","paddingTop","paddingBottom","DisplayColorsGroup","flexWrap","group","toString","FieldColor","boxShadow","FieldsetColor","faPalette","BeadTypesIcons","BasicRectangle","FieldBeadTypePicker","types","selectedType","DisplayAvailableBeadTypes","DisplayBeadType","faCircle","faExpand","FieldsetBeadType","faShapes","SliderWithTooltip","createSliderWithTooltip","Slider","FieldSliderWithLabel","borderBottom","padding","flexGrow","step","defaultValue","marks","0","50","100","FieldCheckbox","isDisabled","disabled","checked","target","FieldsetWidthAndHeight","onChange_beadHeight","onChange_beadWidth","onChange_keepAspectRatio","format","toLocaleString","maximumFractionDigits","faExpandArrowsAlt","faLink","faUnlink","faArrowsAltH","faArrowsAltV","FieldSlider","FieldsetBeadRotate","faSyncAlt","Fragment","suffix","allowNegative","allowEmptyFormatting","onValueChange","floatValue","placeholder","textAlign","fontFamily","fontSize","fontWeight","lineHeight","ToolbarEditBeads","ContentWrapper","useSelector","Content","BeadsRotate","action_changeSelectedBeads_rotate","BeadSize","action_changeSelectedBeads_height","action_changeSelectedBeads_width","action_changeSelectedBeads_keepAspectRatio","BeadType","action_changeSelectedBeads_type","BeadColor","action_changeSelectedBeads_color","BeadPreview","ToolbarIdle","linesLen","beadsLen","TopbarMain","margin","action_toggleMenuFile","faFileAlt","action_toggleMenuSettings","faCog","action_toggleMenuBackground","faImage","EditorChangeState","isSaved","action_onClearCanvas","faTimes","action_onSaveCanvas","faSave","action_readSavedCanvas","faDownload","alignSelf","TopbarSecoundary","SubMenuFile","SubMenuBackground","action_background_image_clear","selectedFiles","files","Array","from","file","every","error","reader","FileReader","onloadend","action_background_image_upload","result","readAsDataURL","preventDefault","marginLeft","whiteSpace","action_background_image_scale","onChange_scale","pointX","onChange_pointX","action_background_image_pointX","pointY","onChange_pointY","action_background_image_pointY","action_background_image_opacity","onChange_opacity","BackgroundPosition","maxLength","maxWidth","SubMenuGrid","onChange_isVisible","action_toggleGridIsVisible","onChange_snapEnabled","action_toggleGridSnapEnabled","onClick_selectTypeHex","action_setGridType","onClick_selectTypeBox","gridItemW","onChange_gridItemW","action_setGridWidth","gridItemH","onChange_gridItemH","action_setGridHeight","onChange_hexSize","action_setGridHexSize","GridOptions","GridBoxSettings","GridHexSettings","FieldsetSize","ToolbarPaint","BrushSize","action_updateBrushSize","BrushColor","action_updateBrushColor","ToolbarAddBeads","action_updateBeadsTemplate","EditorScene","useStore","getState","useRef","handleWidth","handleHeight","skipOnMount","onResize","action_updateSceneWrapperSize","appStore","createStore","App","useEffect","initCanvasApp","require","camera","scene","renderer","mouse_intercestion","multiplyMatrices","makeRotationY","makeRotationZ","mouseSelectionBeads","mouseSelectionHelper","MouseSelectionHelper","getBoundingClientRect","lookAt","l1","l2","bg_geometry","bg_material","side","bg_plane","antialias","setPixelRatio","devicePixelRatio","setSize","appendChild","domElement","addEventListener","onWindowResize","onMouseDown","onMouseMove","onMouseUp","onWheel","setRenderer","init","animate","requestAnimationFrame","render","on","child","getObjectByName","values","emissive","geometry","SphereGeometry","mergeVertices","computeVertexNormals","flatShading","reflectivity","beadMesh","applyMatrix","makeRotationX","DEG2RAD","makeTranslation","basicMesh","sceneScale","screenX","clientX","screenY","clientY","cameraX","cameraY","mouseXInWorldBefore","mouseYInWorldBefore","sign","mouseXInWorldAfter","mouseYInWorldAfter","right","bottom","updateProjectionMatrix","diffX","diffY","boundingClientRect","screenToWorld","isCameraGrabed","startDragMousePosition","startDragCamera","onDown","action_addBeadOnClick","leftTop","rightBottom","action_selectBeads","onUp","screenMouseDiffX","screenMouseDiffY","mouseDiffXInWorldSpace","mouseDiffYInWorldSpace","subscribe","onMove","p1_x","p1_y","p2_x","p2_y","element","startPoint","pointTopLeft","pointBottomRight","isDown","document","createElement","pointerEvents","Vector2","parentElement","removeChild","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.8f544196.chunk.js","sourcesContent":["/**\n * @author pailhead / http://dusanbosnjak.com\n */\nmodule.exports = function(THREE) {\n  var RoundedBoxGeometry = function(width, height, depth, radius, radiusSegments) {\n    THREE.BufferGeometry.call(this);\n\n    this.type = \"RoundedBoxGeometry\";\n\n    //validate params ===================================\n\n    radiusSegments = !isNaN(radiusSegments)\n      ? Math.max(1, Math.floor(radiusSegments))\n      : 1;\n\n    width = !isNaN(width) ? width : 1;\n    height = !isNaN(height) ? height : 1;\n    depth = !isNaN(depth) ? depth : 1;\n\n    radius = !isNaN(radius) ? radius : 0.15;\n\n    radius = Math.min(\n      radius,\n      Math.min(width, Math.min(height, Math.min(depth))) / 2\n    );\n\n    var edgeHalfWidth = width / 2 - radius;\n    var edgeHalfHeight = height / 2 - radius;\n    var edgeHalfDepth = depth / 2 - radius;\n\n    //not sure why this is needed, for querying? ========\n\n    this.parameters = {\n      width: width,\n      height: height,\n      depth: depth,\n      radius: radius,\n      radiusSegments: radiusSegments\n    };\n\n    //calculate vertices count ==========================\n\n    var rs1 = radiusSegments + 1; //radius segments + 1\n\n    var totalVertexCount = (rs1 * radiusSegments + 1) << 3;\n\n    //make buffers ======================================\n\n    var positions = new THREE.BufferAttribute(\n      new Float32Array(totalVertexCount * 3),\n      3\n    );\n\n    var normals = new THREE.BufferAttribute(\n      new Float32Array(totalVertexCount * 3),\n      3\n    );\n\n    //some vars =========================================\n\n    var cornerVerts = [],\n      cornerNormals = [],\n      normal = new THREE.Vector3(),\n      vertex = new THREE.Vector3(),\n      vertexPool = [],\n      normalPool = [],\n      indices = [];\n    var lastVertex = rs1 * radiusSegments,\n      cornerVertNumber = rs1 * radiusSegments + 1;\n    doVertices();\n    doFaces();\n    doCorners();\n    doHeightEdges();\n    doWidthEdges();\n    doDepthEdges();\n\n    // calculate vert positions =========================\n\n    function doVertices() {\n      //corner offsets\n      var cornerLayout = [\n        new THREE.Vector3(1, 1, 1),\n        new THREE.Vector3(1, 1, -1),\n        new THREE.Vector3(-1, 1, -1),\n        new THREE.Vector3(-1, 1, 1),\n        new THREE.Vector3(1, -1, 1),\n        new THREE.Vector3(1, -1, -1),\n        new THREE.Vector3(-1, -1, -1),\n        new THREE.Vector3(-1, -1, 1)\n      ];\n\n      //corner holder\n      for (var j = 0; j < 8; j++) {\n        cornerVerts.push([]);\n        cornerNormals.push([]);\n      }\n\n      //construct 1/8 sphere ==============================\n\n      var PIhalf = Math.PI / 2;\n\n      var cornerOffset = new THREE.Vector3(\n        edgeHalfWidth,\n        edgeHalfHeight,\n        edgeHalfDepth\n      );\n\n      for (var y = 0; y <= radiusSegments; y++) {\n        var v = y / radiusSegments;\n\n        var va = v * PIhalf; //arrange in 90 deg\n\n        var cosVa = Math.cos(va); //scale of vertical angle\n\n        var sinVa = Math.sin(va);\n\n        if (y == radiusSegments) {\n          vertex.set(0, 1, 0);\n\n          var vert = vertex\n            .clone()\n            .multiplyScalar(radius)\n            .add(cornerOffset);\n\n          cornerVerts[0].push(vert);\n\n          vertexPool.push(vert);\n\n          var norm = vertex.clone();\n\n          cornerNormals[0].push(norm);\n\n          normalPool.push(norm);\n\n          continue; //skip row loop\n        }\n\n        for (var x = 0; x <= radiusSegments; x++) {\n          var u = x / radiusSegments;\n\n          var ha = u * PIhalf;\n\n          //make 1/8 sphere points\n          vertex.x = cosVa * Math.cos(ha);\n          vertex.y = sinVa;\n          vertex.z = cosVa * Math.sin(ha);\n\n          //copy sphere point, scale by radius, offset by half whd\n          var vert = vertex\n            .clone()\n            .multiplyScalar(radius)\n            .add(cornerOffset);\n\n          cornerVerts[0].push(vert);\n\n          vertexPool.push(vert);\n\n          //sphere already normalized, just clone\n\n          var norm = vertex.clone().normalize();\n          cornerNormals[0].push(norm);\n          normalPool.push(norm);\n        }\n      }\n\n      //distribute corner verts ===========================\n\n      for (var i = 1; i < 8; i++) {\n        for (var j = 0; j < cornerVerts[0].length; j++) {\n          var vert = cornerVerts[0][j].clone().multiply(cornerLayout[i]);\n\n          cornerVerts[i].push(vert);\n\n          vertexPool.push(vert);\n\n          var norm = cornerNormals[0][j].clone().multiply(cornerLayout[i]);\n\n          cornerNormals[i].push(norm);\n\n          normalPool.push(norm);\n        }\n      }\n    }\n\n    // weave corners ====================================\n\n    function doCorners() {\n      var indexInd = 0;\n\n      var flips = [true, false, true, false, false, true, false, true];\n\n      var lastRowOffset = rs1 * (radiusSegments - 1);\n\n      for (var i = 0; i < 8; i++) {\n        var cornerOffset = cornerVertNumber * i;\n\n        for (var v = 0; v < radiusSegments - 1; v++) {\n          var r1 = v * rs1; //row offset\n          var r2 = (v + 1) * rs1; //next row\n\n          for (var u = 0; u < radiusSegments; u++) {\n            var u1 = u + 1;\n            var a = cornerOffset + r1 + u;\n            var b = cornerOffset + r1 + u1;\n            var c = cornerOffset + r2 + u;\n            var d = cornerOffset + r2 + u1;\n\n            if (!flips[i]) {\n              indices.push(a);\n              indices.push(b);\n              indices.push(c);\n\n              indices.push(b);\n              indices.push(d);\n              indices.push(c);\n            } else {\n              indices.push(a);\n              indices.push(c);\n              indices.push(b);\n\n              indices.push(b);\n              indices.push(c);\n              indices.push(d);\n            }\n          }\n        }\n\n        for (var u = 0; u < radiusSegments; u++) {\n          var a = cornerOffset + lastRowOffset + u;\n          var b = cornerOffset + lastRowOffset + u + 1;\n          var c = cornerOffset + lastVertex;\n\n          if (!flips[i]) {\n            indices.push(a);\n            indices.push(b);\n            indices.push(c);\n          } else {\n            indices.push(a);\n            indices.push(c);\n            indices.push(b);\n          }\n        }\n      }\n    }\n\n    //plates ============================================\n    //fix this loop matrices find pattern something\n\n    function doFaces() {\n      //top\n      var a = lastVertex; // + cornerVertNumber * 0;\n      var b = lastVertex + cornerVertNumber; // * 1;\n      var c = lastVertex + cornerVertNumber * 2;\n      var d = lastVertex + cornerVertNumber * 3;\n\n      indices.push(a);\n      indices.push(b);\n      indices.push(c);\n      indices.push(a);\n      indices.push(c);\n      indices.push(d);\n\n      //bottom\n      a = lastVertex + cornerVertNumber * 4; // + cornerVertNumber * 0;\n      b = lastVertex + cornerVertNumber * 5; // * 1;\n      c = lastVertex + cornerVertNumber * 6;\n      d = lastVertex + cornerVertNumber * 7;\n\n      indices.push(a);\n      indices.push(c);\n      indices.push(b);\n      indices.push(a);\n      indices.push(d);\n      indices.push(c);\n\n      //left\n      a = 0;\n      b = cornerVertNumber;\n      c = cornerVertNumber * 4;\n      d = cornerVertNumber * 5;\n\n      indices.push(a);\n      indices.push(c);\n      indices.push(b);\n      indices.push(b);\n      indices.push(c);\n      indices.push(d);\n\n      //right\n      a = cornerVertNumber * 2;\n      b = cornerVertNumber * 3;\n      c = cornerVertNumber * 6;\n      d = cornerVertNumber * 7;\n\n      indices.push(a);\n      indices.push(c);\n      indices.push(b);\n      indices.push(b);\n      indices.push(c);\n      indices.push(d);\n\n      //front\n      a = radiusSegments;\n      b = radiusSegments + cornerVertNumber * 3;\n      c = radiusSegments + cornerVertNumber * 4;\n      d = radiusSegments + cornerVertNumber * 7;\n\n      indices.push(a);\n      indices.push(b);\n      indices.push(c);\n      indices.push(b);\n      indices.push(d);\n      indices.push(c);\n\n      //back\n      a = radiusSegments + cornerVertNumber;\n      b = radiusSegments + cornerVertNumber * 2;\n      c = radiusSegments + cornerVertNumber * 5;\n      d = radiusSegments + cornerVertNumber * 6;\n\n      indices.push(a);\n      indices.push(c);\n      indices.push(b);\n      indices.push(b);\n      indices.push(c);\n      indices.push(d);\n    }\n\n    // weave edges ======================================\n\n    function doHeightEdges() {\n      for (var i = 0; i < 4; i++) {\n        var cOffset = i * cornerVertNumber;\n        var cRowOffset = 4 * cornerVertNumber + cOffset;\n        var needsFlip = i & (1 === 1);\n        for (var u = 0; u < radiusSegments; u++) {\n          var u1 = u + 1;\n          var a = cOffset + u;\n          var b = cOffset + u1;\n          var c = cRowOffset + u;\n          var d = cRowOffset + u1;\n\n          if (!needsFlip) {\n            indices.push(a);\n            indices.push(b);\n            indices.push(c);\n            indices.push(b);\n            indices.push(d);\n            indices.push(c);\n          } else {\n            indices.push(a);\n            indices.push(c);\n            indices.push(b);\n            indices.push(b);\n            indices.push(c);\n            indices.push(d);\n          }\n        }\n      }\n    }\n\n    function doDepthEdges() {\n      var cStarts = [0, 2, 4, 6];\n      var cEnds = [1, 3, 5, 7];\n\n      for (var i = 0; i < 4; i++) {\n        var cStart = cornerVertNumber * cStarts[i];\n        var cEnd = cornerVertNumber * cEnds[i];\n\n        var needsFlip = 1 >= i;\n\n        for (var u = 0; u < radiusSegments; u++) {\n          var urs1 = u * rs1;\n          var u1rs1 = (u + 1) * rs1;\n\n          var a = cStart + urs1;\n          var b = cStart + u1rs1;\n          var c = cEnd + urs1;\n          var d = cEnd + u1rs1;\n\n          if (needsFlip) {\n            indices.push(a);\n            indices.push(c);\n            indices.push(b);\n            indices.push(b);\n            indices.push(c);\n            indices.push(d);\n          } else {\n            indices.push(a);\n            indices.push(b);\n            indices.push(c);\n            indices.push(b);\n            indices.push(d);\n            indices.push(c);\n          }\n        }\n      }\n    }\n\n    function doWidthEdges() {\n      var end = radiusSegments - 1;\n\n      var cStarts = [0, 1, 4, 5];\n      var cEnds = [3, 2, 7, 6];\n      var needsFlip = [0, 1, 1, 0];\n\n      for (var i = 0; i < 4; i++) {\n        var cStart = cStarts[i] * cornerVertNumber;\n        var cEnd = cEnds[i] * cornerVertNumber;\n\n        for (var u = 0; u <= end; u++) {\n          // var dInd = u != end ? radiusSegments + u * rs1 : cornerVertNumber - 1;\n\n          var a = cStart + radiusSegments + u * rs1;\n          var b =\n            cStart +\n            (u != end ? radiusSegments + (u + 1) * rs1 : cornerVertNumber - 1);\n\n          var c = cEnd + radiusSegments + u * rs1;\n          var d =\n            cEnd +\n            (u != end ? radiusSegments + (u + 1) * rs1 : cornerVertNumber - 1);\n\n          if (!needsFlip[i]) {\n            indices.push(a);\n            indices.push(b);\n            indices.push(c);\n            indices.push(b);\n            indices.push(d);\n            indices.push(c);\n          } else {\n            indices.push(a);\n            indices.push(c);\n            indices.push(b);\n            indices.push(b);\n            indices.push(c);\n            indices.push(d);\n          }\n        }\n      }\n    }\n\n    //fill buffers ======================================\n\n    var index = 0;\n\n    for (var i = 0; i < vertexPool.length; i++) {\n      positions.setXYZ(\n        index,\n        vertexPool[i].x,\n        vertexPool[i].y,\n        vertexPool[i].z\n      );\n\n      normals.setXYZ(index, normalPool[i].x, normalPool[i].y, normalPool[i].z);\n\n      index++;\n    }\n\n    this.setIndex(new THREE.BufferAttribute(new Uint16Array(indices), 1));\n\n    this.addAttribute(\"position\", positions);\n\n    this.addAttribute(\"normal\", normals);\n  };\n\n  RoundedBoxGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\n  RoundedBoxGeometry.constructor = RoundedBoxGeometry;\n\n  return RoundedBoxGeometry;\n};\n","import { immerable } from \"immer\";\nimport { DeepPartial } from \"ts-essentials\";\n\nexport interface Point {\n  x: number;\n  y: number;\n  [immerable]: boolean;\n}\n\nexport enum BeadTypes {\n  BasicRectangle = \"BasicRectangle\",\n  BasicEllipse = \"BasicEllipse\"\n}\n\nexport interface Bead {\n  id: string;\n  position: Point;\n  [immerable]: boolean;\n  width: number;\n  height: number;\n  type: BeadTypes;\n  color: string;\n  rotate: number;\n  lineRotate: number;\n  keepAspectRatio: boolean;\n}\n\nexport interface Line {\n  id: string;\n  start: Point;\n  end: Point;\n  beadIds: string[];\n  [immerable]: boolean;\n  settings: {\n    beadsCount: number;\n    beadsAutoCount: boolean;\n    beadsSpacing: number;\n    beadsAutoSpacing: boolean;\n    defaultBead: Partial<Bead>;\n  };\n}\n\nexport interface AppData {\n  beads: { [s: string]: Bead };\n  lines: { [s: string]: Line };\n}\n\nexport enum EditorMode {\n  Idle = \"Idle\",\n  EditLines = \"EditLines\",\n  AddLine = \"AddLine\",\n  EditBeads = \"EditBeads\",\n  AddBeads = \"AddBeads\",\n  DeleteBeads = \"DeleteBeads\",\n  PaintBeads = \"ColorPaint\"\n}\nexport enum EditorMenuMain {\n  None = \"None\",\n  File = \"File\",\n  Grid = \"Grid\",\n  Background = \"Background\"\n}\nexport enum EditorGridType {\n  Hex = \"Hex\",\n  Box = \"Box\"\n}\nexport enum BrushType {\n  Color = \"Color\"\n}\n\nexport interface EditorUi {\n  lineSettings: DeepPartial<Line>;\n  saveInfo: {\n    saved: boolean;\n    haveUnsavedChanges: boolean;\n  };\n  selectedLinesIds: { [s: string]: boolean };\n  selectedLinesIdsCount: number;\n  selectedBeadsIds: { [s: string]: boolean };\n  selectedBeadsIdsCount: number;\n  mouseSelection: {\n    start: Point;\n    end: Point;\n    isDragStarted: boolean;\n    isDragged: boolean;\n  };\n  currentMenuMainOpen: EditorMenuMain;\n  grid: {\n    type: EditorGridType;\n    hexSize: number;\n    snapEnabled: boolean;\n    isVisible: boolean;\n    width: number;\n    height: number;\n  };\n  currentBeadChain: {\n    isDragEnabled: boolean;\n    beadIds: string[];\n  };\n  beadsTemplate: {\n    width: number;\n    height: number;\n    type: BeadTypes;\n    color: string;\n    rotate: number;\n    keepAspectRatio: boolean;\n  };\n  brush: {\n    type: BrushType;\n    size: number;\n    color: string;\n  };\n  background: {\n    image: {\n      url: string;\n      scale: number;\n      position: Point;\n      opacity: number;\n    };\n  };\n  sceneWrapperWidth: number;\n  sceneWrapperHeight: number;\n  sceneWrapperPosition: {\n    x: number;\n    y: number;\n    angle: number;\n    scale: number;\n    top: number;\n    left: number;\n  };\n}\n\nexport interface Editor {\n  appData: AppData;\n  ui: EditorUi;\n  mode: EditorMode;\n}\n","export type EventCallback = (data: any, state: any) => void;\nexport interface Events {\n  [key: string]: EventCallback[];\n}\nexport class EventEmitter {\n  _events: Events;\n  constructor() {\n    this._events = {};\n  }\n\n  on(name: string, listener: EventCallback) {\n    if (!this._events[name]) {\n      this._events[name] = [];\n    }\n\n    this._events[name].push(listener);\n  }\n\n  removeListener(name: string, listenerToRemove: EventCallback) {\n    if (!this._events[name]) {\n      throw new Error(\n        `Can't remove a listener. Event \"${name}\" doesn't exits.`\n      );\n    }\n\n    const filterListeners = (listener) => listener !== listenerToRemove;\n\n    this._events[name] = this._events[name].filter(filterListeners);\n  }\n\n  emit(name: string, data: any, state: any) {\n    console.log(\"EventEmitter:emit:\", name, data);\n\n    if (!this._events[name]) {\n      console.warn(`Can't emit an event. Event \"${name}\" doesn't exits.`);\n      return;\n    }\n\n    const fireCallbacks = (callback: EventCallback) => {\n      callback(data, state);\n    };\n\n    this._events[name].forEach(fireCallbacks);\n  }\n}\n\nlet internalEventEmiter: EventEmitter | undefined;\n\nexport const getEventEmitter = () => {\n  if (internalEventEmiter === undefined) {\n    internalEventEmiter = new EventEmitter();\n  }\n  return internalEventEmiter;\n};\n","import { appStore } from \"./../immerReducers/appStore\";\nimport { Actions } from \"../immerReducers/store\";\nimport { generate } from \"shortid\";\n\n// import { EditorMode } from \"../editorObjects/Editor\";\n// import { setInterval } from \"timers\";\n// import RoundedBoxGeometry from './RoundedBoxGeometry'\n\nimport * as THREE from \"three\";\nimport { Bead, BeadTypes, EditorMode } from \"../editorObjects/Editor\";\nimport { buildPoint, contain } from \"../editorObjects/Point\";\nimport { Vector2, BoxGeometry, SphereGeometry } from \"three\";\nimport { getEventEmitter } from \"../EventEmitter\";\nimport _ from \"lodash\";\n// import RoundedBoxGeometryInstance from \"./RoundedBoxGeometry\";\n\n// import {} from 'three/build/'\n// import * as THREE from \"../build/three.module.js\";\n\n// import Stats from \"./stats.module.js\";\n// import { GUI } from \"./dat.gui.module.js\";\n// import { OrbitControls } from \"./OrbitControls.js\";\nvar RoundedBoxGeometry = require(\"./RoundedBoxGeometry\")(THREE);\n\nexport const renderThreejs = (el: HTMLElement | null) => {\n  // console.log(\"renderThreejs?\", el, appStore);\n\n  initCanvasApp(el);\n};\n\nconst initCanvasApp = (el: HTMLElement | null) => {\n  var camera: THREE.OrthographicCamera,\n    scene: THREE.Scene,\n    renderer: THREE.WebGLRenderer;\n\n  // var mesh: THREE.InstancedMesh;\n  // var amount = 10;\n  // var count = Math.pow(amount, 3);\n\n  // var raycaster = new THREE.Raycaster();\n  var mouse_intercestion = new THREE.Vector2(1, 1);\n  // var mouse_2d = new THREE.Vector2(1, 1);\n\n  var rotationMatrix = new THREE.Matrix4().multiplyMatrices(\n    new THREE.Matrix4().makeRotationY(0.05),\n    new THREE.Matrix4().makeRotationZ(0.03)\n  );\n  // var rotationMatrix = new THREE.Matrix4().makeRotationZ(0.1);\n  // var instanceMatrix = new THREE.Matrix4();\n  // var matrix = new THREE.Matrix4();\n  const z_index = 100;\n  const intensivity = 1;\n  const distance = 900;\n  const color = 0xffffff;\n  const reflectivity = 1;\n\n  // const mouseSelection = {\n  //   isDragStarted: false,\n  //   isDragged: false,\n  //   start: { x: 0, y: 0 },\n  //   end: { x: 0, y: 0 }\n  // };\n\n  const eventEmitter = getEventEmitter();\n\n  const mouseSelectionBeads = new MouseSelection();\n  const mouseSelectionHelper = new MouseSelectionHelper();\n\n  init();\n  animate();\n\n  // eventEmitter.on(\n  //   \"IMMER_REDUCER:DraggableOperationsImmerReducer#action_updateSceneWrapperSize\",\n  //   (data: any) => {\n  //     console.log(\"odebranooo...\", data);\n  //   }\n  // );\n\n  // eventEmitter.on(\n  //   \"IMMER_REDUCER:DraggableOperationsImmerReducer#action_addBeadOnClick\",\n  //   (data: { x: number; y: number }) => {\n  //     console.log(\"dodaje nowy item...\", data);\n\n  //     // scene\n  //   }\n  // );\n\n  // eventEmitter.on(\n  //   \"IMMER_REDUCER:ChangeEditorModeImmerReducer#action_onChangeEditorMode\",\n  //   (data: EditorMode) => {\n  //     console.log(\"ustawiam mode na\", data);\n  //   }\n  // );\n\n  eventEmitter.on(\"action_changeSelectedBeads_color\", (data) => {\n    data.beadIds.forEach((id) => {\n      const child = scene.getObjectByName(id) as THREE.Mesh | undefined;\n      if (child === undefined) {\n        return;\n      }\n\n      (child.material as THREE.MeshPhysicalMaterial).color.set(data.color);\n    });\n  });\n\n  eventEmitter.on(\"action_selectBeads\", (data) => {\n    data.diffStates.forEach((bead) => {\n      const id = Object.keys(bead)[0];\n      const value = Object.values(bead)[0];\n      const child = scene.getObjectByName(id) as THREE.Mesh | undefined;\n      if (child === undefined) {\n        return;\n      }\n\n      if (value === true) {\n        (child.material as THREE.MeshPhysicalMaterial).emissive.set(0x888888);\n      } else {\n        (child.material as THREE.MeshPhysicalMaterial).emissive.set(0);\n      }\n    });\n  });\n\n  // beads.forEach((beadId, index) => {\n  //     const bead = state.appData.beads[beadId];\n  //     // console.log(\"renderBeads: add bead?\", bead);\n  //     // var transform = new THREE.Object3D();\n  //     // var shape = new THREE.SphereBufferGeometry(20)\n  //     // var transform = new RoundedBoxGeometry(50, 90, 40, 100, 10);\n  //     var transform = new THREE.Object3D();\n  //     transform.position.set(bead.position.x, bead.position.y, 0);\n  //     transform.updateMatrix();\n\n  //     let isSelected = false;\n\n  //     if (state.ui.selectedBeadsIdsCount > 0) {\n  //       isSelected = Object.keys(state.ui.selectedBeadsIds).includes(bead.id);\n  //     }\n\n  //     //  width, height, depth, radius, radiusSegments\n  //     // var geometry = new RoundedBoxGeometry(\n  //     //   bead.width,\n  //     //   bead.height,\n  //     //   Math.max(bead.width, bead.height),\n  //     //   bead.type === BeadTypes.BasicEllipse\n  //     //     ? Math.max(bead.width, bead.height)\n  //     //     : 0,\n  //     //   bead.type === BeadTypes.BasicEllipse\n  //     //     ? Math.max(bead.width, bead.height)\n  //     //     : 0\n  //     // );\n  //     // var geometry = new BoxGeometry(bead.width, bead.height, 10);\n  //     var geometry = new SphereGeometry(\n  //       Math.max(bead.width, bead.height),\n  //       32,\n  //       32\n  //     );\n  // var material = new THREE.MeshPhysicalMaterial({\n  //        flatShading: true,\n  //        reflectivity: reflectivity,\n  //        color: bead.color,\n  //      });\n  // if (isSelected) {\n  // -        material.emissive.set(0x888888);\n  //   -      // var geometry = new THREE.SphereBufferGeometry(20);\n  // -      // geometry.applyMatrix(transform.matrixWorld)\n  // -      // var material = new THREE.MeshBasicMaterial({ color: \"rgb(25, 118, 210)\" });\n  // -      var beadMesh = new THREE.Mesh(geometry, material);\n  // -      beadMesh.applyMatrix(new THREE.Matrix4().makeRotationZ(bead.rotate));\n  // -      beadMesh.applyMatrix(\n  // -        new THREE.Matrix4().makeTranslation(bead.position.x, bead.position.y, 0)\n  // -      );\n  // -      beadMesh.name = bead.id;\n  // -      basicMesh.push(beadMesh);\n  // -      scene.add(beadMesh);\n  // -\n  // -      // shape.applyMatrix(transform);\n  // -      // basicMesh.add(shape);\n  // -      // mesh.setMatrixAt(i++, transform.matrix);\n  // -      // mesh.matrixWorldNeedsUpdate = true;\n  // -    });\n\n  eventEmitter.on(\"action_addBeadOnClick\", (data) => {\n    // console.log(\"addBeadOnClick: ...\", );\n    const bead = data.bead as Bead;\n    const geometry = new SphereGeometry(\n      Math.max(bead.width, bead.height),\n      10,\n      10\n    );\n\n    geometry.mergeVertices();\n    geometry.computeVertexNormals();\n\n    const material = new THREE.MeshPhysicalMaterial({\n      flatShading: true,\n      reflectivity: reflectivity,\n      color: bead.color,\n    });\n    const beadMesh = new THREE.Mesh(geometry, material);\n    beadMesh.applyMatrix(\n      new THREE.Matrix4().makeRotationX(THREE.Math.DEG2RAD * 90)\n    );\n    beadMesh.applyMatrix(\n      new THREE.Matrix4().makeRotationZ(THREE.Math.DEG2RAD * bead.rotate)\n    );\n    beadMesh.applyMatrix(\n      new THREE.Matrix4().makeTranslation(bead.position.x, bead.position.y, 0)\n    );\n    basicMesh.push(beadMesh);\n    beadMesh.name = bead.id;\n    scene.add(beadMesh);\n  });\n\n  eventEmitter.on(\"action_readSavedCanvas\", (data) => {});\n\n  eventEmitter.on(\"action_readSavedCanvas\", (data) => {\n    Object.keys(data.beads).forEach((id) => {\n      const bead = data.beads[id] as Bead;\n      const geometry = new SphereGeometry(\n        Math.max(bead.width, bead.height),\n        10,\n        10\n      );\n\n      geometry.mergeVertices();\n      geometry.computeVertexNormals();\n\n      const material = new THREE.MeshPhysicalMaterial({\n        flatShading: true,\n        reflectivity: reflectivity,\n        color: bead.color,\n      });\n      const beadMesh = new THREE.Mesh(geometry, material);\n      beadMesh.applyMatrix(\n        new THREE.Matrix4().makeRotationX(THREE.Math.DEG2RAD * 90)\n      );\n      beadMesh.applyMatrix(\n        new THREE.Matrix4().makeRotationZ(THREE.Math.DEG2RAD * bead.rotate)\n      );\n      beadMesh.applyMatrix(\n        new THREE.Matrix4().makeTranslation(bead.position.x, bead.position.y, 0)\n      );\n      basicMesh.push(beadMesh);\n      beadMesh.name = bead.id;\n      scene.add(beadMesh);\n    });\n  });\n\n  eventEmitter.on(\"startAppEvent\", (data) => {\n    console.log(\"startAppEvent: ...\", data.state);\n\n    // const { getState } = appStore;\n    // const state = getState();\n    // console.log(\"renderBeads: subscribe event \");\n\n    // scene.dispose();\n    // scene.remove(mesh);\n\n    // while (basicMesh.length) {\n    //   while (basicMesh[0].children.length) {\n    //     basicMesh[0].remove(basicMesh[0].children[0]);\n    //   }\n    //   basicMesh.shift();\n    // }\n\n    // while (scene.children.length > 0) {\n    //   scene.remove(scene.children[0]);\n    // }\n\n    // var light1 = new THREE.DirectionalLight(0xffffff, 1);\n    // light1.position.set(0, 0, 1);\n    // scene.add(light1);\n\n    // var light2 = new THREE.PointLight(color, intensivity, distance);\n    // light2.position.set(-300, -300, z_index);\n    // scene.add(light2);\n\n    // var light1 = new THREE.PointLight(color, intensivity, distance);\n    // light1.position.set(-300, 300, z_index);\n    // scene.add(light1);\n\n    // var light2 = new THREE.PointLight(color, intensivity, distance);\n    // light2.position.set(-300, -300, z_index);\n    // scene.add(light2);\n\n    // var light3 = new THREE.PointLight(color, intensivity, distance);\n    // light3.position.set(300, 300, z_index);\n    // scene.add(light3);\n\n    // var light4 = new THREE.PointLight(color, intensivity, distance);\n    // light4.position.set(300, -300, z_index);\n    // scene.add(light4);\n\n    // var light4 = new THREE.PointLight(color, 0.4, distance);\n    // light4.position.set(0, 0, z_index);\n    // scene.add(light4);\n\n    // var bg_geometry = new THREE.PlaneGeometry(1000, 1000, 1);\n    // var bg_material = new THREE.MeshBasicMaterial({\n    //   color: \"#ccc\",\n    //   side: THREE.DoubleSide,\n    // });\n\n    // var bg_plane = new THREE.Mesh(bg_geometry, bg_material);\n    // scene.add(bg_plane);\n\n    // const beads = Object.keys(state.appData.beads);\n\n    // mesh.count = beads.length;\n\n    // console.log(\"renderBeads: count?\", beads.length);\n\n    // var i = 0;\n    // beads.forEach((beadId, index) => {\n    //   const bead = state.appData.beads[beadId];\n    //   // console.log(\"renderBeads: add bead?\", bead);\n    //   // var transform = new THREE.Object3D();\n    //   // var shape = new THREE.SphereBufferGeometry(20)\n    //   // var transform = new RoundedBoxGeometry(50, 90, 40, 100, 10);\n    //   var transform = new THREE.Object3D();\n    //   transform.position.set(bead.position.x, bead.position.y, 0);\n    //   transform.updateMatrix();\n\n    //   let isSelected = false;\n\n    //   if (state.ui.selectedBeadsIdsCount > 0) {\n    //     isSelected = Object.keys(state.ui.selectedBeadsIds).includes(bead.id);\n    //   }\n\n    //   //  width, height, depth, radius, radiusSegments\n    //   // var geometry = new RoundedBoxGeometry(\n    //   //   bead.width,\n    //   //   bead.height,\n    //   //   Math.max(bead.width, bead.height),\n    //   //   bead.type === BeadTypes.BasicEllipse\n    //   //     ? Math.max(bead.width, bead.height)\n    //   //     : 0,\n    //   //   bead.type === BeadTypes.BasicEllipse\n    //   //     ? Math.max(bead.width, bead.height)\n    //   //     : 0\n    //   // );\n    //   // var geometry = new BoxGeometry(bead.width, bead.height, 10);\n\n    // for (let i = 0; i < 10 * 10; i = i + 10) {\n    //   for (let j = 0; j < 10 * 50; j = j + 10) {\n    //     var geometry = new SphereGeometry(Math.max(8, 8), 16, 16);\n    //     var material = new THREE.MeshPhongMaterial({\n    //       color: \"red\",\n    //     });\n    //     var beadMesh = new THREE.Mesh(geometry, material);\n    //     beadMesh.applyMatrix(\n    //       new THREE.Matrix4().makeRotationX(THREE.Math.DEG2RAD * 90)\n    //     );\n    //     beadMesh.applyMatrix(new THREE.Matrix4().makeTranslation(i, j, 0));\n    //     basicMesh.push(beadMesh);\n    //     const uuid1 = `${generate()}`;\n    //     beadMesh.name = uuid1;\n    //     scene.add(beadMesh);\n    //   }\n    // }\n\n    // console.log(scene.getObjectByName(uuid1));\n\n    //   // shape.applyMatrix(transform);\n    //   // basicMesh.add(shape);\n    //   // mesh.setMatrixAt(i++, transform.matrix);\n    //   // mesh.matrixWorldNeedsUpdate = true;\n    // });\n    // scene.add(basicMesh);\n\n    // setTimeout(() => {\n    //   basicMesh.matrixWorldNeedsUpdate = true;\n    //   basicMesh.translateX(1);\n    //   scene.visible = true;\n    //   render();\n    // }, 10);\n\n    // basicMesh.updateMatrixWorld();\n    // basicMesh.updateMorphTargets();\n    // basicMesh.updateWorldMatrix(true, true);\n    // basicMesh.updateMatrix();\n\n    // scene.matrixWorldNeedsUpdate = true;\n    // scene.add(basicMesh);\n\n    // console.log(\"mesh?\", basicMesh);\n    // renderer.render(scene, camera);\n  });\n\n  // const { dispatch, subscribe, getState } = appStore;\n\n  // subscribe(() => {\n  //   renderBeads();\n  // });\n  // dispatch({type: \"\"})\n\n  var basicMesh: THREE.Mesh[] = [];\n  var sceneScale = 1;\n\n  function init() {\n    if (el !== null) {\n      const { width, height } = el.getBoundingClientRect();\n\n      // camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 100);\n      camera = new THREE.OrthographicCamera(\n        width / -2,\n        width / 2,\n        height / 2,\n        height / -2,\n        -1000,\n        1000\n      );\n    }\n    // camera.position.set(amount, amount, amount);\n    camera.position.set(0, 0, 500);\n    camera.lookAt(0, 0, 0);\n\n    // camera.zoom\n\n    scene = new THREE.Scene();\n\n    // var light = new THREE.HemisphereLight(0xffffff, 0x666, 1);\n    // light.position.set(0, 0, 1000);\n    // // light.position.set(-1, 1.5, 1);\n    // // light.position.set(-1, 1.5, 1);\n    // scene.add(light);\n\n    scene.background = new THREE.Color(\"#F1F3F3\");\n    // scene.background = new THREE.TextureLoader().load(require('./img/background.jpg').default);\n\n    const l1 = new THREE.DirectionalLight(\"#FFF\", 0.99);\n    l1.position.set(0, 0, 1);\n    scene.add(l1);\n\n    const l2 = new THREE.AmbientLight(\"#FFF\", 0.1);\n    l2.position.set(0, 0, 1);\n    scene.add(l2);\n\n    // const directionalLight2 = new THREE.DirectionalLight(\"#FFF\", 0.99);\n    // directionalLight2.position.set(-10, -10, -10);\n    // scene.add(directionalLight2);\n\n    var bg_geometry = new THREE.PlaneGeometry(1000, 1000, 1);\n    var bg_material = new THREE.MeshBasicMaterial({\n      color: \"#ccc\",\n      side: THREE.DoubleSide,\n    });\n\n    var bg_plane = new THREE.Mesh(bg_geometry, bg_material);\n    scene.add(bg_plane);\n\n    // var light1 = new THREE.PointLight(color, intensivity, distance);\n    // light1.position.set(-300, 300, z_index);\n    // scene.add(light1);\n\n    // var light2 = new THREE.PointLight(color, intensivity, distance);\n    // light2.position.set(-300, -300, z_index);\n    // scene.add(light2);\n\n    // var light3 = new THREE.PointLight(color, intensivity, distance);\n    // light3.position.set(300, 300, z_index);\n    // scene.add(light3);\n\n    // var light4 = new THREE.PointLight(color, intensivity, distance);\n    // light4.position.set(300, -300, z_index);\n    // scene.add(light4);\n\n    // var light4 = new THREE.PointLight(color, 0.4, distance);\n    // light4.position.set(0, 0, z_index);\n    // scene.add(light4);\n\n    var bg_geometry = new THREE.PlaneGeometry(1000, 1000, 1);\n    var bg_material = new THREE.MeshBasicMaterial({\n      color: \"#ccc\",\n      side: THREE.DoubleSide,\n    });\n\n    var bg_plane = new THREE.Mesh(bg_geometry, bg_material);\n    scene.add(bg_plane);\n\n    // var light = new THREE.HemisphereLight(0xffffff, 0x880000, 0.5);\n    // light.position.set(-1, -1.5, -1);\n    // scene.add(light);\n\n    // interface RoundedBoxGeometryProps{\n    //   width, height, depth, radius, radiusSegments\n    // }\n    // var __geometry = new RoundedBoxGeometry(50, 90, 40, 100, 10);\n    // var __material = new THREE.MeshPhysicalMaterial({\n    //   flatShading: true,\n    //   reflectivity: reflectivity,\n    //   color: \"red\"\n    // });\n\n    // mesh = new THREE.InstancedMesh(__geometry, __material, 20);\n    // var __transform = new THREE.Object3D();\n    // __transform.position.set(10, 10, 10);\n    // __transform.updateMatrix();\n    // mesh.setMatrixAt(0, __transform.matrix);\n    // scene.add(mesh);\n\n    // var geometry = new THREE.SphereBufferGeometry(20);\n    // var geometry = new THREE.BoxBufferGeometry(40, 40, 40);\n\n    // var material = new THREE.MeshPhysicalMaterial({\n    //   flatShading: true,\n    //   reflectivity: reflectivity,\n    //   color: \"rgb(25, 118, 210)\"\n    // });\n\n    // mesh = new THREE.InstancedMesh(geometry, material, count);\n\n    // var i = 0;\n    // var offset = (60 * (amount - 1)) / 2;\n\n    // var transform = new THREE.Object3D();\n\n    // for (var x = 0; x < amount; x++) {\n    //   for (var y = 0; y < amount; y++) {\n    //     // for (var z = 0; z < amount; z++) {\n    //     transform.position.set(\n    //       offset - x * 60,\n    //       offset - y * 60,\n    //       // offset - z * 60\n    //       0\n    //     );\n    //     transform.updateMatrix();\n\n    //     mesh.setMatrixAt(i++, transform.matrix);\n    //     // }\n    //   }\n    // }\n\n    // scene.add(mesh);\n\n    // const { dispatch, subscribe, getState } = appStore;\n    // const state = getState();\n\n    //\n\n    // var gui: any = new GUI();\n    // gui.add(mesh, \"count\", 0, count);\n\n    // console.log(\"init\");\n    renderer = new THREE.WebGLRenderer({ antialias: true });\n    renderer.setPixelRatio(window.devicePixelRatio);\n\n    if (el !== null) {\n      const { width, height } = el.getBoundingClientRect();\n      renderer.setSize(width, height);\n      el.appendChild(renderer.domElement);\n    }\n\n    // new OrbitControls(camera, renderer.domElement);\n\n    // stats = new (Stats as any)();\n    // if (el !== null) {\n    //   el.appendChild(stats.dom);\n    // }\n\n    window.addEventListener(\"resize\", onWindowResize, false);\n\n    if (el !== null) {\n      el.addEventListener(\"mousedown\", onMouseDown, false);\n      el.addEventListener(\"mousemove\", onMouseMove, false);\n      el.addEventListener(\"mouseup\", onMouseUp, false);\n      el.addEventListener(\"wheel\", onWheel, false);\n    }\n    mouseSelectionHelper.setRenderer(renderer);\n  }\n\n  function onWheel(event) {\n    event.preventDefault();\n    if (el !== null) {\n      const { width, height, top, left } = el.getBoundingClientRect();\n      // const __x1 = event.clientX - left - (width * sceneScale) / 2;\n      // const __y1 = (height * sceneScale) / 2 - (event.clientY - top);\n\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n\n      const cameraX = camera.position.x;\n      const cameraY = camera.position.y;\n\n      const mouseXInWorldBefore = (screenX - width / 2) * sceneScale;\n      const mouseYInWorldBefore = -1 * (screenY - height / 2) * sceneScale;\n\n      sceneScale += Math.sign(event.deltaY) * 0.02;\n      sceneScale = Math.min(Math.max(0.125, sceneScale), 4);\n\n      const mouseXInWorldAfter = (screenX - width / 2) * sceneScale;\n      const mouseYInWorldAfter = -1 * (screenY - height / 2) * sceneScale;\n\n      camera.left = (width * sceneScale) / -2;\n      camera.right = (width * sceneScale) / 2;\n      camera.top = (height * sceneScale) / 2;\n      camera.bottom = (height * sceneScale) / -2;\n      camera.updateProjectionMatrix();\n\n      const diffX = mouseXInWorldBefore - mouseXInWorldAfter;\n      const diffY = mouseYInWorldBefore - mouseYInWorldAfter;\n\n      camera.position.x = cameraX + diffX;\n      camera.position.y = cameraY + diffY;\n      camera.lookAt(camera.position.x, camera.position.y, 0);\n\n      // camera.zoom = sceneScale;\n      // console.log('co to jest w getBoundingClientRect:', width, height)\n\n      // const __x2 = event.clientX - left - (width * sceneScale) / 2;\n      // const __y2 = (height * sceneScale) / 2 - (event.clientY - top);\n\n      // const delta_x1 = __x1 - __x2;\n      // const delta_y1 = __y1 - __y2;\n\n      // console.log(\n      //   \"jaki jest scale?\",\n      //   event.clientX,\n      //   event.clientY,\n      //   sceneScale,\n      //   delta_x1,\n      //   delta_y1\n      // );\n\n      // camera.position.set(\n      //   camera.position.x - delta_x1,\n      //   camera.position.y - delta_y1,\n      //   camera.position.z\n      // );\n      // camera.lookAt(\n      //   camera.position.x - delta_x1,\n      //   camera.position.y - delta_y1,\n      //   0\n      // );\n    }\n  }\n\n  const screenToWorld = (clientX, clientY): THREE.Vector2 => {\n    if (el === null) {\n      throw new Error(\"no el in dom\");\n    }\n\n    const { width, height, top, left } = el.getBoundingClientRect();\n    const screenX = clientX - left;\n    const screenY = clientY - top;\n    const x = (screenX - width / 2) * sceneScale + camera.position.x;\n    const y = (-screenY + height / 2) * sceneScale + camera.position.y;\n    return new THREE.Vector2(x, y);\n  };\n\n  let isCameraGrabed = false;\n  let startDragMousePosition = new THREE.Vector2();\n  let startDragCamera = new THREE.Vector2();\n\n  let boundingClientRect;\n\n  function onMouseDown(event) {\n    const { getState } = appStore;\n    const state = getState();\n    if (state.mode === EditorMode.Idle) {\n      isCameraGrabed = true;\n      if (el !== null) {\n        const { width, height, top, left } = el.getBoundingClientRect();\n        boundingClientRect = el.getBoundingClientRect();\n\n        const screenX = event.clientX - left;\n        const screenY = event.clientY - top;\n        startDragMousePosition.x = screenX;\n        startDragMousePosition.y = screenY;\n\n        startDragCamera.x = camera.position.x;\n        startDragCamera.y = camera.position.y;\n      }\n    } else if (state.mode === EditorMode.EditBeads) {\n      if (el !== null) {\n        boundingClientRect = el.getBoundingClientRect();\n      }\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      mouseSelectionBeads.onDown(x, y);\n      if (el === null) {\n        throw new Error(\"no el in dom\");\n      }\n      const { width, height, top, left } = el.getBoundingClientRect();\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n      mouseSelectionHelper.onDown(screenX, screenY);\n    }\n  }\n\n  function onMouseUp(event) {\n    const { dispatch, getState } = appStore;\n    const state = getState();\n    if (state.mode === EditorMode.AddBeads) {\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      dispatch(\n        Actions.Draggable.action_addBeadOnClick({\n          x,\n          y,\n        })\n      );\n    } else if (state.mode === EditorMode.Idle) {\n      if (isCameraGrabed === true) {\n        isCameraGrabed = false;\n      }\n    } else if (state.mode === EditorMode.EditBeads) {\n      if (mouseSelectionBeads.isDragged === true) {\n        // do nothing\n      } else if (\n        mouseSelectionBeads.isDragged === false &&\n        mouseSelectionBeads.isDragStarted === true\n      ) {\n        const { x, y } = screenToWorld(event.clientX, event.clientY);\n        const beadsIds: string[] = [];\n        Object.keys(state.appData.beads).forEach((beadId) => {\n          const bead = state.appData.beads[beadId];\n          const leftTop = buildPoint(\n            bead.position.x - bead.width / 2,\n            bead.position.y - bead.height / 2\n          );\n          const rightBottom = buildPoint(\n            bead.position.x + bead.width / 2,\n            bead.position.y + bead.height / 2\n          );\n          if (contain(leftTop, rightBottom, buildPoint(x, y))) {\n            beadsIds.push(beadId);\n          }\n        });\n        dispatch(Actions.MouseSelection.action_selectBeads(beadsIds));\n      } else {\n        dispatch(Actions.MouseSelection.action_selectBeads([]));\n      }\n      mouseSelectionBeads.onUp();\n      mouseSelectionHelper.onUp();\n    }\n  }\n\n  function onWindowResize() {\n    // console.log(\"onWindowResize\");\n    // const { dispatch, subscribe, getState } = appStore;\n    // const state = getState();\n\n    if (el !== null) {\n      const { width, height } = el.getBoundingClientRect();\n\n      // camera.aspect = width / height;\n      // (camera as THREE.OrthographicCamera)\n      camera.left = width / -2;\n      camera.right = width / 2;\n      camera.top = height / 2;\n      camera.bottom = height / -2;\n      camera.updateProjectionMatrix();\n      renderer.setSize(width, height);\n    }\n  }\n\n  function onMouseMove(event) {\n    if (boundingClientRect) {\n      // event.preventDefault();\n      const { width, height, top, left } = boundingClientRect;\n\n      // Used in: Clicked at item in world?\n      mouse_intercestion.x = ((event.clientX - left) / width) * 2 - 1;\n      mouse_intercestion.y = -((event.clientY - top) / height) * 2 + 1;\n\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n\n      if (isCameraGrabed === true) {\n        const screenMouseDiffX = startDragMousePosition.x - screenX;\n        const screenMouseDiffY = startDragMousePosition.y - screenY;\n\n        const mouseDiffXInWorldSpace = screenMouseDiffX * sceneScale;\n        const mouseDiffYInWorldSpace = screenMouseDiffY * sceneScale;\n\n        const cameraX = startDragCamera.x + mouseDiffXInWorldSpace;\n        const cameraY = startDragCamera.y - mouseDiffYInWorldSpace;\n        camera.position.x = cameraX;\n        camera.position.y = cameraY;\n        camera.lookAt(cameraX, cameraY, 0);\n      }\n\n      const { dispatch, subscribe, getState } = appStore;\n      const state = getState();\n\n      if (state.mode === EditorMode.EditBeads) {\n        if (mouseSelectionBeads.isDragStarted === true) {\n          const { x, y } = screenToWorld(event.clientX, event.clientY);\n          mouseSelectionBeads.onMove(x, y);\n          if (mouseSelectionBeads.isDragged === true) {\n            const beadsIds: string[] = [];\n            Object.keys(state.appData.beads).forEach((beadId) => {\n              const bead = state.appData.beads[beadId];\n              if (mouseSelectionBeads.contain(bead.position)) {\n                beadsIds.push(beadId);\n              }\n            });\n            dispatch(Actions.MouseSelection.action_selectBeads(beadsIds));\n          }\n        }\n        if (el === null) {\n          throw new Error(\"no el in dom\");\n        }\n        const { width, height, top, left } = el.getBoundingClientRect();\n        const screenX = event.clientX - left;\n        const screenY = event.clientY - top;\n        mouseSelectionHelper.onMove(screenX, screenY);\n      }\n    }\n  }\n\n  function animate() {\n    requestAnimationFrame(animate);\n\n    render();\n  }\n\n  function render() {\n    // console.log('render camra')\n    // if (basicMesh !== undefined && basicMesh.length > 0) {\n    //   raycaster.setFromCamera(mouse_intercestion, camera);\n    //   var intersection: any = raycaster.intersectObject(basicMesh[0]);\n\n    //   if (intersection.length > 0) {\n    //     console.log(\"co zaznaczono?\", intersection);\n    //     //   var instanceId = intersection[0].instanceId;\n\n    //     //   mesh.getMatrixAt(instanceId, instanceMatrix);\n    //     //   matrix.multiplyMatrices(instanceMatrix, rotationMatrix);\n\n    //     //   mesh.setMatrixAt(instanceId, matrix);\n    //     //   mesh.instanceMatrix.needsUpdate = true;\n    //   }\n    // }\n\n    // if(mesh){\n    //   mesh.instanceMatrix.needsUpdate = true;\n    //   // mesh.rotateX(0.01)\n    // }\n\n    renderer.render(scene, camera);\n    // console.log(\"render\")\n\n    // stats.update();\n  }\n};\n\nclass MouseSelection {\n  isDragged: boolean = false;\n  isDragStarted: boolean = false;\n  end: { x: number; y: number } = { x: 0, y: 0 };\n  start: { x: number; y: number } = { x: 0, y: 0 };\n\n  onUp() {\n    this.isDragStarted = false;\n    this.isDragged = false;\n    this.start.x = 0;\n    this.start.y = 0;\n    this.end.x = 0;\n    this.end.y = 0;\n  }\n\n  onDown(x: number, y: number) {\n    this.isDragStarted = true;\n    this.start.x = x;\n    this.start.y = y;\n    this.end.x = x;\n    this.end.y = y;\n  }\n\n  onMove(x: number, y: number) {\n    if (this.isDragStarted == true) {\n      this.end.x = x;\n      this.end.y = y;\n      if (this.isDragged === false) {\n        const { start, end } = this;\n        const deltaX = end.x - start.x;\n        const deltaY = end.y - start.y;\n\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\n          this.isDragged = true;\n        }\n      }\n    }\n  }\n\n  contain(p: { x: number; y: number }) {\n    const { start, end } = this;\n\n    const p1_x = Math.min(start.x, end.x);\n    const p1_y = Math.min(start.y, end.y);\n\n    const p2_x = Math.max(start.x, end.x);\n    const p2_y = Math.max(start.y, end.y);\n\n    return p.x > p1_x && p.x < p2_x && p.y > p1_y && p.y < p2_y;\n  }\n}\n\nclass MouseSelectionHelper {\n  element: HTMLDivElement;\n  renderer: any;\n  startPoint: Vector2;\n  pointTopLeft: Vector2;\n  pointBottomRight: Vector2;\n  isDown: boolean;\n\n  constructor() {\n    this.element = document.createElement(\"div\");\n    this.element.style.pointerEvents = \"none\";\n    this.element.style.background = \"rgba(75, 160, 255, 0.3)\";\n    this.element.style.border = \"1px solid #55aaff\";\n    this.element.style.position = \"absolute\";\n    this.element.style.zIndex = \"2\";\n    this.startPoint = new Vector2();\n    this.pointTopLeft = new Vector2();\n    this.pointBottomRight = new Vector2();\n    this.isDown = false;\n  }\n\n  setRenderer(renderer) {\n    this.renderer = renderer;\n  }\n\n  onDown(screenX: number, screenY: number) {\n    this.isDown = true;\n    this.renderer.domElement.parentElement.appendChild(this.element);\n\n    // this.element.setAttribute(\"style\", `\n    //   left: ${screenX}px;\n    //   top: ${screenY}px;\n    //   width: 0px;\n    //   height: 0px;\n    // `);\n    this.element.style.left = screenX + \"px\";\n    this.element.style.top = screenY + \"px\";\n    this.element.style.width = \"0px\";\n    this.element.style.height = \"0px\";\n\n    this.startPoint.x = screenX;\n    this.startPoint.y = screenY;\n  }\n\n  onMove(screenX: number, screenY: number) {\n    if (this.isDown) {\n      this.pointBottomRight.x = Math.max(this.startPoint.x, screenX);\n      this.pointBottomRight.y = Math.max(this.startPoint.y, screenY);\n      this.pointTopLeft.x = Math.min(this.startPoint.x, screenX);\n      this.pointTopLeft.y = Math.min(this.startPoint.y, screenY);\n\n      this.element.style.left = this.pointTopLeft.x + \"px\";\n      this.element.style.top = this.pointTopLeft.y + \"px\";\n      this.element.style.width =\n        this.pointBottomRight.x - this.pointTopLeft.x + \"px\";\n      this.element.style.height =\n        this.pointBottomRight.y - this.pointTopLeft.y + \"px\";\n    }\n  }\n\n  onUp() {\n    if (this.element.parentElement !== null) {\n      this.element.parentElement.removeChild(this.element);\n    }\n  }\n\n  // this.renderer.domElement.addEventListener( 'mousedown', function ( event ) {\n\n  //   this.isDown = true;\n  //   this.onSelectStart( event );\n\n  // }.bind( this ), false );\n\n  // this.renderer.domElement.addEventListener( 'mousemove', function ( event ) {\n\n  //   if ( this.isDown ) {\n\n  //     this.onSelectMove( event );\n\n  //   }\n\n  // }.bind( this ), false );\n\n  // this.renderer.domElement.addEventListener( 'mouseup', function ( event ) {\n\n  //   this.isDown = false;\n  //   this.onSelectOver( event );\n\n  // }.bind( this ), false );\n}\n\n// SelectionHelper.prototype.onSelectStart = function ( event ) {\n\n//   this.renderer.domElement.parentElement.appendChild( this.element );\n\n//   this.element.style.left = event.clientX + 'px';\n//   this.element.style.top = event.clientY + 'px';\n//   this.element.style.width = '0px';\n//   this.element.style.height = '0px';\n\n//   this.startPoint.x = event.clientX;\n//   this.startPoint.y = event.clientY;\n\n// };\n\n// SelectionHelper.prototype.onSelectMove = function ( event ) {\n\n//   this.pointBottomRight.x = Math.max( this.startPoint.x, event.clientX );\n//   this.pointBottomRight.y = Math.max( this.startPoint.y, event.clientY );\n//   this.pointTopLeft.x = Math.min( this.startPoint.x, event.clientX );\n//   this.pointTopLeft.y = Math.min( this.startPoint.y, event.clientY );\n\n//   this.element.style.left = this.pointTopLeft.x + 'px';\n//   this.element.style.top = this.pointTopLeft.y + 'px';\n//   this.element.style.width = ( this.pointBottomRight.x - this.pointTopLeft.x ) + 'px';\n//   this.element.style.height = ( this.pointBottomRight.y - this.pointTopLeft.y ) + 'px';\n\n// };\n\n// SelectionHelper.prototype.onSelectOver = function () {\n\n//   this.element.parentElement.removeChild( this.element );\n\n// };\n","import { Point } from \"./Editor\";\nimport { immerable } from \"immer\";\n\nexport const buildPoint = (x: number = 0, y: number = 0): Point => {\n  return {\n    x,\n    y,\n    [immerable]: true,\n  } as Point;\n};\n\nexport const getLength = (point: Point) => {\n  return Math.sqrt(point.x * point.x + point.y * point.y);\n};\n\nexport const normalize = (point: Point) => {\n  const length = getLength(point);\n  const useLen = length === 0;\n  const x = useLen ? 0 : point.x / length;\n  const y = useLen ? 0 : point.y / length;\n  return buildPoint(x, y);\n};\n\nexport const scale = (point: Point, scalar: number) => {\n  return buildPoint(point.x * scalar, point.y * scalar);\n};\n\nexport const add = (point: Point, x: number, y: number) => {\n  return buildPoint(point.x + x, point.y + y);\n};\n\nexport const sub = (point: Point, x: number, y: number) => {\n  return buildPoint(point.x - x, point.y - y);\n};\n\nexport const getDistance = (x1, y1, x2, y2): number => {\n  return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n};\n\nexport const getDistanceBetweenPoints = (start: Point, end: Point): number => {\n  return Math.sqrt(\n    (end.x - start.x) * (end.x - start.x) +\n      (end.y - start.y) * (end.y - start.y)\n  );\n};\n\nexport const getRotate = (y, x) => {\n  return Math.atan2(y, x);\n};\n\nexport const contain = (p1: Point, p2: Point, p: Point): boolean => {\n  return p.x > p1.x && p.x < p2.x && p.y > p1.y && p.y < p2.y;\n};\n\nexport const toRadian = (radians: number) => {\n  return (radians / 180) * Math.PI;\n};\n\nexport const toDeg = (radians: number) => {\n  return (radians * 180) / Math.PI;\n};\n","import { immerable } from \"immer\";\nimport { generate } from \"shortid\";\nimport { Bead, BeadTypes } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport { defaulBeadColor } from \"../components/colors\";\n\nexport const buildBead = (props: DeepPartial<Bead>): Bead => {\n  const defaults: Bead = {\n    id: generate(),\n    position: buildPoint(0, 0),\n    type: BeadTypes.BasicEllipse,\n    rotate: 0,\n    lineRotate: 0,\n    color: defaulBeadColor,\n    height: 10,\n    width: 10,\n    keepAspectRatio: false,\n    [immerable]: true,\n  };\n  return merge(defaults, props);\n  // const id = generate();\n  // const beadType = type ? type : BeadTypes.BasicCircle;\n  // const common = {\n  //   id,\n  //   position,\n  //   [immerable]: true,\n  //   type: beadType,\n  // };\n\n  // if (beadType === BeadTypes.BasicCircle) {\n  //   return buildBead_BasicCircle(common);\n  // }\n\n  // if (beadType === BeadTypes.BasicRectangle) {\n  //   return buildBead_BasicRectangle(common);\n  // }\n\n  // return buildBead_BasicCircle(common);\n};\n\n// const buildBead_BasicCircle = common => {\n//   return {\n//     ...common,\n//     width: 20,\n//     height: 20,\n//     fill: `linear-gradient(\n//       to bottom,\n//       rgba(254, 204, 177, 1) 0%,\n//       rgba(241, 116, 50, 1) 50%,\n//       rgba(234, 85, 7, 1) 51%,\n//       rgba(251, 149, 94, 1) 100%\n//     )`,\n//     settings: {\n//       radius: 20,\n//     },\n//   } as Bead;\n// };\n\n// const buildBead_BasicRectangle = common => {\n//   return {\n//     ...common,\n//     width: 20,\n//     height: 40,\n//     fill: \"#b1b1b1\",\n//   } as Bead;\n// };\n","export const uiButton = \"#aeaeae\"\nexport const defaulBeadColor = \"#4fc3f7\";","import { immerable } from \"immer\";\nimport { Line, Point } from \"./Editor\";\nimport { generate } from \"shortid\";\nimport { normalize, scale, add, buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildBead } from \"./Bead\";\n\nexport const buildLine = (props: DeepPartial<Line>): Line => {\n  const __defaults = {\n    id: generate(),\n    start: buildPoint(10, 10),\n    end: buildPoint(100, 100),\n    beadIds: [],\n    settings: {\n      beadsCount: 0,\n      beadsAutoCount: true,\n      beadsSpacing: 0,\n      beadsAutoSpacing: false,\n      defaultBead: buildBead({}),\n    },\n    [immerable]: true,\n  };\n\n  return merge(__defaults, props);\n};\n\nexport const getLength = (line: Line): number => {\n  return Math.sqrt(\n    (line.end.x - line.start.x) * (line.end.x - line.start.x) +\n      (line.end.y - line.start.y) * (line.end.y - line.start.y)\n  );\n};\n\nexport const getPointFromStart = (line: Line, distance: number): Point => {\n  const x = line.end.x - line.start.x;\n  const y = line.end.y - line.start.y;\n  let point = buildPoint(x, y);\n  point = normalize(point);\n  point = scale(point, distance);\n  point = add(point, line.start.x, line.start.y);\n  return point;\n};\n\nexport const getPointFromStartLine = (\n  startX: number,\n  startY: number,\n  endX: number,\n  endY: number,\n  distance: number\n): Point => {\n  const x = endX - startX;\n  const y = endY - startY;\n  let point = buildPoint(x, y);\n  point = normalize(point);\n  point = scale(point, distance);\n  point = add(point, startX, startY);\n  return point;\n};\n","import { ImmerReducer } from \"immer-reducer\";\nimport { Editor, \n  // EditorMode, Point \n} from \"../editorObjects/Editor\";\nimport {\n  // buildPoint,\n  getDistanceBetweenPoints,\n  getRotate,\n  toDeg,\n} from \"../editorObjects/Point\";\nimport { buildBead } from \"../editorObjects/Bead\";\n// import { buildLine } from \"../editorObjects/Line\";\nimport { getPointFromStartLine } from \"../editorObjects/Line\";\n// import { merge } from \"lodash\";\n\nexport class BeadSnapperImmerReducer extends ImmerReducer<Editor> {\n  \n  // useHexGrid(){\n  //   xPos = P.transform.position[0];\n  //   yPos = P.transform.position[1];\n\n  //   cSize = L.effect(\"Cell Size\")(\"Slider\");\n  //   xOffset = L.effect(\"X Offset\")(\"Slider\");\n  //   yOffset = L.effect(\"Y Offset\")(\"Slider\");\n\n  //   // Convert size value into distance values between cells\n  //   cWidth = cSize*.75;\n  //   cHeight = cSize*13/15;\n\n  //   // Find new X and Y positions\n  //   yNew = yPos - yPos % cHeight + cHeight/2;\n  //   xNew = xPos - (xPos % cWidth) + (((yNew - cHeight/2).toFixed(2)/cHeight).toFixed(2) % 1) * (cWidth/2);\n\n  //   // Check for even/odd column, adjust properly\n  //   if (!(xNew % (cWidth*2) == 0)) yNew += cHeight/2;\n\n  //   // Implement offset\n  //   [xNew + xOffset, yNew+yOffset]\n  // }\n\n  updateBeadsPositions(lineId: string) {\n    // console.log(\"updateBeadsPositions: ---------------------- start\");\n    const currentLine = this.draftState.appData.lines[lineId];\n    const count = this.getLineBeadsCount(lineId);\n    const currentCount = currentLine.beadIds.length;\n    // console.log(\n    //   \"updateBeadsPositions: currentCount: \",\n    //   currentCount,\n    //   \" count\",\n    //   count\n    // );\n    if (count > currentCount) {\n      const remaining = count - currentCount;\n      this.addRemainingBeads(lineId, remaining);\n    } else if (count < currentCount) {\n      const overflow = currentCount - count;\n      this.removeOverflowBeads(lineId, overflow);\n    }\n    this.draftState.appData.lines[lineId].settings.beadsCount = count;\n    this.modifyBeadsPosition(lineId);\n    this.modifyBeadsRotate(lineId);\n    // console.log(\"updateBeadsPositions: ----------------------  end\");\n  }\n\n  getLineBeadsCount(lineId) {\n    const currentLine = this.draftState.appData.lines[lineId];\n    const {\n      beadsAutoCount,\n      beadsAutoSpacing,\n      beadsCount,\n      beadsSpacing,\n      defaultBead,\n    } = currentLine.settings;\n    const { start, end, beadIds } = currentLine;\n    const lineLen = getDistanceBetweenPoints(start, end);\n\n    // console.log(\n    //   \"getLineBeadsCount \",\n    //   lineLen,\n    //   beadsAutoCount === true,\n    //   beadsAutoSpacing === true\n    // );\n    if (beadsAutoCount === true && beadsAutoSpacing === true) {\n      // beadsy sa przyklejone do siebie. COunt powinien byc tyle ile sie zmiesci na lini\n      let beadsWidths: number[] = [];\n      let beadsWidth = 0;\n      beadIds.forEach(beadId => {\n        const width = this.draftState.appData.beads[beadId].width;\n        beadsWidth = beadsWidth + width;\n        beadsWidths.push(width);\n      });\n      if (lineLen >= beadsWidth) {\n        // ile defaultsow trzeba dodac aby linia byla wypelniona?\n        const defaultBeadWidth = defaultBead.width ? defaultBead.width : 10;\n        const remainingSpace = lineLen - beadsWidth;\n        const count =\n          Math.floor(remainingSpace / defaultBeadWidth) + beadsWidths.length;\n\n        return count;\n      } else {\n        // trzeba odejmowac elementy z lini do momentu az wszystkie sie zmnieszcza\n        for (let i = beadsWidths.length - 1; i >= 0; i--) {\n          beadsWidth = beadsWidth - beadsWidths[i];\n          if (lineLen > beadsWidth) {\n            const count = i;\n            return count;\n          }\n        }\n        // nie powinno byc elementow na linie, bo nie ma miejsca z lineLen\n        return 0;\n      }\n    } else if (beadsAutoCount === false && beadsAutoSpacing === false) {\n      return beadsCount;\n    } else if (beadsAutoCount === true && beadsAutoSpacing === false) {\n      let beadsWidths: number[] = [];\n      let beadsWidth = 0;\n      beadIds.forEach(beadId => {\n        const width =\n          this.draftState.appData.beads[beadId].width + beadsSpacing;\n        beadsWidth = beadsWidth + width;\n        beadsWidths.push(width);\n      });\n      if (lineLen >= beadsWidth - beadsSpacing) {\n        const defaultBeadWidth = defaultBead.width ? defaultBead.width : 10;\n        const remainingSpace = lineLen - (beadsWidth - beadsSpacing);\n        const count =\n          Math.floor(remainingSpace / (defaultBeadWidth + beadsSpacing)) +\n          beadsWidths.length;\n        return count;\n      } else {\n        for (let i = beadsWidths.length - 1; i >= 0; i--) {\n          beadsWidth = beadsWidth - beadsWidths[i];\n          if (lineLen > beadsWidth - beadsSpacing) {\n            const count = i;\n            return count;\n          }\n        }\n        return 0;\n      }\n    } else if (beadsAutoCount === false && beadsAutoSpacing === true) {\n      return beadsCount;\n    }\n    return 0;\n  }\n\n  addRemainingBeads(lineId, remainingCount) {\n    const currentLine = this.draftState.appData.lines[lineId];\n    for (let i = 0; i < remainingCount; i++) {\n      let defaultBead: any = {};\n      if (currentLine.settings.defaultBead) {\n        defaultBead = { ...currentLine.settings.defaultBead };\n      } else if (\n        this.draftState.ui.lineSettings.settings &&\n        this.draftState.ui.lineSettings.settings.defaultBead\n      ) {\n        defaultBead = {\n          ...this.draftState.ui.lineSettings.settings.defaultBead,\n        };\n      }\n      defaultBead.id = undefined;\n      defaultBead.position = undefined;\n      const bead = buildBead(defaultBead);\n      this.draftState.appData.beads[bead.id] = bead;\n      this.draftState.appData.lines[lineId].beadIds.push(bead.id);\n    }\n  }\n\n  removeOverflowBeads(lineId, overflowCount) {\n    for (let i = 0; i < overflowCount; i++) {\n      const arrLen = this.draftState.appData.lines[lineId].beadIds.length;\n      const lastItemBeadId = this.draftState.appData.lines[\n        lineId\n      ].beadIds.splice(arrLen - 1, 1);\n      delete this.draftState.appData.beads[lastItemBeadId[0]];\n    }\n  }\n\n  modifyBeadsPosition(lineId) {\n    const currentLine = this.draftState.appData.lines[lineId];\n    const { start, end, beadIds } = currentLine;\n    const {\n      beadsAutoCount,\n      beadsAutoSpacing,\n      // beadsCount,\n      beadsSpacing,\n      // defaultBead,\n    } = currentLine.settings;\n\n    const standardLineHeight = 10;\n\n    if (beadsAutoCount === true && beadsAutoSpacing === true) {\n      let currentDistance = 0;\n      this.draftState.appData.lines[lineId].beadIds.forEach(beadId => {\n        const { width, height } = this.draftState.appData.beads[beadId];\n        currentDistance = currentDistance + width / 2;\n        const newPosition = getPointFromStartLine(\n          start.x,\n          start.y,\n          end.x,\n          end.y,\n          currentDistance\n        );\n        const x = newPosition.x - width / 2;\n        const y = newPosition.y - height / 2 + standardLineHeight / 2;\n        this.draftState.appData.beads[beadId].position.x = x;\n        this.draftState.appData.beads[beadId].position.y = y;\n        currentDistance = currentDistance + width / 2;\n      });\n    } else if (beadsAutoCount === false && beadsAutoSpacing === false) {\n      let currentDistance = 0;\n      this.draftState.appData.lines[lineId].beadIds.forEach(beadId => {\n        const { width, height } = this.draftState.appData.beads[beadId];\n        currentDistance = currentDistance + width / 2;\n        const newPosition = getPointFromStartLine(\n          start.x,\n          start.y,\n          end.x,\n          end.y,\n          currentDistance\n        );\n        const x = newPosition.x - width / 2;\n        const y = newPosition.y - height / 2 + standardLineHeight / 2;\n        this.draftState.appData.beads[beadId].position.x = x;\n        this.draftState.appData.beads[beadId].position.y = y;\n        currentDistance = currentDistance + width / 2 + beadsSpacing;\n      });\n    } else if (beadsAutoCount === true && beadsAutoSpacing === false) {\n      let currentDistance = 0;\n      this.draftState.appData.lines[lineId].beadIds.forEach(beadId => {\n        const { width, height } = this.draftState.appData.beads[beadId];\n\n        currentDistance = currentDistance + width / 2;\n        const newPosition = getPointFromStartLine(\n          start.x,\n          start.y,\n          end.x,\n          end.y,\n          currentDistance\n        );\n        const x = newPosition.x - width / 2;\n        const y = newPosition.y - height / 2 + standardLineHeight / 2;\n        this.draftState.appData.beads[beadId].position.x = x;\n        this.draftState.appData.beads[beadId].position.y = y;\n        currentDistance = currentDistance + width / 2 + beadsSpacing;\n      });\n    } else if (beadsAutoCount === false && beadsAutoSpacing === true) {\n      let beadsWidth = 0;\n      beadIds.forEach(beadId => {\n        const width = this.draftState.appData.beads[beadId].width;\n        beadsWidth = beadsWidth + width;\n      });\n      const lineLen = getDistanceBetweenPoints(start, end);\n      const avaiableSpace = lineLen - beadsWidth;\n      let dynamicBeadsSpacing = 0;\n      if (beadIds.length > 1) {\n        dynamicBeadsSpacing = avaiableSpace / (beadIds.length - 1);\n      }\n      let currentDistance = 0;\n      this.draftState.appData.lines[lineId].beadIds.forEach(beadId => {\n        const { width, height } = this.draftState.appData.beads[beadId];\n        currentDistance = currentDistance + width / 2;\n        const newPosition = getPointFromStartLine(\n          start.x,\n          start.y,\n          end.x,\n          end.y,\n          currentDistance\n        );\n        const x = newPosition.x - width / 2;\n        const y = newPosition.y - height / 2 + standardLineHeight / 2;\n        this.draftState.appData.beads[beadId].position.x = x;\n        this.draftState.appData.beads[beadId].position.y = y;\n        currentDistance = currentDistance + width / 2 + dynamicBeadsSpacing;\n      });\n    }\n  }\n\n  modifyBeadsRotate(lineId) {\n    const currentLine = this.draftState.appData.lines[lineId];\n    const { start, end, beadIds } = currentLine;\n    const lineRotateRadian = getRotate(start.x - end.x, start.y - end.y);\n    beadIds.forEach(beadId => {\n      this.draftState.appData.beads[beadId].lineRotate =\n        toDeg(lineRotateRadian) * -1;\n    });\n  }\n}\n","import {\n  // Editor,\n  EditorMode,\n  Point,\n  EditorGridType,\n  Bead,\n} from \"../editorObjects/Editor\";\n// import { buildPoint, getDistanceBetweenPoints } from \"../editorObjects/Point\";\n// import { ImmerReducer } from \"immer-reducer\";\n// import { buildBead } from \"../editorObjects/Bead\";\nimport { buildLine } from \"../editorObjects/Line\";\n// import { getPointFromStartLine } from \"../editorObjects/Line\";\nimport { BeadSnapperImmerReducer } from \"./BeadSnapperImmerReducer\";\nimport { buildBead } from \"../editorObjects/Bead\";\nimport {\n  buildPoint,\n  getDistanceBetweenPoints,\n  sub,\n  normalize,\n  scale,\n} from \"../editorObjects/Point\";\nimport { getEventEmitter } from \"../EventEmitter\";\n\nconst lineBoxOffset = 5;\n\nexport class DraggableOperationsImmerReducer extends BeadSnapperImmerReducer {\n  action_updateSceneZoom(event: any) {\n    this.draftState.ui.sceneWrapperPosition = event;\n  }\n  action_updateSceneWrapperSize({ width, height }) {\n    this.draftState.ui.sceneWrapperWidth = width;\n    this.draftState.ui.sceneWrapperHeight = height;\n  }\n\n  editorAppDataHasChanged() {\n    this.draftState.ui.saveInfo.saved = false;\n    this.draftState.ui.saveInfo.haveUnsavedChanges = true;\n  }\n\n  action_onAddLine(start: Point, end: Point) {\n    const line = buildLine({ ...this.draftState.ui.lineSettings, start, end });\n    this.draftState.appData.lines[line.id] = line;\n    this.draftState.mode = EditorMode.EditLines;\n    this.updateBeadsPositions(line.id);\n    this.editorAppDataHasChanged();\n  }\n\n  action_onStartPointDrag(\n    key: string,\n    data: {\n      x: number;\n      y: number;\n    }\n  ) {\n    // console.log(\"action_onStartPointDrag\");\n    if (this.draftState.appData.lines[key]) {\n      const line = this.draftState.appData.lines[key];\n      const {\n        width,\n        height,\n        snapEnabled,\n        type,\n        hexSize,\n      } = this.draftState.ui.grid;\n      if (snapEnabled === true) {\n        if (type === EditorGridType.Box) {\n          line.start.x = Math.round(data.x / width) * width - lineBoxOffset;\n          line.start.y = Math.round(data.y / height) * height - lineBoxOffset;\n        } else if (type === EditorGridType.Hex) {\n          const hexWidth = Math.sqrt(3) * hexSize;\n          const hSpace = hexWidth;\n          const hexHeight = 2 * hexSize;\n          const vSpace = hexHeight * (3 / 4);\n          const changeX = Math.round(data.x / hSpace) * hSpace - lineBoxOffset;\n          const vLine = Math.round(data.y / vSpace);\n          const changeY = vLine * vSpace - lineBoxOffset - hexHeight / 4;\n          line.start.y = changeY;\n          if (vLine % 2 === 0) {\n            line.start.x = hSpace / 2 + changeX;\n          } else {\n            line.start.x = changeX;\n          }\n        }\n      } else {\n        line.start.x = data.x - lineBoxOffset;\n        line.start.y = data.y - lineBoxOffset;\n      }\n      this.updateBeadsPositions(line.id);\n      this.editorAppDataHasChanged();\n    }\n  }\n\n  action_onEndPointDrag(\n    key: string,\n    data: {\n      x: number;\n      y: number;\n    }\n  ) {\n    // console.log(\"action_onEndPointDrag\");\n    if (this.draftState.appData.lines[key]) {\n      const line = this.draftState.appData.lines[key];\n      const {\n        width,\n        height,\n        snapEnabled,\n        hexSize,\n        type,\n      } = this.draftState.ui.grid;\n      if (snapEnabled === true) {\n        if (type === EditorGridType.Box) {\n          line.end.x = Math.round(data.x / width) * width - lineBoxOffset;\n          line.end.y = Math.round(data.y / height) * height - lineBoxOffset;\n        } else if (type === EditorGridType.Hex) {\n          const hexWidth = Math.sqrt(3) * hexSize;\n          const hSpace = hexWidth;\n          const hexHeight = 2 * hexSize;\n          const vSpace = hexHeight * (3 / 4);\n          const changeX = Math.round(data.x / hSpace) * hSpace - lineBoxOffset;\n          const vLine = Math.round(data.y / vSpace);\n          const changeY = vLine * vSpace - lineBoxOffset - hexHeight / 4;\n          line.end.y = changeY;\n          if (vLine % 2 === 0) {\n            line.end.x = hSpace / 2 + changeX;\n          } else {\n            line.end.x = changeX;\n          }\n        }\n      } else {\n        line.end.x = data.x - lineBoxOffset;\n        line.end.y = data.y - lineBoxOffset;\n      }\n      this.updateBeadsPositions(line.id);\n      this.editorAppDataHasChanged();\n    }\n  }\n\n  action_onLineDrag(\n    key: string,\n    data: {\n      x: number;\n      y: number;\n      deltaX: number;\n      deltaY: number;\n      startX: number;\n      startY: number;\n      lineStart: Point | null;\n      lineEnd: Point | null;\n    }\n  ) {\n    const { startX, startY, lineStart, lineEnd, x, y } = data;\n    if (this.draftState.appData.lines[key]) {\n      const line = this.draftState.appData.lines[key];\n      const {\n        width,\n        height,\n        snapEnabled,\n        type,\n        hexSize,\n      } = this.draftState.ui.grid;\n\n      if (snapEnabled === true) {\n        if (type === EditorGridType.Box) {\n          line.start.x =\n            Math.round((line.start.x + data.deltaX) / width) * width -\n            lineBoxOffset;\n\n          line.start.y =\n            Math.round((line.start.y + data.deltaY) / height) * height -\n            lineBoxOffset;\n\n          line.end.x =\n            Math.round((line.end.x + data.deltaX) / width) * width -\n            lineBoxOffset;\n\n          line.end.y =\n            Math.round((line.end.y + data.deltaY) / height) * height -\n            lineBoxOffset;\n        } else if (type === EditorGridType.Hex) {\n          const hexWidth = Math.sqrt(3) * hexSize;\n          const hSpace = hexWidth;\n          const hexHeight = 2 * hexSize;\n          const vSpace = hexHeight * (3 / 4);\n\n          if (lineStart !== null) {\n            const newX = lineStart.x + (x - startX);\n            const newY = lineStart.y + (y - startY);\n            const changeX = Math.round(newX / hSpace) * hSpace - lineBoxOffset;\n\n            const vLine = Math.round(newY / vSpace);\n            const newChangeY = vLine * vSpace;\n            const temp = hexHeight / 4;\n            let changeY = newChangeY - lineBoxOffset - temp;\n            line.start.y = changeY;\n            if (vLine % 2 === 0) {\n              line.start.x = hSpace / 2 + changeX;\n            } else {\n              line.start.x = changeX;\n            }\n          }\n\n          if (lineEnd !== null) {\n            const newX = lineEnd.x + (x - startX);\n            const newY = lineEnd.y + (y - startY);\n            const changeX = Math.round(newX / hSpace) * hSpace - lineBoxOffset;\n\n            const vLine = Math.round(newY / vSpace);\n            const newChangeY = vLine * vSpace;\n            const temp = hexHeight / 4;\n            let changeY = newChangeY - lineBoxOffset - temp;\n            line.end.y = changeY;\n            if (vLine % 2 === 0) {\n              line.end.x = hSpace / 2 + changeX;\n            } else {\n              line.end.x = changeX;\n            }\n          }\n        }\n      } else {\n        line.start.x = line.start.x + data.deltaX;\n        line.start.y = line.start.y + data.deltaY;\n        line.end.x = line.end.x + data.deltaX;\n        line.end.y = line.end.y + data.deltaY;\n      }\n      this.updateBeadsPositions(line.id);\n      this.editorAppDataHasChanged();\n    }\n  }\n\n  action_onGroupLineDrag(data: { deltaX: number; deltaY: number }) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((lineId) => {\n      if (this.draftState.appData.lines[lineId]) {\n        const line = this.draftState.appData.lines[lineId];\n        const { width, height, snapEnabled } = this.draftState.ui.grid;\n        if (snapEnabled === true) {\n          line.start.x =\n            Math.round((line.start.x + data.deltaX) / width) * width -\n            lineBoxOffset;\n\n          line.start.y =\n            Math.round((line.start.y + data.deltaY) / height) * height -\n            lineBoxOffset;\n\n          line.end.x =\n            Math.round((line.end.x + data.deltaX) / width) * width -\n            lineBoxOffset;\n\n          line.end.y =\n            Math.round((line.end.y + data.deltaY) / height) * height -\n            lineBoxOffset;\n        } else {\n          line.start.x = line.start.x + data.deltaX;\n          line.start.y = line.start.y + data.deltaY;\n          line.end.x = line.end.x + data.deltaX;\n          line.end.y = line.end.y + data.deltaY;\n        }\n        this.updateBeadsPositions(line.id);\n      }\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_onGroupBeadsDrag(data: { deltaX: number; deltaY: number }) {}\n\n  action_onClickLine(lineId: string) {\n    this.draftState.ui.selectedLinesIds = {};\n    this.draftState.ui.selectedLinesIds[lineId] = true;\n    this.draftState.ui.selectedLinesIdsCount = 1;\n  }\n\n  action_onClickLastestLine() {\n    const keys = Object.keys(this.draftState.appData.lines);\n    if (keys.length > 0) {\n      const lineId = keys[keys.length - 1];\n      this.action_onClickLine(lineId);\n    }\n  }\n\n  action_onClickBead(beadId: string) {\n    this.draftState.ui.selectedBeadsIds = {};\n    this.draftState.ui.selectedBeadsIds[beadId] = true;\n    this.draftState.ui.selectedBeadsIdsCount = 1;\n  }\n\n  action_addBeads_onMouseDown({ x, y }) {\n    this.draftState.ui.currentBeadChain.isDragEnabled = true;\n\n    let defaultBead: Partial<Bead> = { ...this.draftState.ui.beadsTemplate };\n    defaultBead.id = undefined;\n    defaultBead.position = buildPoint(x, y);\n\n    const bead = buildBead(defaultBead);\n    bead.position.x = bead.position.x - bead.width / 2;\n    bead.position.y = bead.position.y - bead.height / 2;\n\n    this.draftState.appData.beads[bead.id] = bead;\n    this.draftState.ui.currentBeadChain.beadIds.push(bead.id);\n  }\n\n  action_addBeads_onMouseMove({ x, y }) {\n    if (this.draftState.ui.currentBeadChain.isDragEnabled) {\n      const len = this.draftState.ui.currentBeadChain.beadIds.length;\n      const lastBeadId = this.draftState.ui.currentBeadChain.beadIds[len - 1];\n      const lastBead = this.draftState.appData.beads[lastBeadId];\n      const position = buildPoint(x, y);\n\n      const lastPosition = buildPoint(\n        lastBead.position.x + lastBead.width / 2,\n        lastBead.position.y + lastBead.height / 2\n      );\n      const distance = getDistanceBetweenPoints(lastPosition, position);\n\n      if (distance > lastBead.width) {\n        const vec = sub(position, lastPosition.x, lastPosition.y);\n        const norm = normalize(vec);\n        const scaled = scale(norm, lastBead.width);\n\n        let defaultBead: Partial<Bead> = {\n          ...this.draftState.ui.beadsTemplate,\n        };\n        defaultBead.id = undefined;\n        const _x = lastPosition.x + scaled.x;\n        const _y = lastPosition.y + scaled.y;\n        defaultBead.position = buildPoint(_x, _y);\n\n        const bead = buildBead(defaultBead);\n        bead.position.x = bead.position.x - bead.width / 2;\n        bead.position.y = bead.position.y - bead.height / 2;\n\n        this.draftState.appData.beads[bead.id] = bead;\n        this.draftState.ui.currentBeadChain.beadIds.push(bead.id);\n      }\n    }\n  }\n\n  action_addBeadOnClick({ x, y }) {\n    // console.log(\"action_addBeadOnClick triggered\");\n    let defaultBead: Partial<Bead> = {\n      ...this.draftState.ui.beadsTemplate,\n    };\n    defaultBead.id = undefined;\n    defaultBead.position = buildPoint(x, y);\n    const bead = buildBead(defaultBead);\n    // console.log(\"??\", bead.width, bead.height);\n    bead.position.x = bead.position.x - bead.width / 2;\n    bead.position.y = bead.position.y - bead.height / 2;\n    this.draftState.appData.beads[bead.id] = bead;\n    // console.log(\"ile jest?\", Object.keys(this.draftState.appData.beads).length);\n    getEventEmitter().emit(\"action_addBeadOnClick\", { bead }, this.state);\n  }\n\n  action_addBeads_onMouseUp({ x, y }) {\n    this.draftState.ui.currentBeadChain.isDragEnabled = false;\n    this.draftState.ui.currentBeadChain.beadIds = [];\n  }\n}\n","import { Editor } from \"../editorObjects/Editor\";\n// import { ImmerReducer } from \"immer-reducer\";\nimport { buildBead } from \"../editorObjects/Bead\";\nimport { buildLine } from \"../editorObjects/Line\";\nimport { BeadSnapperImmerReducer } from \"./BeadSnapperImmerReducer\";\nimport { getEventEmitter } from \"../EventEmitter\";\n\nexport class PersistImmerReducer extends BeadSnapperImmerReducer {\n  action_onClearCanvas() {\n    this.draftState.appData.beads = {};\n    this.draftState.appData.lines = {};\n    this.draftState.ui.selectedBeadsIds = {};\n    this.draftState.ui.selectedBeadsIdsCount = 0;\n    this.draftState.ui.selectedLinesIds = {};\n    this.draftState.ui.selectedLinesIdsCount = 0;\n    this.draftState.ui.saveInfo.saved = false;\n    this.draftState.ui.saveInfo.haveUnsavedChanges = false;\n  }\n\n  action_readSavedCanvas() {\n    console.log(\"action_readSavedCanvas\");\n    // const startBeads = {};\n    for (let i = 0; i < 10 * 10; i = i + 10) {\n      for (let j = 0; j < 10 * 50; j = j + 10) {\n        const b1 = buildBead({\n          width: 8,\n          height: 8,\n          position: {\n            x: i,\n            y: j,\n          },\n        });\n        this.draftState.appData.beads[b1.id] = b1;\n      }\n    }\n\n    getEventEmitter().emit(\n      \"action_readSavedCanvas\",\n      this.draftState.appData,\n      this.state\n    );\n\n    // if (\"localStorage\" in window) {\n    //   this.draftState.ui.saveInfo.saved = true;\n    //   this.draftState.ui.saveInfo.haveUnsavedChanges = false;\n    //   const readedData = localStorage.getItem(\"appData\");\n    //   if (readedData !== null) {\n    //     try {\n    //       const cached = JSON.parse(readedData) as Editor[\"appData\"];\n    //       this.draftState.appData = {\n    //         beads: {},\n    //         lines: {},\n    //       };\n    //       Object.keys(cached.beads).forEach(beadId => {\n    //         const currBead = cached.beads[beadId];\n    //         const bead = buildBead(currBead);\n    //         this.draftState.appData.beads[beadId] = bead;\n    //       });\n    //       Object.keys(cached.lines).forEach(lineId => {\n    //         const currLine = cached.lines[lineId];\n    //         const line = buildLine(currLine);\n    //         this.draftState.appData.lines[lineId] = line;\n    //       });\n    //       Object.keys(this.draftState.appData.lines).forEach(lineId => {\n    //         this.updateBeadsPositions(lineId);\n    //       });\n    //       console.log(\"action_readSavedCanvas loaded\");\n    //     } catch (err) {\n    //       console.error(\"action_readSavedCanvas error: \", err);\n    //     }\n    //   } else {\n    //     console.info(\"No data in localstorage\");\n    //   }\n    // } else {\n    //   console.info(\"No localstorage available\");\n    // }\n  }\n\n  action_onSaveCanvas() {\n    if (\"localStorage\" in window) {\n      localStorage.setItem(\"appData\", JSON.stringify(this.draftState.appData));\n      this.draftState.ui.saveInfo.saved = true;\n      this.draftState.ui.saveInfo.haveUnsavedChanges = false;\n      console.log(\"action_onSaveCanvas saved\");\n    } else {\n      this.draftState.ui.saveInfo.saved = false;\n      console.info(\"No localstorage available\");\n    }\n  }\n}\n\n// const a = {\n//   beads: {\n//     \"a19AKjQX-\": {\n//       id: \"a19AKjQX-\",\n//       position: { x: 124.9038105676658, y: 49 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"KYwow-3r-\": {\n//       id: \"KYwow-3r-\",\n//       position: { x: 176.9038105676658, y: 49 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"8Zv9yoc3O\": {\n//       id: \"8Zv9yoc3O\",\n//       position: { x: 228.9038105676658, y: 49 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     Csyy61dk7: {\n//       id: \"Csyy61dk7\",\n//       position: { x: 280.9038105676658, y: 49 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"K9seOU-sZ\": {\n//       id: \"K9seOU-sZ\",\n//       position: { x: 332.9038105676658, y: 49 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"4OluG2val\": {\n//       id: \"4OluG2val\",\n//       position: { x: 384.9038105676658, y: 49 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     WyVILEjgG: {\n//       id: \"WyVILEjgG\",\n//       position: { x: 436.9038105676658, y: 49 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     oQ14N6Po8: {\n//       id: \"oQ14N6Po8\",\n//       position: { x: 98.92304845413263, y: 94 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     Av87g3peZ: {\n//       id: \"Av87g3peZ\",\n//       position: { x: 150.92304845413264, y: 94 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     I2UB_GTly: {\n//       id: \"I2UB_GTly\",\n//       position: { x: 202.92304845413264, y: 94 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     yGTQ4IT7l: {\n//       id: \"yGTQ4IT7l\",\n//       position: { x: 254.92304845413264, y: 94 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     sAXQ7hsQP: {\n//       id: \"sAXQ7hsQP\",\n//       position: { x: 306.92304845413264, y: 94 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     deV4qFK6b: {\n//       id: \"deV4qFK6b\",\n//       position: { x: 358.92304845413264, y: 94 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     VKyNP8c6Q: {\n//       id: \"VKyNP8c6Q\",\n//       position: { x: 410.92304845413264, y: 94 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     uwSd7QcQe: {\n//       id: \"uwSd7QcQe\",\n//       position: { x: 124.9038105676658, y: 139 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     fnAnxCx1i: {\n//       id: \"fnAnxCx1i\",\n//       position: { x: 176.9038105676658, y: 139 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     gZX7etv17: {\n//       id: \"gZX7etv17\",\n//       position: { x: 228.9038105676658, y: 139 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"0tH_CViDI\": {\n//       id: \"0tH_CViDI\",\n//       position: { x: 280.9038105676658, y: 139 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"8R3hzq0Kk\": {\n//       id: \"8R3hzq0Kk\",\n//       position: { x: 332.9038105676658, y: 139 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"4vauo8kt4\": {\n//       id: \"4vauo8kt4\",\n//       position: { x: 384.9038105676658, y: 139 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"ZqMNO9Q5-\": {\n//       id: \"ZqMNO9Q5-\",\n//       position: { x: 436.9038105676658, y: 139 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     wxjOD75mB: {\n//       id: \"wxjOD75mB\",\n//       position: { x: 98.92304845413263, y: 184 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     EyabW_7SH: {\n//       id: \"EyabW_7SH\",\n//       position: { x: 150.92304845413264, y: 184 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"QX-VSqWHJ\": {\n//       id: \"QX-VSqWHJ\",\n//       position: { x: 202.92304845413264, y: 184 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     YRjrowdYg: {\n//       id: \"YRjrowdYg\",\n//       position: { x: 254.92304845413264, y: 184 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     NwMuNbOKC: {\n//       id: \"NwMuNbOKC\",\n//       position: { x: 306.92304845413264, y: 184 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     Nia0xNTig: {\n//       id: \"Nia0xNTig\",\n//       position: { x: 358.92304845413264, y: 184 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"4t8McpTRT\": {\n//       id: \"4t8McpTRT\",\n//       position: { x: 410.92304845413264, y: 184 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     QZM85vE4H: {\n//       id: \"QZM85vE4H\",\n//       position: { x: 124.9038105676658, y: 229 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     m6NK9xpnJ: {\n//       id: \"m6NK9xpnJ\",\n//       position: { x: 176.9038105676658, y: 229 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"4SXetBeWL\": {\n//       id: \"4SXetBeWL\",\n//       position: { x: 228.9038105676658, y: 229 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     UhzJs0GPl: {\n//       id: \"UhzJs0GPl\",\n//       position: { x: 280.9038105676658, y: 229 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     yeLLzgEY6: {\n//       id: \"yeLLzgEY6\",\n//       position: { x: 332.9038105676658, y: 229 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     ZEU_ZVZik: {\n//       id: \"ZEU_ZVZik\",\n//       position: { x: 384.9038105676658, y: 229 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"5GbXtZC9B\": {\n//       id: \"5GbXtZC9B\",\n//       position: { x: 98.92304845413263, y: 274 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     N8qDr6L3f: {\n//       id: \"N8qDr6L3f\",\n//       position: { x: 150.92304845413264, y: 274 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"9IUytGuY1\": {\n//       id: \"9IUytGuY1\",\n//       position: { x: 202.92304845413264, y: 274 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     WPv1QJeJa: {\n//       id: \"WPv1QJeJa\",\n//       position: { x: 254.92304845413264, y: 274 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     dVhb5iUkr: {\n//       id: \"dVhb5iUkr\",\n//       position: { x: 306.92304845413264, y: 274 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     LlVZEDtJ9: {\n//       id: \"LlVZEDtJ9\",\n//       position: { x: 358.92304845413264, y: 274 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//     \"yQ-h8_tm0\": {\n//       id: \"yQ-h8_tm0\",\n//       position: { x: 410.92304845413264, y: 274 },\n//       type: \"BasicEllipse\",\n//       rotate: 0,\n//       lineRotate: 90,\n//       color: \"#4fc3f7\",\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: true,\n//     },\n//   },\n//   lines: {\n//     \"YaQ3-jOG\": {\n//       id: \"YaQ3-jOG\",\n//       start: { x: 124.90381056766579, y: 70 },\n//       end: { x: 540.5960043841962, y: 70 },\n//       beadIds: [\n//         \"a19AKjQX-\",\n//         \"KYwow-3r-\",\n//         \"8Zv9yoc3O\",\n//         \"Csyy61dk7\",\n//         \"K9seOU-sZ\",\n//         \"4OluG2val\",\n//         \"WyVILEjgG\",\n//       ],\n//       settings: {\n//         beadsCount: 7,\n//         beadsAutoCount: true,\n//         beadsSpacing: 0,\n//         beadsAutoSpacing: true,\n//         defaultBead: {\n//           id: \"dZjyRBQrH\",\n//           position: { x: 0, y: 0 },\n//           type: \"BasicEllipse\",\n//           rotate: 0,\n//           lineRotate: 0,\n//           color: \"#4fc3f7\",\n//           height: 52,\n//           width: 52,\n//           keepAspectRatio: true,\n//         },\n//       },\n//     },\n//     CRcLEam9P: {\n//       id: \"CRcLEam9P\",\n//       start: { x: 98.92304845413263, y: 115 },\n//       end: { x: 514.6152422706631, y: 115 },\n//       beadIds: [\n//         \"oQ14N6Po8\",\n//         \"Av87g3peZ\",\n//         \"I2UB_GTly\",\n//         \"yGTQ4IT7l\",\n//         \"sAXQ7hsQP\",\n//         \"deV4qFK6b\",\n//         \"VKyNP8c6Q\",\n//       ],\n//       settings: {\n//         beadsCount: 7,\n//         beadsAutoCount: true,\n//         beadsSpacing: 0,\n//         beadsAutoSpacing: true,\n//         defaultBead: {\n//           id: \"ILgHjX7En\",\n//           position: { x: 0, y: 0 },\n//           type: \"BasicEllipse\",\n//           rotate: 0,\n//           lineRotate: 0,\n//           color: \"#4fc3f7\",\n//           height: 52,\n//           width: 52,\n//           keepAspectRatio: true,\n//         },\n//       },\n//     },\n//     Tml7p6ZKI: {\n//       id: \"Tml7p6ZKI\",\n//       start: { x: 124.90381056766579, y: 160 },\n//       end: { x: 540.5960043841962, y: 160 },\n//       beadIds: [\n//         \"uwSd7QcQe\",\n//         \"fnAnxCx1i\",\n//         \"gZX7etv17\",\n//         \"0tH_CViDI\",\n//         \"8R3hzq0Kk\",\n//         \"4vauo8kt4\",\n//         \"ZqMNO9Q5-\",\n//       ],\n//       settings: {\n//         beadsCount: 7,\n//         beadsAutoCount: true,\n//         beadsSpacing: 0,\n//         beadsAutoSpacing: true,\n//         defaultBead: {\n//           id: \"ibloOzyTR\",\n//           position: { x: 0, y: 0 },\n//           type: \"BasicEllipse\",\n//           rotate: 0,\n//           lineRotate: 0,\n//           color: \"#4fc3f7\",\n//           height: 52,\n//           width: 52,\n//           keepAspectRatio: true,\n//         },\n//       },\n//     },\n//     Bq4W3C3Ew: {\n//       id: \"Bq4W3C3Ew\",\n//       start: { x: 98.92304845413263, y: 205 },\n//       end: { x: 514.6152422706631, y: 205 },\n//       beadIds: [\n//         \"wxjOD75mB\",\n//         \"EyabW_7SH\",\n//         \"QX-VSqWHJ\",\n//         \"YRjrowdYg\",\n//         \"NwMuNbOKC\",\n//         \"Nia0xNTig\",\n//         \"4t8McpTRT\",\n//       ],\n//       settings: {\n//         beadsCount: 7,\n//         beadsAutoCount: true,\n//         beadsSpacing: 0,\n//         beadsAutoSpacing: true,\n//         defaultBead: {\n//           id: \"w648Um7U6\",\n//           position: { x: 0, y: 0 },\n//           type: \"BasicEllipse\",\n//           rotate: 0,\n//           lineRotate: 0,\n//           color: \"#4fc3f7\",\n//           height: 52,\n//           width: 52,\n//           keepAspectRatio: true,\n//         },\n//       },\n//     },\n//     mJvdHpK60: {\n//       id: \"mJvdHpK60\",\n//       start: { x: 124.90381056766579, y: 250 },\n//       end: { x: 488.63448015713, y: 250 },\n//       beadIds: [\n//         \"QZM85vE4H\",\n//         \"m6NK9xpnJ\",\n//         \"4SXetBeWL\",\n//         \"UhzJs0GPl\",\n//         \"yeLLzgEY6\",\n//         \"ZEU_ZVZik\",\n//       ],\n//       settings: {\n//         beadsCount: 6,\n//         beadsAutoCount: true,\n//         beadsSpacing: 0,\n//         beadsAutoSpacing: true,\n//         defaultBead: {\n//           id: \"irTbjtCzJ\",\n//           position: { x: 0, y: 0 },\n//           type: \"BasicEllipse\",\n//           rotate: 0,\n//           lineRotate: 0,\n//           color: \"#4fc3f7\",\n//           height: 52,\n//           width: 52,\n//           keepAspectRatio: true,\n//         },\n//       },\n//     },\n//     pA1FF6_zm: {\n//       id: \"pA1FF6_zm\",\n//       start: { x: 98.92304845413263, y: 295 },\n//       end: { x: 514.6152422706631, y: 295 },\n//       beadIds: [\n//         \"5GbXtZC9B\",\n//         \"N8qDr6L3f\",\n//         \"9IUytGuY1\",\n//         \"WPv1QJeJa\",\n//         \"dVhb5iUkr\",\n//         \"LlVZEDtJ9\",\n//         \"yQ-h8_tm0\",\n//       ],\n//       settings: {\n//         beadsCount: 7,\n//         beadsAutoCount: true,\n//         beadsSpacing: 0,\n//         beadsAutoSpacing: true,\n//         defaultBead: {\n//           id: \"MtRiOzAsd\",\n//           position: { x: 0, y: 0 },\n//           type: \"BasicEllipse\",\n//           rotate: 0,\n//           lineRotate: 0,\n//           color: \"#4fc3f7\",\n//           height: 52,\n//           width: 52,\n//           keepAspectRatio: true,\n//         },\n//       },\n//     },\n//   },\n// };\n","import { Editor, EditorMode } from \"../editorObjects/Editor\";\nimport { ImmerReducer } from \"immer-reducer\";\n\nexport class ChangeEditorModeImmerReducer extends ImmerReducer<Editor> {\n  action_onChangeEditorMode(newEditorMode: EditorMode) {\n    this.draftState.mode = newEditorMode;\n    this.clearSelectedBeads();\n    this.clearSelectedLines();\n  }\n  private clearSelectedBeads = () => {\n    if (this.draftState.ui.selectedBeadsIdsCount > 0) {\n      this.draftState.ui.selectedBeadsIds = {};\n      this.draftState.ui.selectedBeadsIdsCount = 0;\n    }\n  };\n  private clearSelectedLines = () => {\n    if (this.draftState.ui.selectedLinesIdsCount) {\n      this.draftState.ui.selectedLinesIds = {};\n      this.draftState.ui.selectedLinesIdsCount = 0;\n    }\n  };\n  action_setSaveInfo(newValue: boolean) {\n    this.draftState.ui.saveInfo.saved = newValue;\n  }\n}\n","import { Editor } from \"../editorObjects/Editor\";\nimport { ImmerReducer } from \"immer-reducer\";\n\nexport class MainImmerReducer extends ImmerReducer<Editor> {\n  action_test() {}\n  action_restoreState() {}\n}\n","import { Editor } from \"../editorObjects/Editor\";\nimport { ImmerReducer } from \"immer-reducer\";\nimport { buildPoint } from \"../editorObjects/Point\";\nimport { contain } from \"../editorObjects/Point\";\nimport { getEventEmitter } from \"../EventEmitter\";\nimport _ from \"lodash\";\n// import { difference } from \"lodash\";\n\nexport class MouseSelectionImmerReducer extends ImmerReducer<Editor> {\n  action_onEditBeadsMouseDown(x, y) {\n    console.log(\"action_onEditBeadsMouseDown??\");\n    this.draftState.ui.mouseSelection.isDragStarted = true;\n\n    this.draftState.ui.mouseSelection.start.x = x;\n    this.draftState.ui.mouseSelection.start.y = y;\n    this.draftState.ui.mouseSelection.end.x = x;\n    this.draftState.ui.mouseSelection.end.y = y;\n  }\n\n  action_onEditBeadsMouseMove(x, y) {\n    console.log(\"action_onEditBeadsMouseMove??\");\n    this.draftState.ui.mouseSelection.end.x = x;\n    this.draftState.ui.mouseSelection.end.y = y;\n\n    if (this.draftState.ui.mouseSelection.isDragged === false) {\n      const { start, end } = this.draftState.ui.mouseSelection;\n      const deltaX = end.x - start.x;\n      const deltaY = end.y - start.y;\n\n      if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\n        this.draftState.ui.mouseSelection.isDragged = true;\n      }\n    }\n\n    if (this.draftState.ui.mouseSelection.isDragged === true) {\n      const { start, end } = this.draftState.ui.mouseSelection;\n      const p1 = buildPoint(Math.min(start.x, end.x), Math.min(start.y, end.y));\n      const p2 = buildPoint(Math.max(start.x, end.x), Math.max(start.y, end.y));\n\n      // const selectedIds = Object.keys(this.draftState.ui.selectedBeadsIds);\n      // const newIds: string[] = [];\n\n      // Object.keys(this.draftState.appData.beads).forEach(beadId => {\n      //   const bead = this.draftState.appData.beads[beadId];\n      //   const p3 = buildPoint(bead.position.x + 10, bead.position.y + 10);\n      //   if (contain(p1, p2, p3)) {\n      //     newIds.push(beadId);\n      //   }\n      // });\n\n      // const diff = difference(newIds, selectedIds);\n\n      // if (diff.length > 0) {\n      //   this.draftState.ui.selectedBeadsIds = {};\n      //   this.draftState.ui.selectedBeadsIdsCount = 0;\n      //   newIds.forEach(id => {\n      //     this.draftState.ui.selectedBeadsIds[id] = true;\n      //     this.draftState.ui.selectedBeadsIdsCount =\n      //       this.draftState.ui.selectedBeadsIdsCount + 1;\n      //   });\n      // }\n\n      this.draftState.ui.selectedBeadsIds = {};\n      this.draftState.ui.selectedBeadsIdsCount = 0;\n      Object.keys(this.draftState.appData.beads).forEach((beadId) => {\n        const bead = this.draftState.appData.beads[beadId];\n        const p3 = buildPoint(bead.position.x + 10, bead.position.y + 10);\n        if (contain(p1, p2, p3)) {\n          this.draftState.ui.selectedBeadsIds[beadId] = true;\n          this.draftState.ui.selectedBeadsIdsCount =\n            this.draftState.ui.selectedBeadsIdsCount + 1;\n        }\n      });\n    }\n  }\n\n  action_selectBeads(beadsIds: string[]) {\n    const prevSelectedIds = Object.keys(this.draftState.ui.selectedBeadsIds);\n\n    const diffIds = _.xor(prevSelectedIds, beadsIds);\n    const diffStates = diffIds.map((id) => {\n      if (prevSelectedIds.includes(id)) {\n        return { [id]: false };\n      } else {\n        return { [id]: true };\n      }\n    });\n\n    this.draftState.ui.selectedBeadsIds = {};\n    this.draftState.ui.selectedBeadsIdsCount = 0;\n    if (beadsIds.length > 0) {\n      Object.keys(this.draftState.appData.beads).forEach((beadId) => {\n        if (beadsIds.includes(beadId)) {\n          this.draftState.ui.selectedBeadsIds[beadId] = true;\n          this.draftState.ui.selectedBeadsIdsCount =\n            this.draftState.ui.selectedBeadsIdsCount + 1;\n        }\n      });\n    }\n\n    getEventEmitter().emit(\"action_selectBeads\", { diffStates }, this.state);\n  }\n\n  action_onEditBeadsMouseUp() {\n    if (this.draftState.ui.mouseSelection.isDragged === false) {\n      if (this.draftState.ui.selectedBeadsIdsCount > 0) {\n        this.draftState.ui.selectedBeadsIds = {};\n        this.draftState.ui.selectedBeadsIdsCount = 0;\n      }\n    }\n\n    this.draftState.ui.mouseSelection.isDragStarted = false;\n    this.draftState.ui.mouseSelection.isDragged = false;\n    this.draftState.ui.mouseSelection.start.x = 0;\n    this.draftState.ui.mouseSelection.start.y = 0;\n    this.draftState.ui.mouseSelection.end.x = 0;\n    this.draftState.ui.mouseSelection.end.y = 0;\n  }\n\n  action_onEditLinesMouseDown(x: number, y: number) {\n    this.draftState.ui.mouseSelection.isDragStarted = true;\n    this.draftState.ui.mouseSelection.start.x = x;\n    this.draftState.ui.mouseSelection.start.y = y;\n    this.draftState.ui.mouseSelection.end.x = x;\n    this.draftState.ui.mouseSelection.end.y = y;\n  }\n\n  action_onEditLinesMouseMove(x: number, y: number) {\n    this.draftState.ui.mouseSelection.end.x = x;\n    this.draftState.ui.mouseSelection.end.y = y;\n\n    if (this.draftState.ui.mouseSelection.isDragged === false) {\n      const { start, end } = this.draftState.ui.mouseSelection;\n      const deltaX = end.x - start.x;\n      const deltaY = end.y - start.y;\n      if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\n        this.draftState.ui.mouseSelection.isDragged = true;\n      }\n    }\n\n    if (this.draftState.ui.mouseSelection.isDragged === true) {\n      const { start, end } = this.draftState.ui.mouseSelection;\n      const p1 = buildPoint(Math.min(start.x, end.x), Math.min(start.y, end.y));\n      const p2 = buildPoint(Math.max(start.x, end.x), Math.max(start.y, end.y));\n\n      // const selectedIds = Object.keys(this.draftState.ui.selectedLinesIds);\n      // const newIds: string[] = [];\n\n      // Object.keys(this.draftState.appData.lines).forEach(lineId => {\n      //   const line = this.draftState.appData.lines[lineId];\n      //   if (contain(p1, p2, line.start) || contain(p1, p2, line.end)) {\n      //     newIds.push(lineId);\n      //   }\n      // });\n\n      // const diff = difference(newIds, selectedIds);\n\n      // if (diff.length > 0) {\n      //   this.draftState.ui.selectedLinesIds = {};\n      //   this.draftState.ui.selectedLinesIdsCount = 0;\n      //   newIds.forEach(id => {\n      //     this.draftState.ui.selectedLinesIds[id] = true;\n      //     this.draftState.ui.selectedLinesIdsCount =\n      //       this.draftState.ui.selectedLinesIdsCount + 1;\n      //   });\n      // }\n      this.draftState.ui.selectedLinesIds = {};\n      this.draftState.ui.selectedLinesIdsCount = 0;\n      Object.keys(this.draftState.appData.lines).forEach((lineId) => {\n        const line = this.draftState.appData.lines[lineId];\n        if (contain(p1, p2, line.start) || contain(p1, p2, line.end)) {\n          this.draftState.ui.selectedLinesIds[lineId] = true;\n          this.draftState.ui.selectedLinesIdsCount =\n            this.draftState.ui.selectedLinesIdsCount + 1;\n        }\n      });\n    }\n  }\n\n  action_onEditLinesMouseUp() {\n    if (this.draftState.ui.mouseSelection.isDragged === false) {\n      if (this.draftState.ui.selectedLinesIdsCount > 0) {\n        this.draftState.ui.selectedLinesIds = {};\n        this.draftState.ui.selectedLinesIdsCount = 0;\n      }\n    }\n\n    this.draftState.ui.mouseSelection.isDragStarted = false;\n    this.draftState.ui.mouseSelection.isDragged = false;\n    this.draftState.ui.mouseSelection.start.x = 0;\n    this.draftState.ui.mouseSelection.start.y = 0;\n    this.draftState.ui.mouseSelection.end.x = 0;\n    this.draftState.ui.mouseSelection.end.y = 0;\n  }\n}\n","import { BeadTypes } from \"../editorObjects/Editor\";\nimport { BeadSnapperImmerReducer } from \"./BeadSnapperImmerReducer\";\nimport { buildBead } from \"../editorObjects/Bead\";\nimport { buildLine } from \"../editorObjects/Line\";\nimport { merge } from \"lodash\";\nimport { getEventEmitter } from \"../EventEmitter\";\n\nexport class ToolbarImmerReducer extends BeadSnapperImmerReducer {\n  editorAppDataHasChanged() {\n    this.draftState.ui.saveInfo.saved = false;\n    this.draftState.ui.saveInfo.haveUnsavedChanges = true;\n  }\n  action_changeBeadFill(color: string) {\n    Object.keys(this.draftState.ui.selectedBeadsIds).forEach((beadId) => {\n      this.draftState.appData.beads[beadId].color = color;\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeBeadType(type: BeadTypes) {\n    Object.keys(this.draftState.ui.selectedBeadsIds).forEach((beadId) => {\n      this.draftState.appData.beads[beadId].type = type;\n    });\n    this.editorAppDataHasChanged();\n  }\n  action_onBeadRotate(beadId, { deg }) {}\n  action_onBeadsRotate({ deg }) {}\n\n  action_changeSelectedLinesBeadsSpacing(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].settings.beadsSpacing = value;\n      this.updateBeadsPositions(id);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLinesBeadsAutoSpacing(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].settings.beadsAutoSpacing = value;\n      this.updateBeadsPositions(id);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLinesBeadsCount(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].settings.beadsCount = value;\n      this.updateBeadsPositions(id);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLinesBeadsAutoCount(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].settings.beadsAutoCount = value;\n      this.updateBeadsPositions(id);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_resetSelectedLines() {\n    const firstLineId = Object.keys(this.draftState.ui.selectedLinesIds)[0];\n    const firstLine = this.draftState.appData.lines[firstLineId];\n    const defaultBead = { ...firstLine.settings.defaultBead };\n\n    defaultBead.id = undefined;\n    defaultBead.position = undefined;\n\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].beadIds.forEach((beadId) => {\n        if (defaultBead) {\n          this.draftState.appData.beads[beadId] = merge(\n            this.draftState.appData.beads[beadId],\n            defaultBead\n          );\n        }\n      });\n      this.draftState.appData.lines[id].settings.defaultBead = merge(\n        this.draftState.appData.lines[id].settings.defaultBead,\n        defaultBead\n      );\n      this.updateBeadsPositions(id);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_deleteSelectedLines() {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].beadIds.forEach((beadId) => {\n        delete this.draftState.appData.beads[beadId];\n      });\n      delete this.draftState.appData.lines[id];\n    });\n    this.draftState.ui.selectedLinesIds = {};\n    this.draftState.ui.selectedLinesIdsCount = 0;\n    this.editorAppDataHasChanged();\n  }\n\n  action_cloneSelectedLines() {\n    const moveX = 20;\n    const moveY = 20;\n    const newLinesIds: string[] = [];\n\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      const newLine = buildLine({\n        ...this.draftState.appData.lines[id],\n        id: undefined,\n        beadIds: [],\n      });\n      newLine.start.x = newLine.start.x + moveX;\n      newLine.start.y = newLine.start.y + moveY;\n      newLine.end.x = newLine.end.x + moveX;\n      newLine.end.y = newLine.end.y + moveY;\n\n      this.draftState.appData.lines[id].beadIds.forEach((beadId) => {\n        const newBead = buildBead({\n          ...this.draftState.appData.beads[beadId],\n          id: undefined,\n        });\n        newBead.position.x = newBead.position.x + moveX;\n        newBead.position.y = newBead.position.y + moveY;\n        this.draftState.appData.beads[newBead.id] = newBead;\n        newLine.beadIds.push(newBead.id);\n      });\n\n      newLinesIds.push(newLine.id);\n      this.draftState.appData.lines[newLine.id] = newLine;\n    });\n\n    newLinesIds.forEach((lineId) => {\n      this.updateBeadsPositions(lineId);\n    });\n\n    this.draftState.ui.selectedLinesIds = {};\n    this.draftState.ui.selectedLinesIdsCount = 0;\n\n    newLinesIds.forEach((lineId) => {\n      this.draftState.ui.selectedLinesIds[lineId] = true;\n      this.draftState.ui.selectedLinesIdsCount =\n        this.draftState.ui.selectedLinesIdsCount + 1;\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  /**\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   */\n\n  action_changeDefaultLineBeadsCount(value) {\n    if (this.draftState.ui.lineSettings.settings) {\n      this.draftState.ui.lineSettings.settings.beadsCount = value;\n    }\n  }\n\n  action_changeDefaultLineBeadsAutoCount(value) {\n    if (this.draftState.ui.lineSettings.settings) {\n      this.draftState.ui.lineSettings.settings.beadsAutoCount = value;\n    }\n  }\n\n  action_changeDefaultLineBeadsSpacing(value) {\n    if (this.draftState.ui.lineSettings.settings) {\n      this.draftState.ui.lineSettings.settings.beadsSpacing = value;\n    }\n  }\n\n  action_changeDefaultLineBeadsAutoSpacing(value) {\n    if (this.draftState.ui.lineSettings.settings) {\n      this.draftState.ui.lineSettings.settings.beadsAutoSpacing = value;\n    }\n  }\n\n  action_changeDefaultLineBeadType(value) {\n    if (this.draftState.ui.lineSettings.settings) {\n      if (this.draftState.ui.lineSettings.settings.defaultBead) {\n        this.draftState.ui.lineSettings.settings.defaultBead.type = value;\n      }\n    }\n  }\n\n  action_changeDefaultLineColor(value) {\n    if (this.draftState.ui.lineSettings.settings) {\n      if (this.draftState.ui.lineSettings.settings.defaultBead) {\n        this.draftState.ui.lineSettings.settings.defaultBead.color = value;\n      }\n    }\n  }\n\n  action_changeDefaultLineBeadHeight(value) {\n    const { lineSettings } = this.draftState.ui;\n    if (lineSettings.settings) {\n      if (lineSettings.settings.defaultBead) {\n        const {\n          width,\n          height,\n          keepAspectRatio,\n        } = lineSettings.settings.defaultBead;\n        if (keepAspectRatio && width && height) {\n          if (height >= 1) {\n            const ratio = width / height;\n            lineSettings.settings.defaultBead.width = value * ratio;\n            lineSettings.settings.defaultBead.height = value;\n          } else {\n            lineSettings.settings.defaultBead.height = 1;\n          }\n        } else {\n          lineSettings.settings.defaultBead.height = value;\n        }\n      }\n    }\n  }\n\n  action_changeDefaultLineBeadWidth(value) {\n    const { lineSettings } = this.draftState.ui;\n    if (lineSettings.settings) {\n      if (lineSettings.settings.defaultBead) {\n        const {\n          width,\n          height,\n          keepAspectRatio,\n        } = lineSettings.settings.defaultBead;\n        if (keepAspectRatio && width && height) {\n          if (width >= 1) {\n            const ratio = height / width;\n            lineSettings.settings.defaultBead.width = value;\n            lineSettings.settings.defaultBead.height = value * ratio;\n          } else {\n            lineSettings.settings.defaultBead.width = 1;\n          }\n        } else {\n          lineSettings.settings.defaultBead.width = value;\n        }\n      }\n    }\n  }\n\n  action_changeDefaultLineBeadKeepAspectRatio(value) {\n    const { lineSettings } = this.draftState.ui;\n    if (lineSettings.settings) {\n      if (lineSettings.settings.defaultBead) {\n        lineSettings.settings.defaultBead.keepAspectRatio = value;\n      }\n    }\n  }\n  action_changeDefaultLineBeadRotate(value) {\n    const { lineSettings } = this.draftState.ui;\n    if (lineSettings.settings) {\n      if (lineSettings.settings.defaultBead) {\n        lineSettings.settings.defaultBead.rotate = value;\n      }\n    }\n  }\n\n  /**\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   */\n\n  action_changeSelectedLines_settings_beadsCount(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].settings.beadsCount = value;\n      this.updateBeadsPositions(id);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLines_settings_beadsAutoCount(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].settings.beadsAutoCount = value;\n      this.updateBeadsPositions(id);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLines_settings_beadsSpacing(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].settings.beadsSpacing = value;\n      this.updateBeadsPositions(id);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLines_settings_beadsAutoSpacing(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((id) => {\n      this.draftState.appData.lines[id].settings.beadsAutoSpacing = value;\n      this.updateBeadsPositions(id);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLines_defaultBead_type(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((lineId) => {\n      this.draftState.appData.lines[lineId].settings.defaultBead.type = value;\n      this.draftState.appData.lines[lineId].beadIds.forEach((beadId) => {\n        this.draftState.appData.beads[beadId].type = value;\n      });\n      this.updateBeadsPositions(lineId);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLines_defaultBead_color(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((lineId) => {\n      this.draftState.appData.lines[lineId].settings.defaultBead.color = value;\n      this.draftState.appData.lines[lineId].beadIds.forEach((beadId) => {\n        this.draftState.appData.beads[beadId].color = value;\n      });\n      this.updateBeadsPositions(lineId);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLines_defaultBead_height(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((lineId) => {\n      const currLine = this.draftState.appData.lines[lineId];\n      let { width, height, keepAspectRatio } = currLine.settings.defaultBead;\n\n      if (keepAspectRatio === false) {\n        currLine.settings.defaultBead.height = value;\n        this.draftState.appData.lines[lineId].beadIds.forEach((beadId) => {\n          this.draftState.appData.beads[beadId].height = value;\n        });\n        this.updateBeadsPositions(lineId);\n      } else {\n        if (width && height) {\n          if (value >= 1) {\n            const ratio = width / height;\n            width = value * ratio;\n            height = value;\n          }\n\n          currLine.settings.defaultBead.width = width;\n          currLine.settings.defaultBead.height = height;\n        }\n\n        this.draftState.appData.lines[lineId].beadIds.forEach((beadId) => {\n          if (width && height) {\n            this.draftState.appData.beads[beadId].width = width;\n            this.draftState.appData.beads[beadId].height = height;\n          }\n        });\n\n        this.updateBeadsPositions(lineId);\n      }\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLines_defaultBead_width(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((lineId) => {\n      const currLine = this.draftState.appData.lines[lineId];\n      let { width, height, keepAspectRatio } = currLine.settings.defaultBead;\n\n      if (keepAspectRatio === false) {\n        currLine.settings.defaultBead.width = value;\n        this.draftState.appData.lines[lineId].beadIds.forEach((beadId) => {\n          this.draftState.appData.beads[beadId].width = value;\n        });\n        this.updateBeadsPositions(lineId);\n      } else {\n        if (width && height) {\n          if (value >= 1) {\n            const ratio = height / width;\n            width = value;\n            height = value * ratio;\n          }\n\n          currLine.settings.defaultBead.width = width;\n          currLine.settings.defaultBead.height = height;\n        }\n\n        this.draftState.appData.lines[lineId].beadIds.forEach((beadId) => {\n          if (width && height) {\n            this.draftState.appData.beads[beadId].width = width;\n            this.draftState.appData.beads[beadId].height = height;\n          }\n        });\n\n        this.updateBeadsPositions(lineId);\n      }\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLines_defaultBead_keepAspectRatio(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((lineId) => {\n      this.draftState.appData.lines[\n        lineId\n      ].settings.defaultBead.keepAspectRatio = value;\n      this.draftState.appData.lines[lineId].beadIds.forEach((beadId) => {\n        this.draftState.appData.beads[beadId].keepAspectRatio = value;\n      });\n      this.updateBeadsPositions(lineId);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  action_changeSelectedLines_defaultBead_rotate(value) {\n    Object.keys(this.draftState.ui.selectedLinesIds).forEach((lineId) => {\n      this.draftState.appData.lines[lineId].settings.defaultBead.rotate = value;\n      this.draftState.appData.lines[lineId].beadIds.forEach((beadId) => {\n        this.draftState.appData.beads[beadId].rotate = value;\n      });\n      this.updateBeadsPositions(lineId);\n    });\n    this.editorAppDataHasChanged();\n  }\n\n  /****\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   */\n\n  action_changeSelectedBeads_type(value) {\n    Object.keys(this.draftState.ui.selectedBeadsIds).forEach((beadId) => {\n      this.draftState.appData.beads[beadId].type = value;\n    });\n    this.updateLineFromSelectedBeads();\n  }\n\n  action_changeSelectedBeads_color(value) {\n    Object.keys(this.draftState.ui.selectedBeadsIds).forEach((beadId) => {\n      this.draftState.appData.beads[beadId].color = value;\n    });\n    getEventEmitter().emit(\n      \"action_changeSelectedBeads_color\",\n      {\n        beadIds: Object.keys(this.draftState.ui.selectedBeadsIds),\n        color: value,\n      },\n      this.state\n    );\n    this.updateLineFromSelectedBeads();\n  }\n\n  action_changeSelectedBeads_height(value) {\n    Object.keys(this.draftState.ui.selectedBeadsIds).forEach((beadId) => {\n      const currBead = this.draftState.appData.beads[beadId];\n      let { width, height, keepAspectRatio } = currBead;\n\n      if (keepAspectRatio === false) {\n        this.draftState.appData.beads[beadId].height = value;\n      } else {\n        if (width && height) {\n          if (value >= 1) {\n            const ratio = width / height;\n            width = value * ratio;\n            height = value;\n          }\n        }\n        this.draftState.appData.beads[beadId].width = width;\n        this.draftState.appData.beads[beadId].height = height;\n      }\n    });\n\n    this.updateLineFromSelectedBeads();\n  }\n\n  action_changeSelectedBeads_width(value) {\n    Object.keys(this.draftState.ui.selectedBeadsIds).forEach((beadId) => {\n      const currBead = this.draftState.appData.beads[beadId];\n      let { width, height, keepAspectRatio } = currBead;\n\n      if (keepAspectRatio === false) {\n        this.draftState.appData.beads[beadId].width = value;\n      } else {\n        if (width && height) {\n          if (value >= 1) {\n            const ratio = height / width;\n            width = value;\n            height = value * ratio;\n          }\n        }\n        this.draftState.appData.beads[beadId].width = width;\n        this.draftState.appData.beads[beadId].height = height;\n      }\n    });\n\n    this.updateLineFromSelectedBeads();\n  }\n\n  action_changeSelectedBeads_keepAspectRatio(value) {\n    Object.keys(this.draftState.ui.selectedBeadsIds).forEach((beadId) => {\n      this.draftState.appData.beads[beadId].keepAspectRatio = value;\n    });\n    this.updateLineFromSelectedBeads();\n  }\n\n  action_changeSelectedBeads_rotate(value) {\n    Object.keys(this.draftState.ui.selectedBeadsIds).forEach((beadId) => {\n      this.draftState.appData.beads[beadId].rotate = value;\n    });\n    this.updateLineFromSelectedBeads();\n  }\n\n  updateLineFromSelectedBeads() {\n    const results: string[] = [];\n    Object.keys(this.draftState.ui.selectedBeadsIds).forEach((beadId) => {\n      for (const lineId of Object.keys(this.draftState.appData.lines)) {\n        if (\n          this.draftState.appData.lines[lineId].beadIds.indexOf(beadId) !== -1\n        ) {\n          if (results.indexOf(lineId) === -1) {\n            results.push(lineId);\n            break;\n          }\n        }\n      }\n    });\n    for (const lineId of results) {\n      this.updateBeadsPositions(lineId);\n    }\n  }\n\n  /****\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   *\n   */\n\n  action_updateBrushSize(value) {\n    this.draftState.ui.brush.size = value;\n  }\n\n  action_updateBrushColor(value) {\n    this.draftState.ui.brush.color = value;\n  }\n\n  action_updateBeadsTemplate(key: string, value: any) {\n    if (this.draftState.ui.beadsTemplate[key] !== undefined) {\n      let { keepAspectRatio, width, height } = this.draftState.ui.beadsTemplate;\n\n      if (keepAspectRatio === true) {\n        if (key === \"width\") {\n          if (value >= 1) {\n            const ratio = height / width;\n            height = value * ratio;\n          }\n          this.draftState.ui.beadsTemplate.height = height;\n        }\n        if (key === \"height\") {\n          if (value >= 1) {\n            const ratio = width / height;\n            width = value * ratio;\n          }\n          this.draftState.ui.beadsTemplate.width = width;\n        }\n      }\n\n      this.draftState.ui.beadsTemplate[key] = value;\n    } else {\n      console.warn(`action_updateBeadsTemplate: key dont exists ${key}`);\n    }\n  }\n}\n","import { Editor, EditorMenuMain } from \"../editorObjects/Editor\";\nimport { ImmerReducer } from \"immer-reducer\";\nimport { buildPoint } from \"../editorObjects/Point\";\n\nexport class TopbarImmerReducer extends ImmerReducer<Editor> {\n  action_toggleMenuFile() {\n    if (this.draftState.ui.currentMenuMainOpen === EditorMenuMain.File) {\n      this.draftState.ui.currentMenuMainOpen = EditorMenuMain.None;\n    } else {\n      this.draftState.ui.currentMenuMainOpen = EditorMenuMain.File;\n    }\n  }\n  action_toggleMenuSettings() {\n    if (this.draftState.ui.currentMenuMainOpen === EditorMenuMain.Grid) {\n      this.draftState.ui.currentMenuMainOpen = EditorMenuMain.None;\n    } else {\n      this.draftState.ui.currentMenuMainOpen = EditorMenuMain.Grid;\n    }\n  }\n  action_toggleMenuBackground() {\n    if (this.draftState.ui.currentMenuMainOpen === EditorMenuMain.Background) {\n      this.draftState.ui.currentMenuMainOpen = EditorMenuMain.None;\n    } else {\n      this.draftState.ui.currentMenuMainOpen = EditorMenuMain.Background;\n    }\n  }\n  action_toggleGridSnapEnabled() {\n    this.draftState.ui.grid.snapEnabled = !this.draftState.ui.grid.snapEnabled;\n  }\n  action_toggleGridIsVisible() {\n    this.draftState.ui.grid.isVisible = !this.draftState.ui.grid.isVisible;\n  }\n  action_setGridWidth(value) {\n    this.draftState.ui.grid.width = value;\n  }\n  action_setGridHeight(value) {\n    this.draftState.ui.grid.height = value;\n  }\n  action_setGridType(value) {\n    this.draftState.ui.grid.type = value;\n  }\n  action_setGridHexSize(value) {\n    this.draftState.ui.grid.hexSize = value;\n  }\n\n  action_background_image_clear() {\n    this.draftState.ui.background.image.position = buildPoint(0, 0);\n    this.draftState.ui.background.image.scale = 1;\n    this.draftState.ui.background.image.url = \"\";\n  }\n  action_background_image_upload(value) {\n    this.draftState.ui.background.image.url = value;\n  }\n  action_background_image_pointX(value) {\n    this.draftState.ui.background.image.position.x = value;\n  }\n  action_background_image_pointY(value) {\n    this.draftState.ui.background.image.position.y = value;\n  }\n  action_background_image_scale(value) {\n    this.draftState.ui.background.image.scale = value;\n  }\n  action_background_image_opacity(value) {\n    this.draftState.ui.background.image.opacity = value;\n  }\n  \n}\n","import { Editor, BrushType } from \"../editorObjects/Editor\";\nimport { ImmerReducer } from \"immer-reducer\";\nimport { getDistanceBetweenPoints, buildPoint } from \"../editorObjects/Point\";\n\nexport class PaintImmerReducer extends ImmerReducer<Editor> {\n  action_applyColorBrush(x, y) {\n    const { color, type, size } = this.draftState.ui.brush;\n    if (type === BrushType.Color) {\n      const mousePoint = buildPoint(x + size / 2, y + size /2);\n      Object.keys(this.draftState.appData.beads).forEach(beadId => {\n        const currBead = this.draftState.appData.beads[beadId];\n        if (currBead.color !== color) {\n          const centerPoint = buildPoint(\n            currBead.position.x + currBead.width / 2,\n            currBead.position.y + currBead.height / 2\n          );\n          const len = getDistanceBetweenPoints(centerPoint, mousePoint);\n          const brush = size / 2 + Math.min(currBead.width , currBead.height) / 2;\n          if (len < brush) {\n            this.draftState.appData.beads[beadId].color = color;\n          }\n        }\n      });\n    }\n  }\n}\n","import {\n  Editor,\n  EditorMode,\n  BeadTypes,\n  EditorMenuMain,\n  EditorGridType,\n  BrushType,\n} from \"../editorObjects/Editor\";\nimport { Reducer } from \"redux\";\nimport { buildPoint } from \"../editorObjects/Point\";\nimport { composeReducers } from \"immer-reducer\";\nimport { createActionCreators, createReducerFunction } from \"immer-reducer\";\nimport { DraggableOperationsImmerReducer } from \"./DraggableOperationsImmerReducer\";\nimport { PersistImmerReducer } from \"./PersistImmerReducer\";\nimport { ChangeEditorModeImmerReducer } from \"./ChangeEditorModeImmerReducer\";\nimport { MainImmerReducer } from \"./MainImmerReducer\";\nimport { MouseSelectionImmerReducer } from \"./MouseSelectionImmerReducer\";\nimport { ToolbarImmerReducer } from \"./ToolbarImmerReducer\";\nimport { defaulBeadColor } from \"../components/colors\";\nimport { TopbarImmerReducer } from \"./TopbarImmerReducer\";\nimport { PaintImmerReducer } from \"./PaintImmerReducer\";\nimport { buildBead } from \"../editorObjects/Bead\";\nimport { produce } from \"immer\";\nimport { getEventEmitter } from \"../EventEmitter\";\n\nconst defaultBead = buildBead({});\n\n\nconst defaultAppData: Editor = {\n  appData: {\n    beads: {},\n    lines: {},\n  },\n  ui: {\n    lineSettings: {\n      settings: {\n        beadsAutoCount: true,\n        beadsAutoSpacing: true,\n        beadsCount: 0,\n        beadsSpacing: 0,\n        defaultBead: {\n          type: BeadTypes.BasicEllipse,\n          rotate: 0,\n          color: defaulBeadColor,\n          height: 52,\n          width: 52,\n          keepAspectRatio: false,\n        },\n      },\n    },\n    saveInfo: {\n      saved: false,\n      haveUnsavedChanges: false,\n    },\n    selectedLinesIds: {},\n    selectedLinesIdsCount: 0,\n    selectedBeadsIds: {},\n    selectedBeadsIdsCount: 0,\n    mouseSelection: {\n      start: buildPoint(0, 0),\n      end: buildPoint(0, 0),\n      isDragStarted: false,\n      isDragged: false,\n    },\n    currentMenuMainOpen: EditorMenuMain.None,\n    grid: {\n      type: EditorGridType.Hex,\n      hexSize: 30,\n      snapEnabled: true,\n      isVisible: true,\n      width: 30,\n      height: 30,\n    },\n    brush: {\n      type: BrushType.Color,\n      size: 50,\n      color: defaulBeadColor,\n    },\n    background: {\n      image: {\n        url: \"\",\n        scale: 1,\n        position: buildPoint(0, 0),\n        opacity: 0.5,\n      },\n    },\n    beadsTemplate: {\n      color: defaultBead.color,\n      width: defaultBead.width,\n      height: defaultBead.height,\n      keepAspectRatio: defaultBead.keepAspectRatio,\n      rotate: defaultBead.rotate,\n      type: defaultBead.type,\n    },\n    currentBeadChain: {\n      isDragEnabled: false,\n      beadIds: [],\n    },\n    sceneWrapperWidth: 0,\n    sceneWrapperHeight: 0,\n    sceneWrapperPosition: {\n      x: 0,\n      y: 0,\n      angle: 0,\n      scale: 0,\n      top: 0,\n      left: 0,\n    },\n  },\n  mode: EditorMode.Idle,\n};\n\nexport const Actions = {\n  Main: createActionCreators(MainImmerReducer),\n  Draggable: createActionCreators(DraggableOperationsImmerReducer),\n  Persist: createActionCreators(PersistImmerReducer),\n  ChangeEditorMode: createActionCreators(ChangeEditorModeImmerReducer),\n  MouseSelection: createActionCreators(MouseSelectionImmerReducer),\n  Toolbar: createActionCreators(ToolbarImmerReducer),\n  Topbar: createActionCreators(TopbarImmerReducer),\n  Paint: createActionCreators(PaintImmerReducer),\n};\n\nconst eventEmitter = getEventEmitter();\n\nconst reducerForEventEmitter = produce((state, action) => {\n  eventEmitter.emit(action.type, action.payload, state);\n}, {});\n\nexport const store = composeReducers(\n  createReducerFunction(MainImmerReducer, defaultAppData),\n  createReducerFunction(DraggableOperationsImmerReducer, defaultAppData),\n  createReducerFunction(PersistImmerReducer, defaultAppData),\n  createReducerFunction(ToolbarImmerReducer, defaultAppData),\n  createReducerFunction(TopbarImmerReducer, defaultAppData),\n  createReducerFunction(ChangeEditorModeImmerReducer, defaultAppData),\n  createReducerFunction(MouseSelectionImmerReducer, defaultAppData),\n  createReducerFunction(PaintImmerReducer, defaultAppData),\n  reducerForEventEmitter\n);\n","import React from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faPlus,\n  faEdit,\n  faArrowsAlt,\n  faPaintBrush\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { EditorMode } from \"../../editorObjects/Editor\";\nimport { uiButton } from \"../colors\";\nimport { useDispatch } from \"react-redux\";\nimport { Actions } from \"../../immerReducers/store\";\n\nexport const EditorModes = ({ editorMode }) => {\n  const dispatch = useDispatch();\n\n  const onChangeEditorMode = (newEditorMode: EditorMode) => {\n    dispatch(Actions.ChangeEditorMode.action_onChangeEditorMode(newEditorMode));\n  };\n\n  return (\n    <div className=\"\">\n      <StateButton\n        label={\"Idle\"}\n        icon={<FontAwesomeIcon icon={faArrowsAlt} color={uiButton} />}\n        onClick={() => onChangeEditorMode(EditorMode.Idle)}\n        isSelected={editorMode === EditorMode.Idle}\n      />\n\n      {/* <StateButton\n        label={\"Edit Lines\"}\n        icon={<FontAwesomeIcon icon={faEdit} color={uiButton} />}\n        onClick={() => onChangeEditorMode(EditorMode.EditLines)}\n        isSelected={editorMode === EditorMode.EditLines}\n      /> */}\n\n      <StateButton\n        label={\"Edit\"}\n        icon={<FontAwesomeIcon icon={faEdit} color={uiButton} />}\n        onClick={() => onChangeEditorMode(EditorMode.EditBeads)}\n        isSelected={editorMode === EditorMode.EditBeads}\n      />\n\n      {/* <StateButton\n        label={\"AddLine\"}\n        icon={<FontAwesomeIcon icon={faPlus} color={uiButton} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddLine)}\n        isSelected={editorMode === EditorMode.AddLine}\n      /> */}\n\n      <StateButton\n        label={\"Add\"}\n        icon={<FontAwesomeIcon icon={faPaintBrush} color={uiButton} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddBeads)}\n        isSelected={editorMode === EditorMode.AddBeads}\n      />\n\n      <StateButton\n        label={\"Paint\"}\n        icon={<FontAwesomeIcon icon={faPaintBrush} color={uiButton} />}\n        onClick={() => onChangeEditorMode(EditorMode.PaintBeads)}\n        isSelected={editorMode === EditorMode.PaintBeads}\n      />\n\n      <StateButton\n        label={\"Delete\"}\n        icon={<FontAwesomeIcon icon={faPaintBrush} color={uiButton} />}\n        onClick={() => onChangeEditorMode(EditorMode.DeleteBeads)}\n        isSelected={editorMode === EditorMode.DeleteBeads}\n      />\n    </div>\n  );\n};\n\nconst StateButton = ({ label, isSelected, onClick, icon }) => {\n  return (\n    <div\n      className={`\n              button \n              ${isSelected ? \"is-active\" : \"\"}\n            `}\n      onClick={onClick}\n    >\n      <span className=\"icon is-small\">{icon}</span>\n      <span>{label}</span>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Bead, BeadTypes } from \"../../editorObjects/Editor\";\nimport { getTranslate3dCss } from \"../operations/MapValuesToCss\";\nimport { Actions } from \"../../immerReducers/store\";\nimport { useDispatch } from \"react-redux\";\n\nexport const DisplayBead = (props: {\n  bead: Bead;\n  opacity?: number;\n  zIndex?: number;\n  isSelected: boolean;\n  isSelectable: boolean;\n}) => {\n  const { bead, opacity, zIndex, isSelected, isSelectable } = props;\n  const isOpacity = opacity !== undefined && opacity >= 0 && opacity <= 1;\n  const isZindex = zIndex !== undefined && zIndex >= 0 && zIndex <= 9999;\n\n  const dispatch = useDispatch();\n  const onClick = () => {\n    if (isSelectable) {\n      dispatch(Actions.Draggable.action_onClickBead(bead.id));\n    }\n  };\n\n  const translate3d = getTranslate3dCss(bead.position.x, bead.position.y);\n  const rotate = bead.rotate + bead.lineRotate;\n  const rotateCss = !rotate ? \"rotateZ(0deg)\" : `rotateZ(${rotate}deg)`;\n  let styles: React.CSSProperties = {\n    transform: `${translate3d} ${rotateCss}`,\n    opacity: isOpacity ? opacity : 1,\n    zIndex: isZindex ? zIndex : undefined,\n    border: isSelected ? \"1px solid #000\" : \"\",\n    width: `${bead.width}px`,\n    height: `${bead.height}px`,\n    background: bead.color\n  };\n\n  if (bead.type === BeadTypes.BasicEllipse) {\n    styles.borderRadius = \"100%\";\n  }\n\n  return (\n    <div className=\"bead-item\" onClick={onClick} style={styles}>\n      &nbsp;\n    </div>\n  );\n};\n","export const getTranslate3dCss = (x, y, z = 1) => {\n  return `translate3d(${x}px, ${y}px, ${z}px)`;\n};\n\nexport const getRotateCss = rotate => {\n  return `rotate(${rotate}rad)`;\n};\n","import React from \"react\";\nimport { DisplayBead } from \"../../Bead/DisplayBead\";\nimport { buildBead } from \"../../../editorObjects/Bead\";\nimport { buildPoint } from \"../../../editorObjects/Point\";\n\nexport const FieldBeadPreview = ({ bead }) => {\n  const displayBead = buildBead({\n    ...bead,\n    position: buildPoint(0, 0),\n  });\n  return (\n    <div\n      style={{\n        marginTop: \"20px\",\n        marginBottom: \"20px\",\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        height: \"100px\",\n        boxSizing: \"border-box\",\n      }}\n    >\n      <div\n        style={{\n          position: \"relative\",\n          top: `${(-1 * bead.height) / 2}px`,\n          left: `${(-1 * bead.width) / 2}px`,\n        }}\n      >\n        <DisplayBead\n          bead={displayBead}\n          isSelected={false}\n          isSelectable={false}\n        />\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\n\nexport const ToolbarField = ({ label, icon, value, onToggle }) => {\n  return (\n    <div\n      className={\"fieldset\"}\n      onClick={onToggle}\n      style={{ cursor: \"pointer\" }}\n    >\n      <div className=\"label\">\n        {icon ? (\n          <div\n            style={{\n              width: \"30px\",\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\",\n              height: \"30px\",\n              marginRight: \"10px\",\n            }}\n          >\n            {icon}\n          </div>\n        ) : null}\n        {label ? <div>{label}</div> : null}\n      </div>\n\n      <div\n        style={{\n          display: \"flex\",\n          flexDirection: \"row\",\n          justifyContent: \"flex-end\",\n          alignItems: \"center\",\n          boxSizing: \"border-box\",\n          paddingLeft: \"10px\",\n          paddingRight: \"20px\",\n          width: \"100%\",\n        }}\n      >\n        <div>{value !== undefined ? value : \"-\"}</div>\n      </div>\n    </div>\n  );\n};\n","import React, { useState } from \"react\";\nimport { ToolbarField } from \"./ToolbarField\";\n\nexport const ToolbarFieldSet = ({ selected, label, icon, children }) => {\n  const [isPickerOpen, setIsPickerOpen] = useState(false);\n  const onToggle = () => {\n    setIsPickerOpen(!isPickerOpen);\n  };\n  return (\n    <div\n      style={{\n        // borderBottom: \"1px solid #dfdfdf\",\n        borderTop: \"1px solid #dfdfdf\",\n      }}\n    >\n      <ToolbarField\n        label={label}\n        onToggle={onToggle}\n        icon={icon}\n        value={selected}\n      />\n\n      {isPickerOpen === true ? (\n        <div style={{ background: \"#fff\" }}>{React.cloneElement(children)}</div>\n      ) : null}\n    </div>\n  );\n};\n","import React from \"react\";\nimport * as material from \"material-colors\";\n\nexport const FieldColorPicker = ({ value, onChange, ...props }) => {\n  const colors = [\n    [\n      material.red[\"900\"],\n      material.red[\"700\"],\n      material.red[\"500\"],\n      material.red[\"300\"],\n      material.red[\"100\"],\n    ],\n    [\n      material.pink[\"900\"],\n      material.pink[\"700\"],\n      material.pink[\"500\"],\n      material.pink[\"300\"],\n      material.pink[\"100\"],\n    ],\n    [\n      material.purple[\"900\"],\n      material.purple[\"700\"],\n      material.purple[\"500\"],\n      material.purple[\"300\"],\n      material.purple[\"100\"],\n    ],\n    [\n      material.deepPurple[\"900\"],\n      material.deepPurple[\"700\"],\n      material.deepPurple[\"500\"],\n      material.deepPurple[\"300\"],\n      material.deepPurple[\"100\"],\n    ],\n    [\n      material.indigo[\"900\"],\n      material.indigo[\"700\"],\n      material.indigo[\"500\"],\n      material.indigo[\"300\"],\n      material.indigo[\"100\"],\n    ],\n    [\n      material.blue[\"900\"],\n      material.blue[\"700\"],\n      material.blue[\"500\"],\n      material.blue[\"300\"],\n      material.blue[\"100\"],\n    ],\n    [\n      material.lightBlue[\"900\"],\n      material.lightBlue[\"700\"],\n      material.lightBlue[\"500\"],\n      material.lightBlue[\"300\"],\n      material.lightBlue[\"100\"],\n    ],\n    [\n      material.cyan[\"900\"],\n      material.cyan[\"700\"],\n      material.cyan[\"500\"],\n      material.cyan[\"300\"],\n      material.cyan[\"100\"],\n    ],\n    [\n      material.teal[\"900\"],\n      material.teal[\"700\"],\n      material.teal[\"500\"],\n      material.teal[\"300\"],\n      material.teal[\"100\"],\n    ],\n    [\n      \"#194D33\",\n      material.green[\"700\"],\n      material.green[\"500\"],\n      material.green[\"300\"],\n      material.green[\"100\"],\n    ],\n    [\n      material.lightGreen[\"900\"],\n      material.lightGreen[\"700\"],\n      material.lightGreen[\"500\"],\n      material.lightGreen[\"300\"],\n      material.lightGreen[\"100\"],\n    ],\n    [\n      material.lime[\"900\"],\n      material.lime[\"700\"],\n      material.lime[\"500\"],\n      material.lime[\"300\"],\n      material.lime[\"100\"],\n    ],\n    [\n      material.yellow[\"900\"],\n      material.yellow[\"700\"],\n      material.yellow[\"500\"],\n      material.yellow[\"300\"],\n      material.yellow[\"100\"],\n    ],\n    [\n      material.amber[\"900\"],\n      material.amber[\"700\"],\n      material.amber[\"500\"],\n      material.amber[\"300\"],\n      material.amber[\"100\"],\n    ],\n    [\n      material.orange[\"900\"],\n      material.orange[\"700\"],\n      material.orange[\"500\"],\n      material.orange[\"300\"],\n      material.orange[\"100\"],\n    ],\n    [\n      material.deepOrange[\"900\"],\n      material.deepOrange[\"700\"],\n      material.deepOrange[\"500\"],\n      material.deepOrange[\"300\"],\n      material.deepOrange[\"100\"],\n    ],\n    [\n      material.brown[\"900\"],\n      material.brown[\"700\"],\n      material.brown[\"500\"],\n      material.brown[\"300\"],\n      material.brown[\"100\"],\n    ],\n    [\n      material.blueGrey[\"900\"],\n      material.blueGrey[\"700\"],\n      material.blueGrey[\"500\"],\n      material.blueGrey[\"300\"],\n      material.blueGrey[\"100\"],\n    ],\n    [\"#000000\", \"#525252\", \"#969696\", \"#D9D9D9\", \"#FFFFFF\"],\n  ];\n  return (\n    <div\n      style={{\n        width: \"100%\",\n        paddingTop: \"20px\",\n        paddingBottom: \"30px\",\n        paddingLeft: \"20px\",\n        paddingRight: \"20px\",\n      }}\n    >\n      <DisplayColorsGroup colors={colors} onClick={onChange} />\n      {/* <CirclePicker\n        color={value}\n        onChangeComplete={color => onChange(color.hex)}\n        colors={[\"#000\"]}\n      /> */}\n      {/* <SwatchesPicker\n        width={258}\n        height={240}\n        onChangeComplete={color => onChange(color.hex)}\n        color={value}\n      /> */}\n    </div>\n  );\n};\n\nconst DisplayColorsGroup = ({ colors, onClick }) => {\n  return (\n    <div>\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"flex-start\",\n          alignItems: \"center\",\n          flexWrap: \"wrap\",\n        }}\n      >\n        {colors.map(group => {\n          return (\n            <div key={group.toString()} style={{ marginBottom: \"10px\" }}>\n              {group.map(color => {\n                return (\n                  <div\n                    key={color}\n                    style={{\n                      cursor: \"pointer\",\n                      border: \"3px solid transparent\",\n                      boxSizing: \"border-box\",\n                    }}\n                  >\n                    <div\n                      onClick={() => onClick(color)}\n                      style={{\n                        boxSizing: \"border-box\",\n                        background: color,\n                        width: \"28px\",\n                        height: \"28px\",\n                        borderRadius: \"100%\",\n                        border: \"none\",\n                      }}\n                    />\n                  </div>\n                );\n              })}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n\n\n// const colors = [\n//   material.red[\"900\"],\n//   material.red[\"700\"],\n//   material.red[\"500\"],\n//   material.red[\"300\"],\n//   material.red[\"100\"],\n//   material.pink[\"900\"],\n//   material.pink[\"700\"],\n//   material.pink[\"500\"],\n//   material.pink[\"300\"],\n//   material.pink[\"100\"],\n//   material.purple[\"900\"],\n//   material.purple[\"700\"],\n//   material.purple[\"500\"],\n//   material.purple[\"300\"],\n//   material.purple[\"100\"],\n//   material.deepPurple[\"900\"],\n//   material.deepPurple[\"700\"],\n//   material.deepPurple[\"500\"],\n//   material.deepPurple[\"300\"],\n//   material.deepPurple[\"100\"],\n//   material.indigo[\"900\"],\n//   material.indigo[\"700\"],\n//   material.indigo[\"500\"],\n//   material.indigo[\"300\"],\n//   material.indigo[\"100\"],\n//   material.blue[\"900\"],\n//   material.blue[\"700\"],\n//   material.blue[\"500\"],\n//   material.blue[\"300\"],\n//   material.blue[\"100\"],\n//   material.lightBlue[\"900\"],\n//   material.lightBlue[\"700\"],\n//   material.lightBlue[\"500\"],\n//   material.lightBlue[\"300\"],\n//   material.lightBlue[\"100\"],\n//   material.cyan[\"900\"],\n//   material.cyan[\"700\"],\n//   material.cyan[\"500\"],\n//   material.cyan[\"300\"],\n//   material.cyan[\"100\"],\n//   material.teal[\"900\"],\n//   material.teal[\"700\"],\n//   material.teal[\"500\"],\n//   material.teal[\"300\"],\n//   material.teal[\"100\"],\n//   \"#194D33\",\n//   material.green[\"700\"],\n//   material.green[\"500\"],\n//   material.green[\"300\"],\n//   material.green[\"100\"],\n//   material.lightGreen[\"900\"],\n//   material.lightGreen[\"700\"],\n//   material.lightGreen[\"500\"],\n//   material.lightGreen[\"300\"],\n//   material.lightGreen[\"100\"],\n//   material.lime[\"900\"],\n//   material.lime[\"700\"],\n//   material.lime[\"500\"],\n//   material.lime[\"300\"],\n//   material.lime[\"100\"],\n//   material.yellow[\"900\"],\n//   material.yellow[\"700\"],\n//   material.yellow[\"500\"],\n//   material.yellow[\"300\"],\n//   material.yellow[\"100\"],\n//   material.amber[\"900\"],\n//   material.amber[\"700\"],\n//   material.amber[\"500\"],\n//   material.amber[\"300\"],\n//   material.amber[\"100\"],\n//   material.orange[\"900\"],\n//   material.orange[\"700\"],\n//   material.orange[\"500\"],\n//   material.orange[\"300\"],\n//   material.orange[\"100\"],\n//   material.deepOrange[\"900\"],\n//   material.deepOrange[\"700\"],\n//   material.deepOrange[\"500\"],\n//   material.deepOrange[\"300\"],\n//   material.deepOrange[\"100\"],\n//   material.brown[\"900\"],\n//   material.brown[\"700\"],\n//   material.brown[\"500\"],\n//   material.brown[\"300\"],\n//   material.brown[\"100\"],\n//   material.blueGrey[\"900\"],\n//   material.blueGrey[\"700\"],\n//   material.blueGrey[\"500\"],\n//   material.blueGrey[\"300\"],\n//   material.blueGrey[\"100\"],\n\n//   \"#000000\",\n//   \"#525252\",\n//   \"#969696\",\n//   \"#D9D9D9\",\n//   \"#FFFFFF\",\n// ];\n","import React from \"react\";\n\nexport const FieldColor = ({ value, isSelected, onClick }) => {\n  return (\n    <div style={{ border: \"5px solid transparent\" }}>\n      <div\n        onClick={onClick ? () => onClick(value) : undefined}\n        style={{\n          width: 25,\n          height: 25,\n          background: value,\n          marginBottom: 0,\n          marginRight: 0,\n          border: isSelected ? \"2px solid #000\" : \"2px solid #000\",\n          boxShadow: isSelected\n            ? \"2px 2px 2px rgba(0,0,0,1)\"\n            : \"2px 2px 2px rgba(0,0,0,0.1)\",\n        }}\n      ></div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { uiButton } from \"../../colors\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faPalette } from \"@fortawesome/free-solid-svg-icons\";\nimport { ToolbarFieldSet } from \"./ToolbarFieldSet\";\nimport { FieldColorPicker } from \"./FieldColorPicker\";\nimport { FieldColor } from \"./FieldColor\";\n\nexport const FieldsetColor = ({ value, onChange }) => {\n  return (\n    <ToolbarFieldSet\n      selected={\n        <FieldColor value={value} isSelected={false} onClick={undefined} />\n      }\n      label={\"Color\"}\n      icon={<FontAwesomeIcon icon={faPalette} color={uiButton} size={\"lg\"} />}\n    >\n      <FieldColorPicker value={value} onChange={onChange} />\n    </ToolbarFieldSet>\n  );\n};\n","import React from \"react\";\nimport { BeadTypes } from \"../../../editorObjects/Editor\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faCircle, faExpand } from \"@fortawesome/free-solid-svg-icons\";\n\nexport const BeadTypesIcons = {\n  [BeadTypes.BasicEllipse]: \"circle\",\n  [BeadTypes.BasicRectangle]: \"rectangle-wide\",\n};\n\nexport const FieldBeadTypePicker = ({ value, onChange }) => {\n  return (\n    <DisplayAvailableBeadTypes\n      types={BeadTypesIcons}\n      selectedType={value}\n      onClick={onChange}\n    />\n  );\n};\n\nconst DisplayAvailableBeadTypes = ({ types, selectedType, onClick }) => {\n  // console.log(\"jak jest?\", types);\n  return (\n    <div className=\"fieldset\" style={{}}>\n      <div className=\"label\"></div>\n      <div\n        style={{\n          display: \"flex\",\n          flexDirection: \"row\",\n          justifyContent: \"flex-start\",\n          alignItems: \"center\",\n          boxSizing: \"border-box\",\n          paddingLeft: \"10px\",\n          paddingRight: \"20px\",\n          width: \"100%\",\n        }}\n      >\n        {Object.keys(types).map((type, index) => {\n          return (\n            <DisplayBeadType\n              icon={types[type]}\n              type={type}\n              key={index}\n              isSelected={selectedType === type}\n              onClick={onClick}\n            />\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport const DisplayBeadType = ({ icon, type, isSelected, onClick }) => {\n  return (\n    <div style={{ border: \"5px solid transparent\" }}>\n      <div\n        onClick={onClick ? () => onClick(type) : undefined}\n        style={{\n          width: 25,\n          height: 25,\n          background: \"#eee\",\n          marginBottom: 0,\n          marginRight: 0,\n          border: isSelected ? \"2px solid #000\" : \"2px solid #000\",\n          boxShadow: isSelected\n            ? \"2px 2px 2px rgba(0,0,0,1)\"\n            : \"2px 2px 2px rgba(0,0,0,0.1)\",\n          display: \"flex\",\n          justifyContent: \"center\",\n          alignItems: \"center\",\n        }}\n      >\n        {icon === \"circle\" ? <FontAwesomeIcon icon={faCircle} /> : null}\n        {icon === \"rectangle-wide\" ? <FontAwesomeIcon icon={faExpand} /> : null}\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { uiButton } from \"../../colors\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faShapes } from \"@fortawesome/free-solid-svg-icons\";\nimport { ToolbarFieldSet } from \"./ToolbarFieldSet\";\nimport {\n  FieldBeadTypePicker,\n  BeadTypesIcons,\n  DisplayBeadType,\n} from \"./FieldBeadTypePicker\";\n\nexport const FieldsetBeadType = ({ value, onChange }) => {\n  return (\n    <ToolbarFieldSet\n      selected={\n        <DisplayBeadType\n          icon={value ? BeadTypesIcons[value] : undefined}\n          type={value}\n          isSelected={false}\n          onClick={undefined}\n        />\n      }\n      label={\"Type\"}\n      icon={<FontAwesomeIcon icon={faShapes} color={uiButton} size={\"lg\"} />}\n    >\n      <FieldBeadTypePicker value={value} onChange={onChange} />\n    </ToolbarFieldSet>\n  );\n};\n","import React from \"react\";\nimport \"rc-slider/assets/index.css\";\nimport Slider, { createSliderWithTooltip } from \"rc-slider\";\n\nexport const SliderWithTooltip = createSliderWithTooltip(Slider);\n\nexport const FieldSliderWithLabel = ({ value, onChange, label, icon }) => {\n  return (\n    <div\n      className={\"fieldset\"}\n      style={{\n        paddingTop: \"10px\",\n        paddingBottom: \"10px\",\n        paddingLeft: \"10px\",\n        paddingRight: \"10px\",\n        display: \"flex\",\n        flexDirection: \"row\",\n        justifyContent: \"space-between\",\n        background: \"#fff\",\n        borderBottom: 0,\n      }}\n    >\n      <div className=\"label\" style={{ padding: 0, width: \"105px\" }}>\n        {icon ? (\n          <div\n            style={{\n              width: \"30px\",\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\",\n              height: \"30px\",\n              marginRight: \"10px\",\n            }}\n          >\n            {icon}\n          </div>\n        ) : null}\n        {label ? <div>{label}</div> : null}\n      </div>\n\n      <div\n        style={{\n          boxSizing: \"border-box\",\n          flexGrow: 1,\n          paddingRight: \"10px\",\n          paddingBottom: \"10px\",\n        }}\n      >\n        <SliderWithTooltip\n          max={100}\n          min={1}\n          step={1}\n          value={value}\n          onChange={value => onChange(value)}\n          defaultValue={10}\n          marks={{\n            0: \"0\",\n            50: \"50\",\n            100: \"100\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\n\nexport const FieldCheckbox = ({ label, value, onChange, isDisabled }) => {\n  return (\n    <div className={\"fieldset\"}>\n      <div className=\"label\">{label}</div>\n      <input\n        type=\"checkbox\"\n        disabled={isDisabled}\n        value={value === true ? 1 : 0}\n        checked={value === true}\n        onChange={event => onChange(event.target.value === \"0\")}\n      />\n    </div>\n  );\n};\n","import React from \"react\";\n// import { FieldsetHeight } from \"./FieldsetHeight\";\n// import { FieldsetWidth } from \"./FieldsetWidth\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faExpandArrowsAlt,\n  faArrowsAltV,\n  faArrowsAltH,\n  faLink,\n  faUnlink,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { uiButton } from \"../../colors\";\nimport { ToolbarFieldSet } from \"./ToolbarFieldSet\";\nimport { FieldSliderWithLabel } from \"./FieldSliderWithLabel\";\nimport { FieldCheckbox } from \"./FieldCheckbox\";\n\nexport const FieldsetWidthAndHeight = ({\n  height,\n  width,\n  keepAspectRatio,\n  onChange_beadHeight,\n  onChange_beadWidth,\n  onChange_keepAspectRatio,\n}) => {\n  const format = value =>\n    value.toLocaleString(undefined, {\n      maximumFractionDigits: 2,\n      style: \"decimal\",\n    });\n  const value = `${format(width)} x ${format(height)}`;\n  return (\n    <div>\n      <ToolbarFieldSet\n        selected={value}\n        label={\"Size\"}\n        icon={\n          <FontAwesomeIcon\n            icon={faExpandArrowsAlt}\n            color={uiButton}\n            size={\"lg\"}\n          />\n        }\n      >\n        <div>\n          <div style={{ width: \"100%\", background: \"#fff\" }}>\n            <FieldCheckbox\n              label={\n                <div\n                  style={{\n                    display: \"flex\",\n                    flexWrap: \"nowrap\",\n                    justifyContent: \"space\",\n                  }}\n                >\n                  <div\n                    style={{\n                      width: \"30px\",\n                      display: \"flex\",\n                      justifyContent: \"center\",\n                      alignItems: \"center\",\n                      height: \"30px\",\n                      marginRight: \"10px\",\n                      background: \"#fff\",\n                    }}\n                  >\n                    <FontAwesomeIcon\n                      icon={keepAspectRatio === true ? faLink : faUnlink}\n                      color={uiButton}\n                      size={\"lg\"}\n                    />\n                  </div>\n                  <div>Keep aspect ratio</div>\n                </div>\n              }\n              value={keepAspectRatio}\n              onChange={onChange_keepAspectRatio}\n              isDisabled={false}\n            />\n          </div>\n\n          <FieldSliderWithLabel\n            label={\"Width\"}\n            icon={\n              <FontAwesomeIcon\n                icon={faArrowsAltH}\n                color={uiButton}\n                size={\"lg\"}\n              />\n            }\n            value={width}\n            onChange={onChange_beadWidth}\n          />\n\n          <FieldSliderWithLabel\n            label={\"Height\"}\n            icon={\n              <FontAwesomeIcon\n                icon={faArrowsAltV}\n                color={uiButton}\n                size={\"lg\"}\n              />\n            }\n            value={height}\n            onChange={onChange_beadHeight}\n          />\n        </div>\n      </ToolbarFieldSet>\n    </div>\n  );\n};\n","import React from \"react\";\nimport \"rc-slider/assets/index.css\";\nimport Slider, { createSliderWithTooltip } from \"rc-slider\";\n\nexport const SliderWithTooltip = createSliderWithTooltip(Slider);\n\nexport const FieldSlider = ({ value, onChange, ...props }) => {\n  return (\n    <div\n      style={{\n        background: \"#fff\",\n        width: \"100%\",\n        paddingTop: \"20px\",\n        paddingBottom: \"30px\",\n        paddingLeft: \"20px\",\n        paddingRight: \"20px\",\n      }}\n    >\n      <SliderWithTooltip\n        max={100}\n        min={1}\n        step={1}\n        value={value}\n        onChange={value => onChange(value)}\n        defaultValue={10}\n        marks={{\n          0: \"0\",\n          50: \"50\",\n          100: \"100\",\n        }}\n        {...props}\n      />\n    </div>\n  );\n};\n","import React from \"react\";\nimport { uiButton } from \"../../colors\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faSyncAlt } from \"@fortawesome/free-solid-svg-icons\";\nimport { FieldSlider } from \"./FieldSlider\";\nimport { ToolbarFieldSet } from \"./ToolbarFieldSet\";\nimport NumberFormat from \"react-number-format\";\n\nexport const FieldsetBeadRotate = ({ value, onChange }) => {\n  return (\n    <ToolbarFieldSet\n      selected={`${value}deg`}\n      label={\"Rotate\"}\n      icon={<FontAwesomeIcon icon={faSyncAlt} color={uiButton} size={\"lg\"} />}\n    >\n      <React.Fragment>\n        <FieldSlider\n          value={value}\n          onChange={value => {\n            // console.log(\"FieldSlider\", value);\n            onChange(value);\n          }}\n          max={180}\n          min={-180}\n          defaultValue={0}\n          marks={{\n            \"-180\": \"-180\",\n            \"0\": \"0\",\n            \"180\": \"180\",\n          }}\n        />\n        <NumberFormat\n          suffix={\"deg\"}\n          allowNegative={true}\n          allowEmptyFormatting={true}\n          value={value}\n          onValueChange={event => {\n            onChange(event.floatValue);\n          }}\n          placeholder=\" deg\"\n          style={{\n            color: \"#4a4a4a\",\n            textAlign: \"center\",\n            border: \"1px solid #aeaeae\",\n            fontFamily: \"Open Sans, sans-serif\",\n            fontSize: \"1em\",\n            fontWeight: 400,\n            lineHeight: \"1.5\",\n            padding: \"3px 10px\",\n            marginBottom: \"15px\",\n            marginTop: \"5px\",\n          }}\n        />\n      </React.Fragment>\n    </ToolbarFieldSet>\n  );\n};\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Editor } from \"../../../editorObjects/Editor\";\nimport { FieldBeadPreview } from \"../ui/FieldBeadPreview\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { FieldsetColor } from \"../ui/FieldsetColor\";\nimport { FieldsetBeadType } from \"../ui/FieldsetBeadType\";\n// import { FieldsetBeadSpacing } from \"../ui/FieldsetBeadSpacing\";\n// import { FieldsetBeadCount } from \"../ui/FieldsetBeadCount\";\nimport { FieldsetWidthAndHeight } from \"../ui/FieldsetWidthAndHeight\";\n// import { FieldDeleteAndCopy } from \"../ui/FieldDeleteAndCopy\";\nimport { FieldsetBeadRotate } from \"../ui/FieldsetBeadRotate\";\n\nexport const ToolbarEditBeads = ({ isVisible }) => {\n  if (isVisible === true) {\n    return <ContentWrapper />;\n  }\n\n  return <React.Fragment />;\n};\n\nconst ContentWrapper = () => {\n  const showToolbar = useSelector((state: Editor) => {\n    return state.ui.selectedBeadsIdsCount >= 1;\n  });\n  if (showToolbar) {\n    return <Content />;\n  }\n  return <React.Fragment />;\n};\n\nconst Content = () => {\n  return (\n    <React.Fragment>\n      <BeadPreview />\n      <BeadSize />\n      <BeadColor />\n      <BeadType />\n      <BeadsRotate />\n    </React.Fragment>\n  );\n};\n\nconst BeadsRotate = () => {\n  const dispatch = useDispatch();\n  const selected = useSelector((state: Editor) => {\n    const beadId = Object.keys(state.ui.selectedBeadsIds)[0];\n    return state.appData.beads[beadId];\n  });\n\n  if (!selected) {\n    return <React.Fragment />;\n  }\n\n  const onChange_beadsRotate = value => {\n    let newValue = value;\n    if (value === undefined || value === null || isNaN(value) === true) {\n      newValue = 0;\n    }\n    dispatch(Actions.Toolbar.action_changeSelectedBeads_rotate(newValue));\n  };\n\n  return (\n    <FieldsetBeadRotate\n      value={selected.rotate}\n      onChange={onChange_beadsRotate}\n    />\n  );\n};\n\nconst BeadSize = () => {\n  const dispatch = useDispatch();\n  const selected = useSelector((state: Editor) => {\n    const beadId = Object.keys(state.ui.selectedBeadsIds)[0];\n    return state.appData.beads[beadId];\n  });\n\n  if (!selected) {\n    return <React.Fragment />;\n  }\n\n  const onChange_beadWidth = value => {\n    dispatch(Actions.Toolbar.action_changeSelectedBeads_width(value));\n  };\n  const onChange_beadHeight = value => {\n    dispatch(Actions.Toolbar.action_changeSelectedBeads_height(value));\n  };\n  const onChange_keepAspectRatio = value => {\n    dispatch(Actions.Toolbar.action_changeSelectedBeads_keepAspectRatio(value));\n  };\n  const width = selected.width ? selected.width : 10;\n  const height = selected.height ? selected.height : 10;\n  const keepAspectRatio = selected.keepAspectRatio\n    ? selected.keepAspectRatio\n    : false;\n\n  return (\n    <div>\n      <FieldsetWidthAndHeight\n        height={height}\n        width={width}\n        keepAspectRatio={keepAspectRatio}\n        onChange_beadHeight={onChange_beadHeight}\n        onChange_beadWidth={onChange_beadWidth}\n        onChange_keepAspectRatio={onChange_keepAspectRatio}\n      />\n    </div>\n  );\n};\n\nconst BeadType = () => {\n  const dispatch = useDispatch();\n  const selected = useSelector((state: Editor) => {\n    const beadId = Object.keys(state.ui.selectedBeadsIds)[0];\n    return state.appData.beads[beadId];\n  });\n\n  if (!selected) {\n    return <React.Fragment />;\n  }\n  if (!selected.type) {\n    return <React.Fragment />;\n  }\n\n  const onSelect = type => {\n    dispatch(Actions.Toolbar.action_changeSelectedBeads_type(type));\n  };\n\n  return <FieldsetBeadType onChange={onSelect} value={selected.type} />;\n};\n\nconst BeadColor = () => {\n  const dispatch = useDispatch();\n  const selected = useSelector((state: Editor) => {\n    const beadId = Object.keys(state.ui.selectedBeadsIds)[0];\n    return state.appData.beads[beadId];\n  });\n\n  if (!selected) {\n    return <React.Fragment />;\n  }\n\n  if (!selected.color) {\n    return <React.Fragment />;\n  }\n\n  const onSelect = color => {\n    dispatch(Actions.Toolbar.action_changeSelectedBeads_color(color));\n  };\n\n  return <FieldsetColor onChange={onSelect} value={selected.color} />;\n};\n\nconst BeadPreview = () => {\n  const selected = useSelector((state: Editor) => {\n    const beadId = Object.keys(state.ui.selectedBeadsIds)[0];\n    return state.appData.beads[beadId];\n  });\n\n  if (!selected) {\n    return <React.Fragment />;\n  }\n  return <FieldBeadPreview bead={selected} />;\n};\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Editor } from \"../../../editorObjects/Editor\";\nimport { ToolbarField } from \"../ui/ToolbarField\";\n\nexport const ToolbarIdle = ({ isVisible }) => {\n  if (isVisible === true) {\n    return <Content />;\n  }\n\n  return <React.Fragment />;\n};\n\nconst Content = () => {\n  const linesLen = useSelector((state: Editor) => {\n    return Object.keys(state.appData.lines).length;\n  });\n\n  const beadsLen = useSelector((state: Editor) => {\n    return Object.keys(state.appData.beads).length;\n  });\n\n  return (\n    <div>\n      <ToolbarField\n        label={\"Beads\"}\n        onToggle={undefined}\n        value={beadsLen}\n        icon={undefined}\n      />\n\n      <ToolbarField\n        label={\"Lines\"}\n        onToggle={undefined}\n        value={linesLen}\n        icon={undefined}\n      />\n    </div>\n  );\n};\n","import React from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faFileAlt, faCog, faImage } from \"@fortawesome/free-solid-svg-icons\";\nimport { uiButton } from \"../colors\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Actions } from \"../../immerReducers/store\";\nimport { Editor, EditorMenuMain } from \"../../editorObjects/Editor\";\n\nexport const TopbarMain = () => {\n  const dispatch = useDispatch();\n  const currentMenuMainOpen = useSelector((state: Editor) => {\n    return state.ui.currentMenuMainOpen;\n  });\n  const onClick_file = () => {\n    dispatch(Actions.Topbar.action_toggleMenuFile());\n  };\n  const onClick_grid = () => {\n    dispatch(Actions.Topbar.action_toggleMenuSettings());\n  };\n  const onClick_background = () => {\n    dispatch(Actions.Topbar.action_toggleMenuBackground());\n  };\n  return (\n    <div\n      className=\"field has-addons\"\n      style={{ margin: 0, border: \"1px solid #e0e0e0\", paddingBottom: \"0px\" }}\n    >\n      <div className=\"control\">\n        <div\n          className={`button is-light ${\n            currentMenuMainOpen === EditorMenuMain.File ? \"is-dark\" : \"\"\n          }`}\n          onClick={onClick_file}\n          style={{ height: \"25px\", padding: \"3px 10px\" }}\n        >\n          <span className=\"icon is-small\">\n            <FontAwesomeIcon icon={faFileAlt} color={uiButton} />\n          </span>\n          <span>File</span>\n        </div>\n      </div>\n\n      {/* <div className=\"control\">\n        <div className={`button`} onClick={onClick_selection}>\n          <span className=\"icon is-small\">\n            <FontAwesomeIcon icon={faMarker} />\n          </span>\n          <span>Canvas</span>\n        </div>\n      </div> */}\n\n      <div className=\"control\">\n        <div\n          className={`button is-light ${\n            currentMenuMainOpen === EditorMenuMain.Grid ? \"is-dark\" : \"\"\n          }`}\n          onClick={onClick_grid}\n          style={{ height: \"25px\", padding: \"3px 10px\" }}\n        >\n          <span className=\"icon is-small\">\n            <FontAwesomeIcon icon={faCog} color={uiButton} />\n          </span>\n          <span>Grid</span>\n        </div>\n      </div>\n\n      <div className=\"control\">\n        <div\n          className={`button is-light ${\n            currentMenuMainOpen === EditorMenuMain.Background ? \"is-dark\" : \"\"\n          }`}\n          onClick={onClick_background}\n          style={{ height: \"25px\", padding: \"3px 10px\" }}\n        >\n          <span className=\"icon is-small\">\n            <FontAwesomeIcon icon={faImage} color={uiButton} />\n          </span>\n          <span>Background</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faTimes, faSave, faDownload } from \"@fortawesome/free-solid-svg-icons\";\nimport { uiButton } from \"../colors\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Editor } from \"../../editorObjects/Editor\";\nimport { Actions } from \"../../immerReducers/store\";\n\nexport const EditorChangeState = () => {\n  const dispatch = useDispatch();\n  const isSaved = useSelector((state: Editor) => {\n    return state.ui.saveInfo.saved;\n  });\n  const haveUnsavedChanges = useSelector((state: Editor) => {\n    return state.ui.saveInfo.haveUnsavedChanges;\n  });\n\n  const onClearCanvas = () => {\n    dispatch(Actions.Persist.action_onClearCanvas());\n  };\n\n  const readSavedCanvas = () => {\n    dispatch(Actions.Persist.action_readSavedCanvas());\n  };\n\n  const onSaveCanvas = () => {\n    dispatch(Actions.Persist.action_onSaveCanvas());\n  };\n\n  return (\n    <div style={{ display: \"flex\", flexDirection: \"row\" }}>\n      <div\n        className=\"field has-addons\"\n        style={{ width: \"auto\", flexWrap: \"nowrap\", marginBottom: \"0\" }}\n      >\n        <div className=\"control\">\n          <div className={` button is-light `} onClick={onClearCanvas}>\n            <span className=\"icon is-small\">\n              <FontAwesomeIcon icon={faTimes} color={uiButton} />\n            </span>\n            <span>New project</span>\n          </div>\n        </div>\n\n        <div className=\"control\">\n          <div\n            className={` button is-light ${\n              isSaved === true ? \"is-success\" : \"\"\n            }`}\n            onClick={onSaveCanvas}\n          >\n            <span className=\"icon is-small\">\n              <FontAwesomeIcon icon={faSave} color={uiButton} />\n            </span>\n            <span>Save</span>\n          </div>\n        </div>\n\n        <div className=\"control\">\n          <div className={`button is-light `} onClick={readSavedCanvas}>\n            <span className=\"icon is-small\">\n              <FontAwesomeIcon icon={faDownload} color={uiButton} />\n            </span>\n            <span>Load local</span>\n          </div>\n        </div>\n      </div>\n      <div\n        style={{\n          fontFamily: \"Open Sans, sans-serif\",\n          fontSize: \"13px\",\n          alignSelf: \"center\"\n        }}\n      >\n        {haveUnsavedChanges === true ? (\n          <div>You have unsaved changes</div>\n        ) : (\n          <div>No changes to save</div>\n        )}\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport {\n  Editor,\n  EditorMenuMain,\n  EditorGridType\n} from \"../../editorObjects/Editor\";\nimport { EditorChangeState } from \"../Toolbar/EditorChangeState\";\nimport { FieldCheckbox } from \"../Toolbar/ui/FieldCheckbox\";\nimport NumberFormat from \"react-number-format\";\nimport { Actions } from \"../../immerReducers/store\";\nimport { SliderWithTooltip } from \"../Toolbar/ui/FieldSlider\";\n\nexport const TopbarSecoundary = () => {\n  const currentMenuMainOpen = useSelector((state: Editor) => {\n    return state.ui.currentMenuMainOpen;\n  });\n  if (currentMenuMainOpen === EditorMenuMain.File) {\n    return <SubMenuFile />;\n  }\n  if (currentMenuMainOpen === EditorMenuMain.Grid) {\n    return <SubMenuGrid />;\n  }\n  if (currentMenuMainOpen === EditorMenuMain.Background) {\n    return <SubMenuBackground />;\n  }\n  return <React.Fragment />;\n};\n\nconst SubMenuFile = () => {\n  // const dispatch = useDispatch();\n  return (\n    <div>\n      <EditorChangeState />\n    </div>\n  );\n};\n\nconst SubMenuBackground = () => {\n  const dispatch = useDispatch();\n  const image = useSelector((state: Editor) => {\n    return state.ui.background.image;\n  });\n\n  const { position, scale, opacity } = image;\n  const onChange_clear = () => {\n    dispatch(Actions.Topbar.action_background_image_clear());\n  };\n  const onChange_upload = event => {\n    const selectedFiles: FileList = event.target.files;\n    const files = Array.from(selectedFiles);\n    if (files.length === 0) {\n      console.error(\"no files selected\");\n      return;\n    }\n    let file = files[0];\n    const types = [\"image/png\", \"image/jpeg\", \"image/gif\"];\n    if (types.every(type => file.type !== type)) {\n      console.error(`'${file.type}' is not a supported format`);\n      return;\n    }\n    if (file.size > 1 * 1024 * 1024) {\n      console.error(`'${file.name}' is too large, please pick a smaller file`);\n      return;\n    }\n    let reader = new FileReader();\n    reader.onloadend = () => {\n      dispatch(Actions.Topbar.action_background_image_upload(reader.result));\n    };\n    reader.readAsDataURL(file);\n    event.preventDefault();\n  };\n  const onChange_pointX = value => {\n    dispatch(Actions.Topbar.action_background_image_pointX(value));\n  };\n  const onChange_pointY = value => {\n    dispatch(Actions.Topbar.action_background_image_pointY(value));\n  };\n  const onChange_scale = value => {\n    dispatch(Actions.Topbar.action_background_image_scale(value));\n  };\n  const onChange_opacity = value => {\n    dispatch(Actions.Topbar.action_background_image_opacity(value));\n  };\n  return (\n    <div\n      style={{ flexWrap: \"nowrap\", display: \"flex\", alignItems: \"flex-start\" }}\n    >\n      <div style={{ flexWrap: \"nowrap\", display: \"flex\", marginTop: \"4px\" }}>\n        <div className=\"control\">\n          <div className={` button is-light `} onClick={onChange_clear}>\n            <span>Clear</span>\n          </div>\n        </div>\n\n        <div className=\"control\">\n          <div className={` button is-light `} style={{ position: \"relative\" }}>\n            <input\n              type=\"file\"\n              onChange={onChange_upload}\n              style={{\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                opacity: 0,\n                zIndex: 2\n              }}\n            />\n            <span>Upload</span>\n          </div>\n        </div>\n      </div>\n\n      <div\n        style={{\n          display: \"flex\",\n          marginLeft: \"10px\",\n          marginRight: \"10px\",\n          flexWrap: \"nowrap\",\n          alignItems: \"flex-start\"\n        }}\n      >\n        <div\n          className={\"fieldset\"}\n          style={{\n            width: \"100px\",\n            whiteSpace: \"nowrap\",\n            flexWrap: \"nowrap\",\n            display: \"flex\",\n            alignItems: \"flex-start\"\n          }}\n        >\n          <div\n            className=\"label\"\n            style={{ whiteSpace: \"nowrap\" }}\n          >{`Scale: ${scale}`}</div>\n        </div>\n        <div style={{ width: \"100px\", marginLeft: \"20px\", marginTop: \"13px\" }}>\n          <SliderWithTooltip\n            max={16}\n            min={0.2}\n            step={0.1}\n            value={scale}\n            onChange={value => onChange_scale(value)}\n            defaultValue={1}\n            // marks={{\n            //   0.2: \"0.2\",\n            //   4: \"4\",\n            //   8: \"8\",\n            // }}\n          />\n        </div>\n      </div>\n\n      <BackgroundPosition\n        pointX={position.x}\n        onChange_pointX={onChange_pointX}\n        pointY={position.y}\n        onChange_pointY={onChange_pointY}\n      />\n\n      <div\n        style={{\n          display: \"flex\",\n          marginLeft: \"10px\",\n          marginRight: \"10px\",\n          flexWrap: \"nowrap\",\n          alignItems: \"flex-start\"\n        }}\n      >\n        <div className={\"fieldset\"} style={{ width: \"85px\" }}>\n          <div\n            className=\"label\"\n            style={{ flexWrap: \"nowrap\", whiteSpace: \"nowrap\" }}\n          >\n            Opacity: {opacity}\n          </div>\n        </div>\n        <div style={{ width: \"80px\", marginLeft: \"10px\", marginTop: \"13px\" }}>\n          <SliderWithTooltip\n            max={1}\n            min={0}\n            step={0.1}\n            value={opacity}\n            onChange={value => onChange_opacity(value)}\n            defaultValue={1}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst BackgroundPosition = ({\n  pointX,\n  onChange_pointX,\n  pointY,\n  onChange_pointY\n}) => {\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexWrap: \"nowrap\",\n        alignItems: \"center\",\n        marginRight: \"15px\"\n      }}\n    >\n      <div className={\"fieldset\"}>\n        <div className=\"label\">Image position: </div>\n\n        <NumberFormat\n          allowNegative={false}\n          allowEmptyFormatting={true}\n          max={999}\n          min={-999}\n          maxLength={3}\n          value={pointX}\n          onValueChange={event => {\n            onChange_pointX(event.floatValue);\n          }}\n          placeholder=\"x\"\n          style={{\n            color: \"#4a4a4a\",\n            textAlign: \"center\",\n            border: \"1px solid #aeaeae\",\n            fontFamily: \"Open Sans, sans-serif\",\n            fontSize: \"13px\",\n            fontWeight: 400,\n            lineHeight: \"1.5\",\n            padding: \"0px 10px\",\n            marginBottom: \"0px\",\n            marginTop: \"0px\",\n            maxWidth: \"70px\",\n            marginRight: \"5px\"\n          }}\n        />\n        <NumberFormat\n          allowNegative={false}\n          allowEmptyFormatting={true}\n          max={999}\n          min={-999}\n          maxLength={3}\n          value={pointY}\n          onValueChange={event => {\n            onChange_pointY(event.floatValue);\n          }}\n          placeholder=\"y\"\n          style={{\n            color: \"#4a4a4a\",\n            textAlign: \"center\",\n            border: \"1px solid #aeaeae\",\n            fontFamily: \"Open Sans, sans-serif\",\n            fontSize: \"13px\",\n            fontWeight: 400,\n            lineHeight: \"1.5\",\n            padding: \"0px 10px\",\n            marginBottom: \"0px\",\n            marginTop: \"0px\",\n            maxWidth: \"70px\"\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst SubMenuGrid = () => {\n  const dispatch = useDispatch();\n  const grid = useSelector((state: Editor) => {\n    return state.ui.grid;\n  });\n\n  const { height, width, hexSize, type, snapEnabled, isVisible } = grid;\n  const onChange_isVisible = () => {\n    dispatch(Actions.Topbar.action_toggleGridIsVisible());\n  };\n  const onChange_snapEnabled = () => {\n    dispatch(Actions.Topbar.action_toggleGridSnapEnabled());\n  };\n  const onChange_gridItemW = value => {\n    let newValue = value;\n    if (value === undefined || value === null || isNaN(value) === true) {\n      newValue = 1;\n      return;\n    }\n    if (newValue < 1) {\n      newValue = 1;\n    }\n    if (newValue > 100) {\n      newValue = 100;\n    }\n    dispatch(Actions.Topbar.action_setGridWidth(newValue));\n  };\n  const onChange_gridItemH = value => {\n    let newValue = value;\n    if (value === undefined || value === null || isNaN(value) === true) {\n      newValue = 1;\n      return;\n    }\n    if (newValue < 1) {\n      newValue = 1;\n    }\n    if (newValue > 100) {\n      newValue = 100;\n    }\n    dispatch(Actions.Topbar.action_setGridHeight(newValue));\n  };\n  const onClick_selectTypeHex = () => {\n    dispatch(Actions.Topbar.action_setGridType(EditorGridType.Hex));\n  };\n  const onClick_selectTypeBox = () => {\n    dispatch(Actions.Topbar.action_setGridType(EditorGridType.Box));\n  };\n  const onChange_hexSize = value => {\n    let newValue = value;\n    if (value === undefined || value === null || isNaN(value) === true) {\n      newValue = 1;\n      return;\n    }\n    if (newValue < 1) {\n      newValue = 1;\n    }\n    if (newValue > 100) {\n      newValue = 100;\n    }\n    dispatch(Actions.Topbar.action_setGridHexSize(newValue));\n  };\n\n  return (\n    <div style={{ display: \"flex\", flexWrap: \"nowrap\", alignItems: \"center\" }}>\n      <GridOptions\n        isVisible={isVisible}\n        onChange_isVisible={onChange_isVisible}\n        snapEnabled={snapEnabled}\n        onChange_snapEnabled={onChange_snapEnabled}\n        type={type}\n        onClick_selectTypeHex={onClick_selectTypeHex}\n        onClick_selectTypeBox={onClick_selectTypeBox}\n      />\n\n      {type === EditorGridType.Box ? (\n        <GridBoxSettings\n          gridItemW={width}\n          onChange_gridItemW={onChange_gridItemW}\n          gridItemH={height}\n          onChange_gridItemH={onChange_gridItemH}\n        />\n      ) : null}\n\n      {type === EditorGridType.Hex ? (\n        <GridHexSettings\n          hexSize={hexSize}\n          onChange_hexSize={onChange_hexSize}\n        />\n      ) : null}\n    </div>\n  );\n};\n\nconst GridOptions = ({\n  isVisible,\n  onChange_isVisible,\n  snapEnabled,\n  onChange_snapEnabled,\n  type,\n  onClick_selectTypeHex,\n  onClick_selectTypeBox\n}) => {\n  return (\n    <React.Fragment>\n      <div\n        style={{\n          marginRight: \"15px\"\n        }}\n      >\n        <FieldCheckbox\n          label={\"Show grid\"}\n          value={isVisible}\n          onChange={onChange_isVisible}\n          isDisabled={false}\n        />\n      </div>\n\n      <div\n        style={{\n          marginRight: \"15px\"\n        }}\n      >\n        <FieldCheckbox\n          label={\"Snap to grid\"}\n          value={snapEnabled}\n          onChange={onChange_snapEnabled}\n          isDisabled={false}\n        />\n      </div>\n\n      <div\n        style={{\n          marginRight: \"15px\"\n        }}\n      >\n        <div className={\"fieldset\"}>\n          <div className=\"label\">Grid type: </div>\n          <div className=\"control\">\n            <div\n              className={` button is-light ${\n                type === EditorGridType.Hex ? \"is-dark\" : \"\"\n              } `}\n              onClick={onClick_selectTypeHex}\n            >\n              <span>Hexagon</span>\n            </div>\n          </div>\n\n          <div className=\"control\">\n            <div\n              className={` button is-light ${\n                type === EditorGridType.Box ? \"is-dark\" : \"\"\n              }`}\n              onClick={onClick_selectTypeBox}\n            >\n              <span>Rectangle</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </React.Fragment>\n  );\n};\n\nconst GridBoxSettings = ({\n  gridItemW,\n  onChange_gridItemW,\n  gridItemH,\n  onChange_gridItemH\n}) => {\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexWrap: \"nowrap\",\n        alignItems: \"center\",\n        marginRight: \"15px\"\n      }}\n    >\n      <div className={\"fieldset\"}>\n        <div className=\"label\">Grid size: </div>\n\n        <NumberFormat\n          allowNegative={false}\n          allowEmptyFormatting={true}\n          max={99}\n          min={1}\n          maxLength={2}\n          value={gridItemW}\n          onValueChange={event => {\n            onChange_gridItemW(event.floatValue);\n          }}\n          placeholder=\"width\"\n          style={{\n            color: \"#4a4a4a\",\n            textAlign: \"center\",\n            border: \"1px solid #aeaeae\",\n            fontFamily: \"Open Sans, sans-serif\",\n            fontSize: \"13px\",\n            fontWeight: 400,\n            lineHeight: \"1.5\",\n            padding: \"0px 10px\",\n            marginBottom: \"0px\",\n            marginTop: \"0px\",\n            maxWidth: \"70px\",\n            marginRight: \"5px\"\n          }}\n        />\n        <NumberFormat\n          allowNegative={false}\n          allowEmptyFormatting={true}\n          max={99}\n          min={1}\n          maxLength={2}\n          value={gridItemH}\n          onValueChange={event => {\n            onChange_gridItemH(event.floatValue);\n          }}\n          placeholder=\"height\"\n          style={{\n            color: \"#4a4a4a\",\n            textAlign: \"center\",\n            border: \"1px solid #aeaeae\",\n            fontFamily: \"Open Sans, sans-serif\",\n            fontSize: \"13px\",\n            fontWeight: 400,\n            lineHeight: \"1.5\",\n            padding: \"0px 10px\",\n            marginBottom: \"0px\",\n            marginTop: \"0px\",\n            maxWidth: \"70px\"\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst GridHexSettings = ({ hexSize, onChange_hexSize }) => {\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexWrap: \"nowrap\",\n        alignItems: \"center\",\n        marginRight: \"15px\"\n      }}\n    >\n      <div className={\"fieldset\"}>\n        <div className=\"label\">Hex size: </div>\n\n        <NumberFormat\n          allowNegative={false}\n          allowEmptyFormatting={true}\n          max={99}\n          min={5}\n          maxLength={2}\n          value={hexSize}\n          onValueChange={event => {\n            onChange_hexSize(event.floatValue);\n          }}\n          placeholder=\"width\"\n          style={{\n            color: \"#4a4a4a\",\n            textAlign: \"center\",\n            border: \"1px solid #aeaeae\",\n            fontFamily: \"Open Sans, sans-serif\",\n            fontSize: \"13px\",\n            fontWeight: 400,\n            lineHeight: \"1.5\",\n            padding: \"0px 10px\",\n            marginBottom: \"0px\",\n            marginTop: \"0px\",\n            maxWidth: \"70px\",\n            marginRight: \"5px\"\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { uiButton } from \"../../colors\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faArrowsAlt } from \"@fortawesome/free-solid-svg-icons\";\nimport { FieldSlider } from \"./FieldSlider\";\nimport { ToolbarFieldSet } from \"./ToolbarFieldSet\";\n\nexport const FieldsetSize = ({ value, onChange }) => {\n  return (\n    <ToolbarFieldSet\n      selected={value}\n      label={\"Size\"}\n      icon={<FontAwesomeIcon icon={faArrowsAlt} color={uiButton} size={\"lg\"} />}\n    >\n      <FieldSlider value={value} onChange={onChange} />\n    </ToolbarFieldSet>\n  );\n};\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Editor } from \"../../../editorObjects/Editor\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { FieldsetColor } from \"../ui/FieldsetColor\";\nimport { FieldsetSize } from \"../ui/FieldsetSize\";\n\nexport const ToolbarPaint = ({ isVisible }) => {\n  if (isVisible === true) {\n    return <Content />;\n  }\n\n  return <React.Fragment />;\n};\n\nconst Content = () => {\n  return (\n    <React.Fragment>\n      <BrushSize />\n      <BrushColor />\n    </React.Fragment>\n  );\n};\n\nconst BrushSize = () => {\n  const dispatch = useDispatch();\n  const size = useSelector((state: Editor) => {\n    return state.ui.brush.size;\n  });\n\n  if (!size) {\n    return <React.Fragment />;\n  }\n\n  const onChange = value => {\n    let newValue = value;\n    if (value === undefined || value === null || isNaN(value) === true) {\n      newValue = 0;\n    }\n    dispatch(Actions.Toolbar.action_updateBrushSize(newValue));\n  };\n\n  return <FieldsetSize value={size} onChange={onChange} />;\n};\n\nconst BrushColor = () => {\n  const dispatch = useDispatch();\n  const color = useSelector((state: Editor) => {\n    return state.ui.brush.color;\n  });\n\n  if (!color) {\n    return <React.Fragment />;\n  }\n\n  const onChange = color => {\n    dispatch(Actions.Toolbar.action_updateBrushColor(color));\n  };\n\n  return <FieldsetColor onChange={onChange} value={color} />;\n};\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Editor } from \"../../../editorObjects/Editor\";\nimport { FieldBeadPreview } from \"../ui/FieldBeadPreview\";\nimport { Actions } from \"../../../immerReducers/store\";\n// import { FieldsetWidth } from \"../ui/FieldsetWidth\";\n// import { FieldsetHeight } from \"../ui/FieldsetHeight\";\nimport { FieldsetColor } from \"../ui/FieldsetColor\";\nimport { FieldsetBeadType } from \"../ui/FieldsetBeadType\";\nimport { FieldsetWidthAndHeight } from \"../ui/FieldsetWidthAndHeight\";\nimport { FieldsetBeadRotate } from \"../ui/FieldsetBeadRotate\";\nimport { buildBead } from \"../../../editorObjects/Bead\";\n\nexport const ToolbarAddBeads = ({ isVisible }) => {\n  if (isVisible === true) {\n    return <Content />;\n  }\n\n  return <React.Fragment />;\n};\n\nconst Content = () => {\n  return (\n    <React.Fragment>\n      <BeadPreview />\n      <BeadSize />\n      <BeadColor />\n      <BeadType />\n      <BeadsRotate />\n    </React.Fragment>\n  );\n};\n\nconst BeadsRotate = () => {\n  const dispatch = useDispatch();\n\n  const beadsTemplate = useSelector((state: Editor) => {\n    return state.ui.beadsTemplate;\n  });\n\n  const onChange_beadsRotate = value => {\n    let newValue = value;\n    if (value === undefined || value === null || isNaN(value) === true) {\n      newValue = 0;\n    }\n    dispatch(Actions.Toolbar.action_updateBeadsTemplate(\"rotate\", newValue));\n  };\n\n  return (\n    <FieldsetBeadRotate\n      value={beadsTemplate.rotate}\n      onChange={onChange_beadsRotate}\n    />\n  );\n};\n\nconst BeadSize = () => {\n  const dispatch = useDispatch();\n\n  const beadsTemplate = useSelector((state: Editor) => {\n    return state.ui.beadsTemplate;\n  });\n\n  const onChange_beadWidth = value => {\n    dispatch(Actions.Toolbar.action_updateBeadsTemplate(\"width\", value));\n  };\n\n  const onChange_beadHeight = value => {\n    dispatch(Actions.Toolbar.action_updateBeadsTemplate(\"height\", value));\n  };\n\n  const onChange_keepAspectRatio = value => {\n    dispatch(\n      Actions.Toolbar.action_updateBeadsTemplate(\"keepAspectRatio\", value)\n    );\n  };\n\n  const width = beadsTemplate.width ? beadsTemplate.width : 10;\n  const height = beadsTemplate.height ? beadsTemplate.height : 10;\n  const keepAspectRatio = beadsTemplate.keepAspectRatio\n    ? beadsTemplate.keepAspectRatio\n    : false;\n\n  return (\n    <div>\n      <FieldsetWidthAndHeight\n        height={height}\n        width={width}\n        keepAspectRatio={keepAspectRatio}\n        onChange_beadHeight={onChange_beadHeight}\n        onChange_beadWidth={onChange_beadWidth}\n        onChange_keepAspectRatio={onChange_keepAspectRatio}\n      />\n    </div>\n  );\n};\n\nconst BeadType = () => {\n  const dispatch = useDispatch();\n\n  const beadsTemplate = useSelector((state: Editor) => {\n    return state.ui.beadsTemplate;\n  });\n\n  const onSelect = type => {\n    dispatch(Actions.Toolbar.action_updateBeadsTemplate(\"type\", type));\n  };\n\n  return <FieldsetBeadType onChange={onSelect} value={beadsTemplate.type} />;\n};\n\nconst BeadColor = () => {\n  const dispatch = useDispatch();\n\n  const beadsTemplate = useSelector((state: Editor) => {\n    return state.ui.beadsTemplate;\n  });\n\n  const onSelect = color => {\n    dispatch(Actions.Toolbar.action_updateBeadsTemplate(\"color\", color));\n  };\n\n  return <FieldsetColor onChange={onSelect} value={beadsTemplate.color} />;\n};\n\nconst BeadPreview = () => {\n  const beadsTemplate = useSelector((state: Editor) => {\n    return state.ui.beadsTemplate;\n  });\n\n  const bead = buildBead(beadsTemplate);\n\n  return <FieldBeadPreview bead={bead} />;\n};\n","import React, { useRef, useState } from \"react\";\nimport { Editor, EditorMode } from \"../editorObjects/Editor\";\nimport { EditorModes } from \"./Toolbar/EditorModes\";\n// import { AddLineMode } from \"./Line/AddLineMode\";\n// import { EditorChangeState } from \"./Toolbar/EditorChangeState\";\nimport { useSelector, useStore, useDispatch } from \"react-redux\";\nimport { MouseSelectionBeads } from \"./Bead/MouseSelectionBeads\";\n// import { MouseSelectionLines } from \"./Line/MouseSelectionLines\";\nimport { DisplayBeads } from \"./Bead/DisplayBeads\";\n// import { DisplayLines } from \"./Line/DisplayLines\";\nimport { GroupSelectionPlaceholder } from \"./operations/GroupSelectionPlaceholder\";\n// import { PickBeadColor } from \"./Toolbar/PickColor\";\n// import { ChangeLinePosition } from \"./Toolbar/ChangeLinePosition\";\n// import { PickBeadType } from \"./Toolbar/PickBeadType\";\n// import { ChangeBeadRotate } from \"./Toolbar/ChangeBeadRotate\";\n// import { LineInspector } from \"./Toolbar/LineInspector\";\n// import { Actions } from \"../store\";\n// import { EditToolbar } from \"./Toolbar/EditToolbar\";\n// import { ToolbarEditLines } from \"./Toolbar/Modes/ToolbarEditLines\";\nimport { ToolbarEditBeads } from \"./Toolbar/Modes/ToolbarEditBeads\";\n// import { ToolbarAddLine } from \"./Toolbar/Modes/ToolbarAddLine\";\nimport { ToolbarIdle } from \"./Toolbar/Modes/ToolbarIdle\";\nimport { DisplayGridLines } from \"./operations/DisplayGridLines\";\nimport { TopbarMain } from \"./Topbar/TopbarMain\";\nimport { TopbarSecoundary } from \"./Topbar/TopbarSecoundary\";\nimport { Brush } from \"./operations/Brush\";\nimport { ToolbarPaint } from \"./Toolbar/Modes/ToolbarPaint\";\nimport { BackgroundImage } from \"./operations/BackgroundImage\";\nimport { AddBeadsMode } from \"./Bead/AddBeadsMode\";\nimport { ToolbarAddBeads } from \"./Toolbar/Modes/ToolbarAddBeads\";\nimport { PanZoom } from \"react-easy-panzoom\";\nimport { Actions } from \"../immerReducers/store\";\nimport { ReactReduxContext } from \"react-redux\";\nimport ReactResizeDetector from \"react-resize-detector\";\n\nexport const EditorScene = () => {\n  const dispatch = useDispatch();\n  const editorMode = useSelector((state: Editor) => {\n    return state.mode;\n  });\n  const store = useStore();\n  const state = store.getState();\n  console.log(\"EditorRerender: \", state);\n\n  // @TODO: Dodac funkcje ktora zostaje uruchomiona po rozpoczeciu aplikajci\n  // const dispatch = useDispatch();\n  // const [firstPass, setFirstPass] = useState(false);\n  // useEffect(() => {\n  //   if (process.env.NODE_ENV && process.env.NODE_ENV === \"development\") {\n  //     if (firstPass === false) {\n  //       dispatch(Actions.Persist.action_readSavedCanvas());\n  //       // dispatch(\n  //       //   Actions.ChangeEditorMode.action_onChangeEditorMode(\n  //       //     EditorMode.EditLines\n  //       //   )\n  //       // );\n  //       // dispatch(Actions.Draggable.action_onClickLastestLine());\n  //       setFirstPass(true);\n  //     }\n  //   }\n  // });\n\n  const panZoomRef = useRef<any>(null);\n\n  if (!state) {\n    return <div>Error in app</div>;\n  }\n\n  // const preventPan = (event, x, y) => {\n  //   console.log('??', event, x, y)\n  //   return true;\n  // }\n\n  const onStateChange = event => {\n    if (panZoomRef && panZoomRef.current !== null) {\n      const boundingClientRect = panZoomRef.current.getContainerBoundingRect();\n      dispatch(\n        Actions.Draggable.action_updateSceneZoom({\n          ...event,\n          top: boundingClientRect.top,\n          left: boundingClientRect.left\n        })\n      );\n    } else {\n      dispatch(\n        Actions.Draggable.action_updateSceneZoom({\n          ...event,\n          top: 0,\n          left: 0\n        })\n      );\n    }\n  };\n  const onResizeSceneWrapper = (width, height) => {\n    dispatch(\n      Actions.Draggable.action_updateSceneWrapperSize({\n        width,\n        height\n      })\n    );\n  };\n\n  // const updatePosition = (event) => {\n  //   dispatch(Actions.Draggable.action_updatePanZoomWrapperRect(event));\n  // }\n\n  return (\n    <div className=\"scene\">\n      <div className=\"topbar-wrapper\">\n        <TopbarMain />\n        <TopbarSecoundary />\n      </div>\n\n      <div className=\"actions-wrapper\">\n        <EditorModes editorMode={editorMode} />\n      </div>\n\n      <div className={\"scene-wrapper\"}>\n        <ReactResizeDetector\n          handleWidth\n          handleHeight\n          skipOnMount={false}\n          onResize={onResizeSceneWrapper}\n        />\n        {/* <PanZoom\n          style={{ width: \"100%\", height: \"100%\", position: \"absolute\" }}\n          disabled={editorMode !== EditorMode.Idle}\n          ref={panZoomRef}\n          onStateChange={onStateChange}\n          keyMapping={{\n            \"87\": { x: 0, y: -1, z: 0 },\n            \"83\": { x: 0, y: 1, z: 0 },\n            \"65\": { x: -1, y: 0, z: 0 },\n            \"68\": { x: 1, y: 0, z: 0 }\n          }}\n        >\n          <div>{`This content can be panned and zoomed.`}</div>\n          <BackgroundImage />\n\n          <AddBeadsMode isActive={editorMode === EditorMode.AddBeads} />\n\n          <MouseSelectionBeads\n            isVisible={editorMode === EditorMode.EditBeads}\n          />\n\n          <DisplayBeads mode={editorMode} />\n\n         \n\n          <DisplayGridLines isVisible={editorMode === EditorMode.EditLines} />\n\n          <GroupSelectionPlaceholder mode={editorMode} />\n\n          <Brush isVisible={editorMode === EditorMode.PaintBeads} />\n        </PanZoom> */}\n        {/* <DisplayLines mode={editorMode} /> */}\n        {/* <AddLineMode isActive={editorMode === EditorMode.AddLine} /> */}\n\n        {/* <MouseSelectionLines isVisible={editorMode === EditorMode.EditLines} /> */}\n      </div>\n\n      <div className={\"toolbar-wrapper\"}>\n        {/* <ToolbarEditLines isVisible={editorMode === EditorMode.EditLines} /> */}\n        <ToolbarEditBeads isVisible={editorMode === EditorMode.EditBeads} />\n        {/* <ToolbarAddLine isVisible={editorMode === EditorMode.AddLine} /> */}\n        <ToolbarIdle isVisible={editorMode === EditorMode.Idle} />\n        <ToolbarPaint isVisible={editorMode === EditorMode.PaintBeads} />\n        <ToolbarAddBeads isVisible={editorMode === EditorMode.AddBeads} />\n\n        {/* <ChangeLinePosition mode={editorMode} />\n\n        <PickBeadType mode={editorMode} />\n        <ChangeBeadRotate mode={editorMode} />\n        <PickBeadColor mode={editorMode} />\n        <LineInspector mode={editorMode} />\n\n        <EditToolbar mode={editorMode} /> */}\n      </div>\n    </div>\n  );\n};\n\n// class PanZoomWrapper extends React.Component<{ children, updatePosition }> {\n//   htmlDivInstance: HTMLDivElement | null = null;\n//   componentDidMount() {\n//     if (this.htmlDivInstance !== null) {\n//       const boundingClientRect = this.htmlDivInstance.getBoundingClientRect();\n//       this.props.updatePosition(boundingClientRect);\n//     }\n//   }\n//   render() {\n//     return (\n//       <div ref={refInstance => this.htmlDivInstance = refInstance}>\n//         {this.props.children}\n//       </div>\n//     )\n//   }\n// }\n","import { createStore } from \"redux\";\nimport { store } from \"./store\";\n\nexport const appStore = createStore(\n  store\n  // \"__REDUX_DEVTOOLS_EXTENSION__\" in window &&\n  //   (window as any).__REDUX_DEVTOOLS_EXTENSION__()\n);\n","import React from \"react\";\nimport \"bulma/css/bulma.css\";\nimport \"./App.css\";\nimport { EditorScene } from \"./components/Editor\";\nimport { Provider } from \"react-redux\";\nimport { appStore } from \"./immerReducers/appStore\";\nimport { buildBead } from \"./editorObjects/Bead\";\nimport { Actions } from \"./immerReducers/store\";\n\nconst App: React.FC = () => {\n  console.log(\"render App.tsx\");\n\n  React.useEffect(() => {\n    appStore.dispatch({\n      type: \"startAppEvent\",\n      payload: { state: appStore.getState() },\n    });\n\n    appStore.dispatch(Actions.Persist.action_readSavedCanvas());\n  }, []);\n\n  return (\n    <div className=\"App\">\n      <Provider store={appStore}>\n        <EditorScene />\n      </Provider>\n    </div>\n  );\n};\n\nexport default App;\n\n// \"homepage\": \"https://rpcal.github.io/coralinio-preview/build/\",\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\n// import * as Sentry from '@sentry/browser';\nimport { renderThreejs } from './threejs/renderThreejs';\n// import { EventEmitter } from 'stream';\n\n// Sentry.init({dsn: \"https://94d8408ba8ab4a369c83de035643afa2@sentry.io/1807713\"});\n\nReactDOM.render(<App />, document.getElementById('root'));\n\nrenderThreejs(document.getElementById('threejs'))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}