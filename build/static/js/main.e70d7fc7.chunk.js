(this.webpackJsonpcoralinio=this.webpackJsonpcoralinio||[]).push([[0],{133:function(e){e.exports=JSON.parse('{"name":"coralinio","version":"0.1.58","private":true,"dependencies":{"@fortawesome/fontawesome-svg-core":"^1.2.34","@fortawesome/free-regular-svg-icons":"^5.15.2","@fortawesome/free-solid-svg-icons":"^5.15.2","@fortawesome/react-fontawesome":"^0.1.14","@sentry/browser":"^6.2.0","@tweenjs/tween.js":"^18.6.4","@types/history":"^4.7.8","@types/jest":"26.0.20","@types/lodash":"^4.14.168","@types/node":"14.14.31","@types/rc-slider":"^8.6.6","@types/react":"17.0.2","@types/react-color":"^3.0.4","@types/react-dnd":"^3.0.2","@types/react-dom":"17.0.1","@types/react-redux":"^7.1.16","@types/react-router-dom":"^5.1.7","@types/redux":"^3.6.0","@types/reselect":"^2.2.0","@types/three":"^0.125.3","animejs":"^3.2.1","bulma":"^0.9.2","dayjs":"^1.10.4","history":"^5.0.0","http-server":"^0.12.3","immer":"^8.0.1","immer-reducer":"^0.7.11","immutability-helper":"^3.1.1","lodash":"^4.17.21","rc-slider":"^9.7.1","react":"^17.0.1","react-color":"^2.19.3","react-dnd":"^13.1.1","react-dnd-html5-backend":"^12.1.1","react-dnd-touch-backend":"^12.0.0","react-dom":"^17.0.1","react-draggable":"^4.4.3","react-easy-panzoom":"^0.4.4","react-number-format":"^4.4.4","react-redux":"^7.2.2","react-resize-detector":"^6.6.0","react-router-dom":"^5.2.0","react-scripts":"4.0.3","react-tooltip":"^4.2.15","redux":"^4.0.5","redux-thunk":"^2.3.0","reselect":"^4.0.0","shortid":"^2.2.16","three":"^0.126.0","ts-essentials":"^7.0.1","typescript":"^4.2.2","use-context-selector":"^1.3.7"},"scripts":{"http-server":"http-server ./build/","start":"react-scripts start","build":"react-scripts build","untouched__test":"react-scripts test","test_mocha":"npx ts-mocha -p test/tsconfig.json","test":"xvfb-run --auto-servernum --server-num=1 -s \\"-ac -screen 0 1280x1024x24\\" `which npm` run test_mocha","test_react":"xvfb-run --auto-servernum --server-num=1 -s \\"-ac -screen 0 1280x1024x24\\" `which npm` run untouched__test","eject":"react-scripts eject","push":"git add -A . && git commit -m \'up\' && git push","goToPreview":"cd ../../../coralinio-preview/","clear":"rm -rf /home/robson/www/private/coralinio-preview/build","copy":"cp -R build/ /home/robson/www/private/coralinio-preview","publish":"npm run clear && npm run copy && cd ../../../coralinio-preview/ && git add -A . && git commit -m \'up\' && git push","deploy:app":"npm version patch && npm run build && npm run push && npm run publish","convert:obj2gltf":"npx obj2gltf -i ./3dmodels/input.obj -o ./3dmodels/output.gltf"},"homepage":".","eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@types/chai":"^4.2.16","@types/mocha":"^8.2.2","@types/styled-components":"^5.1.7","canvas":"^2.7.0","chai":"^4.3.4","gh-pages":"^3.1.0","gl":"^4.9.0","ignore-styles":"^5.0.1","jsdom":"16.5.2","jsdom-global":"3.0.2","mocha":"^8.3.2","node-gyp":"^8.0.0","nyc":"^15.1.0","obj2gltf":"^3.1.0","raw-loader":"^4.0.2","styled-components":"^5.2.1","ts-mocha":"^8.0.0","ts-node":"^9.1.1"}}')},141:function(e,t,n){},256:function(e,t,n){"use strict";n.r(t);var i,o,a,s=n(0),c=n.n(s),r=n(24),d=n.n(r),l=n(19),u=(n(140),n(141),n(32)),p=n(22),h=n(17),b=n(18),v=n(8),f={"Content-Type":"application/json"},j=function(e,t){console.error("request error",e),t("err")},g=!1,m=(new Date).getTime(),y=[];!function(e){e.CREATE="CREATE",e.UPDATE="UPDATE",e.DELETE="DELETE"}(a||(a={}));var x=function(e){!0===g&&e.length>0&&(e.forEach((function(e){y.push(e)})),O())},O=Object(v.debounce)((function(){return w()}),500,{trailing:!0}),w=function(){var e=(new Date).getTime();if(console.log("triggerSendBatchEvents: diff: ",e-m,y.length>0),y.length>0&&void 0!==o){var t=JSON.stringify({changes:y});y=[],function(e,t){new Promise((function(n,o){return fetch(i+"api/boards/events/"+e,{method:"POST",headers:f,body:t}).then((function(e){return e.json()})).then((function(e){e.statusCode&&200!==e.statusCode&&o(e.message),n({status:e.statusCode})})).catch((function(e){return j(e,o)}))}))}(o,t)}m=e};Date.prototype.toISOString||function(){function e(e){return e<10?"0"+e:e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}();var D,E,k,S=n(1),I=function(e){var t=Object(p.f)(),n=c.a.useState({boards:[]}),o=Object(l.a)(n,2),a=o[0],s=o[1];return c.a.useEffect((function(){new Promise((function(e,t){return fetch(i+"api/boards/list",{method:"GET",headers:f}).then((function(e){return e.json()})).then((function(n){n.statusCode&&200!==n.statusCode&&t(n.message),e({boards:n.boards})})).catch((function(e){return j(e,t)}))})).then((function(e){s({boards:e.boards})}))}),[]),Object(S.jsx)(C,{children:Object(S.jsxs)("div",{children:[Object(S.jsx)("h2",{children:"Boards"}),Object(S.jsx)("button",{onClick:function(){var e;new Promise((function(t,n){return fetch(i+"api/boards/create",{method:"POST",headers:f,body:JSON.stringify({name:null!==e&&void 0!==e?e:""})}).then((function(e){return e.json()})).then((function(e){e.statusCode&&200!==e.statusCode&&n(e.message),t({board:e.board})})).catch((function(e){return j(e,n)}))})).then((function(e){t.push("/board/".concat(e.board.uuid))}))},className:"btn-primary",children:"Create board"}),Object(S.jsxs)("table",{children:[Object(S.jsx)("thead",{children:Object(S.jsxs)("tr",{children:[Object(S.jsx)("th",{children:"name"}),Object(S.jsx)("th",{children:"actions"})]})}),Object(S.jsxs)("tbody",{children:[Object(S.jsxs)("tr",{children:[Object(S.jsx)("td",{children:"Board1"}),Object(S.jsx)("td",{children:Object(S.jsx)(u.b,{to:"/board/demo",children:"DemoBoards"})})]}),a.boards.map((function(e){return Object(S.jsxs)("tr",{children:[Object(S.jsx)("td",{children:e.name}),Object(S.jsx)("td",{children:Object(S.jsx)(u.b,{to:"/board/".concat(e.uuid),children:"Edit"})})]},e.uuid)}))]})]}),Object(S.jsx)(u.b,{className:"btn-light",to:"/",children:"Back Home"})]})})},C=b.a.div(D||(D=Object(h.a)(["\n  padding: 1em;\n  table {\n    width: 100%;\n    max-width: 100%;\n    margin-bottom: 1rem;\n    background-color: transparent;\n  }\n  table td,\n  table th {\n    padding: 0.75rem;\n    vertical-align: top;\n    border-top: 1px solid #dee2e6;\n  }\n  table th {\n    color: #000;\n    background-color: #e9ecef;\n    border-color: #e9ecef;\n    vertical-align: bottom;\n    border-bottom: 2px solid #dee2e6;\n  }\n  table tbody tr:hover td {\n    color: #495057;\n    background-color: #e9ecef;\n    border-color: #dee2e6;\n  }\n  .btn-primary {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #fff;\n    background-color: #007bff;\n    border-color: #007bff;\n    margin-bottom: 10px;\n  }\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #f8f9fa;\n    margin-bottom: 10px;\n  }\n  h2{\n    margin-bottom: .5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n"]))),T=n(15);!function(e){e.TOHO_MIYUKI="TOHO_MIYUKI",e.TOHO_15="TOHO_15",e.TOHO_SPHERE="TOHO_SPHERE"}(E||(E={})),function(e){e.Shiny="Shiny",e.Mat="Mat"}(k||(k={}));var B,M,A;!function(e){e.Rectangles="Rectangles"}(B||(B={})),function(e){e.Rectangle="Rectangle",e.Triangle="Triangle",e.Circle="Circle"}(M||(M={})),function(e){e.Bead="Bead",e.Region="Region",e.Group="Group",e.PreviewProject3D="PreviewProject3D",e.SceneEditBBox="SceneEditBBox",e.SceneBackgroundGrid="SceneBackgroundGrid",e.SceneLight="SceneLight"}(A||(A={}));var _,P,R,N,H="__";!function(e){e.Idle="Idle",e.EditLines="EditLines",e.AddLine="AddLine",e.SelectOrMove="SelectOrMove",e.SelectMultiple="SelectMultiple",e.AddBeads="AddBeads",e.DeleteBeads="DeleteBeads",e.PaintBeads="ColorPaint",e.AddRegion="AddRegion"}(_||(_={})),function(e){e.None="None",e.File="File",e.Grid="Grid",e.Background="Background"}(P||(P={})),function(e){e.Hex="Hex",e.Box="Box"}(R||(R={})),function(e){e.Color="Color"}(N||(N={}));var U,z,L,G,F=n(13);!function(e){e.EditBeadProduct="EditBeadProduct",e.EditBeadType="EditBeadType",e.EditBeadMaterial="EditBeadMaterial",e.EditBeadColor="EditBeadColor",e.EditRegionGridType="EditRegionGridType",e.EditRegionGridSettings="EditRegionGridSettings",e.EditPosition="EditPosition",e.EditRotate="EditRotate",e.EditWidthHeight="EditWidthHeight",e.EditWidthHeightDepth="EditWidthHeightDepth",e.Alignment="Alignment",e.Lock="Lock",e.Unlock="Unlock",e.Group="Group",e.Ungroup="Ungroup",e.More="More"}(L||(L={})),function(e){e.EditBeadsProperies="EditBeadsProperies",e.EditRegionProperies="EditRegionProperies",e.Transform="Transform",e.LockOrUnlock="LockOrUnlock",e.GroupOrUngroup="GroupOrUngroup",e.More="More"}(G||(G={}));var Y,W,X=(U={},Object(F.a)(U,A.Bead,[L.EditBeadProduct,L.EditBeadType,L.EditBeadMaterial,L.EditBeadColor,L.Alignment,L.EditWidthHeightDepth,L.EditPosition,L.EditRotate,L.Group,L.Ungroup,L.Lock,L.Unlock,L.More]),Object(F.a)(U,A.Region,[L.EditRegionGridType,L.EditRegionGridSettings,L.EditWidthHeight,L.EditPosition,L.Group,L.Ungroup,L.Lock,L.Unlock,L.More]),Object(F.a)(U,A.Group,[L.EditPosition,L.Group,L.Ungroup,L.Lock,L.Unlock,L.More]),Object(F.a)(U,A.PreviewProject3D,[L.EditPosition,L.Group,L.Ungroup,L.Lock,L.Unlock,L.More]),U),V=(z={},Object(F.a)(z,L.EditBeadProduct,{name:L.EditBeadProduct,sortOrder:10,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(F.a)(z,L.EditBeadType,{name:L.EditBeadType,sortOrder:20,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(F.a)(z,L.EditBeadMaterial,{name:L.EditBeadMaterial,sortOrder:30,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(F.a)(z,L.EditBeadColor,{name:L.EditBeadColor,sortOrder:40,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(F.a)(z,L.EditRegionGridType,{name:L.EditRegionGridType,sortOrder:10,groupId:G.EditRegionProperies,groupSortOrder:40}),Object(F.a)(z,L.EditRegionGridSettings,{name:L.EditRegionGridSettings,sortOrder:20,groupId:G.EditRegionProperies,groupSortOrder:40}),Object(F.a)(z,L.EditPosition,{name:L.EditPosition,sortOrder:10,groupId:G.Transform,groupSortOrder:60}),Object(F.a)(z,L.EditRotate,{name:L.EditRotate,sortOrder:20,groupId:G.Transform,groupSortOrder:60}),Object(F.a)(z,L.EditWidthHeight,{name:L.EditWidthHeight,sortOrder:30,groupId:G.Transform,groupSortOrder:60}),Object(F.a)(z,L.EditWidthHeightDepth,{name:L.EditWidthHeightDepth,sortOrder:30,groupId:G.Transform,groupSortOrder:60}),Object(F.a)(z,L.Alignment,{name:L.Alignment,sortOrder:50,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(F.a)(z,L.Lock,{name:L.Lock,sortOrder:10,groupId:G.LockOrUnlock,groupSortOrder:90}),Object(F.a)(z,L.Unlock,{name:L.Unlock,sortOrder:20,groupId:G.LockOrUnlock,groupSortOrder:90}),Object(F.a)(z,L.Group,{name:L.Group,sortOrder:10,groupId:G.GroupOrUngroup,groupSortOrder:80}),Object(F.a)(z,L.Ungroup,{name:L.Ungroup,sortOrder:20,groupId:G.GroupOrUngroup,groupSortOrder:80}),Object(F.a)(z,L.More,{name:L.More,sortOrder:1,groupId:G.More,groupSortOrder:100}),z),Z=n(11),q=n(12);!function(e){e.AddObjects="AddObjects",e.DuplicateObjects="DuplicateObjects",e.RemoveObjects="RemoveObjects",e.ChangeSelectObjects="ChangeSelectObjects",e.ChangeObjectsProperty="ChangeObjectsProperty",e.ChangeObjectsAlignment="ChangeObjectsAlignment",e.ClipboardCut="ClipboardCut",e.ClipboardCopy="ClipboardCopy",e.ClipboardPaste="ClipboardPaste",e.AddMultipleBeads="AddMultipleBeads",e.ChangeUiSettings="ChangeUiSettings",e.ChangeUiSettingsZoom="ChangeUiSettingsZoom",e.ChangeUiSettingsSidebar="ChangeUiSettingsSidebar",e.GroupObjects="GroupObjects",e.UngroupObjects="UngroupObjects"}(Y||(Y={})),function(e){e.X_MIN="X_MIN",e.X_MAX="X_MAX",e.X_MIDDLE="X_MIDDLE",e.Y_MIN="Y_MIN",e.Y_MAX="Y_MAX",e.Y_MIDDLE="Y_MIDDLE"}(W||(W={}));var K,J,Q=n(3),$={objects:{},selectedIds:[],history:{canRedo:!1,canUndo:!1,events:[]},board:{uuid:"",name:"",canEdit:!0,canToggleToFavourite:!0,isFavourite:!1,canExportAsImage:!0,editModalVisible:!1},ui:{modalSearchProducts:{isOpen:!1,successAction:void 0},leftSidebar:{isOpen:!1,panel:void 0},rightSidebar:{isOpen:!1,panel:void 0},zoomScale:1,mode:_.SelectOrMove,lights:[{id:Q.q.generateUUID(),type:"THREE.DirectionalLight",name:"main_light_1",color:"#FFF",intensity:.8,position:{x:0,y:0,z:10}},{id:Q.q.generateUUID(),type:"THREE.DirectionalLight",name:"main_light_2",color:"#FFF",intensity:.4,position:{x:0,y:0,z:10}}],grid:{id:Q.q.generateUUID(),type:R.Hex,hexSize:30,snapEnabled:!0,isVisible:!0,width:30,height:30},selectedTopBarPosition:void 0,blockThreejs:{loading:!0,error:void 0}}},ee={objects:{},selectedIds:[],history:{canRedo:!1,canUndo:!1,events:[]},board:{canEdit:!1,canToggleToFavourite:!1,uuid:"",isFavourite:!1,name:"...",canExportAsImage:!0,editModalVisible:!1},ui:Object(v.cloneDeep)($.ui)},te=function(){return K},ne=function(e){console.log("APPSTORE: setStore",e,e.selectedIds),K=e},ie=n(2),oe=n(4),ae=n(6),se=n(7),ce=n(16),re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:e,y:t,z:n}},de=function(e,t,n){return n.x>e.x&&n.x<t.x&&n.y>e.y&&n.y<t.y};!function(e){e.MAIN="MAIN",e.ANY="beadChildOf",e.SELECTION="SELECTION",e.SELECTION_CHILD="SELECTION_CHILD"}(J||(J={}));var le,ue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.MAIN;return"".concat(A.Bead).concat(H).concat(e).concat(H).concat(t)},pe=function(e,t){return Object(v.merge)({},e,{name:ue(e.id,t)})},he=function(e){var t={id:Q.q.generateUUID(),position:re(0,0),type:E.TOHO_15,material:k.Mat,rotateX:90,rotateY:0,rotateZ:0,lineRotate:0,color:"#4fc3f7",height:10,width:10,depth:10,keepAspectRatio:!1,canLockOrUnlock:!0,isLocked:!1,objectType:A.Bead,groupId:void 0,regionId:void 0};return Object(v.merge)(t,e)};!function(e){e.MAIN="MAIN",e.BG="BG",e.EDIT_CONTAINER="EDIT_CONTAINER",e.LINES="LINES",e.WHITE_DOT_BG="WHITE_DOT_BG",e.GRAY_DOT_BG="GRAY_DOT_BG",e.RESIZE_CONTAINER="RESIZE_CONTAINER",e.DOT_RESIZE_TOP_LEFT="DOT_RESIZE_TOP_LEFT",e.DOT_RESIZE_TOP_RIGHT="DOT_RESIZE_TOP_RIGHT",e.DOT_RESIZE_BOTTOM_LEFT="DOT_RESIZE_BOTTOM_LEFT",e.DOT_RESIZE_BOTTOM_RIGHT="DOT_RESIZE_BOTTOM_RIGHT"}(le||(le={}));var be,ve=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:le.MAIN;return"".concat(A.SceneEditBBox).concat(H).concat(e).concat(H).concat(t)},fe=function(e,t){return Object(v.merge)({},e,{name:ve(e.id,t)})};!function(e){e.MAIN="MAIN",e.BG="bg",e.ANY="GroupChildOf"}(be||(be={}));var je,ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be.MAIN;return"".concat(A.Group).concat(H).concat(e).concat(H).concat(t)},me=function(e,t){return Object(v.merge)({},e,{name:ge(e.id,t)})},ye=function(e){var t={id:Q.q.generateUUID(),position:re(0,0),rotateX:90,rotateY:0,rotateZ:0,height:10,width:10,depth:10,canLockOrUnlock:!0,isLocked:!1,objectType:A.Group,childrenIds:[]};return Object(v.merge)(t,e)};!function(e){e.MAIN="MAIN",e.BG="BG",e.ANY="PreviewProject3DChildOf"}(je||(je={}));var xe,Oe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je.MAIN;return"".concat(A.PreviewProject3D).concat(H).concat(e).concat(H).concat(t)},we=function(e,t){return Object(v.merge)({},e,{name:Oe(e.id,t)})};!function(e){e.MAIN="main",e.BG="bg",e.GRID_CELLS="GRID_CELLS",e.GRID_CELL="gridCell",e.CONTENT="content"}(xe||(xe={}));var De,Ee,ke=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xe.MAIN;return"".concat(A.Region).concat(H).concat(e).concat(H).concat(t)},Se=function(e,t){return Object(v.merge)({},e,{name:ke(e.id,t)})},Ie=function(e){var t={id:Q.q.generateUUID(),position:re(0,0),gridType:B.Rectangles,shape:M.Rectangle,height:10,width:10,beadIds:[],opacity:.5,columns:3,rows:3,autoFillBeads:!1,snapBeadsToCell:!0,canLockOrUnlock:!0,isLocked:!1,objectType:A.Region,childrenGridIds:[],depth:1,rotateX:0,rotateY:0,rotateZ:0},n=Object(v.merge)(t,e),i=n.rows*n.columns,o=Array(i).fill(void 0);return n.childrenGridIds=Object(v.merge)(o,e.childrenGridIds),n},Ce=function(e,t){var n=void 0;if(t===A.Bead?n=ue(e):t===A.Region?n=ke(e):t===A.Group?n=ge(e):t===A.PreviewProject3D?n=Oe(e):t===A.SceneEditBBox&&(n=ve(e)),void 0!==n)return n;console.warn("name is empty for id",e)},Te=console,Be=Te.log,Me=Te.warn,Ae=Te.error,_e=function(){function e(){Object(ie.a)(this,e),this._events=void 0,this._events={}}return Object(oe.a)(e,[{key:"on",value:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)}},{key:"removeListener",value:function(e,t){if(this._events[e]){this._events[e]=this._events[e].filter((function(e){return e!==t}))}else Ae("Can't remove a listener. Event \"".concat(e,"\" doesn't exits."))}},{key:"emit",value:function(e,t,n){if(Be("EventEmitter:emit:",e,t),this._events[e]){this._events[e].forEach((function(e){e(t,n)}))}else Me("Can't emit an event. Event \"".concat(e,"\" doesn't exits."))}}]),e}();!function(e){e.updateEditorState="updateEditorState",e.action_changeSelectedBeads_color="action_changeSelectedBeads_color",e.action_changeSelectedBeads_height="action_changeSelectedBeads_height",e.action_changeSelectedBeads_width="action_changeSelectedBeads_width",e.action_changeSelectedBeads_depth="action_changeSelectedBeads_depth",e.action_changeSelectedBeads_type="action_changeSelectedBeads_type",e.action_changeSelectedBeads_rotate="action_changeSelectedBeads_rotate",e.action_selectBeads="action_selectBeads",e.action_deleteBeads="action_deleteBeads",e.action_addBeadOnClick="action_addBeadOnClick",e.action_updateLight="action_updateLight",e.action_readSavedCanvas="action_readSavedCanvas",e.startAppEvent="startAppEvent",e.action_movedSelected="action_movedSelected",e.action_changeBeadColorToBeadTemplate="action_changeBeadColorToBeadTemplate",e.action_fastAddBeads="action_fastAddBeads",e.action_snapToLineSelectedBeads="action_snapToLineSelectedBeads",e.action_onChangeEditorMode="action_onChangeEditorMode",e.action_deleteSelectedBeads="action_deleteSelectedBeads",e.action_addRegion="action_addRegion",e.action_selectRegions="action_selectRegions",e.action_selectIntersectObjects="action_selectIntersectObjects",e.action_updateZoomSCale="action_updateZoomSCale",e.action_updateEditBBox="action_updateEditBBox",e.action_unselectAll="action_unselectAll",e.action_selectIntersectObject="action_selectIntersectObject",e.action_moveClickedObject="action_moveClickedObject",e.action_moveAllSelectedObjects="action_moveAllSelectedObjects",e.action_deleteObjects="action_deleteObjects"}(Ee||(Ee={}));var Pe=n(36),Re=n.n(Pe),Ne=n(46),He=n(125),Ue={toho_sphere:{model:null,bbox:null},toho_miyuki:{model:null,bbox:null},toho_15:{model:null,bbox:null}},ze=function(){var e=Object(Ne.a)(Re.a.mark((function e(t){var n,i,o,a;return Re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new He.a,e.prev=1,e.next=4,n.loadAsync("/models3d/toho_sphere_v1_2020_02_24.obj");case 4:i=e.sent,console.log("OBJLoader: ","odczytano plik toho_sphere_v1_2020_02_24 "),Ue.toho_sphere.model=i.clone(),Ue.toho_sphere.bbox=(new Q.a).setFromObject(i),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("OBJLoader: ","nie mozna doczytac toho_sphere_v1_2020_02_24");case 13:return e.prev=13,e.next=16,n.loadAsync("/models3d/toho_miyuki_v2_2020_02_24.obj");case 16:o=e.sent,console.log("OBJLoader: ","odczytano plik diamondModelText "),Ue.toho_miyuki.model=o.clone(),Ue.toho_miyuki.bbox=(new Q.a).setFromObject(o),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),console.error("OBJLoader: ","nie mozna doczytac diamondModelText");case 25:return e.prev=25,e.next=28,n.loadAsync("/models3d/toho_miyuki_v2_2020_02_24.obj");case 28:a=e.sent,console.log("OBJLoader: ","odczytano plik modelToho15v3a "),Ue.toho_15.model=a.clone(),Ue.toho_15.bbox=(new Q.a).setFromObject(a),e.next=37;break;case 34:e.prev=34,e.t2=e.catch(25),console.error("OBJLoader: ","nie mozna doczytac modelToho15v3a");case 37:case"end":return e.stop()}}),e,null,[[1,10],[13,22],[25,34]])})));return function(t){return e.apply(this,arguments)}}(),Le=function(e){return e===E.TOHO_MIYUKI?Ue.toho_miyuki.bbox:e===E.TOHO_15?Ue.toho_15.bbox:e===E.TOHO_SPHERE?Ue.toho_sphere.bbox:null},Ge=n(68),Fe=n(41),Ye=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"updateEditorState",value:function(e){this.draftState.objects=e.objects,this.draftState.selectedIds=e.selectedIds,this.draftState.ui=e.ui,this.draftState.board=e.board,this.draftState.history=e.history}}]),n}(Fe.ImmerReducer),We={Main:Object(Fe.createActionCreators)(Ye)},Xe=Object(Fe.composeReducers)(Object(Fe.createReducerFunction)(Ye,$)),Ve=Object(Ge.b)(Xe),Ze=n(37),qe=function(){function e(){Object(ie.a)(this,e),this.boundingClientRect=void 0,this.mouse=void 0,this.raycaster=void 0,this.intersects=void 0,this.boundingClientRect=void 0,this.mouse=new Q.E,this.raycaster=new Q.B,this.intersects=[]}return Object(oe.a)(e,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){}},{key:"onMove",value:function(e){}},{key:"onUp",value:function(e){}},{key:"getIntersect",value:function(e,t){if(null!==Ht.el&&(this.boundingClientRect=Ht.el.getBoundingClientRect()),void 0===this.boundingClientRect)return[];var n=this.boundingClientRect,i=n.width,o=n.height,a=n.top,s=n.left;return this.mouse.x=(e-s)/i*2-1,this.mouse.y=-(t-a)/o*2+1,this.raycaster.setFromCamera(this.mouse,Ht.camera),this.raycaster.intersectObjects(Ht.scene.children,!0)}},{key:"getIntersectObjects",value:function(e,t){return this.getObjectsFromIntersect(this.getIntersect(e,t))}},{key:"getActiveObjectsFromIntersect",value:function(e,t){return this.getIntersect(e,t).filter((function(e){var t,n,i=e.object.userData,o=(t=null===i||void 0===i?void 0:i.isLocked,null!==(n=null===i||void 0===i?void 0:i.objectType)&&void 0!==n?n:void 0);return o===A.Bead||o===A.Region||o===A.Group||o===A.PreviewProject3D}))}},{key:"getObjectsFromIntersect",value:function(e){var t=A.Bead,n=A.Region,i=A.SceneEditBBox;return e.filter((function(e){var o,a,s,c=null!==(o=null===e||void 0===e||null===(a=e.object)||void 0===a||null===(s=a.userData)||void 0===s?void 0:s.objectType)&&void 0!==o?o:void 0;return c===t||c===n||c===i}))}},{key:"getIdsFromGroupOrInGroup",value:function(e){var t=te();if(void 0===t.objects[e])return[];var n=t.objects[e].objectType===A.Group,i=void 0!==t.objects[e].groupId&&t.objects[e].groupId.length>0,o=t.objects[e].groupId;return n?t.objects[e].childrenIds:i?[o].concat(Object(Ze.a)(t.objects[o].childrenIds)):[]}},{key:"groupObjectsByTypeFromIntersect",value:function(e,t){A.Bead,A.Region,A.SceneEditBBox;var n={Bead:[],Region:[],SceneEditBBox:[]},i=[];return e.forEach((function(e,o){var a,s,c,r,d,l,u,p,h;if(!(void 0!==t&&i.length>=t)){var b=null!==(a=null===e||void 0===e||null===(s=e.object)||void 0===s||null===(c=s.userData)||void 0===c?void 0:c.id)&&void 0!==a?a:void 0,v=null!==(r=null===e||void 0===e||null===(d=e.object)||void 0===d||null===(l=d.userData)||void 0===l?void 0:l.objectType)&&void 0!==r?r:void 0;u=null===e||void 0===e||null===(p=e.object)||void 0===p||null===(h=p.userData)||void 0===h?void 0:h.isLocked;void 0!==b&&void 0!==v&&(n[v].push(e),i.push(o))}})),n}}]),e}(),Ke=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.call(this)}return Object(oe.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){var t=Le(E.TOHO_15),n=1,i=1;t&&(n=Math.abs(t.max.x-t.min.x),i=Math.abs(t.max.y-t.min.y),Math.abs(t.max.z-t.min.z));var o=tn(e.clientX,e.clientY),a=o.x,s=o.y,c={name:Y.AddObjects,payload:{objects:[{position:{x:a,y:s,z:1},width:n,height:i,objectType:A.Bead}]}};Un(c)}},{key:"onMove",value:function(e){}},{key:"onUp",value:function(e){}}]),n}(qe),Je=function(){function e(){Object(ie.a)(this,e),this.isDragged=!1,this.isDragStarted=!1,this.end={x:0,y:0},this.start={x:0,y:0},this.shouldBehaveLikeMove=!1}return Object(oe.a)(e,[{key:"onDown",value:function(e,t){this.isDragStarted=!0,this.start.x=e,this.start.y=t,this.end.x=e,this.end.y=t}},{key:"onUp",value:function(){this.isDragStarted=!1,this.isDragged=!1,this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.shouldBehaveLikeMove=!1}},{key:"onMove",value:function(e,t){if(1==this.isDragStarted&&(this.end.x=e,this.end.y=t,!1===this.isDragged)){var n=this.start,i=this.end,o=i.x-n.x,a=i.y-n.y;(Math.abs(o)>5||Math.abs(a)>5)&&(this.isDragged=!0)}}}]),e}(),Qe=function(){function e(){Object(ie.a)(this,e),this.element=void 0,this.renderer=void 0,this.startPoint=void 0,this.pointTopLeft=void 0,this.pointBottomRight=void 0,this.isDown=void 0,this.element=document.createElement("div"),this.element.style.pointerEvents="none",this.element.style.background="rgba(75, 160, 255, 0.3)",this.element.style.border="1px solid #55aaff",this.element.style.position="absolute",this.element.style.zIndex="2",this.startPoint=new Q.E,this.pointTopLeft=new Q.E,this.pointBottomRight=new Q.E,this.isDown=!1}return Object(oe.a)(e,[{key:"setRenderer",value:function(e){this.renderer=e}},{key:"onDown",value:function(e,t){this.isDown=!0,this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e+"px",this.element.style.top=t+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e,this.startPoint.y=t}},{key:"onMove",value:function(e,t){this.isDown&&(this.pointBottomRight.x=Math.max(this.startPoint.x,e),this.pointBottomRight.y=Math.max(this.startPoint.y,t),this.pointTopLeft.x=Math.min(this.startPoint.x,e),this.pointTopLeft.y=Math.min(this.startPoint.y,t),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px")}},{key:"onUp",value:function(){null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element)}}]),e}(),$e=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){var e;return Object(ie.a)(this,n),(e=t.call(this)).isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.mouseDragHelper=void 0,e.mouse=void 0,e.raycaster=void 0,e.mouseSelectionHelper=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new Q.E,e.startDragCamera=new Q.E,e.mouseDragHelper=new Je,e.mouse=new Q.E,e.raycaster=new Q.B,e.mouseSelectionHelper=new Qe,e.mouseSelectionHelper.setRenderer(Ht.renderer),e}return Object(oe.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){if(null!==Ht.el&&(this.boundingClientRect=Ht.el.getBoundingClientRect()),void 0!==this.boundingClientRect){var t=this.boundingClientRect,n=t.top,i=t.left,o=e.clientX-i,a=e.clientY-n;this.mouseSelectionHelper.onDown(o,a);var s=tn(e.clientX,e.clientY),c=s.x,r=s.y;this.mouseDragHelper.onDown(c,r)}}},{key:"onMove",value:function(e){if(void 0!==this.boundingClientRect){var t=this.boundingClientRect,n=(t.width,t.height,t.top),i=t.left,o=e.clientX-i,a=e.clientY-n;this.mouseSelectionHelper.onMove(o,a);var s=tn(e.clientX,e.clientY),c=s.x,r=s.y;this.mouseDragHelper.onMove(c,r)}}},{key:"onUp",value:function(e){var t=Math.min(this.mouseDragHelper.start.x,this.mouseDragHelper.end.x),n=Math.min(this.mouseDragHelper.start.y,this.mouseDragHelper.end.y),i=Math.abs(this.mouseDragHelper.end.x-this.mouseDragHelper.start.x),o=Math.abs(this.mouseDragHelper.end.y-this.mouseDragHelper.start.y),a={name:Y.AddObjects,payload:{objects:[{objectType:A.Region,height:o,width:i,position:{x:t+i/2,y:n+o/2,z:1}}]}};Un(a);var s={name:Y.ChangeUiSettings,payload:{uiSettings:{mode:_.SelectOrMove}}};Un(s),this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}}]),n}(qe),et=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){var e;return Object(ie.a)(this,n),(e=t.call(this)).isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.mouseDragHelper=void 0,e.mouse=void 0,e.raycaster=void 0,e.mouseSelectionHelper=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new Q.E,e.startDragCamera=new Q.E,e.mouseDragHelper=new Je,e.mouse=new Q.E,e.raycaster=new Q.B,e.mouseSelectionHelper=new Qe,e.mouseSelectionHelper.setRenderer(Ht.renderer),e}return Object(oe.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){null!==Ht.el&&(this.boundingClientRect=Ht.el.getBoundingClientRect());var t=tn(e.clientX,e.clientY),n=t.x,i=t.y;if(this.mouseDragHelper.onDown(n,i),null===Ht.el)throw new Error("no el in dom");var o=Ht.el.getBoundingClientRect(),a=o.top,s=o.left,c=e.clientX-s,r=e.clientY-a;this.mouseSelectionHelper.onDown(c,r)}},{key:"onMove",value:function(e){}},{key:"onUp",value:function(e){if(!0===this.mouseDragHelper.isDragged);else if(!1===this.mouseDragHelper.isDragged&&!0===this.mouseDragHelper.isDragStarted&&null!==Ht.el){var t=Ht.el.getBoundingClientRect(),n=t.width,i=t.height,o=t.top,a=t.left;this.mouse.x=(e.clientX-a)/n*2-1,this.mouse.y=-(e.clientY-o)/i*2+1,this.intersects=this.getActiveObjectsFromIntersect(e.clientX,e.clientY);var s=this.intersects.length>0;if(s){console.log("usuwam firstClickedActiveObject",s,this.intersects[0].object.userData.id);var c=this.intersects[0].object.userData.id,r=this.getIdsFromGroupOrInGroup(c),d={name:Y.RemoveObjects,payload:{ids:[c].concat(Object(Ze.a)(r))}};Un(d)}}this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}}]),n}(qe),tt=function(e){(0,Ve.dispatch)(We.Main.updateEditorState(e))},nt={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",ArrowUp:"Up",ArrowDown:"Down",ArrowLeft:"Left",ArrowRight:"Right"},it=function(e){return!(!e||!e.tagName)&&("BUTTON"===e.tagName||"INPUT"===e.tagName||"SELECT"===e.tagName||"TEXTAREA"===e.tagName)},ot=function(e){},at=!1,st={},ct=void 0,rt={},dt=ot;function lt(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if("undefined"===typeof window)return!1;function i(){document[e]&&(st={})}null===n&&(ct=window.document),!it(ct),"undefined"!==typeof document.hidden?(e="hidden",t="visibilitychange"):"undefined"!==typeof document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),"undefined"===typeof document.addEventListener||void 0===e?console.warn("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API."):document.addEventListener(t,i,!1)}var ut=function(e,t){return(e=e.toLowerCase()).replace(/\s/,""),"undefined"===typeof rt[e]&&(rt[e]=[]),rt[e].push(t),{unsubscribe:function(){var n=rt[e].indexOf(t);rt[e].splice(n,1)}}};function pt(e){return!0===st[e]}function ht(e){st={}}function bt(e){!0===at&&e.preventDefault();var t=function(e){var t="",n=[];if("code"in e)t=nt[e.code]?nt[e.code]:e.code;else{var i=e.which;t=String.fromCharCode(i).toLowerCase(),nt[i]&&(t=nt[i])}return n.push(t),n.join("+")}(e),n=rt[t.toLowerCase()]||[];if("function"===typeof dt){var i=n.length>0;dt(t,i,e)}st[t.toLowerCase()]=!0,n.length>0&&e.preventDefault();for(var o=!0,a=n.length-1;a>=0&&(n[a]&&(o=n[a](e,Object.keys(st))),!1!==o);a--);}var vt,ft,jt,gt,mt,yt,xt,Ot=function(){function e(){Object(ie.a)(this,e),this.frustum=new Q.i,this.center=new Q.F,this.tmpPoint=new Q.F,this.vecNear=new Q.F,this.vecTopLeft=new Q.F,this.vecTopRight=new Q.F,this.vecDownRight=new Q.F,this.vecDownLeft=new Q.F,this.vecFarTopLeft=new Q.F,this.vecFarTopRight=new Q.F,this.vecFarDownRight=new Q.F,this.vecFarDownLeft=new Q.F,this.vectemp1=new Q.F,this.vectemp2=new Q.F,this.vectemp3=new Q.F,this.startPoint=void 0,this.endPoint=void 0,this.collection=void 0,this.deep=Number.MAX_VALUE,this.camera=void 0,this.scene=void 0,this.selectedIds=void 0,this.startPoint=new Q.F,this.endPoint=new Q.F,this.collection=[],this.selectedIds=[]}return Object(oe.a)(e,[{key:"setCamera",value:function(e){this.camera=e}},{key:"setScene",value:function(e){this.scene=e}},{key:"select",value:function(e,t){return this.startPoint=null!==e&&void 0!==e?e:this.startPoint,this.endPoint=null!==t&&void 0!==t?t:this.endPoint,this.collection=[],this.scene?(this.selectedIds=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(this.frustum,this.scene),this.selectedIds=[],this.collection):this.collection}},{key:"selectIds",value:function(e,t){return this.startPoint=null!==e&&void 0!==e?e:this.startPoint,this.endPoint=null!==t&&void 0!==t?t:this.endPoint,this.collection=[],this.scene?(this.selectedIds=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(this.frustum,this.scene),this.selectedIds):this.collection}},{key:"updateFrustum",value:function(e,t){if(this.camera){var n=null!==e&&void 0!==e?e:this.startPoint,i=null!==t&&void 0!==t?t:this.endPoint;if(n.x===i.x&&(i.x+=Number.EPSILON),n.y===i.y&&(i.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isOrthographicCamera){var o=Math.min(n.x,i.x),a=Math.max(n.y,i.y),s=Math.max(n.x,i.x),c=Math.min(n.y,i.y);this.vecTopLeft.set(o,a,-1),this.vecTopRight.set(s,a,-1),this.vecDownRight.set(s,c,-1),this.vecDownLeft.set(o,c,-1),this.vecFarTopLeft.set(o,a,1),this.vecFarTopRight.set(s,a,1),this.vecFarDownRight.set(s,c,1),this.vecFarDownLeft.set(o,c,1),this.vecTopLeft.unproject(this.camera),this.vecTopRight.unproject(this.camera),this.vecDownRight.unproject(this.camera),this.vecDownLeft.unproject(this.camera),this.vecFarTopLeft.unproject(this.camera),this.vecFarTopRight.unproject(this.camera),this.vecFarDownRight.unproject(this.camera),this.vecFarDownLeft.unproject(this.camera);var r=this.frustum.planes;r[0].setFromCoplanarPoints(this.vecTopLeft,this.vecFarTopLeft,this.vecFarTopRight),r[1].setFromCoplanarPoints(this.vecTopRight,this.vecFarTopRight,this.vecFarDownRight),r[2].setFromCoplanarPoints(this.vecFarDownRight,this.vecFarDownLeft,this.vecDownLeft),r[3].setFromCoplanarPoints(this.vecFarDownLeft,this.vecFarTopLeft,this.vecTopLeft),r[4].setFromCoplanarPoints(this.vecTopRight,this.vecDownRight,this.vecDownLeft),r[5].setFromCoplanarPoints(this.vecFarDownRight,this.vecFarTopRight,this.vecFarTopLeft),r[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}}},{key:"searchChildInFrustum",value:function(e,t){if((t.isMesh||t.isLine||t.isPoints)&&void 0!==t.material){var n,i=t.userData,o=null!==(n=null===i||void 0===i?void 0:i.id)&&void 0!==n?n:void 0;if(void 0!==o){var a,s=null!==(a=null===i||void 0===i?void 0:i.objectType)&&void 0!==a?a:void 0;if(!0===(s===A.Bead||s===A.Region||s===A.Group||s===A.PreviewProject3D)){var c=(new Q.a).setFromObject(t);e.intersectsBox(c)&&!1===this.selectedIds.includes(o)&&(this.collection.push(t),this.selectedIds.push(o))}}}if(t.children&&t.children.length>0)for(var r=0;r<t.children.length;r++)this.searchChildInFrustum(e,t.children[r])}}]),e}(),wt=function(){function e(){Object(ie.a)(this,e),this.isCameraGrabed=void 0,this.startDragMousePosition=void 0,this.startDragCamera=void 0,this.boundingClientRect=void 0,this.isCameraGrabed=!1,this.startDragMousePosition=new Q.E,this.startDragCamera=new Q.E}return Object(oe.a)(e,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){if(null!==Ht.el&&(this.boundingClientRect=Ht.el.getBoundingClientRect()),void 0===this.boundingClientRect)return[];this.isCameraGrabed=!0,this.boundingClientRect=Ht.el.getBoundingClientRect();var t=this.boundingClientRect,n=t.top,i=t.left,o=e.clientX-i,a=e.clientY-n;this.startDragMousePosition.x=o,this.startDragMousePosition.y=a,this.startDragCamera.x=Ht.camera.position.x,this.startDragCamera.y=Ht.camera.position.y}},{key:"onMove",value:function(e){if(void 0!==this.boundingClientRect&&!0===this.isCameraGrabed){var t=te(),n=this.boundingClientRect,i=n.top,o=n.left,a=e.clientX-o,s=e.clientY-i,c=t.ui.zoomScale,r=(this.startDragMousePosition.x-a)*c,d=(this.startDragMousePosition.y-s)*c,l=this.startDragCamera.x+r,u=this.startDragCamera.y-d;Ht.camera.position.x=l,Ht.camera.position.y=u,Ht.camera.lookAt(l,u,0)}}},{key:"onUp",value:function(e){this.boundingClientRect=void 0,!0===this.isCameraGrabed&&(this.isCameraGrabed=!1)}}]),e}(),Dt=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){var e;return Object(ie.a)(this,n),(e=t.call(this)).actionType=void 0,e.mouseDragHelper=void 0,e.selectionBox=void 0,e.mouseSelectionHelper=void 0,e.prevEditBBox=void 0,e.mouseEventsIdle=void 0,e.mouseDragHelper=new Je,e.mouseSelectionHelper=new Qe,e.mouseSelectionHelper.setRenderer(Ht.renderer),e.selectionBox=new Ot,e.selectionBox.setCamera(Ht.camera),e.selectionBox.setScene(Ht.scene),e.mouseEventsIdle=new wt,e.actionType=void 0,e}return Object(oe.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){if(console.log("MouseEventsEditorModeSelectOrMove: jak z kliknieciem???",Object.keys(st),pt("space")),pt("space")){this.actionType="moveCamera";var t=tn(e.clientX,e.clientY),n=t.x,i=t.y;return this.mouseDragHelper.onDown(n,i),this.mouseEventsIdle.onDown(e),void console.log("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}if(e.altKey){this.actionType="deselectMultipleObjects";var o=tn(e.clientX,e.clientY),a=o.x,s=o.y;if(this.mouseDragHelper.onDown(a,s),null!==Ht.el&&(this.boundingClientRect=Ht.el.getBoundingClientRect()),void 0===this.boundingClientRect)return;var c=this.boundingClientRect,r=c.top,d=c.left,l=c.width,u=c.height,p=e.clientX-d,h=e.clientY-r;return this.mouseSelectionHelper.onDown(p,h),this.selectionBox.startPoint.set((e.clientX-d)/l*2-1,-(e.clientY-r)/u*2+1,0),void console.log("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}if(e.shiftKey){this.actionType="selectMultipleObjects";var b=tn(e.clientX,e.clientY),v=b.x,f=b.y;if(this.mouseDragHelper.onDown(v,f),null!==Ht.el&&(this.boundingClientRect=Ht.el.getBoundingClientRect()),void 0===this.boundingClientRect)return;var j=this.boundingClientRect,g=j.top,m=j.left,y=j.width,x=j.height,O=e.clientX-m,w=e.clientY-g;return this.mouseSelectionHelper.onDown(O,w),this.selectionBox.startPoint.set((e.clientX-m)/y*2-1,-(e.clientY-g)/x*2+1,0),void console.log("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}if(this.actionType=void 0,this.intersects=this.getActiveObjectsFromIntersect(e.clientX,e.clientY),this.intersects.length>0){var D,E=te(),k=(D=this.intersects[0].object.userData.id,this.intersects[0].object.userData),S=k.id,I=E.selectedIds.includes(S),C=!1;if(E.selectedIds.forEach((function(e){!0===E.objects[e].isLocked&&(C=!0)})),!0===k.isLocked)Un(this.getSelectionForSingleObjectIdAction(S));else if(!0===C)Un(this.getSelectionForSingleObjectIdAction(S));else if(I){this.actionType="moveAllSelectedObjects";var T=tn(e.clientX,e.clientY),B=T.x,M=T.y;this.mouseDragHelper.onDown(B,M)}else{if(void 0!==k.objectType&&k.objectType===A.SceneEditBBox){this.actionType="moveEditBBox";var _=tn(e.clientX,e.clientY),P=_.x,R=_.y;this.mouseDragHelper.onDown(P,R)}else{var N=void 0!==k.objectType&&k.objectType===A.Group,H=void 0!==k.groupId&&k.groupId.length>0,U=N||H;this.actionType=U?"moveObjectGroup":"moveSingleObject";var z=tn(e.clientX,e.clientY),L=z.x,G=z.y;this.mouseDragHelper.onDown(L,G)}}}else{this.actionType="moveCamera";var F=tn(e.clientX,e.clientY),Y=F.x,W=F.y;this.mouseDragHelper.onDown(Y,W),this.mouseEventsIdle.onDown(e)}console.log("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}},{key:"onMove",value:function(e){if(void 0!==this.actionType){if("moveCamera"===this.actionType){var t=tn(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onMove(n,i),this.mouseEventsIdle.onMove(e),this.updateUIAtMove(!1)}"moveAllSelectedObjects"===this.actionType&&this.moveAllSelectedObjects(e.clientX,e.clientY),"moveSingleObject"===this.actionType&&this.moveSingleObject(e.clientX,e.clientY),"moveObjectGroup"===this.actionType&&this.moveObjectGroup(e.clientX,e.clientY),"moveEditBBox"===this.actionType&&this.moveEditBBox(e.clientX,e.clientY),"selectMultipleObjects"===this.actionType&&this.selectMultipleObjects(e.clientX,e.clientY,!0),"deselectMultipleObjects"===this.actionType&&this.selectMultipleObjects(e.clientX,e.clientY,!1)}}},{key:"onUp",value:function(e){if(void 0!==this.actionType){if("moveCamera"===this.actionType){if(this.mouseEventsIdle.onUp(e),!1===this.mouseDragHelper.isDragged){var t=te(),n={name:Y.ChangeSelectObjects,payload:{change:t.selectedIds.map((function(e){return{id:e,isSelected:!1}}))}};Un(n)}else{this.updateUIAtMove(!0);var i=te(),o=Object(ce.produce)(i,(function(e){var t=rn(i.selectedIds.map((function(e){return{id:e,objectType:i.objects[e].objectType}})));e.ui.selectedTopBarPosition=t}));ne(o),tt(o)}this.mouseDragHelper.onUp()}if("moveObjectGroup"===this.actionType)if(this.updateUIAtMove(!0),!0===this.mouseDragHelper.isDragged){var a,s,c,r,d;console.log("MouseEventsEditorModeSelectOrMove: aktualizuje pozycje groupy i wiele");var l=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,u=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,p=null!==(a=null===(s=this.intersects)||void 0===s||null===(c=s[0])||void 0===c||null===(r=c.object)||void 0===r||null===(d=r.userData)||void 0===d?void 0:d.id)&&void 0!==a?a:void 0;if(void 0!==p){var h=this.getIdsFromGroupOrInGroup(p);Un(this.getMoveObjectsAction([p].concat(Object(Ze.a)(h)),l,u))}this.mouseDragHelper.onUp()}else{var b,v,f,j,g,m=null!==(b=null===(v=this.intersects)||void 0===v||null===(f=v[0])||void 0===f||null===(j=f.object)||void 0===j||null===(g=j.userData)||void 0===g?void 0:g.id)&&void 0!==b?b:void 0;if(void 0!==m)if(pt("controlleft")||pt("controlright")||pt("shiftleft")||pt("shiftright")){var y=te(),x=void 0!==y.objects[m]&&!0===y.objects[m].isLocked,O=!1;y.selectedIds.forEach((function(e){!0===y.objects[e].isLocked&&(O=!0)})),!0===O||!1===x&&Un(this.getSelectionAppendAction([m],void 0,!1))}else{var w=te();if(0===w.selectedIds.length)Un(this.getSelectionForSingleObjectIdAction(m));else{var D=void 0!==w.objects[m]&&!0===w.objects[m].isLocked,E=!1;w.selectedIds.forEach((function(e){!0===w.objects[e].isLocked&&(E=!0)})),!0===E||!1===D&&Un(this.getSelectionForSingleObjectIdAction(m))}}console.log("MouseEventsEditorModeSelectOrMove: zaznaczam group"),this.mouseDragHelper.onUp()}if("moveSingleObject"===this.actionType)if(this.updateUIAtMove(!0),!0===this.mouseDragHelper.isDragged){var k,S,I,C,T;console.log("MouseEventsEditorModeSelectOrMove: aktualizuje pozycje single object");var B=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,M=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,A=null!==(k=null===(S=this.intersects)||void 0===S||null===(I=S[0])||void 0===I||null===(C=I.object)||void 0===C||null===(T=C.userData)||void 0===T?void 0:T.id)&&void 0!==k?k:void 0;void 0!==A&&Un(this.getMoveObjectsAction([A],B,M)),this.mouseDragHelper.onUp()}else{var _,P,R,N,H,U=null!==(_=null===(P=this.intersects)||void 0===P||null===(R=P[0])||void 0===R||null===(N=R.object)||void 0===N||null===(H=N.userData)||void 0===H?void 0:H.id)&&void 0!==_?_:void 0;if(void 0!==U)if(pt("controlleft")||pt("controlright")||pt("shiftleft")||pt("shiftright")){var z=te(),L=void 0!==z.objects[U]&&!0===z.objects[U].isLocked,G=!1;z.selectedIds.forEach((function(e){!0===z.objects[e].isLocked&&(G=!0)})),!0===G||!1===L&&Un(this.getSelectionAppendAction([U],void 0,!0))}else{var F=te();if(0===F.selectedIds.length)Un(this.getSelectionForSingleObjectIdAction(U));else{var W=void 0!==F.objects[U]&&!0===F.objects[U].isLocked,X=!1;F.selectedIds.forEach((function(e){!0===F.objects[e].isLocked&&(X=!0)})),!0===X||!1===W&&Un(this.getSelectionForSingleObjectIdAction(U))}}console.log("MouseEventsEditorModeSelectOrMove: zaznaczam single object"),this.mouseDragHelper.onUp()}if("moveAllSelectedObjects"===this.actionType)if(this.updateUIAtMove(!0),!0===this.mouseDragHelper.isDragged){console.log("MouseEventsEditorModeSelectOrMove: aktualizuje pozycje wszystkich zaznaczonych");var V=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,Z=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,q=te();Un(this.getMoveObjectsAction(q.selectedIds,V,Z)),void 0!==Ht.additionalData.selectedBBox&&(Ht.additionalData.selectedBBox.topLeft.x+=V,Ht.additionalData.selectedBBox.topLeft.y+=Z,Ht.additionalData.selectedBBox.topRight.x+=V,Ht.additionalData.selectedBBox.topRight.y+=Z,Ht.additionalData.selectedBBox.bottomLeft.x+=V,Ht.additionalData.selectedBBox.bottomLeft.y+=Z,Ht.additionalData.selectedBBox.bottomRight.x+=V,Ht.additionalData.selectedBBox.bottomRight.y+=Z),this.mouseDragHelper.onUp()}else{var K,J,Q,$,ee,ie=null!==(K=null===(J=this.intersects)||void 0===J||null===(Q=J[0])||void 0===Q||null===($=Q.object)||void 0===$||null===(ee=$.userData)||void 0===ee?void 0:ee.id)&&void 0!==K?K:void 0;(pt("controlleft")||pt("controlright")||pt("shiftleft")||pt("shiftright"))&&Un(this.getSelectionAppendAction([ie],void 0,!1)),this.mouseDragHelper.onUp()}if("moveEditBBox"===this.actionType)if(!0===this.mouseDragHelper.isDragged){console.log("MouseEventsEditorModeSelectOrMove: aktualizuje pozycje wszystkich zaznaczonych i edit bbox");var oe=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,ae=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,se=te();Un(this.getMoveObjectsAction(se.selectedIds,oe,ae)),this.mouseDragHelper.onUp()}else{var re=te(),de={name:Y.ChangeSelectObjects,payload:{change:re.selectedIds.map((function(e){return{id:e,isSelected:!1}}))}};Un(de),this.mouseDragHelper.onUp()}if("selectMultipleObjects"===this.actionType){if(pt("shiftleft")||pt("shiftright"))if(!1===this.mouseDragHelper.isDragged){if(this.intersects=this.getActiveObjectsFromIntersect(e.clientX,e.clientY),this.intersects.length>0){var le=this.intersects[0].object.userData.id;if(void 0!==le){var ue=te(),pe=void 0!==ue.objects[le]&&!0===ue.objects[le].isLocked,he=!1;ue.selectedIds.forEach((function(e){!0===ue.objects[e].isLocked&&(he=!0)})),!0===he||!1===pe&&Un(this.getSelectionAppendAction([le],void 0,!1))}}this.intersects=[]}else if(void 0!==this.boundingClientRect){var be=this.boundingClientRect,ve=be.top,fe=be.left,je=be.width,ge=be.height;this.selectionBox.endPoint.set((e.clientX-fe)/je*2-1,-(e.clientY-ve)/ge*2+1,1);var me=te(),ye=!1;if(me.selectedIds.forEach((function(e){!0===me.objects[e].isLocked&&(ye=!0)})),!0===ye);else{var xe=this.selectionBox.selectIds();Un(this.getSelectionAppendAction(xe,!0,!1))}}this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}if("deselectMultipleObjects"===this.actionType){if(pt("altleft")||pt("altright"))if(!1===this.mouseDragHelper.isDragged){if(this.intersects=this.getActiveObjectsFromIntersect(e.clientX,e.clientY),this.intersects.length>0){var Oe=this.intersects[0].object.userData.id;void 0!==Oe&&Un(this.getSelectionAppendAction([Oe],!1,!0))}this.intersects=[]}else if(void 0!==this.boundingClientRect){var we=this.boundingClientRect,De=we.top,Ee=we.left,ke=we.width,Se=we.height;this.selectionBox.endPoint.set((e.clientX-Ee)/ke*2-1,-(e.clientY-De)/Se*2+1,1);var Ie=this.selectionBox.selectIds();Un(this.getSelectionAppendAction(Ie,!1,!1))}this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}this.actionType=void 0}}},{key:"getMoveObjectsAction",value:function(e,t,n){var i=this,o=te(),a=[],s=[];return e.forEach((function(e){var c=i.getIdsFromGroupOrInGroup(e);void 0!==o.objects[e]&&!1===a.includes(e)&&(a.push(e),s.push({id:e,properties:{position:{x:o.objects[e].position.x+t,y:o.objects[e].position.y+n,z:o.objects[e].position.z}}})),c.forEach((function(i){void 0!==o.objects[i]&&!1===a.includes(e)&&(a.push(e),s.push({id:i,properties:{position:{x:o.objects[i].position.x+t,y:o.objects[i].position.y+n,z:o.objects[e].position.z}}}))}))})),{name:Y.ChangeObjectsProperty,payload:{changes:s}}}},{key:"getSelectionForSingleObjectIdAction",value:function(e){var t=this,n=te(),i=[];return n.selectedIds.forEach((function(e){var n=t.getIdsFromGroupOrInGroup(e);i.push({id:e,isSelected:!1}),n.forEach((function(e){i.push({id:e,isSelected:!1})}))})),i.push({id:e,isSelected:!0}),this.getIdsFromGroupOrInGroup(e).forEach((function(e){i.push({id:e,isSelected:!0})})),{name:Y.ChangeSelectObjects,payload:{change:i}}}},{key:"getSelectionAppendAction",value:function(e,t,n){var i=this,o=te(),a=[],s=null!==n&&void 0!==n&&n;return e.forEach((function(e){var n=void 0!==o.objects[e]&&!0===o.objects[e].isLocked;if(!0===s||!1===s&&!1===n){var c=!0===o.selectedIds.includes(e),r=void 0===t?!c:t,d=i.getIdsFromGroupOrInGroup(e);a.push({id:e,isSelected:r}),d.forEach((function(e){a.push({id:e,isSelected:r})}))}})),{name:Y.ChangeSelectObjects,payload:{change:a}}}},{key:"selectMultipleObjects",value:function(e,t,n){var i=tn(e,t),o=i.x,a=i.y;if(this.mouseDragHelper.onMove(o,a),void 0!==this.boundingClientRect){var s=this.boundingClientRect,c=s.top,r=s.left,d=(s.width,s.height,e-r),l=t-c;this.mouseSelectionHelper.onMove(d,l)}}},{key:"moveSingleObject",value:function(e,t){var n=te(),i=tn(e,t),o=i.x,a=i.y;this.mouseDragHelper.onMove(o,a);var s=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,c=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,r=this.intersects[0].object.userData,d=r.id;if(void 0!==d){var l=n.objects[d];if(void 0!==l){var u=Ce(d,l.objectType);if(void 0!==u){var p=Ht.scene.getObjectByUserDataProperty("name",u);if(void 0!==p){if(n.objects[d].objectType===A.Region){var h=n.objects[d];!0===h.snapBeadsToCell&&h.childrenGridIds.length>0&&h.childrenGridIds.forEach((function(e){if(void 0!==e&&void 0!==n.objects[e]){var t=n.objects[e];if(void 0===t)return void console.warn("object not exists in app",d);var i=Ce(t.id,t.objectType);if(void 0===i)return;var o=Ht.scene.getObjectByUserDataProperty("name",i);if(void 0===o)return void console.warn("object not found in app scene for id",d,i);o.position.x=n.objects[e].position.x+s,o.position.y=n.objects[e].position.y+c}}))}p.position.x=n.objects[d].position.x+s,p.position.y=n.objects[d].position.y+c,this.updateUIAtMove(!1)}else console.warn("object not found in app state for id",d,r)}}else console.warn("objectId not found in app store",d,r)}else console.warn("objectId not found in clicked item",r)}},{key:"moveObjectGroup",value:function(e,t){var n=te(),i=tn(e,t),o=i.x,a=i.y;this.mouseDragHelper.onMove(o,a);var s=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,c=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,r=this.intersects[0].object.userData,d=r.id;if(void 0!==d){var l=n.objects[d];if(void 0!==l){void 0!==l.groupId&&l.groupId.length>0&&(d=l.groupId,l=n.objects[d]);var u=Ce(d,l.objectType);if(void 0!==u){var p=Ht.scene.getObjectByUserDataProperty("name",u);void 0!==p?(p.position.x=n.objects[d].position.x+s,p.position.y=n.objects[d].position.y+c,l.childrenIds.forEach((function(e){var t=n.objects[e];if(void 0!==t){var i=Ce(t.id,t.objectType);if(void 0!==i){var o=Ht.scene.getObjectByUserDataProperty("name",i);void 0!==o?(o.position.x=n.objects[e].position.x+s,o.position.y=n.objects[e].position.y+c):console.warn("object not found in app scene for id",e,i)}}else console.warn("object not exists in app",e)})),this.updateUIAtMove(!1)):console.warn("object not found in app state for id",d)}}else console.warn("objectId not found in app store",d)}else console.warn("objectId not found in clicked item",r)}},{key:"moveEditBBox",value:function(e,t){this.moveAllSelectedObjects(e,t);te()}},{key:"moveAllSelectedObjects",value:function(e,t){var n=tn(e,t),i=n.x,o=n.y;this.mouseDragHelper.onMove(i,o);var a=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,s=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,c=te();c.selectedIds.forEach((function(e){var t=c.objects[e];if(void 0!==t){var n=Ce(t.id,t.objectType);if(void 0!==n){var i=Ht.scene.getObjectByUserDataProperty("name",n);if(void 0!==i){if(c.objects[e].objectType===A.Region){if(void 0!==Ht.additionalData.selectedBBox)for(var o=Ht.scene.children.length-1;o>=0;o--)if(4===Ht.scene.children[o].layers.mask){var r=Ht.scene.children[o].userData.name;Ht.scene.children[o].position.x=Ht.additionalData.selectedBBox[r].x+a,Ht.scene.children[o].position.y=Ht.additionalData.selectedBBox[r].y+s}var d=c.objects[e];!0===d.snapBeadsToCell&&d.childrenGridIds.length>0&&d.childrenGridIds.forEach((function(t){if(void 0!==t&&void 0!==c.objects[t]){var n=c.objects[t];if(void 0===n)return void console.warn("object not exists in app",e);var i=Ce(n.id,n.objectType);if(void 0===i)return;var o=Ht.scene.getObjectByUserDataProperty("name",i);if(void 0===o)return void console.warn("object not found in app scene for id",e,i);o.position.x=c.objects[t].position.x+a,o.position.y=c.objects[t].position.y+s}}))}i.position.x=c.objects[e].position.x+a,i.position.y=c.objects[e].position.y+s}else console.warn("object not found in app scene for id",e,n)}}else console.warn("object not exists in app",e)})),this.updateUIAtMove(!1)}},{key:"updateUIAtMove",value:function(e){!1===e?this.hideTopBar():this.showTopBar()}},{key:"hideTopBar",value:function(){var e=document.querySelector(".selected-objects-top-bar");null!==e&&(e.style.display="none")}},{key:"showTopBar",value:function(){var e=document.querySelector(".selected-objects-top-bar");null!==e&&(e.style.display="block")}}]),n}(qe),Et=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){var e;return Object(ie.a)(this,n),(e=t.call(this)).isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new Q.E,e.startDragCamera=new Q.E,e}return Object(oe.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){if(this.isCameraGrabed=!0,null!==Ht.el){this.boundingClientRect=Ht.el.getBoundingClientRect();var t=this.boundingClientRect,n=t.top,i=t.left,o=e.clientX-i,a=e.clientY-n;this.startDragMousePosition.x=o,this.startDragMousePosition.y=a,this.startDragCamera.x=Ht.camera.position.x,this.startDragCamera.y=Ht.camera.position.y}}},{key:"onMove",value:function(e){if(void 0!==this.boundingClientRect&&!0===this.isCameraGrabed){var t=(0,Ve.getState)(),n=this.boundingClientRect,i=n.top,o=n.left,a=e.clientX-o,s=e.clientY-i,c=t.ui.zoomScale,r=(this.startDragMousePosition.x-a)*c,d=(this.startDragMousePosition.y-s)*c,l=this.startDragCamera.x+r,u=this.startDragCamera.y-d;Ht.camera.position.x=l,Ht.camera.position.y=u,Ht.camera.lookAt(l,u,0)}}},{key:"onUp",value:function(e){this.boundingClientRect=void 0,!0===this.isCameraGrabed&&(this.isCameraGrabed=!1)}}]),n}(qe),kt=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){var e;return Object(ie.a)(this,n),(e=t.call(this)).isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.mouseDragHelper=void 0,e.mouse=void 0,e.raycaster=void 0,e.mouseSelectionHelper=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new Q.E,e.startDragCamera=new Q.E,e.mouseDragHelper=new Je,e.mouse=new Q.E,e.raycaster=new Q.B,e.mouseSelectionHelper=new Qe,e.mouseSelectionHelper.setRenderer(Ht.renderer),e}return Object(oe.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){null!==Ht.el&&(this.boundingClientRect=Ht.el.getBoundingClientRect());var t=tn(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onDown(n,i)}},{key:"onMove",value:function(e){var t=Ve.getState;Ve.dispatch,t();if(void 0!==this.boundingClientRect&&!0===this.mouseDragHelper.isDragStarted){var n=this.boundingClientRect,i=n.width,o=n.height,a=n.top,s=n.left;this.mouse.x=(e.clientX-s)/i*2-1,this.mouse.y=-(e.clientY-a)/o*2+1,this.raycaster.setFromCamera(this.mouse,Ht.camera);this.raycaster.intersectObjects(Ht.scene.children,!0);var c=e.clientX-s,r=e.clientY-a;this.mouseSelectionHelper.onMove(c,r)}}},{key:"onUp",value:function(e){var t=Ve.getState;Ve.dispatch,t();if(!0===this.mouseDragHelper.isDragged);else if(!1===this.mouseDragHelper.isDragged&&!0===this.mouseDragHelper.isDragStarted){if(void 0===this.boundingClientRect)return;var n=this.boundingClientRect,i=n.width,o=n.height,a=n.top,s=n.left;this.mouse.x=(e.clientX-s)/i*2-1,this.mouse.y=-(e.clientY-a)/o*2+1,this.raycaster.setFromCamera(this.mouse,Ht.camera);this.raycaster.intersectObjects(Ht.scene.children,!0)}this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}}]),n}(qe),St=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){var e;return Object(ie.a)(this,n),(e=t.call(this)).isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.mouseDragHelper=void 0,e.mouse=void 0,e.raycaster=void 0,e.selectionBox=void 0,e.mouseSelectionHelper=void 0,e.prevEditBBox=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new Q.E,e.startDragCamera=new Q.E,e.mouseDragHelper=new Je,e.mouse=new Q.E,e.raycaster=new Q.B,e.mouseSelectionHelper=new Qe,e.mouseSelectionHelper.setRenderer(Ht.renderer),e.selectionBox=new Ot,e.selectionBox.setCamera(Ht.camera),e.selectionBox.setScene(Ht.scene),e}return Object(oe.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){}},{key:"onMove",value:function(e){}},{key:"onUp",value:function(e){}}]),n}(qe),It=void 0,Ct=function(e,t){if(e&&t){var n=new Q.E;n.x=e,n.y=t,It=n}else It=void 0};function Tt(e){if(e.preventDefault(),null!==Ht.el){var t=te(),n={name:Y.ChangeUiSettingsZoom,payload:{zoomType:"zoomByScroll",useAnimation:!1,clientX:e.clientX,clientY:e.clientY,scrollDelta:e.deltaY}};Un(n),t.ui.mode===_.Idle?vt.onWheel(e):t.ui.mode===_.SelectOrMove?ft.onWheel(e):t.ui.mode===_.DeleteBeads?gt.onWheel(e):t.ui.mode===_.PaintBeads?jt.onWheel(e):t.ui.mode===_.AddRegion?mt.onWheel(e):t.ui.mode===_.AddBeads?yt.onWheel(e):t.ui.mode===_.SelectMultiple&&xt.onWheel(e)}}function Bt(e){if(null!==Ht.el){var t=Ht.el.getBoundingClientRect(),n=t.width,i=t.height;Ht.camera.left=n/-2,Ht.camera.right=n/2,Ht.camera.top=i/2,Ht.camera.bottom=i/-2,Ht.camera.updateProjectionMatrix(),Ht.renderer.setSize(n,i)}var o=te();o.ui.mode===_.Idle?vt.onResize(e):o.ui.mode===_.SelectOrMove?ft.onResize(e):o.ui.mode===_.DeleteBeads?gt.onResize(e):o.ui.mode===_.PaintBeads?jt.onResize(e):o.ui.mode===_.AddRegion?mt.onResize(e):o.ui.mode===_.AddBeads?yt.onResize(e):o.ui.mode===_.SelectMultiple&&xt.onResize(e)}function Mt(e){var t=te();t.ui.mode===_.Idle?vt.onDown(e):t.ui.mode===_.SelectOrMove?ft.onDown(e):t.ui.mode===_.DeleteBeads?gt.onDown(e):t.ui.mode===_.PaintBeads?jt.onDown(e):t.ui.mode===_.AddRegion?mt.onDown(e):t.ui.mode===_.AddBeads?yt.onDown(e):t.ui.mode===_.SelectMultiple&&xt.onDown(e)}function At(e){var t=te();t.ui.mode===_.AddBeads?yt.onUp(e):t.ui.mode===_.Idle?vt.onUp(e):t.ui.mode===_.SelectOrMove?ft.onUp(e):t.ui.mode===_.DeleteBeads?gt.onUp(e):t.ui.mode===_.PaintBeads?jt.onUp(e):t.ui.mode===_.AddRegion?mt.onUp(e):t.ui.mode===_.SelectMultiple&&xt.onUp(e)}function _t(e){Ct(void 0,void 0),At(e)}function Pt(e){Ct(e.clientX,e.clientY);var t=te();t.ui.mode===_.Idle?vt.onMove(e):t.ui.mode===_.SelectOrMove?ft.onMove(e):t.ui.mode===_.PaintBeads?jt.onMove(e):t.ui.mode===_.AddRegion?mt.onMove(e):t.ui.mode===_.DeleteBeads?gt.onMove(e):t.ui.mode===_.AddBeads?yt.onMove(e):t.ui.mode===_.SelectMultiple&&xt.onMove(e)}var Rt,Nt,Ht,Ut=function(){var e=Ht.el.getBoundingClientRect(),t=e.left,n=e.left+10,i=e.top,o=e.top+10,a=tn(t,i),s=tn(n,o),c=Math.max(a.x,s.x),r=Math.min(a.x,s.x),d=Math.min(a.y,s.y),l=Math.max(a.y,s.y);return{min:{x:r,y:d},max:{x:c,y:l},w:c-r,h:l-d}},zt=function(){function e(){Object(ie.a)(this,e),this.events=[],this.index=0,this.maxHistoryRecords=100}return Object(oe.a)(e,[{key:"push",value:function(e){var t=this.events.length;if(t!==this.index&&this.events.splice(this.index,t-this.index),this.events.push(e),this.index+=1,this.events.length>this.maxHistoryRecords){var n=this.events.length-this.maxHistoryRecords;this.events.splice(0,n),this.index=this.index-n}}},{key:"front",value:function(){var e=this.events[this.index];return this.index+=1,this.index>this.events.length&&(this.index=this.events.length),e}},{key:"back",value:function(){var e=this.events[this.index-1];return this.index-=1,this.index<=0&&(this.index=0),e}},{key:"getSimpleHistoryEvents",value:function(){var e=this;return this.events.map((function(t,n){return{name:t.do.name,isActive:n<e.index,createdAt:t.createdAt}}))}},{key:"canRedo",value:function(){return this.index!==this.events.length}},{key:"canUndo",value:function(){return this.index>0}}]),e}(),Lt=function(){var e=Ft().back();void 0!==e&&Un(e.undo,!1)},Gt=function(){var e=Ft().front();void 0!==e&&Un(e.redo,!1)},Ft=function(){return Rt},Yt=void 0,Wt=function(e){Yt=e},Xt=function(){var e={name:Y.ClipboardCopy,payload:{}};Un(e)},Vt=function(){var e={name:Y.ClipboardCut,payload:{}};Un(e)},Zt=function(){if(void 0!==Yt){var e={name:Y.ClipboardPaste,payload:{objects:Yt.objects}};Un(e)}},qt=function(){try{var e=document.createElement("div");e.setAttribute("id","thumbnailsGeneratorRoot"),Nt=new Kt(e),e.appendChild(Nt.renderer.domElement),e.style.display="none",document.body.appendChild(e)}catch(t){console.error("initThumbnailsGenerator err:",t.toString())}},Kt=function(){function e(t){Object(ie.a)(this,e),this.el=void 0,this.scene=void 0,this.renderer=void 0,this.cache=void 0,this.el=t,this.cache={},this.scene=new Q.C,this.scene.background=new Q.d("#fff"),this.renderer=new Q.G({antialias:!0,preserveDrawingBuffer:!0})}return Object(oe.a)(e,[{key:"getObjectThumbnail",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o={imgWidth:t,imgHeight:n,width:e.width,height:e.height,depth:e.depth,rotateX:e.rotateX,rotateY:e.rotateY,rotateZ:e.rotateZ};e.objectType===A.Bead&&(o.type=e.type,o.color=e.color);var a=JSON.stringify(o);if(!0===i||void 0===this.cache[a]){var s=this.createObjectThumbnail(e,t,n);if(void 0===s)return;this.cache[a]=s}return this.cache[a]}},{key:"createObjectThumbnail",value:function(e,t,n){var i=this;try{if(this.renderer.setSize(t,n),this.scene.clear(),e.objectType!==A.Bead)return void console.warn("object.objectType not supported yet");var o=pn(e,this.scene);if(void 0===o)return void console.warn("triggerAddBeadToScene object not created in scene");o.position.x=0,o.position.y=0;var a=new Q.a;a.expandByObject(o);var s=1,c=1;a&&(s=Math.abs(a.max.x-a.min.x),c=Math.abs(a.max.y-a.min.y));var r=t/n,d=1,l=1;r<s/c?l=(d=s)*r:d=(l=c)/r;var u=(d+.1*d)/2,p=(l+.1*l)/2,h=new Q.x(-1*u,u,p,-1*p,0,1e3);h.position.set(0,0,500),h.lookAt(0,0,0),te().ui.lights.forEach((function(e){sn(e,i.scene)})),this.renderer.render(this.scene,h);var b=this.renderer.domElement.toDataURL("image/png");return this.scene.clear(),b}catch(v){return void console.log("getObjectThumbnail error:",v)}}}]),e}(),Jt=function(){var e=Object(Ne.a)(Re.a.mark((function e(t,n,i){var o;return Re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t){e.next=3;break}return console.warn("no html el element found"),e.abrupt("return");case 3:return!1===t.classList.contains("active")&&t.classList.add("active"),e.prev=4,K=Object(v.cloneDeep)($),Rt=new zt,lt(),Ht=new Qt(t,n,i),t.appendChild(Ht.renderer.domElement),e.next=12,ze(Ht);case 12:window.addEventListener("resize",Bt,!1),Ht.el.addEventListener("pointerdown",Mt,!1),Ht.el.addEventListener("pointermove",Pt,!1),Ht.el.addEventListener("pointerup",At,!1),Ht.el.addEventListener("mouseout",_t,!1),Ht.el.addEventListener("wheel",Tt,!1),vt=new Et,ft=new Dt,jt=new kt,gt=new et,mt=new $e,yt=new Ke,xt=new St,on(),requestAnimationFrame($t),void 0!==ct&&(ct.addEventListener("keydown",bt),ct.addEventListener("keyup",ht)),o=Ut(),Ht.camera.userData={sceneScale:1,rect10x10FromScreenToWorld:o},ut("keyz",(function(e,t){return(e.ctrlKey||e.metaKey)&&(console.log("listener:: undohistory"),Lt()),!1})),ut("keyy",(function(e,t){return(e.ctrlKey||e.metaKey)&&(console.log("listener:: redohistory"),Gt()),!1})),ut("keyc",(function(e,t){return(e.ctrlKey||e.metaKey)&&(console.log("listener:: copy"),Xt()),!1})),ut("keyx",(function(e,t){return(e.ctrlKey||e.metaKey)&&(console.log("listener:: cut"),Vt()),!1})),ut("keyv",(function(e,t){return(e.ctrlKey||e.metaKey)&&(console.log("listener:: paste"),Zt()),!1})),ut("delete",(function(e,t){console.log("listener:: delete");var n=te();if(n.selectedIds.length>0){var i={name:Y.RemoveObjects,payload:{ids:n.selectedIds}};Un(i)}return!1})),qt(),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(4),console.error("err:",e.t0.toString());case 30:return e.abrupt("return");case 31:case"end":return e.stop()}}),e,null,[[4,27]])})));return function(t,n,i){return e.apply(this,arguments)}}(),Qt=function e(t,n,i){Object(ie.a)(this,e),this.el=void 0,this.camera=void 0,this.scene=void 0,this.renderer=void 0,this.additionalData=void 0,this.el=t;var o=t.getBoundingClientRect(),a=o.width,s=o.height;this.additionalData={selectedBBox:void 0},this.camera=new Q.x(a/-2,a/2,s/2,s/-2,0,1e3),this.camera.position.set(0,0,500),this.camera.lookAt(0,0,0),this.camera.layers.enable(2),this.scene=new Q.C,this.scene.background=new Q.d("#f2f2f2"),this.renderer=new Q.G({canvas:null!==n&&void 0!==n?n:void 0,context:null!==i&&void 0!==i?i:void 0,antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setSize(a,s)};function $t(){(function(e){var t=e.domElement,n=t.clientWidth,i=t.clientHeight,o=t.width!==n||t.height!==i;o&&e.setSize(n,i,!1);return o})(Ht.renderer)&&Ht.camera.updateProjectionMatrix(),Ht.renderer.render(Ht.scene,Ht.camera),requestAnimationFrame($t)}Q.w.prototype.getObjectByUserDataProperty=function(e,t){if(this.userData[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var o=this.children[n].getObjectByUserDataProperty(e,t);if(void 0!==o)return o}};var en,tn=function(e,t){if(null===Ht.el)throw new Error("no el in dom");if(!Ve)throw new Error("no el in dom");var n=te().ui.zoomScale,i=Ht.el.getBoundingClientRect(),o=i.width,a=i.height,s=t-i.top,c=(e-i.left-o/2)*n+Ht.camera.position.x,r=(a/2-s)*n+Ht.camera.position.y;return new Q.E(c,r)},nn=function(e){if(!Ve)throw new Error("no el in dom");var t=Ht.el.getBoundingClientRect(),n=t.width,i=t.height,o=t.top,a=t.left,s=e.clone(),c=n/2,r=i/2;return s.project(Ht.camera),s.x=s.x*c+c+a,s.y=-s.y*r+r+o,s},on=function(){var e=(void 0===De&&(De=new _e),De);e.on(Ee.action_changeSelectedBeads_color,(function(e){e.beadIds.forEach((function(t){var n=ue(t),i=Ht.scene.getObjectByUserDataProperty("name",n);void 0!==i&&i.traverse((function(t){t instanceof Q.r&&t.material&&t.material.color.set(e.color)}))}))})),e.on(Ee.action_changeSelectedBeads_height,(function(e){e.beads.forEach((function(e){var t=ue(e.id),n=Ht.scene.getObjectByUserDataProperty("name",t);if(void 0!==n){var i=Le(e.type),o=1,a=1,s=1;i&&(o=Math.abs(i.max.x-i.min.x),a=Math.abs(i.max.y-i.min.y),s=Math.abs(i.max.z-i.min.z)),n.scale.x=e.width/o,n.scale.y=e.height/a,n.scale.z=e.depth/s}})),jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_unselectAll,(function(e){e.diffStateSelectedIds.forEach((function(e){e.objectType===A.Bead?ln(e.id,e.isSelected):e.objectType===A.Region&&gn(e.id,e.isSelected)})),jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_changeSelectedBeads_width,(function(e){e.beads.forEach((function(e){var t=ue(e.id),n=Ht.scene.getObjectByUserDataProperty("name",t);if(void 0!==n){var i=Le(e.type),o=1,a=1,s=1;i&&(o=Math.abs(i.max.x-i.min.x),a=Math.abs(i.max.y-i.min.y),s=Math.abs(i.max.z-i.min.z)),n.scale.x=e.width/o,n.scale.y=e.height/a,n.scale.z=e.depth/s}})),jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_changeSelectedBeads_depth,(function(e){e.beads.forEach((function(e){var t=ue(e.id),n=Ht.scene.getObjectByUserDataProperty("name",t);if(void 0!==n){var i=Le(e.type),o=1,a=1,s=1;i&&(o=Math.abs(i.max.x-i.min.x),a=Math.abs(i.max.y-i.min.y),s=Math.abs(i.max.z-i.min.z)),n.scale.x=e.width/o,n.scale.y=e.height/a,n.scale.z=e.depth/s}})),jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_changeSelectedBeads_type,(function(e){e.beadIds.forEach((function(e){var t=ue(e),n=Ht.scene.getObjectByUserDataProperty("name",t);void 0!==n&&Ht.scene.remove(n)})),e.beads.forEach((function(e){pn(e,Ht.scene),ln(e.id,!0)})),jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_changeSelectedBeads_rotate,(function(e){e.beadIds.forEach((function(t){var n=ue(t),i=Ht.scene.getObjectByUserDataProperty("name",n);void 0!==i&&(i.rotation.x=Q.q.DEG2RAD*e.rotateX,i.rotation.y=Q.q.DEG2RAD*e.rotateY,i.rotation.z=Q.q.DEG2RAD*e.rotateZ)})),jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_selectBeads,(function(e){e.diffStates.forEach((function(e){var t=Object.keys(e)[0],n=Object.values(e)[0];ln(t,n)}))})),e.on(Ee.action_selectIntersectObject,(function(e){e.diffStateSelectedIds.forEach((function(e){e.objectType===A.Bead?ln(e.id,e.isSelected):e.objectType===A.Region&&gn(e.id,e.isSelected)})),jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_selectIntersectObjects,(function(e){var t,n,i,o,a,s;(null===e||void 0===e||null===(t=e.selectedBeads)||void 0===t?void 0:t.diffStates)&&(null===(i=e.selectedBeads)||void 0===i||null===(o=i.diffStates)||void 0===o||o.forEach((function(e){var t=Object.keys(e)[0],n=Object.values(e)[0];ln(t,n)})));(null===e||void 0===e||null===(n=e.selectedRegions)||void 0===n?void 0:n.diffStates)&&(null===(a=e.selectedRegions)||void 0===a||null===(s=a.diffStates)||void 0===s||s.forEach((function(e){var t=Object.keys(e)[0],n=Object.values(e)[0];gn(t,n)})));jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_updateZoomSCale,(function(e){jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_updateEditBBox,(function(e){jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_selectRegions,(function(e){var t=[];e.diffStates.forEach((function(e){var n=Object.keys(e)[0],i=Object.values(e)[0];gn(n,i),!0===i&&t.push(n)}))})),e.on(Ee.action_deleteBeads,(function(e){fn(e.beadIds)})),e.on(Ee.action_deleteSelectedBeads,(function(e){fn(e.beadIds)})),e.on(Ee.action_deleteObjects,(function(e){vn(e.toDeleteObjectIds)})),e.on(Ee.action_addBeadOnClick,(function(e){var t=e.bead;pn(t,Ht.scene)})),e.on(Ee.action_updateLight,(function(e){var t=e.name,n=(e.field,e.value,Ht.scene.getObjectByUserDataProperty("name",t));if(void 0!==n){var i=n;"color"===e.field&&(i.color=e.value),"intensity"===e.field&&(i.intensity=e.value)}})),e.on(Ee.action_addRegion,(function(e){var t=e.region;un(t)})),e.on(Ee.action_moveClickedObject,(function(e){e.movedObjects.forEach((function(e){var t=Ce(e.id,e.objectType);if(void 0!==t){var n=Ht.scene.getObjectByUserDataProperty("name",t);void 0!==n&&(n.position.x=e.position.x,n.position.y=e.position.y)}}))})),e.on(Ee.action_moveAllSelectedObjects,(function(e){e.movedObjects.forEach((function(e){var t=Ce(e.id,e.objectType);if(void 0!==t){var n=Ht.scene.getObjectByUserDataProperty("name",t);void 0!==n&&(n.position.x=e.position.x,n.position.y=e.position.y)}})),jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.action_movedSelected,(function(e){e.beads.forEach((function(e){var t=ue(e.id,J.MAIN),n=Ht.scene.getObjectByUserDataProperty("name",t);void 0!==n&&(n.position.x=e.position.x,n.position.y=e.position.y)})),e.regions.forEach((function(e){var t=ke(e.id),n=Ht.scene.getObjectByUserDataProperty("name",t);void 0!==n&&(console.log("co bylo?",n.position.x,e.position.x),n.position.x=e.position.x,n.position.y=e.position.y)})),jn(e.editBBox,e.prevEditBBox)})),e.on(Ee.updateEditorState,(function(){})),e.on(Ee.action_changeBeadColorToBeadTemplate,(function(e){e.beads.forEach((function(t){var n=ue(t.id),i=Ht.scene.getObjectByUserDataProperty("name",n);void 0!==i&&i.traverse((function(t){t instanceof Q.r&&(t.material=new Q.v({flatShading:!0,reflectivity:1,color:e.color}))}))}))})),e.on(Ee.action_fastAddBeads,(function(e){Object.keys(e.beads).forEach((function(t){var n=e.beads[t];pn(n,Ht.scene)})),e.prevSelectedBeadIds.forEach((function(e){ln(e,!1)}))})),e.on(Ee.action_snapToLineSelectedBeads,(function(e){e.beads.forEach((function(e){var t=ue(e.id),n=Ht.scene.getObjectByUserDataProperty("name",t);void 0!==n&&(n.position.x=e.position.x,n.position.y=e.position.y)}))})),e.on(Ee.action_onChangeEditorMode,(function(e){e.prevSelectedBeadIds.forEach((function(e){ln(e,!1)}))})),e.on(Ee.action_readSavedCanvas,(function(e){Object.keys(e.objects).forEach((function(t){var n=e.objects[t];n.objectType===A.Bead?pn(n,Ht.scene):n.objectType===A.Region?un(n):n.objectType===A.Group?hn(n):n.objectType===A.PreviewProject3D&&bn(n)}))})),e.on(Ee.startAppEvent,(function(e){if(console.log("startAppEvent: ...",e.state.ui.lights),e.state.ui.lights&&e.state.ui.lights.length>0&&e.state.ui.lights.forEach((function(e){if("THREE.DirectionalLight"===e.type){var t,n,i,o,a,s,c=new Q.e(e.color,e.intensity);c.position.set(null!==(t=null===(n=e.position)||void 0===n?void 0:n.x)&&void 0!==t?t:0,null!==(i=null===(o=e.position)||void 0===o?void 0:o.y)&&void 0!==i?i:0,null!==(a=null===(s=e.position)||void 0===s?void 0:s.z)&&void 0!==a?a:10),c.name=e.name,c.userData=Object(v.merge)({},c,{objectType:A.SceneLight,name:"".concat(A.SceneLight).concat(H).concat(c.id)}),Ht.scene.add(c)}})),e.state.ui.grid.isVisible){var t=1e5,n=new Q.j(1,1e4,"#e9e9e9","#eee");n.position.x=0,n.position.y=0,n.position.z=-500,n.scale.x=t,n.scale.y=t,n.scale.z=t,n.rotation.x=90*Q.q.DEG2RAD,n.rotation.y=0*Q.q.DEG2RAD,n.rotation.z=0*Q.q.DEG2RAD,n.userData=Object(v.merge)({},e.state.ui.grid,{objectType:A.SceneBackgroundGrid,name:"".concat(A.SceneBackgroundGrid).concat(H).concat(e.state.ui.grid.id)}),Ht.scene.add(n)}}))},an=function(){Ht.scene.clear()},sn=function(e,t){if("THREE.DirectionalLight"===e.type){var n,i,o,a,s,c,r=new Q.e(e.color,e.intensity);r.position.set(null!==(n=null===(i=e.position)||void 0===i?void 0:i.x)&&void 0!==n?n:0,null!==(o=null===(a=e.position)||void 0===a?void 0:a.y)&&void 0!==o?o:0,null!==(s=null===(c=e.position)||void 0===c?void 0:c.z)&&void 0!==s?s:10),r.name=e.name,r.userData=Object(v.merge)({},r,{objectType:A.SceneLight,name:"".concat(A.SceneLight).concat(H).concat(r.id)}),t.add(r)}},cn=function(e){var t=e.objectType;t===A.Bead&&pn(e,Ht.scene),t===A.Region&&un(e),t===A.Group&&hn(e),t===A.PreviewProject3D&&bn(e)},rn=function(e){var t=new Q.a;return e.forEach((function(e){var n=Ce(e.id,e.objectType);if(void 0!==n){var i=Ht.scene.getObjectByUserDataProperty("name",n);void 0!==i&&t.expandByObject(i)}})),function(e){if(!1!==isFinite(e.min.x)&&!1!==isFinite(e.max.y)){var t=new Q.F;t.x=e.min.x+(e.max.x-e.min.x)/2,t.y=e.max.y;var n=nn(t);return n.x<0&&(n.x=0),n.y<70&&(n.y=70),n}}(t)},dn=function(e,t,n,i){var o=Ce(e,t);if(void 0!==o){var a=Ht.scene.getObjectByUserDataProperty("name",o);void 0!==a&&(a.position.x=n,a.position.y=i)}},ln=function(e,t){var n=ue(e),i=Ht.scene.getObjectByUserDataProperty("name",n);if(void 0!==i)if(i.traverse((function(e){e instanceof Q.r&&e.material&&(!0===t?e.material.emissive.set(1513239):e.material.emissive.set(0))})),!0===t){var o=new Q.a;o.expandByObject(i);var a=o.min.x,s=o.min.y,c=Math.abs(o.max.x-o.min.x),r=Math.abs(o.max.y-o.min.y),d=(new Q.D).moveTo(.5,.5).lineTo(-.5,.5).lineTo(-.5,-.5).lineTo(.5,-.5);d.autoClose=!0;var l=d.getPoints(),u=(new Q.b).setFromPoints(l),p=new Q.s({color:16624}),h=new Q.l(u,p);h.userData=pe(i.userData,J.SELECTION_CHILD);var b=new Q.k;b.userData=pe(i.userData,J.SELECTION),b.userData.position.x=a+c/2,b.userData.position.y=s+r/2,b.position.x=a+c/2,b.position.y=s+r/2,b.position.z=-460,b.scale.x=c,b.scale.y=r,b.scale.z=1,b.add(h),i.attach(b)}else{var v=ue(e,J.SELECTION),f=Ht.scene.getObjectByUserDataProperty("name",v);if(void 0===f)return;i.remove(f)}},un=function(e){var t=new Q.y(1,1,1,1),n=new Q.s({color:"rgb(0,0,0)",side:Q.h,opacity:.1,transparent:!0}),i=new Q.r(t,n);i.userData=Se(e,xe.BG);var o=new Q.k;o.userData=Se(e,xe.GRID_CELLS),Object(v.times)(e.rows).forEach((function(t,n){Object(v.times)(e.columns).forEach((function(n,i){var a=1/e.columns,s=1/e.rows,c=a-0,r=s-0,d=(new Q.D).moveTo(c/2,r/2).lineTo(c/2*-1,r/2).lineTo(c/2*-1,r/2*-1).lineTo(c/2,r/2*-1);d.autoClose=!0;var l=d.getPoints(),u=(new Q.b).setFromPoints(l),p=new Q.s({color:16624}),h=new Q.l(u,p);h.userData=Se(e,xe.GRID_CELL),h.position.x=n*a-.5+a/2,h.position.y=t*s-.5+s/2,o.add(h)}))}));var a=new Q.k;a.userData=Se(e,xe.MAIN),a.position.x=e.position.x,a.position.y=e.position.y,a.position.z=-300,a.scale.x=e.width,a.scale.y=e.height,a.scale.z=1,a.rotation.x=Q.q.DEG2RAD*e.rotateX,a.rotation.y=Q.q.DEG2RAD*e.rotateY,a.rotation.z=Q.q.DEG2RAD*e.rotateZ,a.add(i),a.add(o),Ht.scene.add(a)},pn=function(e,t){var n=e.type,i=function(e){var t;if(e===E.TOHO_MIYUKI){if(null===Ue.toho_miyuki.model)return console.error("triggerAddBeadToScene: 3dModel is not loaded diamond"),t;t=Ue.toho_miyuki.model.clone()}if(e===E.TOHO_15){if(null===Ue.toho_15.model)return console.error("triggerAddBeadToScene: 3dModel is not loaded baseBead"),t;t=Ue.toho_15.model.clone()}if(e===E.TOHO_SPHERE){if(null===Ue.toho_sphere.model)return console.error("triggerAddBeadToScene: 3dModel is not loaded baseBead"),t;t=Ue.toho_sphere.model.clone()}return t}(n);if(void 0!==i){if(void 0===t.getObjectByUserDataProperty("id",e.id)){i.traverse((function(t){t.userData=pe(e,J.ANY),t instanceof Q.r&&(e.material===k.Mat?t.material=new Q.v({reflectivity:1,color:e.color}):e.material===k.Shiny?t.material=new Q.u({color:e.color}):console.warn("unknow BeadMaterialTypes:",e.material)),t.geometry&&t.geometry.computeBoundingBox()}));var o=Le(n),a=1,s=1,c=1;return o&&(a=Math.abs(o.max.x-o.min.x),s=Math.abs(o.max.y-o.min.y),c=Math.abs(o.max.z-o.min.z)),i.scale.x=e.width/a,i.scale.y=e.height/s,i.scale.z=e.depth/c,i.rotation.x=Q.q.DEG2RAD*e.rotateX,i.rotation.y=Q.q.DEG2RAD*e.rotateY,i.rotation.z=Q.q.DEG2RAD*e.rotateZ,i.position.x=e.position.x,i.position.y=e.position.y,i.position.z=e.position.z,i.userData=pe(e),t.add(i),i}console.warn("bead already in scene",e.id)}else console.warn("beadModel not found for type: ",n,e.id)},hn=function(e){var t=new Q.y(1,1,1,1),n=new Q.s({color:"rgb(0,0,0)",side:Q.h,opacity:.2,transparent:!0}),i=new Q.r(t,n);i.userData=me(e,be.BG);var o=new Q.k;o.userData=me(e,be.MAIN),o.position.x=e.position.x,o.position.y=e.position.y,o.position.z=-400,o.scale.x=e.width,o.scale.y=e.height,o.scale.z=1,o.add(i),Ht.scene.add(o)},bn=function(e){var t=new Q.y(1,1,1,1),n=new Q.s({color:"rgb(0,0,0)",side:Q.h,opacity:.1,transparent:!0}),i=new Q.r(t,n);i.userData=we(e,je.BG);var o=new Q.k;o.userData=we(e,je.MAIN),o.position.x=e.position.x,o.position.y=e.position.y,o.scale.x=e.width,o.scale.y=e.height,o.scale.z=1,o.add(i),Ht.scene.add(o)},vn=function(e){e.forEach((function(e){var t=Ce(e.id,e.objectType);if(void 0!==t){var n=Ht.scene.getObjectByUserDataProperty("name",t);if(void 0!==n)Ht.scene.remove(n),void 0!==Ht.scene.getObjectByUserDataProperty("name",t)&&console.warn("triggerDeleteObjectIds:: try double - object found by name in scene ",t);else console.warn("triggerDeleteObjectIds:: object not found by name",t)}else console.warn("triggerDeleteObjectIds:: name cant be created",e.id,e.objectType)}))},fn=function(e){e.forEach((function(e){for(;;){var t=ue(e),n=Ht.scene.getObjectByUserDataProperty("name",t);if(void 0===n)break;Ht.scene.remove(n)}for(;;){var i=ue(e,J.ANY),o=Ht.scene.getObjectByUserDataProperty("name",i);if(void 0===o)break;Ht.scene.remove(o)}}))},jn=function(e,t){var n;if(void 0!==e){n=Ht.camera.userData.rect10x10FromScreenToWorld.w;if(void 0===t){var i=new Q.k,o=new Q.y(1,1,1,1),a=new Q.s({color:"#5794fc",side:Q.h,opacity:.1,transparent:!0}),s=new Q.r(o,a);s.userData=fe(e,le.BG);var c=new Q.a;e.selectedIds.length>0&&e.selectedIds.forEach((function(e){var t=Ce(e.id,e.objectType),n=Ht.scene.getObjectByUserDataProperty("name",t);void 0!==n&&c.expandByObject(n)}));var r=c.min.x,d=c.min.y,l=Math.abs(c.max.x-c.min.x),u=Math.abs(c.max.y-c.min.y);i.userData=fe(e),i.userData.position.x=r+l/2,i.userData.position.y=d+u/2,i.position.x=r+l/2,i.position.y=d+u/2,i.position.z=-460,i.scale.x=l,i.scale.y=u,i.scale.z=1,i.add(s),Ht.scene.add(i)}else{var p=ve(t.id),h=Ht.scene.getObjectByUserDataProperty("name",p);if(void 0===h)return;var b=new Q.a;e.selectedIds.length>0&&e.selectedIds.forEach((function(e){var t=Ce(e.id,e.objectType),n=Ht.scene.getObjectByUserDataProperty("name",t);if(void 0!==n){b.expandByObject(n);var i=e.objectType===A.Group,o=void 0!==e.groupId&&e.groupId.length>0;(i||o)&&console.log("robie bbox dla grupy..",e.id,e.groupId)}}));var v=b.min.x,f=b.min.y,j=Math.abs(b.max.x-b.min.x),g=Math.abs(b.max.y-b.min.y);console.log("jaki jest bbxo?",b,v,f,j,g),h.userData.position.x=v+j/2,h.userData.position.y=f+g/2,h.position.x=v+j/2,h.position.y=f+g/2,h.scale.x=j,h.scale.y=g,h.scale.z=1}}else if(void 0!==t){var m=ve(t.id),y=Ht.scene.getObjectByUserDataProperty("name",m);void 0!==y&&Ht.scene.remove(y)}},gn=function(e,t){var n=ke(e),i=Ht.scene.getObjectByUserDataProperty("name",n);if(void 0!==i)if(!0===t){console.log("dodaj kropki");var o=new Q.a;o.expandByObject(i),mn(o).forEach((function(e){Ht.scene.attach(e)})),Ht.additionalData.selectedBBox={topLeft:{x:o.min.x,y:o.max.y,z:0},topRight:{x:o.max.x,y:o.max.y,z:0},bottomLeft:{x:o.min.x,y:o.min.y,z:0},bottomRight:{x:o.max.x,y:o.min.y,z:0}}}else{console.log("usun kropki");for(var a=Ht.scene.children.length-1;a>=0;a--)4===Ht.scene.children[a].layers.mask&&Ht.scene.remove(Ht.scene.children[a]);Ht.additionalData.selectedBBox=void 0}else console.warn("triggerSelectRegion: object not found by name",n)},mn=function(e){var t=Ht.camera.userData.sceneScale,n=[],i=new Q.t({color:"#ffffff"}),o=new Q.c(1,16),a=new Q.r(o,i);a.scale.x=10,a.scale.y=10,a.renderOrder=2,a.layers.set(2);var s=new Q.t({color:"#a9a9a9"}),c=new Q.c(1,16),r=new Q.r(c,s);r.scale.x=12,r.scale.y=12,r.renderOrder=1,r.layers.set(2);var d=new Q.k;d.attach(r),d.attach(a);var l=d.clone();l.position.x=e.min.x,l.position.y=e.max.y,l.scale.x=t,l.scale.y=t,l.layers.set(2),l.userData={name:"topLeft"},n.push(l);var u=d.clone();u.position.x=e.max.x,u.position.y=e.max.y,u.scale.x=t,u.scale.y=t,u.layers.set(2),u.userData={name:"topRight"},n.push(u);var p=d.clone();p.position.x=e.min.x,p.position.y=e.min.y,p.scale.x=t,p.scale.y=t,p.layers.set(2),p.userData={name:"bottomLeft"},n.push(p);var h=d.clone();return h.position.x=e.max.x,h.position.y=e.min.y,h.scale.x=t,h.scale.y=t,h.layers.set(2),h.userData={name:"bottomRight"},n.push(h),n},yn=function(){function e(t,n,i,o){Object(ie.a)(this,e),this.store=void 0,this.event=void 0,this.history=void 0,this.saveToHistory=void 0,this.store=n,this.history=i,this.event=t,this.saveToHistory=o}return Object(oe.a)(e,[{key:"getNewStoreWithTopBarPosition",value:function(e){return Object(ce.default)(e,(function(t){var n=rn(e.selectedIds.map((function(t){return{id:t,objectType:e.objects[t].objectType}})));t.ui.selectedTopBarPosition=n}))}},{key:"getCenterPosition",value:function(){var e=Ht.el.getBoundingClientRect(),t=e.width,n=e.height,i=e.top;return{posX:e.left+t/2,posY:i+n/2}}},{key:"getMousePosition",value:function(){var e=0,t=0,n=It;if(void 0===n){var i=this.getCenterPosition();e=i.posX,t=i.posY}else e=n.x,t=n.y;return{posX:e,posY:t}}},{key:"getStoreWithHistory",value:function(e){var t=this,n=void 0===e?this.store:e;return Object(ce.default)(n,(function(e){e.history.canRedo=t.history.canRedo(),e.history.canUndo=t.history.canUndo(),e.history.events=t.history.getSimpleHistoryEvents()}))}}]),e}(),xn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"getAppObjectFromCloneAppObject",value:function(e){if(void 0!==e.objectType)return e.objectType===A.Bead?he(e):e.objectType===A.Region?Ie(e):e.objectType===A.Group?ye(e):e.objectType===A.PreviewProject3D?function(e){var t={id:Q.q.generateUUID(),position:re(0,0),rotateX:90,rotateY:0,rotateZ:0,height:10,width:10,depth:10,canLockOrUnlock:!0,isLocked:!1,objectType:A.PreviewProject3D,color:"red"};return Object(v.merge)(t,e)}(e):void console.warn("unknow object type from payload: ",e);console.warn("object type not found in payload: ",e)}},{key:"selectObjectOnThreeScene",value:function(e,t){void 0!==e&&(e.objectType===A.Bead&&ln(e.id,t),e.objectType===A.Region&&gn(e.id,t))}},{key:"deleteSelectedObjectsFromStore",value:function(e,t){var n=this;return Object(ce.produce)(this.store,(function(i){e.forEach((function(e){var o=n.store.objects[e];if(i.selectedIds.includes(e)){var a=i.selectedIds.indexOf(e);i.selectedIds.splice(a,1),n.selectObjectOnThreeScene(o,!1)}void 0!==i.objects[o.id]&&(t.push(o),o.objectType===A.Region&&o.childrenGridIds.forEach((function(e){void 0!==e&&(i.objects[e].regionId=void 0)})),delete i.objects[o.id])})),i.ui.selectedTopBarPosition=rn(i.selectedIds.map((function(e){return{id:e,objectType:i.objects[e].objectType}})))}))}},{key:"getPositionDiffFromMousePosition",value:function(e){var t=this.getMousePosition(),n=t.posX,i=t.posY,o=tn(n,i),a=new Q.a;e.forEach((function(e){var t=e.width/2,n=e.height/2,i=e.position.x,o=e.position.y;a.expandByPoint((new Q.F).set(i-t,o-n,.1)),a.expandByPoint((new Q.F).set(i+t,o-n,.2)),a.expandByPoint((new Q.F).set(i-t,o+n,.1)),a.expandByPoint((new Q.F).set(i+t,o+n,.1))}));var s=new Q.F;return a.getCenter(s),{diffX:o.x-s.x,diffY:o.y-s.y}}},{key:"moveObjectsByDiff",value:function(e,t,n){e.forEach((function(i){i.objectType===A.Group?(i.position.x=i.position.x+t,i.position.y=i.position.y+n,e.forEach((function(e){i.childrenIds.includes(e.id)&&(e.position.x=e.position.x+t,e.position.y=e.position.y+n)}))):void 0===i.groupId&&(i.position.x=i.position.x+t,i.position.y=i.position.y+n)}))}}]),n}(yn),On=n(20),wn=n.n(On),Dn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t=[],n=Object(ce.default)(this.store,(function(n){e.event.payload.objects.forEach((function(i){var o=e.getAppObjectFromCloneAppObject(i);void 0!=o&&(o.objectType===A.Region&&o.childrenGridIds.forEach((function(e){void 0!==e&&(n.objects[e].regionId=o.id)})),n.objects[o.id]=o,t.push(o))}))}));if(this.saveToHistory){var i={do:this.event,redo:{name:Y.AddObjects,payload:{objects:t}},undo:{name:Y.RemoveObjects,payload:{ids:t.map((function(e){return e.id}))}},createdAt:wn()().toISOString()};this.history.push(i)}n=this.getStoreWithHistory(n),ne(n),t.forEach((function(e){cn(e)})),tt(n),x(t.map((function(e){return{action:a.CREATE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(xn),En=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this.event.payload.ids,t=[],n=this.deleteSelectedObjectsFromStore(e,t);if(this.saveToHistory){var i={do:this.event,redo:this.event,undo:{name:Y.AddObjects,payload:{objects:t}},createdAt:wn()().toISOString()};this.history.push(i)}n=this.getStoreWithHistory(n),ne(n),vn(t.map((function(e){return{id:e.id,objectType:e.objectType}}))),tt(n),x(t.map((function(e){return{action:a.DELETE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(xn),kn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t=this.event.payload.change,n=[],i=Object(ce.default)(this.store,(function(e){t.forEach((function(t){void 0!==e.objects[t.id]?(!0===e.selectedIds.includes(t.id)?!0===t.isSelected||e.selectedIds.splice(e.selectedIds.indexOf(t.id),1):!0===t.isSelected&&e.selectedIds.push(t.id),n.push({id:t.id,isSelected:t.isSelected})):console.warn("no object found in store",t.id)}))}));n.forEach((function(t){var n=i.objects[t.id];void 0!==n&&e.selectObjectOnThreeScene(n,t.isSelected)})),i=this.getNewStoreWithTopBarPosition(i),ne(i),tt(i)}}]),n}(xn),Sn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t=[],n={},i=[],o=this.event.payload.changes,s=[],c=Object(ce.default)(this.store,(function(a){o.forEach((function(e){if(void 0!==a.objects[e.id]){var t={id:e.id,properties:{},relatedChanges:[],relatedCreateBeads:[],relatedDeleteIds:[]},n=Object.keys(e.properties);void 0!==t&&n.forEach((function(n){t.properties[n]=Object(v.cloneDeep)(a.objects[e.id][n])})),n.forEach((function(t){a.objects[e.id][t]=Object(v.cloneDeep)(e.properties[t])})),e.relatedChanges&&e.relatedChanges.forEach((function(e){void 0!==a.objects[e.id]?Object.keys(e.properties).forEach((function(t){a.objects[e.id][t]=Object(v.cloneDeep)(e.properties[t])})):console.warn("no object found in store",e.id)})),s.push(t)}else console.warn("no object found in store",e.id)})),o.forEach((function(o,c){if(void 0!==a.objects[o.id]){var r=a.objects[o.id].objectType,d=s[c];r===A.Bead&&e.whenBead(o,a,d,t,n,i),r===A.Region&&e.whenRegion(o,a,d,t,n,i)}else console.warn("no object found in store",o.id)}))}));if(this.saveToHistory){var r={do:this.event,redo:{name:Y.ChangeObjectsProperty,payload:{changes:this.event.payload.changes.map((function(e){var t=e.id,n=e.properties,i=e.relatedChanges,o=s.findIndex((function(e){return e.id===t})),a=-1!==o?s[o].relatedCreateBeads:[],c=-1!==o?s[o].relatedDeleteIds:[];return{id:t,properties:n,relatedChanges:i,relatedCreateBeads:a,relatedDeleteIds:c}}))}},undo:{name:Y.ChangeObjectsProperty,payload:{changes:s}},createdAt:wn()().toISOString()};this.history.push(r)}c=this.getStoreWithHistory(c),o.forEach((function(t){e.applyChangesToThree(t,c),x([{action:a.UPDATE,createdAt:(new Date).toISOString(),object:c.objects[t.id]}]),t.relatedChanges&&t.relatedChanges.forEach((function(t){e.applyChangesToThree(t,c),x([{action:a.UPDATE,createdAt:(new Date).toISOString(),object:c.objects[t.id]}])}))})),t.length>0&&(t.forEach((function(e){cn(e)})),x(t.map((function(e){return{action:a.CREATE,createdAt:(new Date).toISOString(),object:e}}))));var d=Object.keys(n);d.length>0&&(vn(d.map((function(e){return{id:e,objectType:c.objects[e].objectType}}))),d.map((function(e){cn(c.objects[e])})),x(d.map((function(e){return{action:a.UPDATE,createdAt:(new Date).toISOString(),object:c.objects[e]}})))),i.length>0&&(vn(i.map((function(e){return{id:e.id,objectType:e.objectType}}))),x(i.map((function(e){return{action:a.DELETE,createdAt:(new Date).toISOString(),object:e}})))),c=this.getNewStoreWithTopBarPosition(c),ne(c),tt(c)}},{key:"applyChangesToThree",value:function(e,t){if(void 0!==t.objects[e.id]){var n=t.objects[e.id],i=void 0!==n.groupId&&n.groupId.length>0,o=Object.keys(e.properties);1===o.length&&!0===o.includes("position")&&!1===i?dn(e.id,n.objectType,n.position.x,n.position.y):(vn([{id:e.id,objectType:n.objectType}]),cn(n),i&&void 0!==n.groupId&&t.objects[n.groupId]&&t.objects[n.groupId].childrenIds.forEach((function(e){var n=t.objects[e];vn([{id:e,objectType:n.objectType}]),cn(n)})))}else console.warn("no object found in store",e.id)}},{key:"whenBead",value:function(e,t,n,i,o,a){if(Object.keys(e.properties).includes("position")){var s=!1,c=t.objects[e.id],r=t.objects[e.id].regionId;if(void 0!==r){var d=t.objects[r],l=d.position.x-d.width/2,u=d.position.y-d.height/2;if(!0===de({x:l,y:u,z:0},{x:d.position.x+d.width/2,y:d.position.y+d.height/2,z:0},{x:c.position.x,y:c.position.y,z:0})){var p=d.width/d.columns,h=d.height/d.rows,b=Math.floor((c.position.x-l)/p),f=Math.floor((c.position.y-u)/h),j=f*d.columns+b,g=d.childrenGridIds.indexOf(c.id);if(-1!==g&&g!==j&&(t.objects[r].childrenGridIds[g]=void 0),t.objects[r].childrenGridIds[j]=c.id,s=!0,!0===d.snapBeadsToCell){var m=d.width/d.columns,y=d.height/d.rows,x=b*m,O=f*y,w=d.position.x-d.width/2+x+m/2,D=d.position.y-d.height/2+O+y/2;t.objects[c.id].position.x=w,t.objects[c.id].position.y=D}}}if(!1===s&&Object.keys(t.objects).forEach((function(e){if(t.objects[e].objectType===A.Region){var n=t.objects[e],i=n.position.x-n.width/2,a=n.position.y-n.height/2;if(!1!==de({x:i,y:a,z:0},{x:n.position.x+n.width/2,y:n.position.y+n.height/2,z:0},{x:c.position.x,y:c.position.y,z:0})){var r=n.width/n.columns,d=n.height/n.rows,l=Math.floor((c.position.x-i)/r),u=Math.floor((c.position.y-a)/d),p=u*n.columns+l;if(void 0===n.childrenGridIds[p]){var h=n.childrenGridIds.indexOf(c.id);if(-1!==h&&h!==p&&(t.objects[e].childrenGridIds[h]=void 0),t.objects[e].childrenGridIds[p]=c.id,o[e]=Object(v.cloneDeep)(t.objects[e]),void 0!==t.objects[c.id].regionId){var b=t.objects[c.id].regionId,f=t.objects[b].childrenGridIds.indexOf(c.id);-1!==f&&(t.objects[b].childrenGridIds[f]=void 0,o[b]=Object(v.cloneDeep)(t.objects[b]))}if(t.objects[c.id].regionId=n.id,s=!0,!0===n.snapBeadsToCell){var j=n.width/n.columns,g=n.height/n.rows,m=l*j,y=u*g,x=n.position.x-n.width/2+m+j/2,O=n.position.y-n.height/2+y+g/2;t.objects[c.id].position.x=x,t.objects[c.id].position.y=O}}else if(n.childrenGridIds[p]===c.id&&!0===n.snapBeadsToCell){var w=n.width/n.columns,D=n.height/n.rows,E=l*w,k=u*D,S=n.position.x-n.width/2+E+w/2,I=n.position.y-n.height/2+k+D/2;t.objects[c.id].position.x=S,t.objects[c.id].position.y=I,s=!0}}}})),!1===s&&void 0!==r){var E=t.objects[r].childrenGridIds.indexOf(c.id);-1!==E&&(t.objects[r].childrenGridIds[E]=void 0,o[r]=Object(v.cloneDeep)(t.objects[r])),t.objects[e.id].regionId=void 0}}}},{key:"whenRegion",value:function(e,t,n,i,o,a){var s=Object.keys(e.properties),c="autoFillBeads",r="snapBeadsToCell",d="rows",l="columns",u="position";if(void 0!==e.relatedCreateBeads&&e.relatedCreateBeads.length>0){var p=t.objects[e.id],h=[];e.relatedCreateBeads.forEach((function(e){void 0!==t.objects[e.id]?(h.push(e.id),a.push(Object(v.cloneDeep)(e)),delete t.objects[e.id]):console.warn("bead not found",e.id)})),p.childrenGridIds.forEach((function(e,n){void 0!==e&&h.includes(e)&&(t.objects[p.id].childrenGridIds[n]=void 0)}))}if(s.includes(d)||s.includes(l)){n.properties.rows;for(var b=n.properties.columns,f=t.objects[e.id],j=f.rows,g=f.columns,m=f.rows*f.columns,y=(f.childrenGridIds.length,Array(m).fill(void 0)),x=!0===f.autoFillBeads,O=[],w=0;w<f.childrenGridIds.length;w++){var D=w,E=Math.floor(w/b),k=Math.floor(w%b),S=k+E*g;if((k>=g||E>=j)&&(S=m,x)){var I=f.childrenGridIds[D];void 0!==I&&void 0!==t.objects[I]&&(O.push(I),n.relatedDeleteIds.push(I))}S<m&&(y[S]=f.childrenGridIds[D])}O.forEach((function(e){void 0!==t.objects[e]?(a.push(Object(v.cloneDeep)(t.objects[e])),delete t.objects[e]):console.warn("bead not found",e)})),t.objects[f.id].childrenGridIds=y}if(s.includes("shape"),s.includes(u)||s.includes(r)){var C=t.objects[e.id];if(!0===C.snapBeadsToCell)C.childrenGridIds.forEach((function(i,a){if(void 0!==i){var s,c=Math.floor(a/C.columns),r=Math.floor(a%C.columns),d=C.width/C.columns,l=C.height/C.rows,u=r*d,p=c*l,h=C.position.x-C.width/2+u+d/2,b=C.position.y-C.height/2+p+l/2,f=Object(v.cloneDeep)(t.objects[i].position);t.objects[i].position.x=h,t.objects[i].position.y=b,o[i]=Object(v.cloneDeep)(t.objects[i]),null===(s=n.relatedChanges)||void 0===s||s.push({id:i,properties:{position:{x:f.x,y:f.y,z:f.z}}})}else{var j=t.objects[e.id],g=(j.rows,j.columns,!1);Object.keys(t.objects).forEach((function(i){var s;if(!0!==g&&t.objects[i].objectType===A.Bead){var c=t.objects[i];if(void 0===c.groupId&&void 0===c.regionId){var r=Math.floor(a/j.columns),d=Math.floor(a%j.columns),l=j.width/j.columns,u=j.height/j.rows,p=j.position.x-j.width/2,h=j.position.y-j.height/2;if(!1!==de({x:p+d*l,y:h+r*u,z:0},{x:p+d*l+l,y:h+r*u+u,z:0},{x:c.position.x,y:c.position.y,z:0})){t.objects[e.id].childrenGridIds[a]=c.id,t.objects[c.id].regionId=j.id;var b=d*l,f=r*u,m=j.position.x-j.width/2+b+l/2,y=j.position.y-j.height/2+f+u/2,x=Object(v.cloneDeep)(t.objects[c.id].position);t.objects[c.id].position.x=m,t.objects[c.id].position.y=y,null===(s=n.relatedChanges)||void 0===s||s.push({id:c.id,properties:{position:{x:x.x,y:x.y,z:x.z},regionId:void 0}}),o[c.id]=Object(v.cloneDeep)(t.objects[c.id]),g=!0}}}}))}}));else{for(var T=t.objects[e.id],B=T.rows*T.columns,M=Array(B).fill(void 0),_=B,P=Object.keys(t.objects),R=0;R<P.length&&!(_<=0);R++){var N=P[R];if(t.objects[N].objectType===A.Bead){var H=t.objects[N];if(void 0===H.groupId&&H.regionId===T.id){var U=T.position.x-T.width/2,z=T.position.y-T.height/2;if(!1!==de({x:U,y:z,z:0},{x:T.position.x+T.width/2,y:T.position.y+T.height/2,z:0},{x:H.position.x,y:H.position.y,z:0})){var L=T.width/T.columns,G=T.height/T.rows,F=Math.floor((H.position.x-U)/L),Y=Math.floor((H.position.y-z)/G)*T.columns+F;void 0===M[Y]&&(M[Y]=H.id,_-=1)}}}}t.objects[e.id].childrenGridIds.forEach((function(e){if(void 0!==e&&void 0!==t.objects[e]){var i;if(!1===M.includes(e))null===(i=n.relatedChanges)||void 0===i||i.push({id:e,properties:{regionId:t.objects[e].regionId}});t.objects[e].regionId=void 0,o[e]=Object(v.cloneDeep)(t.objects[e])}})),M.forEach((function(e){if(void 0!==e){var i;if(void 0===t.objects[e].regionId)null===(i=n.relatedChanges)||void 0===i||i.push({id:e,properties:{regionId:void 0}});t.objects[e].regionId=T.id,o[e]=Object(v.cloneDeep)(t.objects[e])}})),t.objects[e.id].childrenGridIds=Object(v.cloneDeep)(M)}}if(s.includes(c)||s.includes(d)||s.includes(l)||s.includes(u)){var W=t.objects[e.id],X=!0===W.autoFillBeads,V=!0===W.snapBeadsToCell,Z=W.rows*W.columns;if(W.childrenGridIds.length!==Z)return void console.warn("region childrenIds size have not correct value",Z,W.childrenGridIds.length,W.childrenGridIds);if(X){var q=0;W.childrenGridIds.forEach((function(a,s){if(void 0===a){var c,r,d,l=Math.floor(s/W.columns),u=Math.floor(s%W.columns),p=W.width/W.columns,h=W.height/W.rows,b=u*p,f=l*h,j=null!==(c=null===(r=e.relatedCreateBeads)||void 0===r||null===(d=r[q])||void 0===d?void 0:d.id)&&void 0!==c?c:void 0;void 0!==e.relatedCreateBeads&&void 0===j&&console.warn("id for bead is missing..");var g=he({id:j,color:"red",regionId:W.id});q+=1;var m=W.position.x-W.width/2,y=W.position.y-W.height/2;g.position.x=m+b+p/2,g.position.y=y+f+h/2,t.objects[g.id]=g,W.childrenGridIds[s]=g.id,i.push(Object(v.cloneDeep)(g)),n.relatedCreateBeads.push(Object(v.cloneDeep)(g))}else{var x,O=Math.floor(s/W.columns),w=Math.floor(s%W.columns),D=W.width/W.columns,E=W.height/W.rows,k=w*D,S=O*E,I=W.position.x-W.width/2+k+D/2,C=W.position.y-W.height/2+S+E/2,T=Object(v.cloneDeep)(t.objects[a].position);t.objects[a].position.x=I,t.objects[a].position.y=C,o[a]=Object(v.cloneDeep)(t.objects[a]),null===(x=n.relatedChanges)||void 0===x||x.push({id:a,properties:{position:{x:T.x,y:T.y,z:T.z}}})}}))}else V&&W.childrenGridIds.forEach((function(i,a){if(void 0!==i){var s,c=Math.floor(a/W.columns),r=Math.floor(a%W.columns),d=W.width/W.columns,l=W.height/W.rows,u=r*d,p=c*l,h=W.position.x-W.width/2+u+d/2,b=W.position.y-W.height/2+p+l/2,f=Object(v.cloneDeep)(t.objects[i].position);t.objects[i].position.x=h,t.objects[i].position.y=b,o[i]=Object(v.cloneDeep)(t.objects[i]),null===(s=n.relatedChanges)||void 0===s||s.push({id:i,properties:{position:{x:f.x,y:f.y,z:f.z}}})}else{var j=t.objects[e.id],g=!1;Object.keys(t.objects).forEach((function(i){var s;if(!0!==g&&t.objects[i].objectType===A.Bead){var c=t.objects[i];if(void 0===c.groupId&&void 0===c.regionId){var r=Math.floor(a/j.columns),d=Math.floor(a%j.columns),l=j.width/j.columns,u=j.height/j.rows,p=j.position.x-j.width/2,h=j.position.y-j.height/2;if(!1!==de({x:p+d*l,y:h+r*u,z:0},{x:p+d*l+l,y:h+r*u+u,z:0},{x:c.position.x,y:c.position.y,z:0})){t.objects[e.id].childrenGridIds[a]=c.id,t.objects[c.id].regionId=j.id;var b=d*l,f=r*u,m=j.position.x-j.width/2+b+l/2,y=j.position.y-j.height/2+f+u/2,x=Object(v.cloneDeep)(t.objects[c.id].position);t.objects[c.id].position.x=m,t.objects[c.id].position.y=y,null===(s=n.relatedChanges)||void 0===s||s.push({id:c.id,properties:{position:{x:x.x,y:x.y,z:x.z},regionId:void 0}}),o[c.id]=Object(v.cloneDeep)(t.objects[c.id]),g=!0}}}}))}}))}}}]),n}(xn),In=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this.event.payload.uiSettings,t=Object(ce.default)(this.store,(function(t){Object.keys(e).forEach((function(n){t.ui[n]=Object(v.cloneDeep)(e[n])}))}));t=this.getNewStoreWithTopBarPosition(t),ne(t),tt(t)}}]),n}(yn),Cn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t=this.store.selectedIds.map((function(t){return Object(v.cloneDeep)(e.store.objects[t])}));Wt({objects:t})}}]),n}(yn),Tn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t=[],n=[],i=this.store.selectedIds.map((function(n){return t.push(n),Object(v.cloneDeep)(e.store.objects[n])}));Wt({objects:i});var o=this.deleteSelectedObjectsFromStore(t,n);if(this.saveToHistory){var s={do:this.event,redo:this.event,undo:{name:Y.ClipboardPaste,payload:{objects:i}},createdAt:wn()().toISOString()};this.history.push(s)}o=this.getStoreWithHistory(o),ne(o),vn(n.map((function(e){return{id:e.id,objectType:e.objectType}}))),tt(o),x(n.map((function(e){return{action:a.DELETE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(xn),Bn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t={},n=[];this.event.payload.objects.forEach((function(i){if(i.id){var o=i.id,a=Object(v.cloneDeep)(i);delete a.id;var s=e.getAppObjectFromCloneAppObject(a);void 0!=s&&(t[o]=s.id,n.push(s))}}));var i=this.getPositionDiffFromMousePosition(n),o=i.diffX,s=i.diffY;this.moveObjectsByDiff(n,o,s),n.forEach((function(e){if(e.objectType===A.Group){var n=[];e.childrenIds.forEach((function(e){n.push(t[e])})),e.childrenIds=n}void 0!==e.groupId&&(e.groupId=t[e.groupId])})),this.store.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(e.store.objects[t],!1)}));var c=Object(ce.default)(this.store,(function(e){e.selectedIds=[],n.forEach((function(t){e.objects[t.id]=t,e.selectedIds.push(t.id)}))}));if(n.forEach((function(t){cn(t),e.selectObjectOnThreeScene(t,!0)})),this.saveToHistory){var r={do:this.event,redo:this.event,undo:{name:Y.RemoveObjects,payload:{ids:n.map((function(e){return e.id}))}},createdAt:wn()().toISOString()};this.history.push(r)}c=this.getStoreWithHistory(c),c=this.getNewStoreWithTopBarPosition(c),ne(c),tt(c),x(n.map((function(e){return{action:a.CREATE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(xn),Mn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t=[];if("rectangle"===this.event.payload.figure){var n=he({});Object(v.times)(this.event.payload.rows).forEach((function(i){Object(v.times)(e.event.payload.columns).forEach((function(e){var o,a,s=((null!==(o=n.width)&&void 0!==o?o:1)+2)*i,c=((null!==(a=n.height)&&void 0!==a?a:1)+2)*e*-1,r=he({position:{x:s,y:c}});t.push(r)}))}))}else console.warn("figure not found in event payload");var i=this.getPositionDiffFromMousePosition(t),o=i.diffX,s=i.diffY;this.moveObjectsByDiff(t,o,s);var c=Object(ce.default)(this.store,(function(e){t.forEach((function(t){e.objects[t.id]=t,e.selectedIds.push(t.id)}))}));if(this.store.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(e.store.objects[t],!1)})),t.forEach((function(t){cn(t),e.selectObjectOnThreeScene(t,!0)})),this.saveToHistory){var r={do:this.event,redo:{name:Y.AddObjects,payload:{objects:Object(v.cloneDeep)(t)}},undo:{name:Y.RemoveObjects,payload:{ids:t.map((function(e){return e.id}))}},createdAt:wn()().toISOString()};this.history.push(r)}c=this.getStoreWithHistory(c),c=this.getNewStoreWithTopBarPosition(c),ne(c),tt(c),x(t.map((function(e){return{action:a.CREATE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(xn),An=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this.event.payload.zoomType,t=this.getCenterPosition();if("zoomByScroll"===e){var n=this.event.payload,i=n.scrollDelta,o=n.clientX,a=n.clientY;o||(o=t.posX),a||(a=t.posY),i||(i=1);var s=Ht.el.getBoundingClientRect(),c=s.top,r=o-s.left,d=a-c,l=Math.sign(i);this.updateByScroll(r,d,l)}else"zoomInScreenCenter"===e?this.updateByScroll(t.posX,t.posY,-1):"zoomOutScreenCenter"===e&&this.updateByScroll(t.posX,t.posY,1)}},{key:"updateByScroll",value:function(e,t,n){var i=Ht.el.getBoundingClientRect(),o=i.width,a=i.height,s=Ht.camera.position.x,c=Ht.camera.position.y,r=(e-o/2)*this.store.ui.zoomScale,d=-1*(t-a/2)*this.store.ui.zoomScale,l=this.store.ui.zoomScale>=.35?.1:.01,u=1;u=this.store.ui.zoomScale+n*l;var p=(e-o/2)*(u=Math.min(Math.max(.0125,u),100)),h=-1*(t-a/2)*u;Ht.camera.left=o*u/-2,Ht.camera.right=o*u/2,Ht.camera.top=a*u/2,Ht.camera.bottom=a*u/-2,Ht.camera.updateProjectionMatrix();var b=r-p,v=d-h;Ht.camera.position.x=s+b,Ht.camera.position.y=c+v,Ht.camera.lookAt(Ht.camera.position.x,Ht.camera.position.y,0);var f=Ut();Ht.camera.userData={sceneScale:u,rect10x10FromScreenToWorld:f};var j=Object(ce.default)(this.store,(function(e){e.ui.zoomScale=u}));j=this.getNewStoreWithTopBarPosition(j),ne(j),tt(j),Ht.scene.children.forEach((function(e){4===e.layers.mask&&(e.scale.x=u,e.scale.y=u,e.scale.z=u)}))}}]),n}(yn),_n=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this.event.payload,t=e.panel,n=e.open,i=e.toggle,o=Object(ce.default)(this.store,(function(e){var o=n;"objects"===t&&(void 0!==i&&!0===i&&"objects"===e.ui.rightSidebar.panel&&(o=!e.ui.rightSidebar.isOpen),e.ui.rightSidebar.isOpen=o,e.ui.rightSidebar.panel=!1===o?void 0:"objects"),"history"===t&&(void 0!==i&&!0===i&&"history"===e.ui.rightSidebar.panel&&(o=!e.ui.rightSidebar.isOpen),e.ui.rightSidebar.isOpen=o,e.ui.rightSidebar.panel=!1===o?void 0:"history"),"comments"===t&&(void 0!==i&&!0===i&&"comments"===e.ui.leftSidebar.panel&&(o=!e.ui.leftSidebar.isOpen),e.ui.leftSidebar.isOpen=o,e.ui.leftSidebar.panel=!1===o?void 0:"comments")}));ne(o),tt(o)}}]),n}(yn),Pn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this.event.payload,t=e.snapType,n=e.selectedIds,i=[],o=[],s=Object(ce.default)(this.store,(function(e){var a=void 0,s=void 0,c=void 0,r=void 0;if(n.forEach((function(t){if(void 0!==e.objects[t]){var n=e.objects[t].position;e.objects[t].width,e.objects[t].height;(void 0===s||n.x<s)&&(s=n.x),(void 0===a||n.x>a)&&(a=n.x),(void 0===r||n.y<r)&&(r=n.y),(void 0===c||n.y>c)&&(c=n.y)}else console.warn("no object found in store",t)})),t===W.X_MIN){if(void 0!==s){var d=s;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.x=d,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===W.X_MIDDLE){if(void 0!==s&&void 0!==a){var l=s+(a-s)/2;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.x=l,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===W.X_MAX){if(void 0!==a){var u=a;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.x=u,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===W.Y_MIN){if(void 0!==r){var p=r;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.y=p,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===W.Y_MIDDLE){if(void 0!==r&&void 0!==c){var h=r+(c-r)/2;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.y=h,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===W.Y_MAX){if(void 0!==c){var b=c;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.y=b,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else console.error("unknow SnapToLineType",t)}));if(this.saveToHistory){var c={do:this.event,redo:this.event,undo:{name:Y.ChangeObjectsProperty,payload:{changes:o}},createdAt:wn()().toISOString()};this.history.push(c)}s=this.getStoreWithHistory(s),i.forEach((function(e){if(void 0!==s.objects[e.id]){var t=s.objects[e.id];dn(e.id,t.objectType,t.position.x,t.position.y)}else console.warn("no object found in store",e.id)})),s=this.getNewStoreWithTopBarPosition(s),ne(s),tt(s),x(i.map((function(e){return{action:a.UPDATE,createdAt:(new Date).toISOString(),object:s.objects[e.id]}})))}}]),n}(xn),Rn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t={},n=[];this.event.payload.objects.forEach((function(i){if(i.id){var o=i.id,a=Object(v.cloneDeep)(i);delete a.id;var s=e.getAppObjectFromCloneAppObject(a);void 0!=s&&(t[o]=s.id,n.push(s))}}));var i=this.getPositionDiffFromMousePosition(n),o=i.diffX,s=i.diffY;this.moveObjectsByDiff(n,o,s),n.forEach((function(e){if(e.objectType===A.Group){var n=[];e.childrenIds.forEach((function(e){n.push(t[e])})),e.childrenIds=n}void 0!==e.groupId&&(e.groupId=t[e.groupId])})),this.store.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(e.store.objects[t],!1)}));var c=Object(ce.default)(this.store,(function(e){e.selectedIds=[],n.forEach((function(t){e.objects[t.id]=t,e.selectedIds.push(t.id)}))}));if(n.forEach((function(t){cn(t),e.selectObjectOnThreeScene(t,!0)})),this.saveToHistory){var r={do:this.event,redo:this.event,undo:{name:Y.RemoveObjects,payload:{ids:n.map((function(e){return e.id}))}},createdAt:wn()().toISOString()};this.history.push(r)}c=this.getStoreWithHistory(c),c=this.getNewStoreWithTopBarPosition(c),ne(c),tt(c),x(n.map((function(e){return{action:a.CREATE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(xn),Nn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t=[],n=[],i=[],o=[],s=[],c=Object(ce.default)(this.store,(function(a){if(e.event.payload.objects.forEach((function(e){if(void 0!==a.objects[e.id]){var o=a.objects[e.id],s=o.objectType===A.Group,c=void 0!==o.groupId&&o.groupId.length>0;s?!1===t.includes(o.id)&&(1,t.push(o.id)):c?(1,n.push(o.id),i.push(o.id),o.groupId&&void 0!==a.objects[o.groupId]&&!1===t.includes(o.groupId)&&(1,t.push(o.groupId))):(1,n.push(o.id))}else console.warn("object not found in store",e.id)})),void 0!==e.event.payload.removed&&e.event.payload.removed.length>0)a.selectedIds=[],e.event.payload.removed.forEach((function(e){if(void 0!==e&&void 0!==e.id){var t=new Q.a;e.childrenIds.forEach((function(e){var n=a.objects[e];if(void 0!==n){var i=Ce(n.id,n.objectType);if(void 0!==i){var o=Ht.scene.getObjectByUserDataProperty("name",i);void 0!==o&&t.expandByObject(o)}}}));var n=t.max.x-t.min.x,i=t.max.y-t.min.y,o=ye({id:e.id,childrenIds:e.childrenIds,position:{x:t.min.x+n/2,y:t.min.y+i/2},width:n,height:i});a.objects[e.id]=o,s.push(o),a.selectedIds.push(o.id),void 0!==e.childrenIds&&e.childrenIds.length>0&&e.childrenIds.forEach((function(e){void 0!==a.objects[e]?(a.objects[e].groupId=o.id,a.selectedIds.push(e)):console.warn("object not found after group.childrenIds...")}))}}));else{t.forEach((function(t){void 0!==a.objects[t]&&(e.selectObjectOnThreeScene(a.objects[t],!1),o.push(Object(v.cloneDeep)(a.objects[t])),delete a.objects[t])}));var c=new Q.a;n.forEach((function(e){var t=a.objects[e],n=Ce(t.id,t.objectType);if(void 0!==n){var i=Ht.scene.getObjectByUserDataProperty("name",n);void 0!==i&&c.expandByObject(i)}}));var r=void 0;void 0!==e.event.payload.added&&(r=e.event.payload.added.id);var d=c.max.x-c.min.x,l=c.max.y-c.min.y,u=ye({id:r,position:{x:c.min.x+d/2,y:c.min.y+l/2},width:d,height:l,childrenIds:n});a.objects[u.id]=u,s.push(u),n.forEach((function(e){a.objects[e].groupId=u.id})),a.selectedIds=[u.id].concat(n)}}));if(this.saveToHistory){var r,d={do:this.event,redo:{name:Y.GroupObjects,payload:{objects:this.event.payload.objects.map((function(e){var t=e.id;return Object(v.cloneDeep)({id:t})})),removed:null===(r=this.event.payload.removed)||void 0===r?void 0:r.map((function(e){var t=e.id,n=e.childrenIds;return Object(v.cloneDeep)({id:t,childrenIds:n})})),added:s[0]?{id:s[0].id,childrenIds:s[0].childrenIds}:void 0}},undo:{name:Y.UngroupObjects,payload:{objects:c.selectedIds.map((function(e){return Object(v.cloneDeep)({id:e})})),removed:o.map((function(e){var t=e.id,n=e.childrenIds;return Object(v.cloneDeep)({id:t,childrenIds:n})}))}},createdAt:wn()().toISOString()};this.history.push(d)}c=this.getStoreWithHistory(c),this.event.payload.objects.forEach((function(t){e.selectObjectOnThreeScene(t,!1)})),vn(this.event.payload.objects.map((function(t){var n=t.id;return void 0===e.store.objects[n]?{id:n,objectType:""}:{id:n,objectType:e.store.objects[n].objectType}}))),vn(o.map((function(t){var n=t.id;return void 0===e.store.objects[n]?{id:n,objectType:""}:{id:n,objectType:e.store.objects[n].objectType}}))),n.forEach((function(e){cn(c.objects[e])})),s.forEach((function(e){cn(c.objects[e.id])})),c.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(c.objects[t],!0)})),x(s.map((function(e){var t=e.id;return{action:a.CREATE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(c.objects[t])}}))),x(n.map((function(e){return{action:a.UPDATE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(c.objects[e])}}))),x(o.map((function(t){var n=t.id;return{action:a.DELETE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(e.store.objects[n])}}))),c=this.getNewStoreWithTopBarPosition(c),ne(c),tt(c)}}]),n}(xn),Hn=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(){return Object(ie.a)(this,n),t.apply(this,arguments)}return Object(oe.a)(n,[{key:"run",value:function(){var e=this,t=[],n=[],i=[],o=[],s=[],c=Object(ce.default)(this.store,(function(a){e.event.payload.objects.forEach((function(e){if(void 0!==a.objects[e.id]){var o=a.objects[e.id],s=o.objectType===A.Group,c=void 0!==o.groupId&&o.groupId.length>0;s?!1===t.includes(o.id)&&(1,t.push(o.id)):c?(1,i.push(o.id),n.push(o.id),void 0!==o.groupId&&a.objects[o.groupId]&&!1===t.includes(o.groupId)&&(1,t.push(o.groupId))):(1,i.push(o.id))}else console.warn("object not found in store",e.id)})),void 0!==e.event.payload.removed&&e.event.payload.removed.length>0?(a.selectedIds=[],e.event.payload.objects.forEach((function(t){var n=t.id;if(void 0!==a.objects[n]){if(a.objects[n].objectType===A.Group){e.selectObjectOnThreeScene(a.objects[n],!1);var i=a.objects[n].childrenIds;return i.forEach((function(e){a.objects[e].groupId=void 0})),o.push(Object(v.cloneDeep)({childrenIds:i,id:n})),void delete a.objects[n]}a.objects[n].groupId=void 0}})),e.event.payload.removed.forEach((function(e){if(void 0!==e&&void 0!==e.id){var t=new Q.a;e.childrenIds.forEach((function(e){var n=a.objects[e];if(void 0!==n){var i=Ce(n.id,n.objectType);if(void 0!==i){var o=Ht.scene.getObjectByUserDataProperty("name",i);void 0!==o&&t.expandByObject(o)}}}));var n=t.max.x-t.min.x,i=t.max.y-t.min.y,o=ye({id:e.id,childrenIds:e.childrenIds,position:{x:t.min.x+n/2,y:t.min.y+i/2},width:n,height:i});a.objects[e.id]=o,s.push(o),a.selectedIds.push(o.id),e.childrenIds&&e.childrenIds.forEach((function(e){void 0!==a.objects[e]&&(a.objects[e].groupId=o.id,a.selectedIds.push(e))}))}}))):t.forEach((function(t){if(void 0!==a.objects[t]){e.selectObjectOnThreeScene(a.objects[t],!1);var n=a.objects[t].childrenIds;n.forEach((function(e){a.objects[e].groupId=void 0})),o.push(Object(v.cloneDeep)({id:t,childrenIds:n})),delete a.objects[t]}})),a.selectedIds=[].concat(i)}));if(this.saveToHistory){var r,d={do:this.event,redo:{name:Y.UngroupObjects,payload:{objects:c.selectedIds.map((function(e){return Object(v.cloneDeep)({id:e})})),removed:null===(r=this.event.payload.removed)||void 0===r?void 0:r.map((function(e){var t=e.id,n=e.childrenIds;return Object(v.cloneDeep)({id:t,childrenIds:n})}))}},undo:{name:Y.GroupObjects,payload:{objects:this.event.payload.objects,removed:o.map((function(e){return{id:e.id,childrenIds:e.childrenIds}}))}},createdAt:wn()().toISOString()};this.history.push(d)}c=this.getStoreWithHistory(c),this.event.payload.objects.forEach((function(t){e.selectObjectOnThreeScene(t,!1)})),vn(o.map((function(t){var n=t.id;return void 0===e.store.objects[n]?{id:n,objectType:""}:{id:n,objectType:e.store.objects[n].objectType}}))),vn(this.event.payload.objects.map((function(t){var n=t.id;return void 0===e.store.objects[n]?{id:n,objectType:""}:{id:n,objectType:e.store.objects[n].objectType}}))),s.forEach((function(e){cn(c.objects[e.id])})),i.forEach((function(e){cn(c.objects[e])})),c.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(c.objects[t],!0)})),x(s.map((function(e){var t=e.id;return{action:a.CREATE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(c.objects[t])}}))),x(i.map((function(e){return{action:a.UPDATE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(c.objects[e])}}))),x(o.map((function(t){var n=t.id;return{action:a.DELETE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(e.store.objects[n])}}))),c=this.getNewStoreWithTopBarPosition(c),ne(c),tt(c)}}]),n}(xn),Un=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.log("dispatchEvent",e.name,e.payload,"saveToHistory",t);var n=Ft(),i=te();return e.name===Y.AddObjects?new Dn(e,i,n,t).run():e.name===Y.RemoveObjects?new En(e,i,n,t).run():e.name===Y.ChangeSelectObjects?new kn(e,i,n,t).run():e.name===Y.ChangeObjectsProperty?new Sn(e,i,n,t).run():e.name===Y.ChangeUiSettings?new In(e,i,n,t).run():e.name===Y.ClipboardCopy?new Cn(e,i,n,t).run():e.name===Y.ClipboardCut?new Tn(e,i,n,t).run():e.name===Y.ClipboardPaste?new Bn(e,i,n,t).run():e.name===Y.AddMultipleBeads?new Mn(e,i,n,t).run():e.name===Y.ChangeUiSettingsZoom?new An(e,i,n,t).run():e.name===Y.ChangeUiSettingsSidebar?new _n(e,i,n,t).run():e.name===Y.ChangeObjectsAlignment?new Pn(e,i,n,t).run():e.name===Y.DuplicateObjects?new Rn(e,i,n,t).run():e.name===Y.GroupObjects?new Nn(e,i,n,t).run():e.name===Y.UngroupObjects?new Hn(e,i,n,t).run():console.warn("event handler not found to name",e),e},zn=function(e){return Object(S.jsx)(Ln,{children:Object(S.jsx)("div",{className:"actions-group",children:e.actions.map((function(t,n){return t===L.More?Object(S.jsx)(Fn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},n):t===L.EditBeadColor?Object(S.jsx)(Yn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},n):t===L.EditRegionGridType?Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)(q.a,{icon:Z.B})})})},n):t===L.EditRegionGridSettings?Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)(q.a,{icon:Z.g})})})},n):t===L.EditPosition?Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)(q.a,{icon:Z.m})})})},n):t===L.EditRotate?Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)(q.a,{icon:Z.F})})})},n):t===L.EditWidthHeight||t===L.EditWidthHeightDepth?Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)(q.a,{icon:Z.f})})})},n):t===L.Alignment?Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsxs)("div",{className:"align-icons-wrapper",children:[Object(S.jsx)(q.a,{icon:Z.b}),Object(S.jsx)(q.a,{icon:Z.j,size:"sm"})]})})})},n):t===L.EditBeadType?Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"align-icons-wrapper",children:Object(S.jsx)(q.a,{icon:Z.B})})})})},n):t===L.EditBeadProduct?Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"align-icons-wrapper",children:Object(S.jsx)(q.a,{icon:Z.A})})})})},n):t===L.Lock?Object(S.jsx)(Xn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},n):t===L.Unlock?Object(S.jsx)(Wn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},n):t===L.EditBeadMaterial?Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"align-icons-wrapper",children:Object(S.jsx)(q.a,{icon:Z.h})})})})},n):t===L.Group?Object(S.jsx)(Vn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},n):t===L.Ungroup?Object(S.jsx)(Zn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},n):Object(S.jsx)(Gn,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":t,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)(q.a,{icon:Z.J})})})},n)}))})})},Ln=b.a.div(en||(en=Object(h.a)(['\n  height: 100%;\n\n  .more-icon-action-type {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 40px;\n    svg path {\n      fill: var(--gray);\n    }\n    div {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n  }\n  .icon-action-type-color {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 50px;\n  }\n  .icon-action-type {\n    width: 50px;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: var(--standardPadding);\n    padding-right: var(--standardPadding);\n  }\n  .icon-action-type-color {\n    .value {\n      height: 30px;\n      width: 30px;\n      background: transparent;\n      border-radius: 30px;\n      border: 1px solid #000;\n    }\n  }\n  .action-item-wrapper {\n    height: 100%;\n    transition: all 0.4s ease-in-out;\n  }\n  .action-item-wrapper.active {\n    background: rgba(0, 0, 0, 0.2);\n  }\n  .actions-group {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    position: relative;\n    height: 100%;\n    &:before {\n      content: "";\n      position: absolute;\n      top: 50%;\n      left: calc(var(--standardPadding) * -1);\n      height: 70%;\n      transform: translate(0, -50%);\n      width: 1px;\n      background: var(--gray);\n    }\n  }\n  .align-icons-wrapper {\n    column-gap: var(--standardPadding);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  .long-press-wrapper {\n    height: 100%;\n    position: relative;\n    &.active {\n      .long-press-ghost {\n        max-width: 100%;\n      }\n    }\n    .long-press-ghost {\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 2;\n      overflow: hidden;\n      background: #eee;\n      max-width: 0%;\n      height: 100%;\n      transition-property: all;\n      animation-timing-function: cubic-bezier(0.25, 0.1, 1, 1);\n      animation-fill-mode: forwards;\n      width: 100%;\n    }\n    .long-press-icon {\n      position: relative;\n      z-index: 3;\n      height: 100%;\n      width: 110px;\n      display: flex;\n      column-gap: var(--standardPadding);\n      padding-left: 30px;\n      .icon-wrapper {\n        position: absolute;\n        top: 50%;\n        left: 5px;\n        transform: translate(0, -50%);\n        font-size: 18px;\n      }\n\n      .label-wrapper {\n        font-size: 13px;\n        display: flex;\n        justify-content: center;\n        text-align: center;\n        align-content: center;\n        position: absolute;\n        top: 50%;\n        left: 30px;\n        transform: translate(0, -50%);\n      }\n    }\n  }\n']))),Gn=function(e){var t=c.a.useRef(null);return Object(S.jsx)("div",{className:"action-item-wrapper ".concat(void 0!==e.selectedAction&&e.selectedAction===e.type?"active":""),ref:function(e){return t.current=e},onClick:function(){if(t.current){var n=t.current,i=n.offsetLeft,o=n.offsetParent,a=n.offsetWidth,s=0;o?s=o.offsetLeft:console.warn("ref parent element not found");var c=s+i+a/2;e.onClick(e.type,c)}else console.warn("ref element not found")},children:e.children})},Fn=function(e){return Object(S.jsx)(Gn,{onClick:e.onClick,type:e.type,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"more-icon-action-type ",children:Object(S.jsx)("div",{"data-tip":"Color","data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)(q.a,{icon:Z.n})})})})},Yn=function(e){var t=Object(T.c)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].color;!1===t.includes(i)&&t.push(i)}})),t}));return 0===t.length?Object(S.jsx)(c.a.Fragment,{}):Object(S.jsx)(Gn,{onClick:e.onClick,type:e.type,selectedAction:e.selectedAction,children:Object(S.jsx)("div",{className:"icon-action-type-color",children:Object(S.jsx)("div",{"data-tip":"More","data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"value",style:{background:"linear-gradient(to right, ".concat(1===t.length?[t[0],t[0]].join():t.slice(0,10).join(),")")},children:"\xa0"})})})})},Wn=function(e){var t=c.a.useState(!1),n=Object(l.a)(t,2),i=n[0],o=n[1],a=function(){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(e){return{id:e,properties:{isLocked:!1}}}))}};Un(n),e.onClick(void 0,void 0)};c.a.useEffect((function(){var e;return i?e=setTimeout(a,600):clearTimeout(e),function(){clearTimeout(e)}}),[i]);var s=c.a.useCallback((function(){o(!0)}),[]),r=c.a.useCallback((function(){o(!1)}),[]);return Object(S.jsxs)("div",{onMouseDown:s,onMouseUp:r,onMouseLeave:r,onTouchStart:s,onTouchEnd:r,className:"long-press-wrapper ".concat(i?"active":""),children:[Object(S.jsx)("div",{className:"long-press-ghost",style:{transitionDuration:"".concat(600,"ms")},children:"\xa0"}),Object(S.jsxs)("div",{className:"long-press-icon",children:[Object(S.jsx)("div",{className:"icon-wrapper",children:Object(S.jsx)(q.a,{icon:Z.s})}),Object(S.jsx)("div",{className:"label-wrapper",children:Object(S.jsx)("span",{children:"Long press to unlock"})})]})]})},Xn=function(e){return Object(S.jsx)(Gn,{onClick:function(){var e=te(),t={name:Y.ChangeSelectObjects,payload:{change:e.selectedIds.map((function(e){return{id:e,isSelected:!1}}))}};Un(t);var n={name:Y.ChangeObjectsProperty,payload:{changes:e.selectedIds.map((function(e){return{id:e,properties:{isLocked:!0}}}))}};Un(n)},type:L.Lock,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":L.Lock,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"align-icons-wrapper",children:Object(S.jsx)(q.a,{icon:Z.L})})})})})},Vn=function(e){return Object(S.jsx)(Gn,{onClick:function(){var e=te(),t={name:Y.GroupObjects,payload:{objects:e.selectedIds.map((function(t){return Object(v.cloneDeep)(e.objects[t])}))}};Un(t)},type:e.type,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":e.type,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"align-icons-wrapper",children:Object(S.jsx)(q.a,{icon:Z.v})})})})})},Zn=function(e){return Object(S.jsx)(Gn,{onClick:function(){var e=te(),t={name:Y.UngroupObjects,payload:{objects:e.selectedIds.map((function(t){return Object(v.cloneDeep)(e.objects[t])}))}};Un(t)},type:e.type,children:Object(S.jsx)("div",{className:"icon-action-type",children:Object(S.jsx)("div",{"data-tip":e.type,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"align-icons-wrapper",children:Object(S.jsx)(q.a,{icon:Z.w})})})})})},qn=n(134),Kn=n(136),Jn=n(25),Qn=n(29),$n="undefined"!=typeof document,ei=/^[+-]?((\.\d+)|(\d+(\.\d+)?))$/,ti=/^([+-]0?|[0-9]*\.0*|[+-]\.0*|[+-]?\d+\.)?$/;function ni(e,t,n){var i=e[t];if("function"==typeof i){for(var o=arguments.length,a=new Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];i=i.apply(void 0,a)}return void 0===i?n:i}var ii=function(e){Object(ae.a)(n,e);var t=Object(se.a)(n);function n(e){var i;return Object(ie.a)(this,n),(i=t.call(this,e))._timer=void 0,i._valid=void 0,i._isStrict=void 0,i._ignoreValueChange=void 0,i._isMounted=void 0,i._inputFocus=void 0,i.refsWrapper=void 0,i.refsInput=void 0,i.state=void 0,i._isStrict=!!i.props.strict,i.state=Object(Jn.a)({btnDownHover:!1,btnDownActive:!1,btnUpHover:!1,btnUpActive:!1,stringValue:""},i._propsToState(i.props)),i.stop=i.stop.bind(Object(Qn.a)(i)),i.onTouchEnd=i.onTouchEnd.bind(Object(Qn.a)(i)),i.refsInput=null,i.refsWrapper=null,i}return Object(oe.a)(n,[{key:"_propsToState",value:function(e){var t={};return e.hasOwnProperty("value")?(t.stringValue=String(e.value||0===e.value?e.value:"").trim(),t.value=""!==t.stringValue?this._parse(e.value):null):!this._isMounted&&e.hasOwnProperty("defaultValue")&&(t.stringValue=String(e.defaultValue||0===e.defaultValue?e.defaultValue:"").trim(),t.value=""!==e.defaultValue?this._parse(e.defaultValue):null),t}},{key:"componentWillReceiveProps",value:function(e){var t=this;this._isStrict=!!e.strict;var n=this._propsToState(e);Object.keys(n).length&&(this._ignoreValueChange=!0,this.setState(n,(function(){t._ignoreValueChange=!1})))}},{key:"componentWillUpdate",value:function(){this.saveSelection()}},{key:"componentDidUpdate",value:function(e,t){var n;this._ignoreValueChange||t.value===this.state.value||isNaN(null!==(n=this.state.value)&&void 0!==n?n:Number.NaN)&&null!==this.state.value||this._invokeEventCallback("onChange",this.state.value,this.refsInput.value,this.refsInput),this._inputFocus&&(this.refsInput.focus(),(this.state.selectionStart||0===this.state.selectionStart)&&(this.refsInput.selectionStart=this.state.selectionStart),(this.state.selectionEnd||0===this.state.selectionEnd)&&(this.refsInput.selectionEnd=this.state.selectionEnd)),this.checkValidity()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.stop()}},{key:"componentDidMount",value:function(){var e=this;this._isMounted=!0,this.refsInput.getValueAsNumber=function(){return e.state.value||0},this.refsInput.setValue=function(t){e.setState({value:e._parse(t),stringValue:t})},!this._inputFocus&&$n&&document.activeElement===this.refsInput&&(this._inputFocus=!0,this.refsInput.focus(),this._invokeEventCallback("onFocus",{target:this.refsInput,type:"focus"})),this.checkValidity()}},{key:"saveSelection",value:function(){this.state.selectionStart=this.refsInput.selectionStart,this.state.selectionEnd=this.refsInput.selectionEnd}},{key:"checkValidity",value:function(){var e,t="",n=!!this.refsInput.checkValidity,i=!(!this.props.noValidate||"false"==this.props.noValidate);this.refsInput.noValidate=i,(e=i||!n)?t="":(""===this.refsInput.pattern&&(this.refsInput.pattern=this.props.required?".+":".*"),n&&(this.refsInput.checkValidity(),(e=this.refsInput.validity.valid)||(t=this.refsInput.validationMessage)),e&&n&&this.props.maxLength&&this.refsInput.value.length>this.props.maxLength&&(t="This value is too long")),t=t||(e?"":this.refsInput.validationMessage||"Unknown Error");var o=this._valid!==t;this._valid=t,t?(!function(e,t){if(e.classList)return e.classList.add(t);e.className.search(new RegExp("\\b"+t+"\\b"))||(e.className=" "+t)}(this.refsWrapper,"has-error"),o&&this._invokeEventCallback("onInvalid",t,this.state.value,this.refsInput.value)):(!function(e,t){if(e.className){if(e.classList)return e.classList.remove(t);e.className=e.className.replace(new RegExp("\\b"+t+"\\b","g"),"")}}(this.refsWrapper,"has-error"),o&&this._invokeEventCallback("onValid",this.state.value,this.refsInput.value))}},{key:"_toNumber",value:function(e){var t=parseFloat(e);if(!isNaN(t)&&isFinite(t)||(t=0),this._isStrict){var i=ni(this.props,"precision",null,this),o=Math.pow(10,null===i?10:i),a=+ni(this.props,"min",n.defaultProps.min,this),s=+ni(this.props,"max",n.defaultProps.max,this);t=Math.min(Math.max(t,a),s),t=Math.round(t*o)/o}return t}},{key:"_parse",value:function(e){return e=String(e),"function"==typeof this.props.parse?parseFloat(this.props.parse(e)):parseFloat(e)}},{key:"_format",value:function(e){var t=this._toNumber(e).toString(),n=ni(this.props,"precision",null,this);return null!==n&&(t=e.toFixed(n)),t+="",this.props.format?this.props.format(t):t}},{key:"_step",value:function(e,t){var i=this._isStrict;this._isStrict=!0;var o=+ni(this.props,"step",n.defaultProps.step,this,e>0?n.DIRECTION_UP:n.DIRECTION_DOWN),a=this._toNumber((this.state.value||0)+o*e);return this.props.snap&&(a=Math.round(a/o)*o),this._isStrict=i,a!==this.state.value&&(this.setState({value:a,stringValue:a+""},t),!0)}},{key:"_onKeyDown",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].persist(),this._invokeEventCallback.apply(this,["onKeyDown"].concat(t));var i=t[0];if(!i.isDefaultPrevented())if(38===i.keyCode)i.preventDefault(),this._step(i.ctrlKey||i.metaKey?.1:i.shiftKey?10:1);else if(40===i.keyCode)i.preventDefault(),this._step(i.ctrlKey||i.metaKey?-.1:i.shiftKey?-10:-1);else{var o=this.refsInput.value,a=o.length;8===i.keyCode?this.refsInput.selectionStart==this.refsInput.selectionEnd&&this.refsInput.selectionEnd>0&&o.length&&"."===o.charAt(this.refsInput.selectionEnd-1)&&(i.preventDefault(),this.refsInput.selectionStart=this.refsInput.selectionEnd=this.refsInput.selectionEnd-1):46===i.keyCode?this.refsInput.selectionStart==this.refsInput.selectionEnd&&this.refsInput.selectionEnd<a+1&&o.length&&"."===o.charAt(this.refsInput.selectionEnd)&&(i.preventDefault(),this.refsInput.selectionStart=this.refsInput.selectionEnd=this.refsInput.selectionEnd+1):i.keyCode}}},{key:"stop",value:function(){this._timer&&clearTimeout(this._timer)}},{key:"increase",value:function(){var e,t,i=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0;this.stop(),this._step(1,a);var s=+ni(this.props,"max",n.defaultProps.max,this);(isNaN(null!==(e=this.state.value)&&void 0!==e?e:Number.NaN)||+(null!==(t=this.state.value)&&void 0!==t?t:Number.NaN)<s)&&(this._timer=setTimeout((function(){i.increase(!0)}),o?n.SPEED:n.DELAY))}},{key:"decrease",value:function(){var e,t,i=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0;this.stop(),this._step(-1,a);var s=+ni(this.props,"min",n.defaultProps.min,this);(isNaN(null!==(e=this.state.value)&&void 0!==e?e:Number.NaN)||+(null!==(t=this.state.value)&&void 0!==t?t:Number.NaN)>s)&&(this._timer=setTimeout((function(){i.decrease(!0)}),o?n.SPEED:n.DELAY))}},{key:"onMouseDown",value:function(e,t){"down"==e?this.decrease(!1,t):"up"==e&&this.increase(!1,t)}},{key:"onTouchStart",value:function(e,t){t.preventDefault(),"down"==e?this.decrease():"up"==e&&this.increase()}},{key:"onTouchEnd",value:function(e){e.preventDefault(),this.stop()}},{key:"_invokeEventCallback",value:function(e){if("function"==typeof this.props[e]){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this.props[e]).call.apply(t,[null].concat(i))}}},{key:"render",value:function(){var e=this,t=this.props,i=this.state,o={},a=this.props,s=(a.step,a.min,a.max,a.precision,a.parse,a.format,a.mobile),c=(a.snap,a.componentClass),r=(a.value,a.type,a.style),d=(a.defaultValue,a.onInvalid,a.onValid,a.strict,a.noStyle),l=Object(Kn.a)(a,["step","min","max","precision","parse","format","mobile","snap","componentClass","value","type","style","defaultValue","onInvalid","onValid","strict","noStyle"]);for(var u in d=d||!1===r,n.style)o[u]=Object.assign({},n.style[u],r&&r[u]||{});var p=t.className&&/\bform-control\b/.test(t.className);"auto"==s&&(s=$n&&"ontouchstart"in document),"function"==typeof s&&(s=s.call(this)),s=!!s;var h={wrap:{style:d?null:o.wrap,className:"react-numeric-input",ref:function(t){null!=t&&void 0!=t&&(e.refsWrapper=t)},onMouseUp:void 0,onMouseLeave:void 0},input:Object(Jn.a)({ref:function(t){null!=t&&void 0!=t&&(e.refsInput=t)},type:"text",style:d?null:Object.assign({},o.input,p?{}:o["input:not(.form-control)"],this._inputFocus?o["input:focus"]:{})},l),btnUp:{onMouseEnter:void 0,onMouseDown:void 0,onMouseUp:void 0,onMouseLeave:void 0,onTouchStart:void 0,onTouchEnd:void 0,style:d?null:Object.assign({},o.btn,o.btnUp,t.disabled||t.readOnly?o["btn:disabled"]:i.btnUpActive?o["btn:active"]:i.btnUpHover?o["btn:hover"]:{})},btnDown:{onMouseEnter:void 0,onMouseDown:void 0,onMouseUp:void 0,onMouseLeave:void 0,onTouchStart:void 0,onTouchEnd:void 0,style:d?null:Object.assign({},o.btn,o.btnDown,t.disabled||t.readOnly?o["btn:disabled"]:i.btnDownActive?o["btn:active"]:i.btnDownHover?o["btn:hover"]:{})}},b=String(i.stringValue||(i.value||0===i.value?i.value:"")||""),v=!this._isStrict&&(this._inputFocus||!this._isMounted);v&&ti.test(b)||v&&b&&!ei.test(b)?h.input.value=b:i.value||0===i.value?h.input.value=this._format(i.value):h.input.value="",p&&!d&&Object.assign(h.wrap.style,o["wrap.hasFormControl"]),s&&!d&&(Object.assign(h.input.style,o["input.mobile"]),Object.assign(h.btnUp.style,o["btnUp.mobile"]),Object.assign(h.btnDown.style,o["btnDown.mobile"])),t.disabled||t.readOnly?!d&&t.disabled&&Object.assign(h.input.style,o["input:disabled"]):(Object.assign(h.wrap,{onMouseUp:this.stop,onMouseLeave:this.stop}),Object.assign(h.btnUp,{onTouchStart:this.onTouchStart.bind(this,"up"),onTouchEnd:this.onTouchEnd,onMouseEnter:function(){e.setState({btnUpHover:!0})},onMouseLeave:function(){e.stop(),e.setState({btnUpHover:!1,btnUpActive:!1})},onMouseUp:function(){e.setState({btnUpHover:!0,btnUpActive:!1})},onMouseDown:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];n[0].preventDefault(),n[0].persist(),e._inputFocus=!0,e.setState({btnUpHover:!0,btnUpActive:!0},(function(){e._invokeEventCallback.apply(e,["onFocus"].concat(n)),e.onMouseDown("up")}))}}),Object.assign(h.btnDown,{onTouchStart:this.onTouchStart.bind(this,"down"),onTouchEnd:this.onTouchEnd,onMouseEnter:function(){e.setState({btnDownHover:!0})},onMouseLeave:function(){e.stop(),e.setState({btnDownHover:!1,btnDownActive:!1})},onMouseUp:function(){e.setState({btnDownHover:!0,btnDownActive:!1})},onMouseDown:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];n[0].preventDefault(),n[0].persist(),e._inputFocus=!0,e.setState({btnDownHover:!0,btnDownActive:!0},(function(){e._invokeEventCallback.apply(e,["onFocus"].concat(n)),e.onMouseDown("down")}))}}),Object.assign(h.input,{onChange:function(t){var n=t.target.value,i=e._parse(n);isNaN(i)&&(i=null),e.setState({value:e._isStrict?e._toNumber(i):i,stringValue:n})},onKeyDown:this._onKeyDown.bind(this),onInput:function(){e.saveSelection();for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e._invokeEventCallback.apply(e,["onInput"].concat(n))},onSelect:function(){e.saveSelection();for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e._invokeEventCallback.apply(e,["onSelect"].concat(n))},onFocus:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];n[0].persist(),e._inputFocus=!0;var o=e._parse(n[0].target.value);e.setState({value:o,stringValue:o||0===o?o+"":""},(function(){e._invokeEventCallback.apply(e,["onFocus"].concat(n))}))},onBlur:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o=e._isStrict;e._isStrict=!0,n[0].persist(),e._inputFocus=!1;var a=e._parse(n[0].target.value);e.setState({value:a},(function(){e._invokeEventCallback.apply(e,["onBlur"].concat(n)),e._isStrict=o}))}}));var f=c||"input";return s?Object(S.jsxs)("span",Object(Jn.a)(Object(Jn.a)({},h.wrap),{},{children:[Object(S.jsx)(f,Object(Jn.a)({},h.input)),Object(S.jsxs)("b",Object(Jn.a)(Object(Jn.a)({},h.btnUp),{},{children:[Object(S.jsx)("i",{style:d?null:o.minus}),Object(S.jsx)("i",{style:d?null:o.plus})]})),Object(S.jsx)("b",Object(Jn.a)(Object(Jn.a)({},h.btnDown),{},{children:Object(S.jsx)("i",{style:d?null:o.minus})}))]})):Object(S.jsxs)("span",Object(Jn.a)(Object(Jn.a)({},h.wrap),{},{children:[Object(S.jsx)(f,Object(Jn.a)({},h.input)),Object(S.jsx)("b",Object(Jn.a)(Object(Jn.a)({},h.btnUp),{},{children:Object(S.jsx)("i",{style:d?null:o.arrowUp})})),Object(S.jsx)("b",Object(Jn.a)(Object(Jn.a)({},h.btnDown),{},{children:Object(S.jsx)("i",{style:d?null:o.arrowDown})}))]}))}}]),n}(s.Component);ii.defaultProps={step:1,min:Number.MIN_SAFE_INTEGER||-9007199254740991,max:Number.MAX_SAFE_INTEGER||9007199254740991,precision:null,parse:null,format:null,mobile:"auto",strict:!1,componentClass:"input",style:{}},ii.style={wrap:{position:"relative",display:"inline-block"},"wrap.hasFormControl":{display:"block"},arrowUp:{position:"absolute",top:"50%",left:"50%",width:0,height:0,borderWidth:"0 0.6ex 0.6ex 0.6ex",borderColor:"transparent transparent rgba(0, 0, 0, 0.7)",borderStyle:"solid",margin:"-0.3ex 0 0 -0.56ex"},arrowDown:{position:"absolute",top:"50%",left:"50%",width:0,height:0,borderWidth:"0.6ex 0.6ex 0 0.6ex",borderColor:"rgba(0, 0, 0, 0.7) transparent transparent",borderStyle:"solid",margin:"-0.3ex 0 0 -0.56ex"},plus:{position:"absolute",top:"50%",left:"50%",width:2,height:10,background:"rgba(0,0,0,.7)",margin:"-5px 0 0 -1px"},minus:{position:"absolute",top:"50%",left:"50%",width:10,height:2,background:"rgba(0,0,0,.7)",margin:"-1px 0 0 -5px"},btn:{position:"absolute",right:2,width:"2.26ex",borderColor:"rgba(0,0,0,.1)",borderStyle:"solid",textAlign:"center",cursor:"default",transition:"all 0.1s",background:"rgba(0,0,0,.1)",boxShadow:"-1px -1px 3px rgba(0,0,0,.1) inset,1px 1px 3px rgba(255,255,255,.7) inset"},btnUp:{top:2,bottom:"50%",borderRadius:"2px 2px 0 0",borderWidth:"1px 1px 0 1px"},"btnUp.mobile":{width:"3.3ex",bottom:2,boxShadow:"none",borderRadius:2,borderWidth:1},btnDown:{top:"50%",bottom:2,borderRadius:"0 0 2px 2px",borderWidth:"0 1px 1px 1px"},"btnDown.mobile":{width:"3.3ex",bottom:2,left:2,top:2,right:"auto",boxShadow:"none",borderRadius:2,borderWidth:1},"btn:hover":{background:"rgba(0,0,0,.2)"},"btn:active":{background:"rgba(0,0,0,.3)",boxShadow:"0 1px 3px rgba(0,0,0,.2) inset,-1px -1px 4px rgba(255,255,255,.5) inset"},"btn:disabled":{opacity:.5,boxShadow:"none",cursor:"not-allowed"},input:{paddingRight:"3ex",boxSizing:"border-box",fontSize:"inherit"},"input:not(.form-control)":{border:"1px solid #ccc",borderRadius:2,paddingLeft:4,display:"block",WebkitAppearance:"none",lineHeight:"normal"},"input.mobile":{paddingLeft:" 3.4ex",paddingRight:"3.4ex",textAlign:"center"},"input:focus":{},"input:disabled":{color:"rgba(0, 0, 0, 0.3)",textShadow:"0 1px 0 rgba(255, 255, 255, 0.8)"}},ii.SPEED=50,ii.DELAY=500,ii.DIRECTION_UP="up",ii.DIRECTION_DOWN="down";var oi,ai,si,ci,ri,di,li,ui,pi,hi,bi,vi,fi,ji,gi,mi,yi,xi=n(93),Oi=(n(255),(0,xi.a.createSliderWithTooltip)(xi.a)),wi=function(e){var t=e.offsetLeft;return e.type!==L.EditRotate&&e.type!==L.EditPosition||(t=e.offsetLeft-150),e.type!==L.EditWidthHeight&&e.type!==L.EditWidthHeightDepth||(t=e.offsetLeft-250),Object(S.jsx)(Di,{children:Object(S.jsxs)("div",{className:"popup-wrapper",style:{left:t},children:[e.type===L.EditBeadColor?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Ei,{})}):null,e.type===L.More?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Hi,{})}):null,e.type===L.EditRegionGridType?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Ci,{})}):null,e.type===L.EditRegionGridSettings?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Ti,{})}):null,e.type===L.EditPosition?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Mi,{})}):null,e.type===L.EditRotate?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(_i,{})}):null,e.type===L.EditWidthHeight?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Pi,{})}):null,e.type===L.EditWidthHeightDepth?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Ri,{})}):null,e.type===L.Alignment?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Ni,{})}):null,e.type===L.EditBeadType?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(ki,{})}):null,e.type===L.EditBeadProduct?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Si,{})}):null,e.type===L.EditBeadMaterial?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsx)(Ii,{})}):null,e.type!==L.More&&e.type!==L.EditRegionGridType&&e.type!==L.EditPosition&&e.type!==L.EditRotate&&e.type!==L.EditWidthHeight&&e.type!==L.EditWidthHeightDepth&&e.type!==L.Alignment&&e.type!==L.EditRegionGridSettings&&e.type!==L.EditBeadType&&e.type!==L.EditBeadProduct&&e.type!==L.EditBeadMaterial&&e.type!==L.EditBeadColor?Object(S.jsx)("div",{className:"popup-wrapper-content",children:Object(S.jsxs)("div",{children:["popup of type: ",e.type]})}):null]})})},Di=b.a.div(oi||(oi=Object(h.a)(["\n  .popup-wrapper {\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    background: #fff;\n    transform: translate(-50%, 0);\n    margin-top: 8px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    padding: var(--standardPadding);\n  }\n  .region-type-selection {\n    display: flex;\n    column-gap: var(--standardPadding);\n  }\n  .region-type-item {\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n    &.active {\n      background: rgba(0, 0, 0, 0.1);\n    }\n    svg path {\n      transition: all 0.4s ease-in-out;\n    }\n    &:hover {\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .columns-input {\n    width: 120px;\n  }\n  .fieldset-wrapper fieldset {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    column-gap: var(--standardPadding);\n  }\n  .region-grid-settings {\n    display: flex;\n    flex-direction: column;\n    row-gap: var(--standardPadding);\n  }\n"]))),Ei=function(e){var t=Object(T.c)((function(e){return e.selectedIds})),n=Object(T.c)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].color;!1===t.includes(i)&&t.push(i)}})),t}));return Object(S.jsx)("div",{children:Object(S.jsx)(qn.a,{width:300,height:300,onChangeComplete:function(e){var n={name:Y.ChangeObjectsProperty,payload:{changes:t.map((function(t){return{id:t,properties:{color:e.hex}}}))}};Un(n)},color:n.length>1?void 0:n[0]})})},ki=function(e){var t=Object(T.c)((function(e){return e.selectedIds})),n=Object(T.c)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].type;!1===t.includes(i)&&t.push(i)}})),t})),i=function(e){var n={name:Y.ChangeObjectsProperty,payload:{changes:t.map((function(t){return{id:t,properties:{type:e}}}))}};Un(n)};return Object(S.jsxs)("div",{style:{display:"flex"},children:[Object(S.jsx)("div",{onClick:function(){i(E.TOHO_MIYUKI)},className:"region-type-item ".concat(1===n.length&&n[0]===E.TOHO_MIYUKI?"active":""),children:Object(S.jsx)(q.a,{icon:Z.D})}),Object(S.jsx)("div",{onClick:function(){i(E.TOHO_SPHERE)},className:"region-type-item ".concat(1===n.length&&n[0]===E.TOHO_SPHERE?"active":""),children:Object(S.jsx)(q.a,{icon:Z.k})}),Object(S.jsx)("div",{onClick:function(){i(E.TOHO_15)},className:"region-type-item ".concat(1===n.length&&n[0]===E.TOHO_15?"active":""),children:Object(S.jsx)(q.a,{icon:Z.C})})]})},Si=function(e){var t=Object(T.c)((function(e){return e.selectedIds})),n=Object(T.c)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].type;!1===t.includes(i)&&t.push(i)}})),t})),i=function(e){var n={name:Y.ChangeObjectsProperty,payload:{changes:t.map((function(t){return{id:t,properties:{type:e}}}))}};Un(n)},o=he({type:E.TOHO_MIYUKI}),a=he({type:E.TOHO_SPHERE}),s=he({type:E.TOHO_15});return Object(S.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(S.jsxs)("div",{style:{display:"flex"},children:[Object(S.jsx)("div",{onClick:function(){i(E.TOHO_MIYUKI)},className:"region-type-item ".concat(1===n.length&&n[0]===E.TOHO_MIYUKI?"active":""),children:Object(S.jsx)("img",{src:Nt.getObjectThumbnail(o,30,30)})}),Object(S.jsx)("div",{onClick:function(){i(E.TOHO_SPHERE)},className:"region-type-item ".concat(1===n.length&&n[0]===E.TOHO_SPHERE?"active":""),children:Object(S.jsx)("img",{src:Nt.getObjectThumbnail(a,30,30)})}),Object(S.jsx)("div",{onClick:function(){i(E.TOHO_15)},className:"region-type-item ".concat(1===n.length&&n[0]===E.TOHO_15?"active":""),children:Object(S.jsx)("img",{src:Nt.getObjectThumbnail(s,30,30)})})]}),Object(S.jsx)("div",{onClick:function(){var e=te(),t=Object(v.cloneDeep)(e.ui.modalSearchProducts);t.isOpen=!0,t.successAction="updateBeadType";var n={name:Y.ChangeUiSettings,payload:{uiSettings:{modalSearchProducts:t}}};Un(n)},style:{cursor:"pointer"},children:"Show all Products"})]})},Ii=function(e){var t=Object(T.c)((function(e){return e.selectedIds})),n=Object(T.c)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].material;!1===t.includes(i)&&t.push(i)}})),t})),i=function(e){var n={name:Y.ChangeObjectsProperty,payload:{changes:t.map((function(t){return{id:t,properties:{material:e}}}))}};Un(n)};return Object(S.jsxs)("div",{style:{width:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[Object(S.jsx)("div",{onClick:function(){i(k.Mat)},className:"region-type-item ".concat(1===n.length&&n[0]===k.Mat?"active":""),children:"Mat"}),Object(S.jsx)("div",{onClick:function(){i(k.Shiny)},className:"region-type-item ".concat(1===n.length&&n[0]===k.Shiny?"active":""),children:"Shine"})]})},Ci=function(e){var t=Object(T.c)((function(e){return e.selectedIds}));return Object(S.jsx)("div",{className:"region-type-selection",children:Object(S.jsx)("div",{onClick:function(){!function(e){var n={name:Y.ChangeObjectsProperty,payload:{changes:t.map((function(t){return{id:t,properties:{shape:e}}}))}};Un(n)}(M.Rectangle)},className:"region-type-item",children:Object(S.jsx)(q.a,{icon:Z.C})})})},Ti=function(){var e=Object(T.c)((function(e){var t=[],n=[];return e.selectedIds.forEach((function(i){if(void 0!==e.objects[i]&&e.objects[i].objectType===A.Region){var o=e.objects[i].columns,a=e.objects[i].rows;!1===t.includes(o)&&t.push(o),!1===n.includes(a)&&n.push(a)}})),{columns:t,rows:n}})),t=e.columns,n=e.rows;return Object(S.jsxs)("div",{className:"region-grid-settings",children:[Object(S.jsx)("div",{className:"region-grid-settings-columns",children:Object(S.jsx)(Bi,{defaultValue:t.length>1?void 0:t[0],max:20,min:1,step:1,showDecimal:!1,label:"Columns: ",onChange:function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){if(!t.objects[n])return{id:n,properties:{}};var i=t.objects[n];return{id:n,properties:{columns:e,rows:i.rows}}}))}};Un(n)}}})}),Object(S.jsx)("div",{className:"region-grid-settings-rows",children:Object(S.jsx)(Bi,{max:20,min:1,step:1,defaultValue:n.length>1?void 0:n[0],showDecimal:!1,label:"Rows: ",onChange:function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{columns:t.objects[n].columns,rows:e}}:{id:n,properties:{}}}))}};Un(n)}}})})]})},Bi=function(e){return Object(S.jsx)("div",{children:Object(S.jsx)("div",{className:"fieldset-wrapper",children:Object(S.jsxs)("fieldset",{children:[Object(S.jsx)("label",{children:e.label}),Object(S.jsx)(ii,{min:e.min,max:e.max,step:e.step,className:"columns-input",value:e.defaultValue,strict:!0,onChange:e.onChange,mobile:!0,format:e.showDecimal?function(e){var t=!1;e<0&&(t=!0,e*=-1);var n=Math.pow(10,2);return e=parseFloat((e*n).toFixed(11)),e=(Math.round(e)/n).toFixed(2),t&&(e=(-1*e).toFixed(2)),e}:void 0})]})})})},Mi=function(e){var t=Object(T.c)((function(e){var t=[],n=[],i=[];return e.selectedIds.forEach((function(o){if(e.objects[o]){var a=e.objects[o].position.x,s=e.objects[o].position.y,c=e.objects[o].position.z;!1===t.includes(a)&&t.push(a),!1===n.includes(s)&&n.push(s),!1===i.includes(c)&&i.push(c)}})),{x:t,y:n,z:i}})),n=t.x,i=t.y,o=(t.z,function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){if(!t.objects[n])return{id:n,properties:{}};var i=t.objects[n];return{id:n,properties:{position:{x:e,y:i.position.y,z:i.position.z}}}}))}};Un(n)}}),a=function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){if(!t.objects[n])return{id:n,properties:{}};var i=t.objects[n];return{id:n,properties:{position:{x:i.position.x,y:e,z:i.position.z}}}}))}};Un(n)}};return Object(S.jsxs)("div",{children:[Object(S.jsx)("span",{children:"Position: "}),Object(S.jsx)("br",{}),Object(S.jsx)(Bi,{defaultValue:n.length>1?void 0:n[0],min:-1e3,max:1e3,showDecimal:!1,step:.1,label:"X: ",onChange:o}),Object(S.jsx)(Ai,{value:n.length>1?0:n[0],onChange:o,min:-1e3,max:1e3}),Object(S.jsx)(Bi,{defaultValue:i.length>1?void 0:i[0],min:-1e3,max:1e3,showDecimal:!1,step:.1,label:"Y: ",onChange:a}),Object(S.jsx)(Ai,{value:i.length>1?0:i[0],onChange:a,min:-1e3,max:1e3})]})},Ai=function(e){var t=c.a.useState(e.value),n=Object(l.a)(t,2),i=n[0],o=n[1];return Object(S.jsx)("div",{style:{marginBottom:8,marginTop:8},children:Object(S.jsx)(Oi,{step:1,min:e.min,max:e.max,value:i,onChange:function(e){o(e)},onAfterChange:function(t){e.onChange(t)}})})},_i=function(e){var t=Object(T.c)((function(e){var t=[],n=[],i=[];return e.selectedIds.forEach((function(o){if(e.objects[o]){var a=e.objects[o].rotateX,s=e.objects[o].rotateY,c=e.objects[o].rotateZ;!1===t.includes(a)&&t.push(a),!1===n.includes(s)&&n.push(s),!1===i.includes(c)&&i.push(c)}})),{x:t,y:n,z:i}})),n=t.x,i=t.y,o=t.z,a=function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{rotateX:e}}:{id:n,properties:{}}}))}};Un(n)}},s=function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{rotateY:e}}:{id:n,properties:{}}}))}};Un(n)}},c=function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{rotateZ:e}}:{id:n,properties:{}}}))}};Un(n)}};return Object(S.jsxs)("div",{children:[Object(S.jsx)("span",{children:"Rotate: "}),Object(S.jsx)("br",{}),Object(S.jsx)(Bi,{defaultValue:n.length>1?void 0:n[0],min:-360,max:360,showDecimal:!1,step:1,label:"X: ",onChange:a}),Object(S.jsx)(Ai,{value:n.length>1?0:n[0],onChange:a,max:360,min:-360}),Object(S.jsx)(Bi,{defaultValue:i.length>1?void 0:i[0],min:-360,max:360,showDecimal:!1,step:1,label:"Y: ",onChange:s}),Object(S.jsx)(Ai,{value:i.length>1?0:i[0],onChange:s,max:360,min:-360}),Object(S.jsx)(Bi,{defaultValue:o.length>1?void 0:o[0],min:-360,max:360,step:1,showDecimal:!1,label:"Z: ",onChange:c}),Object(S.jsx)(Ai,{value:o.length>1?0:o[0],onChange:c,max:360,min:-360})]})},Pi=function(e){var t=Object(T.c)((function(e){var t=[],n=[];return e.selectedIds.forEach((function(i){if(e.objects[i]){var o=e.objects[i].width,a=e.objects[i].height;!1===t.includes(o)&&t.push(o),!1===n.includes(a)&&n.push(a)}})),{width:t,height:n}})),n=t.width,i=t.height,o=function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{width:e}}:{id:n,properties:{}}}))}};Un(n)}},a=function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{height:e}}:{id:n,properties:{}}}))}};Un(n)}};return Object(S.jsxs)("div",{children:[Object(S.jsx)("br",{}),Object(S.jsx)(Bi,{defaultValue:n.length>1?void 0:n[0],max:500,min:1,step:.1,showDecimal:!0,label:"Width: ",onChange:o}),Object(S.jsx)(Ai,{value:n.length>1?0:n[0],onChange:o,max:500,min:1}),Object(S.jsx)(Bi,{defaultValue:i.length>1?void 0:i[0],max:500,min:1,step:.1,showDecimal:!0,label:"Height: ",onChange:a}),Object(S.jsx)(Ai,{value:i.length>1?0:i[0],onChange:a,max:500,min:1})]})},Ri=function(e){var t=Object(T.c)((function(e){var t=[],n=[],i=[];return e.selectedIds.forEach((function(o){if(e.objects[o]){var a=e.objects[o].width,s=e.objects[o].height,c=e.objects[o].depth;!1===t.includes(a)&&t.push(a),!1===n.includes(s)&&n.push(s),!1===i.includes(c)&&i.push(c)}})),{width:t,height:n,depth:i}})),n=t.width,i=t.height,o=t.depth,a=function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{width:e}}:{id:n,properties:{}}}))}};Un(n)}},s=function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{height:e}}:{id:n,properties:{}}}))}};Un(n)}},c=function(e){if(void 0!==e){var t=te(),n={name:Y.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{depth:e}}:{id:n,properties:{}}}))}};Un(n)}};return Object(S.jsxs)("div",{children:[Object(S.jsx)("span",{children:"Size: "}),Object(S.jsx)("br",{}),Object(S.jsx)(Bi,{defaultValue:n.length>1?void 0:n[0],min:1,max:500,showDecimal:!0,step:.1,label:"Width: ",onChange:a}),Object(S.jsx)(Ai,{value:n.length>1?0:n[0],onChange:a,min:1,max:500}),Object(S.jsx)(Bi,{defaultValue:i.length>1?void 0:i[0],min:1,max:500,showDecimal:!0,step:.1,label:"Height: ",onChange:s}),Object(S.jsx)(Ai,{value:i.length>1?0:i[0],onChange:s,min:1,max:500}),Object(S.jsx)(Bi,{defaultValue:o.length>1?void 0:o[0],min:1,max:500,showDecimal:!0,step:.1,label:"Depth: ",onChange:c}),Object(S.jsx)(Ai,{value:o.length>1?0:o[0],onChange:c,min:1,max:500})]})},Ni=function(e){var t=function(e){var t=te(),n={name:Y.ChangeObjectsAlignment,payload:{selectedIds:t.selectedIds,snapType:e}};Un(n)},n=getComputedStyle(document.body).getPropertyValue("--uiButton");return Object(S.jsxs)("div",{children:["X: ",Object(S.jsx)("br",{}),Object(S.jsx)("button",{onClick:function(){t(W.X_MIN)},children:Object(S.jsx)(q.a,{icon:Z.b,color:n,size:"lg"})}),Object(S.jsx)("button",{onClick:function(){t(W.X_MIDDLE)},children:Object(S.jsx)(q.a,{icon:Z.a,color:n,size:"lg"})}),Object(S.jsx)("button",{onClick:function(){t(W.X_MAX)},children:Object(S.jsx)(q.a,{icon:Z.c,color:n,size:"lg"})}),Object(S.jsx)("br",{}),Object(S.jsx)("br",{}),"Y: ",Object(S.jsx)("br",{}),Object(S.jsx)("button",{onClick:function(){t(W.Y_MIN)},children:Object(S.jsx)(q.a,{icon:Z.b,color:n,size:"lg"})}),Object(S.jsx)("button",{onClick:function(){t(W.Y_MIDDLE)},children:Object(S.jsx)(q.a,{icon:Z.a,color:n,size:"lg"})}),Object(S.jsx)("button",{onClick:function(){t(W.Y_MAX)},children:Object(S.jsx)(q.a,{icon:Z.c,color:n,size:"lg"})})]})},Hi=function(e){var t=Object(T.c)((function(e){for(var t="unknow",n="unknow",i=[],o=e.selectedIds.length>0,a=0;a<e.selectedIds.length;a++){var s=e.selectedIds[a];if(void 0!==e.objects[s]){if(e.objects[s].objectType!==A.Region){o=!1;break}var c=e.objects[s].snapBeadsToCell;"unknow"===t?t=!0===c?"allTrue":"allFalse":("allTrue"===t&&!1===c||"allFalse"===t&&!0===c)&&(t="mixed");var r=e.objects[s].autoFillBeads;"unknow"===n?n=!0===r?"allTrue":"allFalse":("allTrue"===n&&!1===r||"allFalse"===n&&!0===r)&&(n="mixed"),i.push(s)}}return{onlyRegions:o,snapToCellChecked:t,autoFillChecked:n,regionIds:i}}));return Object(S.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:220},children:[!0===t.onlyRegions?Object(S.jsxs)(c.a.Fragment,{children:[Object(S.jsxs)("div",{onClick:function(){var e={name:Y.ChangeObjectsProperty,payload:{changes:t.regionIds.map((function(e){return{id:e,properties:{autoFillBeads:"allTrue"!==t.autoFillChecked&&(t.autoFillChecked,!0)}}}))}};Un(e)},children:[Object(S.jsx)("span",{children:"Autofill"}),"allTrue"===t.autoFillChecked?Object(S.jsx)(q.a,{icon:Z.i,color:"#000"}):null,"mixed"===t.autoFillChecked?Object(S.jsx)(q.a,{icon:Z.o,color:"#444"}):null]}),Object(S.jsxs)("div",{onClick:function(){var e={name:Y.ChangeObjectsProperty,payload:{changes:t.regionIds.map((function(e){return{id:e,properties:{snapBeadsToCell:"allTrue"!==t.snapToCellChecked&&(t.snapToCellChecked,!0)}}}))}};Un(e)},children:[Object(S.jsx)("span",{children:"Snap to cell"}),"allTrue"===t.snapToCellChecked?Object(S.jsx)(q.a,{icon:Z.i,color:"#000"}):null,"mixed"===t.snapToCellChecked?Object(S.jsx)(q.a,{icon:Z.o,color:"#444"}):null]})]}):null,Object(S.jsx)("div",{onClick:function(){var e=te(),t={name:Y.DuplicateObjects,payload:{objects:e.selectedIds.map((function(t){return e.objects[t]}))}};Un(t)},children:"Duplicate"}),Object(S.jsx)("div",{onClick:function(){var e=te(),t={name:Y.RemoveObjects,payload:{ids:e.selectedIds}};Un(t)},children:"Delete"})]})},Ui=function(e){var t=Object(T.c)((function(e){return e.selectedIds})),n=Object(T.c)((function(e){var t=[];e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].objectType,o=X[i];if(0===t.length)o.forEach((function(e){t.push(e)}));else for(var a=t.length-1;a>=0;a--){var s=t[a];!1===o.includes(s)&&t.splice(t.indexOf(s),1)}}}));var n=[],i={};return t.forEach((function(t){if(V[t]){if(t===L.Alignment&&1===e.selectedIds.length)return;if(t===L.Lock||t===L.Unlock)if(1===e.selectedIds.length){var n=e.selectedIds[0],o=e.objects[n];if(!0===o.isLocked)return(i={})[V[L.Unlock].groupId]=[L.Unlock],!1;if(!1===o.isLocked&&t===L.Unlock)return}else{var a=!1;if(e.selectedIds.forEach((function(n){if(void 0!==e.objects[n]){var o=e.objects[n].objectType===A.Group,s=void 0!==e.objects[n].groupId&&e.objects[n].groupId.length>0,c=e.objects[n].groupId;if(o){var r=e.objects[n];if(!0===r.isLocked)return(i={})[V[L.Unlock].groupId]=[L.Unlock],a=!0,!1;if(!1===r.isLocked&&t===L.Unlock)return void(a=!0)}else if(s){var d=e.objects[c];if(!0===d.isLocked)return(i={})[V[L.Unlock].groupId]=[L.Unlock],a=!0,!1;if(!1===d.isLocked&&t===L.Unlock)return void(a=!0)}}})),!0===a)return;if(t===L.Unlock)return}if(t===L.Group||t===L.Ungroup){if(1===e.selectedIds.length)return;var s=!1,c=!1,r=0,d=0,l=0;if(e.selectedIds.forEach((function(t){if(!0!==s&&!0!==c&&void 0!==e.objects[t])if(e.objects[t].objectType!==A.Region)if(e.objects[t].objectType!==A.Bead||void 0===e.objects[t].regionId){var n=e.objects[t].objectType===A.Group,i=void 0!==e.objects[t].groupId&&e.objects[t].groupId.length>0;n?r+=1:i?d+=1:l+=1}else c=!0;else s=!0})),!0===s)return;if(!0===c)return;if(0===l&&r>0){if(t===L.Group)return}else if(r>0||d>0);else if(t===L.Ungroup)return}i[V[t].groupId]?i[V[t].groupId].push(t):i[V[t].groupId]=[t]}})),Object.keys(i).sort((function(e,t){var n=i[e][0],o=i[t][0],a=V[n].groupSortOrder,s=V[o].groupSortOrder;return a===s?0:a>s?1:-1})).forEach((function(e){var t=i[e].sort((function(e,t){return V[e].sortOrder===V[t].sortOrder?0:V[e].sortOrder>V[t].sortOrder?1:-1}));n.push(t)})),n})),i=c.a.useState({isOpen:!1,type:void 0,offsetLeft:0}),o=Object(l.a)(i,2),a=o[0],s=o[1],r=function(e,t){var n=e!==a.type||!a.isOpen;s({isOpen:n,type:e,offsetLeft:t})};return c.a.useEffect((function(){s({isOpen:!1,type:void 0,offsetLeft:0})}),[t]),Object(S.jsx)("div",{className:"selected-objects-top-bar",style:{top:e.y,left:e.x},children:Object(S.jsxs)("div",{className:"content-wrapper",children:[Object(S.jsx)("div",{className:"action-icons-wrapper",children:n.map((function(e,t){return Object(S.jsx)(zn,{actions:e,onClick:r,selectedAction:!0===a.isOpen&&void 0!==a.type?a.type:void 0},t)}))}),!0===a.isOpen&&void 0!==a.type?Object(S.jsx)(wi,{offsetLeft:a.offsetLeft,type:a.type}):null]})})},zi=function(e){var t=Object(T.c)((function(e){return e.ui.selectedTopBarPosition}));return void 0===t?null:Object(S.jsx)(Li,{style:{zIndex:void 0===t?"-5":"var(--zIndexSelectedObjectsTopBar)"},children:void 0!==t?Object(S.jsx)(Ui,{x:t.x,y:t.y}):null})},Li=b.a.div(ai||(ai=Object(h.a)(["\n  .selected-objects-top-bar {\n    position: fixed;\n    z-index: var(--zIndexSelectedObjectsTopBar);\n  }\n\n  .content-wrapper {\n    position: absolute;\n    left: 50%;\n    transform: translate(-50%, -65px);\n    height: 55px;\n    padding: 0 12px;\n    background: #fff;\n    border-radius: 4;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n  }\n  .action-icons-wrapper {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    column-gap: calc(var(--standardPadding) * 2);\n    width: 100%;\n    height: 100%;\n  }\n\n  .action-icons-wrapper > div:nth-last-child(1) .actions-group:before {\n    background: transparent;\n  }\n\n  .action-icons-wrapper > div:first-child .actions-group:before {\n    background: transparent;\n  }\n"]))),Gi=n(135),Fi=function(){var e,t=Object(T.c)((function(e){return e.board})),n=c.a.useState(null!==(e=null===t||void 0===t?void 0:t.name)&&void 0!==e?e:""),i=Object(l.a)(n,2),o=i[0],a=i[1];if(!t)return Object(S.jsx)(c.a.Fragment,{});if(!1===t.editModalVisible)return Object(S.jsx)(c.a.Fragment,{});var s=function(){var e=te(),t=Object(ce.default)(e,(function(e){e.board&&(e.board.editModalVisible=!1)}));ne(t),tt(t)};return Object(S.jsx)(Yi,{children:Object(S.jsxs)("div",{className:"edit-modal-popup",children:[Object(S.jsx)("div",{className:"edit-modal-popup-overlay",onClick:s,children:"\xa0"}),Object(S.jsx)("div",{className:"edit-modal-popup-content-wrapper",children:Object(S.jsxs)("div",{className:"edit-modal-popup-content",children:[Object(S.jsx)("div",{className:"btn-cancel",onClick:s,children:Object(S.jsx)(q.a,{icon:Z.J,color:"#000"})}),Object(S.jsx)("h2",{children:"Edycja projektu"}),Object(S.jsx)("div",{children:Object(S.jsx)("input",{name:"name",className:"input",value:o,onChange:function(e){a(e.target.value)},onBlur:function(e){var t=e.target.value;t.length>0&&function(e){var t=te(),n=Object(ce.default)(t,(function(t){t.board&&(t.board.name=e)}));ne(n),tt(n)}(t)}})}),Object(S.jsx)("div",{className:"actions"})]})})]})})},Yi=b.a.div(si||(si=Object(h.a)(["\n  .edit-modal-popup {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 100;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    overflow-x: hidden;\n    overflow-y: auto;\n  }\n  .edit-modal-popup-overlay {\n    background: rgba(0, 0, 0, 0.4);\n    transition: all 0.4s ease-in-out;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n  .edit-modal-popup-content-wrapper {\n    position: absolute;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100%;\n  }\n  .edit-modal-popup-content {\n    background: #fff;\n    padding: 32px;\n    width: 520px;\n    box-sizing: border-box;\n    transition: all 0.25s ease-out;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    transition: all 0.4s ease-in-out;\n    z-index: 2;\n    position: relative;\n  }\n  .actions {\n    display: flex;\n    justify-content: flex-end;\n  }\n  .btn-cancel {\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 5;\n    width: 45px;\n    height: 45px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    /* border: 1px solid #eee; */\n    /* color: #000; */\n    /* padding: 10px 15px; */\n    /* border-radius: 4px; */\n    /* width: 90px; */\n    cursor: pointer;\n  }\n  .input {\n    border: none;\n    border-bottom: 1px solid rgba(5, 0, 56, 0.2);\n    padding: 8px 0 4px;\n    font-size: 24px;\n    transition: all 0.4s ease-in-out;\n    border-radius: 0;\n    box-shadow: none;\n    margin-bottom: 10px;\n\n    &:hover {\n      border-bottom-color: rgba(5, 0, 56, 0.4);\n    }\n    &:focus {\n      border-bottom-color: var(--uiButtonActive);\n    }\n  }\n"]))),Wi=n(132),Xi=function(e){var t,n,i=Object(T.c)((function(e){var t=e.history;return{canRedo:t.canRedo,canUndo:t.canUndo}})),o=i.canRedo,a=i.canUndo,s=Object(T.c)((function(e){return e.board}));return Object(S.jsx)(Vi,{children:Object(S.jsxs)("div",{className:"project-info-wrapper",children:[Object(S.jsxs)("div",{className:"block-with-info",children:[Object(S.jsx)("div",{className:"coralinio-logo",onClick:function(){},"data-tip":"Back to Home","data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"value",children:Object(S.jsx)(u.b,{to:"/",children:"coralinio"})})}),(null===s||void 0===s?void 0:s.name)?Object(S.jsx)("div",{className:"project-name",onClick:function(){if(s&&s.canToggleToFavourite){var e=te(),t=Object(ce.default)(e,(function(e){e.board&&(e.board.editModalVisible=!0)}));ne(t),tt(t)}},"data-tip":null!==(t=null===s||void 0===s?void 0:s.name)&&void 0!==t?t:"","data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"value",children:null!==(n=null===s||void 0===s?void 0:s.name)&&void 0!==n?n:""})}):null,(null===s||void 0===s?void 0:s.canToggleToFavourite)?Object(S.jsx)("div",{className:"add-to-fav",onClick:function(){if(s&&s.canToggleToFavourite){var e=te(),t=Object(ce.default)(e,(function(e){e.board&&(e.board.isFavourite=!e.board.isFavourite)}));ne(t),tt(t)}},"data-tip":!0===s.isFavourite?"Remove from favourite":"Add to favourite","data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)(q.a,{icon:s.isFavourite?Z.E:Wi.a})}):null,(null===s||void 0===s?void 0:s.canExportAsImage)?Object(S.jsx)("div",{className:"export-as-image",onClick:function(){try{var e=Ht.renderer.domElement.toDataURL("image/png").replace("image/png","image/octet-stream"),t=document.createElement("a");document.body.appendChild(t),t.download="coralinio-preview.png",t.href=e,t.click(),document.body.removeChild(t)}catch(n){return void console.log(n)}},"data-tip":"Export as Image","data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)(q.a,{icon:Z.M})}):null]}),o||a?Object(S.jsxs)("div",{className:"block-with-history",children:[Object(S.jsx)("div",{className:"undo-button ".concat(a?"active":"inactive"),onClick:function(){a&&Lt()},"data-tip":"UNDO","data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("span",{className:"icon",children:Object(S.jsx)(q.a,{icon:Z.z})})}),Object(S.jsx)("div",{className:"redo-button ".concat(o?"active":"inactive"," "),onClick:function(){o&&Gt()},"data-tip":"REDO","data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("span",{className:"icon",children:Object(S.jsx)(q.a,{icon:Z.z,style:{transform:"scaleX(-1)"}})})})]}):null]})})},Vi=b.a.div(ci||(ci=Object(h.a)(['\n  .project-info-wrapper {\n    position: absolute;\n    top: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: 10;\n    display: flex;\n    column-gap: calc(var(--standardPadding) * 2);\n    transition: all 0.4s ease-in-out;\n  }\n  .block-with-info {\n    background: #fff;\n    height: 55px;\n    display: flex;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n    column-gap: calc(var(--standardPadding) * 2);\n\n    .coralinio-logo {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      .value {\n        width: 120px;\n        transition: all 0.4s ease-in-out;\n        a {\n          transition: all 0.4s ease-in-out;\n          font-size: 29px;\n          font-family: "Fredoka One", cursive;\n          font-weight: 400;\n          text-transform: lowercase;\n          color: var(--uiButton);\n        }\n        &:hover a {\n          color: var(--uiButtonActive);\n        }\n      }\n    }\n    .project-name {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: "";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      .value {\n        font-size: 20px;\n        max-width: 200px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        font-family: "Open Sans", sans-serif;\n        font-weight: 400;\n      }\n    }\n    .add-to-fav {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: "";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n    .export-as-image {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: "";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n  }\n\n  .block-with-history {\n    display: flex;\n    background: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 55px;\n\n    .redo-button,\n    .undo-button {\n      width: 45px;\n      height: 100%;\n      padding-left: calc(var(--standardPadding) * 2);\n      padding-right: calc(var(--standardPadding) * 2);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &.active:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n      &.inactive {\n        svg path {\n          fill: var(--uiButtonInActive);\n        }\n      }\n    }\n  }\n']))),Zi=function(e){var t=Object(T.c)((function(e){return{zoomScale:e.ui.zoomScale}})).zoomScale;return Object(S.jsx)(qi,{children:Object(S.jsx)("div",{className:"minimap-wrapper",children:Object(S.jsxs)("div",{className:"minimap-wrapper-content",children:[Object(S.jsx)("div",{className:"item",onClick:function(){var e={name:Y.ChangeUiSettingsZoom,payload:{zoomType:"zoomOutScreenCenter",useAnimation:!0}};Un(e)},"data-tip":"Zoom Out","data-place":"top","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"value",children:Object(S.jsx)(q.a,{icon:Z.t})})}),Object(S.jsx)("div",{className:"item",onClick:function(){var e={name:Y.ChangeUiSettingsZoom,payload:{zoomType:"zoomInScreenCenter",useAnimation:!0}};Un(e)},"data-tip":"Zoom In","data-place":"top","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"value",children:Object(S.jsx)(q.a,{icon:Z.y})})}),Object(S.jsx)("div",{className:"item-text","data-tip":"Zoom percentage","data-place":"top","data-type":"dark","data-effect":"solid",children:Object(S.jsxs)("div",{className:"value",children:[Math.round(1/t*100),"%"]})})]})})})},qi=b.a.div(ri||(ri=Object(h.a)(["\n  .minimap-wrapper {\n    position: absolute;\n    z-index: var(--zIndexMinimap);\n    bottom: var(--standardPadding);\n    right: var(--standardPadding);\n    transition: all 0.4s ease-in-out;\n    width: var(--minimapWidth);\n  }\n  .minimap-wrapper-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding) / 2;\n  }\n  .item {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 45px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    cursor: pointer;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .item-text {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 70px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    font-size: 18px;\n    font-weight: 600;\n  }\n"]))),Ki=function(){var e=Object(T.c)((function(e){var t={};Object.keys(e.objects).forEach((function(n){if(e.objects[n].objectType===A.Bead){var i=e.objects[n],o={width:i.width,height:i.height,depth:i.depth,type:i.type,color:i.color},a=JSON.stringify(o);if(void 0===t[a]){var s=Object(v.cloneDeep)(i);s.rotateX=90,s.rotateY=0,s.rotateZ=0,t[a]={count:1,example:s,textName:"".concat(s.color),textTooltip:"".concat(s.color," - 1x")}}else{var c=t[a].count+1;t[a].count=c,t[a].textTooltip="".concat(i.color," - ").concat(c,"x")}}}));var n=[];return Object.keys(t).forEach((function(e,i){if(!(i>10)){var o=t[e],a="".concat(o.count,"x");n.push({count:o.count,example:o.example,textName:o.textName,textTooltip:o.textName,textCount:a})}})),{groupedCount:n}})).groupedCount;return Object(S.jsx)(Ji,{children:Object(S.jsx)("div",{className:"beads-summary",children:Object(S.jsx)("div",{className:"beads-summary-content",onClick:function(){var e={name:Y.ChangeUiSettingsSidebar,payload:{panel:"objects",open:!0,toggle:!0}};Un(e)},children:e.map((function(e,t){if(!e)return null;if(!e.example)return null;if(!Nt)return null;var n=Nt.getObjectThumbnail(e.example,30,30);return Object(S.jsxs)("div",{className:"bead-count","data-tip":e.textTooltip,"data-place":"top","data-type":"dark","data-effect":"solid",children:[Object(S.jsx)("span",{className:"preview",children:Object(S.jsx)("img",{src:n})}),Object(S.jsx)("span",{className:"value",children:e.textCount})]},t)}))})})})},Ji=b.a.div(di||(di=Object(h.a)(["\n  .beads-summary {\n    position: absolute;\n    bottom: var(--standardPadding);\n    right: calc(var(--standardPadding) + 170px + var(--standardPadding));\n    z-index: var(--zIndexBeadsSummary);\n    transition: all 0.4s ease-in-out;\n  }\n  .beads-summary-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding);\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n  }\n  .bead-count {\n    display: flex;\n    flex-direction: column;\n    cursor: pointer;\n\n    .value {\n      font-size: 15px;\n      font-weight: 600;\n    }\n\n    .preview {\n      width: 30px;\n      height: 30px;\n      /* border: 1px solid #eee; */\n      /* border-radius: 30px; */\n      /* font-size: 8px; */\n      /* line-height: 27px; */\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      white-space: nowrap;\n      overflow: hidden;\n    }\n  }\n"]))),Qi=function(e){var t=e.editorMode,n=function(e){var t={name:Y.ChangeUiSettings,payload:{uiSettings:{mode:e}}};Un(t)};return Object(S.jsxs)("div",{className:"",children:[Object(S.jsx)($i,{label:"Zaznacz lub przesu\u0144",icon:Object(S.jsx)(q.a,{icon:Z.u}),onClick:function(){return n(_.SelectOrMove)},isSelected:t===_.SelectOrMove}),Object(S.jsx)($i,{label:"Zaznacz wiele koralik\xf3w",icon:Object(S.jsx)(q.a,{icon:Z.p}),onClick:function(){return n(_.SelectMultiple)},isSelected:t===_.SelectMultiple}),Object(S.jsx)($i,{label:"Dodaj koraliki",icon:Object(S.jsx)(q.a,{icon:Z.k}),onClick:function(){return n(_.AddBeads)},isSelected:t===_.AddBeads}),Object(S.jsx)($i,{label:"Pomaluj koraliki",icon:Object(S.jsx)(q.a,{icon:Z.x}),onClick:function(){return n(_.PaintBeads)},isSelected:t===_.PaintBeads}),Object(S.jsx)($i,{label:"Usu\u0144 koraliki",icon:Object(S.jsx)(q.a,{icon:Z.K}),onClick:function(){return n(_.DeleteBeads)},isSelected:t===_.DeleteBeads}),Object(S.jsx)($i,{label:"Dodaj region z siatk\u0105",icon:Object(S.jsx)(q.a,{icon:Z.H}),onClick:function(){return n(_.AddRegion)},isSelected:t===_.AddRegion}),Object(S.jsx)(to,{label:"Dodaj wiele koralik\xf3w",icon:Object(S.jsx)(q.a,{icon:Z.I})})]})},$i=function(e){return Object(S.jsx)(eo,{children:Object(S.jsx)("div",{className:"action-button ".concat(e.isSelected?"is-active":""),onClick:e.onClick,"data-tip":e.label,"data-place":"right","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("span",{className:"icon",children:e.icon})})})},eo=b.a.div(li||(li=Object(h.a)(["\n  .action-button {\n    border: none;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: var(--uiButton);\n    animation: all 0.5s ease-in-out;\n    min-height: 40px;\n    .icon svg,\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      animation: all 0.5s ease-in-out;\n    }\n  }\n  .action-button:hover,\n  .action-button.is-active {\n    color: var(--uiButtonActive);\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      fill: var(--uiButtonActive);\n    }\n  }\n"]))),to=function(e){Object(T.b)();var t=[20,20],n=[1,1],i=c.a.useState(t),o=Object(l.a)(i,2),a=o[0],s=o[1],r=c.a.useState(n),d=Object(l.a)(r,2),u=d[0],p=d[1],h=c.a.useState(!1),b=Object(l.a)(h,2),v=b[0],f=b[1],j=function(){f(!v)};return Object(S.jsxs)("div",{style:{position:"relative"},children:[Object(S.jsx)(eo,{children:Object(S.jsx)("div",{className:"action-button ".concat(v?"is-active":""),onClick:j,"data-tip":!0===v?void 0:e.label,"data-place":"right","data-type":"dark","data-effect":"solid","data-tip-disable":!0===v,children:Object(S.jsx)("span",{className:"icon",children:e.icon})})}),!0===v?Object(S.jsx)(oo,{children:Object(S.jsx)(no,{selected:u,dimensions:a,setSelected:p,setDimensions:s,onSelect:function(e,i){var o={name:Y.AddMultipleBeads,payload:{rows:e,columns:i,figure:"rectangle"}};Un(o),j(),s(t),p(n)},onCancel:function(){s(t),f(!1)}})}):null]})},no=function(e){var t=c.a.useRef(null);return io(t,(function(){e.onCancel()})),Object(S.jsxs)("div",{className:"selection",children:[Object(S.jsx)("div",{className:"rect-wrapper",style:{width:15*e.dimensions[0]},ref:function(e){t.current=e},children:Object(v.times)(e.dimensions[0]).map((function(t){return Object(S.jsx)("div",{className:"row-wrapper",children:Object(v.times)(e.dimensions[1]).map((function(n){return Object(S.jsx)("div",{className:"rect ".concat(n<e.selected[1]&&t<e.selected[0]?"selected":""),onMouseEnter:function(){e.setSelected([t+1,n+1])},onClick:function(){e.onSelect(t+1,n+1)},children:"\xa0"},n)}))},t)}))}),Object(S.jsxs)("div",{className:"label-wrapper",children:[e.selected[0],"x",e.selected[1]]})]})},io=function(e,t){var n=function(n){e.current&&!e.current.contains(n.target)&&t()};c.a.useEffect((function(){return document.addEventListener("click",n),function(){document.removeEventListener("click",n)}}))},oo=b.a.div(ui||(ui=Object(h.a)(["\n  .selection {\n    position: absolute;\n    top: 0px;\n    left: 65px;\n    min-width: calc(5 * 10px + 20px);\n    min-height: 100px;\n    background: #fff;\n    z-index: 10;\n    border: 1px solid #dbdbdb;\n    padding: 10px 10px 0px 10px;\n    box-sizing: border-box;\n  }\n  .selection .rect-wrapper {\n    display: flex;\n  }\n  .selection .label-wrapper {\n    font-size: 12px;\n    color: #000;\n    text-align: center;\n    width: 100%;\n  }\n  .selection .rect {\n    width: 15px;\n    height: 15px;\n    border: 1px solid #fff;\n    background: transparent;\n    padding: 1px;\n    box-shadow: inset 0px 0px 0px 1px #e3e1e1;\n  }\n  .selection .rect.selected {\n    background: var(--btns_bg);\n  }\n"]))),ao=function(){var e=Object(T.c)((function(e){return e.ui.mode}));return Object(S.jsx)(so,{children:Object(S.jsx)("div",{className:"actions-wrapper",children:Object(S.jsx)("div",{className:"actions-content",children:Object(S.jsx)(Qi,{editorMode:e})})})})},so=b.a.div(pi||(pi=Object(h.a)(["\n  .actions-wrapper {\n    position: absolute;\n    z-index: var(--zIndexActions);\n    left: var(--standardPadding);\n    top: 50%;\n    transform: translate(0, -50%);\n    width: 56px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 0;\n    transition: all 0.4s ease-in-out;\n  }\n  .actions-content {\n    padding: 0;\n    background-color: rgba(255, 255, 255, 1);\n    padding: 12px 0;\n    transition: height 0.2s linear, top 0.2s linear;\n    border-radius: 4px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    width: 100%;\n  }\n"]))),co=b.a.div(hi||(hi=Object(h.a)(["\n  .content-wrapper {\n    padding: calc(var(--standardPadding) * 2);\n    position: relative;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: flex-start;\n    flex-direction: column;\n    overflow: auto;\n    max-height: 100%;\n  }\n  .close-wrapper {\n    position: absolute;\n    top: calc(var(--standardPadding) * 1);\n    right: calc(var(--standardPadding) * 1);\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n  }\n  .title {\n    font-size: 30px;\n    font-weight: 600;\n    margin-bottom: var(--standardPadding);\n  }\n"]))),ro=function(e){return Object(S.jsx)("div",{className:"close-wrapper",onClick:e.onClick,children:Object(S.jsx)(q.a,{icon:Z.J,color:"#000",size:"2x"})})},lo=function(){var e=Object(T.c)((function(e){return e.ui.rightSidebar}));return Object(S.jsx)(uo,{children:Object(S.jsx)("div",{className:"right-sidebar-wrapper",children:!0===e.isOpen?Object(S.jsxs)(S.Fragment,{children:["history"===e.panel?Object(S.jsx)(po,{}):null,"objects"===e.panel?Object(S.jsx)(bo,{}):null]}):null})})},uo=b.a.div(bi||(bi=Object(h.a)(["\n  .right-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    right: calc(var(--leftSidebarWidth) * -1);\n    width: var(--leftSidebarWidth);\n    z-index: var(--zIndexRightSidebar);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n"]))),po=function(){var e=Object(T.c)((function(e){return e.history.events}));return Object(S.jsx)(co,{children:Object(S.jsxs)("div",{className:"content-wrapper",children:[Object(S.jsx)("div",{className:"title",children:"History events"}),Object(S.jsx)(ro,{onClick:function(){var e={name:Y.ChangeUiSettingsSidebar,payload:{open:!1,panel:"history"}};Un(e)}}),Object(S.jsx)(ho,{children:Object(S.jsx)("div",{className:"events",children:e.map((function(e,t,n){var i=n.length-1-t,o=n[i];if(!o)return Object(S.jsx)(c.a.Fragment,{});var a=wn()(o.createdAt).format();return Object(S.jsxs)("div",{className:"event ".concat(o.isActive?"active":"inactive"),onClick:function(){!function(e){var t=Ft(),n=t.index-1;e===n||(e>=0&&e<n?Object(v.times)(n-e).forEach((function(){Lt()})):e<t.events.length&&e>n&&Object(v.times)(e-n).forEach((function(){Gt()})))}(i)},children:[Object(S.jsx)("div",{className:"icon",children:Object(S.jsx)(q.a,{icon:Z.q})}),Object(S.jsx)("div",{className:"name",children:o.name}),Object(S.jsx)("div",{className:"time","data-tip":a,"data-place":"bottom","data-type":"dark","data-effect":"solid",children:wn()(o.createdAt).format("HH:mm:ss")})]},t)}))})})]})})},ho=b.a.div(vi||(vi=Object(h.a)(["\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .events {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow: scroll;\n  }\n  .event {\n    display: grid;\n    grid-template-columns: 45px 1fr 100px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    cursor: pointer;\n    &.active {\n      background: #fff;\n      .icon {\n        svg path {\n          fill: #000;\n        }\n      }\n      .name {\n        color: #000;\n      }\n    }\n    &.inactive {\n      .icon {\n        svg path {\n          fill: #e9e9e9;\n        }\n      }\n      .name {\n        color: #e9e9e9;\n      }\n    }\n    &:hover {\n      background: #ccc;\n    }\n\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .time {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      white-space: nowrap;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      color: #c9c9c9;\n    }\n  }\n"]))),bo=function(){var e=Object(T.c)((function(e){return e.objects})),t=c.a.useState("all"),n=Object(l.a)(t,2),i=n[0],o=n[1],a=c.a.useState([]),s=Object(l.a)(a,2),r=s[0],d=s[1],u=function(t){o(t),"all"===t?d(Object.keys(e).map((function(t){return e[t]}))):"beads"===t?d(Object.keys(e).map((function(t){return e[t]})).filter((function(e){return e.objectType===A.Bead}))):"groups"===t?d(Object.keys(e).map((function(t){return e[t]})).filter((function(e){return e.objectType===A.Group}))):"other"===t&&d(Object.keys(e).map((function(t){return e[t]})).filter((function(e){return!(e.objectType===A.Bead||e.objectType===A.Group)})))};return c.a.useEffect((function(){u(i)}),[e]),Object(S.jsx)(co,{children:Object(S.jsxs)("div",{className:"content-wrapper",children:[Object(S.jsx)("div",{className:"title",children:"Objects"}),Object(S.jsx)(ro,{onClick:function(){var e={name:Y.ChangeUiSettingsSidebar,payload:{open:!1,panel:"objects"}};Un(e)}}),Object(S.jsxs)(vo,{children:[Object(S.jsxs)("div",{className:"filters",children:[Object(S.jsx)("div",{className:"filter ".concat("all"===i?"active":""),onClick:function(){u("all")},children:"All"}),Object(S.jsx)("div",{className:"filter ".concat("beads"===i?"active":""),onClick:function(){u("beads")},children:"Beads"}),Object(S.jsx)("div",{className:"filter ".concat("groups"===i?"active":""),onClick:function(){u("groups")},children:"Groups"}),Object(S.jsx)("div",{className:"filter ".concat("other"===i?"active":""),onClick:function(){u("other")},children:"Others"})]}),Object(S.jsx)("div",{className:"objects",children:r.map((function(e,t){if(!e)return Object(S.jsx)(c.a.Fragment,{});var n=e.objectType===A.Bead;return Object(S.jsxs)("div",{className:"object",onClick:function(){n&&Nt.getObjectThumbnail(e,500,500)},children:[Object(S.jsx)("div",{className:"icon",children:n?Object(S.jsx)("img",{src:Nt.getObjectThumbnail(e,30,30)}):Object(S.jsx)(q.a,{icon:Z.q})}),Object(S.jsx)("div",{className:"name",children:e.objectType}),Object(S.jsxs)("div",{className:"id",children:["ID:",e.id]})]},t)}))})]})]})})},vo=b.a.div(fi||(fi=Object(h.a)(["\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .filters {\n    background: #ebebef;\n    border-radius: 4px;\n    padding: 2px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    .filter {\n      border-radius: 4px;\n      padding: 10px 15px;\n    }\n    .filter.active {\n      background: #fff;\n    }\n  }\n\n  .objects {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n  }\n  .object {\n    display: grid;\n    grid-template-columns: 45px 1fr 200px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    width: 100%;\n    &:hover {\n      background: #e9e9e9;\n    }\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .id {\n      font-size: 10px;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      width: 100%;\n    }\n  }\n"]))),fo=function(){var e=Object(T.c)((function(e){return e.ui.leftSidebar}));return Object(S.jsx)(jo,{children:Object(S.jsx)("div",{className:"left-sidebar-wrapper",children:!0===e.isOpen?Object(S.jsx)(S.Fragment,{children:"comments"===e.panel?Object(S.jsx)(go,{}):null}):null})})},jo=b.a.div(ji||(ji=Object(h.a)(["\n  .left-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    left: calc(var(--leftSidebarWidth) * -1);\n    z-index: var(--zIndexLeftSidebar);\n    width: var(--leftSidebarWidth);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n"]))),go=function(){return Object(S.jsx)(co,{children:Object(S.jsxs)("div",{className:"content-wrapper",children:[Object(S.jsx)("div",{className:"title",children:"Comments"}),Object(S.jsx)("div",{children:"List is empty..."}),Object(S.jsx)(ro,{onClick:function(){var e={name:Y.ChangeUiSettingsSidebar,payload:{open:!1,panel:"comments"}};Un(e)}})]})})},mo=function(e){var t=c.a.useState(!0),n=Object(l.a)(t,2),i=n[0],o=n[1],a=Object(T.c)((function(e){return e.ui.leftSidebar})),s=Object(T.c)((function(e){return e.ui.rightSidebar}));return Object(S.jsx)(yo,{children:Object(S.jsxs)("div",{className:"bottom-bar-wrapper ".concat(i?"open":"closed"),children:[Object(S.jsxs)("div",{className:"buttons",children:[Object(S.jsx)("div",{className:"item ".concat("comments"===a.panel?"active":"inactive"),onClick:function(){var e={name:Y.ChangeUiSettingsSidebar,payload:{open:!0,panel:"comments",toggle:!0}};Un(e)},"data-tip":"Comments","data-place":"top","data-type":"dark","data-effect":"solid",children:Object(S.jsx)("div",{className:"value",children:Object(S.jsx)(q.a,{icon:Z.l})})}),Object(S.jsx)("div",{className:"item ".concat("history"===s.panel?"active":"inactive"),onClick:function(){var e={name:Y.ChangeUiSettingsSidebar,payload:{open:!0,panel:"history",toggle:!0}};Un(e)},children:Object(S.jsx)("div",{className:"value",children:Object(S.jsx)(q.a,{icon:Z.q,"data-tip":"History events","data-place":"top","data-type":"dark","data-effect":"solid"})})}),Object(S.jsx)("div",{className:"item ".concat("objects"===s.panel?"active":"inactive"),onClick:function(){var e={name:Y.ChangeUiSettingsSidebar,payload:{open:!0,panel:"objects",toggle:!0}};Un(e)},children:Object(S.jsx)("div",{className:"value",children:Object(S.jsx)(q.a,{icon:Z.r,"data-tip":"Objects","data-place":"top","data-type":"dark","data-effect":"solid"})})})]}),Object(S.jsx)("div",{className:"toggle-item",onClick:function(){o(!i)},children:Object(S.jsx)("div",{className:"value",children:Object(S.jsx)(q.a,{icon:i?Z.d:Z.e})})})]})})},yo=b.a.div(gi||(gi=Object(h.a)(["\n  .bottom-bar-wrapper {\n    position: absolute;\n    bottom: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: var(--zIndexBottomBar);\n    width: auto;\n    display: flex;\n    /* transition: all 0.4s ease-in-out; */\n    background: #fff;\n    height: 55px;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1),\n      left 0.4s ease-in-out;\n    &.open {\n    }\n    &.closed {\n      .buttons {\n        width: 0;\n      }\n    }\n  }\n  .buttons {\n    overflow: hidden;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1);\n    width: 100%;\n    white-space: nowrap;\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &.active,\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .toggle-item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      fill: #e9e9e9;\n    }\n  }\n"]))),xo=function(){var e=Object(T.c)((function(e){return e.ui.leftSidebar.isOpen})),t=Object(T.c)((function(e){return e.ui.rightSidebar.isOpen}));return Object(S.jsxs)("div",{children:[Object(S.jsx)(Gi.a,{}),Object(S.jsx)(Fi,{}),Object(S.jsx)(Oo,{children:Object(S.jsxs)("div",{className:"scene \n          ".concat(e?"left-sidebar-open":""," \n          ").concat(t?"right-sidebar-open":""),children:[Object(S.jsx)(wo,{}),Object(S.jsx)(Xi,{}),Object(S.jsx)(Zi,{}),Object(S.jsx)(Ki,{}),Object(S.jsx)(ao,{}),Object(S.jsx)(mo,{}),Object(S.jsx)(fo,{}),Object(S.jsx)(lo,{}),Object(S.jsx)(zi,{})]})})]})},Oo=b.a.div(mi||(mi=Object(h.a)(["\n  .scene {\n    border: 1px solid #e0e0e0;\n    position: relative;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: flex-start;\n    box-sizing: border-box;\n    height: 100vh;\n\n    .block-loading {\n      position: absolute;\n      top: 0;\n      left: 0;\n      background: rgba(255, 255, 255, 0.9);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      height: 100%;\n      z-index: var(--zIndexBlockLoading);\n      svg {\n        animation: rotating 2s linear infinite;\n      }\n    }\n\n    &.right-sidebar-open {\n      .right-sidebar-wrapper {\n        right: 0;\n      }\n\n      .minimap-wrapper {\n        right: calc(var(--standardPadding) + var(--leftSidebarWidth));\n      }\n      .beads-summary {\n        right: calc(\n          var(--standardPadding) + var(--leftSidebarWidth) +\n            var(--standardPadding) + var(--minimapWidth)\n        );\n      }\n    }\n\n    &.left-sidebar-open {\n      .left-sidebar-wrapper {\n        left: 0;\n      }\n      .project-info-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .actions-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .bottom-bar-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n    }\n  }\n\n  @keyframes rotating {\n    from {\n      -ms-transform: rotate(0deg);\n      -moz-transform: rotate(0deg);\n      -webkit-transform: rotate(0deg);\n      -o-transform: rotate(0deg);\n      transform: rotate(0deg);\n    }\n    to {\n      -ms-transform: rotate(360deg);\n      -moz-transform: rotate(360deg);\n      -webkit-transform: rotate(360deg);\n      -o-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n"]))),wo=function(){return!1===Object(T.c)((function(e){return e.ui.blockThreejs.loading}))?Object(S.jsx)(c.a.Fragment,{}):Object(S.jsx)("div",{className:"block-loading",children:Object(S.jsx)(q.a,{icon:Z.G})})},Do=function(e){return new Promise("demo"===e?function(e,t){Eo().then((function(t){e(t)}))}:function(t,n){(function(e){return new Promise((function(t,n){return fetch(i+"api/boards/one/"+e,{method:"GET",headers:f}).then((function(e){return e.json()})).then((function(e){e.statusCode&&200!==e.statusCode&&n(e.message),t({board:e.board,objects:Object.keys(e.objects).map((function(t){return e.objects[t]}))})})).catch((function(e){return j(e,n)}))}))})(e).then((function(e){t(e)})).catch((function(e){return n(e)}))})},Eo=function(){return new Promise((function(e,t){var n={},i=Le(E.TOHO_SPHERE);i&&(Math.abs(i.max.x-i.min.x),Math.abs(i.max.y-i.min.y),Math.abs(i.max.z-i.min.z)),e({board:{uuid:"123",name:"Projekt testowy"},objects:Object.keys(n).map((function(e){return n[e]}))})}))},ko=function(e){return Do(e).then((function(e){return new Promise((function(t,n){an();var i=te(),o=Object(ce.default)(i,(function(t){var n,i,o,a;t.board=Object(v.cloneDeep)(ee.board),t.history=Object(v.cloneDeep)(ee.history),t.objects=Object(v.cloneDeep)(ee.objects),t.selectedIds=Object(v.cloneDeep)(ee.selectedIds),t.ui=Object(v.cloneDeep)(ee.ui),void 0!==e.objects&&e.objects.length>0&&e.objects.forEach((function(e){t.objects[e.id]=e})),t.board.name=null!==(n=null===(i=e.board)||void 0===i?void 0:i.name)&&void 0!==n?n:"",t.board.uuid=null!==(o=null===(a=e.board)||void 0===a?void 0:a.uuid)&&void 0!==o?o:"",t.board.canEdit=!0,t.ui.blockThreejs.loading=!1}));ne(o),i.ui.lights.forEach((function(e){sn(e,Ht.scene)})),i.ui.grid&&function(e){var t=1e5,n=new Q.j(1,1e4,"#e9e9e9","#eee");n.position.x=0,n.position.y=0,n.position.z=-500,n.scale.x=t,n.scale.y=t,n.scale.z=t,n.rotation.x=90*Q.q.DEG2RAD,n.rotation.y=0*Q.q.DEG2RAD,n.rotation.z=0*Q.q.DEG2RAD,n.userData=Object(v.merge)({},e,{objectType:A.SceneBackgroundGrid,name:"".concat(A.SceneBackgroundGrid).concat(H).concat(e.id)}),Ht.scene.add(n)}(i.ui.grid),Object.keys(o.objects).forEach((function(e){cn(o.objects[e])})),tt(o),So(),t(void 0)}))}))},So=function(){var e=he({id:"beadr",color:"red",position:{x:0,y:0}}),t=he({id:"beadg",color:"green",position:{x:50,y:0}}),n=he({id:"beadb",color:"blue",position:{x:100,y:0}}),i=Ie({id:"regionA",position:{x:100,y:100},width:100,height:100}),o=Ie({id:"regionB",position:{x:250,y:100},width:100,height:100});Un({name:Y.AddObjects,payload:{objects:[e,t,n,i,o]}})},Io=function(e){var t=Object(p.g)().uuid;return c.a.useEffect((function(){var n,i,a;return(n=document.getElementById("threejs"),i=e.canvas,a=e.context,Jt(n,i,a)).then((function(){ko(t),"demo"!==t&&!0===e.data.save_events&&(g=!0,o=t,m=(new Date).getTime())})),function(){g=!1,void 0!==o&&(o=void 0),y.length>0&&(y=[]),new Promise((function(e){an();var t=te(),n=Object(ce.default)(t,(function(e){Object(v.cloneDeep)(ee)}));tt(n),e()})),function(e){e&&(e.innerHTML="",!0===e.classList.contains("active")&&e.classList.remove("active")),new Promise((function(e){e(void 0)}))}(document.getElementById("threejs"))}}),[]),Object(S.jsx)("div",{className:"App",children:Object(S.jsx)(T.a,{store:Ve,children:Object(S.jsx)(xo,{})})})},Co=n(47),To={isAuthorized:!1,data:void 0},Bo=Object(Co.a)({state:To,dispatch:function(){return null}}),Mo=function(e,t){switch(t.type){case"logout":return{isAuthorized:!1,data:void 0};default:return e}},Ao=function(){var e=Object(Co.b)(Bo,(function(e){return e.dispatch})),t=Object(p.f)();return Object(S.jsx)(_o,{children:Object(S.jsxs)("div",{children:[Object(S.jsx)("h2",{children:"Welcome"}),Object(S.jsx)("button",{onClick:function(){t.push("/boards")},className:"btn-light",children:"Boards"}),Object(S.jsx)("button",{onClick:function(){e({type:"logout"}),t.replace("/")},className:"btn-light",children:"Logout"})]})})},_o=b.a.div(yi||(yi=Object(h.a)(["\n  padding: 1em;\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #000;\n    margin-bottom: 10px;\n    margin-right: 10px;\n    cursor: pointer;\n  }\n  h2 {\n    margin-bottom: 0.5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n"]))),Po=function(e){return Object(S.jsx)("div",{children:"page NO MATCH"})},Ro=function(e){return Object(S.jsx)("div",{children:"Not autorized"})},No=function(e){var t=Object(Co.b)(Bo,(function(e){return e.state.isAuthorized}));return Object(S.jsx)(u.a,{hashType:"slash",children:t?Object(S.jsxs)(p.c,{children:[Object(S.jsx)(p.a,{exact:!0,path:"/",children:Object(S.jsx)(Ao,{data:e.data})}),Object(S.jsx)(p.a,{exact:!0,path:"/boards",children:Object(S.jsx)(I,{data:e.data})}),Object(S.jsx)(p.a,{exact:!0,path:"/board/:uuid",children:Object(S.jsx)(Io,{data:e.data,canvas:void 0,context:void 0})}),Object(S.jsx)(p.a,{path:"*",children:Object(S.jsx)(Po,{data:e.data})})]}):Object(S.jsxs)(p.c,{children:[Object(S.jsx)(p.a,{exact:!0,path:"/",children:Object(S.jsx)(Ro,{data:e.data})}),Object(S.jsx)(p.a,{path:"*",children:Object(S.jsx)(Po,{data:e.data})})]})})},Ho=function(e){var t,n;console.log("render App.tsx");var i,o=(null!==(t=null===(n=e.data)||void 0===n?void 0:n.token)&&void 0!==t?t:"").length>0,a=(i=!0===o?{isAuthorized:!0,data:e.data}:{isAuthorized:!1,data:void 0},c.a.useReducer(Mo,i)),s=Object(l.a)(a,2),r=s[0],d=s[1];return Object(S.jsx)(Bo.Provider,{value:{state:r,dispatch:d},children:Object(S.jsx)(No,{data:e.data})})},Uo=n(133);console.log("start app with version: ",Uo.version);var zo,Lo=document.getElementById("root");if(null!==Lo){var Go=document.createElement("div");Go.setAttribute("id","threejs"),Lo.parentNode&&Lo.parentNode.insertBefore(Go,Lo.nextSibling);try{var Fo={apiHost:"http://localhost:9000/",token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1dWlkIjoiYzY2Nzg4Y2QtZjM2OS1mNWU5LWFmOTEtYjhlNWI3NmIyNDZhIiwidXNlcm5hbWUiOiJyb2JlZWUiLCJpYXQiOjE2MTcyNTc3NjJ9.LgUWUiFdkarrIfR5FORUI6cnEBHyPgCDmJJXAQlEuBQ",user:{username:"robeee",uuid:"dc073641-01a4-107e-ae84-d3ec995bfc80"},save_events:!1},Yo=Lo.getAttribute("data-hash");if(Yo){var Wo=JSON.parse(Yo);Fo=Object(v.merge)({},Fo,Wo)}i=(zo=Fo).apiHost,f.Authorization="Bearer "+zo.token,d.a.render(Object(S.jsx)(Ho,{data:Fo}),Lo)}catch(Xo){}}}},[[256,1,2]]]);
//# sourceMappingURL=main.e70d7fc7.chunk.js.map