(this.webpackJsonpcoralinio=this.webpackJsonpcoralinio||[]).push([[0],{101:function(e,t,a){e.exports=a(178)},106:function(e,t,a){},108:function(e,t,a){},177:function(e,t){e.exports=function(e){var t=function(t,a,n,i,s){e.BufferGeometry.call(this),this.type="RoundedBoxGeometry",s=isNaN(s)?1:Math.max(1,Math.floor(s)),t=isNaN(t)?1:t,a=isNaN(a)?1:a,n=isNaN(n)?1:n,i=isNaN(i)?.15:i;var o=t/2-(i=Math.min(i,Math.min(t,Math.min(a,Math.min(n)))/2)),r=a/2-i,d=n/2-i;this.parameters={width:t,height:a,depth:n,radius:i,radiusSegments:s};var c=s+1,l=c*s+1<<3,u=new e.BufferAttribute(new Float32Array(3*l),3),h=new e.BufferAttribute(new Float32Array(3*l),3),p=[],f=[],g=(new e.Vector3,new e.Vector3),m=[],v=[],b=[],S=c*s,y=c*s+1;!function(){for(var t=[new e.Vector3(1,1,1),new e.Vector3(1,1,-1),new e.Vector3(-1,1,-1),new e.Vector3(-1,1,1),new e.Vector3(1,-1,1),new e.Vector3(1,-1,-1),new e.Vector3(-1,-1,-1),new e.Vector3(-1,-1,1)],a=0;a<8;a++)p.push([]),f.push([]);for(var n=Math.PI/2,c=new e.Vector3(o,r,d),l=0;l<=s;l++){var u=l/s*n,h=Math.cos(u),b=Math.sin(u);if(l!=s)for(var S=0;S<=s;S++){var y=S/s*n;g.x=h*Math.cos(y),g.y=b,g.z=h*Math.sin(y);x=g.clone().multiplyScalar(i).add(c);p[0].push(x),m.push(x);E=g.clone().normalize();f[0].push(E),v.push(E)}else{g.set(0,1,0);var x=g.clone().multiplyScalar(i).add(c);p[0].push(x),m.push(x);var E=g.clone();f[0].push(E),v.push(E)}}for(var k=1;k<8;k++)for(a=0;a<p[0].length;a++){x=p[0][a].clone().multiply(t[k]);p[k].push(x),m.push(x);E=f[0][a].clone().multiply(t[k]);f[k].push(E),v.push(E)}}(),function(){var e=S,t=S+y,a=S+2*y,n=S+3*y;b.push(e),b.push(t),b.push(a),b.push(e),b.push(a),b.push(n),e=S+4*y,t=S+5*y,a=S+6*y,n=S+7*y,b.push(e),b.push(a),b.push(t),b.push(e),b.push(n),b.push(a),e=0,t=y,a=4*y,n=5*y,b.push(e),b.push(a),b.push(t),b.push(t),b.push(a),b.push(n),e=2*y,t=3*y,a=6*y,n=7*y,b.push(e),b.push(a),b.push(t),b.push(t),b.push(a),b.push(n),e=s,t=s+3*y,a=s+4*y,n=s+7*y,b.push(e),b.push(t),b.push(a),b.push(t),b.push(n),b.push(a),e=s+y,t=s+2*y,a=s+5*y,n=s+6*y,b.push(e),b.push(a),b.push(t),b.push(t),b.push(a),b.push(n)}(),function(){for(var e=[!0,!1,!0,!1,!1,!0,!1,!0],t=c*(s-1),a=0;a<8;a++){for(var n=y*a,i=0;i<s-1;i++)for(var o=i*c,r=(i+1)*c,d=0;d<s;d++){var l=d+1,u=n+o+d,h=n+o+l,p=n+r+d,f=n+r+l;e[a]?(b.push(u),b.push(p),b.push(h),b.push(h),b.push(p),b.push(f)):(b.push(u),b.push(h),b.push(p),b.push(h),b.push(f),b.push(p))}for(d=0;d<s;d++){u=n+t+d,h=n+t+d+1,p=n+S;e[a]?(b.push(u),b.push(p),b.push(h)):(b.push(u),b.push(h),b.push(p))}}}(),function(){for(var e=0;e<4;e++)for(var t=e*y,a=4*y+t,n=!0&e,i=0;i<s;i++){var o=i+1,r=t+i,d=t+o,c=a+i,l=a+o;n?(b.push(r),b.push(c),b.push(d),b.push(d),b.push(c),b.push(l)):(b.push(r),b.push(d),b.push(c),b.push(d),b.push(l),b.push(c))}}(),function(){for(var e=s-1,t=[0,1,4,5],a=[3,2,7,6],n=[0,1,1,0],i=0;i<4;i++)for(var o=t[i]*y,r=a[i]*y,d=0;d<=e;d++){var l=o+s+d*c,u=o+(d!=e?s+(d+1)*c:y-1),h=r+s+d*c,p=r+(d!=e?s+(d+1)*c:y-1);n[i]?(b.push(l),b.push(h),b.push(u),b.push(u),b.push(h),b.push(p)):(b.push(l),b.push(u),b.push(h),b.push(u),b.push(p),b.push(h))}}(),function(){for(var e=[0,2,4,6],t=[1,3,5,7],a=0;a<4;a++)for(var n=y*e[a],i=y*t[a],o=1>=a,r=0;r<s;r++){var d=r*c,l=(r+1)*c,u=n+d,h=n+l,p=i+d,f=i+l;o?(b.push(u),b.push(p),b.push(h),b.push(h),b.push(p),b.push(f)):(b.push(u),b.push(h),b.push(p),b.push(h),b.push(f),b.push(p))}}();for(var x=0,E=0;E<m.length;E++)u.setXYZ(x,m[E].x,m[E].y,m[E].z),h.setXYZ(x,v[E].x,v[E].y,v[E].z),x++;this.setIndex(new e.BufferAttribute(new Uint16Array(b),1)),this.addAttribute("position",u),this.addAttribute("normal",h)};return t.prototype=Object.create(e.BufferGeometry.prototype),t.constructor=t,t}},178:function(e,t,a){"use strict";a.r(t);var n,i,s,o,r,d=a(0),c=a.n(d),l=a(14),u=a.n(l),h=(a(106),a(107),a(108),a(20)),p=a(26);!function(e){e.BasicRectangle="BasicRectangle",e.BasicEllipse="BasicEllipse"}(n||(n={})),function(e){e.Idle="Idle",e.EditLines="EditLines",e.AddLine="AddLine",e.EditBeads="EditBeads",e.AddBeads="AddBeads",e.DeleteBeads="DeleteBeads",e.PaintBeads="ColorPaint"}(i||(i={})),function(e){e.None="None",e.File="File",e.Grid="Grid",e.Background="Background"}(s||(s={})),function(e){e.Hex="Hex",e.Box="Box"}(o||(o={})),function(e){e.Color="Color"}(r||(r={}));var f,g,m,v=a(11),b=a(9),S=a(3),y=a(4),x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(y.a)({x:e,y:t},p.immerable,!0)},E=function(e){var t=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)}(e),a=0===t,n=a?0:e.x/t,i=a?0:e.y/t;return x(n,i)},k=function(e,t){return x(e.x*t,e.y*t)},B=function(e,t,a){return x(e.x+t,e.y+a)},C=function(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},D=function(e,t,a){return a.x>e.x&&a.x<t.x&&a.y>e.y&&a.y<t.y},w=a(10),_=a(15),O=a(16),j=a(18),I=a(17),M=a(19),L=a(55),A=a(27),R=a.n(A),N=function(e){var t=Object(y.a)({id:Object(L.generate)(),position:x(0,0),type:n.BasicEllipse,rotate:0,lineRotate:0,color:"#4fc3f7",height:10,width:10,keepAspectRatio:!1},p.immerable,!0);return Object(A.merge)(t,e)},T=function(e){var t=Object(y.a)({id:Object(L.generate)(),start:x(10,10),end:x(100,100),beadIds:[],settings:{beadsCount:0,beadsAutoCount:!0,beadsSpacing:0,beadsAutoSpacing:!1,defaultBead:N({})}},p.immerable,!0);return Object(A.merge)(t,e)},F=function(e,t,a,n,i){var s=x(a-e,n-t);return s=E(s),s=k(s,i),s=B(s,e,t)},H=function(e){function t(){return Object(_.a)(this,t),Object(j.a)(this,Object(I.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(O.a)(t,[{key:"updateBeadsPositions",value:function(e){var t=this.draftState.appData.lines[e],a=this.getLineBeadsCount(e),n=t.beadIds.length;if(a>n){var i=a-n;this.addRemainingBeads(e,i)}else if(a<n){var s=n-a;this.removeOverflowBeads(e,s)}this.draftState.appData.lines[e].settings.beadsCount=a,this.modifyBeadsPosition(e),this.modifyBeadsRotate(e)}},{key:"getLineBeadsCount",value:function(e){var t=this,a=this.draftState.appData.lines[e],n=a.settings,i=n.beadsAutoCount,s=n.beadsAutoSpacing,o=n.beadsCount,r=n.beadsSpacing,d=n.defaultBead,c=a.start,l=a.end,u=a.beadIds,h=C(c,l);if(!0===i&&!0===s){var p=[],f=0;if(u.forEach((function(e){var a=t.draftState.appData.beads[e].width;f+=a,p.push(a)})),h>=f){var g=d.width?d.width:10,m=h-f;return Math.floor(m/g)+p.length}for(var v=p.length-1;v>=0;v--){if(h>(f-=p[v]))return v}return 0}if(!1===i&&!1===s)return o;if(!0===i&&!1===s){var b=[],S=0;if(u.forEach((function(e){var a=t.draftState.appData.beads[e].width+r;S+=a,b.push(a)})),h>=S-r){var y=d.width?d.width:10,x=h-(S-r);return Math.floor(x/(y+r))+b.length}for(var E=b.length-1;E>=0;E--){if(h>(S-=b[E])-r)return E}return 0}return!1===i&&!0===s?o:0}},{key:"addRemainingBeads",value:function(e,t){for(var a=this.draftState.appData.lines[e],n=0;n<t;n++){var i={};a.settings.defaultBead?i=Object(h.a)({},a.settings.defaultBead):this.draftState.ui.lineSettings.settings&&this.draftState.ui.lineSettings.settings.defaultBead&&(i=Object(h.a)({},this.draftState.ui.lineSettings.settings.defaultBead)),i.id=void 0,i.position=void 0;var s=N(i);this.draftState.appData.beads[s.id]=s,this.draftState.appData.lines[e].beadIds.push(s.id)}}},{key:"removeOverflowBeads",value:function(e,t){for(var a=0;a<t;a++){var n=this.draftState.appData.lines[e].beadIds.length,i=this.draftState.appData.lines[e].beadIds.splice(n-1,1);delete this.draftState.appData.beads[i[0]]}}},{key:"modifyBeadsPosition",value:function(e){var t=this,a=this.draftState.appData.lines[e],n=a.start,i=a.end,s=a.beadIds,o=a.settings,r=o.beadsAutoCount,d=o.beadsAutoSpacing,c=o.beadsSpacing;if(!0===r&&!0===d){var l=0;this.draftState.appData.lines[e].beadIds.forEach((function(e){var a=t.draftState.appData.beads[e],s=a.width,o=a.height;l+=s/2;var r=F(n.x,n.y,i.x,i.y,l),d=r.x-s/2,c=r.y-o/2+5;t.draftState.appData.beads[e].position.x=d,t.draftState.appData.beads[e].position.y=c,l+=s/2}))}else if(!1===r&&!1===d){var u=0;this.draftState.appData.lines[e].beadIds.forEach((function(e){var a=t.draftState.appData.beads[e],s=a.width,o=a.height;u+=s/2;var r=F(n.x,n.y,i.x,i.y,u),d=r.x-s/2,l=r.y-o/2+5;t.draftState.appData.beads[e].position.x=d,t.draftState.appData.beads[e].position.y=l,u=u+s/2+c}))}else if(!0===r&&!1===d){var h=0;this.draftState.appData.lines[e].beadIds.forEach((function(e){var a=t.draftState.appData.beads[e],s=a.width,o=a.height;h+=s/2;var r=F(n.x,n.y,i.x,i.y,h),d=r.x-s/2,l=r.y-o/2+5;t.draftState.appData.beads[e].position.x=d,t.draftState.appData.beads[e].position.y=l,h=h+s/2+c}))}else if(!1===r&&!0===d){var p=0;s.forEach((function(e){var a=t.draftState.appData.beads[e].width;p+=a}));var f=C(n,i)-p,g=0;s.length>1&&(g=f/(s.length-1));var m=0;this.draftState.appData.lines[e].beadIds.forEach((function(e){var a=t.draftState.appData.beads[e],s=a.width,o=a.height;m+=s/2;var r=F(n.x,n.y,i.x,i.y,m),d=r.x-s/2,c=r.y-o/2+5;t.draftState.appData.beads[e].position.x=d,t.draftState.appData.beads[e].position.y=c,m=m+s/2+g}))}}},{key:"modifyBeadsRotate",value:function(e){var t,a,n=this,i=this.draftState.appData.lines[e],s=i.start,o=i.end,r=i.beadIds,d=(t=s.x-o.x,a=s.y-o.y,Math.atan2(t,a));r.forEach((function(e){n.draftState.appData.beads[e].lineRotate=-1*(180*d/Math.PI)}))}}]),t}(w.ImmerReducer),P=function(){function e(){Object(_.a)(this,e),this._events=void 0,this._events={}}return Object(O.a)(e,[{key:"on",value:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)}},{key:"removeListener",value:function(e,t){if(!this._events[e])throw new Error("Can't remove a listener. Event \"".concat(e,"\" doesn't exits."));this._events[e]=this._events[e].filter((function(e){return e!==t}))}},{key:"emit",value:function(e,t,a){if(console.log("EventEmitter:emit:",e,t),this._events[e]){this._events[e].forEach((function(e){e(t,a)}))}else console.warn("Can't emit an event. Event \"".concat(e,"\" doesn't exits."))}}]),e}(),z=function(){return void 0===f&&(f=new P),f},V=function(e){function t(){return Object(_.a)(this,t),Object(j.a)(this,Object(I.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(O.a)(t,[{key:"action_updateSceneZoom",value:function(e){this.draftState.ui.sceneWrapperPosition=e}},{key:"action_updateSceneWrapperSize",value:function(e){var t=e.width,a=e.height;this.draftState.ui.sceneWrapperWidth=t,this.draftState.ui.sceneWrapperHeight=a}},{key:"editorAppDataHasChanged",value:function(){this.draftState.ui.saveInfo.saved=!1,this.draftState.ui.saveInfo.haveUnsavedChanges=!0}},{key:"action_onAddLine",value:function(e,t){var a=T(Object(h.a)({},this.draftState.ui.lineSettings,{start:e,end:t}));this.draftState.appData.lines[a.id]=a,this.draftState.mode=i.EditLines,this.updateBeadsPositions(a.id),this.editorAppDataHasChanged()}},{key:"action_onStartPointDrag",value:function(e,t){if(this.draftState.appData.lines[e]){var a=this.draftState.appData.lines[e],n=this.draftState.ui.grid,i=n.width,s=n.height,r=n.snapEnabled,d=n.type,c=n.hexSize;if(!0===r){if(d===o.Box)a.start.x=Math.round(t.x/i)*i-5,a.start.y=Math.round(t.y/s)*s-5;else if(d===o.Hex){var l=Math.sqrt(3)*c,u=2*c,h=.75*u,p=Math.round(t.x/l)*l-5,f=Math.round(t.y/h),g=f*h-5-u/4;a.start.y=g,a.start.x=f%2===0?l/2+p:p}}else a.start.x=t.x-5,a.start.y=t.y-5;this.updateBeadsPositions(a.id),this.editorAppDataHasChanged()}}},{key:"action_onEndPointDrag",value:function(e,t){if(this.draftState.appData.lines[e]){var a=this.draftState.appData.lines[e],n=this.draftState.ui.grid,i=n.width,s=n.height,r=n.snapEnabled,d=n.hexSize,c=n.type;if(!0===r){if(c===o.Box)a.end.x=Math.round(t.x/i)*i-5,a.end.y=Math.round(t.y/s)*s-5;else if(c===o.Hex){var l=Math.sqrt(3)*d,u=2*d,h=.75*u,p=Math.round(t.x/l)*l-5,f=Math.round(t.y/h),g=f*h-5-u/4;a.end.y=g,a.end.x=f%2===0?l/2+p:p}}else a.end.x=t.x-5,a.end.y=t.y-5;this.updateBeadsPositions(a.id),this.editorAppDataHasChanged()}}},{key:"action_onLineDrag",value:function(e,t){var a=t.startX,n=t.startY,i=t.lineStart,s=t.lineEnd,r=t.x,d=t.y;if(this.draftState.appData.lines[e]){var c=this.draftState.appData.lines[e],l=this.draftState.ui.grid,u=l.width,h=l.height,p=l.snapEnabled,f=l.type,g=l.hexSize;if(!0===p){if(f===o.Box)c.start.x=Math.round((c.start.x+t.deltaX)/u)*u-5,c.start.y=Math.round((c.start.y+t.deltaY)/h)*h-5,c.end.x=Math.round((c.end.x+t.deltaX)/u)*u-5,c.end.y=Math.round((c.end.y+t.deltaY)/h)*h-5;else if(f===o.Hex){var m=Math.sqrt(3)*g,v=2*g,b=.75*v;if(null!==i){var S=i.x+(r-a),y=i.y+(d-n),x=Math.round(S/m)*m-5,E=Math.round(y/b),k=E*b-5-v/4;c.start.y=k,c.start.x=E%2===0?m/2+x:x}if(null!==s){var B=s.x+(r-a),C=s.y+(d-n),D=Math.round(B/m)*m-5,w=Math.round(C/b),_=w*b-5-v/4;c.end.y=_,c.end.x=w%2===0?m/2+D:D}}}else c.start.x=c.start.x+t.deltaX,c.start.y=c.start.y+t.deltaY,c.end.x=c.end.x+t.deltaX,c.end.y=c.end.y+t.deltaY;this.updateBeadsPositions(c.id),this.editorAppDataHasChanged()}}},{key:"action_onGroupLineDrag",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){if(t.draftState.appData.lines[a]){var n=t.draftState.appData.lines[a],i=t.draftState.ui.grid,s=i.width,o=i.height;!0===i.snapEnabled?(n.start.x=Math.round((n.start.x+e.deltaX)/s)*s-5,n.start.y=Math.round((n.start.y+e.deltaY)/o)*o-5,n.end.x=Math.round((n.end.x+e.deltaX)/s)*s-5,n.end.y=Math.round((n.end.y+e.deltaY)/o)*o-5):(n.start.x=n.start.x+e.deltaX,n.start.y=n.start.y+e.deltaY,n.end.x=n.end.x+e.deltaX,n.end.y=n.end.y+e.deltaY),t.updateBeadsPositions(n.id)}})),this.editorAppDataHasChanged()}},{key:"action_onGroupBeadsDrag",value:function(e){}},{key:"action_onClickLine",value:function(e){this.draftState.ui.selectedLinesIds={},this.draftState.ui.selectedLinesIds[e]=!0,this.draftState.ui.selectedLinesIdsCount=1}},{key:"action_onClickLastestLine",value:function(){var e=Object.keys(this.draftState.appData.lines);if(e.length>0){var t=e[e.length-1];this.action_onClickLine(t)}}},{key:"action_onClickBead",value:function(e){this.draftState.ui.selectedBeadsIds={},this.draftState.ui.selectedBeadsIds[e]=!0,this.draftState.ui.selectedBeadsIdsCount=1}},{key:"action_addBeads_onMouseDown",value:function(e){var t=e.x,a=e.y;this.draftState.ui.currentBeadChain.isDragEnabled=!0;var n=Object(h.a)({},this.draftState.ui.beadsTemplate);n.id=void 0,n.position=x(t,a);var i=N(n);i.position.x=i.position.x-i.width/2,i.position.y=i.position.y-i.height/2,this.draftState.appData.beads[i.id]=i,this.draftState.ui.currentBeadChain.beadIds.push(i.id)}},{key:"action_addBeads_onMouseMove",value:function(e){var t=e.x,a=e.y;if(this.draftState.ui.currentBeadChain.isDragEnabled){var n=this.draftState.ui.currentBeadChain.beadIds.length,i=this.draftState.ui.currentBeadChain.beadIds[n-1],s=this.draftState.appData.beads[i],o=x(t,a),r=x(s.position.x+s.width/2,s.position.y+s.height/2);if(C(r,o)>s.width){var d=function(e,t,a){return x(e.x-t,e.y-a)}(o,r.x,r.y),c=E(d),l=k(c,s.width),u=Object(h.a)({},this.draftState.ui.beadsTemplate);u.id=void 0;var p=r.x+l.x,f=r.y+l.y;u.position=x(p,f);var g=N(u);g.position.x=g.position.x-g.width/2,g.position.y=g.position.y-g.height/2,this.draftState.appData.beads[g.id]=g,this.draftState.ui.currentBeadChain.beadIds.push(g.id)}}}},{key:"action_addBeadOnClick",value:function(e){var t=e.x,a=e.y,n=Object(h.a)({},this.draftState.ui.beadsTemplate);n.id=void 0,n.position=x(t,a);var i=N(n);i.position.x=i.position.x-i.width/2,i.position.y=i.position.y-i.height/2,this.draftState.appData.beads[i.id]=i,z().emit("action_addBeadOnClick",{bead:i},this.state)}},{key:"action_addBeads_onMouseUp",value:function(e){e.x,e.y;this.draftState.ui.currentBeadChain.isDragEnabled=!1,this.draftState.ui.currentBeadChain.beadIds=[]}}]),t}(H),W=function(e){function t(){return Object(_.a)(this,t),Object(j.a)(this,Object(I.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(O.a)(t,[{key:"action_onClearCanvas",value:function(){this.draftState.appData.beads={},this.draftState.appData.lines={},this.draftState.ui.selectedBeadsIds={},this.draftState.ui.selectedBeadsIdsCount=0,this.draftState.ui.selectedLinesIds={},this.draftState.ui.selectedLinesIdsCount=0,this.draftState.ui.saveInfo.saved=!1,this.draftState.ui.saveInfo.haveUnsavedChanges=!1}},{key:"action_readSavedCanvas",value:function(){console.log("action_readSavedCanvas");for(var e=0;e<100;e+=10)for(var t=0;t<500;t+=10){var a=N({width:8,height:8,position:{x:e,y:t}});this.draftState.appData.beads[a.id]=a}z().emit("action_readSavedCanvas",this.draftState.appData,this.state)}},{key:"action_onSaveCanvas",value:function(){"localStorage"in window?(localStorage.setItem("appData",JSON.stringify(this.draftState.appData)),this.draftState.ui.saveInfo.saved=!0,this.draftState.ui.saveInfo.haveUnsavedChanges=!1,console.log("action_onSaveCanvas saved")):(this.draftState.ui.saveInfo.saved=!1,console.info("No localstorage available"))}}]),t}(H),G=function(e){function t(){var e,a;Object(_.a)(this,t);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(a=Object(j.a)(this,(e=Object(I.a)(t)).call.apply(e,[this].concat(i)))).clearSelectedBeads=function(){a.draftState.ui.selectedBeadsIdsCount>0&&(a.draftState.ui.selectedBeadsIds={},a.draftState.ui.selectedBeadsIdsCount=0)},a.clearSelectedLines=function(){a.draftState.ui.selectedLinesIdsCount&&(a.draftState.ui.selectedLinesIds={},a.draftState.ui.selectedLinesIdsCount=0)},a}return Object(M.a)(t,e),Object(O.a)(t,[{key:"action_onChangeEditorMode",value:function(e){this.draftState.mode=e,this.clearSelectedBeads(),this.clearSelectedLines()}},{key:"action_setSaveInfo",value:function(e){this.draftState.ui.saveInfo.saved=e}}]),t}(w.ImmerReducer),Y=function(e){function t(){return Object(_.a)(this,t),Object(j.a)(this,Object(I.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(O.a)(t,[{key:"action_test",value:function(){}},{key:"action_restoreState",value:function(){}}]),t}(w.ImmerReducer),X=function(e){function t(){return Object(_.a)(this,t),Object(j.a)(this,Object(I.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(O.a)(t,[{key:"action_onEditBeadsMouseDown",value:function(e,t){console.log("action_onEditBeadsMouseDown??"),this.draftState.ui.mouseSelection.isDragStarted=!0,this.draftState.ui.mouseSelection.start.x=e,this.draftState.ui.mouseSelection.start.y=t,this.draftState.ui.mouseSelection.end.x=e,this.draftState.ui.mouseSelection.end.y=t}},{key:"action_onEditBeadsMouseMove",value:function(e,t){var a=this;if(console.log("action_onEditBeadsMouseMove??"),this.draftState.ui.mouseSelection.end.x=e,this.draftState.ui.mouseSelection.end.y=t,!1===this.draftState.ui.mouseSelection.isDragged){var n=this.draftState.ui.mouseSelection,i=n.start,s=n.end,o=s.x-i.x,r=s.y-i.y;(Math.abs(o)>5||Math.abs(r)>5)&&(this.draftState.ui.mouseSelection.isDragged=!0)}if(!0===this.draftState.ui.mouseSelection.isDragged){var d=this.draftState.ui.mouseSelection,c=d.start,l=d.end,u=x(Math.min(c.x,l.x),Math.min(c.y,l.y)),h=x(Math.max(c.x,l.x),Math.max(c.y,l.y));this.draftState.ui.selectedBeadsIds={},this.draftState.ui.selectedBeadsIdsCount=0,Object.keys(this.draftState.appData.beads).forEach((function(e){var t=a.draftState.appData.beads[e],n=x(t.position.x+10,t.position.y+10);D(u,h,n)&&(a.draftState.ui.selectedBeadsIds[e]=!0,a.draftState.ui.selectedBeadsIdsCount=a.draftState.ui.selectedBeadsIdsCount+1)}))}}},{key:"action_selectBeads",value:function(e){var t=this,a=Object.keys(this.draftState.ui.selectedBeadsIds),n=R.a.xor(a,e).map((function(e){return a.includes(e)?Object(y.a)({},e,!1):Object(y.a)({},e,!0)}));this.draftState.ui.selectedBeadsIds={},this.draftState.ui.selectedBeadsIdsCount=0,e.length>0&&Object.keys(this.draftState.appData.beads).forEach((function(a){e.includes(a)&&(t.draftState.ui.selectedBeadsIds[a]=!0,t.draftState.ui.selectedBeadsIdsCount=t.draftState.ui.selectedBeadsIdsCount+1)})),z().emit("action_selectBeads",{diffStates:n},this.state)}},{key:"action_onEditBeadsMouseUp",value:function(){!1===this.draftState.ui.mouseSelection.isDragged&&this.draftState.ui.selectedBeadsIdsCount>0&&(this.draftState.ui.selectedBeadsIds={},this.draftState.ui.selectedBeadsIdsCount=0),this.draftState.ui.mouseSelection.isDragStarted=!1,this.draftState.ui.mouseSelection.isDragged=!1,this.draftState.ui.mouseSelection.start.x=0,this.draftState.ui.mouseSelection.start.y=0,this.draftState.ui.mouseSelection.end.x=0,this.draftState.ui.mouseSelection.end.y=0}},{key:"action_onEditLinesMouseDown",value:function(e,t){this.draftState.ui.mouseSelection.isDragStarted=!0,this.draftState.ui.mouseSelection.start.x=e,this.draftState.ui.mouseSelection.start.y=t,this.draftState.ui.mouseSelection.end.x=e,this.draftState.ui.mouseSelection.end.y=t}},{key:"action_onEditLinesMouseMove",value:function(e,t){var a=this;if(this.draftState.ui.mouseSelection.end.x=e,this.draftState.ui.mouseSelection.end.y=t,!1===this.draftState.ui.mouseSelection.isDragged){var n=this.draftState.ui.mouseSelection,i=n.start,s=n.end,o=s.x-i.x,r=s.y-i.y;(Math.abs(o)>5||Math.abs(r)>5)&&(this.draftState.ui.mouseSelection.isDragged=!0)}if(!0===this.draftState.ui.mouseSelection.isDragged){var d=this.draftState.ui.mouseSelection,c=d.start,l=d.end,u=x(Math.min(c.x,l.x),Math.min(c.y,l.y)),h=x(Math.max(c.x,l.x),Math.max(c.y,l.y));this.draftState.ui.selectedLinesIds={},this.draftState.ui.selectedLinesIdsCount=0,Object.keys(this.draftState.appData.lines).forEach((function(e){var t=a.draftState.appData.lines[e];(D(u,h,t.start)||D(u,h,t.end))&&(a.draftState.ui.selectedLinesIds[e]=!0,a.draftState.ui.selectedLinesIdsCount=a.draftState.ui.selectedLinesIdsCount+1)}))}}},{key:"action_onEditLinesMouseUp",value:function(){!1===this.draftState.ui.mouseSelection.isDragged&&this.draftState.ui.selectedLinesIdsCount>0&&(this.draftState.ui.selectedLinesIds={},this.draftState.ui.selectedLinesIdsCount=0),this.draftState.ui.mouseSelection.isDragStarted=!1,this.draftState.ui.mouseSelection.isDragged=!1,this.draftState.ui.mouseSelection.start.x=0,this.draftState.ui.mouseSelection.start.y=0,this.draftState.ui.mouseSelection.end.x=0,this.draftState.ui.mouseSelection.end.y=0}}]),t}(w.ImmerReducer),U=function(e){function t(){return Object(_.a)(this,t),Object(j.a)(this,Object(I.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(O.a)(t,[{key:"editorAppDataHasChanged",value:function(){this.draftState.ui.saveInfo.saved=!1,this.draftState.ui.saveInfo.haveUnsavedChanges=!0}},{key:"action_changeBeadFill",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedBeadsIds).forEach((function(a){t.draftState.appData.beads[a].color=e})),this.editorAppDataHasChanged()}},{key:"action_changeBeadType",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedBeadsIds).forEach((function(a){t.draftState.appData.beads[a].type=e})),this.editorAppDataHasChanged()}},{key:"action_onBeadRotate",value:function(e,t){t.deg}},{key:"action_onBeadsRotate",value:function(e){e.deg}},{key:"action_changeSelectedLinesBeadsSpacing",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.beadsSpacing=e,t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLinesBeadsAutoSpacing",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.beadsAutoSpacing=e,t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLinesBeadsCount",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.beadsCount=e,t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLinesBeadsAutoCount",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.beadsAutoCount=e,t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_resetSelectedLines",value:function(){var e=this,t=Object.keys(this.draftState.ui.selectedLinesIds)[0],a=this.draftState.appData.lines[t],n=Object(h.a)({},a.settings.defaultBead);n.id=void 0,n.position=void 0,Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(t){e.draftState.appData.lines[t].beadIds.forEach((function(t){n&&(e.draftState.appData.beads[t]=Object(A.merge)(e.draftState.appData.beads[t],n))})),e.draftState.appData.lines[t].settings.defaultBead=Object(A.merge)(e.draftState.appData.lines[t].settings.defaultBead,n),e.updateBeadsPositions(t)})),this.editorAppDataHasChanged()}},{key:"action_deleteSelectedLines",value:function(){var e=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(t){e.draftState.appData.lines[t].beadIds.forEach((function(t){delete e.draftState.appData.beads[t]})),delete e.draftState.appData.lines[t]})),this.draftState.ui.selectedLinesIds={},this.draftState.ui.selectedLinesIdsCount=0,this.editorAppDataHasChanged()}},{key:"action_cloneSelectedLines",value:function(){var e=this,t=[];Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){var n=T(Object(h.a)({},e.draftState.appData.lines[a],{id:void 0,beadIds:[]}));n.start.x=n.start.x+20,n.start.y=n.start.y+20,n.end.x=n.end.x+20,n.end.y=n.end.y+20,e.draftState.appData.lines[a].beadIds.forEach((function(t){var a=N(Object(h.a)({},e.draftState.appData.beads[t],{id:void 0}));a.position.x=a.position.x+20,a.position.y=a.position.y+20,e.draftState.appData.beads[a.id]=a,n.beadIds.push(a.id)})),t.push(n.id),e.draftState.appData.lines[n.id]=n})),t.forEach((function(t){e.updateBeadsPositions(t)})),this.draftState.ui.selectedLinesIds={},this.draftState.ui.selectedLinesIdsCount=0,t.forEach((function(t){e.draftState.ui.selectedLinesIds[t]=!0,e.draftState.ui.selectedLinesIdsCount=e.draftState.ui.selectedLinesIdsCount+1})),this.editorAppDataHasChanged()}},{key:"action_changeDefaultLineBeadsCount",value:function(e){this.draftState.ui.lineSettings.settings&&(this.draftState.ui.lineSettings.settings.beadsCount=e)}},{key:"action_changeDefaultLineBeadsAutoCount",value:function(e){this.draftState.ui.lineSettings.settings&&(this.draftState.ui.lineSettings.settings.beadsAutoCount=e)}},{key:"action_changeDefaultLineBeadsSpacing",value:function(e){this.draftState.ui.lineSettings.settings&&(this.draftState.ui.lineSettings.settings.beadsSpacing=e)}},{key:"action_changeDefaultLineBeadsAutoSpacing",value:function(e){this.draftState.ui.lineSettings.settings&&(this.draftState.ui.lineSettings.settings.beadsAutoSpacing=e)}},{key:"action_changeDefaultLineBeadType",value:function(e){this.draftState.ui.lineSettings.settings&&this.draftState.ui.lineSettings.settings.defaultBead&&(this.draftState.ui.lineSettings.settings.defaultBead.type=e)}},{key:"action_changeDefaultLineColor",value:function(e){this.draftState.ui.lineSettings.settings&&this.draftState.ui.lineSettings.settings.defaultBead&&(this.draftState.ui.lineSettings.settings.defaultBead.color=e)}},{key:"action_changeDefaultLineBeadHeight",value:function(e){var t=this.draftState.ui.lineSettings;if(t.settings&&t.settings.defaultBead){var a=t.settings.defaultBead,n=a.width,i=a.height;if(a.keepAspectRatio&&n&&i)if(i>=1){var s=n/i;t.settings.defaultBead.width=e*s,t.settings.defaultBead.height=e}else t.settings.defaultBead.height=1;else t.settings.defaultBead.height=e}}},{key:"action_changeDefaultLineBeadWidth",value:function(e){var t=this.draftState.ui.lineSettings;if(t.settings&&t.settings.defaultBead){var a=t.settings.defaultBead,n=a.width,i=a.height;if(a.keepAspectRatio&&n&&i)if(n>=1){var s=i/n;t.settings.defaultBead.width=e,t.settings.defaultBead.height=e*s}else t.settings.defaultBead.width=1;else t.settings.defaultBead.width=e}}},{key:"action_changeDefaultLineBeadKeepAspectRatio",value:function(e){var t=this.draftState.ui.lineSettings;t.settings&&t.settings.defaultBead&&(t.settings.defaultBead.keepAspectRatio=e)}},{key:"action_changeDefaultLineBeadRotate",value:function(e){var t=this.draftState.ui.lineSettings;t.settings&&t.settings.defaultBead&&(t.settings.defaultBead.rotate=e)}},{key:"action_changeSelectedLines_settings_beadsCount",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.beadsCount=e,t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLines_settings_beadsAutoCount",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.beadsAutoCount=e,t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLines_settings_beadsSpacing",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.beadsSpacing=e,t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLines_settings_beadsAutoSpacing",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.beadsAutoSpacing=e,t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLines_defaultBead_type",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.defaultBead.type=e,t.draftState.appData.lines[a].beadIds.forEach((function(a){t.draftState.appData.beads[a].type=e})),t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLines_defaultBead_color",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.defaultBead.color=e,t.draftState.appData.lines[a].beadIds.forEach((function(a){t.draftState.appData.beads[a].color=e})),t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLines_defaultBead_height",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){var n=t.draftState.appData.lines[a],i=n.settings.defaultBead,s=i.width,o=i.height;if(!1===i.keepAspectRatio)n.settings.defaultBead.height=e,t.draftState.appData.lines[a].beadIds.forEach((function(a){t.draftState.appData.beads[a].height=e})),t.updateBeadsPositions(a);else{if(s&&o){if(e>=1)s=e*(s/o),o=e;n.settings.defaultBead.width=s,n.settings.defaultBead.height=o}t.draftState.appData.lines[a].beadIds.forEach((function(e){s&&o&&(t.draftState.appData.beads[e].width=s,t.draftState.appData.beads[e].height=o)})),t.updateBeadsPositions(a)}})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLines_defaultBead_width",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){var n=t.draftState.appData.lines[a],i=n.settings.defaultBead,s=i.width,o=i.height;if(!1===i.keepAspectRatio)n.settings.defaultBead.width=e,t.draftState.appData.lines[a].beadIds.forEach((function(a){t.draftState.appData.beads[a].width=e})),t.updateBeadsPositions(a);else{if(s&&o){if(e>=1){var r=o/s;s=e,o=e*r}n.settings.defaultBead.width=s,n.settings.defaultBead.height=o}t.draftState.appData.lines[a].beadIds.forEach((function(e){s&&o&&(t.draftState.appData.beads[e].width=s,t.draftState.appData.beads[e].height=o)})),t.updateBeadsPositions(a)}})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLines_defaultBead_keepAspectRatio",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.defaultBead.keepAspectRatio=e,t.draftState.appData.lines[a].beadIds.forEach((function(a){t.draftState.appData.beads[a].keepAspectRatio=e})),t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedLines_defaultBead_rotate",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedLinesIds).forEach((function(a){t.draftState.appData.lines[a].settings.defaultBead.rotate=e,t.draftState.appData.lines[a].beadIds.forEach((function(a){t.draftState.appData.beads[a].rotate=e})),t.updateBeadsPositions(a)})),this.editorAppDataHasChanged()}},{key:"action_changeSelectedBeads_type",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedBeadsIds).forEach((function(a){t.draftState.appData.beads[a].type=e})),this.updateLineFromSelectedBeads()}},{key:"action_changeSelectedBeads_color",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedBeadsIds).forEach((function(a){t.draftState.appData.beads[a].color=e})),z().emit("action_changeSelectedBeads_color",{beadIds:Object.keys(this.draftState.ui.selectedBeadsIds),color:e},this.state),this.updateLineFromSelectedBeads()}},{key:"action_changeSelectedBeads_height",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedBeadsIds).forEach((function(a){var n=t.draftState.appData.beads[a],i=n.width,s=n.height;if(!1===n.keepAspectRatio)t.draftState.appData.beads[a].height=e;else{if(i&&s)if(e>=1)i=e*(i/s),s=e;t.draftState.appData.beads[a].width=i,t.draftState.appData.beads[a].height=s}})),this.updateLineFromSelectedBeads()}},{key:"action_changeSelectedBeads_width",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedBeadsIds).forEach((function(a){var n=t.draftState.appData.beads[a],i=n.width,s=n.height;if(!1===n.keepAspectRatio)t.draftState.appData.beads[a].width=e;else{if(i&&s&&e>=1){var o=s/i;i=e,s=e*o}t.draftState.appData.beads[a].width=i,t.draftState.appData.beads[a].height=s}})),this.updateLineFromSelectedBeads()}},{key:"action_changeSelectedBeads_keepAspectRatio",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedBeadsIds).forEach((function(a){t.draftState.appData.beads[a].keepAspectRatio=e})),this.updateLineFromSelectedBeads()}},{key:"action_changeSelectedBeads_rotate",value:function(e){var t=this;Object.keys(this.draftState.ui.selectedBeadsIds).forEach((function(a){t.draftState.appData.beads[a].rotate=e})),this.updateLineFromSelectedBeads()}},{key:"updateLineFromSelectedBeads",value:function(){var e=this,t=[];Object.keys(this.draftState.ui.selectedBeadsIds).forEach((function(a){for(var n=0,i=Object.keys(e.draftState.appData.lines);n<i.length;n++){var s=i[n];if(-1!==e.draftState.appData.lines[s].beadIds.indexOf(a)&&-1===t.indexOf(s)){t.push(s);break}}}));for(var a=0,n=t;a<n.length;a++){var i=n[a];this.updateBeadsPositions(i)}}},{key:"action_updateBrushSize",value:function(e){this.draftState.ui.brush.size=e}},{key:"action_updateBrushColor",value:function(e){this.draftState.ui.brush.color=e}},{key:"action_updateBeadsTemplate",value:function(e,t){if(void 0!==this.draftState.ui.beadsTemplate[e]){var a=this.draftState.ui.beadsTemplate,n=a.keepAspectRatio,i=a.width,s=a.height;if(!0===n){if("width"===e){if(t>=1)s=t*(s/i);this.draftState.ui.beadsTemplate.height=s}if("height"===e){if(t>=1)i=t*(i/s);this.draftState.ui.beadsTemplate.width=i}}this.draftState.ui.beadsTemplate[e]=t}else console.warn("action_updateBeadsTemplate: key dont exists ".concat(e))}}]),t}(H),q=function(e){function t(){return Object(_.a)(this,t),Object(j.a)(this,Object(I.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(O.a)(t,[{key:"action_toggleMenuFile",value:function(){this.draftState.ui.currentMenuMainOpen===s.File?this.draftState.ui.currentMenuMainOpen=s.None:this.draftState.ui.currentMenuMainOpen=s.File}},{key:"action_toggleMenuSettings",value:function(){this.draftState.ui.currentMenuMainOpen===s.Grid?this.draftState.ui.currentMenuMainOpen=s.None:this.draftState.ui.currentMenuMainOpen=s.Grid}},{key:"action_toggleMenuBackground",value:function(){this.draftState.ui.currentMenuMainOpen===s.Background?this.draftState.ui.currentMenuMainOpen=s.None:this.draftState.ui.currentMenuMainOpen=s.Background}},{key:"action_toggleGridSnapEnabled",value:function(){this.draftState.ui.grid.snapEnabled=!this.draftState.ui.grid.snapEnabled}},{key:"action_toggleGridIsVisible",value:function(){this.draftState.ui.grid.isVisible=!this.draftState.ui.grid.isVisible}},{key:"action_setGridWidth",value:function(e){this.draftState.ui.grid.width=e}},{key:"action_setGridHeight",value:function(e){this.draftState.ui.grid.height=e}},{key:"action_setGridType",value:function(e){this.draftState.ui.grid.type=e}},{key:"action_setGridHexSize",value:function(e){this.draftState.ui.grid.hexSize=e}},{key:"action_background_image_clear",value:function(){this.draftState.ui.background.image.position=x(0,0),this.draftState.ui.background.image.scale=1,this.draftState.ui.background.image.url=""}},{key:"action_background_image_upload",value:function(e){this.draftState.ui.background.image.url=e}},{key:"action_background_image_pointX",value:function(e){this.draftState.ui.background.image.position.x=e}},{key:"action_background_image_pointY",value:function(e){this.draftState.ui.background.image.position.y=e}},{key:"action_background_image_scale",value:function(e){this.draftState.ui.background.image.scale=e}},{key:"action_background_image_opacity",value:function(e){this.draftState.ui.background.image.opacity=e}}]),t}(w.ImmerReducer),Z=function(e){function t(){return Object(_.a)(this,t),Object(j.a)(this,Object(I.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(O.a)(t,[{key:"action_applyColorBrush",value:function(e,t){var a=this,n=this.draftState.ui.brush,i=n.color,s=n.type,o=n.size;if(s===r.Color){var d=x(e+o/2,t+o/2);Object.keys(this.draftState.appData.beads).forEach((function(e){var t=a.draftState.appData.beads[e];if(t.color!==i){var n=x(t.position.x+t.width/2,t.position.y+t.height/2);C(n,d)<o/2+Math.min(t.width,t.height)/2&&(a.draftState.appData.beads[e].color=i)}}))}}}]),t}(w.ImmerReducer),J=N({}),K={appData:{beads:{},lines:{}},ui:{lineSettings:{settings:{beadsAutoCount:!0,beadsAutoSpacing:!0,beadsCount:0,beadsSpacing:0,defaultBead:{type:n.BasicEllipse,rotate:0,color:"#4fc3f7",height:52,width:52,keepAspectRatio:!1}}},saveInfo:{saved:!1,haveUnsavedChanges:!1},selectedLinesIds:{},selectedLinesIdsCount:0,selectedBeadsIds:{},selectedBeadsIdsCount:0,mouseSelection:{start:x(0,0),end:x(0,0),isDragStarted:!1,isDragged:!1},currentMenuMainOpen:s.None,grid:{type:o.Hex,hexSize:30,snapEnabled:!0,isVisible:!0,width:30,height:30},brush:{type:r.Color,size:50,color:"#4fc3f7"},background:{image:{url:"",scale:1,position:x(0,0),opacity:.5}},beadsTemplate:{color:J.color,width:J.width,height:J.height,keepAspectRatio:J.keepAspectRatio,rotate:J.rotate,type:J.type},currentBeadChain:{isDragEnabled:!1,beadIds:[]},sceneWrapperWidth:0,sceneWrapperHeight:0,sceneWrapperPosition:{x:0,y:0,angle:0,scale:0,top:0,left:0}},mode:i.Idle},Q={Main:Object(w.createActionCreators)(Y),Draggable:Object(w.createActionCreators)(V),Persist:Object(w.createActionCreators)(W),ChangeEditorMode:Object(w.createActionCreators)(G),MouseSelection:Object(w.createActionCreators)(X),Toolbar:Object(w.createActionCreators)(U),Topbar:Object(w.createActionCreators)(q),Paint:Object(w.createActionCreators)(Z)},$=z(),ee=Object(p.produce)((function(e,t){$.emit(t.type,t.payload,e)}),{}),te=Object(w.composeReducers)(Object(w.createReducerFunction)(Y,K),Object(w.createReducerFunction)(V,K),Object(w.createReducerFunction)(W,K),Object(w.createReducerFunction)(U,K),Object(w.createReducerFunction)(q,K),Object(w.createReducerFunction)(G,K),Object(w.createReducerFunction)(X,K),Object(w.createReducerFunction)(Z,K),ee),ae=function(e){var t=e.editorMode,a=Object(S.b)(),n=function(e){a(Q.ChangeEditorMode.action_onChangeEditorMode(e))};return c.a.createElement("div",{className:""},c.a.createElement(ne,{label:"Idle",icon:c.a.createElement(v.a,{icon:b.a,color:"#aeaeae"}),onClick:function(){return n(i.Idle)},isSelected:t===i.Idle}),c.a.createElement(ne,{label:"Edit",icon:c.a.createElement(v.a,{icon:b.g,color:"#aeaeae"}),onClick:function(){return n(i.EditBeads)},isSelected:t===i.EditBeads}),c.a.createElement(ne,{label:"Add",icon:c.a.createElement(v.a,{icon:b.m,color:"#aeaeae"}),onClick:function(){return n(i.AddBeads)},isSelected:t===i.AddBeads}),c.a.createElement(ne,{label:"Paint",icon:c.a.createElement(v.a,{icon:b.m,color:"#aeaeae"}),onClick:function(){return n(i.PaintBeads)},isSelected:t===i.PaintBeads}),c.a.createElement(ne,{label:"Delete",icon:c.a.createElement(v.a,{icon:b.m,color:"#aeaeae"}),onClick:function(){return n(i.DeleteBeads)},isSelected:t===i.DeleteBeads}))},ne=function(e){var t=e.label,a=e.isSelected,n=e.onClick,i=e.icon;return c.a.createElement("div",{className:"\n              button \n              ".concat(a?"is-active":"","\n            "),onClick:n},c.a.createElement("span",{className:"icon is-small"},i),c.a.createElement("span",null,t))},ie=function(e){var t=e.bead,a=e.opacity,i=e.zIndex,s=e.isSelected,o=e.isSelectable,r=void 0!==a&&a>=0&&a<=1,d=void 0!==i&&i>=0&&i<=9999,l=Object(S.b)(),u=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return"translate3d(".concat(e,"px, ").concat(t,"px, ").concat(a,"px)")}(t.position.x,t.position.y),h=t.rotate+t.lineRotate,p=h?"rotateZ(".concat(h,"deg)"):"rotateZ(0deg)",f={transform:"".concat(u," ").concat(p),opacity:r?a:1,zIndex:d?i:void 0,border:s?"1px solid #000":"",width:"".concat(t.width,"px"),height:"".concat(t.height,"px"),background:t.color};return t.type===n.BasicEllipse&&(f.borderRadius="100%"),c.a.createElement("div",{className:"bead-item",onClick:function(){o&&l(Q.Draggable.action_onClickBead(t.id))},style:f},"\xa0")},se=function(e){var t=e.bead,a=N(Object(h.a)({},t,{position:x(0,0)}));return c.a.createElement("div",{style:{marginTop:"20px",marginBottom:"20px",display:"flex",justifyContent:"center",alignItems:"center",height:"100px",boxSizing:"border-box"}},c.a.createElement("div",{style:{position:"relative",top:"".concat(-1*t.height/2,"px"),left:"".concat(-1*t.width/2,"px")}},c.a.createElement(ie,{bead:a,isSelected:!1,isSelectable:!1})))},oe=a(99),re=function(e){var t=e.label,a=e.icon,n=e.value,i=e.onToggle;return c.a.createElement("div",{className:"fieldset",onClick:i,style:{cursor:"pointer"}},c.a.createElement("div",{className:"label"},a?c.a.createElement("div",{style:{width:"30px",display:"flex",justifyContent:"center",alignItems:"center",height:"30px",marginRight:"10px"}},a):null,t?c.a.createElement("div",null,t):null),c.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center",boxSizing:"border-box",paddingLeft:"10px",paddingRight:"20px",width:"100%"}},c.a.createElement("div",null,void 0!==n?n:"-")))},de=function(e){var t=e.selected,a=e.label,n=e.icon,i=e.children,s=Object(d.useState)(!1),o=Object(oe.a)(s,2),r=o[0],l=o[1];return c.a.createElement("div",{style:{borderTop:"1px solid #dfdfdf"}},c.a.createElement(re,{label:a,onToggle:function(){l(!r)},icon:n,value:t}),!0===r?c.a.createElement("div",{style:{background:"#fff"}},c.a.cloneElement(i)):null)},ce=a(56),le=a(2),ue=function(e){e.value;var t=e.onChange,a=(Object(ce.a)(e,["value","onChange"]),[[le.p[900],le.p[700],le.p[500],le.p[300],le.p[100]],[le.n[900],le.n[700],le.n[500],le.n[300],le.n[100]],[le.o[900],le.o[700],le.o[500],le.o[300],le.o[100]],[le.g[900],le.g[700],le.g[500],le.g[300],le.g[100]],[le.i[900],le.i[700],le.i[500],le.i[300],le.i[100]],[le.b[900],le.b[700],le.b[500],le.b[300],le.b[100]],[le.j[900],le.j[700],le.j[500],le.j[300],le.j[100]],[le.e[900],le.e[700],le.e[500],le.e[300],le.e[100]],[le.q[900],le.q[700],le.q[500],le.q[300],le.q[100]],["#194D33",le.h[700],le.h[500],le.h[300],le.h[100]],[le.k[900],le.k[700],le.k[500],le.k[300],le.k[100]],[le.l[900],le.l[700],le.l[500],le.l[300],le.l[100]],[le.r[900],le.r[700],le.r[500],le.r[300],le.r[100]],[le.a[900],le.a[700],le.a[500],le.a[300],le.a[100]],[le.m[900],le.m[700],le.m[500],le.m[300],le.m[100]],[le.f[900],le.f[700],le.f[500],le.f[300],le.f[100]],[le.d[900],le.d[700],le.d[500],le.d[300],le.d[100]],[le.c[900],le.c[700],le.c[500],le.c[300],le.c[100]],["#000000","#525252","#969696","#D9D9D9","#FFFFFF"]]);return c.a.createElement("div",{style:{width:"100%",paddingTop:"20px",paddingBottom:"30px",paddingLeft:"20px",paddingRight:"20px"}},c.a.createElement(he,{colors:a,onClick:t}))},he=function(e){var t=e.colors,a=e.onClick;return c.a.createElement("div",null,c.a.createElement("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",flexWrap:"wrap"}},t.map((function(e){return c.a.createElement("div",{key:e.toString(),style:{marginBottom:"10px"}},e.map((function(e){return c.a.createElement("div",{key:e,style:{cursor:"pointer",border:"3px solid transparent",boxSizing:"border-box"}},c.a.createElement("div",{onClick:function(){return a(e)},style:{boxSizing:"border-box",background:e,width:"28px",height:"28px",borderRadius:"100%",border:"none"}}))})))}))))},pe=function(e){var t=e.value,a=e.isSelected,n=e.onClick;return c.a.createElement("div",{style:{border:"5px solid transparent"}},c.a.createElement("div",{onClick:n?function(){return n(t)}:void 0,style:{width:25,height:25,background:t,marginBottom:0,marginRight:0,border:"2px solid #000",boxShadow:a?"2px 2px 2px rgba(0,0,0,1)":"2px 2px 2px rgba(0,0,0,0.1)"}}))},fe=function(e){var t=e.value,a=e.onChange;return c.a.createElement(de,{selected:c.a.createElement(pe,{value:t,isSelected:!1,onClick:void 0}),label:"Color",icon:c.a.createElement(v.a,{icon:b.n,color:"#aeaeae",size:"lg"})},c.a.createElement(ue,{value:t,onChange:a}))},ge=(g={},Object(y.a)(g,n.BasicEllipse,"circle"),Object(y.a)(g,n.BasicRectangle,"rectangle-wide"),g),me=function(e){var t=e.value,a=e.onChange;return c.a.createElement(ve,{types:ge,selectedType:t,onClick:a})},ve=function(e){var t=e.types,a=e.selectedType,n=e.onClick;return c.a.createElement("div",{className:"fieldset",style:{}},c.a.createElement("div",{className:"label"}),c.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",boxSizing:"border-box",paddingLeft:"10px",paddingRight:"20px",width:"100%"}},Object.keys(t).map((function(e,i){return c.a.createElement(be,{icon:t[e],type:e,key:i,isSelected:a===e,onClick:n})}))))},be=function(e){var t=e.icon,a=e.type,n=e.isSelected,i=e.onClick;return c.a.createElement("div",{style:{border:"5px solid transparent"}},c.a.createElement("div",{onClick:i?function(){return i(a)}:void 0,style:{width:25,height:25,background:"#eee",marginBottom:0,marginRight:0,border:"2px solid #000",boxShadow:n?"2px 2px 2px rgba(0,0,0,1)":"2px 2px 2px rgba(0,0,0,0.1)",display:"flex",justifyContent:"center",alignItems:"center"}},"circle"===t?c.a.createElement(v.a,{icon:b.d}):null,"rectangle-wide"===t?c.a.createElement(v.a,{icon:b.h}):null))},Se=function(e){var t=e.value,a=e.onChange;return c.a.createElement(de,{selected:c.a.createElement(be,{icon:t?ge[t]:void 0,type:t,isSelected:!1,onClick:void 0}),label:"Type",icon:c.a.createElement(v.a,{icon:b.p,color:"#aeaeae",size:"lg"})},c.a.createElement(me,{value:t,onChange:a}))},ye=(a(78),a(43)),xe=Object(ye.a)(ye.b),Ee=function(e){var t=e.value,a=e.onChange,n=e.label,i=e.icon;return c.a.createElement("div",{className:"fieldset",style:{paddingTop:"10px",paddingBottom:"10px",paddingLeft:"10px",paddingRight:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",background:"#fff",borderBottom:0}},c.a.createElement("div",{className:"label",style:{padding:0,width:"105px"}},i?c.a.createElement("div",{style:{width:"30px",display:"flex",justifyContent:"center",alignItems:"center",height:"30px",marginRight:"10px"}},i):null,n?c.a.createElement("div",null,n):null),c.a.createElement("div",{style:{boxSizing:"border-box",flexGrow:1,paddingRight:"10px",paddingBottom:"10px"}},c.a.createElement(xe,{max:100,min:1,step:1,value:t,onChange:function(e){return a(e)},defaultValue:10,marks:{0:"0",50:"50",100:"100"}})))},ke=function(e){var t=e.label,a=e.value,n=e.onChange,i=e.isDisabled;return c.a.createElement("div",{className:"fieldset"},c.a.createElement("div",{className:"label"},t),c.a.createElement("input",{type:"checkbox",disabled:i,value:!0===a?1:0,checked:!0===a,onChange:function(e){return n("0"===e.target.value)}}))},Be=function(e){var t=e.height,a=e.width,n=e.keepAspectRatio,i=e.onChange_beadHeight,s=e.onChange_beadWidth,o=e.onChange_keepAspectRatio,r=function(e){return e.toLocaleString(void 0,{maximumFractionDigits:2,style:"decimal"})},d="".concat(r(a)," x ").concat(r(t));return c.a.createElement("div",null,c.a.createElement(de,{selected:d,label:"Size",icon:c.a.createElement(v.a,{icon:b.i,color:"#aeaeae",size:"lg"})},c.a.createElement("div",null,c.a.createElement("div",{style:{width:"100%",background:"#fff"}},c.a.createElement(ke,{label:c.a.createElement("div",{style:{display:"flex",flexWrap:"nowrap",justifyContent:"space"}},c.a.createElement("div",{style:{width:"30px",display:"flex",justifyContent:"center",alignItems:"center",height:"30px",marginRight:"10px",background:"#fff"}},c.a.createElement(v.a,{icon:!0===n?b.l:b.s,color:"#aeaeae",size:"lg"})),c.a.createElement("div",null,"Keep aspect ratio")),value:n,onChange:o,isDisabled:!1})),c.a.createElement(Ee,{label:"Width",icon:c.a.createElement(v.a,{icon:b.b,color:"#aeaeae",size:"lg"}),value:a,onChange:s}),c.a.createElement(Ee,{label:"Height",icon:c.a.createElement(v.a,{icon:b.c,color:"#aeaeae",size:"lg"}),value:t,onChange:i}))))},Ce=Object(ye.a)(ye.b),De=function(e){var t=e.value,a=e.onChange,n=Object(ce.a)(e,["value","onChange"]);return c.a.createElement("div",{style:{background:"#fff",width:"100%",paddingTop:"20px",paddingBottom:"30px",paddingLeft:"20px",paddingRight:"20px"}},c.a.createElement(Ce,Object.assign({max:100,min:1,step:1,value:t,onChange:function(e){return a(e)},defaultValue:10,marks:{0:"0",50:"50",100:"100"}},n)))},we=a(33),_e=function(e){var t=e.value,a=e.onChange;return c.a.createElement(de,{selected:"".concat(t,"deg"),label:"Rotate",icon:c.a.createElement(v.a,{icon:b.q,color:"#aeaeae",size:"lg"})},c.a.createElement(c.a.Fragment,null,c.a.createElement(De,{value:t,onChange:function(e){a(e)},max:180,min:-180,defaultValue:0,marks:{"-180":"-180",0:"0",180:"180"}}),c.a.createElement(we.a,{suffix:"deg",allowNegative:!0,allowEmptyFormatting:!0,value:t,onValueChange:function(e){a(e.floatValue)},placeholder:" deg",style:{color:"#4a4a4a",textAlign:"center",border:"1px solid #aeaeae",fontFamily:"Open Sans, sans-serif",fontSize:"1em",fontWeight:400,lineHeight:"1.5",padding:"3px 10px",marginBottom:"15px",marginTop:"5px"}})))},Oe=function(e){return!0===e.isVisible?c.a.createElement(je,null):c.a.createElement(c.a.Fragment,null)},je=function(){return Object(S.c)((function(e){return e.ui.selectedBeadsIdsCount>=1}))?c.a.createElement(Ie,null):c.a.createElement(c.a.Fragment,null)},Ie=function(){return c.a.createElement(c.a.Fragment,null,c.a.createElement(Ne,null),c.a.createElement(Le,null),c.a.createElement(Re,null),c.a.createElement(Ae,null),c.a.createElement(Me,null))},Me=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){var t=Object.keys(e.ui.selectedBeadsIds)[0];return e.appData.beads[t]}));if(!t)return c.a.createElement(c.a.Fragment,null);return c.a.createElement(_e,{value:t.rotate,onChange:function(t){var a=t;void 0!==t&&null!==t&&!0!==isNaN(t)||(a=0),e(Q.Toolbar.action_changeSelectedBeads_rotate(a))}})},Le=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){var t=Object.keys(e.ui.selectedBeadsIds)[0];return e.appData.beads[t]}));if(!t)return c.a.createElement(c.a.Fragment,null);var a=t.width?t.width:10,n=t.height?t.height:10,i=!!t.keepAspectRatio&&t.keepAspectRatio;return c.a.createElement("div",null,c.a.createElement(Be,{height:n,width:a,keepAspectRatio:i,onChange_beadHeight:function(t){e(Q.Toolbar.action_changeSelectedBeads_height(t))},onChange_beadWidth:function(t){e(Q.Toolbar.action_changeSelectedBeads_width(t))},onChange_keepAspectRatio:function(t){e(Q.Toolbar.action_changeSelectedBeads_keepAspectRatio(t))}}))},Ae=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){var t=Object.keys(e.ui.selectedBeadsIds)[0];return e.appData.beads[t]}));if(!t)return c.a.createElement(c.a.Fragment,null);if(!t.type)return c.a.createElement(c.a.Fragment,null);return c.a.createElement(Se,{onChange:function(t){e(Q.Toolbar.action_changeSelectedBeads_type(t))},value:t.type})},Re=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){var t=Object.keys(e.ui.selectedBeadsIds)[0];return e.appData.beads[t]}));if(!t)return c.a.createElement(c.a.Fragment,null);if(!t.color)return c.a.createElement(c.a.Fragment,null);return c.a.createElement(fe,{onChange:function(t){e(Q.Toolbar.action_changeSelectedBeads_color(t))},value:t.color})},Ne=function(){var e=Object(S.c)((function(e){var t=Object.keys(e.ui.selectedBeadsIds)[0];return e.appData.beads[t]}));return e?c.a.createElement(se,{bead:e}):c.a.createElement(c.a.Fragment,null)},Te=function(e){return!0===e.isVisible?c.a.createElement(Fe,null):c.a.createElement(c.a.Fragment,null)},Fe=function(){var e=Object(S.c)((function(e){return Object.keys(e.appData.lines).length})),t=Object(S.c)((function(e){return Object.keys(e.appData.beads).length}));return c.a.createElement("div",null,c.a.createElement(re,{label:"Beads",onToggle:void 0,value:t,icon:void 0}),c.a.createElement(re,{label:"Lines",onToggle:void 0,value:e,icon:void 0}))},He=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.currentMenuMainOpen}));return c.a.createElement("div",{className:"field has-addons",style:{margin:0,border:"1px solid #e0e0e0",paddingBottom:"0px"}},c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:"button is-light ".concat(t===s.File?"is-dark":""),onClick:function(){e(Q.Topbar.action_toggleMenuFile())},style:{height:"25px",padding:"3px 10px"}},c.a.createElement("span",{className:"icon is-small"},c.a.createElement(v.a,{icon:b.j,color:"#aeaeae"})),c.a.createElement("span",null,"File"))),c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:"button is-light ".concat(t===s.Grid?"is-dark":""),onClick:function(){e(Q.Topbar.action_toggleMenuSettings())},style:{height:"25px",padding:"3px 10px"}},c.a.createElement("span",{className:"icon is-small"},c.a.createElement(v.a,{icon:b.e,color:"#aeaeae"})),c.a.createElement("span",null,"Grid"))),c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:"button is-light ".concat(t===s.Background?"is-dark":""),onClick:function(){e(Q.Topbar.action_toggleMenuBackground())},style:{height:"25px",padding:"3px 10px"}},c.a.createElement("span",{className:"icon is-small"},c.a.createElement(v.a,{icon:b.k,color:"#aeaeae"})),c.a.createElement("span",null,"Background"))))},Pe=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.saveInfo.saved})),a=Object(S.c)((function(e){return e.ui.saveInfo.haveUnsavedChanges}));return c.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},c.a.createElement("div",{className:"field has-addons",style:{width:"auto",flexWrap:"nowrap",marginBottom:"0"}},c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:" button is-light ",onClick:function(){e(Q.Persist.action_onClearCanvas())}},c.a.createElement("span",{className:"icon is-small"},c.a.createElement(v.a,{icon:b.r,color:"#aeaeae"})),c.a.createElement("span",null,"New project"))),c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:" button is-light ".concat(!0===t?"is-success":""),onClick:function(){e(Q.Persist.action_onSaveCanvas())}},c.a.createElement("span",{className:"icon is-small"},c.a.createElement(v.a,{icon:b.o,color:"#aeaeae"})),c.a.createElement("span",null,"Save"))),c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:"button is-light ",onClick:function(){e(Q.Persist.action_readSavedCanvas())}},c.a.createElement("span",{className:"icon is-small"},c.a.createElement(v.a,{icon:b.f,color:"#aeaeae"})),c.a.createElement("span",null,"Load local")))),c.a.createElement("div",{style:{fontFamily:"Open Sans, sans-serif",fontSize:"13px",alignSelf:"center"}},!0===a?c.a.createElement("div",null,"You have unsaved changes"):c.a.createElement("div",null,"No changes to save")))},ze=function(){var e=Object(S.c)((function(e){return e.ui.currentMenuMainOpen}));return e===s.File?c.a.createElement(Ve,null):e===s.Grid?c.a.createElement(Ye,null):e===s.Background?c.a.createElement(We,null):c.a.createElement(c.a.Fragment,null)},Ve=function(){return c.a.createElement("div",null,c.a.createElement(Pe,null))},We=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.background.image})),a=t.position,n=t.scale,i=t.opacity;return c.a.createElement("div",{style:{flexWrap:"nowrap",display:"flex",alignItems:"flex-start"}},c.a.createElement("div",{style:{flexWrap:"nowrap",display:"flex",marginTop:"4px"}},c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:" button is-light ",onClick:function(){e(Q.Topbar.action_background_image_clear())}},c.a.createElement("span",null,"Clear"))),c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:" button is-light ",style:{position:"relative"}},c.a.createElement("input",{type:"file",onChange:function(t){var a=t.target.files,n=Array.from(a);if(0!==n.length){var i=n[0];if(["image/png","image/jpeg","image/gif"].every((function(e){return i.type!==e})))console.error("'".concat(i.type,"' is not a supported format"));else if(i.size>1048576)console.error("'".concat(i.name,"' is too large, please pick a smaller file"));else{var s=new FileReader;s.onloadend=function(){e(Q.Topbar.action_background_image_upload(s.result))},s.readAsDataURL(i),t.preventDefault()}}else console.error("no files selected")},style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,zIndex:2}}),c.a.createElement("span",null,"Upload")))),c.a.createElement("div",{style:{display:"flex",marginLeft:"10px",marginRight:"10px",flexWrap:"nowrap",alignItems:"flex-start"}},c.a.createElement("div",{className:"fieldset",style:{width:"100px",whiteSpace:"nowrap",flexWrap:"nowrap",display:"flex",alignItems:"flex-start"}},c.a.createElement("div",{className:"label",style:{whiteSpace:"nowrap"}},"Scale: ".concat(n))),c.a.createElement("div",{style:{width:"100px",marginLeft:"20px",marginTop:"13px"}},c.a.createElement(Ce,{max:16,min:.2,step:.1,value:n,onChange:function(t){return function(t){e(Q.Topbar.action_background_image_scale(t))}(t)},defaultValue:1}))),c.a.createElement(Ge,{pointX:a.x,onChange_pointX:function(t){e(Q.Topbar.action_background_image_pointX(t))},pointY:a.y,onChange_pointY:function(t){e(Q.Topbar.action_background_image_pointY(t))}}),c.a.createElement("div",{style:{display:"flex",marginLeft:"10px",marginRight:"10px",flexWrap:"nowrap",alignItems:"flex-start"}},c.a.createElement("div",{className:"fieldset",style:{width:"85px"}},c.a.createElement("div",{className:"label",style:{flexWrap:"nowrap",whiteSpace:"nowrap"}},"Opacity: ",i)),c.a.createElement("div",{style:{width:"80px",marginLeft:"10px",marginTop:"13px"}},c.a.createElement(Ce,{max:1,min:0,step:.1,value:i,onChange:function(t){return function(t){e(Q.Topbar.action_background_image_opacity(t))}(t)},defaultValue:1}))))},Ge=function(e){var t=e.pointX,a=e.onChange_pointX,n=e.pointY,i=e.onChange_pointY;return c.a.createElement("div",{style:{display:"flex",flexWrap:"nowrap",alignItems:"center",marginRight:"15px"}},c.a.createElement("div",{className:"fieldset"},c.a.createElement("div",{className:"label"},"Image position: "),c.a.createElement(we.a,{allowNegative:!1,allowEmptyFormatting:!0,max:999,min:-999,maxLength:3,value:t,onValueChange:function(e){a(e.floatValue)},placeholder:"x",style:{color:"#4a4a4a",textAlign:"center",border:"1px solid #aeaeae",fontFamily:"Open Sans, sans-serif",fontSize:"13px",fontWeight:400,lineHeight:"1.5",padding:"0px 10px",marginBottom:"0px",marginTop:"0px",maxWidth:"70px",marginRight:"5px"}}),c.a.createElement(we.a,{allowNegative:!1,allowEmptyFormatting:!0,max:999,min:-999,maxLength:3,value:n,onValueChange:function(e){i(e.floatValue)},placeholder:"y",style:{color:"#4a4a4a",textAlign:"center",border:"1px solid #aeaeae",fontFamily:"Open Sans, sans-serif",fontSize:"13px",fontWeight:400,lineHeight:"1.5",padding:"0px 10px",marginBottom:"0px",marginTop:"0px",maxWidth:"70px"}})))},Ye=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.grid})),a=t.height,n=t.width,i=t.hexSize,s=t.type,r=t.snapEnabled,d=t.isVisible;return c.a.createElement("div",{style:{display:"flex",flexWrap:"nowrap",alignItems:"center"}},c.a.createElement(Xe,{isVisible:d,onChange_isVisible:function(){e(Q.Topbar.action_toggleGridIsVisible())},snapEnabled:r,onChange_snapEnabled:function(){e(Q.Topbar.action_toggleGridSnapEnabled())},type:s,onClick_selectTypeHex:function(){e(Q.Topbar.action_setGridType(o.Hex))},onClick_selectTypeBox:function(){e(Q.Topbar.action_setGridType(o.Box))}}),s===o.Box?c.a.createElement(Ue,{gridItemW:n,onChange_gridItemW:function(t){var a=t;void 0!==t&&null!==t&&!0!==isNaN(t)?(a<1&&(a=1),a>100&&(a=100),e(Q.Topbar.action_setGridWidth(a))):a=1},gridItemH:a,onChange_gridItemH:function(t){var a=t;void 0!==t&&null!==t&&!0!==isNaN(t)?(a<1&&(a=1),a>100&&(a=100),e(Q.Topbar.action_setGridHeight(a))):a=1}}):null,s===o.Hex?c.a.createElement(qe,{hexSize:i,onChange_hexSize:function(t){var a=t;void 0!==t&&null!==t&&!0!==isNaN(t)?(a<1&&(a=1),a>100&&(a=100),e(Q.Topbar.action_setGridHexSize(a))):a=1}}):null)},Xe=function(e){var t=e.isVisible,a=e.onChange_isVisible,n=e.snapEnabled,i=e.onChange_snapEnabled,s=e.type,r=e.onClick_selectTypeHex,d=e.onClick_selectTypeBox;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{style:{marginRight:"15px"}},c.a.createElement(ke,{label:"Show grid",value:t,onChange:a,isDisabled:!1})),c.a.createElement("div",{style:{marginRight:"15px"}},c.a.createElement(ke,{label:"Snap to grid",value:n,onChange:i,isDisabled:!1})),c.a.createElement("div",{style:{marginRight:"15px"}},c.a.createElement("div",{className:"fieldset"},c.a.createElement("div",{className:"label"},"Grid type: "),c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:" button is-light ".concat(s===o.Hex?"is-dark":""," "),onClick:r},c.a.createElement("span",null,"Hexagon"))),c.a.createElement("div",{className:"control"},c.a.createElement("div",{className:" button is-light ".concat(s===o.Box?"is-dark":""),onClick:d},c.a.createElement("span",null,"Rectangle"))))))},Ue=function(e){var t=e.gridItemW,a=e.onChange_gridItemW,n=e.gridItemH,i=e.onChange_gridItemH;return c.a.createElement("div",{style:{display:"flex",flexWrap:"nowrap",alignItems:"center",marginRight:"15px"}},c.a.createElement("div",{className:"fieldset"},c.a.createElement("div",{className:"label"},"Grid size: "),c.a.createElement(we.a,{allowNegative:!1,allowEmptyFormatting:!0,max:99,min:1,maxLength:2,value:t,onValueChange:function(e){a(e.floatValue)},placeholder:"width",style:{color:"#4a4a4a",textAlign:"center",border:"1px solid #aeaeae",fontFamily:"Open Sans, sans-serif",fontSize:"13px",fontWeight:400,lineHeight:"1.5",padding:"0px 10px",marginBottom:"0px",marginTop:"0px",maxWidth:"70px",marginRight:"5px"}}),c.a.createElement(we.a,{allowNegative:!1,allowEmptyFormatting:!0,max:99,min:1,maxLength:2,value:n,onValueChange:function(e){i(e.floatValue)},placeholder:"height",style:{color:"#4a4a4a",textAlign:"center",border:"1px solid #aeaeae",fontFamily:"Open Sans, sans-serif",fontSize:"13px",fontWeight:400,lineHeight:"1.5",padding:"0px 10px",marginBottom:"0px",marginTop:"0px",maxWidth:"70px"}})))},qe=function(e){var t=e.hexSize,a=e.onChange_hexSize;return c.a.createElement("div",{style:{display:"flex",flexWrap:"nowrap",alignItems:"center",marginRight:"15px"}},c.a.createElement("div",{className:"fieldset"},c.a.createElement("div",{className:"label"},"Hex size: "),c.a.createElement(we.a,{allowNegative:!1,allowEmptyFormatting:!0,max:99,min:5,maxLength:2,value:t,onValueChange:function(e){a(e.floatValue)},placeholder:"width",style:{color:"#4a4a4a",textAlign:"center",border:"1px solid #aeaeae",fontFamily:"Open Sans, sans-serif",fontSize:"13px",fontWeight:400,lineHeight:"1.5",padding:"0px 10px",marginBottom:"0px",marginTop:"0px",maxWidth:"70px",marginRight:"5px"}})))},Ze=function(e){var t=e.value,a=e.onChange;return c.a.createElement(de,{selected:t,label:"Size",icon:c.a.createElement(v.a,{icon:b.a,color:"#aeaeae",size:"lg"})},c.a.createElement(De,{value:t,onChange:a}))},Je=function(e){return!0===e.isVisible?c.a.createElement(Ke,null):c.a.createElement(c.a.Fragment,null)},Ke=function(){return c.a.createElement(c.a.Fragment,null,c.a.createElement(Qe,null),c.a.createElement($e,null))},Qe=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.brush.size}));if(!t)return c.a.createElement(c.a.Fragment,null);return c.a.createElement(Ze,{value:t,onChange:function(t){var a=t;void 0!==t&&null!==t&&!0!==isNaN(t)||(a=0),e(Q.Toolbar.action_updateBrushSize(a))}})},$e=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.brush.color}));if(!t)return c.a.createElement(c.a.Fragment,null);return c.a.createElement(fe,{onChange:function(t){e(Q.Toolbar.action_updateBrushColor(t))},value:t})},et=function(e){return!0===e.isVisible?c.a.createElement(tt,null):c.a.createElement(c.a.Fragment,null)},tt=function(){return c.a.createElement(c.a.Fragment,null,c.a.createElement(ot,null),c.a.createElement(nt,null),c.a.createElement(st,null),c.a.createElement(it,null),c.a.createElement(at,null))},at=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.beadsTemplate}));return c.a.createElement(_e,{value:t.rotate,onChange:function(t){var a=t;void 0!==t&&null!==t&&!0!==isNaN(t)||(a=0),e(Q.Toolbar.action_updateBeadsTemplate("rotate",a))}})},nt=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.beadsTemplate})),a=t.width?t.width:10,n=t.height?t.height:10,i=!!t.keepAspectRatio&&t.keepAspectRatio;return c.a.createElement("div",null,c.a.createElement(Be,{height:n,width:a,keepAspectRatio:i,onChange_beadHeight:function(t){e(Q.Toolbar.action_updateBeadsTemplate("height",t))},onChange_beadWidth:function(t){e(Q.Toolbar.action_updateBeadsTemplate("width",t))},onChange_keepAspectRatio:function(t){e(Q.Toolbar.action_updateBeadsTemplate("keepAspectRatio",t))}}))},it=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.beadsTemplate}));return c.a.createElement(Se,{onChange:function(t){e(Q.Toolbar.action_updateBeadsTemplate("type",t))},value:t.type})},st=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.ui.beadsTemplate}));return c.a.createElement(fe,{onChange:function(t){e(Q.Toolbar.action_updateBeadsTemplate("color",t))},value:t.color})},ot=function(){var e=Object(S.c)((function(e){return e.ui.beadsTemplate})),t=N(e);return c.a.createElement(se,{bead:t})},rt=a(98),dt=function(){var e=Object(S.b)(),t=Object(S.c)((function(e){return e.mode})),a=Object(S.d)().getState();console.log("EditorRerender: ",a);Object(d.useRef)(null);if(!a)return c.a.createElement("div",null,"Error in app");return c.a.createElement("div",{className:"scene"},c.a.createElement("div",{className:"topbar-wrapper"},c.a.createElement(He,null),c.a.createElement(ze,null)),c.a.createElement("div",{className:"actions-wrapper"},c.a.createElement(ae,{editorMode:t})),c.a.createElement("div",{className:"scene-wrapper"},c.a.createElement(rt.a,{handleWidth:!0,handleHeight:!0,skipOnMount:!1,onResize:function(t,a){e(Q.Draggable.action_updateSceneWrapperSize({width:t,height:a}))}})),c.a.createElement("div",{className:"toolbar-wrapper"},c.a.createElement(Oe,{isVisible:t===i.EditBeads}),c.a.createElement(Te,{isVisible:t===i.Idle}),c.a.createElement(Je,{isVisible:t===i.PaintBeads}),c.a.createElement(et,{isVisible:t===i.AddBeads})))},ct=a(53),lt=Object(ct.b)(te),ut=function(){return console.log("render App.tsx"),c.a.useEffect((function(){lt.dispatch({type:"startAppEvent",payload:{state:lt.getState()}}),lt.dispatch(Q.Persist.action_readSavedCanvas())}),[]),c.a.createElement("div",{className:"App"},c.a.createElement(S.a,{store:lt},c.a.createElement(dt,null)))},ht=a(6),pt=(a(177)(ht),function(e){var t,a,n,s=new ht.Vector2(1,1),o=((new ht.Matrix4).multiplyMatrices((new ht.Matrix4).makeRotationY(.05),(new ht.Matrix4).makeRotationZ(.03)),z()),r=new ft,d=new gt;!function(){if(null!==e){var i=e.getBoundingClientRect(),s=i.width,o=i.height;t=new ht.OrthographicCamera(s/-2,s/2,o/2,o/-2,-1e3,1e3)}t.position.set(0,0,500),t.lookAt(0,0,0),(a=new ht.Scene).background=new ht.Color("#F1F3F3");var r=new ht.DirectionalLight("#FFF",.99);r.position.set(0,0,1),a.add(r);var c=new ht.AmbientLight("#FFF",.1);c.position.set(0,0,1),a.add(c);var l=new ht.PlaneGeometry(1e3,1e3,1),h=new ht.MeshBasicMaterial({color:"#ccc",side:ht.DoubleSide}),p=new ht.Mesh(l,h);a.add(p);l=new ht.PlaneGeometry(1e3,1e3,1),h=new ht.MeshBasicMaterial({color:"#ccc",side:ht.DoubleSide}),p=new ht.Mesh(l,h);if(a.add(p),(n=new ht.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),null!==e){var f=e.getBoundingClientRect(),g=f.width,m=f.height;n.setSize(g,m),e.appendChild(n.domElement)}window.addEventListener("resize",S,!1),null!==e&&(e.addEventListener("mousedown",v,!1),e.addEventListener("mousemove",y,!1),e.addEventListener("mouseup",b,!1),e.addEventListener("wheel",u,!1));d.setRenderer(n)}(),function e(){requestAnimationFrame(e),n.render(a,t)}(),o.on("action_changeSelectedBeads_color",(function(e){e.beadIds.forEach((function(t){var n=a.getObjectByName(t);void 0!==n&&n.material.color.set(e.color)}))})),o.on("action_selectBeads",(function(e){e.diffStates.forEach((function(e){var t=Object.keys(e)[0],n=Object.values(e)[0],i=a.getObjectByName(t);void 0!==i&&(!0===n?i.material.emissive.set(8947848):i.material.emissive.set(0))}))})),o.on("action_addBeadOnClick",(function(e){var t=e.bead,n=new ht.SphereGeometry(Math.max(t.width,t.height),10,10);n.mergeVertices(),n.computeVertexNormals();var i=new ht.MeshPhysicalMaterial({flatShading:!0,reflectivity:1,color:t.color}),s=new ht.Mesh(n,i);s.applyMatrix((new ht.Matrix4).makeRotationX(90*ht.Math.DEG2RAD)),s.applyMatrix((new ht.Matrix4).makeRotationZ(ht.Math.DEG2RAD*t.rotate)),s.applyMatrix((new ht.Matrix4).makeTranslation(t.position.x,t.position.y,0)),c.push(s),s.name=t.id,a.add(s)})),o.on("action_readSavedCanvas",(function(e){})),o.on("action_readSavedCanvas",(function(e){Object.keys(e.beads).forEach((function(t){var n=e.beads[t],i=new ht.SphereGeometry(Math.max(n.width,n.height),10,10);i.mergeVertices(),i.computeVertexNormals();var s=new ht.MeshPhysicalMaterial({flatShading:!0,reflectivity:1,color:n.color}),o=new ht.Mesh(i,s);o.applyMatrix((new ht.Matrix4).makeRotationX(90*ht.Math.DEG2RAD)),o.applyMatrix((new ht.Matrix4).makeRotationZ(ht.Math.DEG2RAD*n.rotate)),o.applyMatrix((new ht.Matrix4).makeTranslation(n.position.x,n.position.y,0)),c.push(o),o.name=n.id,a.add(o)}))})),o.on("startAppEvent",(function(e){console.log("startAppEvent: ...",e.state)}));var c=[],l=1;function u(a){if(a.preventDefault(),null!==e){var n=e.getBoundingClientRect(),i=n.width,s=n.height,o=n.top,r=n.left,d=a.clientX-r,c=a.clientY-o,u=t.position.x,h=t.position.y,p=(d-i/2)*l,f=-1*(c-s/2)*l;l+=.02*Math.sign(a.deltaY);var g=(d-i/2)*(l=Math.min(Math.max(.125,l),4)),m=-1*(c-s/2)*l;t.left=i*l/-2,t.right=i*l/2,t.top=s*l/2,t.bottom=s*l/-2,t.updateProjectionMatrix();var v=p-g,b=f-m;t.position.x=u+v,t.position.y=h+b,t.lookAt(t.position.x,t.position.y,0)}}var h,p=function(a,n){if(null===e)throw new Error("no el in dom");var i=e.getBoundingClientRect(),s=i.width,o=i.height,r=n-i.top,d=(a-i.left-s/2)*l+t.position.x,c=(o/2-r)*l+t.position.y;return new ht.Vector2(d,c)},f=!1,g=new ht.Vector2,m=new ht.Vector2;function v(a){var n=(0,lt.getState)();if(n.mode===i.Idle){if(f=!0,null!==e){var s=e.getBoundingClientRect(),o=(s.width,s.height,s.top),c=s.left;h=e.getBoundingClientRect();var l=a.clientX-c,u=a.clientY-o;g.x=l,g.y=u,m.x=t.position.x,m.y=t.position.y}}else if(n.mode===i.EditBeads){null!==e&&(h=e.getBoundingClientRect());var v=p(a.clientX,a.clientY),b=v.x,S=v.y;if(r.onDown(b,S),null===e)throw new Error("no el in dom");var y=e.getBoundingClientRect(),x=(y.width,y.height,y.top),E=y.left,k=a.clientX-E,B=a.clientY-x;d.onDown(k,B)}}function b(e){var t=lt.dispatch,a=(0,lt.getState)();if(a.mode===i.AddBeads){var n=p(e.clientX,e.clientY),s=n.x,o=n.y;t(Q.Draggable.action_addBeadOnClick({x:s,y:o}))}else if(a.mode===i.Idle)!0===f&&(f=!1);else if(a.mode===i.EditBeads){if(!0===r.isDragged);else if(!1===r.isDragged&&!0===r.isDragStarted){var c=p(e.clientX,e.clientY),l=c.x,u=c.y,h=[];Object.keys(a.appData.beads).forEach((function(e){var t=a.appData.beads[e],n=x(t.position.x-t.width/2,t.position.y-t.height/2),i=x(t.position.x+t.width/2,t.position.y+t.height/2);D(n,i,x(l,u))&&h.push(e)})),t(Q.MouseSelection.action_selectBeads(h))}else t(Q.MouseSelection.action_selectBeads([]));r.onUp(),d.onUp()}}function S(){if(null!==e){var a=e.getBoundingClientRect(),i=a.width,s=a.height;t.left=i/-2,t.right=i/2,t.top=s/2,t.bottom=s/-2,t.updateProjectionMatrix(),n.setSize(i,s)}}function y(a){if(h){var n=h,o=n.width,c=n.height,u=n.top,v=n.left;s.x=(a.clientX-v)/o*2-1,s.y=-(a.clientY-u)/c*2+1;var b=a.clientX-v,S=a.clientY-u;if(!0===f){var y=g.x-b,x=g.y-S,E=y*l,k=x*l,B=m.x+E,C=m.y-k;t.position.x=B,t.position.y=C,t.lookAt(B,C,0)}var D=lt.dispatch,w=(lt.subscribe,(0,lt.getState)());if(w.mode===i.EditBeads){if(!0===r.isDragStarted){var _=p(a.clientX,a.clientY),O=_.x,j=_.y;if(r.onMove(O,j),!0===r.isDragged){var I=[];Object.keys(w.appData.beads).forEach((function(e){var t=w.appData.beads[e];r.contain(t.position)&&I.push(e)})),D(Q.MouseSelection.action_selectBeads(I))}}if(null===e)throw new Error("no el in dom");var M=e.getBoundingClientRect(),L=(M.width,M.height,M.top),A=M.left,R=a.clientX-A,N=a.clientY-L;d.onMove(R,N)}}}}),ft=function(){function e(){Object(_.a)(this,e),this.isDragged=!1,this.isDragStarted=!1,this.end={x:0,y:0},this.start={x:0,y:0}}return Object(O.a)(e,[{key:"onUp",value:function(){this.isDragStarted=!1,this.isDragged=!1,this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0}},{key:"onDown",value:function(e,t){this.isDragStarted=!0,this.start.x=e,this.start.y=t,this.end.x=e,this.end.y=t}},{key:"onMove",value:function(e,t){if(1==this.isDragStarted&&(this.end.x=e,this.end.y=t,!1===this.isDragged)){var a=this.start,n=this.end,i=n.x-a.x,s=n.y-a.y;(Math.abs(i)>5||Math.abs(s)>5)&&(this.isDragged=!0)}}},{key:"contain",value:function(e){var t=this.start,a=this.end,n=Math.min(t.x,a.x),i=Math.min(t.y,a.y),s=Math.max(t.x,a.x),o=Math.max(t.y,a.y);return e.x>n&&e.x<s&&e.y>i&&e.y<o}}]),e}(),gt=function(){function e(){Object(_.a)(this,e),this.element=void 0,this.renderer=void 0,this.startPoint=void 0,this.pointTopLeft=void 0,this.pointBottomRight=void 0,this.isDown=void 0,this.element=document.createElement("div"),this.element.style.pointerEvents="none",this.element.style.background="rgba(75, 160, 255, 0.3)",this.element.style.border="1px solid #55aaff",this.element.style.position="absolute",this.element.style.zIndex="2",this.startPoint=new ht.Vector2,this.pointTopLeft=new ht.Vector2,this.pointBottomRight=new ht.Vector2,this.isDown=!1}return Object(O.a)(e,[{key:"setRenderer",value:function(e){this.renderer=e}},{key:"onDown",value:function(e,t){this.isDown=!0,this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e+"px",this.element.style.top=t+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e,this.startPoint.y=t}},{key:"onMove",value:function(e,t){this.isDown&&(this.pointBottomRight.x=Math.max(this.startPoint.x,e),this.pointBottomRight.y=Math.max(this.startPoint.y,t),this.pointTopLeft.x=Math.min(this.startPoint.x,e),this.pointTopLeft.y=Math.min(this.startPoint.y,t),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px")}},{key:"onUp",value:function(){null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element)}}]),e}();u.a.render(c.a.createElement(ut,null),document.getElementById("root")),m=document.getElementById("threejs"),pt(m)}},[[101,1,2]]]);
//# sourceMappingURL=main.8f544196.chunk.js.map