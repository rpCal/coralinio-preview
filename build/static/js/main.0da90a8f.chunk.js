(this.webpackJsonpcoralinio=this.webpackJsonpcoralinio||[]).push([[0],{166:function(e){e.exports=JSON.parse('{"name":"coralinio","version":"0.1.89","private":true,"dependencies":{"@fortawesome/fontawesome-svg-core":"^1.2.34","@fortawesome/free-regular-svg-icons":"^5.15.2","@fortawesome/free-solid-svg-icons":"^5.15.2","@fortawesome/react-fontawesome":"^0.1.14","date-fns":"^2.21.1","i18next":"^20.2.1","i18next-browser-languagedetector":"^6.1.0","i18next-chained-backend":"^2.1.0","i18next-http-backend":"^1.2.1","i18next-localstorage-backend":"^3.1.2","i18next-sprintf-postprocessor":"^0.2.2","immer":"^8.0.1","immer-reducer":"^0.7.11","lodash":"^4.17.21","rc-slider":"^9.7.1","react":"^17.0.1","react-color":"^2.19.3","react-dom":"^17.0.1","react-i18next":"^11.8.13","react-redux":"^7.2.2","react-router-dom":"^5.2.0","react-scripts":"4.0.3","react-tooltip":"^4.2.15","redux":"^4.0.5","three":"^0.126.0","ts-essentials":"^7.0.1","typescript":"^4.2.2","use-context-selector":"^1.3.7"},"scripts":{"http-server":"http-server ./build/","start":"react-scripts start","build":"react-scripts build","untouched__test":"react-scripts test","test_mocha":"npx ts-mocha -p test/tsconfig.json","test":"xvfb-run --auto-servernum --server-num=1 -s \\"-ac -screen 0 1280x1024x24\\" `which npm` run test_mocha","test_react":"xvfb-run --auto-servernum --server-num=1 -s \\"-ac -screen 0 1280x1024x24\\" `which npm` run untouched__test","cypress:open":"npx cypress open","cypress:run":"npx cypress run","eject":"react-scripts eject","push":"git add -A . && git commit -m \'up\' && git push","goToPreview":"cd ../../../coralinio-preview/","clear":"rm -rf /home/robson/www/private/coralinio-preview/build","copy":"cp -R build/ /home/robson/www/private/coralinio-preview","publish":"npm run clear && npm run copy && cd ../../../coralinio-preview/ && git add -A . && git commit -m \'up\' && git push","deploy:app":"npm version patch && npm run build && npm run push && npm run publish","convert:obj2gltf":"npx obj2gltf -i ./3dmodels/input.obj -o ./3dmodels/output.gltf","translations-scan":"npx i18next-scanner --config i18next-scanner.config.js src/**/*.{js,jsx,ts,tsx,html,htm}"},"homepage":".","eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@babel/preset-env":"^7.13.15","@types/date-fns":"^2.6.0","@types/chai":"^4.2.16","@types/jest":"26.0.20","@types/lodash":"^4.14.168","@types/mocha":"^8.2.2","@types/node":"14.14.31","@types/rc-slider":"^8.6.6","@types/react":"17.0.2","@types/react-color":"^3.0.4","@types/react-dom":"17.0.1","@types/react-redux":"^7.1.16","@types/react-router-dom":"^5.1.7","@types/redux":"^3.6.0","@types/styled-components":"^5.1.7","@types/three":"^0.125.3","babel-jest":"^26.6.3","canvas":"^2.7.0","chai":"^4.3.4","cypress":"^7.0.1","gh-pages":"^3.1.0","gl":"^4.9.0","http-server":"^0.12.3","i18next-scanner":"^3.0.0","ignore-styles":"^5.0.1","jsdom":"16.5.2","jsdom-global":"3.0.2","mocha":"^8.3.2","node-gyp":"^8.0.0","nyc":"^15.1.0","obj2gltf":"^3.1.0","raw-loader":"^4.0.2","styled-components":"^5.2.1","ts-mocha":"^8.0.0","ts-node":"^9.1.1"}}')},295:function(e,t,n){"use strict";n.r(t);var i,o,a=n(0),s=n.n(a),r=n(32),c=n.n(r),d=n(14),l=n(49),u=n(27),p=n(21),h=n(305),b=n(22),v=n(8);!function(e){e.MODEL_SPHERE="MODEL_SPHERE",e.MODEL_CYLINDER="MODEL_CYLINDER",e.MODEL_FIRE_POLISH="MODEL_FIRE_POLISH",e.MODEL_TOHO_ROUND="MODEL_TOHO_ROUND"}(i||(i={})),function(e){e.Shiny="Shiny",e.Mat="Mat"}(o||(o={}));var f,j,g;!function(e){e.Rectangles="Rectangles",e.Bricks="Bricks"}(f||(f={})),function(e){e.Rectangle="Rectangle",e.Triangle="Triangle",e.Circle="Circle"}(j||(j={})),function(e){e.Bead="Bead",e.Region="Region",e.Group="Group",e.PreviewProject3D="PreviewProject3D",e.SceneEditBBox="SceneEditBBox",e.SceneBackgroundGrid="SceneBackgroundGrid",e.SceneLight="SceneLight"}(g||(g={}));var m,y,x,O,w="__";!function(e){e.Idle="Idle",e.EditLines="EditLines",e.AddLine="AddLine",e.SelectOrMove="SelectOrMove",e.SelectMultiple="SelectMultiple",e.AddBeads="AddBeads",e.DeleteBeads="DeleteBeads",e.PaintBeads="ColorPaint",e.AddRegion="AddRegion"}(m||(m={})),function(e){e.None="None",e.File="File",e.Grid="Grid",e.Background="Background"}(y||(y={})),function(e){e.Hex="Hex",e.Box="Box"}(x||(x={})),function(e){e.Color="Color"}(O||(O={}));var k,D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:e,y:t,z:n}},S=function(e,t,n){return n.x>e.x&&n.x<t.x&&n.y>e.y&&n.y<t.y},E=n(3);!function(e){e.MAIN="MAIN",e.ANY="beadChildOf",e.SELECTION="SELECTION",e.SELECTION_CHILD="SELECTION_CHILD"}(k||(k={}));var I,C,T,_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.MAIN;return"".concat(g.Bead).concat(w).concat(e).concat(w).concat(t)},B=function(e,t){return Object(v.merge)({},e,{name:_(e.id,t)})},P=function(e){var t={id:E.r.generateUUID(),position:D(0,0),type:i.MODEL_TOHO_ROUND,material:o.Mat,rotateX:0,rotateY:0,rotateZ:0,lineRotate:0,color:"#4fc3f7",height:10,width:10,depth:10,keepAspectRatio:!1,canLockOrUnlock:!0,isLocked:!1,objectType:g.Bead,groupId:void 0,regionId:void 0};return Object(v.merge)(t,e)},M={"Content-Type":"application/json"},R=function(e,t){console.error("request error",e),t("err")},A=!1,N=(new Date).getTime(),z=[];!function(e){e.CREATE="CREATE",e.UPDATE="UPDATE",e.DELETE="DELETE"}(T||(T={}));var L,H,U,F,G,Y=function(e){!0===A&&e.length>0&&(e.forEach((function(e){z.push(e)})),X())},X=Object(v.debounce)((function(){return W()}),500,{trailing:!0}),W=function(){var e=(new Date).getTime();if(console.log("triggerSendBatchEvents: diff: ",e-N,z.length>0),z.length>0&&void 0!==C){var t=JSON.stringify({changes:z});z=[],function(e,t){new Promise((function(n,i){return fetch(I+"api/boards/events/"+e,{method:"POST",headers:M,body:t}).then((function(e){return e.json()})).then((function(e){e.statusCode&&200!==e.statusCode&&i(e.message),n({status:e.statusCode})})).catch((function(e){return R(e,i)}))}))}(C,t)}N=e},V=n(1),Z=function(e){var t=Object(h.a)(["boards"]),n=Object(d.a)(t,1)[0],i=Object(u.f)(),o=s.a.useState({boards:[]}),a=Object(d.a)(o,2),r=a[0],c=a[1];return s.a.useEffect((function(){!0===e.data.save_events&&new Promise((function(e,t){return fetch(I+"api/boards/list",{method:"GET",headers:M}).then((function(e){return e.json()})).then((function(n){n.statusCode&&200!==n.statusCode&&t(n.message),e({boards:n.boards})})).catch((function(e){return R(e,t)}))})).then((function(e){c({boards:e.boards})}))}),[]),Object(V.jsx)(K,{children:Object(V.jsxs)("div",{children:[Object(V.jsx)("h2",{children:n("boards:title")}),Object(V.jsx)("button",{onClick:function(){var e;new Promise((function(t,n){return fetch(I+"api/boards/create",{method:"POST",headers:M,body:JSON.stringify({name:null!==e&&void 0!==e?e:""})}).then((function(e){return e.json()})).then((function(e){e.statusCode&&200!==e.statusCode&&n(e.message),t({board:e.board})})).catch((function(e){return R(e,n)}))})).then((function(e){i.push("/board/".concat(e.board.uuid))}))},className:"btn-primary",children:n("boards:links.create_board")}),Object(V.jsxs)("table",{children:[Object(V.jsx)("thead",{children:Object(V.jsxs)("tr",{children:[Object(V.jsx)("th",{children:n("boards:table.column_name")}),Object(V.jsx)("th",{children:n("boards:table.column_actions")})]})}),Object(V.jsxs)("tbody",{children:[Object(V.jsxs)("tr",{children:[Object(V.jsx)("td",{children:n("boards:links.demo_board_name")}),Object(V.jsx)("td",{children:Object(V.jsx)(l.b,{to:"/board/demo","data-test":"demoboard",children:n("boards:links.demo_board")})})]}),r.boards.map((function(e){return Object(V.jsxs)("tr",{children:[Object(V.jsx)("td",{children:e.name}),Object(V.jsx)("td",{children:Object(V.jsx)(l.b,{to:"/board/".concat(e.uuid),children:n("boards:links.edit_board")})})]},e.uuid)}))]})]}),Object(V.jsx)(l.b,{className:"btn-light",to:"/",children:n("boards:links.back_to_home")})]})})},K=b.c.div(L||(L=Object(p.a)(["\n  padding: 1em;\n  table {\n    width: 100%;\n    max-width: 100%;\n    margin-bottom: 1rem;\n    background-color: transparent;\n  }\n  table td,\n  table th {\n    padding: 0.75rem;\n    vertical-align: top;\n    border-top: 1px solid #dee2e6;\n  }\n  table th {\n    color: #000;\n    background-color: #e9ecef;\n    border-color: #e9ecef;\n    vertical-align: bottom;\n    border-bottom: 2px solid #dee2e6;\n  }\n  table tbody tr:hover td {\n    color: #495057;\n    background-color: #e9ecef;\n    border-color: #dee2e6;\n  }\n  .btn-primary {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #fff;\n    background-color: #007bff;\n    border-color: #007bff;\n    margin-bottom: 10px;\n  }\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #f8f9fa;\n    margin-bottom: 10px;\n  }\n  h2 {\n    margin-bottom: 0.5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n"]))),q=n(17),J=n(12);!function(e){e.EditBeadProduct="EditBeadProduct",e.EditBeadType="EditBeadType",e.EditBeadMaterial="EditBeadMaterial",e.EditBeadColor="EditBeadColor",e.EditRegionShape="EditRegionShape",e.EditRegionGridType="EditRegionGridType",e.EditRegionGridSettings="EditRegionGridSettings",e.EditPosition="EditPosition",e.EditRotate="EditRotate",e.EditWidthHeight="EditWidthHeight",e.EditWidthHeightDepth="EditWidthHeightDepth",e.Alignment="Alignment",e.Lock="Lock",e.Unlock="Unlock",e.Group="Group",e.Ungroup="Ungroup",e.More="More"}(F||(F={})),function(e){e.EditBeadsProperies="EditBeadsProperies",e.EditRegionProperies="EditRegionProperies",e.Transform="Transform",e.LockOrUnlock="LockOrUnlock",e.GroupOrUngroup="GroupOrUngroup",e.More="More"}(G||(G={}));var $,Q,ee=(H={},Object(J.a)(H,g.Bead,[F.EditBeadProduct,F.EditBeadType,F.EditBeadMaterial,F.EditBeadColor,F.Alignment,F.EditWidthHeightDepth,F.EditPosition,F.EditRotate,F.Group,F.Ungroup,F.Lock,F.Unlock,F.More]),Object(J.a)(H,g.Region,[F.EditRegionShape,F.EditRegionGridType,F.EditRegionGridSettings,F.EditWidthHeight,F.EditPosition,F.Group,F.Ungroup,F.Lock,F.Unlock,F.More]),Object(J.a)(H,g.Group,[F.EditPosition,F.Group,F.Ungroup,F.Lock,F.Unlock,F.More]),Object(J.a)(H,g.PreviewProject3D,[F.EditPosition,F.Group,F.Ungroup,F.Lock,F.Unlock,F.More]),H),te=(U={},Object(J.a)(U,F.EditBeadProduct,{name:F.EditBeadProduct,sortOrder:10,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(J.a)(U,F.EditBeadType,{name:F.EditBeadType,sortOrder:20,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(J.a)(U,F.EditBeadMaterial,{name:F.EditBeadMaterial,sortOrder:30,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(J.a)(U,F.EditBeadColor,{name:F.EditBeadColor,sortOrder:40,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(J.a)(U,F.EditRegionShape,{name:F.EditRegionShape,sortOrder:10,groupId:G.EditRegionProperies,groupSortOrder:40}),Object(J.a)(U,F.EditRegionGridType,{name:F.EditRegionGridType,sortOrder:20,groupId:G.EditRegionProperies,groupSortOrder:40}),Object(J.a)(U,F.EditRegionGridSettings,{name:F.EditRegionGridSettings,sortOrder:30,groupId:G.EditRegionProperies,groupSortOrder:40}),Object(J.a)(U,F.EditPosition,{name:F.EditPosition,sortOrder:10,groupId:G.Transform,groupSortOrder:60}),Object(J.a)(U,F.EditRotate,{name:F.EditRotate,sortOrder:20,groupId:G.Transform,groupSortOrder:60}),Object(J.a)(U,F.EditWidthHeight,{name:F.EditWidthHeight,sortOrder:30,groupId:G.Transform,groupSortOrder:60}),Object(J.a)(U,F.EditWidthHeightDepth,{name:F.EditWidthHeightDepth,sortOrder:30,groupId:G.Transform,groupSortOrder:60}),Object(J.a)(U,F.Alignment,{name:F.Alignment,sortOrder:50,groupId:G.EditBeadsProperies,groupSortOrder:50}),Object(J.a)(U,F.Lock,{name:F.Lock,sortOrder:10,groupId:G.LockOrUnlock,groupSortOrder:90}),Object(J.a)(U,F.Unlock,{name:F.Unlock,sortOrder:20,groupId:G.LockOrUnlock,groupSortOrder:90}),Object(J.a)(U,F.Group,{name:F.Group,sortOrder:10,groupId:G.GroupOrUngroup,groupSortOrder:80}),Object(J.a)(U,F.Ungroup,{name:F.Ungroup,sortOrder:20,groupId:G.GroupOrUngroup,groupSortOrder:80}),Object(J.a)(U,F.More,{name:F.More,sortOrder:1,groupId:G.More,groupSortOrder:100}),U),ne=n(11),ie=n(13);!function(e){e.AddObjects="AddObjects",e.DuplicateObjects="DuplicateObjects",e.RemoveObjects="RemoveObjects",e.ChangeSelectObjects="ChangeSelectObjects",e.ChangeObjectsProperty="ChangeObjectsProperty",e.ChangeObjectsAlignment="ChangeObjectsAlignment",e.ClipboardCut="ClipboardCut",e.ClipboardCopy="ClipboardCopy",e.ClipboardPaste="ClipboardPaste",e.AddMultipleBeads="AddMultipleBeads",e.ChangeUiSettings="ChangeUiSettings",e.ChangeUiSettingsZoom="ChangeUiSettingsZoom",e.ChangeUiSettingsSidebar="ChangeUiSettingsSidebar",e.GroupObjects="GroupObjects",e.UngroupObjects="UngroupObjects"}($||($={})),function(e){e.X_MIN="X_MIN",e.X_MAX="X_MAX",e.X_MIDDLE="X_MIDDLE",e.Y_MIN="Y_MIN",e.Y_MAX="Y_MAX",e.Y_MIDDLE="Y_MIDDLE"}(Q||(Q={}));var oe,ae,se=!0,re=function(){var e;se&&(e=console).log.apply(e,arguments)},ce=function(){var e;se&&(e=console).error.apply(e,arguments)},de=function(){var e;se&&(e=console).warn.apply(e,arguments)},le=function(){var e;se&&(e=console).log.apply(e,arguments)},ue={objects:{},selectedIds:[],history:{canRedo:!1,canUndo:!1,events:[]},board:{uuid:"",name:"",canEdit:!0,canToggleToFavourite:!0,isFavourite:!1,canExportAsImage:!0,editModalVisible:!1},ui:{modalSearchProducts:{isOpen:!1,successAction:void 0,advBlockVisible:!1,color:"",producer:"",q:"",cachedResponse:[],scrollPosition:0},leftSidebar:{isOpen:!1,panel:void 0},rightSidebar:{isOpen:!1,panel:void 0},zoomScale:1,mode:m.SelectOrMove,lights:[{id:E.r.generateUUID(),type:"THREE.DirectionalLight",name:"main_light_1",color:"#FFF",intensity:.8,position:{x:0,y:0,z:10}},{id:E.r.generateUUID(),type:"THREE.DirectionalLight",name:"main_light_2",color:"#FFF",intensity:.4,position:{x:0,y:0,z:10}}],grid:{id:E.r.generateUUID(),type:x.Hex,hexSize:30,snapEnabled:!0,isVisible:!0,width:30,height:30},selectedTopBarPosition:void 0,blockThreejs:{loading:!0,error:void 0}}},pe={objects:{},selectedIds:[],history:{canRedo:!1,canUndo:!1,events:[]},board:{canEdit:!1,canToggleToFavourite:!1,uuid:"",isFavourite:!1,name:"...",canExportAsImage:!0,editModalVisible:!1},ui:Object(v.cloneDeep)(ue.ui)},he=function(){return oe},be=function(e){re("APPSTORE: setStore",e,e.selectedIds),oe=e},ve=!0,fe=!0,je=function(){return ve},ge=function(){return fe},me=n(2),ye=n(4),xe=n(6),Oe=n(7),we=n(20);!function(e){e.MAIN="MAIN",e.BG="bg",e.ANY="GroupChildOf"}(ae||(ae={}));var ke,De=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ae.MAIN;return"".concat(g.Group).concat(w).concat(e).concat(w).concat(t)},Se=function(e,t){return Object(v.merge)({},e,{name:De(e.id,t)})},Ee=function(e){var t={id:E.r.generateUUID(),position:D(0,0),rotateX:90,rotateY:0,rotateZ:0,height:10,width:10,depth:10,canLockOrUnlock:!0,isLocked:!1,objectType:g.Group,childrenIds:[]};return Object(v.merge)(t,e)};!function(e){e.MAIN="MAIN",e.BG="BG",e.ANY="PreviewProject3DChildOf"}(ke||(ke={}));var Ie,Ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ke.MAIN;return"".concat(g.PreviewProject3D).concat(w).concat(e).concat(w).concat(t)},Te=function(e,t){return Object(v.merge)({},e,{name:Ce(e.id,t)})};!function(e){e.MAIN="main",e.BG="bg",e.GRID_CELLS="GRID_CELLS",e.GRID_CELL="gridCell",e.CONTENT="content"}(Ie||(Ie={}));var _e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ie.MAIN;return"".concat(g.Region).concat(w).concat(e).concat(w).concat(t)},Be=function(e,t){return Object(v.merge)({},e,{name:_e(e.id,t)})},Pe=function(e){return{columns:e,rows:e}},Me=function(e,t){if(e.shape===j.Rectangle){var n=e.rows*e.columns;if(t>=0&&t<n){if(e.gridType===f.Bricks){var i=Math.floor(t/e.columns)%2!==0,o=Math.floor(t%e.columns)!==e.columns-1;return!!(!0===i&&o||!1===i)}return!0}return!1}if(e.shape===j.Triangle){var a=function(e,t,n){var i=e.rows-t-1;if(i>=e.rows||n<0||n>=e.columns)return{isInside:!1,lastColumnIndex:0};var o=e.columns%2===0?2:1,a=Math.max(0,i)/(e.rows-1),s=o+Math.min(Math.floor((e.columns-o)*a),e.columns-o);e.columns%2!==s%2&&s++;var r=e.columns-s,c=Math.floor(r/2),d=s+c,l=!0;return(n<c||n>=d)&&(l=!1),{isInside:l,lastColumnIndex:d}}(e,Math.floor(t/e.columns),Math.floor(t%e.columns)),s=a.isInside,r=a.lastColumnIndex;if(!0===s){if(e.gridType===f.Bricks){var c=Math.floor(t/e.columns),d=Math.floor(t%e.columns),l=c%2!==0;return!!(!0===l&&d!==r-1||!1===l)}return!0}return!1}return console.error("region shape not handled",e.shape),!1},Re=function(e){var t={id:E.r.generateUUID(),position:D(0,0),gridType:f.Rectangles,shape:j.Rectangle,height:10,width:10,beadIds:[],opacity:.5,columns:3,rows:3,autoFillBeads:!1,snapBeadsToCell:!0,canLockOrUnlock:!0,isLocked:!1,objectType:g.Region,childrenGridIds:[],depth:1,rotateX:0,rotateY:0,rotateZ:0},n=Object(v.merge)(t,e),i=n.rows*n.columns,o=Array(i).fill(void 0);return n.childrenGridIds=Object(v.merge)(o,e.childrenGridIds),n},Ae=n(53),Ne=n.n(Ae),ze=n(66),Le=n(155),He=E.c,Ue=E.g,Fe=E.h,Ge=E.l,Ye=E.n,Xe=E.o,We=E.p,Ve=E.q,Ze=E.s,Ke=E.v,qe=E.z,Je=E.A,$e=E.F,Qe=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,i=/^usemap /,o=new $e,a=new $e,s=new $e,r=new $e,c=new $e;function d(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"===typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"===typeof n.clone){var i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var i=this.vertices,o=this.object.geometry.vertices;o.push(i[e+0],i[e+1],i[e+2]),o.push(i[t+0],i[t+1],i[t+2]),o.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var i=this.normals,o=this.object.geometry.normals;o.push(i[e+0],i[e+1],i[e+2]),o.push(i[t+0],i[t+1],i[t+2]),o.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){var i=this.vertices,d=this.object.geometry.normals;o.fromArray(i,e),a.fromArray(i,t),s.fromArray(i,n),c.subVectors(s,a),r.subVectors(o,a),c.cross(r),c.normalize(),d.push(c.x,c.y,c.z),d.push(c.x,c.y,c.z),d.push(c.x,c.y,c.z)},addColor:function(e,t,n){var i=this.colors,o=this.object.geometry.colors;void 0!==i[e]&&o.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&o.push(i[t+0],i[t+1],i[t+2]),void 0!==i[n]&&o.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){var i=this.uvs,o=this.object.geometry.uvs;o.push(i[e+0],i[e+1]),o.push(i[t+0],i[t+1]),o.push(i[n+0],i[n+1])},addDefaultUV:function(){var e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,o,a,s,r,c){var d=this.vertices.length,l=this.parseVertexIndex(e,d),u=this.parseVertexIndex(t,d),p=this.parseVertexIndex(n,d);if(this.addVertex(l,u,p),this.addColor(l,u,p),void 0!==s&&""!==s){var h=this.normals.length;l=this.parseNormalIndex(s,h),u=this.parseNormalIndex(r,h),p=this.parseNormalIndex(c,h),this.addNormal(l,u,p)}else this.addFaceNormal(l,u,p);if(void 0!==i&&""!==i){var b=this.uvs.length;l=this.parseUVIndex(i,b),u=this.parseUVIndex(o,b),p=this.parseUVIndex(a,b),this.addUV(l,u,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,i=e.length;n<i;n++){var o=this.parseVertexIndex(e[n],t);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,i=this.uvs.length,o=0,a=e.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));var s=0;for(a=t.length;s<a;s++)this.addUVLine(this.parseUVIndex(t[s],i))}};return e.startObject("",!1),e}function l(e){We.call(this,e),this.materials=null}return l.prototype=Object.assign(Object.create(We.prototype),{constructor:l,load:function(e,t,n,i){var o=this,a=new Ue(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(o.parse(n))}catch(a){i?i(a):console.error(a),o.manager.itemError(e)}}),n,i)},setMaterials:function(e){return this.materials=e,this},parse:function(o){var a=new d;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var s=o.split("\n"),r="",c="",l=[],u="function"===typeof"".trimLeft,p=0,h=s.length;p<h;p++)if(r=s[p],0!==(r=u?r.trimLeft():r.trim()).length&&"#"!==(c=r.charAt(0)))if("v"===c){var b=r.split(/\s+/);switch(b[0]){case"v":a.vertices.push(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])),b.length>=7?a.colors.push(parseFloat(b[4]),parseFloat(b[5]),parseFloat(b[6])):a.colors.push(void 0,void 0,void 0);break;case"vn":a.normals.push(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]));break;case"vt":a.uvs.push(parseFloat(b[1]),parseFloat(b[2]))}}else if("f"===c){for(var v=r.substr(1).trim().split(/\s+/),f=[],j=0,g=v.length;j<g;j++){var m=v[j];if(m.length>0){var y=m.split("/");f.push(y)}}var x=f[0];for(j=1,g=f.length-1;j<g;j++){var O=f[j],w=f[j+1];a.addFace(x[0],O[0],w[0],x[1],O[1],w[1],x[2],O[2],w[2])}}else if("l"===c){var k=r.substring(1).trim().split(" "),D=[],S=[];if(-1===r.indexOf("/"))D=k;else for(var E=0,I=k.length;E<I;E++){var C=k[E].split("/");""!==C[0]&&D.push(C[0]),""!==C[1]&&S.push(C[1])}a.addLineGeometry(D,S)}else if("p"===c){var T=r.substr(1).trim().split(" ");a.addPointGeometry(T)}else if(null!==(l=e.exec(r))){var _=(" "+l[0].substr(1).trim()).substr(1);a.startObject(_)}else if(n.test(r))a.object.startMaterial(r.substring(7).trim(),a.materialLibraries);else if(t.test(r))a.materialLibraries.push(r.substring(7).trim());else if(i.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if((l=r.split(" ")).length>1){var B=l[1].trim().toLowerCase();a.object.smooth="0"!==B&&"off"!==B}else a.object.smooth=!0;(X=a.object.currentMaterial())&&(X.smooth=a.object.smooth)}else{if("\0"===r)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}a.finalize();var P=new Ge;if(P.materialLibraries=[].concat(a.materialLibraries),!0===!(1===a.objects.length&&0===a.objects[0].geometry.vertices.length))for(p=0,h=a.objects.length;p<h;p++){var M=a.objects[p],R=M.geometry,A=M.materials,N="Line"===R.type,z="Points"===R.type,L=!1;if(0!==R.vertices.length){(K=new He).setAttribute("position",new Fe(R.vertices,3)),R.normals.length>0&&K.setAttribute("normal",new Fe(R.normals,3)),R.colors.length>0&&(L=!0,K.setAttribute("color",new Fe(R.colors,3))),!0===R.hasUVIndices&&K.setAttribute("uv",new Fe(R.uvs,2));for(var H,U=[],F=0,G=A.length;F<G;F++){var Y=(Z=A[F]).name+"_"+Z.smooth+"_"+L,X=a.materials[Y];if(null!==this.materials)if(X=this.materials.create(Z.name),!N||!X||X instanceof Ye){if(z&&X&&!(X instanceof Je)){var W=new Je({size:10,sizeAttenuation:!1});Ve.prototype.copy.call(W,X),W.color.copy(X.color),W.map=X.map,X=W}}else{var V=new Ye;Ve.prototype.copy.call(V,X),V.color.copy(X.color),X=V}void 0===X&&((X=N?new Ye:z?new Je({size:1,sizeAttenuation:!1}):new Ke).name=Z.name,X.flatShading=!Z.smooth,X.vertexColors=L,a.materials[Y]=X),U.push(X)}if(U.length>1){for(F=0,G=A.length;F<G;F++){var Z=A[F];K.addGroup(Z.groupStart,Z.groupCount,F)}H=N?new Xe(K,U):z?new qe(K,U):new Ze(K,U)}else H=N?new Xe(K,U[0]):z?new qe(K,U[0]):new Ze(K,U[0]);H.name=M.name,P.add(H)}}else if(a.vertices.length>0){var K;X=new Je({size:1,sizeAttenuation:!1});(K=new He).setAttribute("position",new Fe(a.vertices,3)),a.colors.length>0&&void 0!==a.colors[0]&&(K.setAttribute("color",new Fe(a.colors,3)),X.vertexColors=!0);var q=new qe(K,X);P.add(q)}return P}}),l}(),et={model_cylinder:{model:null,bbox:null},model_sphere:{model:null,bbox:null},model_fire_polish:{model:null,bbox:null},model_toho_round:{model:null,bbox:null}},tt=function(){var e=Object(ze.a)(Ne.a.mark((function e(){var t,n,i,o,a,s,r,c,d,l;return Ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[{filename:"model_cylinder.obj",key:"model_cylinder"},{filename:"model_fire_polish.obj",key:"model_fire_polish"},{filename:"model_sphere.obj",key:"model_sphere"},{filename:"model_toho_round.obj",key:"model_toho_round"}],n=!0,i=!1,e.prev=3,a=Object(Le.a)(t);case 5:return e.next=7,a.next();case 7:return s=e.sent,n=s.done,e.next=11,s.value;case 11:if(r=e.sent,n){e.next=30;break}return c=r,e.prev=14,d=new Qe,e.next=18,d.loadAsync("https://rpcal.github.io/coralinio-preview/build/models3d/"+c.filename);case 18:l=e.sent,re("loadAppModels: success to load ".concat(c.key)),et[c.key].model=l.clone(),et[c.key].bbox=(new E.a).setFromObject(l),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(14),ce("loadAppModels: error - ".concat(e.t0.toString()));case 27:n=!0,e.next=5;break;case 30:e.next=36;break;case 32:e.prev=32,e.t1=e.catch(3),i=!0,o=e.t1;case 36:if(e.prev=36,e.prev=37,n||null==a.return){e.next=41;break}return e.next=41,a.return();case 41:if(e.prev=41,!i){e.next=44;break}throw o;case 44:return e.finish(41);case 45:return e.finish(36);case 46:case"end":return e.stop()}}),e,null,[[3,32,36,46],[14,24],[37,,41,45]])})));return function(){return e.apply(this,arguments)}}(),nt=n(89),it=n(59),ot=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"updateEditorState",value:function(e){this.draftState.objects=e.objects,this.draftState.selectedIds=e.selectedIds,this.draftState.ui=e.ui,this.draftState.board=e.board,this.draftState.history=e.history}}]),n}(it.ImmerReducer),at={Main:Object(it.createActionCreators)(ot)},st=Object(it.composeReducers)(Object(it.createReducerFunction)(ot,ue)),rt=Object(nt.b)(st),ct=function(){function e(){Object(me.a)(this,e),this.isDragged=!1,this.isDragStarted=!1,this.end={x:0,y:0},this.start={x:0,y:0},this.shouldBehaveLikeMove=!1}return Object(ye.a)(e,[{key:"onDown",value:function(e,t){this.isDragStarted=!0,this.isDragged=!1,this.start.x=e,this.start.y=t,this.end.x=e,this.end.y=t}},{key:"onUp",value:function(){this.isDragStarted=!1,this.isDragged=!1,this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.shouldBehaveLikeMove=!1}},{key:"onMove",value:function(e,t){if(!0===this.isDragStarted&&(this.end.x=e,this.end.y=t,!1===this.isDragged)){var n=this.start,i=this.end,o=i.x-n.x,a=i.y-n.y;(Math.abs(o)>5||Math.abs(a)>5)&&(this.isDragged=!0)}}}]),e}(),dt=n(69),lt=function(){function e(){Object(me.a)(this,e),this.boundingClientRect=void 0,this.mouse=void 0,this.raycaster=void 0,this.intersects=void 0,this.boundingClientRect=void 0,this.mouse=new E.E,this.raycaster=new E.B,this.raycaster.layers.enable(3),this.intersects=[]}return Object(ye.a)(e,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){}},{key:"onMove",value:function(e){}},{key:"onUp",value:function(e){}},{key:"getIntersect",value:function(e,t){if(null!==an.el&&(this.boundingClientRect=an.el.getBoundingClientRect()),void 0===this.boundingClientRect)return[];var n=this.boundingClientRect,i=n.width,o=n.height,a=n.top,s=n.left;return this.mouse.x=(e-s)/i*2-1,this.mouse.y=-(t-a)/o*2+1,this.raycaster.setFromCamera(this.mouse,an.camera),this.raycaster.intersectObjects(an.scene.children,!0)}},{key:"getIntersectObjects",value:function(e,t){return this.getObjectsFromIntersect(this.getIntersect(e,t))}},{key:"getActiveObjectsFromIntersect",value:function(e,t){return this.getIntersect(e,t).filter((function(e){var t,n=e.object.userData,i=null!==(t=null===n||void 0===n?void 0:n.objectType)&&void 0!==t?t:void 0;return i===g.Bead||i===g.Region||i===g.Group||i===g.PreviewProject3D}))}},{key:"getObjectsFromIntersect",value:function(e){var t=g.Bead,n=g.Region,i=g.SceneEditBBox;return e.filter((function(e){var o,a,s,r=null!==(o=null===e||void 0===e||null===(a=e.object)||void 0===a||null===(s=a.userData)||void 0===s?void 0:s.objectType)&&void 0!==o?o:void 0;return r===t||r===n||r===i}))}},{key:"getIdsFromGroupOrInGroup",value:function(e){var t=he();if(void 0===t.objects[e])return[];var n=t.objects[e].objectType===g.Group,i=void 0!==t.objects[e].groupId&&t.objects[e].groupId.length>0,o=t.objects[e].groupId;return n?t.objects[e].childrenIds:i?[o].concat(Object(dt.a)(t.objects[o].childrenIds)):[]}},{key:"groupObjectsByTypeFromIntersect",value:function(e,t){var n={Bead:[],Region:[],SceneEditBBox:[]},i=[];return e.forEach((function(e,o){var a,s,r,c,d,l;if(!(void 0!==t&&i.length>=t)){var u=null!==(a=null===e||void 0===e||null===(s=e.object)||void 0===s||null===(r=s.userData)||void 0===r?void 0:r.id)&&void 0!==a?a:void 0,p=null!==(c=null===e||void 0===e||null===(d=e.object)||void 0===d||null===(l=d.userData)||void 0===l?void 0:l.objectType)&&void 0!==c?c:void 0;void 0!==u&&void 0!==p&&(n[p].push(e),i.push(o))}})),n}}]),e}(),ut=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;return Object(me.a)(this,n),(e=t.call(this)).mouseDragHelper=void 0,e.lastAddPosition=void 0,e.mouseDragHelper=new ct,e.lastAddPosition=new E.E,e}return Object(ye.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){var t=On(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onDown(n,i),this.addBead(n,i),this.lastAddPosition.set(n,i)}},{key:"onMove",value:function(e){if(!0===this.mouseDragHelper.isDragStarted){var t=On(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onMove(n,i);var o=new E.E(n,i);this.lastAddPosition.distanceTo(o)>10&&(this.lastAddPosition=o.clone(),this.addBead(n,i))}}},{key:"onUp",value:function(e){this.mouseDragHelper.onUp(),this.lastAddPosition=new E.E}},{key:"addBead",value:function(e,t){var n={name:$.AddObjects,payload:{objects:[{objectType:g.Bead,position:{x:e,y:t,z:1}}]}};ei(n)}}]),n}(lt),pt=function(){function e(){Object(me.a)(this,e),this.element=void 0,this.renderer=void 0,this.startPoint=void 0,this.pointTopLeft=void 0,this.pointBottomRight=void 0,this.isDown=void 0,this.element=document.createElement("div"),this.element.style.pointerEvents="none",this.element.style.background="rgba(75, 160, 255, 0.3)",this.element.style.border="1px solid #55aaff",this.element.style.position="absolute",this.element.style.zIndex="2",this.startPoint=new E.E,this.pointTopLeft=new E.E,this.pointBottomRight=new E.E,this.isDown=!1}return Object(ye.a)(e,[{key:"setRenderer",value:function(e){this.renderer=e}},{key:"onDown",value:function(e,t){this.isDown=!0,this.renderer.domElement&&this.renderer.domElement.parentElement&&this.renderer.domElement.parentElement.appendChild(this.element),this.element&&(this.element.style.left=e+"px",this.element.style.top=t+"px",this.element.style.width="0px",this.element.style.height="0px"),this.startPoint.x=e,this.startPoint.y=t}},{key:"onMove",value:function(e,t){this.isDown&&(this.pointBottomRight.x=Math.max(this.startPoint.x,e),this.pointBottomRight.y=Math.max(this.startPoint.y,t),this.pointTopLeft.x=Math.min(this.startPoint.x,e),this.pointTopLeft.y=Math.min(this.startPoint.y,t),this.element&&(this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"))}},{key:"onUp",value:function(){this.element&&null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element)}}]),e}(),ht=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;return Object(me.a)(this,n),(e=t.call(this)).isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.mouseDragHelper=void 0,e.mouse=void 0,e.raycaster=void 0,e.mouseSelectionHelper=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new E.E,e.startDragCamera=new E.E,e.mouseDragHelper=new ct,e.mouse=new E.E,e.raycaster=new E.B,e.mouseSelectionHelper=new pt,e.mouseSelectionHelper.setRenderer(an.renderer),e}return Object(ye.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){if(null!==an.el&&(this.boundingClientRect=an.el.getBoundingClientRect()),void 0!==this.boundingClientRect){var t=this.boundingClientRect,n=t.top,i=t.left,o=e.clientX-i,a=e.clientY-n;this.mouseSelectionHelper.onDown(o,a);var s=On(e.clientX,e.clientY),r=s.x,c=s.y;this.mouseDragHelper.onDown(r,c)}}},{key:"onMove",value:function(e){if(void 0!==this.boundingClientRect){var t=this.boundingClientRect,n=t.top,i=t.left,o=e.clientX-i,a=e.clientY-n;this.mouseSelectionHelper.onMove(o,a);var s=On(e.clientX,e.clientY),r=s.x,c=s.y;this.mouseDragHelper.onMove(r,c)}}},{key:"onUp",value:function(e){var t=Math.min(this.mouseDragHelper.start.x,this.mouseDragHelper.end.x),n=Math.min(this.mouseDragHelper.start.y,this.mouseDragHelper.end.y),i=Math.abs(this.mouseDragHelper.end.x-this.mouseDragHelper.start.x),o=Math.abs(this.mouseDragHelper.end.y-this.mouseDragHelper.start.y),a={name:$.AddObjects,payload:{objects:[{objectType:g.Region,height:o,width:i,position:{x:t+i/2,y:n+o/2,z:1}}]}};ei(a);var s={name:$.ChangeUiSettings,payload:{uiSettings:{mode:m.SelectOrMove}}};ei(s),this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}}]),n}(lt),bt=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;return Object(me.a)(this,n),(e=t.call(this)).isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.mouseDragHelper=void 0,e.mouse=void 0,e.raycaster=void 0,e.touchedIds=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new E.E,e.startDragCamera=new E.E,e.mouseDragHelper=new ct,e.mouse=new E.E,e.raycaster=new E.B,e.touchedIds=[],e}return Object(ye.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){null!==an.el&&(this.boundingClientRect=an.el.getBoundingClientRect()),this.touchedIds=[];var t=On(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onDown(n,i),this.touchBead(e.clientX,e.clientY)}},{key:"onMove",value:function(e){if(!0===this.mouseDragHelper.isDragStarted){var t=On(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onMove(n,i),this.touchBead(e.clientX,e.clientY)}}},{key:"onUp",value:function(e){this.touchedIds.length>0&&ei({name:$.RemoveObjects,payload:{ids:this.touchedIds}}),this.mouseDragHelper.onUp()}},{key:"touchBead",value:function(e,t){if(void 0!==this.boundingClientRect){var n=this.boundingClientRect,i=n.width,o=n.height,a=n.top,s=n.left;this.mouse.x=(e-s)/i*2-1,this.mouse.y=-(t-a)/o*2+1,this.raycaster.setFromCamera(this.mouse,an.camera);var r=this.raycaster.intersectObjects(an.scene.children,!0);if(r.length>0){var c=he(),d=new Set;r.forEach((function(e){var t,n,i=null!==(t=null===(n=e.object.userData)||void 0===n?void 0:n.id)&&void 0!==t?t:void 0;void 0!==i&&void 0!==c.objects[i]&&c.objects[i].objectType===g.Bead&&!1===d.has(i)&&d.add(i)})),Rn(Array.from(d))}}}}]),n}(lt),vt=function(e){(0,rt.dispatch)(at.Main.updateEditorState(e))},ft={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",ArrowUp:"Up",ArrowDown:"Down",ArrowLeft:"Left",ArrowRight:"Right"},jt=function(e){},gt=!1,mt={},yt=void 0,xt={},Ot=jt;function wt(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if("undefined"===typeof window)return!1;function i(){document[e]&&(mt={})}null===n&&(yt=window.document),"undefined"!==typeof document.hidden?(e="hidden",t="visibilitychange"):"undefined"!==typeof document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),"undefined"===typeof document.addEventListener||void 0===e?console.warn("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API."):document.addEventListener(t,i,!1)}var kt,Dt=function(e,t){return(e=e.toLowerCase()).replace(/\s/,""),"undefined"===typeof xt[e]&&(xt[e]=[]),xt[e].push(t),{unsubscribe:function(){var n=xt[e].indexOf(t);xt[e].splice(n,1)}}};function St(e){return!0===mt[e]}function Et(e){mt={}}function It(e){!0===gt&&e.preventDefault();var t=function(e){var t="",n=[];if("code"in e)t=ft[e.code]?ft[e.code]:e.code;else{var i=e.which;t=String.fromCharCode(i).toLowerCase(),ft[i]&&(t=ft[i])}return n.push(t),n.join("+")}(e),n=xt[t.toLowerCase()]||[];if("function"===typeof Ot){var i=n.length>0;Ot(t,i,e)}mt[t.toLowerCase()]=!0,n.length>0&&e.preventDefault();for(var o=!0,a=n.length-1;a>=0&&(n[a]&&(o=n[a](e,Object.keys(mt))),!1!==o);a--);}!function(e){e.MAIN="MAIN",e.BG="BG",e.EDIT_CONTAINER="EDIT_CONTAINER",e.LINES="LINES",e.WHITE_DOT_BG="WHITE_DOT_BG",e.GRAY_DOT_BG="GRAY_DOT_BG",e.RESIZE_CONTAINER="RESIZE_CONTAINER",e.DOT_RESIZE_TOP_LEFT="DOT_RESIZE_TOP_LEFT",e.DOT_RESIZE_TOP_RIGHT="DOT_RESIZE_TOP_RIGHT",e.DOT_RESIZE_BOTTOM_LEFT="DOT_RESIZE_BOTTOM_LEFT",e.DOT_RESIZE_BOTTOM_RIGHT="DOT_RESIZE_BOTTOM_RIGHT"}(kt||(kt={}));var Ct,Tt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kt.MAIN;return"".concat(g.SceneEditBBox).concat(w).concat(e).concat(w).concat(t)},_t=null,Bt=function(){return null==_t&&(_t=new Pt),_t},Pt=function(){function e(){var t=this;Object(me.a)(this,e),this.rotation=void 0,this.rectangles=void 0,this.internalId=void 0,this.dotBrName=void 0,this.dotBlName=void 0,this.dotTrName=void 0,this.dotTlName=void 0,this.selectBboxGroupName=void 0,this.selectBBoxBgName=void 0,this.boxGeometry=void 0,this.obj=void 0,this.layerRoot=void 0,this.layerChild=void 0,this.worldPosEnd=void 0,this.startPos=void 0,this.dotsStartPositions=void 0,this.getResizeDots=function(e){var n=[],i=an.camera.userData.sceneScale,o=new E.u({color:"#ffffff"}),a=new E.d(1,16),s=new E.s(a,o);s.scale.x=10,s.scale.y=10,s.renderOrder=2,s.layers.set(t.layerChild);var r=new E.u({color:"#a9a9a9"}),c=new E.d(1,16),d=new E.s(c,r);d.scale.x=12,d.scale.y=12,d.renderOrder=1,d.layers.set(t.layerChild);var l=new E.l;l.layers.set(t.layerRoot),l.attach(d),l.attach(s);var u=l.clone();u.position.x=e.min.x,u.position.y=e.min.y,u.scale.x=i,u.scale.y=i,u.userData.name=t.dotTlName,n.push(u);var p=l.clone();p.position.x=e.max.x,p.position.y=e.min.y,p.scale.x=i,p.scale.y=i,p.userData.name=t.dotTrName,n.push(p);var h=l.clone();h.position.x=e.min.x,h.position.y=e.max.y,h.scale.x=i,h.scale.y=i,h.userData.name=t.dotBlName,n.push(h);var b=l.clone();return b.position.x=e.max.x,b.position.y=e.max.y,b.scale.x=i,b.scale.y=i,b.userData.name=t.dotBrName,n.push(b),n},this.dotsStartPositions={tl:{isSelected:!1,position:void 0},tr:{isSelected:!1,position:void 0},bl:{isSelected:!1,position:void 0},br:{isSelected:!1,position:void 0}},this.worldPosEnd={x:0,y:0},this.startPos=[],this.layerRoot=2,this.layerChild=3,this.rotation=new E.F(0,0,0),this.rectangles=[],this.internalId=E.r.generateUUID(),this.selectBboxGroupName=Tt(this.internalId),this.selectBBoxBgName=Tt(this.internalId,kt.BG),this.dotBrName=Tt(this.internalId,kt.DOT_RESIZE_BOTTOM_RIGHT),this.dotBlName=Tt(this.internalId,kt.DOT_RESIZE_BOTTOM_LEFT),this.dotTrName=Tt(this.internalId,kt.DOT_RESIZE_TOP_RIGHT),this.dotTlName=Tt(this.internalId,kt.DOT_RESIZE_TOP_LEFT),this.boxGeometry=new E.b(1,1,1),this.obj=new E.s(this.boxGeometry)}return Object(ye.a)(e,[{key:"isChild",value:function(e){var t=this,n=!1;return e.forEach((function(e){e.object.userData.name===t.selectBBoxBgName&&(n=!0)})),n}},{key:"onDownMove",value:function(){var e=an.objects.get(this.selectBBoxBgName);e&&this.startPos.push([e.position.x,e.position.y]);var t=an.objects.get(this.dotBlName);t&&this.startPos.push([t.position.x,t.position.y]);var n=an.objects.get(this.dotBrName);n&&this.startPos.push([n.position.x,n.position.y]);var i=an.objects.get(this.dotTlName);i&&this.startPos.push([i.position.x,i.position.y]);var o=an.objects.get(this.dotTrName);o&&this.startPos.push([o.position.x,o.position.y])}},{key:"onMoveMove",value:function(e,t){var n=an.objects.get(this.selectBBoxBgName);n&&(n.position.x=this.startPos[0][0]+e,n.position.y=this.startPos[0][1]+t);var i=an.objects.get(this.dotBlName);i&&(i.position.x=this.startPos[1][0]+e,i.position.y=this.startPos[1][1]+t);var o=an.objects.get(this.dotBrName);o&&(o.position.x=this.startPos[2][0]+e,o.position.y=this.startPos[2][1]+t);var a=an.objects.get(this.dotTlName);a&&(a.position.x=this.startPos[3][0]+e,a.position.y=this.startPos[3][1]+t);var s=an.objects.get(this.dotTrName);s&&(s.position.x=this.startPos[4][0]+e,s.position.y=this.startPos[4][1]+t)}},{key:"onUpMove",value:function(){this.startPos=[],this.syncRectsWithStore()}},{key:"isHandle",value:function(e){var t=!1;return e.forEach((function(e){8===e.object.layers.mask&&(t=!0)})),t}},{key:"onDownEdit",value:function(e){this.dotsStartPositions={tl:{isSelected:!1,position:void 0},tr:{isSelected:!1,position:void 0},bl:{isSelected:!1,position:void 0},br:{isSelected:!1,position:void 0}};for(var t=0;t<e.length;t++){var n=e[t];if(8===n.object.layers.mask&&null!==n.object.parent){var i=n.object.parent.userData.name;if(void 0!==i){if(i===this.dotBlName){this.dotsStartPositions.bl.isSelected=!0;break}if(i===this.dotBrName){this.dotsStartPositions.br.isSelected=!0;break}if(i===this.dotTlName){this.dotsStartPositions.tl.isSelected=!0;break}if(i===this.dotTrName){this.dotsStartPositions.tr.isSelected=!0;break}}}}var o=an.objects.get(this.dotTlName);o&&(this.dotsStartPositions.tl.position=Object(v.cloneDeep)(o.position));var a=an.objects.get(this.dotTrName);a&&(this.dotsStartPositions.tr.position=Object(v.cloneDeep)(a.position));var s=an.objects.get(this.dotBlName);s&&(this.dotsStartPositions.bl.position=Object(v.cloneDeep)(s.position));var r=an.objects.get(this.dotBrName);r&&(this.dotsStartPositions.br.position=Object(v.cloneDeep)(r.position))}},{key:"onMoveEdit",value:function(e,t){if(!0===this.dotsStartPositions.tl.isSelected){var n=an.objects.get(this.dotTlName);n&&this.dotsStartPositions.tl.position&&(n.position.x=this.dotsStartPositions.tl.position.x+e,n.position.y=this.dotsStartPositions.tl.position.y+t);var i=an.objects.get(this.dotTrName);i&&this.dotsStartPositions.tr.position&&(i.position.y=this.dotsStartPositions.tr.position.y+t);var o=an.objects.get(this.dotBlName);o&&this.dotsStartPositions.bl.position&&(o.position.x=this.dotsStartPositions.bl.position.x+e)}if(!0===this.dotsStartPositions.tr.isSelected){var a=an.objects.get(this.dotTrName);a&&this.dotsStartPositions.tr.position&&(a.position.x=this.dotsStartPositions.tr.position.x+e,a.position.y=this.dotsStartPositions.tr.position.y+t);var s=an.objects.get(this.dotTlName);s&&this.dotsStartPositions.tl.position&&(s.position.y=this.dotsStartPositions.tl.position.y+t);var r=an.objects.get(this.dotBrName);r&&this.dotsStartPositions.br.position&&(r.position.x=this.dotsStartPositions.br.position.x+e)}if(!0===this.dotsStartPositions.bl.isSelected){var c=an.objects.get(this.dotBlName);c&&this.dotsStartPositions.bl.position&&(c.position.x=this.dotsStartPositions.bl.position.x+e,c.position.y=this.dotsStartPositions.bl.position.y+t);var d=an.objects.get(this.dotBrName);d&&this.dotsStartPositions.br.position&&(d.position.y=this.dotsStartPositions.br.position.y+t);var l=an.objects.get(this.dotTlName);l&&this.dotsStartPositions.tl.position&&(l.position.x=this.dotsStartPositions.tl.position.x+e)}if(!0===this.dotsStartPositions.br.isSelected){var u=an.objects.get(this.dotBrName);u&&this.dotsStartPositions.br.position&&(u.position.x=this.dotsStartPositions.br.position.x+e,u.position.y=this.dotsStartPositions.br.position.y+t);var p=an.objects.get(this.dotBlName);p&&this.dotsStartPositions.bl.position&&(p.position.y=this.dotsStartPositions.bl.position.y+t);var h=an.objects.get(this.dotTrName);h&&this.dotsStartPositions.tr.position&&(h.position.x=this.dotsStartPositions.tr.position.x+e)}var b=an.objects.get(this.selectBBoxBgName),v=an.objects.get(this.dotTlName),f=an.objects.get(this.dotBrName);if(b&&v&&f){var j=new E.a;j.min.x=v.position.x,j.min.y=v.position.y,j.max.x=f.position.x,j.max.y=f.position.y,j.max.z=b.position.z,j.min.z=b.position.z,this.updateHandleAndBg(j)}}},{key:"onUpEdit",value:function(){this.dotsStartPositions={tl:{isSelected:!1,position:void 0},tr:{isSelected:!1,position:void 0},bl:{isSelected:!1,position:void 0},br:{isSelected:!1,position:void 0}}}},{key:"syncRectsWithStore",value:function(){var e=he(),t=[];this.rectangles.forEach((function(n){var i=n.id,o=e.objects[i];o?t.push({depth:o.depth,height:o.height,width:o.width,id:o.id,position:new E.F(o.position.x,o.position.y,o.position.z),rotation:new E.F(o.rotateX,o.rotateY,o.rotateZ)}):de("missing id",i)})),this.rectangles=t;var n=this.getSelectBBox();this.updateHandleAndBg(n)}},{key:"updateRect",value:function(e,t){var n=!1,i=!1,o=this.rectangles.findIndex((function(t){return t.id===e.id})),a=-1!==o;if(!0===t&&!1===a?i=!0:!1===t&&!0===a&&(n=!0),!1!==i||!1!==n){n&&this.rectangles.splice(o,1),i&&this.rectangles.push(Object(v.cloneDeep)(e)),1===this.rectangles.length?this.rotation=this.rectangles[0].rotation:this.rotation=new E.F(0,0,0);var s=this.getSelectBBox();if(0===this.rectangles.length)this.deleteHandleAndBg();else void 0===an.objects.get(this.selectBboxGroupName)&&this.createHandleAndBg(s),this.updateHandleAndBg(s)}}},{key:"deleteHandleAndBg",value:function(){var e=an.objects.get(this.selectBboxGroupName);void 0!==e&&void 0!==e.parent&&null!==e.parent&&e.parent.remove(e),an.objects.delete(this.dotBlName),an.objects.delete(this.dotBrName),an.objects.delete(this.dotTlName),an.objects.delete(this.dotTrName),an.objects.delete(this.selectBBoxBgName),an.objects.delete(this.selectBboxGroupName)}},{key:"createHandleAndBg",value:function(e){var t=new E.l;t.userData.name=this.selectBboxGroupName;var n=new E.y(1,1,1,1),i=new E.t({color:"rgb(0,0,0)",side:E.i,opacity:.2,transparent:!0}),o=new E.s(n,i);o.userData.name=this.selectBBoxBgName;var a=this.getRectLine(-.5,.5,-.5,.5);o.add(a),this.getResizeDots(e).forEach((function(e){an.objects.set(e.userData.name,e),t.attach(e)})),t.add(o),an.scene.add(t),an.objects.set(this.selectBboxGroupName,t),an.objects.set(this.selectBBoxBgName,o)}},{key:"getRectLine",value:function(e,t,n,i){var o=(new E.D).moveTo(e,n).lineTo(t,n).lineTo(t,i).lineTo(e,i);o.autoClose=!0;var a=o.getPoints(),s=(new E.c).setFromPoints(a),r=new E.t({color:16624,opacity:1,transparent:!0});return new E.m(s,r)}},{key:"getRectBBox",value:function(e){var t=e.width,n=e.height,i=e.depth,o=e.position,a=e.rotation,s=new E.a;return this.obj.scale.set(t,n,i),this.obj.position.set(o.x,o.y,o.z),this.obj.rotation.set(E.r.DEG2RAD*a.x,E.r.DEG2RAD*a.y,E.r.DEG2RAD*a.z),s.expandByObject(this.obj),s}},{key:"getSelectBBox",value:function(){var e=this,t=new E.a;return this.rectangles.forEach((function(n){var i=n.width,o=n.height,a=n.depth,s=n.position,r=n.rotation;e.obj.scale.set(i,o,a),e.obj.position.set(s.x,s.y,s.z),e.obj.rotation.set(E.r.DEG2RAD*r.x,E.r.DEG2RAD*r.y,E.r.DEG2RAD*r.z),t.expandByObject(e.obj)})),t}},{key:"updateHandleAndBg",value:function(e){var t=this,n=new E.F;e.getCenter(n);var i=e.max.x-e.min.x,o=e.max.y-e.min.y,a=e.max.z-e.min.z,s=an.objects.get(this.selectBBoxBgName);if(void 0!==s){s.position.set(n.x,n.y,n.z),s.scale.set(i,o,a),s.clear();var r=this.getRectLine(-.5,.5,-.5,.5);if(s.add(r),this.rectangles.length>=2){var c=new E.F;e.getCenter(c);var d=e.max.x-e.min.x,l=e.max.y-e.min.y;this.rectangles.forEach((function(e){var n=t.getRectBBox(e),i=new E.F;n.getCenter(i);var o=(i.x-c.x)/d,a=(i.y-c.y)/l,r=(n.max.x-n.min.x)/d,u=(n.max.y-n.min.y)/l,p=o-r/2,h=o+r/2,b=a-u/2,v=a+u/2,f=t.getRectLine(p,h,b,v);s.add(f)}))}}var u=an.objects.get(this.dotTlName);if(void 0!==u){var p=new E.F(e.min.x-n.x,e.min.y-n.y,e.min.z-n.z);u.position.set(n.x+p.x,n.y+p.y,n.z+p.z)}var h=an.objects.get(this.dotTrName);if(void 0!==h){var b=new E.F(e.max.x-n.x,e.min.y-n.y,e.min.z-n.z);h.position.set(n.x+b.x,n.y+b.y,n.z+b.z)}var v=an.objects.get(this.dotBlName);if(void 0!==v){var f=new E.F(e.min.x-n.x,e.max.y-n.y,e.min.z-n.z);v.position.set(n.x+f.x,n.y+f.y,n.z+f.z)}var j=an.objects.get(this.dotBrName);if(void 0!==j){var g=new E.F(e.max.x-n.x,e.max.y-n.y,e.min.z-n.z);j.position.set(n.x+g.x,n.y+g.y,n.z+g.z)}}}]),e}(),Mt=function(){function e(){Object(me.a)(this,e),this.frustum=new E.j,this.center=new E.F,this.tmpPoint=new E.F,this.vecNear=new E.F,this.vecTopLeft=new E.F,this.vecTopRight=new E.F,this.vecDownRight=new E.F,this.vecDownLeft=new E.F,this.vecFarTopLeft=new E.F,this.vecFarTopRight=new E.F,this.vecFarDownRight=new E.F,this.vecFarDownLeft=new E.F,this.vectemp1=new E.F,this.vectemp2=new E.F,this.vectemp3=new E.F,this.startPoint=void 0,this.endPoint=void 0,this.collection=void 0,this.deep=Number.MAX_VALUE,this.camera=void 0,this.scene=void 0,this.selectedIds=void 0,this.startPoint=new E.F,this.endPoint=new E.F,this.collection=[],this.selectedIds=[]}return Object(ye.a)(e,[{key:"setCamera",value:function(e){this.camera=e}},{key:"setScene",value:function(e){this.scene=e}},{key:"select",value:function(e,t){return this.startPoint=null!==e&&void 0!==e?e:this.startPoint,this.endPoint=null!==t&&void 0!==t?t:this.endPoint,this.collection=[],this.scene?(this.selectedIds=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(this.frustum,this.scene),this.selectedIds=[],this.collection):this.collection}},{key:"selectIds",value:function(e,t){return this.startPoint=null!==e&&void 0!==e?e:this.startPoint,this.endPoint=null!==t&&void 0!==t?t:this.endPoint,this.collection=[],this.scene?(this.selectedIds=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(this.frustum,this.scene),this.selectedIds):this.collection}},{key:"updateFrustum",value:function(e,t){if(this.camera){var n=null!==e&&void 0!==e?e:this.startPoint,i=null!==t&&void 0!==t?t:this.endPoint;if(n.x===i.x&&(i.x+=Number.EPSILON),n.y===i.y&&(i.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isOrthographicCamera){var o=Math.min(n.x,i.x),a=Math.max(n.y,i.y),s=Math.max(n.x,i.x),r=Math.min(n.y,i.y);this.vecTopLeft.set(o,a,-1),this.vecTopRight.set(s,a,-1),this.vecDownRight.set(s,r,-1),this.vecDownLeft.set(o,r,-1),this.vecFarTopLeft.set(o,a,1),this.vecFarTopRight.set(s,a,1),this.vecFarDownRight.set(s,r,1),this.vecFarDownLeft.set(o,r,1),this.vecTopLeft.unproject(this.camera),this.vecTopRight.unproject(this.camera),this.vecDownRight.unproject(this.camera),this.vecDownLeft.unproject(this.camera),this.vecFarTopLeft.unproject(this.camera),this.vecFarTopRight.unproject(this.camera),this.vecFarDownRight.unproject(this.camera),this.vecFarDownLeft.unproject(this.camera);var c=this.frustum.planes;c[0].setFromCoplanarPoints(this.vecTopLeft,this.vecFarTopLeft,this.vecFarTopRight),c[1].setFromCoplanarPoints(this.vecTopRight,this.vecFarTopRight,this.vecFarDownRight),c[2].setFromCoplanarPoints(this.vecFarDownRight,this.vecFarDownLeft,this.vecDownLeft),c[3].setFromCoplanarPoints(this.vecFarDownLeft,this.vecFarTopLeft,this.vecTopLeft),c[4].setFromCoplanarPoints(this.vecTopRight,this.vecDownRight,this.vecDownLeft),c[5].setFromCoplanarPoints(this.vecFarDownRight,this.vecFarTopRight,this.vecFarTopLeft),c[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}}},{key:"searchChildInFrustum",value:function(e,t){if((t.isMesh||t.isLine||t.isPoints)&&void 0!==t.material){var n,i=t.userData,o=null!==(n=null===i||void 0===i?void 0:i.id)&&void 0!==n?n:void 0;if(void 0!==o){var a,s=null!==(a=null===i||void 0===i?void 0:i.objectType)&&void 0!==a?a:void 0;if(!0===(s===g.Bead||s===g.Region||s===g.Group||s===g.PreviewProject3D)){var r=(new E.a).setFromObject(t);e.intersectsBox(r)&&!1===this.selectedIds.includes(o)&&(this.collection.push(t),this.selectedIds.push(o))}}}if(t.children&&t.children.length>0)for(var c=0;c<t.children.length;c++)this.searchChildInFrustum(e,t.children[c])}}]),e}(),Rt=function(){function e(){Object(me.a)(this,e),this.isCameraGrabed=void 0,this.startDragMousePosition=void 0,this.startDragCamera=void 0,this.boundingClientRect=void 0,this.isCameraGrabed=!1,this.startDragMousePosition=new E.E,this.startDragCamera=new E.E}return Object(ye.a)(e,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){if(null!==an.el&&(this.boundingClientRect=an.el.getBoundingClientRect()),void 0===this.boundingClientRect)return[];this.isCameraGrabed=!0,this.boundingClientRect=an.el.getBoundingClientRect();var t=this.boundingClientRect,n=t.top,i=t.left,o=e.clientX-i,a=e.clientY-n;this.startDragMousePosition.x=o,this.startDragMousePosition.y=a,this.startDragCamera.x=an.camera.position.x,this.startDragCamera.y=an.camera.position.y}},{key:"onMove",value:function(e){if(void 0!==this.boundingClientRect&&!0===this.isCameraGrabed){var t=he(),n=this.boundingClientRect,i=n.top,o=n.left,a=e.clientX-o,s=e.clientY-i,r=t.ui.zoomScale,c=(this.startDragMousePosition.x-a)*r,d=(this.startDragMousePosition.y-s)*r,l=this.startDragCamera.x+c,u=this.startDragCamera.y-d;an.camera.position.x=l,an.camera.position.y=u,an.camera.lookAt(l,u,0)}}},{key:"onUp",value:function(e){this.boundingClientRect=void 0,!0===this.isCameraGrabed&&(this.isCameraGrabed=!1)}}]),e}();!function(e){e.moveCamera="moveCamera",e.moveAllSelectedObjects="moveAllSelectedObjects",e.moveSelectBBox="moveSelectBBox",e.editSelectBBox="editSelectBBox",e.moveObjectGroup="moveObjectGroup",e.moveSingleObject="moveSingleObject",e.selectMultipleObjects="selectMultipleObjects",e.deselectMultipleObjects="deselectMultipleObjects"}(Ct||(Ct={}));var At,Nt=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;return Object(me.a)(this,n),(e=t.call(this)).actionType=void 0,e.mouseDragHelper=void 0,e.selectionBox=void 0,e.mouseSelectionHelper=void 0,e.prevEditBBox=void 0,e.mouseEventsIdle=void 0,e.mouseDragHelper=new ct,e.mouseSelectionHelper=new pt,e.mouseSelectionHelper.setRenderer(an.renderer),e.selectionBox=new Mt,e.selectionBox.setCamera(an.camera),e.selectionBox.setScene(an.scene),e.mouseEventsIdle=new Rt,e.actionType=void 0,e}return Object(ye.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){if(le("MouseEventsEditorModeSelectOrMove: jak z kliknieciem???",Object.keys(mt),St("space")),St("space")){this.actionType=Ct.moveCamera;var t=On(e.clientX,e.clientY),n=t.x,i=t.y;return this.mouseDragHelper.onDown(n,i),this.mouseEventsIdle.onDown(e),void le("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}if(e.altKey){this.actionType=Ct.deselectMultipleObjects;var o=On(e.clientX,e.clientY),a=o.x,s=o.y;if(this.mouseDragHelper.onDown(a,s),null!==an.el&&(this.boundingClientRect=an.el.getBoundingClientRect()),void 0===this.boundingClientRect)return;var r=this.boundingClientRect,c=r.top,d=r.left,l=r.width,u=r.height,p=e.clientX-d,h=e.clientY-c;return this.mouseSelectionHelper.onDown(p,h),this.selectionBox.startPoint.set((e.clientX-d)/l*2-1,-(e.clientY-c)/u*2+1,0),void le("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}if(e.shiftKey){this.actionType=Ct.selectMultipleObjects;var b=On(e.clientX,e.clientY),v=b.x,f=b.y;if(this.mouseDragHelper.onDown(v,f),null!==an.el&&(this.boundingClientRect=an.el.getBoundingClientRect()),void 0===this.boundingClientRect)return;var j=this.boundingClientRect,m=j.top,y=j.left,x=j.width,O=j.height,w=e.clientX-y,k=e.clientY-m;return this.mouseSelectionHelper.onDown(w,k),this.selectionBox.startPoint.set((e.clientX-y)/x*2-1,-(e.clientY-m)/O*2+1,0),void le("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}this.actionType=void 0;var D=this.getIntersect(e.clientX,e.clientY),S=Bt();if(S.isHandle(D)){this.actionType=Ct.editSelectBBox;var E=On(e.clientX,e.clientY),I=E.x,C=E.y;return this.mouseDragHelper.onDown(I,C),void S.onDownEdit(D)}if(this.intersects=D.filter((function(e){var t,n=e.object.userData,i=null!==(t=null===n||void 0===n?void 0:n.objectType)&&void 0!==t?t:void 0;return i===g.Bead||i===g.Region||i===g.Group||i===g.PreviewProject3D})),this.intersects.length>0){var T=he(),_=this.intersects[0].object.userData,B=_.id,P=T.selectedIds.includes(B),M=!1;if(T.selectedIds.forEach((function(e){!0===T.objects[e].isLocked&&(M=!0)})),!0===_.isLocked)ei(this.getSelectionForSingleObjectIdAction(B));else if(!0===M)ei(this.getSelectionForSingleObjectIdAction(B));else if(P){this.actionType=Ct.moveAllSelectedObjects;var R=On(e.clientX,e.clientY),A=R.x,N=R.y;this.mouseDragHelper.onDown(A,N),S.onDownMove()}else{var z=void 0!==_.objectType&&_.objectType===g.Group,L=void 0!==_.groupId&&_.groupId.length>0,H=z||L;this.actionType=H?Ct.moveObjectGroup:Ct.moveSingleObject;var U=On(e.clientX,e.clientY),F=U.x,G=U.y;this.mouseDragHelper.onDown(F,G)}}else if(S.isChild(D)){this.actionType=Ct.moveSelectBBox;var Y=On(e.clientX,e.clientY),X=Y.x,W=Y.y;this.mouseDragHelper.onDown(X,W),S.onDownMove()}else{this.actionType=Ct.moveCamera;var V=On(e.clientX,e.clientY),Z=V.x,K=V.y;this.mouseDragHelper.onDown(Z,K),this.mouseEventsIdle.onDown(e)}le("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}},{key:"onMove",value:function(e){if(void 0!==this.actionType){if(this.actionType===Ct.moveCamera){var t=On(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onMove(n,i),this.mouseEventsIdle.onMove(e),this.updateUIAtMove(!1)}this.actionType===Ct.moveAllSelectedObjects&&this.moveAllSelectedObjects(e.clientX,e.clientY),this.actionType===Ct.moveSingleObject&&this.moveSingleObject(e.clientX,e.clientY),this.actionType===Ct.moveObjectGroup&&this.moveObjectGroup(e.clientX,e.clientY),this.actionType===Ct.selectMultipleObjects&&this.selectMultipleObjects(e.clientX,e.clientY,!0),this.actionType===Ct.deselectMultipleObjects&&this.selectMultipleObjects(e.clientX,e.clientY,!1);var o=Bt();if(this.actionType===Ct.editSelectBBox){this.updateUIAtMove(!1);var a=On(e.clientX,e.clientY),s=a.x,r=a.y;this.mouseDragHelper.onMove(s,r);var c=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,d=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y;o.onMoveEdit(c,d)}if(this.actionType===Ct.moveSelectBBox){this.moveAllSelectedObjects(e.clientX,e.clientY),this.updateUIAtMove(!1);var l=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,u=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y;o.onMoveMove(l,u)}}}},{key:"onUp",value:function(e){if(void 0!==this.actionType){if(this.actionType===Ct.moveCamera){if(this.mouseEventsIdle.onUp(e),!1===this.mouseDragHelper.isDragged){var t=he(),n={name:$.ChangeSelectObjects,payload:{change:t.selectedIds.map((function(e){return{id:e,isSelected:!1}}))}};ei(n)}else{this.updateUIAtMove(!0);var i=he(),o=Object(we.produce)(i,(function(e){var t=Sn(i.selectedIds.map((function(e){return{id:e,objectType:i.objects[e].objectType}})));e.ui.selectedTopBarPosition=t}));be(o),vt(o)}this.mouseDragHelper.onUp()}if(this.actionType===Ct.moveObjectGroup){var a=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,s=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y;if(0!==Math.abs(s)||0!==Math.abs(s)){var r,c,d,l,u,p=null!==(r=null===(c=this.intersects)||void 0===c||null===(d=c[0])||void 0===d||null===(l=d.object)||void 0===l||null===(u=l.userData)||void 0===u?void 0:u.id)&&void 0!==r?r:void 0;if(void 0!==p){var h=this.getIdsFromGroupOrInGroup(p);ei(this.getMoveObjectsAction([p].concat(Object(dt.a)(h)),a,s))}}if(!1===this.mouseDragHelper.isDragged){var b,v,f,j,g,m=null!==(b=null===(v=this.intersects)||void 0===v||null===(f=v[0])||void 0===f||null===(j=f.object)||void 0===j||null===(g=j.userData)||void 0===g?void 0:g.id)&&void 0!==b?b:void 0;if(void 0!==m)if(St("controlleft")||St("controlright")||St("shiftleft")||St("shiftright")){var y=he(),x=void 0!==y.objects[m]&&!0===y.objects[m].isLocked,O=!1;y.selectedIds.forEach((function(e){!0===y.objects[e].isLocked&&(O=!0)})),!0===O||!1===x&&ei(this.getSelectionAppendAction([m],void 0,!1))}else{var w=he();if(0===w.selectedIds.length)ei(this.getSelectionForSingleObjectIdAction(m));else{var k=void 0!==w.objects[m]&&!0===w.objects[m].isLocked,D=!1;w.selectedIds.forEach((function(e){!0===w.objects[e].isLocked&&(D=!0)})),!0===D||!1===k&&ei(this.getSelectionForSingleObjectIdAction(m))}}le("MouseEventsEditorModeSelectOrMove: zaznaczam group")}this.updateUIAtMove(!0),this.mouseDragHelper.onUp()}if(this.actionType===Ct.moveSingleObject){var S=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,E=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y;if(0!==Math.abs(E)||0!==Math.abs(E)){var I,C,T,_,B,P=null!==(I=null===(C=this.intersects)||void 0===C||null===(T=C[0])||void 0===T||null===(_=T.object)||void 0===_||null===(B=_.userData)||void 0===B?void 0:B.id)&&void 0!==I?I:void 0;void 0!==P&&ei(this.getMoveObjectsAction([P],S,E))}if(!1===this.mouseDragHelper.isDragged){var M,R,A,N,z,L=null!==(M=null===(R=this.intersects)||void 0===R||null===(A=R[0])||void 0===A||null===(N=A.object)||void 0===N||null===(z=N.userData)||void 0===z?void 0:z.id)&&void 0!==M?M:void 0;if(void 0!==L)if(St("controlleft")||St("controlright")||St("shiftleft")||St("shiftright")){var H=he(),U=void 0!==H.objects[L]&&!0===H.objects[L].isLocked,F=!1;H.selectedIds.forEach((function(e){!0===H.objects[e].isLocked&&(F=!0)})),!0===F||!1===U&&ei(this.getSelectionAppendAction([L],void 0,!0))}else{var G=he();if(0===G.selectedIds.length)ei(this.getSelectionForSingleObjectIdAction(L));else{var Y=void 0!==G.objects[L]&&!0===G.objects[L].isLocked,X=!1;G.selectedIds.forEach((function(e){!0===G.objects[e].isLocked&&(X=!0)})),!0===X||!1===Y&&ei(this.getSelectionForSingleObjectIdAction(L))}}le("MouseEventsEditorModeSelectOrMove: zaznaczam single object")}this.updateUIAtMove(!0),this.mouseDragHelper.onUp()}if(this.actionType===Ct.moveAllSelectedObjects){var W=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,V=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y;if(0!==Math.abs(V)||0!==Math.abs(V)){var Z=he();ei(this.getMoveObjectsAction(Z.selectedIds,W,V))}if(St("controlleft")||St("controlright")||St("shiftleft")||St("shiftright")){var K,q,J,Q,ee,te=null!==(K=null===(q=this.intersects)||void 0===q||null===(J=q[0])||void 0===J||null===(Q=J.object)||void 0===Q||null===(ee=Q.userData)||void 0===ee?void 0:ee.id)&&void 0!==K?K:void 0;ei(this.getSelectionAppendAction([te],void 0,!1))}this.mouseDragHelper.onUp(),Bt().onUpMove(),this.updateUIAtMove(!0)}if(this.actionType===Ct.selectMultipleObjects){if(St("shiftleft")||St("shiftright"))if(!1===this.mouseDragHelper.isDragged){if(this.intersects=this.getActiveObjectsFromIntersect(e.clientX,e.clientY),this.intersects.length>0){var ne=this.intersects[0].object.userData.id;if(void 0!==ne){var ie=he(),oe=void 0!==ie.objects[ne]&&!0===ie.objects[ne].isLocked,ae=!1;ie.selectedIds.forEach((function(e){!0===ie.objects[e].isLocked&&(ae=!0)})),!0===ae||!1===oe&&ei(this.getSelectionAppendAction([ne],void 0,!1))}}this.intersects=[]}else if(void 0!==this.boundingClientRect){var se=this.boundingClientRect,re=se.top,ce=se.left,de=se.width,ue=se.height;this.selectionBox.endPoint.set((e.clientX-ce)/de*2-1,-(e.clientY-re)/ue*2+1,1);var pe=he(),ve=!1;if(pe.selectedIds.forEach((function(e){!0===pe.objects[e].isLocked&&(ve=!0)})),!0===ve);else{var fe=this.selectionBox.selectIds();ei(this.getSelectionAppendAction(fe,!0,!1))}}this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}if(this.actionType===Ct.deselectMultipleObjects){if(St("altleft")||St("altright"))if(!1===this.mouseDragHelper.isDragged){if(this.intersects=this.getActiveObjectsFromIntersect(e.clientX,e.clientY),this.intersects.length>0){var je=this.intersects[0].object.userData.id;void 0!==je&&ei(this.getSelectionAppendAction([je],!1,!0))}this.intersects=[]}else if(void 0!==this.boundingClientRect){var ge=this.boundingClientRect,me=ge.top,ye=ge.left,xe=ge.width,Oe=ge.height;this.selectionBox.endPoint.set((e.clientX-ye)/xe*2-1,-(e.clientY-me)/Oe*2+1,1);var ke=this.selectionBox.selectIds();ei(this.getSelectionAppendAction(ke,!1,!1))}this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}var De=Bt();if(this.actionType===Ct.editSelectBBox&&(this.updateUIAtMove(!0),De.onUpEdit()),this.actionType===Ct.moveSelectBBox){this.updateUIAtMove(!0);var Se=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,Ee=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,Ie=he();if(ei(this.getMoveObjectsAction(Ie.selectedIds,Se,Ee)),De.onUpMove(),this.mouseDragHelper.onUp(),Math.abs(Se)<.5&&Math.abs(Ee)<.5){var Ce=he(),Te={name:$.ChangeSelectObjects,payload:{change:Ce.selectedIds.map((function(e){return{id:e,isSelected:!1}}))}};ei(Te)}}this.actionType=void 0}}},{key:"getMoveObjectsAction",value:function(e,t,n){var i=this,o=he(),a=[],s=[];return e.forEach((function(e){var r=i.getIdsFromGroupOrInGroup(e);void 0!==o.objects[e]&&!1===a.includes(e)&&(a.push(e),s.push({id:e,properties:{position:{x:o.objects[e].position.x+t,y:o.objects[e].position.y+n,z:o.objects[e].position.z}}})),r.forEach((function(i){void 0!==o.objects[i]&&!1===a.includes(e)&&(a.push(e),s.push({id:i,properties:{position:{x:o.objects[i].position.x+t,y:o.objects[i].position.y+n,z:o.objects[e].position.z}}}))}))})),{name:$.ChangeObjectsProperty,payload:{changes:s}}}},{key:"getSelectionForSingleObjectIdAction",value:function(e){var t=this,n=he(),i=[];return n.selectedIds.forEach((function(e){var n=t.getIdsFromGroupOrInGroup(e);i.push({id:e,isSelected:!1}),n.forEach((function(e){i.push({id:e,isSelected:!1})}))})),i.push({id:e,isSelected:!0}),this.getIdsFromGroupOrInGroup(e).forEach((function(e){i.push({id:e,isSelected:!0})})),{name:$.ChangeSelectObjects,payload:{change:i}}}},{key:"getSelectionAppendAction",value:function(e,t,n){var i=this,o=he(),a=[],s=null!==n&&void 0!==n&&n;return e.forEach((function(e){var n=void 0!==o.objects[e]&&!0===o.objects[e].isLocked;if(!0===s||!1===s&&!1===n){var r=!0===o.selectedIds.includes(e),c=void 0===t?!r:t,d=i.getIdsFromGroupOrInGroup(e);a.push({id:e,isSelected:c}),d.forEach((function(e){a.push({id:e,isSelected:c})}))}})),{name:$.ChangeSelectObjects,payload:{change:a}}}},{key:"selectMultipleObjects",value:function(e,t,n){var i=On(e,t),o=i.x,a=i.y;if(this.mouseDragHelper.onMove(o,a),void 0!==this.boundingClientRect){var s=this.boundingClientRect,r=s.top,c=e-s.left,d=t-r;this.mouseSelectionHelper.onMove(c,d)}}},{key:"moveSingleObject",value:function(e,t){var n=he(),i=On(e,t),o=i.x,a=i.y;this.mouseDragHelper.onMove(o,a);var s=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,r=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,c=this.intersects[0].object.userData,d=c.id;if(void 0!==d){var l=an.objects.get(d);if(void 0!==l){if(n.objects[d].objectType===g.Region){var u=n.objects[d];!0===u.snapBeadsToCell&&u.childrenGridIds.length>0&&u.childrenGridIds.forEach((function(e){if(void 0!==e&&void 0!==n.objects[e]){var t=n.objects[e];if(void 0===t)return void de("object not exists in app",d);var i=an.objects.get(t.id);if(void 0===i)return void de("object not found in app scene for id",d);i.position.x=n.objects[e].position.x+s,i.position.y=n.objects[e].position.y+r}}))}l.position.x=n.objects[d].position.x+s,l.position.y=n.objects[d].position.y+r,this.updateUIAtMove(!1)}else de("object not found in app state for id",d,c)}else de("objectId not found in clicked item",c)}},{key:"moveObjectGroup",value:function(e,t){var n=he(),i=On(e,t),o=i.x,a=i.y;this.mouseDragHelper.onMove(o,a);var s=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,r=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,c=this.intersects[0].object.userData,d=c.id;if(void 0!==d){var l=n.objects[d];if(void 0!==l){void 0!==l.groupId&&l.groupId.length>0&&(d=l.groupId,l=n.objects[d]);var u=an.objects.get(d);void 0!==u?(u.position.x=n.objects[d].position.x+s,u.position.y=n.objects[d].position.y+r,l.childrenIds.forEach((function(e){var t=n.objects[e];if(void 0!==t){var i=an.objects.get(t.id);void 0!==i?(i.position.x=n.objects[e].position.x+s,i.position.y=n.objects[e].position.y+r):de("object not found in app scene for id",e)}else de("object not exists in app",e)})),this.updateUIAtMove(!1)):de("object not found in app state for id",d)}else de("objectId not found in app store",d)}else de("objectId not found in clicked item",c)}},{key:"moveAllSelectedObjects",value:function(e,t){var n=On(e,t),i=n.x,o=n.y;this.mouseDragHelper.onMove(i,o);var a=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,s=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,r=he();r.selectedIds.forEach((function(e){if(void 0!==r.objects[e]){var t=an.objects.get(e);if(void 0!==t){if(r.objects[e].objectType===g.Region){var n=r.objects[e];!0===n.snapBeadsToCell&&n.childrenGridIds.length>0&&n.childrenGridIds.forEach((function(t){if(void 0!==t&&void 0!==r.objects[t]){if(void 0===r.objects[t])return void de("object not exists in app",e);var n=an.objects.get(e);if(void 0===n)return void de("object not found in app scene for id",e);n.position.x=r.objects[t].position.x+a,n.position.y=r.objects[t].position.y+s}}))}t.position.x=r.objects[e].position.x+a,t.position.y=r.objects[e].position.y+s}else de("object not found in app scene for id",e)}else de("object not exists in app",e)})),Bt().onMoveMove(a,s),this.updateUIAtMove(!1)}},{key:"updateUIAtMove",value:function(e){!1===e?this.hideTopBar():this.showTopBar()}},{key:"hideTopBar",value:function(){var e=document.querySelector(".selected-objects-top-bar");null!==e&&(e.style.display="none")}},{key:"showTopBar",value:function(){var e=document.querySelector(".selected-objects-top-bar");null!==e&&(e.style.display="block")}}]),n}(lt),zt=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;return Object(me.a)(this,n),(e=t.call(this)).isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new E.E,e.startDragCamera=new E.E,e}return Object(ye.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){if(this.isCameraGrabed=!0,null!==an.el){this.boundingClientRect=an.el.getBoundingClientRect();var t=this.boundingClientRect,n=t.top,i=t.left,o=e.clientX-i,a=e.clientY-n;this.startDragMousePosition.x=o,this.startDragMousePosition.y=a,this.startDragCamera.x=an.camera.position.x,this.startDragCamera.y=an.camera.position.y}}},{key:"onMove",value:function(e){if(void 0!==this.boundingClientRect&&!0===this.isCameraGrabed){var t=(0,rt.getState)(),n=this.boundingClientRect,i=n.top,o=n.left,a=e.clientX-o,s=e.clientY-i,r=t.ui.zoomScale,c=(this.startDragMousePosition.x-a)*r,d=(this.startDragMousePosition.y-s)*r,l=this.startDragCamera.x+c,u=this.startDragCamera.y-d;an.camera.position.x=l,an.camera.position.y=u,an.camera.lookAt(l,u,0)}}},{key:"onUp",value:function(e){this.boundingClientRect=void 0,!0===this.isCameraGrabed&&(this.isCameraGrabed=!1)}}]),n}(lt),Lt=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;return Object(me.a)(this,n),(e=t.call(this)).isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.mouseDragHelper=void 0,e.mouse=void 0,e.raycaster=void 0,e.touchedIds=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new E.E,e.startDragCamera=new E.E,e.mouseDragHelper=new ct,e.mouse=new E.E,e.raycaster=new E.B,e.touchedIds=[],e}return Object(ye.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){null!==an.el&&(this.boundingClientRect=an.el.getBoundingClientRect()),this.touchedIds=[];var t=On(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onDown(n,i),this.touchBead(e.clientX,e.clientY)}},{key:"onMove",value:function(e){if(!0===this.mouseDragHelper.isDragStarted){var t=On(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onMove(n,i),this.touchBead(e.clientX,e.clientY)}}},{key:"onUp",value:function(e){if(this.touchedIds.length>0){ei({name:$.ChangeObjectsProperty,payload:{changes:this.touchedIds.map((function(e){return{id:e,properties:{color:"pink"}}}))}})}this.mouseDragHelper.onUp()}},{key:"touchBead",value:function(e,t){var n=this;if(void 0!==this.boundingClientRect){var i=this.boundingClientRect,o=i.width,a=i.height,s=i.top,r=i.left;this.mouse.x=(e-r)/o*2-1,this.mouse.y=-(t-s)/a*2+1,this.raycaster.setFromCamera(this.mouse,an.camera);var c=this.raycaster.intersectObjects(an.scene.children,!0);if(c.length>0){var d=he(),l=new Set;c.forEach((function(e){var t,n,i=null!==(t=null===(n=e.object.userData)||void 0===n?void 0:n.id)&&void 0!==t?t:void 0;void 0!==i&&void 0!==d.objects[i]&&d.objects[i].objectType===g.Bead&&!1===l.has(i)&&l.add(i)}));var u=Array.from(l);if(u.length>0){u.forEach((function(e){n.touchedIds.push(e),void 0!==d.objects[e]&&Cn(d.objects[e],d.selectedIds,"pink")}))}}}}}]),n}(lt);!function(e){e.moveCamera="moveCamera",e.selectMultipleObjects="selectMultipleObjects",e.deselectMultipleObjects="deselectMultipleObjects"}(At||(At={}));var Ht,Ut,Ft,Gt,Yt,Xt,Wt,Vt=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;return Object(me.a)(this,n),(e=t.call(this)).actionType=void 0,e.isCameraGrabed=void 0,e.startDragMousePosition=void 0,e.startDragCamera=void 0,e.boundingClientRect=void 0,e.mouseDragHelper=void 0,e.mouse=void 0,e.raycaster=void 0,e.selectionBox=void 0,e.mouseSelectionHelper=void 0,e.prevEditBBox=void 0,e.mouseEventsIdle=void 0,e.boundingClientRect=void 0,e.isCameraGrabed=!1,e.startDragMousePosition=new E.E,e.startDragCamera=new E.E,e.mouseDragHelper=new ct,e.mouse=new E.E,e.raycaster=new E.B,e.mouseSelectionHelper=new pt,e.mouseSelectionHelper.setRenderer(an.renderer),e.selectionBox=new Mt,e.selectionBox.setCamera(an.camera),e.selectionBox.setScene(an.scene),e.mouseEventsIdle=new Rt,e.actionType=void 0,e}return Object(ye.a)(n,[{key:"onWheel",value:function(e){}},{key:"onResize",value:function(e){}},{key:"onDown",value:function(e){if(St("space")){this.actionType=At.moveCamera;var t=On(e.clientX,e.clientY),n=t.x,i=t.y;return this.mouseDragHelper.onDown(n,i),this.mouseEventsIdle.onDown(e),void le("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}if(e.altKey){this.actionType=At.deselectMultipleObjects;var o=On(e.clientX,e.clientY),a=o.x,s=o.y;if(this.mouseDragHelper.onDown(a,s),null!==an.el&&(this.boundingClientRect=an.el.getBoundingClientRect()),void 0===this.boundingClientRect)return;var r=this.boundingClientRect,c=r.top,d=r.left,l=r.width,u=r.height,p=e.clientX-d,h=e.clientY-c;return this.mouseSelectionHelper.onDown(p,h),this.selectionBox.startPoint.set((e.clientX-d)/l*2-1,-(e.clientY-c)/u*2+1,0),void le("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}this.actionType=At.selectMultipleObjects;var b=On(e.clientX,e.clientY),v=b.x,f=b.y;if(this.mouseDragHelper.onDown(v,f),null!==an.el&&(this.boundingClientRect=an.el.getBoundingClientRect()),void 0!==this.boundingClientRect){var j=this.boundingClientRect,g=j.top,m=j.left,y=j.width,x=j.height,O=e.clientX-m,w=e.clientY-g;this.mouseSelectionHelper.onDown(O,w),this.selectionBox.startPoint.set((e.clientX-m)/y*2-1,-(e.clientY-g)/x*2+1,0),le("MouseEventsEditorModeSelectOrMove: onDown action type",this.actionType)}}},{key:"onMove",value:function(e){if(void 0!==this.actionType){if(this.actionType===At.moveCamera){var t=On(e.clientX,e.clientY),n=t.x,i=t.y;this.mouseDragHelper.onMove(n,i),this.mouseEventsIdle.onMove(e),this.updateUIAtMove(!1)}this.actionType===At.selectMultipleObjects&&this.selectMultipleObjects(e.clientX,e.clientY,!0),this.actionType===At.deselectMultipleObjects&&this.selectMultipleObjects(e.clientX,e.clientY,!1)}}},{key:"onUp",value:function(e){if(this.actionType===At.selectMultipleObjects){if(!1===this.mouseDragHelper.isDragged){if(this.intersects=this.getActiveObjectsFromIntersect(e.clientX,e.clientY),this.intersects.length>0){var t=this.intersects[0].object.userData.id;if(void 0!==t){var n=he(),i=void 0!==n.objects[t]&&!0===n.objects[t].isLocked,o=!1;n.selectedIds.forEach((function(e){!0===n.objects[e].isLocked&&(o=!0)})),!0===o||!1===i&&ei(this.getSelectionAppendAction([t],void 0,!1))}}this.intersects=[]}else if(void 0!==this.boundingClientRect){var a=this.boundingClientRect,s=a.top,r=a.left,c=a.width,d=a.height;this.selectionBox.endPoint.set((e.clientX-r)/c*2-1,-(e.clientY-s)/d*2+1,1);var l=he(),u=!1;if(l.selectedIds.forEach((function(e){!0===l.objects[e].isLocked&&(u=!0)})),!0===u);else{var p=this.selectionBox.selectIds();ei(this.getSelectionAppendAction(p,!0,!1))}}this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}if(this.actionType===At.deselectMultipleObjects){if(St("altleft")||St("altright"))if(!1===this.mouseDragHelper.isDragged){if(this.intersects=this.getActiveObjectsFromIntersect(e.clientX,e.clientY),this.intersects.length>0){var h=this.intersects[0].object.userData.id;void 0!==h&&ei(this.getSelectionAppendAction([h],!1,!0))}this.intersects=[]}else if(void 0!==this.boundingClientRect){var b=this.boundingClientRect,v=b.top,f=b.left,j=b.width,g=b.height;this.selectionBox.endPoint.set((e.clientX-f)/j*2-1,-(e.clientY-v)/g*2+1,1);var m=this.selectionBox.selectIds();ei(this.getSelectionAppendAction(m,!1,!1))}this.mouseDragHelper.onUp(),this.mouseSelectionHelper.onUp()}}},{key:"getSelectionAppendAction",value:function(e,t,n){var i=this,o=he(),a=[],s=null!==n&&void 0!==n&&n;return e.forEach((function(e){var n=void 0!==o.objects[e]&&!0===o.objects[e].isLocked;if(!0===s||!1===s&&!1===n){var r=!0===o.selectedIds.includes(e),c=void 0===t?!r:t,d=i.getIdsFromGroupOrInGroup(e);a.push({id:e,isSelected:c}),d.forEach((function(e){a.push({id:e,isSelected:c})}))}})),{name:$.ChangeSelectObjects,payload:{change:a}}}},{key:"selectMultipleObjects",value:function(e,t,n){var i=On(e,t),o=i.x,a=i.y;if(this.mouseDragHelper.onMove(o,a),void 0!==this.boundingClientRect){var s=this.boundingClientRect,r=s.top,c=e-s.left,d=t-r;this.mouseSelectionHelper.onMove(c,d)}}},{key:"moveSingleObject",value:function(e,t){var n=he(),i=On(e,t),o=i.x,a=i.y;this.mouseDragHelper.onMove(o,a);var s=this.mouseDragHelper.end.x-this.mouseDragHelper.start.x,r=this.mouseDragHelper.end.y-this.mouseDragHelper.start.y,c=this.intersects[0].object.userData,d=c.id;if(void 0!==d){var l=an.objects.get(d);if(void 0!==l){if(n.objects[d].objectType===g.Region){var u=n.objects[d];!0===u.snapBeadsToCell&&u.childrenGridIds.length>0&&u.childrenGridIds.forEach((function(e){if(void 0!==e&&void 0!==n.objects[e]){var t=n.objects[e];if(void 0===t)return void de("object not exists in app",d);var i=an.objects.get(t.id);if(void 0===i)return void de("object not found in app scene for id",d);i.position.x=n.objects[e].position.x+s,i.position.y=n.objects[e].position.y+r}}))}l.position.x=n.objects[d].position.x+s,l.position.y=n.objects[d].position.y+r,this.updateUIAtMove(!1)}else de("object not found in app state for id",d,c)}else de("objectId not found in clicked item",c)}},{key:"updateUIAtMove",value:function(e){!1===e?this.hideTopBar():this.showTopBar()}},{key:"hideTopBar",value:function(){var e=document.querySelector(".selected-objects-top-bar");null!==e&&(e.style.display="none")}},{key:"showTopBar",value:function(){var e=document.querySelector(".selected-objects-top-bar");null!==e&&(e.style.display="block")}}]),n}(lt),Zt=void 0,Kt=function(e,t){if(e&&t){var n=new E.E;n.x=e,n.y=t,Zt=n}else Zt=void 0};function qt(e){if(e.preventDefault(),null!==an.el){var t=he(),n={name:$.ChangeUiSettingsZoom,payload:{zoomType:"zoomByScroll",useAnimation:!1,clientX:e.clientX,clientY:e.clientY,scrollDelta:e.deltaY}};ei(n),t.ui.mode===m.Idle?Ht.onWheel(e):t.ui.mode===m.SelectOrMove?Ut.onWheel(e):t.ui.mode===m.DeleteBeads?Gt.onWheel(e):t.ui.mode===m.PaintBeads?Ft.onWheel(e):t.ui.mode===m.AddRegion?Yt.onWheel(e):t.ui.mode===m.AddBeads?Xt.onWheel(e):t.ui.mode===m.SelectMultiple&&Wt.onWheel(e)}}function Jt(e){if(null!==an.el){var t=an.el.getBoundingClientRect(),n=t.width,i=t.height;an.camera.left=n/-2,an.camera.right=n/2,an.camera.top=i/2,an.camera.bottom=i/-2,an.camera.updateProjectionMatrix(),an.renderer.setSize(n,i)}var o=he();o.ui.mode===m.Idle?Ht.onResize(e):o.ui.mode===m.SelectOrMove?Ut.onResize(e):o.ui.mode===m.DeleteBeads?Gt.onResize(e):o.ui.mode===m.PaintBeads?Ft.onResize(e):o.ui.mode===m.AddRegion?Yt.onResize(e):o.ui.mode===m.AddBeads?Xt.onResize(e):o.ui.mode===m.SelectMultiple&&Wt.onResize(e)}function $t(e){var t=he();t.ui.mode===m.Idle?Ht.onDown(e):t.ui.mode===m.SelectOrMove?Ut.onDown(e):t.ui.mode===m.DeleteBeads?Gt.onDown(e):t.ui.mode===m.PaintBeads?Ft.onDown(e):t.ui.mode===m.AddRegion?Yt.onDown(e):t.ui.mode===m.AddBeads?Xt.onDown(e):t.ui.mode===m.SelectMultiple&&Wt.onDown(e)}function Qt(e){var t=he();t.ui.mode===m.AddBeads?Xt.onUp(e):t.ui.mode===m.Idle?Ht.onUp(e):t.ui.mode===m.SelectOrMove?Ut.onUp(e):t.ui.mode===m.DeleteBeads?Gt.onUp(e):t.ui.mode===m.PaintBeads?Ft.onUp(e):t.ui.mode===m.AddRegion?Yt.onUp(e):t.ui.mode===m.SelectMultiple&&Wt.onUp(e)}function en(e){Kt(void 0,void 0),Qt(e)}function tn(e){Kt(e.clientX,e.clientY);var t=he();t.ui.mode===m.Idle?Ht.onMove(e):t.ui.mode===m.SelectOrMove?Ut.onMove(e):t.ui.mode===m.PaintBeads?Ft.onMove(e):t.ui.mode===m.AddRegion?Yt.onMove(e):t.ui.mode===m.DeleteBeads?Gt.onMove(e):t.ui.mode===m.AddBeads?Xt.onMove(e):t.ui.mode===m.SelectMultiple&&Wt.onMove(e)}var nn,on,an,sn=function(){var e=an.el.getBoundingClientRect(),t=e.left,n=e.left+10,i=e.top,o=e.top+10,a=On(t,i),s=On(n,o),r=Math.max(a.x,s.x),c=Math.min(a.x,s.x),d=Math.min(a.y,s.y),l=Math.max(a.y,s.y);return{min:{x:c,y:d},max:{x:r,y:l},w:r-c,h:l-d}},rn=function(){function e(){Object(me.a)(this,e),this.events=[],this.index=0,this.maxHistoryRecords=100}return Object(ye.a)(e,[{key:"push",value:function(e){var t=this.events.length;if(t!==this.index&&this.events.splice(this.index,t-this.index),this.events.push(e),this.index+=1,this.events.length>this.maxHistoryRecords){var n=this.events.length-this.maxHistoryRecords;this.events.splice(0,n),this.index=this.index-n}}},{key:"front",value:function(){var e=this.events[this.index];return this.index+=1,this.index>this.events.length&&(this.index=this.events.length),e}},{key:"back",value:function(){var e=this.events[this.index-1];return this.index-=1,this.index<=0&&(this.index=0),e}},{key:"getSimpleHistoryEvents",value:function(){var e=this;return this.events.map((function(t,n){return{name:t.do.name,isActive:n<e.index,createdAt:t.createdAt}}))}},{key:"canRedo",value:function(){return this.index!==this.events.length}},{key:"canUndo",value:function(){return this.index>0}}]),e}(),cn=function(){var e=ln().back();void 0!==e&&ei(e.undo,!1)},dn=function(){var e=ln().front();void 0!==e&&ei(e.redo,!1)},ln=function(){return nn},un=void 0,pn=function(e){un=e},hn=function(){var e={name:$.ClipboardCopy,payload:{}};ei(e)},bn=function(){var e={name:$.ClipboardCut,payload:{}};ei(e)},vn=function(){if(void 0!==un){var e={name:$.ClipboardPaste,payload:{objects:un.objects}};ei(e)}},fn=function(){try{var e=document.createElement("div");e.setAttribute("id","thumbnailsGeneratorRoot"),on=new jn(e),e.appendChild(on.renderer.domElement),e.style.display="none",document.body.appendChild(e)}catch(t){console.error("initThumbnailsGenerator err:",t.toString())}},jn=function(){function e(t){Object(me.a)(this,e),this.el=void 0,this.scene=void 0,this.renderer=void 0,this.cache=void 0,this.el=t,this.cache={},this.scene=new E.C,this.scene.background=new E.e("#fff"),this.renderer=new E.G({antialias:!0,preserveDrawingBuffer:!0})}return Object(ye.a)(e,[{key:"getObjectThumbnail",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o={imgWidth:t,imgHeight:n,width:e.width,height:e.height,depth:e.depth,rotateX:e.rotateX,rotateY:e.rotateY,rotateZ:e.rotateZ};e.objectType===g.Bead&&(o.type=e.type,o.color=e.color);var a=JSON.stringify(o);if(!0===i||void 0===this.cache[a]){var s=this.createObjectThumbnail(e,t,n);if(void 0===s)return;this.cache[a]=s}return this.cache[a]}},{key:"createObjectThumbnail",value:function(e,t,n){var i=this;try{if(this.renderer.setSize(t,n),this.scene.clear(),e.objectType!==g.Bead)return void console.warn("object.objectType not supported yet");var o=Tn(e);if(void 0===o)return void console.warn("triggerAddBeadToScene object not created in scene");o.position.x=0,o.position.y=0,this.scene.add(o);var a=new E.a;a.expandByObject(o);var s=1,r=1;a&&(s=Math.abs(a.max.x-a.min.x),r=Math.abs(a.max.y-a.min.y));var c=t/n,d=1,l=1;c<s/r?l=(d=s)*c:d=(l=r)/c;var u=(d+.1*d)/2,p=(l+.1*l)/2,h=new E.x(-1*u,u,p,-1*p,0,1e3);h.position.set(0,0,500),h.lookAt(0,0,0),he().ui.lights.forEach((function(e){kn(e,i.scene)})),this.renderer.render(this.scene,h);var b=this.renderer.domElement.toDataURL("image/png");return this.scene.clear(),b}catch(v){return void console.log("getObjectThumbnail error:",v)}}}]),e}(),gn=function(){var e=Object(ze.a)(Ne.a.mark((function e(t,n,i){var o;return Ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t){e.next=3;break}return de("no html el element found"),e.abrupt("return");case 3:return!1===t.classList.contains("active")&&t.classList.add("active"),e.prev=4,oe=Object(v.cloneDeep)(ue),nn=new rn,wt(),an=new mn(t,n,i),t.appendChild(an.renderer.domElement),e.next=12,tt();case 12:re("initMouseListeners... bind"),window.addEventListener("resize",Jt,!1),an.el.addEventListener("pointerdown",$t,!1),an.el.addEventListener("pointermove",tn,!1),an.el.addEventListener("pointerup",Qt,!1),an.el.addEventListener("mouseout",en,!1),an.el.addEventListener("wheel",qt,!1),Ht=new zt,Ut=new Nt,Ft=new Lt,Gt=new bt,Yt=new ht,Xt=new ut,Wt=new Vt,requestAnimationFrame(yn),void 0!==yt&&(yt.addEventListener("keydown",It),yt.addEventListener("keyup",Et)),o=sn(),an.camera.userData={sceneScale:1,rect10x10FromScreenToWorld:o},Dt("keyz",(function(e,t){return(e.ctrlKey||e.metaKey)&&(le("listener:: undohistory"),cn()),!1})),Dt("keyy",(function(e,t){return(e.ctrlKey||e.metaKey)&&(le("listener:: redohistory"),dn()),!1})),Dt("keyc",(function(e,t){return(e.ctrlKey||e.metaKey)&&(le("listener:: copy"),hn()),!1})),Dt("keyx",(function(e,t){return(e.ctrlKey||e.metaKey)&&(le("listener:: cut"),bn()),!1})),Dt("keyv",(function(e,t){return(e.ctrlKey||e.metaKey)&&(le("listener:: paste"),vn()),!1})),Dt("delete",(function(e,t){le("listener:: delete");var n=he();if(n.selectedIds.length>0){var i={name:$.RemoveObjects,payload:{ids:n.selectedIds}};ei(i)}return!1})),fn(),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(4),console.error("err:",e.t0.toString());case 29:return e.abrupt("return");case 30:case"end":return e.stop()}}),e,null,[[4,26]])})));return function(t,n,i){return e.apply(this,arguments)}}(),mn=function e(t,n,i){Object(me.a)(this,e),this.el=void 0,this.camera=void 0,this.scene=void 0,this.renderer=void 0,this.objects=void 0,this.el=t;var o=t.getBoundingClientRect(),a=o.width,s=o.height;this.objects=new Map,this.camera=new E.x(a/-2,a/2,s/2,s/-2,0,1e3),this.camera.position.set(0,0,500),this.camera.lookAt(0,0,0),this.camera.layers.enable(2),this.camera.layers.enable(3),this.scene=new E.C,this.scene.background=new E.e("#f2f2f2"),this.renderer=new E.G({canvas:null!==n&&void 0!==n?n:void 0,context:null!==i&&void 0!==i?i:void 0,antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setSize(a,s)};function yn(){(function(e){var t=e.domElement,n=t.clientWidth,i=t.clientHeight,o=t.width!==n||t.height!==i;o&&e.setSize(n,i,!1);return o})(an.renderer)&&an.camera.updateProjectionMatrix(),an.renderer.render(an.scene,an.camera),requestAnimationFrame(yn)}var xn,On=function(e,t){if(null===an.el)throw new Error("no el in dom");if(!rt)throw new Error("no el in dom");var n=he().ui.zoomScale,i=an.el.getBoundingClientRect(),o=i.width,a=i.height,s=t-i.top,r=(e-i.left-o/2)*n+an.camera.position.x,c=(a/2-s)*n+an.camera.position.y;return new E.E(r,c)},wn=function(e){if(!rt)throw new Error("no el in dom");var t=an.el.getBoundingClientRect(),n=t.width,i=t.height,o=t.top,a=t.left,s=e.clone(),r=n/2,c=i/2;return s.project(an.camera),s.x=s.x*r+r+a,s.y=-s.y*c+c+o,s},kn=function(e,t){if("THREE.DirectionalLight"===e.type){var n,i,o,a,s,r,c=new E.f(e.color,e.intensity);c.position.set(null!==(n=null===(i=e.position)||void 0===i?void 0:i.x)&&void 0!==n?n:0,null!==(o=null===(a=e.position)||void 0===a?void 0:a.y)&&void 0!==o?o:0,null!==(s=null===(r=e.position)||void 0===r?void 0:r.z)&&void 0!==s?s:10),c.name=e.name,c.userData=Object(v.merge)({},c,{objectType:g.SceneLight,name:"".concat(g.SceneLight).concat(w).concat(c.id)}),t.add(c)}},Dn=function(e){var t=e.objectType;t===g.Bead&&_n(e,an.scene,!1),t===g.Region&&In(e),t===g.Group&&Bn(e),t===g.PreviewProject3D&&Pn(e)},Sn=function(e){var t=new E.a;return e.forEach((function(e){var n=an.objects.get(e.id);void 0!==n&&t.expandByObject(n)})),function(e){if(!1!==isFinite(e.min.x)&&!1!==isFinite(e.max.y)){var t=new E.F;t.x=e.min.x+(e.max.x-e.min.x)/2,t.y=e.max.y;var n=wn(t);return n.x<0&&(n.x=0),n.y<70&&(n.y=70),n}}(t)},En=function(e,t,n,i){var o=an.objects.get(e);void 0!==o&&(o.position.x=n,o.position.y=i)},In=function(e){var t=new E.y(1,1,1,1),n=new E.t({color:"rgb(0,0,0)",side:E.i,opacity:.1,transparent:!0}),i=new E.s(t,n);i.userData=Be(e,Ie.BG);var o=new E.l;o.userData=Be(e,Ie.GRID_CELLS),e.childrenGridIds.forEach((function(t,n){var i=Math.floor(n/e.columns),a=Math.floor(n%e.columns),s=Me(e,n),r=1/e.columns,c=1/e.rows,d=r/2,l=c/2,u=d,p=-d,h=l,b=-l,v=(new E.D).moveTo(u,h).lineTo(p,h).lineTo(p,b).lineTo(u,b);v.autoClose=!0;var j=v.getPoints(),g=(new E.c).setFromPoints(j),m=new E.t({color:s?16624:"red",opacity:s?1:0,transparent:!s}),y=new E.m(g,m);y.userData=Be(e,Ie.GRID_CELL);var x=e.gridType===f.Bricks?i%2===0?0:d:0,O=r*a+d;y.position.x=O+x-.5;var w=c*i+l;y.position.y=w-.5,o.add(y)}));var a=new E.l;a.userData=Be(e,Ie.MAIN),a.position.x=e.position.x,a.position.y=e.position.y,a.position.z=-300,a.scale.x=e.width,a.scale.y=e.height,a.scale.z=1,a.rotation.x=E.r.DEG2RAD*e.rotateX,a.rotation.y=E.r.DEG2RAD*e.rotateY,a.rotation.z=E.r.DEG2RAD*e.rotateZ,a.add(i),a.add(o),an.objects.set(e.id,a),an.scene.add(a)},Cn=function(e,t,n){var i=an.objects.get(e.id);if(void 0!==i){var o,a;if(i instanceof E.s)null===i||void 0===i||null===(o=i.material)||void 0===o||null===(a=o.color)||void 0===a||a.set(n);i.traverse((function(e){var t,i;e instanceof E.s&&(null===(t=e.material)||void 0===t||null===(i=t.color)||void 0===i||i.set(n))})),t.includes(e.id)&&function(e,t){var n=an.objects.get(e);void 0!==n&&n.traverse((function(e){e instanceof E.s&&e.material&&(!0===t?e.material.emissive.set(1513239):e.material.emissive.set(0))}))}(e.id,!0)}},Tn=function(e){var t=e.type,n=function(e){var t;if(e===i.MODEL_CYLINDER){if(null===et.model_cylinder.model)return console.error("triggerAddBeadToScene: 3dModel is not loaded baseBead"),t;t=et.model_cylinder.model.clone()}if(e===i.MODEL_FIRE_POLISH){if(null===et.model_fire_polish.model)return console.error("triggerAddBeadToScene: 3dModel is not loaded baseBead"),t;t=et.model_fire_polish.model.clone()}if(e===i.MODEL_TOHO_ROUND){if(null===et.model_toho_round.model)return console.error("triggerAddBeadToScene: 3dModel is not loaded baseBead"),t;t=et.model_toho_round.model.clone()}if(e===i.MODEL_SPHERE){if(null===et.model_sphere.model)return console.error("triggerAddBeadToScene: 3dModel is not loaded baseBead"),t;t=et.model_sphere.model.clone()}return t}(t);if(void 0!==n){n.traverse((function(t){var n,i;t.userData=B(e,k.ANY),t instanceof E.s&&(t.material=(n=e.material,i=e.color,n===o.Mat?new E.w({reflectivity:1,color:i}):n===o.Shiny?new E.v({color:i}):void console.warn("unknow BeadMaterialTypes:",n))),t.geometry&&t.geometry.computeBoundingBox()}));var a,s=(a=t)===i.MODEL_CYLINDER?et.model_cylinder.bbox:a===i.MODEL_SPHERE?et.model_sphere.bbox:a===i.MODEL_FIRE_POLISH?et.model_fire_polish.bbox:a===i.MODEL_TOHO_ROUND?et.model_toho_round.bbox:(console.warn("missing model for bead type : ",a),null),r=1,c=1,d=1;return s&&(r=Math.abs(s.max.x-s.min.x),c=Math.abs(s.max.y-s.min.y),d=Math.abs(s.max.z-s.min.z)),n.scale.x=e.width/r,n.scale.y=e.height/c,n.scale.z=e.depth/d,n.rotation.x=E.r.DEG2RAD*e.rotateX,n.rotation.y=E.r.DEG2RAD*e.rotateY,n.rotation.z=E.r.DEG2RAD*e.rotateZ,n.position.x=e.position.x,n.position.y=e.position.y,n.position.z=e.position.z,n.userData=B(e),n}console.warn("beadModel not found for type: ",t,e.id)},_n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=an.objects.get(e.id);if(void 0===i){var o=Tn(e);void 0!==o&&(!1===n&&an.objects.set(e.id,o),t.add(o))}else console.warn("bead already in scene",e.id)},Bn=function(e){var t=new E.y(1,1,1,1),n=new E.t({color:"rgb(0,0,0)",side:E.i,opacity:.2,transparent:!0}),i=new E.s(t,n);i.userData=Se(e,ae.BG);var o=new E.l;o.userData=Se(e,ae.MAIN),o.position.x=e.position.x,o.position.y=e.position.y,o.position.z=-400,o.scale.x=e.width,o.scale.y=e.height,o.scale.z=1,o.add(i),an.objects.set(e.id,o),an.scene.add(o)},Pn=function(e){var t=new E.y(1,1,1,1),n=new E.t({color:"rgb(0,0,0)",side:E.i,opacity:.1,transparent:!0}),i=new E.s(t,n);i.userData=Te(e,ke.BG);var o=new E.l;o.userData=Te(e,ke.MAIN),o.position.x=e.position.x,o.position.y=e.position.y,o.scale.x=e.width,o.scale.y=e.height,o.scale.z=1,o.add(i),an.objects.set(e.id,o),an.scene.add(o)},Mn=function(e){e.forEach((function(e){var t=an.objects.get(e.id);void 0!==t&&(t.parent&&t.parent.remove(t),an.objects.delete(e.id))}))},Rn=function(e){e.forEach((function(e){var t=an.objects.get(e);void 0!==t&&(t.parent&&t.parent.remove(t),an.objects.delete(e))}))},An=function(){function e(t,n,i,o){Object(me.a)(this,e),this.store=void 0,this.event=void 0,this.history=void 0,this.saveToHistory=void 0,this.store=n,this.history=i,this.event=t,this.saveToHistory=o}return Object(ye.a)(e,[{key:"getNewStoreWithTopBarPosition",value:function(e){return Object(we.default)(e,(function(t){var n=Sn(e.selectedIds.map((function(t){return{id:t,objectType:e.objects[t].objectType}})));t.ui.selectedTopBarPosition=n}))}},{key:"getCenterPosition",value:function(){var e=an.el.getBoundingClientRect(),t=e.width,n=e.height,i=e.top;return{posX:e.left+t/2,posY:i+n/2}}},{key:"getMousePosition",value:function(){var e=0,t=0,n=Zt;if(void 0===n){var i=this.getCenterPosition();e=i.posX,t=i.posY}else e=n.x,t=n.y;return{posX:e,posY:t}}},{key:"getStoreWithHistory",value:function(e){var t=this,n=void 0===e?this.store:e;return Object(we.default)(n,(function(e){e.history.canRedo=t.history.canRedo(),e.history.canUndo=t.history.canUndo(),e.history.events=t.history.getSimpleHistoryEvents()}))}}]),e}(),Nn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){}},{key:"getAppObjectFromCloneAppObject",value:function(e){if(void 0!==e.objectType)return e.objectType===g.Bead?P(e):e.objectType===g.Region?Re(e):e.objectType===g.Group?Ee(e):e.objectType===g.PreviewProject3D?function(e){var t={id:E.r.generateUUID(),position:D(0,0),rotateX:90,rotateY:0,rotateZ:0,height:10,width:10,depth:10,canLockOrUnlock:!0,isLocked:!1,objectType:g.PreviewProject3D,color:"red"};return Object(v.merge)(t,e)}(e):void console.warn("unknow object type from payload: ",e);console.warn("object type not found in payload: ",e)}},{key:"selectObjectOnThreeScene",value:function(e,t){void 0!==e&&Bt().updateRect({depth:e.depth,height:e.height,width:e.width,id:e.id,position:new E.F(e.position.x,e.position.y,e.position.z),rotation:new E.F(e.rotateX,e.rotateY,e.rotateZ)},t)}},{key:"deleteSelectedObjectsFromStore",value:function(e,t){var n=this;return Object(we.produce)(this.store,(function(i){e.forEach((function(e){var o=n.store.objects[e];if(i.selectedIds.includes(e)){var a=i.selectedIds.indexOf(e);i.selectedIds.splice(a,1),n.selectObjectOnThreeScene(o,!1)}void 0!==i.objects[o.id]&&(t.push(o),o.objectType===g.Region&&o.childrenGridIds.forEach((function(e){void 0!==e&&(i.objects[e].regionId=void 0)})),delete i.objects[o.id])})),i.ui.selectedTopBarPosition=Sn(i.selectedIds.map((function(e){return{id:e,objectType:i.objects[e].objectType}})))}))}},{key:"getPositionDiffFromMousePosition",value:function(e){var t=this.getMousePosition(),n=t.posX,i=t.posY,o=On(n,i),a=new E.a;e.forEach((function(e){var t=e.width/2,n=e.height/2,i=e.position.x,o=e.position.y;a.expandByPoint((new E.F).set(i-t,o-n,.1)),a.expandByPoint((new E.F).set(i+t,o-n,.2)),a.expandByPoint((new E.F).set(i-t,o+n,.1)),a.expandByPoint((new E.F).set(i+t,o+n,.1))}));var s=new E.F;return a.getCenter(s),{diffX:o.x-s.x,diffY:o.y-s.y}}},{key:"moveObjectsByDiff",value:function(e,t,n){e.forEach((function(i){i.objectType===g.Group?(i.position.x=i.position.x+t,i.position.y=i.position.y+n,e.forEach((function(e){i.childrenIds.includes(e.id)&&(e.position.x=e.position.x+t,e.position.y=e.position.y+n)}))):void 0===i.groupId&&(i.position.x=i.position.x+t,i.position.y=i.position.y+n)}))}}]),n}(An),zn=n(299),Ln=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t=[],n=Object(we.default)(this.store,(function(n){e.event.payload.objects.forEach((function(i){var o=e.getAppObjectFromCloneAppObject(i);void 0!==o&&(o.objectType===g.Region&&o.childrenGridIds.forEach((function(e){void 0!==e&&(n.objects[e].regionId=o.id)})),n.objects[o.id]=o,t.push(o))}))}));if(this.saveToHistory){var i={do:this.event,redo:{name:$.AddObjects,payload:{objects:t}},undo:{name:$.RemoveObjects,payload:{ids:t.map((function(e){return e.id}))}},createdAt:Object(zn.a)(new Date)};this.history.push(i)}n=this.getStoreWithHistory(n),be(n),je()&&t.forEach((function(e){Dn(e)})),ge()&&vt(n),Y(t.map((function(e){return{action:T.CREATE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(Nn),Hn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this.event.payload.ids,t=[],n=this.deleteSelectedObjectsFromStore(e,t);if(this.saveToHistory){var i={do:this.event,redo:this.event,undo:{name:$.AddObjects,payload:{objects:t}},createdAt:Object(zn.a)(new Date)};this.history.push(i)}n=this.getStoreWithHistory(n),be(n),je()&&Mn(t.map((function(e){return{id:e.id,objectType:e.objectType}}))),ge()&&vt(n),Y(t.map((function(e){return{action:T.DELETE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(Nn),Un=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t=this.event.payload.change,n=[],i=Object(we.default)(this.store,(function(e){t.forEach((function(t){void 0!==e.objects[t.id]?(!0===e.selectedIds.includes(t.id)?!0===t.isSelected||e.selectedIds.splice(e.selectedIds.indexOf(t.id),1):!0===t.isSelected&&e.selectedIds.push(t.id),n.push({id:t.id,isSelected:t.isSelected})):console.warn("no object found in store",t.id)}))}));n.forEach((function(t){var n=i.objects[t.id];void 0!==n&&e.selectObjectOnThreeScene(n,t.isSelected)})),i=this.getNewStoreWithTopBarPosition(i),be(i),vt(i)}}]),n}(Nn),Fn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t=[],n={},i=[],o=this.event.payload.changes,a=[],s=Object(we.default)(this.store,(function(s){o.forEach((function(e){if(void 0!==s.objects[e.id]){var t={id:e.id,properties:{},relatedChanges:[],shouldBeCreated:[],shouldBeDeleted:[]},n=Object.keys(e.properties);void 0!==t&&n.forEach((function(n){t.properties[n]=Object(v.cloneDeep)(s.objects[e.id][n])})),n.forEach((function(t){s.objects[e.id][t]=Object(v.cloneDeep)(e.properties[t])})),e.relatedChanges&&e.relatedChanges.forEach((function(e){void 0!==s.objects[e.id]?Object.keys(e.properties).forEach((function(t){s.objects[e.id][t]=Object(v.cloneDeep)(e.properties[t])})):de("no object found in store",e.id)})),a.push(t)}else de("no object found in store",e.id)})),o.forEach((function(o,r){if(void 0!==s.objects[o.id]){var c=s.objects[o.id].objectType,d=a[r];c===g.Bead&&e.whenBead(o,s,d,t,n,i),c===g.Region&&e.whenRegion(o,s,d,t,n,i)}else de("no object found in store",o.id)}))}));if(this.saveToHistory){var r={do:this.event,redo:{name:$.ChangeObjectsProperty,payload:{changes:this.event.payload.changes.map((function(e){var t=e.id,n=e.properties,i=e.relatedChanges,o=a.findIndex((function(e){return e.id===t})),s=-1!==o,r=s?a[o].shouldBeDeleted:[],c=s?a[o].shouldBeCreated:[];return{id:t,properties:n,relatedChanges:i,shouldBeCreated:r,shouldBeDeleted:c}}))}},undo:{name:$.ChangeObjectsProperty,payload:{changes:a}},createdAt:Object(zn.a)(new Date)};this.history.push(r)}if(s=this.getStoreWithHistory(s),je()&&o.forEach((function(t){e.applyChangesToThree(t,s),Y([{action:T.UPDATE,createdAt:(new Date).toISOString(),object:s.objects[t.id]}]),t.relatedChanges&&t.relatedChanges.forEach((function(t){e.applyChangesToThree(t,s),Y([{action:T.UPDATE,createdAt:(new Date).toISOString(),object:s.objects[t.id]}])}))})),je()){t.length>0&&(t.forEach((function(e){Dn(e)})),Y(t.map((function(e){return{action:T.CREATE,createdAt:(new Date).toISOString(),object:e}}))));var c=Object.keys(n);c.length>0&&(Mn(c.map((function(e){return{id:e,objectType:s.objects[e].objectType}}))),c.forEach((function(e){Dn(s.objects[e])})),Y(c.map((function(e){return{action:T.UPDATE,createdAt:(new Date).toISOString(),object:s.objects[e]}})))),i.length>0&&(Mn(i.map((function(e){return{id:e.id,objectType:e.objectType}}))),Y(i.map((function(e){return{action:T.DELETE,createdAt:(new Date).toISOString(),object:e}}))))}(je()&&(s=this.getNewStoreWithTopBarPosition(s)),be(s),ge()&&vt(s),je())&&Bt().syncRectsWithStore()}},{key:"applyChangesToThree",value:function(e,t){if(void 0!==t.objects[e.id]){var n=t.objects[e.id],i=void 0!==n.groupId&&n.groupId.length>0,o=Object.keys(e.properties);1===o.length&&!0===o.includes("position")&&!1===i?En(e.id,n.objectType,n.position.x,n.position.y):(Mn([{id:e.id,objectType:n.objectType}]),Dn(n),i&&void 0!==n.groupId&&t.objects[n.groupId]&&t.objects[n.groupId].childrenIds.forEach((function(e){var n=t.objects[e];Mn([{id:e,objectType:n.objectType}]),Dn(n)})))}else de("no object found in store",e.id)}},{key:"whenBead",value:function(e,t,n,i,o,a){var s=this;if(Object.keys(e.properties).includes("position")){var r=!1,c=t.objects[e.id],d=t.objects[e.id].regionId;if(void 0!==d){var l=t.objects[d];if(!0===this.isRegionContainBead(l,c)){var u=this.getRegionCellIndex(c.position.x,c.position.y,l),p=u.column,h=u.row,b=u.index;if(!0===Me(l,b)){var f=l.childrenGridIds.indexOf(c.id);if(-1!==f&&f!==b&&(t.objects[d].childrenGridIds[f]=void 0),void 0!==t.objects[d].childrenGridIds[b]&&(t.objects[d].childrenGridIds[b]=c.id,r=!0,!0===l.snapBeadsToCell)){var j=this.getRegionCellCenter(l,h,p);t.objects[c.id].position.x=j.x,t.objects[c.id].position.y=j.y}}}}if(!1===r&&Object.keys(t.objects).forEach((function(e){if(t.objects[e].objectType===g.Region){var n=t.objects[e];if(!1!==s.isRegionContainBead(n,c)){var i=s.getRegionCellIndex(c.position.x,c.position.y,n),a=i.column,d=i.row,l=i.index;if(!0===Me(n,l))if(void 0===n.childrenGridIds[l]){var u=n.childrenGridIds.indexOf(c.id);if(-1!==u&&u!==l&&(t.objects[e].childrenGridIds[u]=void 0),t.objects[e].childrenGridIds[l]=c.id,o[e]=Object(v.cloneDeep)(t.objects[e]),void 0!==t.objects[c.id].regionId){var p=t.objects[c.id].regionId,h=t.objects[p].childrenGridIds.indexOf(c.id);-1!==h&&(t.objects[p].childrenGridIds[h]=void 0,o[p]=Object(v.cloneDeep)(t.objects[p]))}if(t.objects[c.id].regionId=n.id,r=!0,!0===n.snapBeadsToCell){var b=s.getRegionCellCenter(n,d,a);t.objects[c.id].position.x=b.x,t.objects[c.id].position.y=b.y}}else if(n.childrenGridIds[l]===c.id&&!0===n.snapBeadsToCell){var f=s.getRegionCellCenter(n,d,a);t.objects[c.id].position.x=f.x,t.objects[c.id].position.y=f.y,r=!0}}}})),!1===r&&void 0!==d){var m=t.objects[d].childrenGridIds.indexOf(c.id);-1!==m&&(t.objects[d].childrenGridIds[m]=void 0,o[d]=Object(v.cloneDeep)(t.objects[d])),t.objects[e.id].regionId=void 0}}}},{key:"whenRegion",value:function(e,t,n,i,o,a){var s=this,r=Object.keys(e.properties),c="shape",d="gridType",l="autoFillBeads",u="snapBeadsToCell",p="rows",h="columns",b="position",f=e.shouldBeDeleted;if(void 0!==f&&f.length>0){var j=t.objects[e.id],m=[];f.forEach((function(e){void 0!==t.objects[e.id]?(m.push(e.id),a.push(Object(v.cloneDeep)(e)),delete t.objects[e.id]):de("whenRegion:: bead not found",e.id)})),j.childrenGridIds.forEach((function(e,n){void 0!==e&&m.includes(e)&&(t.objects[j.id].childrenGridIds[n]=void 0)}))}if(r.includes(p)||r.includes(h)||r.includes(c)||r.includes(d)){var y=t.objects[e.id],x=n.properties.rows,O=n.properties.columns,w=n.properties.shape,k=n.properties.gridType,D=!0===y.autoFillBeads;if(void 0===x||void 0===O){de("missing keys: rowsKey && columnsKey"),t.objects[y.id].childrenGridIds.forEach((function(e){if(void 0!==e){var i=t.objects[e];void 0!==i?(n.shouldBeCreated.push(Object(v.cloneDeep)(i)),a.push(Object(v.cloneDeep)(i)),delete t.objects[e]):de("toDeleteBeadIds:: bead not found",e)}}));var S=y.rows*y.columns;t.objects[y.id].childrenGridIds=Array(S).fill(void 0)}else if(w!==y.shape||x!==y.rows||O!==y.columns||k!==y.gridType){var E=this.getRegionChildrenGridIdsAfterResize(y,D,x,O),I=E.toDeleteBeadIds,C=E.newChildrenGridIds;I.forEach((function(e){var i=t.objects[e];void 0!==i?(n.shouldBeCreated.push(Object(v.cloneDeep)(i)),a.push(Object(v.cloneDeep)(i)),delete t.objects[e]):de("toDeleteBeadIds:: bead not found",e)})),t.objects[y.id].childrenGridIds=Object(v.cloneDeep)(C)}}if(r.includes(b)||r.includes(u)){var T=t.objects[e.id];if(!0===T.snapBeadsToCell)T.childrenGridIds.forEach((function(i,a){if(void 0!==i){var r=t.objects[i];if(void 0!==r){var c,d=Object(v.cloneDeep)(r.position),l=s.getRegionCellIndex(r.position.x,r.position.y,T),u=l.row,p=l.column,h=s.getRegionCellCenter(T,u,p),b=h.x,f=h.y;t.objects[i].position.x=b,t.objects[i].position.y=f,o[i]=Object(v.cloneDeep)(t.objects[i]),null===(c=n.relatedChanges)||void 0===c||c.push({id:i,properties:{position:{x:d.x,y:d.y,z:d.z}}})}}else{var j=t.objects[e.id],m=!1;Object.keys(t.objects).forEach((function(i){var r;if(!0!==m&&t.objects[i].objectType===g.Bead){var c=t.objects[i];if(void 0===c.groupId)if(void 0===c.regionId)if(!1!==Me(j,a)&&!1!==s.isRegionCellContainBead(j,c,a)){var d=Object(v.cloneDeep)(c.position),l=s.getRegionCellIndex(c.position.x,c.position.y,j),u=l.row,p=l.column,h=s.getRegionCellCenter(j,u,p),b=h.x,f=h.y;t.objects[e.id].childrenGridIds[a]=c.id,t.objects[c.id].regionId=j.id,t.objects[c.id].position.x=b,t.objects[c.id].position.y=f,null===(r=n.relatedChanges)||void 0===r||r.push({id:c.id,properties:{position:{x:d.x,y:d.y,z:d.z},regionId:void 0}}),o[c.id]=Object(v.cloneDeep)(t.objects[c.id]),m=!0}}}))}}));else{for(var _=t.objects[e.id],B=_.rows*_.columns,M=Array(B).fill(void 0),R=B,A=Object.keys(t.objects),N=0;N<A.length&&!(R<=0);N++){var z=A[N];if(t.objects[z].objectType===g.Bead){var L=t.objects[z];if(void 0===L.groupId&&!1!==this.isRegionContainBead(_,L)){var H=this.getRegionCellIndex(L.position.x,L.position.y,_).index;H>=0&&void 0===M[H]&&(M[H]=L.id,R-=1)}}}t.objects[e.id].childrenGridIds.forEach((function(e){if(void 0!==e&&void 0!==t.objects[e]){var i;if(!1===M.includes(e))null===(i=n.relatedChanges)||void 0===i||i.push({id:e,properties:{regionId:t.objects[e].regionId}});t.objects[e].regionId=void 0,o[e]=Object(v.cloneDeep)(t.objects[e])}})),M.forEach((function(e){if(void 0!==e){var i,a;if(void 0===t.objects[e].regionId)null===(i=n.relatedChanges)||void 0===i||i.push({id:e,properties:{regionId:void 0}});else null===(a=n.relatedChanges)||void 0===a||a.push({id:e,properties:{regionId:t.objects[e].regionId}});t.objects[e].regionId=_.id,o[e]=Object(v.cloneDeep)(t.objects[e])}})),t.objects[e.id].childrenGridIds=Object(v.cloneDeep)(M)}}if(r.includes(l)||r.includes(p)||r.includes(h)||r.includes(b)||r.includes(d)){var U=t.objects[e.id],F=!0===U.autoFillBeads,G=!0===U.snapBeadsToCell,Y=U.rows*U.columns;if(U.childrenGridIds.length!==Y)return void de("region childrenIds size have not correct value",Y,U.childrenGridIds.length,U.childrenGridIds);if(F){var X={value:0};U.childrenGridIds.forEach((function(a,r){if(!1!==Me(U,r))if(void 0===a){var c=s.getRegionCellCenterFromCellIndex(U,r),d=c.x,l=c.y,u=s.getIdFromUndoOrRedo(e,X,0),p=P({id:u,color:"red",regionId:U.id});p.position.x=d,p.position.y=l,t.objects[p.id]=p,t.objects[U.id].childrenGridIds[r]=p.id,i.push(Object(v.cloneDeep)(p)),n.shouldBeDeleted.push(Object(v.cloneDeep)(p))}else{var h=t.objects[a];if(void 0!==h){var b,f=Object(v.cloneDeep)(h.position),j=s.getRegionCellCenterFromCellIndex(U,r),g=j.x,m=j.y;t.objects[a].position.x=g,t.objects[a].position.y=m,o[a]=Object(v.cloneDeep)(t.objects[a]),null===(b=n.relatedChanges)||void 0===b||b.push({id:a,properties:{position:{x:f.x,y:f.y,z:f.z}}})}}}))}else G&&U.childrenGridIds.forEach((function(i,a){if(!1!==Me(U,a))if(void 0!==i){var r,c=t.objects[i],d=Object(v.cloneDeep)(c.position),l=s.getRegionCellCenterFromCellIndex(U,a),u=l.x,p=l.y;t.objects[i].position.x=u,t.objects[i].position.y=p,o[i]=Object(v.cloneDeep)(t.objects[i]),null===(r=n.relatedChanges)||void 0===r||r.push({id:i,properties:{position:{x:d.x,y:d.y,z:d.z}}})}else{var h=t.objects[e.id],b=!1;Object.keys(t.objects).forEach((function(i){var r;if(!0!==b&&t.objects[i].objectType===g.Bead){var c=t.objects[i];if(void 0===c.groupId&&void 0===c.regionId&&!1!==s.isRegionCellContainBead(h,c,a)){var d=s.getRegionCellCenterFromCellIndex(h,a),l=d.x,u=d.y;t.objects[e.id].childrenGridIds[a]=c.id,t.objects[c.id].regionId=h.id;var p=Object(v.cloneDeep)(c.position);t.objects[c.id].position.x=l,t.objects[c.id].position.y=u,null===(r=n.relatedChanges)||void 0===r||r.push({id:c.id,properties:{position:{x:p.x,y:p.y,z:p.z},regionId:void 0}}),o[c.id]=Object(v.cloneDeep)(t.objects[c.id]),b=!0}}}))}}))}}},{key:"getIdFromUndoOrRedo",value:function(e,t,n){var i,o,a,s=void 0,r=e.shouldBeCreated;void 0!==r&&void 0!==(null===(i=r[t.value])||void 0===i?void 0:i.id)&&(s=null!==(o=null===(a=r[t.value])||void 0===a?void 0:a.id)&&void 0!==o?o:void 0,t.value=t.value+1);return s}},{key:"getRegionChildrenGridIdsAfterResize",value:function(e,t,n,i){var o=[],a=[];if(e.shape===j.Rectangle){var s=e.rows,r=e.columns,c=e.rows*e.columns;o=Array(c).fill(void 0),a=[];for(var d=0;d<e.childrenGridIds.length;d++){var l=d,u=Math.floor(d/i),p=Math.floor(d%i),h=p+u*r,b=Me(e,h);if((!1===b||p>=r||u>=s)&&(h=c,t)){var v=e.childrenGridIds[l];void 0!==v&&!1===a.includes(v)&&a.push(v)}h<c&&!0===b&&(o[h]=e.childrenGridIds[l])}}else if(e.shape===j.Triangle){var f=e.columns,g=e.rows*e.columns;o=Array(g).fill(void 0),a=[];for(var m=0;m<e.childrenGridIds.length;m++){var y=Math.floor(m/i),x=i/2,O=f/2,w=Math.floor(m%i)+(O-x<0?Math.ceil(O-x):Math.floor(O-x)),k=y,D=k*f+w,S=m;if(!1===(Me(e,D)&&w>=0&&w<f&&k<e.rows)){if(t){var E=e.childrenGridIds[S];void 0!==E&&!1===a.includes(E)&&a.push(E)}}else void 0===o[D]?o[D]=e.childrenGridIds[S]:t&&!1===a.includes(e.childrenGridIds[S])&&a.push(e.childrenGridIds[S])}}else ce("region shape not handled",e.shape);return{toDeleteBeadIds:a,newChildrenGridIds:o}}},{key:"isRegionContainBead",value:function(e,t){var n=e.position.x-e.width/2,i=e.position.y-e.height/2;return S({x:n,y:i,z:0},{x:e.position.x+e.width/2,y:e.position.y+e.height/2,z:0},{x:t.position.x,y:t.position.y,z:0})}},{key:"isRegionCellContainBead",value:function(e,t,n){var i=Math.floor(n/e.columns),o=Math.floor(n%e.columns),a=e.width/e.columns,s=e.height/e.rows,r=e.position.x-e.width/2,c=e.position.y-e.height/2,d=e.gridType===f.Bricks?i%2===0?0:a/2:0;return S({x:r+o*a+d,y:c+i*s,z:0},{x:r+o*a+a+d,y:c+i*s+s,z:0},{x:t.position.x,y:t.position.y,z:0})}},{key:"getRegionCellCenterFromCellIndex",value:function(e,t){var n=Math.floor(t/e.columns),i=Math.floor(t%e.columns);return this.getRegionCellCenter(e,n,i)}},{key:"getRegionCellCenter",value:function(e,t,n){var i=e.width/e.columns,o=e.height/e.rows,a=n*i+(e.gridType===f.Bricks?t%2===0?0:i/2:0),s=t*o;return{x:e.position.x-e.width/2+a+i/2,y:e.position.y-e.height/2+s+o/2,z:0}}},{key:"getRegionCellIndex",value:function(e,t,n){var i=n.position.x-n.width/2,o=n.position.y-n.height/2,a=n.width/n.columns,s=n.height/n.rows,r=Math.floor((t-o)/s),c=e-i-(n.gridType===f.Bricks?r%2===0?0:a/2:0),d=Math.floor(c/a);return{index:d<0?-1:r*n.columns+d,row:r,column:d}}}]),n}(Nn),Gn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this.event.payload.uiSettings,t=Object(we.default)(this.store,(function(t){Object.keys(e).forEach((function(n){t.ui[n]=Object(v.cloneDeep)(e[n])}))}));t=this.getNewStoreWithTopBarPosition(t),be(t),vt(t)}}]),n}(An),Yn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t=this.store.selectedIds.map((function(t){return Object(v.cloneDeep)(e.store.objects[t])}));pn({objects:t})}}]),n}(An),Xn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t=[],n=[],i=this.store.selectedIds.map((function(n){return t.push(n),Object(v.cloneDeep)(e.store.objects[n])}));pn({objects:i});var o=this.deleteSelectedObjectsFromStore(t,n);if(this.saveToHistory){var a={do:this.event,redo:this.event,undo:{name:$.ClipboardPaste,payload:{objects:i}},createdAt:Object(zn.a)(new Date)};this.history.push(a)}o=this.getStoreWithHistory(o),be(o),Mn(n.map((function(e){return{id:e.id,objectType:e.objectType}}))),vt(o),Y(n.map((function(e){return{action:T.DELETE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(Nn),Wn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t={},n=[];this.event.payload.objects.forEach((function(i){if(i.id){var o=i.id,a=Object(v.cloneDeep)(i);delete a.id;var s=e.getAppObjectFromCloneAppObject(a);void 0!==s&&(t[o]=s.id,n.push(s))}}));var i=this.getPositionDiffFromMousePosition(n),o=i.diffX,a=i.diffY;this.moveObjectsByDiff(n,o,a),n.forEach((function(e){if(e.objectType===g.Group){var n=[];e.childrenIds.forEach((function(e){n.push(t[e])})),e.childrenIds=n}void 0!==e.groupId&&(e.groupId=t[e.groupId])})),this.store.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(e.store.objects[t],!1)}));var s=Object(we.default)(this.store,(function(e){e.selectedIds=[],n.forEach((function(t){e.objects[t.id]=t,e.selectedIds.push(t.id)}))}));if(n.forEach((function(t){Dn(t),e.selectObjectOnThreeScene(t,!0)})),this.saveToHistory){var r={do:this.event,redo:this.event,undo:{name:$.RemoveObjects,payload:{ids:n.map((function(e){return e.id}))}},createdAt:Object(zn.a)(new Date)};this.history.push(r)}s=this.getStoreWithHistory(s),s=this.getNewStoreWithTopBarPosition(s),be(s),vt(s),Y(n.map((function(e){return{action:T.CREATE,createdAt:Object(zn.a)(new Date),object:e}})))}}]),n}(Nn),Vn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t=[];if("rectangle"===this.event.payload.figure){var n=P({});Object(v.times)(this.event.payload.rows).forEach((function(i){Object(v.times)(e.event.payload.columns).forEach((function(e){var o,a,s=((null!==(o=n.width)&&void 0!==o?o:1)+2)*i,r=((null!==(a=n.height)&&void 0!==a?a:1)+2)*e*-1,c=P({position:{x:s,y:r}});t.push(c)}))}))}else console.warn("figure not found in event payload");var i=this.getPositionDiffFromMousePosition(t),o=i.diffX,a=i.diffY;this.moveObjectsByDiff(t,o,a);var s=Object(we.default)(this.store,(function(e){t.forEach((function(t){e.objects[t.id]=t,e.selectedIds.push(t.id)}))}));if(this.store.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(e.store.objects[t],!1)})),t.forEach((function(t){Dn(t),e.selectObjectOnThreeScene(t,!0)})),this.saveToHistory){var r={do:this.event,redo:{name:$.AddObjects,payload:{objects:Object(v.cloneDeep)(t)}},undo:{name:$.RemoveObjects,payload:{ids:t.map((function(e){return e.id}))}},createdAt:Object(zn.a)(new Date)};this.history.push(r)}s=this.getStoreWithHistory(s),s=this.getNewStoreWithTopBarPosition(s),be(s),vt(s),Y(t.map((function(e){return{action:T.CREATE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(Nn),Zn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this.event.payload.zoomType,t=this.getCenterPosition();if("zoomByScroll"===e){var n=this.event.payload,i=n.scrollDelta,o=n.clientX,a=n.clientY;o||(o=t.posX),a||(a=t.posY),i||(i=1);var s=an.el.getBoundingClientRect(),r=s.top,c=o-s.left,d=a-r,l=Math.sign(i);this.updateByScroll(c,d,l)}else"zoomInScreenCenter"===e?this.updateByScroll(t.posX,t.posY,-1):"zoomOutScreenCenter"===e&&this.updateByScroll(t.posX,t.posY,1)}},{key:"updateByScroll",value:function(e,t,n){var i=an.el.getBoundingClientRect(),o=i.width,a=i.height,s=an.camera.position.x,r=an.camera.position.y,c=(e-o/2)*this.store.ui.zoomScale,d=-1*(t-a/2)*this.store.ui.zoomScale,l=this.store.ui.zoomScale>=.35?.1:.01,u=1;u=this.store.ui.zoomScale+n*l;var p=(e-o/2)*(u=Math.min(Math.max(.0125,u),100)),h=-1*(t-a/2)*u;an.camera.left=o*u/-2,an.camera.right=o*u/2,an.camera.top=a*u/2,an.camera.bottom=a*u/-2,an.camera.updateProjectionMatrix();var b=c-p,v=d-h;an.camera.position.x=s+b,an.camera.position.y=r+v,an.camera.lookAt(an.camera.position.x,an.camera.position.y,0);var f=sn();an.camera.userData={sceneScale:u,rect10x10FromScreenToWorld:f};var j=Object(we.default)(this.store,(function(e){e.ui.zoomScale=u}));j=this.getNewStoreWithTopBarPosition(j),be(j),vt(j),an.scene.traverse((function(e){4===e.layers.mask&&(e.scale.x=u,e.scale.y=u,e.scale.z=u)}))}}]),n}(An),Kn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this.event.payload,t=e.panel,n=e.open,i=e.toggle,o=Object(we.default)(this.store,(function(e){var o=n;"objects"===t&&(void 0!==i&&!0===i&&"objects"===e.ui.rightSidebar.panel&&(o=!e.ui.rightSidebar.isOpen),e.ui.rightSidebar.isOpen=o,e.ui.rightSidebar.panel=!1===o?void 0:"objects"),"history"===t&&(void 0!==i&&!0===i&&"history"===e.ui.rightSidebar.panel&&(o=!e.ui.rightSidebar.isOpen),e.ui.rightSidebar.isOpen=o,e.ui.rightSidebar.panel=!1===o?void 0:"history"),"comments"===t&&(void 0!==i&&!0===i&&"comments"===e.ui.leftSidebar.panel&&(o=!e.ui.leftSidebar.isOpen),e.ui.leftSidebar.isOpen=o,e.ui.leftSidebar.panel=!1===o?void 0:"comments")}));be(o),vt(o)}}]),n}(An),qn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this.event.payload,t=e.snapType,n=e.selectedIds,i=[],o=[],a=Object(we.default)(this.store,(function(e){var a=void 0,s=void 0,r=void 0,c=void 0;if(n.forEach((function(t){if(void 0!==e.objects[t]){var n=e.objects[t].position;(void 0===s||n.x<s)&&(s=n.x),(void 0===a||n.x>a)&&(a=n.x),(void 0===c||n.y<c)&&(c=n.y),(void 0===r||n.y>r)&&(r=n.y)}else console.warn("no object found in store",t)})),t===Q.X_MIN){if(void 0!==s){var d=s;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.x=d,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===Q.X_MIDDLE){if(void 0!==s&&void 0!==a){var l=s+(a-s)/2;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.x=l,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===Q.X_MAX){if(void 0!==a){var u=a;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.x=u,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===Q.Y_MIN){if(void 0!==c){var p=c;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.y=p,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===Q.Y_MIDDLE){if(void 0!==c&&void 0!==r){var h=c+(r-c)/2;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.y=h,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else if(t===Q.Y_MAX){if(void 0!==r){var b=r;n.forEach((function(t){var n={id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}};o.push(n),e.objects[t].position.y=b,i.push({id:t,properties:{position:Object(v.cloneDeep)(e.objects[t].position)}})}))}}else console.error("unknow SnapToLineType",t)}));if(this.saveToHistory){var s={do:this.event,redo:this.event,undo:{name:$.ChangeObjectsProperty,payload:{changes:o}},createdAt:Object(zn.a)(new Date)};this.history.push(s)}a=this.getStoreWithHistory(a),i.forEach((function(e){if(void 0!==a.objects[e.id]){var t=a.objects[e.id];En(e.id,t.objectType,t.position.x,t.position.y)}else console.warn("no object found in store",e.id)})),a=this.getNewStoreWithTopBarPosition(a),be(a),vt(a),Bt().syncRectsWithStore(),Y(i.map((function(e){return{action:T.UPDATE,createdAt:(new Date).toISOString(),object:a.objects[e.id]}})))}}]),n}(Nn),Jn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t={},n=[];this.event.payload.objects.forEach((function(i){if(i.id){var o=i.id,a=Object(v.cloneDeep)(i);delete a.id;var s=e.getAppObjectFromCloneAppObject(a);void 0!==s&&(t[o]=s.id,n.push(s))}}));var i=this.getPositionDiffFromMousePosition(n),o=i.diffX,a=i.diffY;this.moveObjectsByDiff(n,o,a),n.forEach((function(e){if(e.objectType===g.Group){var n=[];e.childrenIds.forEach((function(e){n.push(t[e])})),e.childrenIds=n}void 0!==e.groupId&&(e.groupId=t[e.groupId])})),this.store.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(e.store.objects[t],!1)}));var s=Object(we.default)(this.store,(function(e){e.selectedIds=[],n.forEach((function(t){e.objects[t.id]=t,e.selectedIds.push(t.id)}))}));if(n.forEach((function(t){Dn(t),e.selectObjectOnThreeScene(t,!0)})),this.saveToHistory){var r={do:this.event,redo:this.event,undo:{name:$.RemoveObjects,payload:{ids:n.map((function(e){return e.id}))}},createdAt:Object(zn.a)(new Date)};this.history.push(r)}s=this.getStoreWithHistory(s),s=this.getNewStoreWithTopBarPosition(s),be(s),vt(s),Y(n.map((function(e){return{action:T.CREATE,createdAt:(new Date).toISOString(),object:e}})))}}]),n}(Nn),$n=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t=[],n=[],i=[],o=[],a=[],s=Object(we.default)(this.store,(function(s){if(e.event.payload.objects.forEach((function(e){if(void 0!==s.objects[e.id]){var o=s.objects[e.id],a=o.objectType===g.Group,r=void 0!==o.groupId&&o.groupId.length>0;a?!1===t.includes(o.id)&&(1,t.push(o.id)):r?(1,n.push(o.id),i.push(o.id),o.groupId&&void 0!==s.objects[o.groupId]&&!1===t.includes(o.groupId)&&(1,t.push(o.groupId))):(1,n.push(o.id))}else console.warn("object not found in store",e.id)})),void 0!==e.event.payload.removed&&e.event.payload.removed.length>0)s.selectedIds=[],e.event.payload.removed.forEach((function(e){if(void 0!==e&&void 0!==e.id){var t=new E.a;e.childrenIds.forEach((function(e){var n=an.objects.get(e);void 0!==n&&t.expandByObject(n)}));var n=t.max.x-t.min.x,i=t.max.y-t.min.y,o=Ee({id:e.id,childrenIds:e.childrenIds,position:{x:t.min.x+n/2,y:t.min.y+i/2},width:n,height:i});s.objects[e.id]=o,a.push(o),s.selectedIds.push(o.id),void 0!==e.childrenIds&&e.childrenIds.length>0&&e.childrenIds.forEach((function(e){void 0!==s.objects[e]?(s.objects[e].groupId=o.id,s.selectedIds.push(e)):console.warn("object not found after group.childrenIds...")}))}}));else{t.forEach((function(t){void 0!==s.objects[t]&&(e.selectObjectOnThreeScene(s.objects[t],!1),o.push(Object(v.cloneDeep)(s.objects[t])),delete s.objects[t])}));var r=new E.a;n.forEach((function(e){var t=an.objects.get(e);void 0!==t&&r.expandByObject(t)}));var c=void 0;void 0!==e.event.payload.added&&(c=e.event.payload.added.id);var d=r.max.x-r.min.x,l=r.max.y-r.min.y,u=Ee({id:c,position:{x:r.min.x+d/2,y:r.min.y+l/2},width:d,height:l,childrenIds:n});s.objects[u.id]=u,a.push(u),n.forEach((function(e){s.objects[e].groupId=u.id})),s.selectedIds=[u.id].concat(n)}}));if(this.saveToHistory){var r,c={do:this.event,redo:{name:$.GroupObjects,payload:{objects:this.event.payload.objects.map((function(e){var t=e.id;return Object(v.cloneDeep)({id:t})})),removed:null===(r=this.event.payload.removed)||void 0===r?void 0:r.map((function(e){var t=e.id,n=e.childrenIds;return Object(v.cloneDeep)({id:t,childrenIds:n})})),added:a[0]?{id:a[0].id,childrenIds:a[0].childrenIds}:void 0}},undo:{name:$.UngroupObjects,payload:{objects:s.selectedIds.map((function(e){return Object(v.cloneDeep)({id:e})})),removed:o.map((function(e){var t=e.id,n=e.childrenIds;return Object(v.cloneDeep)({id:t,childrenIds:n})}))}},createdAt:Object(zn.a)(new Date)};this.history.push(c)}s=this.getStoreWithHistory(s),this.event.payload.objects.forEach((function(t){e.selectObjectOnThreeScene(t,!1)})),Mn(this.event.payload.objects.map((function(t){var n=t.id;return void 0===e.store.objects[n]?{id:n,objectType:""}:{id:n,objectType:e.store.objects[n].objectType}}))),Mn(o.map((function(t){var n=t.id;return void 0===e.store.objects[n]?{id:n,objectType:""}:{id:n,objectType:e.store.objects[n].objectType}}))),n.forEach((function(e){Dn(s.objects[e])})),a.forEach((function(e){Dn(s.objects[e.id])})),s.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(s.objects[t],!0)})),Y(a.map((function(e){var t=e.id;return{action:T.CREATE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(s.objects[t])}}))),Y(n.map((function(e){return{action:T.UPDATE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(s.objects[e])}}))),Y(o.map((function(t){var n=t.id;return{action:T.DELETE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(e.store.objects[n])}}))),s=this.getNewStoreWithTopBarPosition(s),be(s),vt(s)}}]),n}(Nn),Qn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(me.a)(this,n),t.apply(this,arguments)}return Object(ye.a)(n,[{key:"run",value:function(){var e=this,t=[],n=[],i=[],o=[],a=[],s=Object(we.default)(this.store,(function(s){e.event.payload.objects.forEach((function(e){if(void 0!==s.objects[e.id]){var o=s.objects[e.id],a=o.objectType===g.Group,r=void 0!==o.groupId&&o.groupId.length>0;a?!1===t.includes(o.id)&&(1,t.push(o.id)):r?(1,i.push(o.id),n.push(o.id),void 0!==o.groupId&&s.objects[o.groupId]&&!1===t.includes(o.groupId)&&(1,t.push(o.groupId))):(1,i.push(o.id))}else console.warn("object not found in store",e.id)})),void 0!==e.event.payload.removed&&e.event.payload.removed.length>0?(s.selectedIds=[],e.event.payload.objects.forEach((function(t){var n=t.id;if(void 0!==s.objects[n]){if(s.objects[n].objectType===g.Group){e.selectObjectOnThreeScene(s.objects[n],!1);var i=s.objects[n].childrenIds;return i.forEach((function(e){s.objects[e].groupId=void 0})),o.push(Object(v.cloneDeep)({childrenIds:i,id:n})),void delete s.objects[n]}s.objects[n].groupId=void 0}})),e.event.payload.removed.forEach((function(e){if(void 0!==e&&void 0!==e.id){var t=new E.a;e.childrenIds.forEach((function(e){var n=an.objects.get(e);void 0!==n&&t.expandByObject(n)}));var n=t.max.x-t.min.x,i=t.max.y-t.min.y,o=Ee({id:e.id,childrenIds:e.childrenIds,position:{x:t.min.x+n/2,y:t.min.y+i/2},width:n,height:i});s.objects[e.id]=o,a.push(o),s.selectedIds.push(o.id),e.childrenIds&&e.childrenIds.forEach((function(e){void 0!==s.objects[e]&&(s.objects[e].groupId=o.id,s.selectedIds.push(e))}))}}))):t.forEach((function(t){if(void 0!==s.objects[t]){e.selectObjectOnThreeScene(s.objects[t],!1);var n=s.objects[t].childrenIds;n.forEach((function(e){s.objects[e].groupId=void 0})),o.push(Object(v.cloneDeep)({id:t,childrenIds:n})),delete s.objects[t]}})),s.selectedIds=[].concat(i)}));if(this.saveToHistory){var r,c={do:this.event,redo:{name:$.UngroupObjects,payload:{objects:s.selectedIds.map((function(e){return Object(v.cloneDeep)({id:e})})),removed:null===(r=this.event.payload.removed)||void 0===r?void 0:r.map((function(e){var t=e.id,n=e.childrenIds;return Object(v.cloneDeep)({id:t,childrenIds:n})}))}},undo:{name:$.GroupObjects,payload:{objects:this.event.payload.objects,removed:o.map((function(e){return{id:e.id,childrenIds:e.childrenIds}}))}},createdAt:Object(zn.a)(new Date)};this.history.push(c)}s=this.getStoreWithHistory(s),this.event.payload.objects.forEach((function(t){e.selectObjectOnThreeScene(t,!1)})),Mn(o.map((function(t){var n=t.id;return void 0===e.store.objects[n]?{id:n,objectType:""}:{id:n,objectType:e.store.objects[n].objectType}}))),Mn(this.event.payload.objects.map((function(t){var n=t.id;return void 0===e.store.objects[n]?{id:n,objectType:""}:{id:n,objectType:e.store.objects[n].objectType}}))),a.forEach((function(e){Dn(s.objects[e.id])})),i.forEach((function(e){Dn(s.objects[e])})),s.selectedIds.forEach((function(t){e.selectObjectOnThreeScene(s.objects[t],!0)})),Y(a.map((function(e){var t=e.id;return{action:T.CREATE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(s.objects[t])}}))),Y(i.map((function(e){return{action:T.UPDATE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(s.objects[e])}}))),Y(o.map((function(t){var n=t.id;return{action:T.DELETE,createdAt:(new Date).toISOString(),object:Object(v.cloneDeep)(e.store.objects[n])}}))),s=this.getNewStoreWithTopBarPosition(s),be(s),vt(s)}}]),n}(Nn),ei=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];re("dispatchEvent",e.name,e.payload,"saveToHistory",n);var i=(t={},Object(J.a)(t,$.AddObjects,Ln),Object(J.a)(t,$.RemoveObjects,Hn),Object(J.a)(t,$.ChangeSelectObjects,Un),Object(J.a)(t,$.ChangeObjectsProperty,Fn),Object(J.a)(t,$.ChangeUiSettings,Gn),Object(J.a)(t,$.ChangeObjectsProperty,Fn),Object(J.a)(t,$.ClipboardCopy,Yn),Object(J.a)(t,$.ClipboardCut,Xn),Object(J.a)(t,$.ClipboardPaste,Wn),Object(J.a)(t,$.AddMultipleBeads,Vn),Object(J.a)(t,$.ChangeUiSettingsZoom,Zn),Object(J.a)(t,$.ChangeUiSettingsSidebar,Kn),Object(J.a)(t,$.ChangeObjectsAlignment,qn),Object(J.a)(t,$.DuplicateObjects,Jn),Object(J.a)(t,$.GroupObjects,$n),Object(J.a)(t,$.UngroupObjects,Qn),t);if(void 0!==i[e.name]){var o=ln(),a=he(),s=i[e.name],r=new s(e,a,o,n);r.run(je(),ge())}else console.warn("event handler not found to name",e);return e},ti=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0];n("board:action_type.EditBeadProduct"),n("board:action_type.EditBeadType"),n("board:action_type.EditBeadMaterial"),n("board:action_type.EditBeadColor"),n("board:action_type.EditRegionShape"),n("board:action_type.EditRegionGridType"),n("board:action_type.EditRegionGridSettings"),n("board:action_type.EditPosition"),n("board:action_type.EditRotate"),n("board:action_type.EditWidthHeight"),n("board:action_type.EditWidthHeightDepth"),n("board:action_type.Alignment"),n("board:action_type.Lock"),n("board:action_type.Unlock"),n("board:action_type.Group"),n("board:action_type.Ungroup"),n("board:action_type.More");return Object(V.jsx)(ni,{children:Object(V.jsx)("div",{className:"actions-group",children:e.actions.map((function(t,i){return t===F.More?Object(V.jsx)(oi,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},i):t===F.EditBeadColor?Object(V.jsx)(ai,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},i):t===F.EditRegionGridType?Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)(ie.a,{icon:ne.E})})})},i):t===F.EditRegionGridSettings?Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)(ie.a,{icon:ne.g})})})},i):t===F.EditPosition?Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)(ie.a,{icon:ne.n})})})},i):t===F.EditRotate?Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)(ie.a,{icon:ne.I})})})},i):t===F.EditWidthHeight||t===F.EditWidthHeightDepth?Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)(ie.a,{icon:ne.f})})})},i):t===F.Alignment?Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsxs)("div",{className:"align-icons-wrapper",children:[Object(V.jsx)(ie.a,{icon:ne.b}),Object(V.jsx)(ie.a,{icon:ne.j,size:"sm"})]})})})},i):t===F.EditBeadType?Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"align-icons-wrapper",children:Object(V.jsx)(ie.a,{icon:ne.E})})})})},i):t===F.EditBeadProduct?Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"align-icons-wrapper",children:Object(V.jsx)(ie.a,{icon:ne.D})})})})},i):t===F.Lock?Object(V.jsx)(ri,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},i):t===F.Unlock?Object(V.jsx)(si,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},i):t===F.EditBeadMaterial?Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"align-icons-wrapper",children:Object(V.jsx)(ie.a,{icon:ne.h})})})})},i):t===F.Group?Object(V.jsx)(ci,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},i):t===F.Ungroup?Object(V.jsx)(di,{onClick:e.onClick,type:t,selectedAction:e.selectedAction},i):Object(V.jsx)(ii,{onClick:e.onClick,type:t,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(t)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)(ie.a,{icon:ne.M})})})},i)}))})})},ni=b.c.div(xn||(xn=Object(p.a)(['\n  height: 100%;\n\n  .more-icon-action-type {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 40px;\n    svg path {\n      fill: var(--gray);\n    }\n    div {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n  }\n  .icon-action-type-color {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 50px;\n  }\n  .icon-action-type {\n    width: 50px;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: var(--standardPadding);\n    padding-right: var(--standardPadding);\n  }\n  .icon-action-type-color {\n    .value {\n      height: 30px;\n      width: 30px;\n      background: transparent;\n      border-radius: 30px;\n      border: 1px solid #000;\n    }\n  }\n  .action-item-wrapper {\n    height: 100%;\n    transition: all 0.4s ease-in-out;\n  }\n  .action-item-wrapper.active {\n    background: rgba(0, 0, 0, 0.2);\n  }\n  .actions-group {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    position: relative;\n    height: 100%;\n    &:before {\n      content: "";\n      position: absolute;\n      top: 50%;\n      left: calc(var(--standardPadding) * -1);\n      height: 70%;\n      transform: translate(0, -50%);\n      width: 1px;\n      background: var(--gray);\n    }\n  }\n  .align-icons-wrapper {\n    column-gap: var(--standardPadding);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  .long-press-wrapper {\n    height: 100%;\n    position: relative;\n    &.active {\n      .long-press-ghost {\n        max-width: 100%;\n      }\n    }\n    .long-press-ghost {\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 2;\n      overflow: hidden;\n      background: #eee;\n      max-width: 0%;\n      height: 100%;\n      transition-property: all;\n      animation-timing-function: cubic-bezier(0.25, 0.1, 1, 1);\n      animation-fill-mode: forwards;\n      width: 100%;\n    }\n    .long-press-icon {\n      position: relative;\n      z-index: 3;\n      height: 100%;\n      width: 110px;\n      display: flex;\n      column-gap: var(--standardPadding);\n      padding-left: 30px;\n      .icon-wrapper {\n        position: absolute;\n        top: 50%;\n        left: 5px;\n        transform: translate(0, -50%);\n        font-size: 18px;\n      }\n\n      .label-wrapper {\n        font-size: 13px;\n        display: flex;\n        justify-content: center;\n        text-align: center;\n        align-content: center;\n        position: absolute;\n        top: 50%;\n        left: 30px;\n        transform: translate(0, -50%);\n      }\n    }\n  }\n']))),ii=function(e){var t=s.a.useRef(null);return Object(V.jsx)("div",{className:"action-item-wrapper ".concat(void 0!==e.selectedAction&&e.selectedAction===e.type?"active":""),ref:function(e){return t.current=e},onClick:function(){if(t.current){var n=t.current,i=n.offsetLeft,o=n.offsetParent,a=n.offsetWidth,s=0;o?s=o.offsetLeft:console.warn("ref parent element not found");var r=s+i+a/2;e.onClick(e.type,r)}else console.warn("ref element not found")},children:e.children})},oi=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0];return Object(V.jsx)(ii,{onClick:e.onClick,type:e.type,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"more-icon-action-type ",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(e.selectedAction)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)(ie.a,{icon:ne.o})})})})},ai=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0],i=Object(q.b)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].color;!1===t.includes(i)&&t.push(i)}})),t}));return 0===i.length?Object(V.jsx)(s.a.Fragment,{}):Object(V.jsx)(ii,{onClick:e.onClick,type:e.type,selectedAction:e.selectedAction,children:Object(V.jsx)("div",{className:"icon-action-type-color",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(e.selectedAction)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"value",style:{background:"linear-gradient(to right, ".concat(1===i.length?[i[0],i[0]].join():i.slice(0,10).join(),")")},children:"\xa0"})})})})},si=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0],i=s.a.useState(!1),o=Object(d.a)(i,2),a=o[0],r=o[1],c=function(){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(e){return{id:e,properties:{isLocked:!1}}}))}};ei(n),e.onClick(void 0,void 0)};s.a.useEffect((function(){var e;return a?e=setTimeout(c,600):clearTimeout(e),function(){clearTimeout(e)}}),[a]);var l=s.a.useCallback((function(){r(!0)}),[]),u=s.a.useCallback((function(){r(!1)}),[]);return Object(V.jsxs)("div",{onMouseDown:l,onMouseUp:u,onMouseLeave:u,onTouchStart:l,onTouchEnd:u,className:"long-press-wrapper ".concat(a?"active":""),children:[Object(V.jsx)("div",{className:"long-press-ghost",style:{transitionDuration:"".concat(600,"ms")},children:"\xa0"}),Object(V.jsxs)("div",{className:"long-press-icon",children:[Object(V.jsx)("div",{className:"icon-wrapper",children:Object(V.jsx)(ie.a,{icon:ne.u})}),Object(V.jsx)("div",{className:"label-wrapper",children:Object(V.jsx)("span",{children:n("board:edit_bead_popup.long_press_to_unlock")})})]})]})},ri=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0];return Object(V.jsx)(ii,{onClick:function(){var e=he(),t={name:$.ChangeSelectObjects,payload:{change:e.selectedIds.map((function(e){return{id:e,isSelected:!1}}))}};ei(t);var n={name:$.ChangeObjectsProperty,payload:{changes:e.selectedIds.map((function(e){return{id:e,properties:{isLocked:!0}}}))}};ei(n)},type:F.Lock,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(F.Lock)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"align-icons-wrapper",children:Object(V.jsx)(ie.a,{icon:ne.O})})})})})},ci=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0];return Object(V.jsx)(ii,{onClick:function(){var e=he(),t={name:$.GroupObjects,payload:{objects:e.selectedIds.map((function(t){return Object(v.cloneDeep)(e.objects[t])}))}};ei(t)},type:e.type,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(e.type)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"align-icons-wrapper",children:Object(V.jsx)(ie.a,{icon:ne.x})})})})})},di=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0];return Object(V.jsx)(ii,{onClick:function(){var e=he(),t={name:$.UngroupObjects,payload:{objects:e.selectedIds.map((function(t){return Object(v.cloneDeep)(e.objects[t])}))}};ei(t)},type:e.type,children:Object(V.jsx)("div",{className:"icon-action-type",children:Object(V.jsx)("div",{"data-tip":n("board:action_type.".concat(e.type)),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"align-icons-wrapper",children:Object(V.jsx)(ie.a,{icon:ne.y})})})})})},li=n(167),ui=n(170),pi=n(33),hi=n(37),bi="undefined"!=typeof document,vi=/^[+-]?((\.\d+)|(\d+(\.\d+)?))$/,fi=/^([+-]0?|[0-9]*\.0*|[+-]\.0*|[+-]?\d+\.)?$/;function ji(e,t,n){var i=e[t];if("function"==typeof i){for(var o=arguments.length,a=new Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];i=i.apply(void 0,a)}return void 0===i?n:i}var gi=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e){var i;return Object(me.a)(this,n),(i=t.call(this,e))._timer=void 0,i._valid=void 0,i._isStrict=void 0,i._ignoreValueChange=void 0,i._isMounted=void 0,i._inputFocus=void 0,i.refsWrapper=void 0,i.refsInput=void 0,i.state=void 0,i._isStrict=!!i.props.strict,i.state=Object(pi.a)({btnDownHover:!1,btnDownActive:!1,btnUpHover:!1,btnUpActive:!1,stringValue:""},i._propsToState(i.props)),i.stop=i.stop.bind(Object(hi.a)(i)),i.onTouchEnd=i.onTouchEnd.bind(Object(hi.a)(i)),i.refsInput=null,i.refsWrapper=null,i}return Object(ye.a)(n,[{key:"_propsToState",value:function(e){var t={};return e.hasOwnProperty("value")?(t.stringValue=String(e.value||0===e.value?e.value:"").trim(),t.value=""!==t.stringValue?this._parse(e.value):null):!this._isMounted&&e.hasOwnProperty("defaultValue")&&(t.stringValue=String(e.defaultValue||0===e.defaultValue?e.defaultValue:"").trim(),t.value=""!==e.defaultValue?this._parse(e.defaultValue):null),t}},{key:"componentWillReceiveProps",value:function(e){var t=this;this._isStrict=!!e.strict;var n=this._propsToState(e);Object.keys(n).length&&(this._ignoreValueChange=!0,this.setState(n,(function(){t._ignoreValueChange=!1})))}},{key:"componentWillUpdate",value:function(){this.saveSelection()}},{key:"componentDidUpdate",value:function(e,t){var n;this._ignoreValueChange||t.value===this.state.value||isNaN(null!==(n=this.state.value)&&void 0!==n?n:Number.NaN)&&null!==this.state.value||this._invokeEventCallback("onChange",this.state.value,this.refsInput.value,this.refsInput),this._inputFocus&&(this.refsInput.focus(),(this.state.selectionStart||0===this.state.selectionStart)&&(this.refsInput.selectionStart=this.state.selectionStart),(this.state.selectionEnd||0===this.state.selectionEnd)&&(this.refsInput.selectionEnd=this.state.selectionEnd)),this.checkValidity()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.stop()}},{key:"componentDidMount",value:function(){var e=this;this._isMounted=!0,this.refsInput.getValueAsNumber=function(){return e.state.value||0},this.refsInput.setValue=function(t){e.setState({value:e._parse(t),stringValue:t})},!this._inputFocus&&bi&&document.activeElement===this.refsInput&&(this._inputFocus=!0,this.refsInput.focus(),this._invokeEventCallback("onFocus",{target:this.refsInput,type:"focus"})),this.checkValidity()}},{key:"saveSelection",value:function(){this.state.selectionStart=this.refsInput.selectionStart,this.state.selectionEnd=this.refsInput.selectionEnd}},{key:"checkValidity",value:function(){var e,t="",n=!!this.refsInput.checkValidity,i=!(!this.props.noValidate||"false"===this.props.noValidate);this.refsInput.noValidate=i,(e=i||!n)?t="":(""===this.refsInput.pattern&&(this.refsInput.pattern=this.props.required?".+":".*"),n&&(this.refsInput.checkValidity(),(e=this.refsInput.validity.valid)||(t=this.refsInput.validationMessage)),e&&n&&this.props.maxLength&&this.refsInput.value.length>this.props.maxLength&&(t="This value is too long")),t=t||(e?"":this.refsInput.validationMessage||"Unknown Error");var o=this._valid!==t;this._valid=t,t?(!function(e,t){if(e.classList)return e.classList.add(t);e.className.search(new RegExp("\\b"+t+"\\b"))||(e.className=" "+t)}(this.refsWrapper,"has-error"),o&&this._invokeEventCallback("onInvalid",t,this.state.value,this.refsInput.value)):(!function(e,t){if(e.className){if(e.classList)return e.classList.remove(t);e.className=e.className.replace(new RegExp("\\b"+t+"\\b","g"),"")}}(this.refsWrapper,"has-error"),o&&this._invokeEventCallback("onValid",this.state.value,this.refsInput.value))}},{key:"_toNumber",value:function(e){var t=parseFloat(e);if(!isNaN(t)&&isFinite(t)||(t=0),this._isStrict){var i=ji(this.props,"precision",null,this),o=Math.pow(10,null===i?10:i),a=+ji(this.props,"min",n.defaultProps.min,this),s=+ji(this.props,"max",n.defaultProps.max,this);t=Math.min(Math.max(t,a),s),t=Math.round(t*o)/o}return t}},{key:"_parse",value:function(e){return e=String(e),"function"==typeof this.props.parse?parseFloat(this.props.parse(e)):parseFloat(e)}},{key:"_format",value:function(e){var t=this._toNumber(e).toString(),n=ji(this.props,"precision",null,this);return null!==n&&(t=e.toFixed(n)),t+="",this.props.format?this.props.format(t):t}},{key:"_step",value:function(e,t){var i=this._isStrict;this._isStrict=!0;var o=+ji(this.props,"step",n.defaultProps.step,this,e>0?n.DIRECTION_UP:n.DIRECTION_DOWN),a=this._toNumber((this.state.value||0)+o*e);return this.props.snap&&(a=Math.round(a/o)*o),this._isStrict=i,a!==this.state.value&&(this.setState({value:a,stringValue:a+""},t),!0)}},{key:"_onKeyDown",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].persist(),this._invokeEventCallback.apply(this,["onKeyDown"].concat(t));var i=t[0];if(!i.isDefaultPrevented())if(38===i.keyCode)i.preventDefault(),this._step(i.ctrlKey||i.metaKey?.1:i.shiftKey?10:1);else if(40===i.keyCode)i.preventDefault(),this._step(i.ctrlKey||i.metaKey?-.1:i.shiftKey?-10:-1);else{var o=this.refsInput.value,a=o.length;8===i.keyCode?this.refsInput.selectionStart===this.refsInput.selectionEnd&&this.refsInput.selectionEnd>0&&o.length&&"."===o.charAt(this.refsInput.selectionEnd-1)&&(i.preventDefault(),this.refsInput.selectionStart=this.refsInput.selectionEnd=this.refsInput.selectionEnd-1):46===i.keyCode?this.refsInput.selectionStart===this.refsInput.selectionEnd&&this.refsInput.selectionEnd<a+1&&o.length&&"."===o.charAt(this.refsInput.selectionEnd)&&(i.preventDefault(),this.refsInput.selectionStart=this.refsInput.selectionEnd=this.refsInput.selectionEnd+1):i.keyCode}}},{key:"stop",value:function(){this._timer&&clearTimeout(this._timer)}},{key:"increase",value:function(){var e,t,i=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0;this.stop(),this._step(1,a);var s=+ji(this.props,"max",n.defaultProps.max,this);(isNaN(null!==(e=this.state.value)&&void 0!==e?e:Number.NaN)||+(null!==(t=this.state.value)&&void 0!==t?t:Number.NaN)<s)&&(this._timer=setTimeout((function(){i.increase(!0)}),o?n.SPEED:n.DELAY))}},{key:"decrease",value:function(){var e,t,i=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0;this.stop(),this._step(-1,a);var s=+ji(this.props,"min",n.defaultProps.min,this);(isNaN(null!==(e=this.state.value)&&void 0!==e?e:Number.NaN)||+(null!==(t=this.state.value)&&void 0!==t?t:Number.NaN)>s)&&(this._timer=setTimeout((function(){i.decrease(!0)}),o?n.SPEED:n.DELAY))}},{key:"onMouseDown",value:function(e,t){"down"===e?this.decrease(!1,t):"up"===e&&this.increase(!1,t)}},{key:"onTouchStart",value:function(e,t){t.preventDefault(),"down"===e?this.decrease():"up"===e&&this.increase()}},{key:"onTouchEnd",value:function(e){e.preventDefault(),this.stop()}},{key:"_invokeEventCallback",value:function(e){if("function"==typeof this.props[e]){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this.props[e]).call.apply(t,[null].concat(i))}}},{key:"render",value:function(){var e=this,t=this.props,i=this.state,o={},a=this.props,s=(a.step,a.min,a.max,a.precision,a.parse,a.format,a.mobile),r=(a.snap,a.componentClass),c=(a.value,a.type,a.style),d=(a.defaultValue,a.onInvalid,a.onValid,a.strict,a.noStyle),l=Object(ui.a)(a,["step","min","max","precision","parse","format","mobile","snap","componentClass","value","type","style","defaultValue","onInvalid","onValid","strict","noStyle"]);for(var u in d=d||!1===c,n.style)o[u]=Object.assign({},n.style[u],c&&c[u]||{});var p=t.className&&/\bform-control\b/.test(t.className);"auto"===s&&(s=bi&&"ontouchstart"in document),"function"==typeof s&&(s=s.call(this)),s=!!s;var h={wrap:{style:d?null:o.wrap,className:"react-numeric-input",ref:function(t){null!==t&&void 0!==t&&(e.refsWrapper=t)},onMouseUp:void 0,onMouseLeave:void 0},input:Object(pi.a)({ref:function(t){null!==t&&void 0!==t&&(e.refsInput=t)},type:"text",style:d?null:Object.assign({},o.input,p?{}:o["input:not(.form-control)"],this._inputFocus?o["input:focus"]:{})},l),btnUp:{onMouseEnter:void 0,onMouseDown:void 0,onMouseUp:void 0,onMouseLeave:void 0,onTouchStart:void 0,onTouchEnd:void 0,style:d?null:Object.assign({},o.btn,o.btnUp,t.disabled||t.readOnly?o["btn:disabled"]:i.btnUpActive?o["btn:active"]:i.btnUpHover?o["btn:hover"]:{})},btnDown:{onMouseEnter:void 0,onMouseDown:void 0,onMouseUp:void 0,onMouseLeave:void 0,onTouchStart:void 0,onTouchEnd:void 0,style:d?null:Object.assign({},o.btn,o.btnDown,t.disabled||t.readOnly?o["btn:disabled"]:i.btnDownActive?o["btn:active"]:i.btnDownHover?o["btn:hover"]:{})}},b=String(i.stringValue||(i.value||0===i.value?i.value:"")||""),v=!this._isStrict&&(this._inputFocus||!this._isMounted);v&&fi.test(b)||v&&b&&!vi.test(b)?h.input.value=b:i.value||0===i.value?h.input.value=this._format(i.value):h.input.value="",p&&!d&&Object.assign(h.wrap.style,o["wrap.hasFormControl"]),s&&!d&&(Object.assign(h.input.style,o["input.mobile"]),Object.assign(h.btnUp.style,o["btnUp.mobile"]),Object.assign(h.btnDown.style,o["btnDown.mobile"])),t.disabled||t.readOnly?!d&&t.disabled&&Object.assign(h.input.style,o["input:disabled"]):(Object.assign(h.wrap,{onMouseUp:this.stop,onMouseLeave:this.stop}),Object.assign(h.btnUp,{onTouchStart:this.onTouchStart.bind(this,"up"),onTouchEnd:this.onTouchEnd,onMouseEnter:function(){e.setState({btnUpHover:!0})},onMouseLeave:function(){e.stop(),e.setState({btnUpHover:!1,btnUpActive:!1})},onMouseUp:function(){e.setState({btnUpHover:!0,btnUpActive:!1})},onMouseDown:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];n[0].preventDefault(),n[0].persist(),e._inputFocus=!0,e.setState({btnUpHover:!0,btnUpActive:!0},(function(){e._invokeEventCallback.apply(e,["onFocus"].concat(n)),e.onMouseDown("up")}))}}),Object.assign(h.btnDown,{onTouchStart:this.onTouchStart.bind(this,"down"),onTouchEnd:this.onTouchEnd,onMouseEnter:function(){e.setState({btnDownHover:!0})},onMouseLeave:function(){e.stop(),e.setState({btnDownHover:!1,btnDownActive:!1})},onMouseUp:function(){e.setState({btnDownHover:!0,btnDownActive:!1})},onMouseDown:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];n[0].preventDefault(),n[0].persist(),e._inputFocus=!0,e.setState({btnDownHover:!0,btnDownActive:!0},(function(){e._invokeEventCallback.apply(e,["onFocus"].concat(n)),e.onMouseDown("down")}))}}),Object.assign(h.input,{onChange:function(t){var n=t.target.value,i=e._parse(n);isNaN(i)&&(i=null),e.setState({value:e._isStrict?e._toNumber(i):i,stringValue:n})},onKeyDown:this._onKeyDown.bind(this),onInput:function(){e.saveSelection();for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e._invokeEventCallback.apply(e,["onInput"].concat(n))},onSelect:function(){e.saveSelection();for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e._invokeEventCallback.apply(e,["onSelect"].concat(n))},onFocus:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];n[0].persist(),e._inputFocus=!0;var o=e._parse(n[0].target.value);e.setState({value:o,stringValue:o||0===o?o+"":""},(function(){e._invokeEventCallback.apply(e,["onFocus"].concat(n))}))},onBlur:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o=e._isStrict;e._isStrict=!0,n[0].persist(),e._inputFocus=!1;var a=e._parse(n[0].target.value);e.setState({value:a},(function(){e._invokeEventCallback.apply(e,["onBlur"].concat(n)),e._isStrict=o}))}}));var f=r||"input";return s?Object(V.jsxs)("span",Object(pi.a)(Object(pi.a)({},h.wrap),{},{children:[Object(V.jsx)(f,Object(pi.a)({},h.input)),Object(V.jsxs)("b",Object(pi.a)(Object(pi.a)({},h.btnUp),{},{children:[Object(V.jsx)("i",{style:d?null:o.minus}),Object(V.jsx)("i",{style:d?null:o.plus})]})),Object(V.jsx)("b",Object(pi.a)(Object(pi.a)({},h.btnDown),{},{children:Object(V.jsx)("i",{style:d?null:o.minus})}))]})):Object(V.jsxs)("span",Object(pi.a)(Object(pi.a)({},h.wrap),{},{children:[Object(V.jsx)(f,Object(pi.a)({},h.input)),Object(V.jsx)("b",Object(pi.a)(Object(pi.a)({},h.btnUp),{},{children:Object(V.jsx)("i",{style:d?null:o.arrowUp})})),Object(V.jsx)("b",Object(pi.a)(Object(pi.a)({},h.btnDown),{},{children:Object(V.jsx)("i",{style:d?null:o.arrowDown})}))]}))}}]),n}(a.Component);gi.defaultProps={step:1,min:Number.MIN_SAFE_INTEGER||-9007199254740991,max:Number.MAX_SAFE_INTEGER||9007199254740991,precision:null,parse:null,format:null,mobile:"auto",strict:!1,componentClass:"input",style:{}},gi.style={wrap:{position:"relative",display:"inline-block"},"wrap.hasFormControl":{display:"block"},arrowUp:{position:"absolute",top:"50%",left:"50%",width:0,height:0,borderWidth:"0 0.6ex 0.6ex 0.6ex",borderColor:"transparent transparent rgba(0, 0, 0, 0.7)",borderStyle:"solid",margin:"-0.3ex 0 0 -0.56ex"},arrowDown:{position:"absolute",top:"50%",left:"50%",width:0,height:0,borderWidth:"0.6ex 0.6ex 0 0.6ex",borderColor:"rgba(0, 0, 0, 0.7) transparent transparent",borderStyle:"solid",margin:"-0.3ex 0 0 -0.56ex"},plus:{position:"absolute",top:"50%",left:"50%",width:2,height:10,background:"rgba(0,0,0,.7)",margin:"-5px 0 0 -1px"},minus:{position:"absolute",top:"50%",left:"50%",width:10,height:2,background:"rgba(0,0,0,.7)",margin:"-1px 0 0 -5px"},btn:{position:"absolute",right:2,width:"2.26ex",borderColor:"rgba(0,0,0,.1)",borderStyle:"solid",textAlign:"center",cursor:"default",transition:"all 0.1s",background:"rgba(0,0,0,.1)",boxShadow:"-1px -1px 3px rgba(0,0,0,.1) inset,1px 1px 3px rgba(255,255,255,.7) inset"},btnUp:{top:2,bottom:"50%",borderRadius:"2px 2px 0 0",borderWidth:"1px 1px 0 1px"},"btnUp.mobile":{width:"3.3ex",bottom:2,boxShadow:"none",borderRadius:2,borderWidth:1},btnDown:{top:"50%",bottom:2,borderRadius:"0 0 2px 2px",borderWidth:"0 1px 1px 1px"},"btnDown.mobile":{width:"3.3ex",bottom:2,left:2,top:2,right:"auto",boxShadow:"none",borderRadius:2,borderWidth:1},"btn:hover":{background:"rgba(0,0,0,.2)"},"btn:active":{background:"rgba(0,0,0,.3)",boxShadow:"0 1px 3px rgba(0,0,0,.2) inset,-1px -1px 4px rgba(255,255,255,.5) inset"},"btn:disabled":{opacity:.5,boxShadow:"none",cursor:"not-allowed"},input:{paddingRight:"3ex",boxSizing:"border-box",fontSize:"inherit"},"input:not(.form-control)":{border:"1px solid #ccc",borderRadius:2,paddingLeft:4,display:"block",WebkitAppearance:"none",lineHeight:"normal"},"input.mobile":{paddingLeft:" 3.4ex",paddingRight:"3.4ex",textAlign:"center"},"input:focus":{},"input:disabled":{color:"rgba(0, 0, 0, 0.3)",textShadow:"0 1px 0 rgba(255, 255, 255, 0.8)"}},gi.SPEED=50,gi.DELAY=500,gi.DIRECTION_UP="up",gi.DIRECTION_DOWN="down";var mi,yi,xi,Oi,wi,ki,Di,Si,Ei,Ii,Ci,Ti,_i,Bi,Pi,Mi,Ri,Ai,Ni,zi,Li,Hi,Ui,Fi,Gi=n(119),Yi=(n(292),(0,Gi.a.createSliderWithTooltip)(Gi.a)),Xi=function(e){var t=e.offsetLeft;return e.type!==F.EditRotate&&e.type!==F.EditPosition||(t=e.offsetLeft-150),e.type!==F.EditWidthHeight&&e.type!==F.EditWidthHeightDepth||(t=e.offsetLeft-250),Object(V.jsx)(Wi,{children:Object(V.jsxs)("div",{className:"popup-wrapper",style:{left:t},children:[e.type===F.EditBeadColor?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(Vi,{})}):null,e.type===F.More?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(co,{})}):null,e.type===F.EditRegionShape?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(Qi,{})}):null,e.type===F.EditRegionGridType?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)($i,{})}):null,e.type===F.EditRegionGridSettings?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(eo,{})}):null,e.type===F.EditPosition?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(no,{})}):null,e.type===F.EditRotate?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(oo,{})}):null,e.type===F.EditWidthHeight?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(ao,{})}):null,e.type===F.EditWidthHeightDepth?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(so,{})}):null,e.type===F.Alignment?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(ro,{})}):null,e.type===F.EditBeadType?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(Ki,{})}):null,e.type===F.EditBeadProduct?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(qi,{})}):null,e.type===F.EditBeadMaterial?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsx)(Ji,{})}):null,e.type!==F.More&&e.type!==F.EditRegionGridType&&e.type!==F.EditPosition&&e.type!==F.EditRotate&&e.type!==F.EditWidthHeight&&e.type!==F.EditWidthHeightDepth&&e.type!==F.Alignment&&e.type!==F.EditRegionGridSettings&&e.type!==F.EditRegionShape&&e.type!==F.EditBeadType&&e.type!==F.EditBeadProduct&&e.type!==F.EditBeadMaterial&&e.type!==F.EditBeadColor?Object(V.jsx)("div",{className:"popup-wrapper-content",children:Object(V.jsxs)("div",{children:["popup of type: ",e.type]})}):null]})})},Wi=b.c.div(mi||(mi=Object(p.a)(["\n  .popup-wrapper {\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    background: #fff;\n    transform: translate(-50%, 0);\n    margin-top: 8px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    padding: var(--standardPadding);\n  }\n  .region-type-selection {\n    display: flex;\n    column-gap: var(--standardPadding);\n  }\n  .region-type-item {\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n    &.active {\n      background: rgba(0, 0, 0, 0.1);\n    }\n    svg path {\n      transition: all 0.4s ease-in-out;\n    }\n    &:hover {\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .columns-input {\n    width: 120px;\n  }\n  .fieldset-wrapper fieldset {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    column-gap: var(--standardPadding);\n  }\n  .region-grid-settings {\n    display: flex;\n    flex-direction: column;\n    row-gap: var(--standardPadding);\n  }\n"]))),Vi=function(e){var t=Object(q.b)((function(e){return e.selectedIds})),n=Object(q.b)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].color;!1===t.includes(i)&&t.push(i)}})),t}));return Object(V.jsx)("div",{children:Object(V.jsx)(Zi,{children:Object(V.jsx)(li.a,{width:300,height:300,onChangeComplete:function(e){var n={name:$.ChangeObjectsProperty,payload:{changes:t.map((function(t){return{id:t,properties:{color:e.hex}}}))}};ei(n)},color:n.length>1?void 0:n[0],className:"SwatchesPicker-custom"})})})},Zi=b.c.div(yi||(yi=Object(p.a)(["\n  .SwatchesPicker-custom > div > div:first-child {\n    display: none !important;\n  }\n"]))),Ki=function(e){var t=Object(q.b)((function(e){return e.selectedIds})),n=Object(q.b)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].type;!1===t.includes(i)&&t.push(i)}})),t})),o=function(e){var n={name:$.ChangeObjectsProperty,payload:{changes:t.map((function(t){return{id:t,properties:{type:e}}}))}};ei(n)};return Object(V.jsxs)("div",{style:{display:"flex"},children:[Object(V.jsx)("div",{onClick:function(){o(i.MODEL_CYLINDER)},className:"region-type-item ".concat(1===n.length&&n[0]===i.MODEL_CYLINDER?"active":""),children:Object(V.jsx)(ie.a,{icon:ne.G})}),Object(V.jsx)("div",{onClick:function(){o(i.MODEL_SPHERE)},className:"region-type-item ".concat(1===n.length&&n[0]===i.MODEL_SPHERE?"active":""),children:Object(V.jsx)(ie.a,{icon:ne.l})}),Object(V.jsx)("div",{onClick:function(){o(i.MODEL_TOHO_ROUND)},className:"region-type-item ".concat(1===n.length&&n[0]===i.MODEL_TOHO_ROUND?"active":""),children:Object(V.jsx)(ie.a,{icon:ne.F})})]})},qi=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0],o=Object(q.b)((function(e){return e.selectedIds})),a=Object(q.b)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].type;!1===t.includes(i)&&t.push(i)}})),t})),s=function(e){var t={name:$.ChangeObjectsProperty,payload:{changes:o.map((function(t){return{id:t,properties:{type:e}}}))}};ei(t)},r=P({type:i.MODEL_CYLINDER}),c=P({type:i.MODEL_SPHERE}),l=P({type:i.MODEL_TOHO_ROUND});return Object(V.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(V.jsxs)("div",{style:{display:"flex"},children:[Object(V.jsx)("div",{onClick:function(){s(i.MODEL_CYLINDER)},className:"region-type-item ".concat(1===a.length&&a[0]===i.MODEL_CYLINDER?"active":""),children:Object(V.jsx)("img",{src:on.getObjectThumbnail(r,30,30),alt:""})}),Object(V.jsx)("div",{onClick:function(){s(i.MODEL_SPHERE)},className:"region-type-item ".concat(1===a.length&&a[0]===i.MODEL_SPHERE?"active":""),children:Object(V.jsx)("img",{src:on.getObjectThumbnail(c,30,30),alt:""})}),Object(V.jsx)("div",{onClick:function(){s(i.MODEL_TOHO_ROUND)},className:"region-type-item ".concat(1===a.length&&a[0]===i.MODEL_TOHO_ROUND?"active":""),children:Object(V.jsx)("img",{src:on.getObjectThumbnail(l,30,30),alt:""})})]}),Object(V.jsx)("div",{onClick:function(){var e=he(),t=Object(v.cloneDeep)(e.ui.modalSearchProducts);t.isOpen=!0,t.successAction="updateBeadType";var n={name:$.ChangeUiSettings,payload:{uiSettings:{modalSearchProducts:t}}};ei(n)},style:{cursor:"pointer"},children:n("board:edit_bead_popup.search_beads")})]})},Ji=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0],i=Object(q.b)((function(e){return e.selectedIds})),a=Object(q.b)((function(e){var t=[];return e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].material;!1===t.includes(i)&&t.push(i)}})),t})),s=function(e){var t={name:$.ChangeObjectsProperty,payload:{changes:i.map((function(t){return{id:t,properties:{material:e}}}))}};ei(t)};return Object(V.jsxs)("div",{style:{width:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[Object(V.jsx)("div",{onClick:function(){s(o.Mat)},className:"region-type-item ".concat(1===a.length&&a[0]===o.Mat?"active":""),children:n("board:edit_bead_popup.bead_material_mat")}),Object(V.jsx)("div",{onClick:function(){s(o.Shiny)},className:"region-type-item ".concat(1===a.length&&a[0]===o.Shiny?"active":""),children:n("board:edit_bead_popup.bead_material_shine")})]})},$i=function(e){var t=Object(q.b)((function(e){return e.selectedIds})),n=function(e){var n=he(),i={name:$.ChangeObjectsProperty,payload:{changes:t.map((function(t){var i=n.objects[t],o={gridType:e,shape:i.shape,columns:i.columns,rows:i.rows};if(e===f.Bricks&&i.shape===j.Triangle){var a=n.objects[t].columns,s=Pe(a),r=s.columns,c=s.rows;o.columns=r,o.rows=c}return{id:t,properties:o}}))}};ei(i)};return Object(V.jsxs)("div",{className:"region-type-selection",children:[Object(V.jsx)("div",{onClick:function(){n(f.Rectangles)},className:"region-type-item",children:Object(V.jsx)(ie.a,{icon:ne.r})}),Object(V.jsx)("div",{onClick:function(){n(f.Bricks)},className:"region-type-item",children:Object(V.jsx)(ie.a,{icon:ne.a})})]})},Qi=function(e){var t=Object(q.b)((function(e){return e.selectedIds})),n=function(e){var n=he(),i={name:$.ChangeObjectsProperty,payload:{changes:t.map((function(t){var i=n.objects[t],o={shape:e,gridType:i.gridType,columns:i.columns,rows:i.rows};if(i.gridType===f.Bricks&&e===j.Triangle){var a=n.objects[t].columns,s=Pe(a),r=s.columns,c=s.rows;o.columns=r,o.rows=c}return{id:t,properties:o}}))}};ei(i)};return Object(V.jsxs)("div",{className:"region-type-selection",children:[Object(V.jsx)("div",{onClick:function(){n(j.Rectangle)},className:"region-type-item",children:Object(V.jsx)(ie.a,{icon:ne.F})}),Object(V.jsx)("div",{onClick:function(){n(j.Triangle)},className:"region-type-item",children:Object(V.jsx)(ie.a,{icon:ne.A,style:{transform:"rotate(-90deg)"}})})]})},eo=function(){var e=Object(h.a)(["board"]),t=Object(d.a)(e,1)[0],n=Object(q.b)((function(e){var t=[],n=[],i=!0,o=!0;return e.selectedIds.forEach((function(a){if(void 0!==e.objects[a]){if(e.objects[a].objectType!==g.Region)return i=!1,void(o=!1);e.objects[a].gridType!==f.Bricks&&(i=!1),e.objects[a].shape!==j.Triangle&&(o=!1);var s=e.objects[a].columns,r=e.objects[a].rows;!1===t.includes(s)&&t.push(s),!1===n.includes(r)&&n.push(r)}})),{columns:t,rows:n,showRows:!(!0===i&&!0===o)}})),i=n.columns,o=n.rows,a=n.showRows;return Object(V.jsxs)("div",{className:"region-grid-settings",children:[Object(V.jsx)("div",{className:"region-grid-settings-columns",children:Object(V.jsx)(to,{defaultValue:i.length>1?void 0:i[0],max:20,min:1,step:1,showDecimal:!1,label:t("board:edit_bead_popup.region_columns"),onChange:function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){if(!t.objects[n])return{id:n,properties:{}};var i=t.objects[n],o={columns:e,rows:i.rows,shape:i.shape,gridType:i.gridType};if(!1===a){var s=Pe(e),r=s.columns,c=s.rows;o.columns=r,o.rows=c}return{id:n,properties:o}}))}};ei(n)}}})}),a?Object(V.jsx)("div",{className:"region-grid-settings-rows",children:Object(V.jsx)(to,{max:20,min:1,step:1,defaultValue:o.length>1?void 0:o[0],showDecimal:!1,label:t("board:edit_bead_popup.region_rows"),onChange:function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){if(!t.objects[n])return{id:n,properties:{}};var i=t.objects[n];return{id:n,properties:{shape:i.shape,gridType:i.gridType,columns:i.columns,rows:e}}}))}};ei(n)}}})}):null]})},to=function(e){return Object(V.jsx)("div",{children:Object(V.jsx)("div",{className:"fieldset-wrapper",children:Object(V.jsxs)("fieldset",{children:[Object(V.jsx)("label",{children:e.label}),Object(V.jsx)(gi,{min:e.min,max:e.max,step:e.step,className:"columns-input",value:e.defaultValue,strict:!0,onChange:e.onChange,mobile:!0,format:e.showDecimal?function(e){var t=!1;e<0&&(t=!0,e*=-1);var n=Math.pow(10,2);return e=parseFloat((e*n).toFixed(11)),e=(Math.round(e)/n).toFixed(2),t&&(e=(-1*e).toFixed(2)),e}:void 0})]})})})},no=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0],i=Object(q.b)((function(e){var t=[],n=[],i=[];return e.selectedIds.forEach((function(o){if(e.objects[o]){var a=e.objects[o].position.x,s=e.objects[o].position.y,r=e.objects[o].position.z;!1===t.includes(a)&&t.push(a),!1===n.includes(s)&&n.push(s),!1===i.includes(r)&&i.push(r)}})),{x:t,y:n,z:i}})),o=i.x,a=i.y,s=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){if(!t.objects[n])return{id:n,properties:{}};var i=t.objects[n];return{id:n,properties:{position:{x:e,y:i.position.y,z:i.position.z}}}}))}};ei(n)}},r=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){if(!t.objects[n])return{id:n,properties:{}};var i=t.objects[n];return{id:n,properties:{position:{x:i.position.x,y:e,z:i.position.z}}}}))}};ei(n)}};return Object(V.jsxs)("div",{children:[Object(V.jsx)("span",{children:n("board:edit_bead_popup.position")}),Object(V.jsx)("br",{}),Object(V.jsx)(to,{defaultValue:o.length>1?void 0:o[0],min:-1e3,max:1e3,showDecimal:!1,step:.1,label:n("board:edit_bead_popup.position_x"),onChange:s}),Object(V.jsx)(io,{value:o.length>1?0:o[0],onChange:s,min:-1e3,max:1e3}),Object(V.jsx)(to,{defaultValue:a.length>1?void 0:a[0],min:-1e3,max:1e3,showDecimal:!1,step:.1,label:n("board:edit_bead_popup.position_y"),onChange:r}),Object(V.jsx)(io,{value:a.length>1?0:a[0],onChange:r,min:-1e3,max:1e3})]})},io=function(e){var t=s.a.useState(e.value),n=Object(d.a)(t,2),i=n[0],o=n[1];return Object(V.jsx)("div",{style:{marginBottom:8,marginTop:8},children:Object(V.jsx)(Yi,{step:1,min:e.min,max:e.max,value:i,onChange:function(e){o(e)},onAfterChange:function(t){e.onChange(t)}})})},oo=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0],i=Object(q.b)((function(e){var t=[],n=[],i=[];return e.selectedIds.forEach((function(o){if(e.objects[o]){var a=e.objects[o].rotateX,s=e.objects[o].rotateY,r=e.objects[o].rotateZ;!1===t.includes(a)&&t.push(a),!1===n.includes(s)&&n.push(s),!1===i.includes(r)&&i.push(r)}})),{x:t,y:n,z:i}})),o=i.x,a=i.y,s=i.z,r=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{rotateX:e}}:{id:n,properties:{}}}))}};ei(n)}},c=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{rotateY:e}}:{id:n,properties:{}}}))}};ei(n)}},l=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{rotateZ:e}}:{id:n,properties:{}}}))}};ei(n)}};return Object(V.jsxs)("div",{children:[Object(V.jsx)("span",{children:n("board:edit_bead_popup.rotate")}),Object(V.jsx)("br",{}),Object(V.jsx)(to,{defaultValue:o.length>1?void 0:o[0],min:-360,max:360,showDecimal:!1,step:1,label:n("board:edit_bead_popup.rotate_x"),onChange:r}),Object(V.jsx)(io,{value:o.length>1?0:o[0],onChange:r,max:360,min:-360}),Object(V.jsx)(to,{defaultValue:a.length>1?void 0:a[0],min:-360,max:360,showDecimal:!1,step:1,label:n("board:edit_bead_popup.rotate_y"),onChange:c}),Object(V.jsx)(io,{value:a.length>1?0:a[0],onChange:c,max:360,min:-360}),Object(V.jsx)(to,{defaultValue:s.length>1?void 0:s[0],min:-360,max:360,step:1,showDecimal:!1,label:n("board:edit_bead_popup.rotate_z"),onChange:l}),Object(V.jsx)(io,{value:s.length>1?0:s[0],onChange:l,max:360,min:-360})]})},ao=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0],i=Object(q.b)((function(e){var t=[],n=[];return e.selectedIds.forEach((function(i){if(e.objects[i]){var o=e.objects[i].width,a=e.objects[i].height;!1===t.includes(o)&&t.push(o),!1===n.includes(a)&&n.push(a)}})),{width:t,height:n}})),o=i.width,a=i.height,s=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{width:e}}:{id:n,properties:{}}}))}};ei(n)}},r=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{height:e}}:{id:n,properties:{}}}))}};ei(n)}};return Object(V.jsxs)("div",{children:[Object(V.jsx)("span",{children:n("board:edit_bead_popup.size")}),Object(V.jsx)("br",{}),Object(V.jsx)(to,{defaultValue:o.length>1?void 0:o[0],max:500,min:1,step:.1,showDecimal:!0,label:n("board:edit_bead_popup.width"),onChange:s}),Object(V.jsx)(io,{value:o.length>1?0:o[0],onChange:s,max:500,min:1}),Object(V.jsx)(to,{defaultValue:a.length>1?void 0:a[0],max:500,min:1,step:.1,showDecimal:!0,label:n("board:edit_bead_popup.height"),onChange:r}),Object(V.jsx)(io,{value:a.length>1?0:a[0],onChange:r,max:500,min:1})]})},so=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0],i=Object(q.b)((function(e){var t=[],n=[],i=[];return e.selectedIds.forEach((function(o){if(e.objects[o]){var a=e.objects[o].width,s=e.objects[o].height,r=e.objects[o].depth;!1===t.includes(a)&&t.push(a),!1===n.includes(s)&&n.push(s),!1===i.includes(r)&&i.push(r)}})),{width:t,height:n,depth:i}})),o=i.width,a=i.height,s=i.depth,r=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{width:e}}:{id:n,properties:{}}}))}};ei(n)}},c=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{height:e}}:{id:n,properties:{}}}))}};ei(n)}},l=function(e){if(void 0!==e){var t=he(),n={name:$.ChangeObjectsProperty,payload:{changes:t.selectedIds.map((function(n){return t.objects[n]?{id:n,properties:{depth:e}}:{id:n,properties:{}}}))}};ei(n)}};return Object(V.jsxs)("div",{children:[Object(V.jsx)("span",{children:n("board:edit_bead_popup.size")}),Object(V.jsx)("br",{}),Object(V.jsx)(to,{defaultValue:o.length>1?void 0:o[0],min:1,max:500,showDecimal:!0,step:.1,label:n("board:edit_bead_popup.height"),onChange:r}),Object(V.jsx)(io,{value:o.length>1?0:o[0],onChange:r,min:1,max:500}),Object(V.jsx)(to,{defaultValue:a.length>1?void 0:a[0],min:1,max:500,showDecimal:!0,step:.1,label:n("board:edit_bead_popup.height"),onChange:c}),Object(V.jsx)(io,{value:a.length>1?0:a[0],onChange:c,min:1,max:500}),Object(V.jsx)(to,{defaultValue:s.length>1?void 0:s[0],min:1,max:500,showDecimal:!0,step:.1,label:n("board:edit_bead_popup.depth"),onChange:l}),Object(V.jsx)(io,{value:s.length>1?0:s[0],onChange:l,min:1,max:500})]})},ro=function(e){var t=function(e){var t=he(),n={name:$.ChangeObjectsAlignment,payload:{selectedIds:t.selectedIds,snapType:e}};ei(n)},n=getComputedStyle(document.body).getPropertyValue("--uiButton");return Object(V.jsxs)("div",{children:["X: ",Object(V.jsx)("br",{}),Object(V.jsx)("button",{onClick:function(){t(Q.X_MIN)},children:Object(V.jsx)(ie.a,{icon:ne.b,color:n,size:"lg"})}),Object(V.jsx)("button",{onClick:function(){t(Q.X_MIDDLE)},children:Object(V.jsx)(ie.a,{icon:ne.a,color:n,size:"lg"})}),Object(V.jsx)("button",{onClick:function(){t(Q.X_MAX)},children:Object(V.jsx)(ie.a,{icon:ne.c,color:n,size:"lg"})}),Object(V.jsx)("br",{}),Object(V.jsx)("br",{}),"Y: ",Object(V.jsx)("br",{}),Object(V.jsx)("button",{onClick:function(){t(Q.Y_MIN)},children:Object(V.jsx)(ie.a,{icon:ne.b,color:n,size:"lg"})}),Object(V.jsx)("button",{onClick:function(){t(Q.Y_MIDDLE)},children:Object(V.jsx)(ie.a,{icon:ne.a,color:n,size:"lg"})}),Object(V.jsx)("button",{onClick:function(){t(Q.Y_MAX)},children:Object(V.jsx)(ie.a,{icon:ne.c,color:n,size:"lg"})})]})},co=function(e){var t=Object(h.a)(["board"]),n=Object(d.a)(t,1)[0],i=Object(q.b)((function(e){for(var t="unknow",n="unknow",i=[],o=e.selectedIds.length>0,a=0;a<e.selectedIds.length;a++){var s=e.selectedIds[a];if(void 0!==e.objects[s]){if(e.objects[s].objectType!==g.Region){o=!1;break}var r=e.objects[s].snapBeadsToCell;"unknow"===t?t=!0===r?"allTrue":"allFalse":("allTrue"===t&&!1===r||"allFalse"===t&&!0===r)&&(t="mixed");var c=e.objects[s].autoFillBeads;"unknow"===n?n=!0===c?"allTrue":"allFalse":("allTrue"===n&&!1===c||"allFalse"===n&&!0===c)&&(n="mixed"),i.push(s)}}return{onlyRegions:o,snapToCellChecked:t,autoFillChecked:n,regionIds:i}}));return Object(V.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:220},children:[!0===i.onlyRegions?Object(V.jsxs)(s.a.Fragment,{children:[Object(V.jsxs)("div",{onClick:function(){var e={name:$.ChangeObjectsProperty,payload:{changes:i.regionIds.map((function(e){return{id:e,properties:{autoFillBeads:"allTrue"!==i.autoFillChecked&&(i.autoFillChecked,!0)}}}))}};ei(e)},children:[Object(V.jsx)("span",{children:n("board:edit_bead_popup.region_autofill")}),"allTrue"===i.autoFillChecked?Object(V.jsx)(ie.a,{icon:ne.i,color:"#000"}):null,"mixed"===i.autoFillChecked?Object(V.jsx)(ie.a,{icon:ne.p,color:"#444"}):null]}),Object(V.jsxs)("div",{onClick:function(){var e={name:$.ChangeObjectsProperty,payload:{changes:i.regionIds.map((function(e){return{id:e,properties:{snapBeadsToCell:"allTrue"!==i.snapToCellChecked&&(i.snapToCellChecked,!0)}}}))}};ei(e)},children:[Object(V.jsx)("span",{children:n("board:edit_bead_popup.region_snap_to_cell")}),"allTrue"===i.snapToCellChecked?Object(V.jsx)(ie.a,{icon:ne.i,color:"#000"}):null,"mixed"===i.snapToCellChecked?Object(V.jsx)(ie.a,{icon:ne.p,color:"#444"}):null]})]}):null,Object(V.jsx)("div",{onClick:function(){var e=he(),t={name:$.DuplicateObjects,payload:{objects:e.selectedIds.map((function(t){return e.objects[t]}))}};ei(t)},children:n("board:edit_bead_popup.duplicate")}),Object(V.jsx)("div",{onClick:function(){var e=he(),t={name:$.RemoveObjects,payload:{ids:e.selectedIds}};ei(t)},children:n("board:edit_bead_popup.delete")})]})},lo=function(e){var t=Object(q.b)((function(e){return e.selectedIds})),n=Object(q.b)((function(e){var t=[];e.selectedIds.forEach((function(n){if(e.objects[n]){var i=e.objects[n].objectType,o=ee[i];if(0===t.length)o.forEach((function(e){t.push(e)}));else for(var a=t.length-1;a>=0;a--){var s=t[a];!1===o.includes(s)&&t.splice(t.indexOf(s),1)}}}));var n=[],i={};return t.forEach((function(t){if(te[t]){if(t===F.Alignment&&1===e.selectedIds.length)return;if(t===F.Lock||t===F.Unlock)if(1===e.selectedIds.length){var n=e.selectedIds[0],o=e.objects[n];if(!0===o.isLocked)return(i={})[te[F.Unlock].groupId]=[F.Unlock],!1;if(!1===o.isLocked&&t===F.Unlock)return}else{var a=!1;if(e.selectedIds.forEach((function(n){if(void 0!==e.objects[n]){var o=e.objects[n].objectType===g.Group,s=void 0!==e.objects[n].groupId&&e.objects[n].groupId.length>0,r=e.objects[n].groupId;if(o){var c=e.objects[n];if(!0===c.isLocked)return(i={})[te[F.Unlock].groupId]=[F.Unlock],a=!0,!1;if(!1===c.isLocked&&t===F.Unlock)return void(a=!0)}else if(s){var d=e.objects[r];if(!0===d.isLocked)return(i={})[te[F.Unlock].groupId]=[F.Unlock],a=!0,!1;if(!1===d.isLocked&&t===F.Unlock)return void(a=!0)}}})),!0===a)return;if(t===F.Unlock)return}if(t===F.Group||t===F.Ungroup){if(1===e.selectedIds.length)return;var s=!1,r=!1,c=0,d=0,l=0;if(e.selectedIds.forEach((function(t){if(!0!==s&&!0!==r&&void 0!==e.objects[t])if(e.objects[t].objectType!==g.Region)if(e.objects[t].objectType!==g.Bead||void 0===e.objects[t].regionId){var n=e.objects[t].objectType===g.Group,i=void 0!==e.objects[t].groupId&&e.objects[t].groupId.length>0;n?c+=1:i?d+=1:l+=1}else r=!0;else s=!0})),!0===s)return;if(!0===r)return;if(0===l&&c>0){if(t===F.Group)return}else if(c>0||d>0);else if(t===F.Ungroup)return}i[te[t].groupId]?i[te[t].groupId].push(t):i[te[t].groupId]=[t]}})),Object.keys(i).sort((function(e,t){var n=i[e][0],o=i[t][0],a=te[n].groupSortOrder,s=te[o].groupSortOrder;return a===s?0:a>s?1:-1})).forEach((function(e){var t=i[e].sort((function(e,t){return te[e].sortOrder===te[t].sortOrder?0:te[e].sortOrder>te[t].sortOrder?1:-1}));n.push(t)})),n})),i=s.a.useState({isOpen:!1,type:void 0,offsetLeft:0}),o=Object(d.a)(i,2),a=o[0],r=o[1],c=function(e,t){var n=e!==a.type||!a.isOpen;r({isOpen:n,type:e,offsetLeft:t})};return s.a.useEffect((function(){r({isOpen:!1,type:void 0,offsetLeft:0})}),[t]),Object(V.jsx)("div",{className:"selected-objects-top-bar",style:{top:e.y,left:e.x},children:Object(V.jsxs)("div",{className:"content-wrapper",children:[Object(V.jsx)("div",{className:"action-icons-wrapper",children:n.map((function(e,t){return Object(V.jsx)(ti,{actions:e,onClick:c,selectedAction:!0===a.isOpen&&void 0!==a.type?a.type:void 0},t)}))}),!0===a.isOpen&&void 0!==a.type?Object(V.jsx)(Xi,{offsetLeft:a.offsetLeft,type:a.type}):null]})})},uo=function(e){var t=Object(q.b)((function(e){return e.ui.selectedTopBarPosition}));return void 0===t?null:Object(V.jsx)(po,{style:{zIndex:void 0===t?"-5":"var(--zIndexSelectedObjectsTopBar)"},children:void 0!==t?Object(V.jsx)(lo,{x:t.x,y:t.y}):null})},po=b.c.div(xi||(xi=Object(p.a)(["\n  .selected-objects-top-bar {\n    position: fixed;\n    top: 100px;\n    z-index: var(--zIndexSelectedObjectsTopBar);\n  }\n\n  .content-wrapper {\n    position: absolute;\n    left: 50%;\n    transform: translate(-50%, -65px);\n    height: 55px;\n    padding: 0 12px;\n    background: #fff;\n    border-radius: 4;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n  }\n  .action-icons-wrapper {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    column-gap: calc(var(--standardPadding) * 2);\n    width: 100%;\n    height: 100%;\n  }\n\n  .action-icons-wrapper > div:nth-last-child(1) .actions-group:before {\n    background: transparent;\n  }\n\n  .action-icons-wrapper > div:first-child .actions-group:before {\n    background: transparent;\n  }\n"]))),ho=n(169),bo=function(){var e,t=Object(h.a)(["board","translation"]),n=Object(d.a)(t,1)[0],i=Object(q.b)((function(e){return e.board})),o=s.a.useState(null!==(e=null===i||void 0===i?void 0:i.name)&&void 0!==e?e:""),a=Object(d.a)(o,2),r=a[0],c=a[1];if(!i)return Object(V.jsx)(s.a.Fragment,{});if(!1===i.editModalVisible)return Object(V.jsx)(s.a.Fragment,{});var l=function(){var e=he(),t=Object(we.default)(e,(function(e){e.board&&(e.board.editModalVisible=!1)}));be(t),vt(t)};return Object(V.jsx)(vo,{children:Object(V.jsxs)("div",{className:"edit-modal-popup",children:[Object(V.jsx)("div",{className:"edit-modal-popup-overlay",onClick:l,children:"\xa0"}),Object(V.jsx)("div",{className:"edit-modal-popup-content-wrapper",children:Object(V.jsxs)("div",{className:"edit-modal-popup-content",children:[Object(V.jsx)("div",{className:"btn-cancel",onClick:l,children:Object(V.jsx)(ie.a,{icon:ne.M,color:"#000"})}),Object(V.jsx)("h2",{children:n("board:modal_edit_board.title")}),Object(V.jsx)("div",{children:Object(V.jsx)("input",{name:"name",className:"input",placeholder:n("board:modal_edit_board.name_input_placeholder"),value:r,onChange:function(e){c(e.target.value)},onBlur:function(e){var t=e.target.value;t.length>0&&function(e){var t=he(),n=Object(we.default)(t,(function(t){t.board&&(t.board.name=e)}));be(n),vt(n)}(t)}})}),Object(V.jsx)("div",{className:"actions"})]})})]})})},vo=b.c.div(Oi||(Oi=Object(p.a)(["\n  .edit-modal-popup {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 100;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    overflow-x: hidden;\n    overflow-y: auto;\n  }\n  .edit-modal-popup-overlay {\n    background: rgba(0, 0, 0, 0.4);\n    transition: all 0.4s ease-in-out;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n  .edit-modal-popup-content-wrapper {\n    position: absolute;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100%;\n  }\n  .edit-modal-popup-content {\n    background: #fff;\n    padding: 32px;\n    width: 520px;\n    box-sizing: border-box;\n    transition: all 0.25s ease-out;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    transition: all 0.4s ease-in-out;\n    z-index: 2;\n    position: relative;\n  }\n  .actions {\n    display: flex;\n    justify-content: flex-end;\n  }\n  .btn-cancel {\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 5;\n    width: 45px;\n    height: 45px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    /* border: 1px solid #eee; */\n    /* color: #000; */\n    /* padding: 10px 15px; */\n    /* border-radius: 4px; */\n    /* width: 90px; */\n    cursor: pointer;\n  }\n  .input {\n    border: none;\n    border-bottom: 1px solid rgba(5, 0, 56, 0.2);\n    padding: 8px 0 4px;\n    font-size: 24px;\n    transition: all 0.4s ease-in-out;\n    border-radius: 0;\n    box-shadow: none;\n    margin-bottom: 10px;\n\n    &:hover {\n      border-bottom-color: rgba(5, 0, 56, 0.4);\n    }\n    &:focus {\n      border-bottom-color: var(--uiButtonActive);\n    }\n  }\n"]))),fo=n(162),jo=function(e){var t,n,i=Object(q.b)((function(e){var t=e.history;return{canRedo:t.canRedo,canUndo:t.canUndo}})),o=i.canRedo,a=i.canUndo,s=Object(q.b)((function(e){return e.board})),r=Object(h.a)(["board"]),c=Object(d.a)(r,1)[0];return Object(V.jsx)(go,{children:Object(V.jsxs)("div",{className:"project-info-wrapper",children:[Object(V.jsxs)("div",{className:"block-with-info",children:[Object(V.jsx)("div",{className:"coralinio-logo",onClick:function(){},"data-tip":c("board:ui.back_to_home"),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"value",children:Object(V.jsx)(l.b,{to:"/",children:"coralinio"})})}),(null===s||void 0===s?void 0:s.name)?Object(V.jsx)("div",{className:"project-name",onClick:function(){if(s&&s.canToggleToFavourite){var e=he(),t=Object(we.default)(e,(function(e){e.board&&(e.board.editModalVisible=!0)}));be(t),vt(t)}},"data-tip":null!==(t=null===s||void 0===s?void 0:s.name)&&void 0!==t?t:"","data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"value",children:null!==(n=null===s||void 0===s?void 0:s.name)&&void 0!==n?n:""})}):null,(null===s||void 0===s?void 0:s.canToggleToFavourite)?Object(V.jsx)("div",{className:"add-to-fav",onClick:function(){if(s&&s.canToggleToFavourite){var e=he(),t=Object(we.default)(e,(function(e){e.board&&(e.board.isFavourite=!e.board.isFavourite)}));be(t),vt(t)}},"data-tip":!0===s.isFavourite?c("board:ui.remove_from_fav"):c("board:ui.add_to_fav"),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)(ie.a,{icon:s.isFavourite?ne.H:fo.a})}):null,(null===s||void 0===s?void 0:s.canExportAsImage)?Object(V.jsx)("div",{className:"export-as-image",onClick:function(){try{var e=an.renderer.domElement.toDataURL("image/png").replace("image/png","image/octet-stream"),t=document.createElement("a");document.body.appendChild(t),t.download="coralinio-preview.png",t.href=e,t.click(),document.body.removeChild(t)}catch(n){return void console.log(n)}},"data-tip":c("board:ui.export_as_image"),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)(ie.a,{icon:ne.P})}):null]}),o||a?Object(V.jsxs)("div",{className:"block-with-history",children:[Object(V.jsx)("div",{className:"undo-button ".concat(a?"active":"inactive"),onClick:function(){a&&cn()},"data-tip":c("board:ui.undo"),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("span",{className:"icon",children:Object(V.jsx)(ie.a,{icon:ne.C})})}),Object(V.jsx)("div",{className:"redo-button ".concat(o?"active":"inactive"," "),onClick:function(){o&&dn()},"data-tip":c("board:ui.redo"),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("span",{className:"icon",children:Object(V.jsx)(ie.a,{icon:ne.C,style:{transform:"scaleX(-1)"}})})})]}):null]})})},go=b.c.div(wi||(wi=Object(p.a)(['\n  .project-info-wrapper {\n    position: absolute;\n    top: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: 10;\n    display: flex;\n    column-gap: calc(var(--standardPadding) * 2);\n    transition: all 0.4s ease-in-out;\n  }\n  .block-with-info {\n    background: #fff;\n    height: 55px;\n    display: flex;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n    column-gap: calc(var(--standardPadding) * 2);\n\n    .coralinio-logo {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      .value {\n        width: 120px;\n        transition: all 0.4s ease-in-out;\n        a {\n          transition: all 0.4s ease-in-out;\n          font-size: 29px;\n          font-family: "Fredoka One", cursive;\n          font-weight: 400;\n          text-transform: lowercase;\n          color: var(--uiButton);\n        }\n        &:hover a {\n          color: var(--uiButtonActive);\n        }\n      }\n    }\n    .project-name {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: "";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      .value {\n        font-size: 20px;\n        max-width: 200px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        font-family: "Open Sans", sans-serif;\n        font-weight: 400;\n      }\n    }\n    .add-to-fav {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: "";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n    .export-as-image {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: "";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n  }\n\n  .block-with-history {\n    display: flex;\n    background: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 55px;\n\n    .redo-button,\n    .undo-button {\n      width: 45px;\n      height: 100%;\n      padding-left: calc(var(--standardPadding) * 2);\n      padding-right: calc(var(--standardPadding) * 2);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &.active:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n      &.inactive {\n        svg path {\n          fill: var(--uiButtonInActive);\n        }\n      }\n    }\n  }\n']))),mo=function(e){var t=Object(q.b)((function(e){return{zoomScale:e.ui.zoomScale}})).zoomScale,n=Object(h.a)(["board","translation"]),i=Object(d.a)(n,1)[0];return Object(V.jsx)(yo,{children:Object(V.jsx)("div",{className:"minimap-wrapper",children:Object(V.jsxs)("div",{className:"minimap-wrapper-content",children:[Object(V.jsx)("div",{className:"item",onClick:function(){var e={name:$.ChangeUiSettingsZoom,payload:{zoomType:"zoomOutScreenCenter",useAnimation:!0}};ei(e)},"data-tip":i("board:ui.zoom_out"),"data-place":"top","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"value",children:Object(V.jsx)(ie.a,{icon:ne.v})})}),Object(V.jsx)("div",{className:"item",onClick:function(){var e={name:$.ChangeUiSettingsZoom,payload:{zoomType:"zoomInScreenCenter",useAnimation:!0}};ei(e)},"data-tip":i("board:ui.zoom_in"),"data-place":"top","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"value",children:Object(V.jsx)(ie.a,{icon:ne.B})})}),Object(V.jsx)("div",{className:"item-text","data-tip":i("board:ui.zoom_percentage"),"data-place":"top","data-type":"dark","data-effect":"solid",children:Object(V.jsxs)("div",{className:"value",children:[Math.round(1/t*100),"%"]})})]})})})},yo=b.c.div(ki||(ki=Object(p.a)(["\n  .minimap-wrapper {\n    position: absolute;\n    z-index: var(--zIndexMinimap);\n    bottom: var(--standardPadding);\n    right: var(--standardPadding);\n    transition: all 0.4s ease-in-out;\n    width: var(--minimapWidth);\n  }\n  .minimap-wrapper-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding) / 2;\n  }\n  .item {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 45px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    cursor: pointer;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .item-text {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 70px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    font-size: 18px;\n    font-weight: 600;\n  }\n"]))),xo=function(){var e=Object(h.a)(["board"]),t=Object(d.a)(e,1)[0],n=Object(q.b)((function(e){var n={};Object.keys(e.objects).forEach((function(i){if(e.objects[i].objectType===g.Bead){var o=e.objects[i],a={width:o.width,height:o.height,depth:o.depth,type:o.type,color:o.color},s=JSON.stringify(a);if(void 0===n[s]){var r=Object(v.cloneDeep)(o);n[s]={count:1,example:r,textName:"".concat(r.color),textTooltip:t("board:bead.summary_colors_with_count",{color:r.color,count:1})}}else{var c=n[s].count+1;n[s].count=c,n[s].textTooltip=t("board:bead.summary_colors_with_count",{color:o.color,count:c})}}}));var i=[];return Object.keys(n).forEach((function(e,t){if(!(t>10)){var o=n[e],a="".concat(o.count,"x");i.push({count:o.count,example:o.example,textName:o.textName,textTooltip:o.textName,textCount:a})}})),{groupedCount:i}})).groupedCount;return Object(V.jsx)(Oo,{children:Object(V.jsx)("div",{className:"beads-summary",children:Object(V.jsx)("div",{className:"beads-summary-content",onClick:function(){var e={name:$.ChangeUiSettingsSidebar,payload:{panel:"objects",open:!0,toggle:!0}};ei(e)},children:n.map((function(e,t){if(!e)return null;if(!e.example)return null;if(!on)return null;var n=on.getObjectThumbnail(e.example,30,30);return Object(V.jsxs)("div",{className:"bead-count","data-tip":e.textTooltip,"data-place":"top","data-type":"dark","data-effect":"solid",children:[Object(V.jsx)("span",{className:"preview",children:Object(V.jsx)("img",{src:n,alt:""})}),Object(V.jsx)("span",{className:"value",children:e.textCount})]},t)}))})})})},Oo=b.c.div(Di||(Di=Object(p.a)(["\n  .beads-summary {\n    position: absolute;\n    bottom: var(--standardPadding);\n    right: calc(var(--standardPadding) + 170px + var(--standardPadding));\n    z-index: var(--zIndexBeadsSummary);\n    transition: all 0.4s ease-in-out;\n  }\n  .beads-summary-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding);\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n  }\n  .bead-count {\n    display: flex;\n    flex-direction: column;\n    cursor: pointer;\n\n    .value {\n      font-size: 15px;\n      font-weight: 600;\n    }\n\n    .preview {\n      width: 30px;\n      height: 30px;\n      /* border: 1px solid #eee; */\n      /* border-radius: 30px; */\n      /* font-size: 8px; */\n      /* line-height: 27px; */\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      white-space: nowrap;\n      overflow: hidden;\n    }\n  }\n"]))),wo=function(e){var t=e.editorMode,n=function(e){var t={name:$.ChangeUiSettings,payload:{uiSettings:{mode:e}}};ei(t)},i=Object(h.a)(["board"]),o=Object(d.a)(i,1)[0];return Object(V.jsxs)("div",{children:[Object(V.jsx)(ko,{label:o("board:mode.select_or_move"),icon:Object(V.jsx)(ie.a,{icon:ne.w}),onClick:function(){return n(m.SelectOrMove)},isSelected:t===m.SelectOrMove}),Object(V.jsx)(ko,{label:o("board:mode.select_multiple_beads"),icon:Object(V.jsx)(ie.a,{icon:ne.q}),onClick:function(){return n(m.SelectMultiple)},isSelected:t===m.SelectMultiple}),Object(V.jsx)(ko,{label:o("board:mode.add_beads"),icon:Object(V.jsx)(ie.a,{icon:ne.l}),onClick:function(){return n(m.AddBeads)},isSelected:t===m.AddBeads}),Object(V.jsx)(ko,{label:o("board:mode.paint_beads"),icon:Object(V.jsx)(ie.a,{icon:ne.z}),onClick:function(){return n(m.PaintBeads)},isSelected:t===m.PaintBeads}),Object(V.jsx)(ko,{label:o("board:mode.delete_beads"),icon:Object(V.jsx)(ie.a,{icon:ne.N}),onClick:function(){return n(m.DeleteBeads)},isSelected:t===m.DeleteBeads}),Object(V.jsx)(ko,{label:o("board:mode.add_region"),testId:"btnAddRegion",icon:Object(V.jsx)(ie.a,{icon:ne.K}),onClick:function(){return n(m.AddRegion)},isSelected:t===m.AddRegion}),Object(V.jsx)(So,{label:o("board:mode.fast_add_multiple_beads"),icon:Object(V.jsx)(ie.a,{icon:ne.L})})]})},ko=function(e){return Object(V.jsx)(Do,{children:Object(V.jsx)("div",{className:"action-button ".concat(e.isSelected?"is-active":""),onClick:e.onClick,"data-tip":e.label,"data-place":"right","data-type":"dark","data-effect":"solid","data-test":e.testId,children:Object(V.jsx)("span",{className:"icon",children:e.icon})})})},Do=b.c.div(Si||(Si=Object(p.a)(["\n  .action-button {\n    border: none;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: var(--uiButton);\n    animation: all 0.5s ease-in-out;\n    min-height: 40px;\n    .icon svg,\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      animation: all 0.5s ease-in-out;\n    }\n  }\n  .action-button:hover,\n  .action-button.is-active {\n    color: var(--uiButtonActive);\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      fill: var(--uiButtonActive);\n    }\n  }\n"]))),So=function(e){var t=[20,20],n=[1,1],i=s.a.useState(t),o=Object(d.a)(i,2),a=o[0],r=o[1],c=s.a.useState(n),l=Object(d.a)(c,2),u=l[0],p=l[1],h=s.a.useState(!1),b=Object(d.a)(h,2),v=b[0],f=b[1],j=function(){f(!v)};return Object(V.jsxs)("div",{style:{position:"relative"},children:[Object(V.jsx)(Do,{children:Object(V.jsx)("div",{className:"action-button ".concat(v?"is-active":""),onClick:j,"data-tip":!0===v?void 0:e.label,"data-place":"right","data-type":"dark","data-effect":"solid","data-tip-disable":!0===v,children:Object(V.jsx)("span",{className:"icon",children:e.icon})})}),!0===v?Object(V.jsx)(Co,{children:Object(V.jsx)(Eo,{selected:u,dimensions:a,setSelected:p,setDimensions:r,onSelect:function(e,i){var o={name:$.AddMultipleBeads,payload:{rows:e,columns:i,figure:"rectangle"}};ei(o),j(),r(t),p(n)},onCancel:function(){r(t),f(!1)}})}):null]})},Eo=function(e){var t=s.a.useRef(null);return Io(t,(function(){e.onCancel()})),Object(V.jsxs)("div",{className:"selection",children:[Object(V.jsx)("div",{className:"rect-wrapper",style:{width:15*e.dimensions[0]},ref:function(e){t.current=e},children:Object(v.times)(e.dimensions[0]).map((function(t){return Object(V.jsx)("div",{className:"row-wrapper",children:Object(v.times)(e.dimensions[1]).map((function(n){return Object(V.jsx)("div",{className:"rect ".concat(n<e.selected[1]&&t<e.selected[0]?"selected":""),onMouseEnter:function(){e.setSelected([t+1,n+1])},onClick:function(){e.onSelect(t+1,n+1)},children:"\xa0"},n)}))},t)}))}),Object(V.jsxs)("div",{className:"label-wrapper",children:[e.selected[0],"x",e.selected[1]]})]})},Io=function(e,t){var n=function(n){e.current&&!e.current.contains(n.target)&&t()};s.a.useEffect((function(){return document.addEventListener("click",n),function(){document.removeEventListener("click",n)}}))},Co=b.c.div(Ei||(Ei=Object(p.a)(["\n  .selection {\n    position: absolute;\n    top: 0px;\n    left: 65px;\n    min-width: calc(5 * 10px + 20px);\n    min-height: 100px;\n    background: #fff;\n    z-index: 10;\n    border: 1px solid #dbdbdb;\n    padding: 10px 10px 0px 10px;\n    box-sizing: border-box;\n  }\n  .selection .rect-wrapper {\n    display: flex;\n  }\n  .selection .label-wrapper {\n    font-size: 12px;\n    color: #000;\n    text-align: center;\n    width: 100%;\n  }\n  .selection .rect {\n    width: 15px;\n    height: 15px;\n    border: 1px solid #fff;\n    background: transparent;\n    padding: 1px;\n    box-shadow: inset 0px 0px 0px 1px #e3e1e1;\n  }\n  .selection .rect.selected {\n    background: var(--btns_bg);\n  }\n"]))),To=function(){var e=Object(q.b)((function(e){return e.ui.mode}));return Object(V.jsx)(_o,{children:Object(V.jsx)("div",{className:"actions-wrapper",children:Object(V.jsx)("div",{className:"actions-content",children:Object(V.jsx)(wo,{editorMode:e})})})})},_o=b.c.div(Ii||(Ii=Object(p.a)(["\n  .actions-wrapper {\n    position: absolute;\n    z-index: var(--zIndexActions);\n    left: var(--standardPadding);\n    top: 50%;\n    transform: translate(0, -50%);\n    width: 56px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 0;\n    transition: all 0.4s ease-in-out;\n  }\n  .actions-content {\n    padding: 0;\n    background-color: rgba(255, 255, 255, 1);\n    padding: 12px 0;\n    transition: height 0.2s linear, top 0.2s linear;\n    border-radius: 4px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    width: 100%;\n  }\n"]))),Bo=b.c.div(Ci||(Ci=Object(p.a)(["\n  .content-wrapper {\n    padding: calc(var(--standardPadding) * 2);\n    position: relative;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: flex-start;\n    flex-direction: column;\n    overflow: auto;\n    max-height: 100%;\n  }\n  .close-wrapper {\n    position: absolute;\n    top: calc(var(--standardPadding) * 1);\n    right: calc(var(--standardPadding) * 1);\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n  }\n  .title {\n    font-size: 30px;\n    font-weight: 600;\n    margin-bottom: var(--standardPadding);\n  }\n"]))),Po=function(e){return Object(V.jsx)("div",{className:"close-wrapper",onClick:e.onClick,children:Object(V.jsx)(ie.a,{icon:ne.M,color:"#000",size:"2x"})})},Mo=n(18),Ro=function(){var e=Object(q.b)((function(e){return e.ui.rightSidebar}));return Object(V.jsx)(Ao,{children:Object(V.jsx)("div",{className:"right-sidebar-wrapper",children:!0===e.isOpen?Object(V.jsxs)(V.Fragment,{children:["history"===e.panel?Object(V.jsx)(No,{}):null,"objects"===e.panel?Object(V.jsx)(Lo,{}):null]}):null})})},Ao=b.c.div(Ti||(Ti=Object(p.a)(["\n  .right-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    right: calc(var(--leftSidebarWidth) * -1);\n    width: var(--leftSidebarWidth);\n    z-index: var(--zIndexRightSidebar);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n"]))),No=function(){var e=Object(h.a)(["board"]),t=Object(d.a)(e,1)[0],n=Object(q.b)((function(e){return e.history.events}));t("board:history_events.AddObjects"),t("board:history_events.DuplicateObjects"),t("board:history_events.RemoveObjects"),t("board:history_events.ChangeSelectObjects"),t("board:history_events.ChangeObjectsProperty"),t("board:history_events.ChangeObjectsAlignment"),t("board:history_events.ClipboardCut"),t("board:history_events.ClipboardCopy"),t("board:history_events.ClipboardPaste"),t("board:history_events.AddMultipleBeads"),t("board:history_events.ChangeUiSettings"),t("board:history_events.ChangeUiSettingsZoom"),t("board:history_events.ChangeUiSettingsSidebar"),t("board:history_events.GroupObjects"),t("board:history_events.UngroupObjects");return Object(V.jsx)(Bo,{children:Object(V.jsxs)("div",{className:"content-wrapper",children:[Object(V.jsx)("div",{className:"title",children:t("board:tab.history_events_title")}),Object(V.jsx)(Po,{onClick:function(){var e={name:$.ChangeUiSettingsSidebar,payload:{open:!1,panel:"history"}};ei(e)}}),Object(V.jsx)(zo,{children:Object(V.jsx)("div",{className:"events",children:n.map((function(e,n,i){var o=i.length-1-n,a=i[o];if(!a)return Object(V.jsx)(s.a.Fragment,{});return Object(V.jsxs)("div",{className:"event ".concat(a.isActive?"active":"inactive"),onClick:function(){!function(e){var t=ln(),n=t.index-1;e===n||(e>=0&&e<n?Object(v.times)(n-e).forEach((function(){cn()})):e<t.events.length&&e>n&&Object(v.times)(e-n).forEach((function(){dn()})))}(o)},children:[Object(V.jsx)("div",{className:"icon",children:Object(V.jsx)(ie.a,{icon:ne.s})}),Object(V.jsx)("div",{className:"name",children:t("board:history_events.".concat(a.name))}),Object(V.jsx)("div",{className:"time","data-tip":"".concat(t("board:tab.history_events_event_created_at")," ").concat(t("dates:long",{date:Object(Mo.a)(Date.parse(a.createdAt))})),"data-place":"bottom","data-type":"dark","data-effect":"solid",children:t("dates:hh_mm_ss",{date:Object(Mo.a)(Date.parse(a.createdAt))})})]},n)}))})})]})})},zo=b.c.div(_i||(_i=Object(p.a)(["\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .events {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow: scroll;\n  }\n  .event {\n    display: grid;\n    grid-template-columns: 45px 1fr 100px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    cursor: pointer;\n    &.active {\n      background: #fff;\n      .icon {\n        svg path {\n          fill: #000;\n        }\n      }\n      .name {\n        color: #000;\n      }\n    }\n    &.inactive {\n      .icon {\n        svg path {\n          fill: #e9e9e9;\n        }\n      }\n      .name {\n        color: #e9e9e9;\n      }\n    }\n    &:hover {\n      background: #ccc;\n    }\n\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .time {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      white-space: nowrap;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      color: #c9c9c9;\n    }\n  }\n"]))),Lo=function(){var e=Object(h.a)(["board","dates"]),t=Object(d.a)(e,1)[0],n=Object(q.b)((function(e){return e.objects})),i=s.a.useState("all"),o=Object(d.a)(i,2),a=o[0],r=o[1],c=s.a.useState([]),l=Object(d.a)(c,2),u=l[0],p=l[1],b=function(e){r(e),"all"===e?p(Object.keys(n).map((function(e){return n[e]}))):"beads"===e?p(Object.keys(n).map((function(e){return n[e]})).filter((function(e){return e.objectType===g.Bead}))):"groups"===e?p(Object.keys(n).map((function(e){return n[e]})).filter((function(e){return e.objectType===g.Group}))):"other"===e&&p(Object.keys(n).map((function(e){return n[e]})).filter((function(e){return!(e.objectType===g.Bead||e.objectType===g.Group)})))};return s.a.useEffect((function(){b(a)}),[n]),Object(V.jsx)(Bo,{children:Object(V.jsxs)("div",{className:"content-wrapper",children:[Object(V.jsx)("div",{className:"title",children:t("board:tab.objects_title")}),Object(V.jsx)(Po,{onClick:function(){var e={name:$.ChangeUiSettingsSidebar,payload:{open:!1,panel:"objects"}};ei(e)}}),Object(V.jsxs)(Ho,{children:[Object(V.jsxs)("div",{className:"filters",children:[Object(V.jsx)("div",{className:"filter ".concat("all"===a?"active":""),onClick:function(){b("all")},children:t("board:tab.objects_filter_all")}),Object(V.jsx)("div",{className:"filter ".concat("beads"===a?"active":""),onClick:function(){b("beads")},children:t("board:tab.objects_filter_only_beads")}),Object(V.jsx)("div",{className:"filter ".concat("groups"===a?"active":""),onClick:function(){b("groups")},children:t("board:tab.objects_filter_only_groups")}),Object(V.jsx)("div",{className:"filter ".concat("other"===a?"active":""),onClick:function(){b("other")},children:t("board:tab.objects_filter_only_others")})]}),Object(V.jsx)("div",{className:"objects",children:u.map((function(e,t){if(!e)return Object(V.jsx)(s.a.Fragment,{});var n=e.objectType===g.Bead;return Object(V.jsxs)("div",{className:"object",onClick:function(){n&&on.getObjectThumbnail(e,500,500)},children:[Object(V.jsx)("div",{className:"icon",children:n?Object(V.jsx)("img",{src:on.getObjectThumbnail(e,30,30),alt:""}):Object(V.jsx)(ie.a,{icon:ne.s})}),Object(V.jsx)("div",{className:"name",children:e.objectType}),Object(V.jsxs)("div",{className:"id",children:["ID:",e.id]})]},t)}))})]})]})})},Ho=b.c.div(Bi||(Bi=Object(p.a)(["\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .filters {\n    background: #ebebef;\n    border-radius: 4px;\n    padding: 2px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    .filter {\n      border-radius: 4px;\n      padding: 10px 15px;\n    }\n    .filter.active {\n      background: #fff;\n    }\n  }\n\n  .objects {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n  }\n  .object {\n    display: grid;\n    grid-template-columns: 45px 1fr 200px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    width: 100%;\n    &:hover {\n      background: #e9e9e9;\n    }\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .id {\n      font-size: 10px;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      width: 100%;\n    }\n  }\n"]))),Uo=function(){var e=Object(q.b)((function(e){return e.ui.leftSidebar}));return Object(V.jsx)(Fo,{children:Object(V.jsx)("div",{className:"left-sidebar-wrapper",children:!0===e.isOpen?Object(V.jsx)(V.Fragment,{children:"comments"===e.panel?Object(V.jsx)(Go,{}):null}):null})})},Fo=b.c.div(Pi||(Pi=Object(p.a)(["\n  .left-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    left: calc(var(--leftSidebarWidth) * -1);\n    z-index: var(--zIndexLeftSidebar);\n    width: var(--leftSidebarWidth);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n"]))),Go=function(){var e=Object(h.a)(["board","translation"]),t=Object(d.a)(e,1)[0];return Object(V.jsx)(Bo,{children:Object(V.jsxs)("div",{className:"content-wrapper",children:[Object(V.jsx)("div",{className:"title",children:t("board:tab.comments_title")}),Object(V.jsx)("div",{children:t("translation:list_is_empty")}),Object(V.jsx)(Po,{onClick:function(){var e={name:$.ChangeUiSettingsSidebar,payload:{open:!1,panel:"comments"}};ei(e)}})]})})},Yo=function(e){var t=s.a.useState(!0),n=Object(d.a)(t,2),i=n[0],o=n[1],a=Object(q.b)((function(e){return e.ui.leftSidebar})),r=Object(q.b)((function(e){return e.ui.rightSidebar})),c=Object(h.a)(["board"]),l=Object(d.a)(c,1)[0];return Object(V.jsx)(Xo,{children:Object(V.jsxs)("div",{className:"bottom-bar-wrapper ".concat(i?"open":"closed"),children:[Object(V.jsxs)("div",{className:"buttons",children:[Object(V.jsx)("div",{className:"item ".concat("comments"===a.panel?"active":"inactive"),onClick:function(){var e={name:$.ChangeUiSettingsSidebar,payload:{open:!0,panel:"comments",toggle:!0}};ei(e)},"data-tip":l("board:tab.comments"),"data-place":"top","data-type":"dark","data-effect":"solid",children:Object(V.jsx)("div",{className:"value",children:Object(V.jsx)(ie.a,{icon:ne.m})})}),Object(V.jsx)("div",{className:"item ".concat("history"===r.panel?"active":"inactive"),onClick:function(){var e={name:$.ChangeUiSettingsSidebar,payload:{open:!0,panel:"history",toggle:!0}};ei(e)},children:Object(V.jsx)("div",{className:"value",children:Object(V.jsx)(ie.a,{icon:ne.s,"data-tip":l("board:tab.history_events"),"data-place":"top","data-type":"dark","data-effect":"solid"})})}),Object(V.jsx)("div",{className:"item ".concat("objects"===r.panel?"active":"inactive"),onClick:function(){var e={name:$.ChangeUiSettingsSidebar,payload:{open:!0,panel:"objects",toggle:!0}};ei(e)},children:Object(V.jsx)("div",{className:"value",children:Object(V.jsx)(ie.a,{icon:ne.t,"data-tip":l("board:tab.objects"),"data-place":"top","data-type":"dark","data-effect":"solid"})})})]}),Object(V.jsx)("div",{className:"toggle-item",onClick:function(){o(!i)},children:Object(V.jsx)("div",{className:"value",children:Object(V.jsx)(ie.a,{icon:i?ne.d:ne.e})})})]})})},Xo=b.c.div(Mi||(Mi=Object(p.a)(["\n  .bottom-bar-wrapper {\n    position: absolute;\n    bottom: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: var(--zIndexBottomBar);\n    width: auto;\n    display: flex;\n    /* transition: all 0.4s ease-in-out; */\n    background: #fff;\n    height: 55px;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1),\n      left 0.4s ease-in-out;\n    &.open {\n    }\n    &.closed {\n      .buttons {\n        width: 0;\n      }\n    }\n  }\n  .buttons {\n    overflow: hidden;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1);\n    width: 100%;\n    white-space: nowrap;\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &.active,\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .toggle-item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      fill: #e9e9e9;\n    }\n  }\n"]))),Wo=function(){var e=Object(q.b)((function(e){return e.ui.modalSearchProducts}));return e?!1===e.isOpen?Object(V.jsx)(s.a.Fragment,{}):Object(V.jsx)(Vo,{modalSearchProducts:e}):Object(V.jsx)(s.a.Fragment,{})},Vo=function(e){var t,n,o,a,r,c,l,u,p,b=s.a.useRef(null),v=s.a.useState(null!==(t=null===(n=e.modalSearchProducts)||void 0===n?void 0:n.q)&&void 0!==t?t:""),f=Object(d.a)(v,2),j=f[0],m=f[1],y=s.a.useState(null!==(o=null===(a=e.modalSearchProducts)||void 0===a?void 0:a.producer)&&void 0!==o?o:""),x=Object(d.a)(y,2),O=x[0],w=x[1],k=s.a.useState(null!==(r=null===(c=e.modalSearchProducts)||void 0===c?void 0:c.color)&&void 0!==r?r:""),D=Object(d.a)(k,2),S=D[0],E=D[1],C=s.a.useState(null!==(l=null===(u=e.modalSearchProducts)||void 0===u?void 0:u.advBlockVisible)&&void 0!==l&&l),T=Object(d.a)(C,2),_=T[0],B=T[1],A=s.a.useState(void 0),N=Object(d.a)(A,2),z=N[0],L=N[1],H=s.a.useState(void 0),U=Object(d.a)(H,2),F=U[0],G=U[1],Y=s.a.useState(null!==(p=e.modalSearchProducts.cachedResponse)&&void 0!==p?p:[]),X=Object(d.a)(Y,2),W=X[0],Z=X[1],K=function(){var e=he(),t=Object(we.default)(e,(function(e){e.ui.modalSearchProducts&&(e.ui.modalSearchProducts.isOpen=!1,e.ui.modalSearchProducts.q=j,e.ui.modalSearchProducts.producer=O,e.ui.modalSearchProducts.color=S,e.ui.modalSearchProducts.advBlockVisible=_),b&&b.current&&(e.ui.modalSearchProducts.scrollPosition=b.current.scrollTop)}));be(t),vt(t)},q=function(e,t,n){!0!==z&&(L(!0),function(e,t,n){return new Promise((function(o,a){var s=new URLSearchParams;return void 0!==e&&e.length>0&&s.append("q",e),void 0!==t&&t.length>0&&s.append("producer",t),void 0!==n&&n.length>0&&s.append("color_category",n),fetch(I+"api/bead_products/list?"+s.toString(),{method:"GET",headers:M}).then((function(e){return e.json()})).then((function(e){e.statusCode&&200!==e.statusCode&&a(e.message);var t=[];e&&e.bead_products&&e.bead_products.length>0&&(t=(null===e||void 0===e?void 0:e.bead_products).map((function(e){var t=void 0;e&&e.data&&e.data.bead_geometry&&e.data.bead_geometry.file_name&&("model_toho_round.obj"===e.data.bead_geometry.file_name&&(t=i.MODEL_TOHO_ROUND),"model_cylinder.obj"===e.data.bead_geometry.file_name&&(t=i.MODEL_CYLINDER),"model_fire_polish.obj"===e.data.bead_geometry.file_name&&(t=i.MODEL_FIRE_POLISH));var n=e.data.bead_geometry,o=n.height,a=n.width,s=n.depth,r=function(e){return void 0===e||null===e||""===e?1:e.includes(",")?Number(e.replaceAll(",",".")):Number(e)};return{bead:P({id:e.data.id,color:e.data.bead_color.hex,type:t,height:r(o),width:r(a),depth:r(s)}),item:e}}))),o({response:t})})).catch((function(e){return R(e,a)}))}))}(null!==e&&void 0!==e?e:j,null!==t&&void 0!==t?t:O,null!==n&&void 0!==n?n:S).then((function(e){var t=e.response;Z(t),L(void 0),G(void 0)})).catch((function(e){L(void 0),G(e)})))},J=function(e,t,n){q(e,t,n)},Q=function(e){O===e?(w(""),J(j,e,S)):(w(e),J(j,e,S))},ee=function(e){S===e?(E(""),J(j,O,e)):(E(e),J(j,O,e))},te=Object(h.a)(["board","translation"]),oe=Object(d.a)(te,1)[0];return Object(V.jsx)(qo,{children:Object(V.jsxs)("div",{className:"modal-search-products-popup",children:[Object(V.jsx)("div",{className:"modal-search-products-popup-overlay",onClick:K,children:"\xa0"}),Object(V.jsx)("div",{className:"modal-search-products-popup-content-wrapper",children:Object(V.jsxs)("div",{className:"modal-search-products-popup-content",children:[Object(V.jsx)("div",{className:"btn-cancel",onClick:K,children:Object(V.jsx)(ie.a,{icon:ne.M,color:"#000"})}),Object(V.jsxs)("div",{className:"inputs-wrapper",children:[Object(V.jsxs)("div",{className:"simple-inputs-wrapper",children:[Object(V.jsxs)("div",{className:"one-input-wrapper",children:[Object(V.jsx)("input",{name:"q",className:"input",placeholder:oe("board:modal_search_bead.search_input_placeholder"),autoComplete:"off",onKeyPress:function(e){"Enter"===e.key&&J()},value:j,onChange:function(e){m(e.target.value)}}),j.length>0?Object(V.jsx)("div",{className:"clear-input",onClick:function(){m(""),J("")},children:Object(V.jsx)(ie.a,{icon:ne.M})}):null]}),Object(V.jsx)("button",{onClick:function(){J()},children:Object(V.jsx)(ie.a,{icon:ne.D})}),Object(V.jsxs)("button",{onClick:function(){B(!_)},children:[oe(!0===_?"board:modal_search_bead.close_advanced_filters":"board:modal_search_bead.open_advanced_filters")," ",Object(V.jsx)(ie.a,{icon:!0===_?ne.k:ne.j})]})]}),!0===_?Object(V.jsxs)("div",{className:"adv-wrapper",children:[Object(V.jsx)("div",{children:Object(V.jsxs)("div",{className:"bead-colors-category-wrapper",children:[[{search:"czarny",hex:"black"},{search:"niebieski",hex:"blue"},{search:"zielony",hex:"green"},{search:"czerwony",hex:"red"},{search:"pomara\u0144czowy",hex:"orange"},{search:"brazowy",hex:"brown"},{search:"fioletowy",hex:"purple"},{search:"z\u0142oty",hex:"gold"},{search:"r\xf3\u017cowy",hex:"pink"},{search:"\u017c\xf3\u0142ty",hex:"yellow"},{search:"srebrny",hex:"#eee"}].map((function(e){return Object(V.jsx)(Ko,{search:e.search,hex:e.hex,onClick:ee,isSelected:S===e.search},e.search)})),S.length>0?Object(V.jsx)("div",{className:"clear-input",onClick:function(){E(""),J(void 0,void 0,"")},children:Object(V.jsx)(ie.a,{icon:ne.M})}):null]})}),Object(V.jsxs)("div",{className:"bead-producers-wrapper",children:[Object(V.jsx)(Zo,{label:"TOHO",value:"toho",isSelected:"toho"===O,onClick:Q}),Object(V.jsx)(Zo,{label:"MIYUKI",value:"miyuki",isSelected:"miyuki"===O,onClick:Q}),Object(V.jsx)(Zo,{label:"FirePolish",value:"firepolish",onClick:Q,isSelected:"firepolish"===O}),O.length>0?Object(V.jsx)("div",{className:"clear-input",onClick:function(){w(""),J(void 0,"")},children:Object(V.jsx)(ie.a,{icon:ne.M})}):null]})]}):null]}),Object(V.jsxs)("div",{className:"content-wrapper",children:[z?Object(V.jsxs)("div",{children:[oe("translation:query_loading"),"loading..."]}):null,F?Object(V.jsxs)("div",{children:[oe("translation:query_error"),"error: ",F]}):null,W?Object(V.jsx)("div",{className:"products",ref:b,children:W.map((function(e){return Object(V.jsxs)("div",{className:"item",onClick:function(){!function(e){var t=he(),n=Object(we.default)(t,(function(e){e.ui.modalSearchProducts&&(e.ui.modalSearchProducts.isOpen=!1,e.ui.modalSearchProducts.q=j,e.ui.modalSearchProducts.producer=O,e.ui.modalSearchProducts.color=S,e.ui.modalSearchProducts.advBlockVisible=_,W&&(e.ui.modalSearchProducts.cachedResponse=W),b&&b.current&&(e.ui.modalSearchProducts.scrollPosition=b.current.scrollTop))}));be(n),vt(n),ei({name:$.ChangeObjectsProperty,payload:{changes:n.selectedIds.filter((function(e){return!!n.objects[e]&&n.objects[e].objectType===g.Bead})).map((function(t){var n=e.bead;return{id:t,properties:{height:n.height,width:n.width,depth:n.depth,type:n.type,color:n.color,material:n.material}}}))}})}(e)},children:[Object(V.jsx)("div",{className:"img",children:Object(V.jsx)("img",{src:on.getObjectThumbnail(e.bead,100,100),alt:""})}),Object(V.jsx)("h2",{children:e.item.display_name})]},e.item.bead_product_uuid)}))}):null]})]})})]})})},Zo=function(e){return Object(V.jsx)("div",{className:"bead-producer-item ".concat(e.isSelected?"selected":""),onClick:function(){e.onClick(e.value)},children:e.label})},Ko=function(e){return Object(V.jsx)("div",{className:"bead-color-category-item ".concat(e.isSelected?"selected":""),onClick:function(){e.onClick(e.search)},style:{backgroundColor:e.hex},children:"\xa0"})},qo=b.c.div(Ri||(Ri=Object(p.a)(["\n  .modal-search-products-popup {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 9999;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    overflow-x: hidden;\n    overflow-y: auto;\n    max-height: 100vh;\n  }\n  .modal-search-products-popup-overlay {\n    background: rgba(0, 0, 0, 0.4);\n    transition: all 0.4s ease-in-out;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n  .modal-search-products-popup-content-wrapper {\n    position: absolute;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100%;\n  }\n  .modal-search-products-popup-content {\n    background: #fff;\n    padding: 32px;\n    width: 650px;\n    box-sizing: border-box;\n    transition: all 0.25s ease-out;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    transition: all 0.4s ease-in-out;\n    z-index: 2;\n    position: relative;\n  }\n  .bead-color-category-item {\n    width: 30px;\n    height: 30px;\n    border-radius: 30px;\n    display: flex;\n    border: 1px solid #dedede;\n    margin-right: var(--standardPadding);\n    margin-bottom: var(--standardPadding);\n    background: #eee;\n    cursor: pointer;\n    &.selected {\n      border: 2px solid #000;\n    }\n  }\n  .bead-colors-category-wrapper {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n    position: relative;\n\n    .clear-input {\n      position: relative;\n      top: -4px;\n      right: 0;\n      height: 30px;\n      width: 40px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n    }\n  }\n  .bead-producer-item {\n    font-size: 12px;\n    display: flex;\n    height: 35px;\n    border-radius: 8px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    border: 1px solid #dedede;\n    padding: var(--standardPadding);\n    margin-right: var(--standardPadding);\n    margin-bottom: var(--standardPadding);\n    background: #fff;\n    cursor: pointer;\n    &.selected {\n      background: #eee;\n    }\n  }\n  .bead-producers-wrapper {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n    position: relative;\n\n    .clear-input {\n      position: relative;\n      top: -5px;\n      right: 0;\n      height: 35px;\n      width: 40px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n    }\n  }\n  .actions {\n    display: flex;\n    justify-content: flex-end;\n  }\n  .modal-title {\n    font-size: 20px;\n    text-align: left;\n  }\n  .btn-cancel {\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 5;\n    width: 45px;\n    height: 45px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    /* border: 1px solid #eee; */\n    /* color: #000; */\n    /* padding: 10px 15px; */\n    /* border-radius: 4px; */\n    /* width: 90px; */\n    cursor: pointer;\n  }\n  .input {\n    border: none;\n    border-bottom: 1px solid rgba(5, 0, 56, 0.2);\n    padding: 8px 0 4px;\n    font-size: 24px;\n    transition: all 0.4s ease-in-out;\n    border-radius: 0;\n    box-shadow: none;\n    margin-bottom: 10px;\n\n    &:hover {\n      border-bottom-color: rgba(5, 0, 56, 0.4);\n    }\n    &:focus {\n      border-bottom-color: var(--uiButtonActive);\n    }\n  }\n  .inputs-wrapper {\n  }\n  .simple-inputs-wrapper {\n    display: flex;\n    column-gap: var(--standardPadding);\n    margin-bottom: var(--standardPadding);\n    width: 450px;\n\n    .one-input-wrapper {\n      position: relative;\n      input {\n        width: 100%;\n      }\n      .clear-input {\n        position: absolute;\n        top: 0;\n        right: 0;\n        height: calc(100% - 11px);\n        width: 50px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n      }\n    }\n    button {\n      background: none;\n      border: 1px solid #eee;\n      border-radius: var(--standardPadding);\n      padding: var(--standardPadding);\n      height: 42px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      column-gap: var(--standardPadding);\n    }\n  }\n  .content-wrapper {\n    .products {\n      display: grid;\n      column-gap: var(--standardPadding);\n      grid-template-columns: 1fr 1fr 1fr;\n      overflow-y: scroll;\n      max-height: 500px;\n      padding-right: var(--standardPadding);\n      &::-webkit-scrollbar-thumb {\n        background: var(--uiButtonActive);\n        border: 1px solid #cfcfcf;\n        border-radius: 60px;\n      }\n      &::-webkit-scrollbar-track {\n        background: #fff;\n        border: 1px solid #e4e4e4;\n      }\n      &::-webkit-scrollbar {\n        width: var(--standardPadding);\n      }\n    }\n    .item {\n      border: 1px solid #eee;\n      border-radius: 6px;\n      padding: var(--standardPadding);\n      margin-bottom: var(--standardPadding);\n      cursor: pointer;\n      transition: all 0.3s ease-in-out;\n      &:hover {\n        border: 1px solid var(--uiButtonActive);\n      }\n      .img {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n      h2 {\n        font-size: 12px;\n      }\n    }\n  }\n"]))),Jo=function(){var e=Object(q.b)((function(e){return e.ui.leftSidebar.isOpen})),t=Object(q.b)((function(e){return e.ui.rightSidebar.isOpen}));return Object(V.jsxs)("div",{children:[Object(V.jsx)(ho.a,{}),Object(V.jsx)(bo,{}),Object(V.jsx)(Wo,{}),Object(V.jsx)($o,{children:Object(V.jsxs)("div",{className:"scene \n          ".concat(e?"left-sidebar-open":""," \n          ").concat(t?"right-sidebar-open":""),children:[Object(V.jsx)(Qo,{}),Object(V.jsx)(jo,{}),Object(V.jsx)(mo,{}),Object(V.jsx)(xo,{}),Object(V.jsx)(To,{}),Object(V.jsx)(Yo,{}),Object(V.jsx)(Uo,{}),Object(V.jsx)(Ro,{}),Object(V.jsx)(uo,{})]})})]})},$o=b.c.div(Ai||(Ai=Object(p.a)(["\n  .scene {\n    border: 1px solid #e0e0e0;\n    position: relative;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: flex-start;\n    box-sizing: border-box;\n    height: 100vh;\n\n    .block-loading {\n      position: absolute;\n      top: 0;\n      left: 0;\n      background: rgba(255, 255, 255, 0.9);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      height: 100%;\n      z-index: var(--zIndexBlockLoading);\n      svg {\n        animation: rotating 2s linear infinite;\n      }\n    }\n\n    &.right-sidebar-open {\n      .right-sidebar-wrapper {\n        right: 0;\n      }\n\n      .minimap-wrapper {\n        right: calc(var(--standardPadding) + var(--leftSidebarWidth));\n      }\n      .beads-summary {\n        right: calc(\n          var(--standardPadding) + var(--leftSidebarWidth) +\n            var(--standardPadding) + var(--minimapWidth)\n        );\n      }\n    }\n\n    &.left-sidebar-open {\n      .left-sidebar-wrapper {\n        left: 0;\n      }\n      .project-info-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .actions-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .bottom-bar-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n    }\n  }\n\n  @keyframes rotating {\n    from {\n      -ms-transform: rotate(0deg);\n      -moz-transform: rotate(0deg);\n      -webkit-transform: rotate(0deg);\n      -o-transform: rotate(0deg);\n      transform: rotate(0deg);\n    }\n    to {\n      -ms-transform: rotate(360deg);\n      -moz-transform: rotate(360deg);\n      -webkit-transform: rotate(360deg);\n      -o-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n"]))),Qo=function(){return!1===Object(q.b)((function(e){return e.ui.blockThreejs.loading}))?Object(V.jsx)("div",{"data-test":"blockLoadingLoaded"}):Object(V.jsx)("div",{className:"block-loading","data-test":"blockLoading",children:Object(V.jsx)(ie.a,{icon:ne.J})})},ea=function(e){return new Promise(""===e?function(e,t){e({board:{name:"---",uuid:""},objects:[]})}:"demo"===e?function(e,t){ta().then((function(t){e(t)}))}:function(t,n){(function(e){return new Promise((function(t,n){return fetch(I+"api/boards/one/"+e,{method:"GET",headers:M}).then((function(e){return e.json()})).then((function(e){e.statusCode&&200!==e.statusCode&&n(e.message),t({board:e.board,objects:Object.keys(e.objects).map((function(t){return e.objects[t]}))})})).catch((function(e){return R(e,n)}))}))})(e).then((function(e){t(e)})).catch((function(e){return n(e)}))})},ta=function(){return new Promise((function(e,t){var n={};e({board:{uuid:"123",name:"Projekt testowy"},objects:Object.keys(n).map((function(e){return n[e]}))})}))},na=function(e){return ea(e).then((function(e){return new Promise((function(t,n){var i=je(),o=ge(),a=he(),s=Object(we.default)(a,(function(t){var n,i,o,a;t.board=Object(v.cloneDeep)(pe.board),t.history=Object(v.cloneDeep)(pe.history),t.objects=Object(v.cloneDeep)(pe.objects),t.selectedIds=Object(v.cloneDeep)(pe.selectedIds),t.ui=Object(v.cloneDeep)(pe.ui),void 0!==e.objects&&e.objects.length>0&&e.objects.forEach((function(e){t.objects[e.id]=e})),t.board.name=null!==(n=null===(i=e.board)||void 0===i?void 0:i.name)&&void 0!==n?n:"",t.board.uuid=null!==(o=null===(a=e.board)||void 0===a?void 0:a.uuid)&&void 0!==o?o:"",t.board.canEdit=!0,t.ui.blockThreejs.loading=!1}));be(s),i&&a.ui.lights.forEach((function(e){kn(e,an.scene)})),i&&a.ui.grid&&function(e){var t=1e5,n=new E.k(1,1e4,"#e9e9e9","#eee");n.position.x=0,n.position.y=0,n.position.z=-500,n.scale.x=t,n.scale.y=t,n.scale.z=t,n.rotation.x=90*E.r.DEG2RAD,n.rotation.y=0*E.r.DEG2RAD,n.rotation.z=0*E.r.DEG2RAD,n.userData=Object(v.merge)({},e,{objectType:g.SceneBackgroundGrid,name:"".concat(g.SceneBackgroundGrid).concat(w).concat(e.id)}),an.scene.add(n)}(a.ui.grid),i&&Object.keys(s.objects).forEach((function(e){Dn(s.objects[e])})),o&&vt(s),ia(),t(void 0)}))}))},ia=function(){var e=P({id:"beadr",color:"red",position:{x:0,y:0}}),t=P({id:"beadg",color:"green",position:{x:50,y:0}}),n=P({id:"beadb",color:"blue",position:{x:100,y:0}}),i=Re({id:"regionA",position:{x:100,y:100},width:100,height:100,columns:6,rows:6}),o=Re({id:"regionB",position:{x:250,y:100},width:100,height:100,columns:6,rows:6});ei({name:$.AddObjects,payload:{objects:[e,t,n,i,o]}})},oa=function(e,t,n,i){(function(e,t,n){return gn(e,t,n)})(void 0===n?document.getElementById("threejs"):n,n,i).then((function(){na(e),"demo"!==e&&!0===t.save_events&&(A=!0,C=e,N=(new Date).getTime())}))},aa=function(e,t,n,i){var o;A=!1,void 0!==C&&(C=void 0),z.length>0&&(z=[]),new Promise((function(e){var t=he(),n=Object(we.default)(t,(function(e){Object(v.cloneDeep)(pe)}));vt(n),e()})),void 0!==(o=void 0===n?document.getElementById("threejs"):n)&&null!==o&&(o.innerHTML="",o.classList&&!0===o.classList.contains("active")&&o.classList.remove("active")),new Promise((function(e){e(void 0)}))},sa=function(e){var t=Object(u.g)().uuid;return s.a.useEffect((function(){return oa(t,e.data,e.canvas,e.context),function(){aa(0,e.data,e.canvas,e.context)}}),[]),Object(V.jsx)("div",{className:"App",children:Object(V.jsx)(q.a,{store:rt,children:Object(V.jsx)(Jo,{})})})},ra=n(67),ca={isAuthorized:!1,data:void 0},da=Object(ra.a)({state:ca,dispatch:function(){return null}}),la=function(e,t){switch(t.type){case"logout":return{isAuthorized:!1,data:void 0};default:return e}},ua=function(){var e=Object(h.a)(["board","translation"]),t=Object(d.a)(e,1)[0],n=Object(ra.b)(da,(function(e){return e.dispatch})),i=Object(u.f)();return Object(V.jsx)(pa,{children:Object(V.jsxs)("div",{children:[Object(V.jsx)("h2",{children:t("translation:welcome")}),Object(V.jsx)("button",{onClick:function(){i.push("/boards")},className:"btn-light","data-test":"boards",children:t("translation:links.boards")}),Object(V.jsx)("button",{onClick:function(){window.localStorage.removeItem("coralinio_jwt"),setTimeout((function(){window.location.href="/",n({type:"logout"})}),50)},className:"btn-light","data-test":"logout",children:t("translation:links.logout")})]})})},pa=b.c.div(Ni||(Ni=Object(p.a)(["\n  padding: 1em;\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #000;\n    margin-bottom: 10px;\n    margin-right: 10px;\n    cursor: pointer;\n  }\n  h2 {\n    margin-bottom: 0.5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n"]))),ha=function(e){return Object(V.jsx)("div",{children:"page NO MATCH"})},ba=function(e){return Object(V.jsx)("div",{children:"Not autorized"})},va=Object(b.b)(zi||(zi=Object(p.a)(['\n  /* Bulma Base */\n  /*! minireset.css v0.0.6 | MIT License | github.com/jgthms/minireset.css */\n  html,\n  body,\n  p,\n  ol,\n  ul,\n  li,\n  dl,\n  dt,\n  dd,\n  blockquote,\n  figure,\n  fieldset,\n  legend,\n  textarea,\n  pre,\n  iframe,\n  hr,\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    margin: 0;\n    padding: 0;\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    font-size: 100%;\n    font-weight: normal;\n  }\n\n  ul {\n    list-style: none;\n  }\n\n  button,\n  input,\n  select,\n  textarea {\n    margin: 0;\n  }\n\n  html {\n    box-sizing: border-box;\n  }\n\n  *,\n  *::before,\n  *::after {\n    box-sizing: inherit;\n  }\n\n  img,\n  video {\n    height: auto;\n    max-width: 100%;\n  }\n\n  iframe {\n    border: 0;\n  }\n\n  table {\n    border-collapse: collapse;\n    border-spacing: 0;\n  }\n\n  td,\n  th {\n    padding: 0;\n  }\n\n  td:not([align]),\n  th:not([align]) {\n    text-align: inherit;\n  }\n\n  html {\n    background-color: white;\n    font-size: 16px;\n    -moz-osx-font-smoothing: grayscale;\n    -webkit-font-smoothing: antialiased;\n    min-width: 300px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n    text-rendering: optimizeLegibility;\n    -webkit-text-size-adjust: 100%;\n    -moz-text-size-adjust: 100%;\n    -ms-text-size-adjust: 100%;\n    text-size-adjust: 100%;\n  }\n\n  article,\n  aside,\n  figure,\n  footer,\n  header,\n  hgroup,\n  section {\n    display: block;\n  }\n\n  body,\n  button,\n  input,\n  optgroup,\n  select,\n  textarea {\n    font-family: BlinkMacSystemFont, -apple-system, "Segoe UI", "Roboto",\n      "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",\n      "Helvetica Neue", "Helvetica", "Arial", sans-serif;\n  }\n\n  code,\n  pre {\n    -moz-osx-font-smoothing: auto;\n    -webkit-font-smoothing: auto;\n    font-family: monospace;\n  }\n\n  body {\n    color: #4a4a4a;\n    font-size: 1em;\n    font-weight: 400;\n    line-height: 1.5;\n  }\n\n  a {\n    color: #3273dc;\n    cursor: pointer;\n    text-decoration: none;\n  }\n\n  a strong {\n    color: currentColor;\n  }\n\n  a:hover {\n    color: #363636;\n  }\n\n  code {\n    background-color: whitesmoke;\n    color: #da1039;\n    font-size: 0.875em;\n    font-weight: normal;\n    padding: 0.25em 0.5em 0.25em;\n  }\n\n  hr {\n    background-color: whitesmoke;\n    border: none;\n    display: block;\n    height: 2px;\n    margin: 1.5rem 0;\n  }\n\n  img {\n    height: auto;\n    max-width: 100%;\n  }\n\n  input[type="checkbox"],\n  input[type="radio"] {\n    vertical-align: baseline;\n  }\n\n  small {\n    font-size: 0.875em;\n  }\n\n  span {\n    font-style: inherit;\n    font-weight: inherit;\n  }\n\n  strong {\n    color: #363636;\n    font-weight: 700;\n  }\n\n  fieldset {\n    border: none;\n  }\n\n  pre {\n    -webkit-overflow-scrolling: touch;\n    background-color: whitesmoke;\n    color: #4a4a4a;\n    font-size: 0.875em;\n    overflow-x: auto;\n    padding: 1.25rem 1.5rem;\n    white-space: pre;\n    word-wrap: normal;\n  }\n\n  pre code {\n    background-color: transparent;\n    color: currentColor;\n    font-size: 1em;\n    padding: 0;\n  }\n\n  table td,\n  table th {\n    vertical-align: top;\n  }\n\n  table td:not([align]),\n  table th:not([align]) {\n    text-align: inherit;\n  }\n\n  table th {\n    color: #363636;\n  }\n']))),fa=Object(b.b)(Li||(Li=Object(p.a)(['\n  body {\n    font-family: "Open Sans", sans-serif;\n  }\n\n  .App {\n    text-align: center;\n    background: #f6f6f6;\n  }\n\n  .topbar-wrapper {\n    height: 70px;\n    background: #f6f6f6;\n    padding-left: 0px;\n    padding-top: 0px;\n    width: 100%;\n    border-bottom: 2px solid #e0e0e0;\n    box-sizing: border-box;\n  }\n\n  #threejs {\n  }\n  #threejs.active {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    z-index: 2;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n\n  /*\n\n\n\n\n\n\n\n\n\n\n\n\n*/\n\n  .line {\n    position: absolute;\n    background: #5a5a5a;\n    width: 0;\n    height: 0;\n  }\n\n  .line-start {\n    position: absolute;\n    background: #5a5a5a;\n  }\n\n  .line-end {\n    position: absolute;\n    background: #5a5a5a;\n  }\n\n  .add-line-wrapper {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0);\n    z-index: 100;\n  }\n\n  .bead-item {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 5;\n    height: 20px;\n    width: 20px;\n    background: #bbb;\n  }\n\n  .button {\n    font-family: "Open Sans", sans-serif;\n    font-weight: 300;\n    font-size: 13px;\n    color: #000;\n  }\n\n  .mouse-selection {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0);\n    z-index: 9;\n  }\n\n  .toolbar-wrapper {\n    position: relative;\n    background: #f6f6f6;\n    width: 300px;\n    border-left: 2px solid #e0e0e0;\n    box-sizing: border-box;\n    right: -100px;\n  }\n\n  .topbar-wrapper .fieldset {\n    /* border-top: 1px solid #dfdfdf;\n  border-bottom: 1px solid #dfdfdf; */\n    padding-bottom: 5px;\n    padding-top: 5px;\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .topbar-wrapper .fieldset .label {\n    font-family: "Open Sans", sans-serif;\n    font-size: 13px;\n    line-height: 30px;\n    font-weight: 300;\n    padding: 0;\n    margin: 0;\n    padding-left: 10px;\n    padding-right: 10px;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    align-items: center;\n  }\n\n  .topbar-wrapper .fieldset .input {\n    border: none;\n    background: none;\n    border-bottom: 1px solid #dfdfdf;\n    color: #6e6e6e;\n    font-size: 14px;\n    line-height: 30px;\n    font-family: "Open Sans", sans-serif;\n    box-shadow: none;\n    max-width: 200px;\n    padding: 0;\n    margin: 0;\n  }\n']))),ja=Object(b.b)(Hi||(Hi=Object(p.a)(["\n  :root {\n    --text: #000;\n    --uiButton: rgba(5, 0, 56, 1);\n    --uiButtonActive: #c96ca3;\n    --uiButtonInActive: rgba(5, 0, 56, 0.2);\n    --bg: #f7dcec;\n    --btns_bg: #c96ca3;\n    --btns_text: #fff;\n    --title: #7c72a9;\n    --color_secoundary: #7c72a9;\n    --gray: rgba(0, 0, 0, 0.15);\n\n    --zIndexModal: 1000;\n    --zIndexMinimap: 500;\n    --zIndexProjectInfo: 500;\n    --zIndexBeadsSummary: 500;\n    --zIndexActions: 500;\n    --zIndexActions: 500;\n    --zIndexLeftSidebar: 510;\n    --zIndexRightSidebar: 510;\n    --zIndexBottomBar: 510;\n    --zIndexSelectedObjectsTopBar: 100;\n    --zIndexBlockLoading: 10;\n\n    --standardPadding: 8px;\n    --minimapWidth: 170px;\n    --leftSidebarWidth: 480px;\n    --rightSidebarWidth: 480px;\n  }\n"]))),ga=Object(b.b)(Ui||(Ui=Object(p.a)(['\n  @import url("https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i&display=swap");\n  @import url("https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap");\n']))),ma=Object(b.a)(Fi||(Fi=Object(p.a)(["\n    ","\n    ","\n    ","\n"])),ja,va,fa),ya=n(301),xa=n(120),Oa=n(61),wa=n(163),ka=n(164),Da=n(118),Sa=n.n(Da),Ea=n(68),Ia=n(303),Ca=n(300),Ta=n(168),_a=n(304),Ba=n(302),Pa={enUS:Ea.a,pl:Ia.a};xa.a.use(ka.a).use(wa.a).use(Oa.e).use(Sa.a).init({debug:!1,preload:["pl"],whitelist:["en","pl"],ns:["board","translation","boards","dates"],fallbackLng:"pl",fallbackNS:"translation",defaultNS:"translation",saveMissing:!1,initImmediate:!1,interpolation:{escapeValue:!1,format:function(e,t,n){if(Object(Ca.a)(e)){var i=null!==n&&void 0!==n?n:"pl";"en"===n&&(i="enUS");var o=Pa[i];return void 0===t&&(t="short"),"short"===t?Object(Ta.a)(e,"P",{locale:o}):"long"===t?Object(Ta.a)(e,"PPPP",{locale:o}):"relative"===t?Object(_a.a)(e,new Date,{locale:o}):"ago"===t?Object(Ba.a)(e,new Date,{locale:o,addSuffix:!0}):Object(Ta.a)(e,t,{locale:o})}return e}},returnEmptyString:!1,overloadTranslationOptionHandler:Sa.a.overloadTranslationOptionHandler,backend:{loadPath:"https://rpcal.github.io/coralinio-preview/build/locales/./{{lng}}__{{ns}}.json"},detection:{order:["querystring","cookie","localStorage","sessionStorage","navigator"],lookupQuerystring:"lang",lookupCookie:"i18next",lookupLocalStorage:"i18nextLang",lookupSessionStorage:"i18nextLang",caches:["localStorage","cookie"]},react:{useSuspense:!1}});var Ma=function(e){var t=Object(ra.b)(da,(function(e){return e.state.isAuthorized}));return Object(V.jsx)(l.a,{hashType:"slash",children:t?Object(V.jsxs)(u.c,{children:[Object(V.jsx)(u.a,{exact:!0,path:"/",children:Object(V.jsx)(ua,{data:e.data})}),Object(V.jsx)(u.a,{exact:!0,path:"/boards",children:Object(V.jsx)(Z,{data:e.data})}),Object(V.jsx)(u.a,{exact:!0,path:"/board/:uuid",children:Object(V.jsx)(sa,{data:e.data,canvas:void 0,context:void 0})}),Object(V.jsx)(u.a,{path:"*",children:Object(V.jsx)(ha,{data:e.data})})]}):Object(V.jsxs)(u.c,{children:[Object(V.jsx)(u.a,{exact:!0,path:"/",children:Object(V.jsx)(ba,{data:e.data})}),Object(V.jsx)(u.a,{path:"*",children:Object(V.jsx)(ha,{data:e.data})})]})})},Ra=function(e){var t,n;re("render App.tsx");var i,o=(null!==(t=null===(n=e.data)||void 0===n?void 0:n.token)&&void 0!==t?t:"").length>0,r=(i=!0===o?{isAuthorized:!0,data:e.data}:{isAuthorized:!1,data:void 0},s.a.useReducer(la,i)),c=Object(d.a)(r,2),l=c[0],u=c[1];return Object(V.jsx)(a.Suspense,{fallback:Object(V.jsx)("div",{children:"Loading... "}),children:Object(V.jsx)(ya.a,{i18n:xa.a,children:Object(V.jsxs)(da.Provider,{value:{state:l,dispatch:u},children:[Object(V.jsx)(ma,{}),Object(V.jsx)("style",{children:ga}),Object(V.jsx)(Ma,{data:e.data})]})})})},Aa=n(166);console.log("start app with version: ",Aa.version,"isDev",false);var Na,za=document.getElementById("root");if(null!==za){var La=document.createElement("div");La.setAttribute("id","threejs"),za.parentNode&&za.parentNode.insertBefore(La,za.nextSibling);try{var Ha={apiHost:"",save_events:!0,token:"",user:{username:"",uuid:""}},Ua=za.getAttribute("data-hash");if(Ua){var Fa=JSON.parse(Ua);Ha=Object(v.merge)({},Ha,Fa)}I=(Na=Ha).apiHost,M.Authorization="Bearer "+Na.token,c.a.render(Object(V.jsx)(Ra,{data:Ha}),za)}catch(Ga){}}}},[[295,1,2]]]);
//# sourceMappingURL=main.0da90a8f.chunk.js.map