{"version":3,"sources":["ApiService.ts","editorObjects/Editor.tsx","PageBoards.tsx","components/SelectedObjectsTopBar/ActionsTypes.tsx","controllers/AppEventType.ts","controllers/store.ts","editorObjects/Bead.ts","editorObjects/Point.ts","editorObjects/EditBBox.ts","components/colors.ts","editorObjects/Group.ts","editorObjects/PreviewProject3D.ts","editorObjects/Region.ts","EventEmitter.tsx","editorObjects/editorGetters.ts","threejs/loadModels.ts","immerReducers/MainImmerReducer.tsx","immerReducers/store.tsx","immerReducers/appStore.tsx","threejs/mouseListeners/mouseEventEditorMode/MouseEventsBase.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeAddBead.ts","threejs/mouseListeners/MouseDragHelper.ts","threejs/mouseListeners/MouseSelectionHelper.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeAddRegion.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeDelete.ts","controllers/refreshReactState.ts","threejs/keyboard/keyMap.ts","threejs/mouseListeners/SelectionFilter.ts","threejs/mouseListeners/mouseListeners.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsIdle.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeSelectOrMove.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeIdle.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModePaint.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeSelectMultiple.ts","threejs/mouseListeners/mouseScreenPosition.ts","threejs/mouseListeners/getRect10x10FromScreenToWorld.ts","controllers/AppHistory.ts","threejs/thumbnailsGenerator.ts","threejs/renderThreejs.ts","threejs/clipboard.ts","threejs/mouseListeners/screenToWorld.ts","threejs/eventEmitterHandlers.ts","controllers/BaseHandlers/BaseEventHandler.ts","controllers/BaseHandlers/StoreObjectHandler.ts","controllers/EventHandlers/AddObjectHandler.ts","controllers/EventHandlers/RemoveObjectHandler.ts","controllers/EventHandlers/ChangeSelectObjectsHandler.ts","controllers/EventHandlers/ChangeObjectsPropertyHandler.ts","controllers/EventHandlers/ChangeUiSettingsHandler.ts","controllers/EventHandlers/ClipboardCopyHandler.ts","controllers/EventHandlers/ClipboardCutHandler.ts","controllers/EventHandlers/ClipboardPasteHandler.ts","controllers/EventHandlers/AddMultipleBeadsHandler.ts","controllers/EventHandlers/ChangeUiSettingsZoomHandler.ts","controllers/EventHandlers/ChangeUiSettingsSidebarHandler.ts","controllers/EventHandlers/ChangeObjectsAlignmentHandler.ts","controllers/EventHandlers/DuplicateObjectsHandler.ts","controllers/EventHandlers/GroupObjectsHandler.ts","controllers/EventHandlers/UngroupObjectsHandler.ts","controllers/storeController.ts","components/SelectedObjectsTopBar/ActionsIconsWrapper.tsx","components/SelectedObjectsTopBar/NumericInput.tsx","components/SelectedObjectsTopBar/PopupWrapper.tsx","components/SelectedObjectsTopBar/TopBarContent.tsx","components/SelectedObjectsTopBar/SelectedObjectsTopBar.tsx","components/EditProjectModal.tsx","components/ProjectInfoWrapper.tsx","components/MinimapWrapper.tsx","components/BeadsSummary.tsx","components/Toolbar/EditorModes.tsx","components/ActionsWrapper.tsx","components/PanelContentStyles.tsx","components/RightSidebar.tsx","components/LeftSidebar.tsx","components/BottomBar.tsx","components/Editor.tsx","threejs/apiControler.ts","prepareBoard.tsx","PageBoard.tsx","AuthContext.tsx","PageHome.tsx","PageNoMatch.tsx","PageNotAutorized.tsx","App.tsx","index.tsx"],"names":["apiHost","tempBoardId","SaveEventType","headers","handleError","err","reject","console","error","sendingEnabled","lastSendTimestamp","Date","getTime","toSendEventsQueue","notifyBackend","events","length","forEach","event","push","debouncedSend","debounce","triggerSendBatchEvents","trailing","now","log","undefined","body","JSON","stringify","changes","id","Promise","resolve","fetch","method","then","res","json","response","statusCode","message","status","catch","sendBoardBatchEvents","prototype","toISOString","pad","number","this","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","toFixed","slice","BeadTypes","BeadMaterialTypes","PageBoards","props","history","useHistory","React","useState","boards","state","setBoards","useEffect","PageStyles","onClick","name","board","uuid","className","to","map","styled","div","RegionGridType","RegionShape","ObjectTypes","EditorMode","EditorMenuMain","EditorGridType","BrushType","NAME_SEPARATOR","ActionsTypes","ActionsGroupTypes","AppEventType","SnapToLineType","MapActionObjectType","Bead","EditBeadProduct","EditBeadType","EditBeadMaterial","EditBeadColor","Alignment","EditWidthHeightDepth","EditPosition","EditRotate","Group","Ungroup","Lock","Unlock","More","Region","EditRegionGridType","EditRegionGridSettings","EditWidthHeight","PreviewProject3D","Actions","sortOrder","groupId","EditBeadsProperies","groupSortOrder","EditRegionProperies","Transform","LockOrUnlock","GroupOrUngroup","store","BeadChildSuffix","defaultStore","objects","selectedIds","canRedo","canUndo","canEdit","canToggleToFavourite","isFavourite","canExportAsImage","editModalVisible","ui","modalSearchProducts","isOpen","successAction","leftSidebar","panel","rightSidebar","zoomScale","mode","SelectOrMove","lights","THREE","generateUUID","type","color","intensity","position","x","y","z","grid","Hex","hexSize","snapEnabled","isVisible","width","height","selectedTopBarPosition","blockThreejs","loading","emptyStore","cloneDeep","getStore","setStore","newStore","buildPoint","contain","p1","p2","p","EditBBoxChildSuffix","getThreeNameFromBeadId","childSuffix","MAIN","getThreeUserDataFromBead","bead","merge","buildBead","defaults","TOHO_15","material","Mat","rotateX","rotateY","rotateZ","lineRotate","depth","keepAspectRatio","canLockOrUnlock","isLocked","objectType","regionId","GroupChildSuffix","getThreeNameFromEditBBoxId","SceneEditBBox","getThreeUserDataFromEditBBox","editBBox","PreviewProject3DChildSuffix","getThreeNameFromGroupId","getThreeUserDataFromGroup","group","buildGroup","childrenIds","RegionChildSuffix","getThreeNameFromPreviewProject3DId","getThreeUserDataFromPreviewProject3D","obj","internalEventEmiter","EventNames","getThreeNameFromRegionId","getThreeUserDataFromRegion","region","buildRegion","gridType","Rectangles","shape","Rectangle","beadIds","opacity","columns","rows","autoFillBeads","snapBeadsToCell","childrenGridIds","newRegion","size","newChildrenGridIds","Array","fill","getStateObjectFromObjectId","objectId","warn","EventEmitter","_events","listener","listenerToRemove","filter","data","callback","base3dModels","toho_sphere","model","bbox","toho_miyuki","toho_15","loadAppModels","appThree","a","objLoader","OBJLoader","loadAsync","object","clone","setFromObject","getModelBBoxFromBeadType","TOHO_MIYUKI","TOHO_SPHERE","MainImmerReducer","newState","draftState","ImmerReducer","Main","createActionCreators","composeReducers","createReducerFunction","appStore","createStore","MouseEventsBase","boundingClientRect","mouse","raycaster","intersects","clientX","clientY","el","getBoundingClientRect","top","left","setFromCamera","camera","intersectObjects","scene","children","getObjectsFromIntersect","getIntersect","userData","isGroup","isInGroup","maxItems","result","selected","index","MouseEventsEditorModeAddBead","Math","abs","max","min","screenToWorld","action1","AddObjects","payload","sendEvent","MouseDragHelper","isDragged","isDragStarted","end","start","shouldBehaveLikeMove","deltaX","deltaY","MouseSelectionHelper","element","renderer","startPoint","pointTopLeft","pointBottomRight","isDown","document","createElement","style","pointerEvents","background","border","zIndex","Vector2","screenX","screenY","domElement","parentElement","appendChild","removeChild","MouseEventsEditorModeAddRegion","isCameraGrabed","startDragMousePosition","startDragCamera","mouseDragHelper","mouseSelectionHelper","setRenderer","onDown","onMove","minX","minY","action2","ChangeUiSettings","uiSettings","onUp","MouseEventsEditorModeDelete","Error","getActiveObjectsFromIntersect","firstClickedActiveObject","getIdsFromGroupOrInGroup","action","RemoveObjects","ids","refreshReactState","dispatch","updateEditorState","keyCodeToKeyName","8","9","13","16","17","18","20","27","32","33","34","35","36","37","38","39","40","45","46","91","93","224","106","107","109","110","111","186","187","188","189","190","191","192","219","220","221","222","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","isInputElement","tagName","defaultMonitor","eventName","__preventDefaultEvents","__pressed","__element","__subscriptions","__monitor","initKeybinding","hidden","visibilityChange","window","handleVisibilityChange","msHidden","webkitHidden","addEventListener","subscribeKeys","toLowerCase","replace","unsubscribe","indexOf","splice","isPressedKey","unhandleKeyEvent","handleKeyEvent","preventDefault","keyName","keys","code","keyCode","which","String","fromCharCode","join","getKeyEventName","listeners","matched","propagate","i","Object","moudeEditorModeIdle","moudeEditorModeSelectOrMove","moudeEditorModePaint","moudeEditorModeDelete","moudeEditorModeAddRegion","moudeEditorModeAddBead","moudeEditorModeSelectMultiple","SelectionFilter","frustum","Frustum","center","Vector3","tmpPoint","vecNear","vecTopLeft","vecTopRight","vecDownRight","vecDownLeft","vecFarTopLeft","vecFarTopRight","vecFarDownRight","vecFarDownLeft","vectemp1","vectemp2","vectemp3","endPoint","collection","deep","Number","MAX_VALUE","updateFrustum","searchChildInFrustum","_startPoint","_endPoint","EPSILON","updateProjectionMatrix","updateMatrixWorld","isOrthographicCamera","right","down","set","unproject","planes","setFromCoplanarPoints","normal","multiplyScalar","isMesh","isLine","isPoints","intersectsBox","includes","MouseEventsIdle","sceneScale","mouseDiffXInWorldSpace","mouseDiffYInWorldSpace","cameraX","cameraY","lookAt","MouseEventsEditorModeSelectOrMove","actionType","selectionBox","prevEditBBox","mouseEventsIdle","setCamera","setScene","altKey","shiftKey","clicked","clickedId","clickedItemInSelectedObjects","selectedIsLocked","getSelectionForSingleObjectIdAction","isGroupChild","isClickedOnGroup","updateUIAtMove","moveAllSelectedObjects","moveSingleObject","moveObjectGroup","moveEditBBox","selectMultipleObjects","ChangeSelectObjects","change","isSelected","produce","draft","getTopBarPosition","diffX","diffY","getMoveObjectsAction","clickedObjectIsLocked","getSelectionAppendAction","additionalData","selectedBBox","topLeft","topRight","bottomLeft","bottomRight","allSelectedIds","selectIds","objectIds","properties","ChangeObjectsProperty","_id","__id","_newIsSelected","_addWithIsLock","addWithIsLock","newSelected","shouldBeSelected","getObjectByUserDataProperty","child_object","child","layers","mask","visible","hideTopBar","showTopBar","topBar","querySelector","display","MouseEventsEditorModeIdle","getState","MouseEventsEditorModePaint","MouseEventsEditorModeSelectMultiple","mousePosition","setMousePositionAtWindow","newPos","onWheel","updateUiEvent","ChangeUiSettingsZoom","zoomType","useAnimation","scrollDelta","Idle","DeleteBeads","PaintBeads","AddRegion","AddBeads","SelectMultiple","onWindowResize","bottom","setSize","onResize","onPointerDown","onPointerUp","onPointerOut","onPointerMove","thumbnailsGenerator","getRect10x10FromScreenToWorld","viewportOffset","x1","x2","y1","y2","pos1","pos2","maxX","maxY","w","h","AppHistory","maxHistoryRecords","arg","len","diff","e","do","isActive","createdAt","undoHistory","lastEvent","getHistory","back","undo","redoHistory","front","redo","clipboardContent","setClipboardBoardContent","content","clipboardCopy","ClipboardCopy","clipboardCut","ClipboardCut","clipboardPaste","ClipboardPaste","initThumbnailsGenerator","rootEl","setAttribute","ThumbnailsGenerator","toString","cache","antialias","preserveDrawingBuffer","imgWidth","imgHeight","forceCache","cacheData","cacheId","createObjectThumbnail","clear","object3d","triggerAddBeadToScene","expandByObject","ratioImage","baseWidth","baseHeight","halfWidth","halfHeight","lightConfig","addLightFromUI","render","toDataURL","initCanvasApp","canvas","context","classList","contains","add","AppThree","initEventEmitterHandlers","requestAnimationFrame","threeRender","rect10x10FromScreenToWorld","pressed","ctrlKey","metaKey","enable","clientWidth","clientHeight","needResize","needToResizeRendererToDisplaySize","value","l","worldToScreen","pos","vector","widthHalf","heightHalf","project","eventEmitter","on","action_changeSelectedBeads_color","traverse","action_changeSelectedBeads_height","beads","scale","triggerUpdateEditBBox","action_unselectAll","diffStateSelectedIds","triggerSelectBead","triggerSelectRegion","action_changeSelectedBeads_width","action_changeSelectedBeads_depth","action_changeSelectedBeads_type","remove","action_changeSelectedBeads_rotate","rotation","DEG2RAD","action_selectBeads","diffStates","values","action_selectIntersectObject","action_selectIntersectObjects","selectedBeads","selectedRegions","action_updateZoomSCale","action_updateEditBBox","action_selectRegions","action_deleteBeads","triggerDeleteBeadIds","action_deleteSelectedBeads","action_deleteObjects","triggerDeleteObjectIds","toDeleteObjectIds","action_addBeadOnClick","action_updateLight","field","light","action_addRegion","triggerRegionToScene","action_moveClickedObject","movedObjects","action_moveAllSelectedObjects","action_movedSelected","regions","action_changeBeadColorToBeadTemplate","flatShading","reflectivity","action_fastAddBeads","prevSelectedBeadIds","beadId","action_snapToLineSelectedBeads","action_onChangeEditorMode","action_readSavedCanvas","triggerGroupToScene","triggerPreviewProject3DToScene","startAppEvent","SceneLight","SceneBackgroundGrid","clearThreeScene","config","addObjectByObjectType","isFinite","getTopBarPositionInScreenFromObject","updateObjectPosition","positionX","positionY","shouldSelect","emissive","rectShape","moveTo","rectWidth","rectHeight","lineTo","autoClose","_rectPoints","getPoints","_rectGeometryPoints","setFromPoints","_lineMaterial","lines","SELECTION_CHILD","rectangleFrame","SELECTION","attach","_object","geometry","side","transparent","regionBgThree","BG","regionGridCellsThree","GRID_CELLS","times","row","column","j","_cell","GRID_CELL","regionThree","beadType","beadModel","getModelFromBeadType","ANY","Shiny","computeBoundingBox","groupBgThree","groupThree","previewProject3D","editBBoxThree","editBBoxBgThree","getResizeDots","dotSize","__material","__boxGeometry","_whiteDot","renderOrder","___material","___boxGeometry","_grayDot","_baseDot","_dotTL","_dotTR","_dotBL","_dotBR","BaseEventHandler","saveToHistory","posX","posY","getCenterPosition","_store","getSimpleHistoryEvents","StoreObjectHandler","buildPreviewProject3D","selectObjectOnThreeScene","_beadId","getMousePosition","worldPos","expandByPoint","bboxCenter","getCenter","AddObjectHandler","newObject","getAppObjectFromCloneAppObject","historyEvent","b","dayjs","getStoreWithHistory","CREATE","RemoveObjectHandler","deleteSelectedObjectsFromStore","DELETE","ChangeSelectObjectsHandler","historyChange","getNewStoreWithTopBarPosition","ChangeObjectsPropertyHandler","added","updated","removed","historyChanges","_singleChange","singleHistoryChange","relatedChanges","relatedCreateBeads","relatedDeleteIds","keyNames","key","_singeRelatedChange","whenBead","whenRegion","findIndex","applyChangesToThree","UPDATE","updatedKeys","inGroup","isBeadFoundRegion","regionTopLeftX","regionTopLeftY","cellW","cellH","columnIndex","floor","rowIndex","newIndex","oldIndex","offsetX","offsetY","currentIndex","oldRegionId","autoFillBeadsKey","snapBeadsToCellKey","rowsKey","columnsKey","positionKey","relatedCreateBeadsIds","oldColumns","newRows","newColumns","newSize","autoFillBeadsEnabled","toDeleteBeadIds","oldCurrentRow","oldCurrentCol","currentRow","currentCol","oldPosition","foundObject","emptyCount","snapBeadsToCellEnabled","nextIdIndex","startX","startY","ChangeUiSettingsHandler","ClipboardCopyHandler","ClipboardCutHandler","clonedObjects","ClipboardPasteHandler","mapIds","oldId","getPositionDiffFromMousePosition","moveObjectsByDiff","newChildrenIds","AddMultipleBeadsHandler","figure","defaultBead","col","ChangeUiSettingsZoomHandler","screenCenter","scrollSign","sign","updateByScroll","mouseXInWorldBefore","mouseYInWorldBefore","zoomChange","mouseXInWorldAfter","mouseYInWorldAfter","ChangeUiSettingsSidebarHandler","open","toggle","newOpen","ChangeObjectsAlignmentHandler","snapType","updates","X_MIN","X_MIDDLE","X_MAX","Y_MIN","Y_MIDDLE","Y_MAX","DuplicateObjectsHandler","GroupObjectsHandler","idsGroups","idsObjectsWithoutGroups","idsInGroup","objId","newGroup","newGroupId","GroupObjects","UngroupObjects","UngroupObjectsHandler","run","AddMultipleBeads","ChangeUiSettingsSidebar","ChangeObjectsAlignment","DuplicateObjects","ActionsIconsWrapper","GroupActionsStyles","actions","selectedAction","data-tip","data-place","data-type","data-effect","icon","faShapes","faBorderNone","faCrosshairs","faSync","faArrowsAlt","faAlignLeft","faChevronDown","faSearch","faBurn","faTimes","ItemActionWrapper","elRef","useRef","ref","current","offsetLeft","offsetParent","offsetWidth","groupOffsetLeft","finalOffsetLeft","IconActionsTypeMore","faEllipsisH","IconActionsTypeEditBeadColor","backgroundColors","useSelector","colors","Fragment","IconActionsUnlock","startLongPress","setStartLongPress","onSuccess","timerId","setTimeout","clearTimeout","useCallback","stop","onMouseDown","onMouseUp","onMouseLeave","onTouchStart","onTouchEnd","transitionDuration","faLock","IconActionsLock","_event","faUnlock","IconActionsGroup","faObjectGroup","IconActionsUngroup","faObjectUngroup","IS_BROWSER","RE_NUMBER","RE_INCOMPLETE_NUMBER","access","prop","defaultValue","args","NumericInput","_timer","_valid","_isStrict","_ignoreValueChange","_isMounted","_inputFocus","refsWrapper","refsInput","strict","btnDownHover","btnDownActive","btnUpHover","btnUpActive","stringValue","_propsToState","bind","out","hasOwnProperty","trim","_parse","nextState","setState","saveSelection","prevProps","prevState","isNaN","NaN","_invokeEventCallback","focus","selectionStart","selectionEnd","checkValidity","getValueAsNumber","setValue","activeElement","target","valid","validationError","supportsValidation","noValidate","pattern","required","validity","validationMessage","maxLength","validStateChanged","search","RegExp","addClass","removeClass","n","parseFloat","precision","q","pow","_min","defaultProps","_max","round","parse","_n","_toNumber","format","_step","step","DIRECTION_UP","DIRECTION_DOWN","snap","persist","isDefaultPrevented","charAt","_recursive","increase","SPEED","DELAY","decrease","dir","callbackName","call","css","mobile","componentClass","noStyle","onInvalid","onValid","rest","assign","hasFormControl","test","attrs","wrap","input","btnUp","onMouseEnter","btn","disabled","readOnly","btnDown","loose","_format","onChange","original","val","onKeyDown","_onKeyDown","onInput","onSelect","onFocus","onBlur","InputTag","minus","plus","arrowUp","arrowDown","Component","MIN_SAFE_INTEGER","MAX_SAFE_INTEGER","borderWidth","borderColor","borderStyle","margin","textAlign","cursor","transition","boxShadow","borderRadius","paddingRight","boxSizing","fontSize","paddingLeft","WebkitAppearance","lineHeight","textShadow","SliderPlus","createSliderWithTooltip","Slider","PopupWrapper","leftOffset","PopupWrapperStyles","EditBeadColorPopup","onChangeComplete","hex","EditBeadTypePopup","types","faSquareFull","faCircle","faSquare","EditBeadProductPopup","bead1","bead2","bead3","flexDirection","src","getObjectThumbnail","EditBeadMaterialPopup","materialTypes","justifyContent","alignItems","EditRegionGridTypePopup","EditRegionGridSettingsPopup","_columns","_rows","showDecimal","label","InputTypeNumber","negative","multiplicator","EditPositionPopup","result_x","result_y","result_z","_x","_y","_z","onChangeX","newValue","onChangeY","SliderWrapper","marginBottom","marginTop","onAfterChange","EditRotatePopup","onChangeZ","EditWidthHeightPopup","_width","_height","EditWidthHeightDepthPopup","AlignmentPopup","sendSnapTo","uiButton","getComputedStyle","getPropertyValue","faAlignCenter","faAlignRight","MorePopup","onlyRegionsInfo","snapToCellChecked","autoFillChecked","regionIds","onlyRegions","_value1","_value2","minWidth","faCheck","faExclamationCircle","TopBarContent","actionsGrouped","selectedActions","actionsForType","groupedResults","containsLockedGroup","containsRegion","anySelectedBeadInRegion","groupCount","inGroupCount","noGroupCount","sort","groupIdA","groupIdB","firstActionA","firstActionB","groupSortOrderA","groupSortOrderB","actionA","actionB","popupInfo","setPopupInfo","onClickAnyIcon","SelectedObjectsTopBar","SelectedObjectsTopBarStyles","EditProjectModal","setName","onClickCancel","EditProjectModalStyles","newName","setNewProjectName","ProjectInfoWrapper","ProjectInfoWrapperStyles","faStarSolid","faStarRegular","link","download","href","click","faUpload","faReply","transform","MinimapWrapper","MinimapWrapperStyles","faMinus","faPlus","BeadsSummary","groupedCount","groups","groupData","item","count","example","textName","textTooltip","newCount","textCount","BeadsSummaryStyles","imgSrc","EditorModes","editorMode","onChangeEditorMode","newEditorMode","faMousePointer","faExpand","faPaintBrush","faTrashAlt","faTable","faTh","StateButton","ButtonStyles","FastAddBeadsButton","useDispatch","defaultDimesions","defaultSelected","dimensions","setDimensions","setSelected","selectionVisible","setVisible","toggleSelection","data-tip-disable","SelectionStyles","colIndex","onCancel","SelectionFrame","divRef","useOutsideClick","handleClick","removeEventListener","ActionsWrapper","ActionsWrapperStyles","PanelContentStyles","CloseButton","RightSidebar","RightSidebarStyles","HistoryPanel","HistoryPanelStyles","_","fullCreatedAt","lastIndex","jumpToIndexHistory","faHistory","ObjectsPanel","filterSelected","setFilterSelected","selectedObjects","setSelectedObjects","onClickFilter","ObjectsPanelStyles","isBead","LeftSidebar","LeftSidebarStyles","CommentsPanel","BottomBar","setIsOpen","BottomBarStyles","faComment","faListAlt","faAngleDoubleLeft","faAngleDoubleRight","EditorScene","leftSidebarOpen","rightSidebarOpen","EditorMainStyles","LoadingInfo","faSyncAlt","getProjectData","getDemoProjectData","fetchBoard","prepareBoard","addGridFromUi","testRegions","beadr","beadg","beadb","regionA","regionB","PageBoard","useParams","getElementById","save_events","innerHTML","unmountThreejs","initialState","isAuthorized","AuthContext","createContext","reducer","PageHome","useContextSelector","ctx","PageNoMatch","PageNotAutorized","Routes","hashType","exact","path","App","startState","token","useReducer","Provider","packageJson","version","root","threejs","parentNode","insertBefore","nextSibling","user","username","hash","getAttribute","hashData","ReactDOM"],"mappings":"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","file":"static/js/main.e70d7fc7.chunk.js","sourcesContent":["import { debounce } from \"lodash\";\nimport { AppData } from \"./AppData\";\nimport { AppEvents, AppEventType } from \"./controllers/AppEventType\";\nimport { AppObject } from \"./editorObjects/Editor\";\n\nlet apiHost: string;\nlet headers: { [key: string]: any } = {\n  \"Content-Type\": \"application/json\",\n};\n\nexport const setApiFromAppData = (data: AppData) => {\n  apiHost = data.apiHost;\n  headers[\"Authorization\"] = \"Bearer \" + data.token;\n};\n\nconst handleError = (err: any, reject: any) => {\n  console.error(\"request error\", err);\n  reject(\"err\");\n};\n\nexport const prepareBoardsList = (): Promise<{\n  boards: {\n    uuid: string;\n    name: string;\n  }[];\n}> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/list\", {\n      method: \"GET\",\n      headers,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        resolve({\n          boards: response.boards,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nexport const fetchBoard = (\n  id: string\n): Promise<{ board: { uuid: string; name: string }; objects: AppObject[] }> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/one/\" + id, {\n      method: \"GET\",\n      headers,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        // console.log(\"co tam jest??\", response.objects);\n        resolve({\n          board: response.board,\n          objects: Object.keys(response.objects).map(\n            (key) => response.objects[key]\n          ),\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nexport const createBoard = (\n  name?: string\n): Promise<{ board: { uuid: string; name: string } }> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/create\", {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({ name: name ?? \"\" }),\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        resolve({\n          board: response.board,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\nexport const sendBoardBatchEvents = (\n  id: string,\n  body: string\n): Promise<{ status: boolean }> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/events/\" + id, {\n      method: \"POST\",\n      headers,\n      body,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        resolve({\n          status: response.statusCode,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nlet tempBoardId: string | undefined;\nlet sendingEnabled: boolean = false;\nlet sendingIntervalMs: number = 500;\nlet sendingInterval: any = undefined;\nlet lastSendTimestamp: any = new Date().getTime();\nlet toSendEventsQueue: SaveEvent[] = [];\n\nexport enum SaveEventType {\n  CREATE = \"CREATE\",\n  UPDATE = \"UPDATE\",\n  DELETE = \"DELETE\",\n}\nexport interface SaveEvent {\n  action: SaveEventType;\n  object: AppObject;\n  createdAt: string;\n}\n\nexport const notifyBackend = (events: SaveEvent[]) => {\n  if (sendingEnabled === true) {\n    if (events.length > 0) {\n      events.forEach((event) => {\n        toSendEventsQueue.push(event);\n      });\n      debouncedSend();\n    }\n  }\n};\nconst debouncedSend = debounce(\n  () => triggerSendBatchEvents(),\n  sendingIntervalMs,\n  { trailing: true }\n);\n\nexport const startBatchQueue = (id: string) => {\n  sendingEnabled = true;\n  tempBoardId = id;\n  lastSendTimestamp = new Date().getTime();\n  // sendingInterval = setInterval(debouncedSend, 250);\n};\n\nconst triggerSendBatchEvents = () => {\n  const now = new Date().getTime();\n  console.log(\n    \"triggerSendBatchEvents: diff: \",\n    now - lastSendTimestamp,\n    toSendEventsQueue.length > 0\n  );\n  if (toSendEventsQueue.length > 0 && tempBoardId !== undefined) {\n    const body = JSON.stringify({ changes: toSendEventsQueue });\n    toSendEventsQueue = [];\n    sendBoardBatchEvents(tempBoardId, body);\n  }\n  lastSendTimestamp = now;\n};\n\nexport const stopBatchQueue = (id: string) => {\n  sendingEnabled = false;\n  if (tempBoardId !== undefined) {\n    tempBoardId = undefined;\n  }\n  if (sendingInterval !== undefined) {\n    clearInterval(sendingInterval);\n  }\n  if (toSendEventsQueue.length > 0) {\n    toSendEventsQueue = [];\n  }\n};\n\nif (!Date.prototype.toISOString) {\n  (function () {\n    function pad(number) {\n      if (number < 10) {\n        return \"0\" + number;\n      }\n      return number;\n    }\n\n    Date.prototype.toISOString = function () {\n      return (\n        this.getUTCFullYear() +\n        \"-\" +\n        pad(this.getUTCMonth() + 1) +\n        \"-\" +\n        pad(this.getUTCDate()) +\n        \"T\" +\n        pad(this.getUTCHours()) +\n        \":\" +\n        pad(this.getUTCMinutes()) +\n        \":\" +\n        pad(this.getUTCSeconds()) +\n        \".\" +\n        (this.getUTCMilliseconds() / 1000).toFixed(3).slice(2, 5) +\n        \"Z\"\n      );\n    };\n  })();\n}\n","import { immerable } from \"immer\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { Store, StoreUiSettings } from \"../controllers/store\";\n\nexport interface Point {\n  x: number;\n  y: number;\n  z: number;\n  // [immerable]: boolean;\n}\n\nexport enum BeadTypes {\n  TOHO_MIYUKI = \"TOHO_MIYUKI\",\n  TOHO_15 = \"TOHO_15\",\n  TOHO_SPHERE = \"TOHO_SPHERE\",\n}\n\nexport interface AppObjectProps {\n  id: string;\n  position: Point;\n  width: number;\n  height: number;\n  depth: number;\n  rotateX: number;\n  rotateY: number;\n  rotateZ: number;\n  objectType: ObjectTypes;\n  isLocked: boolean;\n  canLockOrUnlock: boolean;\n}\n\nexport interface PreviewProject3D extends AppObjectProps {\n  color: string;\n}\n\nexport enum BeadMaterialTypes {\n  \"Shiny\" = \"Shiny\",\n  \"Mat\" = \"Mat\",\n}\n\nexport interface Bead extends AppObjectProps {\n  type: BeadTypes;\n  color: string;\n  material: BeadMaterialTypes;\n  lineRotate: number;\n  keepAspectRatio: boolean;\n  regionId: string | undefined;\n  groupId: string | undefined;\n}\n\nexport const groupIdKey: keyof Bead = \"groupId\";\n\nexport interface EditBBox {\n  id: string;\n  position: Point;\n  // [immerable]: boolean;\n  width: number;\n  height: number;\n  depth: number;\n  rotateX: number;\n  rotateY: number;\n  rotateZ: number;\n  editable: boolean;\n  selectedIds: {\n    id: string;\n    objectType: ObjectTypes;\n    groupId: string | undefined;\n  }[];\n  canLockOrUnlock: true;\n  isLocked: false;\n  objectType: ObjectTypes;\n  bbox?: THREE.Box3;\n}\n\nexport interface Line {\n  id: string;\n  start: Point;\n  end: Point;\n  beadIds: string[];\n  // [immerable]: boolean;\n  settings: {\n    beadsCount: number;\n    beadsAutoCount: boolean;\n    beadsSpacing: number;\n    beadsAutoSpacing: boolean;\n    defaultBead: Partial<Bead>;\n  };\n}\n\nexport enum RegionGridType {\n  Rectangles = \"Rectangles\",\n}\n\nexport enum RegionShape {\n  Rectangle = \"Rectangle\",\n  Triangle = \"Triangle\",\n  Circle = \"Circle\",\n}\n\nexport interface Region extends AppObjectProps {\n  beadIds: string[];\n  gridType: RegionGridType;\n  shape: RegionShape;\n  opacity: number;\n  columns: number;\n  rows: number;\n  autoFillBeads: boolean;\n  snapBeadsToCell: boolean;\n  childrenGridIds: (string | undefined)[];\n  // settings: {\n  // beadsCount: number;\n  // beadsAutoCount: boolean;\n  // beadsSpacing: number;\n  // beadsAutoSpacing: boolean;\n  // defaultBead: Partial<Bead>;\n  // };\n}\n\nexport interface Group extends AppObjectProps {\n  objectType: ObjectTypes;\n  childrenIds: string[];\n}\n\nexport interface AppData {\n  objects: { [s: string]: AppObject };\n  /**@deprecated */\n  beads: { [s: string]: Bead };\n  /**@deprecated */\n  lines: { [s: string]: Line };\n  /**@deprecated */\n  regions: { [s: string]: Region };\n}\n\nexport type AppObject = Bead | Region | Group | PreviewProject3D;\nexport type AppObjectKeys =\n  | keyof Bead\n  | keyof Region\n  | keyof Group\n  | keyof PreviewProject3D;\n\n// const dupa: MappedTypeWithNewProperties<AppObject> = {\n//   beadIds:\n// }\n\nexport enum ObjectTypes {\n  Bead = \"Bead\",\n  Region = \"Region\",\n  Group = \"Group\",\n  PreviewProject3D = \"PreviewProject3D\",\n  SceneEditBBox = \"SceneEditBBox\",\n  SceneBackgroundGrid = \"SceneBackgroundGrid\",\n  SceneLight = \"SceneLight\",\n}\nexport const NAME_SEPARATOR = \"__\";\n\nexport enum EditorMode {\n  Idle = \"Idle\",\n  EditLines = \"EditLines\",\n  AddLine = \"AddLine\",\n  SelectOrMove = \"SelectOrMove\",\n  SelectMultiple = \"SelectMultiple\",\n  AddBeads = \"AddBeads\",\n  DeleteBeads = \"DeleteBeads\",\n  PaintBeads = \"ColorPaint\",\n  AddRegion = \"AddRegion\",\n}\nexport enum EditorMenuMain {\n  None = \"None\",\n  File = \"File\",\n  Grid = \"Grid\",\n  Background = \"Background\",\n}\nexport enum EditorGridType {\n  Hex = \"Hex\",\n  Box = \"Box\",\n}\nexport enum BrushType {\n  Color = \"Color\",\n}\nexport interface ThreeLightConfig {\n  id: string;\n  type: \"THREE.DirectionalLight\" | \"THREE.AmbientLight\";\n  name: string;\n  color?: string | number | THREE.Color | undefined;\n  intensity?: number | undefined;\n  position?: {\n    x: number;\n    y: number;\n    z: number;\n  };\n}\n\nexport interface ThreeGridHelperConfig {\n  id: string;\n  type: EditorGridType;\n  hexSize: number;\n  snapEnabled: boolean;\n  isVisible: boolean;\n  width: number;\n  height: number;\n}\n\n// export interface EditorUi {\n//   mode: EditorMode;\n//   lights: ThreeLightConfig[];\n//   zoomScale: number;\n//   lineSettings: DeepPartial<Line>;\n//   saveInfo: {\n//     saved: boolean;\n//     haveUnsavedChanges: boolean;\n//   };\n//   /**@deprecated */\n//   selectedLinesIds: { [s: string]: boolean };\n//   /**@deprecated */\n//   selectedLinesIdsCount: number;\n//   /**@deprecated */\n//   selectedBeadsIds: { [s: string]: boolean };\n//   /**@deprecated */\n//   selectedBeadsIdsCount: number;\n//   /**@deprecated */\n//   selectedRegionsIds: { [s: string]: boolean };\n//   /**@deprecated */\n//   selectedRegionsIdsCount: number;\n//   selectedIds: string[];\n//   selectedIdsAsKeys: { [s: string]: boolean };\n//   selectedIdsCount: number;\n//   selectedTopBarPosition: THREE.Vector3 | undefined;\n//   editBBox: EditBBox | undefined;\n//   mouseSelection: {\n//     start: Point;\n//     end: Point;\n//     isDragStarted: boolean;\n//     isDragged: boolean;\n//   };\n//   currentMenuMainOpen: EditorMenuMain;\n//   grid: ThreeGridHelperConfig;\n//   currentBeadChain: {\n//     isDragEnabled: boolean;\n//     beadIds: string[];\n//   };\n//   beadsTemplate: {\n//     width: number;\n//     height: number;\n//     depth: number;\n//     type: BeadTypes;\n//     color: string;\n//     rotateX: number;\n//     rotateY: number;\n//     rotateZ: number;\n//     keepAspectRatio: boolean;\n//   };\n//   regionTemplate: {\n//     gridType: RegionGridType;\n//   };\n//   brush: {\n//     type: BrushType;\n//     size: number;\n//     color: string;\n//   };\n//   background: {\n//     image: {\n//       url: string;\n//       scale: number;\n//       position: Point;\n//       opacity: number;\n//     };\n//   };\n//   sceneWrapperWidth: number;\n//   sceneWrapperHeight: number;\n//   sceneWrapperPosition: {\n//     x: number;\n//     y: number;\n//     angle: number;\n//     scale: number;\n//     top: number;\n//     left: number;\n//   };\n// }\n\nexport interface Editor extends Store {\n  // appData: AppData;\n  // ui: StoreUiSettings;\n}\n","import React from \"react\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { createBoard, prepareBoardsList } from \"./ApiService\";\nimport { AppData } from \"./AppData\";\n\nexport const PageBoards: React.FC<{\n  data: AppData;\n}> = (props) => {\n  let history = useHistory();\n  const [state, setBoards] = React.useState<{\n    boards: { uuid: string; name: string }[];\n  }>({ boards: [] });\n\n  const onClickCreate = () => {\n    createBoard().then((response) => {\n      history.push(`/board/${response.board.uuid}`);\n    });\n  };\n\n  React.useEffect(() => {\n    prepareBoardsList().then((response) => {\n      setBoards({\n        boards: response.boards,\n      });\n    });\n  }, []);\n\n  return (\n    <PageStyles>\n      <div>\n        <h2>Boards</h2>\n        <button onClick={onClickCreate} className={\"btn-primary\"}>\n          Create board\n        </button>\n\n        <table>\n          <thead>\n            <tr>\n              <th>name</th>\n              <th>actions</th>\n            </tr>\n          </thead>\n\n          <tbody>\n            <tr>\n              <td>Board1</td>\n              <td>\n                <Link to=\"/board/demo\">DemoBoards</Link>\n              </td>\n            </tr>\n\n            {state.boards.map((board) => {\n              return (\n                <tr key={board.uuid}>\n                  <td>{board.name}</td>\n                  <td>\n                    <Link to={`/board/${board.uuid}`}>Edit</Link>\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n\n        <Link className={\"btn-light\"} to=\"/\">\n          Back Home\n        </Link>\n      </div>\n    </PageStyles>\n  );\n};\n\nconst PageStyles = styled.div`\n  padding: 1em;\n  table {\n    width: 100%;\n    max-width: 100%;\n    margin-bottom: 1rem;\n    background-color: transparent;\n  }\n  table td,\n  table th {\n    padding: 0.75rem;\n    vertical-align: top;\n    border-top: 1px solid #dee2e6;\n  }\n  table th {\n    color: #000;\n    background-color: #e9ecef;\n    border-color: #e9ecef;\n    vertical-align: bottom;\n    border-bottom: 2px solid #dee2e6;\n  }\n  table tbody tr:hover td {\n    color: #495057;\n    background-color: #e9ecef;\n    border-color: #dee2e6;\n  }\n  .btn-primary {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #fff;\n    background-color: #007bff;\n    border-color: #007bff;\n    margin-bottom: 10px;\n  }\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #f8f9fa;\n    margin-bottom: 10px;\n  }\n  h2{\n    margin-bottom: .5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n`;\n","import { ObjectTypes } from \"../../editorObjects/Editor\";\n\nexport enum ActionsTypes {\n  EditBeadProduct = \"EditBeadProduct\",\n  EditBeadType = \"EditBeadType\",\n  EditBeadMaterial = \"EditBeadMaterial\",\n  EditBeadColor = \"EditBeadColor\",\n\n  EditRegionGridType = \"EditRegionGridType\",\n  EditRegionGridSettings = \"EditRegionGridSettings\",\n\n  EditPosition = \"EditPosition\",\n  EditRotate = \"EditRotate\",\n  EditWidthHeight = \"EditWidthHeight\",\n  EditWidthHeightDepth = \"EditWidthHeightDepth\",\n\n  Alignment = \"Alignment\",\n  Lock = \"Lock\",\n  Unlock = \"Unlock\",\n  Group = \"Group\",\n  Ungroup = \"Ungroup\",\n\n  More = \"More\",\n}\n\nexport enum ActionsGroupTypes {\n  EditBeadsProperies = \"EditBeadsProperies\",\n  EditRegionProperies = \"EditRegionProperies\",\n  Transform = \"Transform\",\n  LockOrUnlock = \"LockOrUnlock\",\n  GroupOrUngroup = \"GroupOrUngroup\",\n  More = \"More\",\n}\n\nexport const MapActionObjectType: { [key: string]: ActionsTypes[] } = {\n  [ObjectTypes.Bead]: [\n    ActionsTypes.EditBeadProduct,\n    ActionsTypes.EditBeadType,\n    ActionsTypes.EditBeadMaterial,\n    ActionsTypes.EditBeadColor,\n    ActionsTypes.Alignment,\n    ActionsTypes.EditWidthHeightDepth,\n    ActionsTypes.EditPosition,\n    ActionsTypes.EditRotate,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n  [ObjectTypes.Region]: [\n    ActionsTypes.EditRegionGridType,\n    ActionsTypes.EditRegionGridSettings,\n    ActionsTypes.EditWidthHeight,\n    ActionsTypes.EditPosition,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n  [ObjectTypes.Group]: [\n    ActionsTypes.EditPosition,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n  [ObjectTypes.PreviewProject3D]: [\n    ActionsTypes.EditPosition,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n};\n\nexport interface IActions {\n  [key: string]: {\n    name: ActionsTypes;\n    sortOrder: number;\n    groupId: ActionsGroupTypes;\n    groupSortOrder: number;\n  };\n}\n\nexport const Actions: IActions = {\n  [ActionsTypes.EditBeadProduct]: {\n    name: ActionsTypes.EditBeadProduct,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditBeadType]: {\n    name: ActionsTypes.EditBeadType,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditBeadMaterial]: {\n    name: ActionsTypes.EditBeadMaterial,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditBeadColor]: {\n    name: ActionsTypes.EditBeadColor,\n    sortOrder: 40,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditRegionGridType]: {\n    name: ActionsTypes.EditRegionGridType,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.EditRegionProperies,\n    groupSortOrder: 40,\n  },\n  [ActionsTypes.EditRegionGridSettings]: {\n    name: ActionsTypes.EditRegionGridSettings,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.EditRegionProperies,\n    groupSortOrder: 40,\n  },\n  [ActionsTypes.EditPosition]: {\n    name: ActionsTypes.EditPosition,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.EditRotate]: {\n    name: ActionsTypes.EditRotate,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.EditWidthHeight]: {\n    name: ActionsTypes.EditWidthHeight,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.EditWidthHeightDepth]: {\n    name: ActionsTypes.EditWidthHeightDepth,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.Alignment]: {\n    name: ActionsTypes.Alignment,\n    sortOrder: 50,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.Lock]: {\n    name: ActionsTypes.Lock,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.LockOrUnlock,\n    groupSortOrder: 90,\n  },\n  [ActionsTypes.Unlock]: {\n    name: ActionsTypes.Unlock,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.LockOrUnlock,\n    groupSortOrder: 90,\n  },\n  [ActionsTypes.Group]: {\n    name: ActionsTypes.Group,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.GroupOrUngroup,\n    groupSortOrder: 80,\n  },\n  [ActionsTypes.Ungroup]: {\n    name: ActionsTypes.Ungroup,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.GroupOrUngroup,\n    groupSortOrder: 80,\n  },\n  [ActionsTypes.More]: {\n    name: ActionsTypes.More,\n    sortOrder: 1,\n    groupId: ActionsGroupTypes.More,\n    groupSortOrder: 100,\n  },\n};\n","import { AppObject, Bead, Group } from \"../editorObjects/Editor\";\nimport { StoreUiSettings } from \"./store\";\n\n// PAMIETAJ o tym aby dodac rownie \"event do history w AppHistory.ts\nexport enum AppEventType {\n  AddObjects = \"AddObjects\",\n  DuplicateObjects = \"DuplicateObjects\",\n  RemoveObjects = \"RemoveObjects\",\n  ChangeSelectObjects = \"ChangeSelectObjects\",\n  ChangeObjectsProperty = \"ChangeObjectsProperty\",\n  ChangeObjectsAlignment = \"ChangeObjectsAlignment\",\n  ClipboardCut = \"ClipboardCut\",\n  ClipboardCopy = \"ClipboardCopy\",\n  ClipboardPaste = \"ClipboardPaste\",\n  AddMultipleBeads = \"AddMultipleBeads\",\n  ChangeUiSettings = \"ChangeUiSettings\",\n  ChangeUiSettingsZoom = \"ChangeUiSettingsZoom\",\n  ChangeUiSettingsSidebar = \"ChangeUiSettingsSidebar\",\n  GroupObjects = \"GroupObjects\",\n  UngroupObjects = \"UngroupObjects\",\n}\n\nexport type AddMultipleBeads = {\n  name: AppEventType.AddMultipleBeads;\n  payload: { rows: number; columns: number; figure: \"rectangle\" };\n};\n\nexport type ClipboardCut = {\n  name: AppEventType.ClipboardCut;\n  payload: {};\n};\n\nexport type ClipboardCopy = {\n  name: AppEventType.ClipboardCopy;\n  payload: {};\n};\n\nexport type ClipboardPaste = {\n  name: AppEventType.ClipboardPaste;\n  payload: {\n    objects: AppObject[];\n  };\n};\n\nexport enum SnapToLineType {\n  X_MIN = \"X_MIN\",\n  X_MAX = \"X_MAX\",\n  X_MIDDLE = \"X_MIDDLE\",\n  Y_MIN = \"Y_MIN\",\n  Y_MAX = \"Y_MAX\",\n  Y_MIDDLE = \"Y_MIDDLE\",\n}\n\nexport type ChangeSelectedObjectsAlignment = {\n  name: AppEventType.ChangeObjectsAlignment;\n  payload: {\n    selectedIds: string[];\n    snapType: SnapToLineType;\n  };\n};\n\nexport type ChangeUiSettings = {\n  name: AppEventType.ChangeUiSettings;\n  payload: { uiSettings: Partial<StoreUiSettings> };\n};\n\nexport type ChangeUiSettingsSidebar = {\n  name: AppEventType.ChangeUiSettingsSidebar;\n  payload: {\n    panel: \"objects\" | \"history\" | \"comments\";\n    open: boolean;\n    toggle?: boolean;\n  };\n};\n\nexport type ChangeUiSettingsZoom = {\n  name: AppEventType.ChangeUiSettingsZoom;\n  payload: {\n    zoomType: \"zoomByScroll\" | \"zoomInScreenCenter\" | \"zoomOutScreenCenter\";\n    useAnimation: boolean;\n    clientX?: number;\n    clientY?: number;\n    scrollDelta?: number;\n  };\n};\n\nexport type AddObjects = {\n  name: AppEventType.AddObjects;\n  payload: { objects: Partial<AppObject>[] };\n};\n\nexport type GroupObjects = {\n  name: AppEventType.GroupObjects;\n  payload: {\n    objects: Pick<AppObject, \"id\">[];\n    removed?: Pick<Group, \"id\" | \"childrenIds\">[];\n    added?: Pick<Group, \"id\" | \"childrenIds\">;\n  };\n};\n\nexport type UngroupObjects = {\n  name: AppEventType.UngroupObjects;\n  payload: {\n    objects: Pick<AppObject, \"id\">[];\n    removed?: Pick<Group, \"id\" | \"childrenIds\">[];\n  };\n};\n\nexport type DuplicateObjects = {\n  name: AppEventType.DuplicateObjects;\n  payload: { objects: Partial<AppObject>[] };\n};\n\nexport type RemoveObjects = {\n  name: AppEventType.RemoveObjects;\n  payload: { ids: string[] };\n};\n\nexport type ChangeSelectObject = {\n  id: string;\n  isSelected: boolean;\n};\nexport type ChangeSelectObjects = {\n  name: AppEventType.ChangeSelectObjects;\n  payload: { change: ChangeSelectObject[] };\n};\n\nexport type MappedTypeWithNewProperties<T> = {\n  [Properties in keyof T]: T[Properties];\n};\n\nexport type AppObjectKeys = MappedTypeWithNewProperties<Partial<AppObject>>;\nexport type ChangeObject = {\n  id: string;\n  properties: AppObjectKeys;\n  relatedChanges?: ChangeObject[];\n  relatedCreateBeads?: Bead[];\n  relatedDeleteIds?: string[];\n};\nexport type ChangeObjectsProperty = {\n  name: AppEventType.ChangeObjectsProperty;\n  payload: {\n    changes: ChangeObject[];\n  };\n};\n\nexport type AppEvents =\n  | AddObjects\n  | RemoveObjects\n  | ChangeSelectObjects\n  | ChangeObjectsProperty\n  | ClipboardCut\n  | ClipboardCopy\n  | ClipboardPaste\n  | AddMultipleBeads\n  | ChangeUiSettings\n  | ChangeUiSettingsZoom\n  | ChangeUiSettingsSidebar\n  | ChangeSelectedObjectsAlignment\n  | DuplicateObjects\n  | GroupObjects\n  | UngroupObjects;\n","import { cloneDeep } from \"lodash\";\nimport * as THREE from \"three\";\nimport {\n  AppObject,\n  EditorGridType,\n  EditorMode,\n  ThreeGridHelperConfig,\n  ThreeLightConfig,\n} from \"../editorObjects/Editor\";\n\nexport interface StoreUiSettings {\n  zoomScale: number;\n  mode: EditorMode;\n  lights: ThreeLightConfig[];\n  grid: ThreeGridHelperConfig;\n  selectedTopBarPosition: THREE.Vector3 | undefined;\n  modalSearchProducts: {\n    isOpen: boolean;\n    successAction: \"updateBeadType\" | undefined;\n  };\n  leftSidebar: {\n    isOpen: boolean;\n    panel: \"comments\" | undefined;\n  };\n  rightSidebar: {\n    isOpen: boolean;\n    panel: \"history\" | \"objects\" | undefined;\n  };\n  blockThreejs: {\n    loading: boolean;\n    error: string | undefined;\n  };\n}\nexport interface SimpleHistoryEvent {\n  name: string;\n  isActive: boolean;\n  createdAt: string;\n}\nexport interface StoreHistory {\n  events: SimpleHistoryEvent[];\n  canRedo: boolean;\n  canUndo: boolean;\n}\n\nexport interface StoreBoard {\n  uuid: string;\n  isFavourite: boolean;\n  canToggleToFavourite: boolean;\n  canEdit: boolean;\n  canExportAsImage: boolean;\n  name: string;\n  editModalVisible: boolean;\n}\nexport interface Store {\n  objects: { [s: string]: AppObject };\n  selectedIds: string[];\n  ui: StoreUiSettings;\n  history: StoreHistory;\n  board: StoreBoard;\n}\n\nlet store: Store;\n\nexport const defaultStore: Store = {\n  objects: {},\n  selectedIds: [],\n  history: {\n    canRedo: false,\n    canUndo: false,\n    events: [],\n  },\n  board: {\n    uuid: \"\",\n    name: \"\",\n    canEdit: true,\n    canToggleToFavourite: true,\n    isFavourite: false,\n    canExportAsImage: true,\n    editModalVisible: false,\n  },\n  ui: {\n    modalSearchProducts: {\n      isOpen: false,\n      successAction: undefined,\n    },\n    leftSidebar: {\n      isOpen: false,\n      panel: undefined,\n    },\n    rightSidebar: {\n      isOpen: false,\n      panel: undefined,\n    },\n    zoomScale: 1,\n    mode: EditorMode.SelectOrMove,\n    lights: [\n      {\n        id: THREE.MathUtils.generateUUID(),\n        type: \"THREE.DirectionalLight\",\n        name: \"main_light_1\",\n        color: \"#FFF\",\n        intensity: 0.8,\n        position: {\n          x: 0,\n          y: 0,\n          z: 10,\n        },\n      },\n      {\n        id: THREE.MathUtils.generateUUID(),\n        type: \"THREE.DirectionalLight\",\n        name: \"main_light_2\",\n        color: \"#FFF\",\n        intensity: 0.4,\n        position: {\n          x: 0,\n          y: 0,\n          z: 10,\n        },\n      },\n    ],\n    grid: {\n      id: THREE.MathUtils.generateUUID(),\n      type: EditorGridType.Hex,\n      hexSize: 30,\n      snapEnabled: true,\n      isVisible: true,\n      width: 30,\n      height: 30,\n    },\n    selectedTopBarPosition: undefined,\n    blockThreejs: {\n      loading: true,\n      error: undefined,\n    },\n  },\n};\n\nexport const emptyStore: Store = {\n  objects: {},\n  selectedIds: [],\n  history: {\n    canRedo: false,\n    canUndo: false,\n    events: [],\n  },\n  board: {\n    canEdit: false,\n    canToggleToFavourite: false,\n    uuid: \"\",\n    isFavourite: false,\n    name: \"...\",\n    canExportAsImage: true,\n    editModalVisible: false,\n  },\n  ui: cloneDeep(defaultStore.ui),\n};\n\nexport const initStore = () => {\n  store = cloneDeep(defaultStore);\n};\n\nexport const getStore = () => {\n  return store;\n};\n\nexport const setStore = (newStore: Store) => {\n  console.log(\"APPSTORE: setStore\", newStore, newStore.selectedIds);\n  store = newStore;\n};\n","import { immerable } from \"immer\";\nimport {\n  Bead,\n  BeadMaterialTypes,\n  BeadTypes,\n  NAME_SEPARATOR,\n  ObjectTypes,\n} from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport { defaulBeadColor } from \"../components/colors\";\nimport * as THREE from \"three\";\n\nexport enum BeadChildSuffix {\n  MAIN = \"MAIN\",\n  ANY = \"beadChildOf\",\n  SELECTION = \"SELECTION\",\n  SELECTION_CHILD = \"SELECTION_CHILD\",\n}\n\nexport const getThreeNameFromBeadId = (\n  id: string,\n  childSuffix: BeadChildSuffix = BeadChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.Bead}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getBeadIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.Bead) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromBead = (\n  bead: Bead,\n  childSuffix?: BeadChildSuffix\n) => {\n  return merge({}, bead, {\n    name: getThreeNameFromBeadId(bead.id, childSuffix),\n  });\n};\n\nexport const buildBead = (props: DeepPartial<Bead>): Bead => {\n  const defaults: Bead = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    type: BeadTypes.TOHO_15,\n    material: BeadMaterialTypes.Mat,\n    rotateX: 90,\n    rotateY: 0,\n    rotateZ: 0,\n    lineRotate: 0,\n    color: defaulBeadColor,\n    height: 10,\n    width: 10,\n    depth: 10,\n    keepAspectRatio: false,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.Bead,\n    // [immerable]: true,\n    groupId: undefined,\n    regionId: undefined\n  };\n\n  return merge(defaults, props);\n};\n","import { Point } from \"./Editor\";\nimport { immerable } from \"immer\";\n\nexport const buildPoint = (\n  x: number = 0,\n  y: number = 0,\n  z: number = 0\n): Point => {\n  return {\n    x,\n    y,\n    z,\n    // [immerable]: true,\n  } as Point;\n};\n\nexport const getLength = (point: Point) => {\n  return Math.sqrt(point.x * point.x + point.y * point.y);\n};\n\nexport const normalize = (point: Point) => {\n  const length = getLength(point);\n  const useLen = length === 0;\n  const x = useLen ? 0 : point.x / length;\n  const y = useLen ? 0 : point.y / length;\n  return buildPoint(x, y);\n};\n\nexport const scale = (point: Point, scalar: number) => {\n  return buildPoint(point.x * scalar, point.y * scalar);\n};\n\nexport const add = (point: Point, x: number, y: number) => {\n  return buildPoint(point.x + x, point.y + y);\n};\n\nexport const sub = (point: Point, x: number, y: number) => {\n  return buildPoint(point.x - x, point.y - y);\n};\n\nexport const getDistance = (x1, y1, x2, y2): number => {\n  return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n};\n\nexport const getDistanceBetweenPoints = (start: Point, end: Point): number => {\n  return Math.sqrt(\n    (end.x - start.x) * (end.x - start.x) +\n      (end.y - start.y) * (end.y - start.y)\n  );\n};\n\nexport const getRotate = (y, x) => {\n  return Math.atan2(y, x);\n};\n\nexport const contain = (p1: Point, p2: Point, p: Point): boolean => {\n  return p.x > p1.x && p.x < p2.x && p.y > p1.y && p.y < p2.y;\n};\n\nexport const toRadian = (radians: number) => {\n  return (radians / 180) * Math.PI;\n};\n\nexport const toDeg = (radians: number) => {\n  return (radians * 180) / Math.PI;\n};\n","import { immerable } from \"immer\";\nimport { EditBBox, NAME_SEPARATOR, ObjectTypes } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum EditBBoxChildSuffix {\n  MAIN = \"MAIN\",\n  BG = \"BG\",\n  EDIT_CONTAINER = \"EDIT_CONTAINER\",\n  LINES = \"LINES\",\n  WHITE_DOT_BG = \"WHITE_DOT_BG\",\n  GRAY_DOT_BG = \"GRAY_DOT_BG\",\n  RESIZE_CONTAINER = \"RESIZE_CONTAINER\",\n  DOT_RESIZE_TOP_LEFT = \"DOT_RESIZE_TOP_LEFT\",\n  DOT_RESIZE_TOP_RIGHT = \"DOT_RESIZE_TOP_RIGHT\",\n  DOT_RESIZE_BOTTOM_LEFT = \"DOT_RESIZE_BOTTOM_LEFT\",\n  DOT_RESIZE_BOTTOM_RIGHT = \"DOT_RESIZE_BOTTOM_RIGHT\",\n}\n\nexport const getThreeNameFromEditBBoxId = (\n  id: string,\n  childSuffix: EditBBoxChildSuffix = EditBBoxChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.SceneEditBBox}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getEditBBoxIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.SceneEditBBox) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromEditBBox = (\n  editBBox: EditBBox,\n  childSuffix?: EditBBoxChildSuffix\n) => {\n  return merge({}, editBBox, {\n    name: getThreeNameFromEditBBoxId(editBBox.id, childSuffix),\n  });\n};\n\nexport const buildEditBBox = (props: DeepPartial<EditBBox>): EditBBox => {\n  const defaults: EditBBox = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n    height: 0,\n    width: 0,\n    depth: 10,\n    editable: true,\n    // beadIds: [],\n    // regionsIds: [],\n    selectedIds: [],\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.SceneEditBBox,\n    // [immerable]: true,\n  };\n\n  return merge(defaults, props);\n};\n","export const uiButton = \"#aeaeae\"\nexport const defaulBeadColor = \"#4fc3f7\";","import { immerable } from \"immer\";\nimport { Group, NAME_SEPARATOR, ObjectTypes } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum GroupChildSuffix {\n  MAIN = \"MAIN\",\n  BG = \"bg\",\n  ANY = \"GroupChildOf\",\n}\n\nexport const getThreeNameFromGroupId = (\n  id: string,\n  childSuffix: GroupChildSuffix = GroupChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.Group}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getGroupIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.Group) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromGroup = (\n  group: Group,\n  childSuffix?: GroupChildSuffix\n) => {\n  return merge({}, group, {\n    name: getThreeNameFromGroupId(group.id, childSuffix),\n  });\n};\n\nexport const buildGroup = (props: DeepPartial<Group>): Group => {\n  const defaults: Group = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    rotateX: 90,\n    rotateY: 0,\n    rotateZ: 0,\n    height: 10,\n    width: 10,\n    depth: 10,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.Group,\n    childrenIds: [],\n  };\n\n  return merge(defaults, props);\n};\n","import { immerable } from \"immer\";\nimport { NAME_SEPARATOR, ObjectTypes, PreviewProject3D } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum PreviewProject3DChildSuffix {\n  MAIN = \"MAIN\",\n  BG = \"BG\",\n  ANY = \"PreviewProject3DChildOf\",\n}\n\nexport const getThreeNameFromPreviewProject3DId = (\n  id: string,\n  childSuffix: PreviewProject3DChildSuffix = PreviewProject3DChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.PreviewProject3D}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getPreviewProject3DIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.PreviewProject3D) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromPreviewProject3D = (\n  obj: PreviewProject3D,\n  childSuffix?: PreviewProject3DChildSuffix\n) => {\n  return merge({}, obj, {\n    name: getThreeNameFromPreviewProject3DId(obj.id, childSuffix),\n  });\n};\n\nexport const buildPreviewProject3D = (\n  props: DeepPartial<PreviewProject3D>\n): PreviewProject3D => {\n  const defaults: PreviewProject3D = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    rotateX: 90,\n    rotateY: 0,\n    rotateZ: 0,\n    height: 10,\n    width: 10,\n    depth: 10,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.PreviewProject3D,\n    color: \"red\",\n  };\n\n  return merge(defaults, props);\n};\n","import { immerable } from \"immer\";\nimport {\n  NAME_SEPARATOR,\n  ObjectTypes,\n  Region,\n  RegionGridType,\n  RegionShape,\n} from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum RegionChildSuffix {\n  MAIN = \"main\",\n  BG = \"bg\",\n  GRID_CELLS = \"GRID_CELLS\",\n  GRID_CELL = \"gridCell\",\n  CONTENT = \"content\",\n}\n\nexport const getThreeNameFromRegionId = (\n  id: string,\n  childSuffix: RegionChildSuffix = RegionChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.Region}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getRegionIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.Region) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromRegion = (\n  region: Region,\n  childSuffix?: RegionChildSuffix\n) => {\n  return merge({}, region, {\n    name: getThreeNameFromRegionId(region.id, childSuffix),\n  });\n};\n\nexport const buildRegion = (props: DeepPartial<Region>): Region => {\n  const defaults: Region = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    gridType: RegionGridType.Rectangles,\n    shape: RegionShape.Rectangle,\n    height: 10,\n    width: 10,\n    beadIds: [],\n    opacity: 0.5,\n    columns: 3,\n    rows: 3,\n    autoFillBeads: false,\n    snapBeadsToCell: true,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.Region,\n    childrenGridIds: [],\n    depth: 1,\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n  };\n  const newRegion = merge(defaults, props);\n  const size = newRegion.rows * newRegion.columns;\n  const newChildrenGridIds = Array(size).fill(undefined);\n  newRegion.childrenGridIds = merge(newChildrenGridIds, props.childrenGridIds);\n\n  return newRegion;\n};\n","// import { log, warn, error } from \"three\";\nconst { log, warn, error } = console;\n\nexport type EventCallback = (data: any, state: any) => void;\nexport interface Events {\n  [key: string]: EventCallback[];\n}\nexport class EventEmitter {\n  _events: Events;\n  constructor() {\n    this._events = {};\n  }\n\n  on(name: string, listener: EventCallback) {\n    if (!this._events[name]) {\n      this._events[name] = [];\n    }\n\n    this._events[name].push(listener);\n  }\n\n  removeListener(name: string, listenerToRemove: EventCallback) {\n    if (!this._events[name]) {\n      error(`Can't remove a listener. Event \"${name}\" doesn't exits.`);\n      return;\n    }\n\n    const filterListeners = (listener) => listener !== listenerToRemove;\n\n    this._events[name] = this._events[name].filter(filterListeners);\n  }\n\n  emit(name: string, data: any, state: any) {\n    log(\"EventEmitter:emit:\", name, data);\n\n    if (!this._events[name]) {\n      warn(`Can't emit an event. Event \"${name}\" doesn't exits.`);\n      return;\n    }\n\n    const fireCallbacks = (callback: EventCallback) => {\n      callback(data, state);\n    };\n\n    this._events[name].forEach(fireCallbacks);\n  }\n}\n\nlet internalEventEmiter: EventEmitter | undefined;\n\nexport const getEventEmitter = () => {\n  if (internalEventEmiter === undefined) {\n    internalEventEmiter = new EventEmitter();\n  }\n  return internalEventEmiter;\n};\n\nexport enum EventNames {\n  updateEditorState = \"updateEditorState\",\n  /**@deprecated */\n  action_changeSelectedBeads_color = \"action_changeSelectedBeads_color\",\n  /**@deprecated */\n  action_changeSelectedBeads_height = \"action_changeSelectedBeads_height\",\n  /**@deprecated */\n  action_changeSelectedBeads_width = \"action_changeSelectedBeads_width\",\n  /**@deprecated */\n  action_changeSelectedBeads_depth = \"action_changeSelectedBeads_depth\",\n  /**@deprecated */\n  action_changeSelectedBeads_type = \"action_changeSelectedBeads_type\",\n  /**@deprecated */\n  action_changeSelectedBeads_rotate = \"action_changeSelectedBeads_rotate\",\n  /**@deprecated */\n  action_selectBeads = \"action_selectBeads\",\n  /**@deprecated */\n  action_deleteBeads = \"action_deleteBeads\",\n  /**@deprecated */\n  action_addBeadOnClick = \"action_addBeadOnClick\",\n  /**@deprecated */\n  action_updateLight = \"action_updateLight\",\n  /**@deprecated */\n  action_readSavedCanvas = \"action_readSavedCanvas\",\n  /**@deprecated */\n  startAppEvent = \"startAppEvent\",\n  /**@deprecated */\n  action_movedSelected = \"action_movedSelected\",\n  /**@deprecated */\n  action_changeBeadColorToBeadTemplate = \"action_changeBeadColorToBeadTemplate\",\n  /**@deprecated */\n  action_fastAddBeads = \"action_fastAddBeads\",\n  /**@deprecated */\n  action_snapToLineSelectedBeads = \"action_snapToLineSelectedBeads\",\n  /**@deprecated */\n  action_onChangeEditorMode = \"action_onChangeEditorMode\",\n  /**@deprecated */\n  action_deleteSelectedBeads = \"action_deleteSelectedBeads\",\n  /**@deprecated */\n  action_addRegion = \"action_addRegion\",\n  /**@deprecated */\n  action_selectRegions = \"action_selectRegions\",\n  /**@deprecated */\n  action_selectIntersectObjects = \"action_selectIntersectObjects\",\n  /**@deprecated */ \n  action_updateZoomSCale = \"action_updateZoomSCale\",\n  /**@deprecated */ \n  action_updateEditBBox = \"action_updateEditBBox\",\n  /**@deprecated */ \n  action_unselectAll = \"action_unselectAll\",\n  /**@deprecated */ \n  action_selectIntersectObject = \"action_selectIntersectObject\",\n  /**@deprecated */ \n  action_moveClickedObject = \"action_moveClickedObject\",\n  /**@deprecated */ \n  action_moveAllSelectedObjects = \"action_moveAllSelectedObjects\",\n  /**@deprecated */ \n  action_deleteObjects = \"action_deleteObjects\",\n}\n","import { getThreeNameFromBeadId } from \"./Bead\";\nimport { getThreeNameFromEditBBoxId } from \"./EditBBox\";\nimport { AppObject, Editor, ObjectTypes } from \"./Editor\";\nimport { getThreeNameFromGroupId } from \"./Group\";\nimport { getThreeNameFromPreviewProject3DId } from \"./PreviewProject3D\";\nimport { getThreeNameFromRegionId } from \"./Region\";\n\nexport const getStateObjectFromObjectId = (\n  objectId: string,\n  objectType: ObjectTypes\n) => {\n  let name: string | undefined = undefined;\n\n  if (objectType === ObjectTypes.Bead) {\n    name = getThreeNameFromBeadId(objectId);\n  } else if (objectType === ObjectTypes.Region) {\n    name = getThreeNameFromRegionId(objectId);\n  } else if (objectType === ObjectTypes.Group) {\n    name = getThreeNameFromGroupId(objectId);\n  } else if (objectType === ObjectTypes.PreviewProject3D) {\n    name = getThreeNameFromPreviewProject3DId(objectId);\n  } else if (objectType === ObjectTypes.SceneEditBBox) {\n    name = getThreeNameFromEditBBoxId(objectId);\n  }\n\n  if (name === undefined) {\n    console.warn(\"name is empty for id\", objectId);\n    return undefined;\n  }\n  return name;\n};\n","import { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\";\n// import { OBJLoader } from \"./OBJLoader\";\nimport * as THREE from \"three\";\n\n/**@ts-ignore */\n// eslint-disable-next-line import/no-webpack-loader-syntax\n// import toho_sphere_v1_2020_02_24 from \"!!raw-loader!./models3d/toho_sphere_v1_2020_02_24.obj\";\n/**@ts-ignore */\n// eslint-disable-next-line import/no-webpack-loader-syntax\n// import toho_miyuki_v2_2020_02_24 from \"!!raw-loader!./models3d/toho_miyuki_v2_2020_02_24.obj\";\n/**@ts-ignore */\n// eslint-disable-next-line import/no-webpack-loader-syntax\n// import toho_15_v4_2020_02_24 from \"!!raw-loader!./models3d/toho_15_v4_2020_02_24.obj\";\nimport { BeadTypes } from \"../editorObjects/Editor\";\n\nconst base3dModels: Base3dModels = {\n  toho_sphere: { model: null, bbox: null },\n  toho_miyuki: { model: null, bbox: null },\n  toho_15: { model: null, bbox: null },\n};\n\nexport type Base3dModelNames = \"toho_sphere\" | \"toho_miyuki\" | \"toho_15\";\n\nexport type Base3dModels = {\n  [day in Base3dModelNames]: {\n    model: THREE.Object3D | null;\n    bbox: THREE.Box3 | null;\n  };\n};\n\nexport const loadAppModels = async (appThree) => {\n  const objLoader = new OBJLoader();\n  // var objLoader = new THREE.OBJLoader();\n  // const objLoader = new THREE.ObjectLoader();\n\n  //@TODO: Przelicz wielkosci aby uzyc ich przy dodawaniu kolek\n  {\n    try {\n      \n      // const objLoader = new OBJLoader();\n      // const object = objLoader.parse(toho_sphere_v1_2020_02_24);\n      const object = await objLoader.loadAsync(\n        \"/models3d/toho_sphere_v1_2020_02_24.obj\"\n      );\n      console.log(\"OBJLoader: \", \"odczytano plik toho_sphere_v1_2020_02_24 \");\n      base3dModels[\"toho_sphere\"].model = object.clone();\n      base3dModels[\"toho_sphere\"].bbox = new THREE.Box3().setFromObject(object);\n    } catch (err) {\n      console.error(\n        \"OBJLoader: \",\n        \"nie mozna doczytac toho_sphere_v1_2020_02_24\"\n      );\n    }\n  }\n\n  {\n    try {\n      // const objLoader = new THREE.ObjectLoader();\n      // const objLoader = new OBJLoader();\n      // const object = objLoader.parse(toho_miyuki_v2_2020_02_24);\n      const object = await objLoader.loadAsync(\n        \"/models3d/toho_miyuki_v2_2020_02_24.obj\"\n      );\n      console.log(\"OBJLoader: \", \"odczytano plik diamondModelText \");\n      base3dModels[\"toho_miyuki\"].model = object.clone();\n      base3dModels[\"toho_miyuki\"].bbox = new THREE.Box3().setFromObject(object);\n    } catch (err) {\n      console.error(\"OBJLoader: \", \"nie mozna doczytac diamondModelText\");\n    }\n  }\n\n  {\n    try {\n      // const objLoader = new THREE.ObjectLoader();\n      // const objLoader = new OBJLoader();\n      // const object = objLoader.parse(toho_15_v4_2020_02_24);\n      const object = await objLoader.loadAsync(\n        \"/models3d/toho_miyuki_v2_2020_02_24.obj\"\n      );\n      console.log(\"OBJLoader: \", \"odczytano plik modelToho15v3a \");\n      base3dModels[\"toho_15\"].model = object.clone();\n      base3dModels[\"toho_15\"].bbox = new THREE.Box3().setFromObject(object);\n    } catch (err) {\n      console.error(\"OBJLoader: \", \"nie mozna doczytac modelToho15v3a\");\n    }\n  }\n\n  // @INFO: Loading external models\n  // {\n  //   const objLoader = new OBJLoader();\n  //   const baseBeadPath = \"./3dmodels/bead_2020_02_05.obj\";\n  //   objLoader.load(\n  //     baseBeadPath,\n  //     (object) => {\n  //       console.log(\"OBJLoader: \", \"odczytano plik: \", baseBeadPath);\n  //       object.position.set(10, 10, 10);\n  //       object.scale.x = 10;\n  //       object.scale.y = 10;\n  //       object.scale.z = 10;\n  //       base3dModels[\"baseBead\"] = object.clone();\n  //     },\n  //     (xhr) => {\n  //       console.log(\n  //         \"OBJLoader: \",\n  //         (xhr.loaded / xhr.total) * 100 + \"% loaded\"\n  //       );\n  //     },\n  //     (error) => {\n  //       console.error(\"OBJLoader: \", error);\n  //     }\n  //   );\n  // }\n\n  // scene.background = new THREE.TextureLoader().load(require('./img/background.jpg').default);\n  //  {\n  //     var bg_geometry = new THREE.PlaneGeometry(1000, 1000, 1);\n  //     var bg_material = new THREE.MeshBasicMaterial({\n  //       color: \"#ccc\",\n  //       side: THREE.DoubleSide,\n  //     });\n  //     var bg_plane = new THREE.Mesh(bg_geometry, bg_material);\n  //     scene.add(bg_plane);\n  //   }\n\n  //   {\n  //     var bg_geometry = new THREE.PlaneGeometry(1000, 1000, 1);\n  //     var bg_material = new THREE.MeshBasicMaterial({\n  //       color: \"#ccc\",\n  //       side: THREE.DoubleSide,\n  //     });\n  //     var bg_plane = new THREE.Mesh(bg_geometry, bg_material);\n  //     scene.add(bg_plane);\n  //   }\n};\n\nexport const getModelFromBeadType = (type: BeadTypes) => {\n  let beadModel: THREE.Object3D | undefined;\n\n  if (type === BeadTypes.TOHO_MIYUKI) {\n    if (base3dModels.toho_miyuki.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded diamond\");\n      return beadModel;\n    }\n    beadModel = base3dModels.toho_miyuki.model.clone();\n  }\n\n  if (type === BeadTypes.TOHO_15) {\n    if (base3dModels.toho_15.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.toho_15.model.clone();\n  }\n\n  if (type === BeadTypes.TOHO_SPHERE) {\n    if (base3dModels.toho_sphere.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.toho_sphere.model.clone();\n  }\n\n  return beadModel;\n};\n\nexport const getModelBBoxFromBeadType = (type: BeadTypes) => {\n  if (type === BeadTypes.TOHO_MIYUKI) {\n    return base3dModels.toho_miyuki.bbox;\n  }\n\n  if (type === BeadTypes.TOHO_15) {\n    return base3dModels.toho_15.bbox;\n  }\n\n  if (type === BeadTypes.TOHO_SPHERE) {\n    return base3dModels.toho_sphere.bbox;\n  }\n\n  return null;\n};\n","import { Editor } from \"../editorObjects/Editor\";\nimport { ImmerReducer } from \"immer-reducer\";\nimport { Store } from \"../controllers/store\";\n\nexport class MainImmerReducer extends ImmerReducer<Editor> {\n  // /** @deprecated */\n  // action_test() {}\n  // /** @deprecated */\n  // action_restoreState() {}\n  updateEditorState(newState: Store) {\n    this.draftState.objects = newState.objects;\n    this.draftState.selectedIds = newState.selectedIds;\n    this.draftState.ui = newState.ui;\n    this.draftState.board = newState.board;\n    this.draftState.history = newState.history;\n  }\n}\n","import {\n  Editor,\n  EditorMode,\n  BeadTypes,\n  EditorMenuMain,\n  EditorGridType,\n  BrushType,\n  RegionGridType,\n} from \"../editorObjects/Editor\";\nimport { buildPoint } from \"../editorObjects/Point\";\nimport { composeReducers } from \"immer-reducer\";\nimport { createActionCreators, createReducerFunction } from \"immer-reducer\";\nimport { DraggableOperationsImmerReducer } from \"./DraggableOperationsImmerReducer\";\nimport { PersistImmerReducer } from \"./PersistImmerReducer\";\nimport { ChangeEditorModeImmerReducer } from \"./ChangeEditorModeImmerReducer\";\nimport { MainImmerReducer } from \"./MainImmerReducer\";\nimport { MouseSelectionImmerReducer } from \"./MouseSelectionImmerReducer\";\nimport { ToolbarImmerReducer } from \"./ToolbarImmerReducer\";\nimport { defaulBeadColor } from \"../components/colors\";\nimport { TopbarImmerReducer } from \"./TopbarImmerReducer\";\nimport { PaintImmerReducer } from \"./PaintImmerReducer\";\nimport { buildBead } from \"../editorObjects/Bead\";\nimport { produce } from \"immer\";\nimport { getEventEmitter } from \"../EventEmitter\";\nimport { RegionImmerReducer } from \"./RegionImmerReducer\";\nimport * as THREE from \"three\";\nimport { defaultStore } from \"../controllers/store\";\n\n// const defaultBead = buildBead({});\n\n// const defaultAppData: Editor = {\n//   appData: {\n//     objects: {},\n//     beads: {},\n//     lines: {},\n//     regions: {},\n//   },\n// ui: {\n//   zoomScale: 1,\n//   lights: [\n//     {\n//       id: THREE.MathUtils.generateUUID(),\n//       type: \"THREE.DirectionalLight\",\n//       name: \"main_light_1\",\n//       color: \"#FFF\",\n//       intensity: 0.8,\n//       position: {\n//         x: 0,\n//         y: 0,\n//         z: 10,\n//       },\n//     },\n//     {\n//       id: THREE.MathUtils.generateUUID(),\n//       type: \"THREE.DirectionalLight\",\n//       name: \"main_light_2\",\n//       color: \"#FFF\",\n//       intensity: 0.4,\n//       position: {\n//         x: 0,\n//         y: 0,\n//         z: 10,\n//       },\n//     },\n//   ],\n// lineSettings: {\n//   settings: {\n//     beadsAutoCount: true,\n//     beadsAutoSpacing: true,\n//     beadsCount: 0,\n//     beadsSpacing: 0,\n//     defaultBead: {\n//       type: BeadTypes.TOHO_15,\n//       rotateX: 90,\n//       rotateY: 0,\n//       rotateZ: 0,\n//       color: defaulBeadColor,\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: false,\n//     },\n//   },\n// },\n// saveInfo: {\n//   saved: false,\n//   haveUnsavedChanges: false,\n// },\n// selectedRegionsIds: {},\n// selectedRegionsIdsCount: 0,\n// selectedLinesIds: {},\n// selectedLinesIdsCount: 0,\n// selectedBeadsIds: {},\n// selectedBeadsIdsCount: 0,\n\n// selectedIds: [],\n// selectedIdsAsKeys: {},\n// selectedIdsCount: 0,\n// selectedTopBarPosition: undefined,\n// editBBox: undefined,\n// mouseSelection: {\n//   start: buildPoint(0, 0),\n//   end: buildPoint(0, 0),\n//   isDragStarted: false,\n//   isDragged: false,\n// },\n// currentMenuMainOpen: EditorMenuMain.None,\n// grid: {\n//   id: THREE.MathUtils.generateUUID(),\n//   type: EditorGridType.Hex,\n//   hexSize: 30,\n//   snapEnabled: true,\n//   isVisible: true,\n//   width: 30,\n//   height: 30,\n// },\n// brush: {\n//   type: BrushType.Color,\n//   size: 50,\n//   color: defaulBeadColor,\n// },\n// background: {\n//   image: {\n//     url: \"\",\n//     scale: 1,\n//     position: buildPoint(0, 0),\n//     opacity: 0.5,\n//   },\n// },\n// beadsTemplate: {\n//   color: defaultBead.color,\n//   width: defaultBead.width,\n//   height: defaultBead.height,\n//   depth: defaultBead.depth,\n//   keepAspectRatio: defaultBead.keepAspectRatio,\n//   rotateX: defaultBead.rotateX,\n//   rotateY: defaultBead.rotateY,\n//   rotateZ: defaultBead.rotateZ,\n//   type: defaultBead.type,\n// },\n// currentBeadChain: {\n//   isDragEnabled: false,\n//   beadIds: [],\n// },\n// sceneWrapperWidth: 0,\n// sceneWrapperHeight: 0,\n// sceneWrapperPosition: {\n//   x: 0,\n//   y: 0,\n//   angle: 0,\n//   scale: 0,\n//   top: 0,\n//   left: 0,\n// },\n// regionTemplate: {\n//   gridType: RegionGridType.Rectangles,\n// },\n// },\n// mode: EditorMode.SelectOrMove,\n// };\n\nexport const Actions = {\n  Main: createActionCreators(MainImmerReducer),\n  // Draggable: createActionCreators(DraggableOperationsImmerReducer),\n  // Persist: createActionCreators(PersistImmerReducer),\n  // ChangeEditorMode: createActionCreators(ChangeEditorModeImmerReducer),\n  // MouseSelection: createActionCreators(MouseSelectionImmerReducer),\n  // Toolbar: createActionCreators(ToolbarImmerReducer),\n  // Topbar: createActionCreators(TopbarImmerReducer),\n  // Paint: createActionCreators(PaintImmerReducer),\n  // Region: createActionCreators(RegionImmerReducer),\n};\n\n// const eventEmitter = getEventEmitter();\n\n// const reducerForEventEmitter = produce((state, action) => {\n//   eventEmitter.emit(action.type, action.payload, state);\n// }, {});\n\nexport const store = composeReducers(\n  createReducerFunction(MainImmerReducer, defaultStore)\n  // createReducerFunction(DraggableOperationsImmerReducer, defaultAppData),\n  // createReducerFunction(PersistImmerReducer, defaultAppData),\n  // createReducerFunction(ToolbarImmerReducer, defaultAppData),\n  // createReducerFunction(TopbarImmerReducer, defaultAppData),\n  // createReducerFunction(ChangeEditorModeImmerReducer, defaultAppData),\n  // createReducerFunction(MouseSelectionImmerReducer, defaultAppData),\n  // createReducerFunction(PaintImmerReducer, defaultAppData),\n  // createReducerFunction(RegionImmerReducer, defaultAppData),\n  // reducerForEventEmitter\n);\n","import { applyMiddleware, createStore } from \"redux\";\n// import thunk from \"redux-thunk\";\nimport { store } from \"./store\";\n\nexport const appStore = createStore(\n  store,\n  // \"__REDUX_DEVTOOLS_EXTENSION__\" in window &&\n  //   (window as any).__REDUX_DEVTOOLS_EXTENSION__()\n  // applyMiddleware(thunk)\n);\n","import { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport * as THREE from \"three\";\nimport { Group, groupIdKey, ObjectTypes } from \"../../../editorObjects/Editor\";\nimport { getStore } from \"../../../controllers/store\";\n\nexport class MouseEventsBase {\n  boundingClientRect: DOMRect | undefined;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  intersects: THREE.Intersection[];\n\n  constructor() {\n    this.boundingClientRect = undefined;\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n    this.intersects = [];\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {}\n\n  onMove(event: PointerEvent) {}\n\n  onUp(event: PointerEvent) {}\n\n  getIntersect(clientX: number, clientY: number) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n\n    if (this.boundingClientRect === undefined) {\n      return [];\n    }\n\n    const { width, height, top, left } = this.boundingClientRect;\n    this.mouse.x = ((clientX - left) / width) * 2 - 1;\n    this.mouse.y = -((clientY - top) / height) * 2 + 1;\n    this.raycaster.setFromCamera(this.mouse, appThree.camera);\n    return this.raycaster.intersectObjects(appThree.scene.children, true);\n  }\n\n  getIntersectObjects(clientX: number, clientY: number) {\n    return this.getObjectsFromIntersect(this.getIntersect(clientX, clientY));\n  }\n\n  getActiveObjectsFromIntersect(clientX: number, clientY: number) {\n    const intersects = this.getIntersect(clientX, clientY);\n    return intersects.filter((obj) => {\n      const data = obj.object.userData;\n      const isLocked = data?.isLocked ?? false;\n      const objectType = data?.objectType ?? undefined;\n      return (\n        // isLocked === false &&\n        objectType === ObjectTypes.Bead ||\n        objectType === ObjectTypes.Region ||\n        objectType === ObjectTypes.Group ||\n        objectType === ObjectTypes.PreviewProject3D\n        // || objectType === ObjectTypes.SceneEditBBox\n      );\n    });\n  }\n\n  getObjectsFromIntersect(intersects: THREE.Intersection[]) {\n    const { Bead, Region, SceneEditBBox } = ObjectTypes;\n    return intersects.filter((obj) => {\n      const objectType = obj?.object?.userData?.objectType ?? undefined;\n      return (\n        objectType === Bead ||\n        objectType === Region ||\n        objectType === SceneEditBBox\n      );\n    });\n  }\n\n  getIdsFromGroupOrInGroup(objectId: string) {\n    const store = getStore();\n    if (store.objects[objectId] === undefined) {\n      return [];\n    }\n    // store.objects[objectId].objectType;\n    const isGroup = store.objects[objectId].objectType === ObjectTypes.Group;\n    const isInGroup =\n      store.objects[objectId][groupIdKey] !== undefined &&\n      store.objects[objectId][groupIdKey].length > 0;\n    const groupId = store.objects[objectId][groupIdKey];\n    if (isGroup) {\n      return (store.objects[objectId] as Group).childrenIds;\n    } else if (isInGroup) {\n      return [groupId, ...(store.objects[groupId] as Group).childrenIds];\n    } else {\n      return [];\n    }\n  }\n\n  groupObjectsByTypeFromIntersect(\n    intersects: THREE.Intersection[],\n    maxItems?: number\n  ) {\n    const { Bead, Region, SceneEditBBox } = ObjectTypes;\n    const result: {\n      Bead: THREE.Intersection[];\n      Region: THREE.Intersection[];\n      SceneEditBBox: THREE.Intersection[];\n    } = {\n      Bead: [],\n      Region: [],\n      SceneEditBBox: [],\n    };\n    const selected: number[] = [];\n    intersects.forEach((obj, index) => {\n      if (maxItems !== undefined) {\n        if (selected.length >= maxItems) {\n          return;\n        }\n      }\n      const id = obj?.object?.userData?.id ?? undefined;\n      const objectType = obj?.object?.userData?.objectType ?? undefined;\n      const isLocked = obj?.object?.userData?.isLocked ?? false;\n\n      if (id !== undefined) {\n        if (objectType !== undefined) {\n          result[objectType].push(obj);\n          selected.push(index);\n        }\n      }\n    });\n    return result;\n  }\n}\n","import { AddObjects, AppEventType } from \"../../../controllers/AppEventType\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { buildBead } from \"../../../editorObjects/Bead\";\nimport {\n  Bead,\n  BeadTypes,\n  EditorMode,\n  ObjectTypes,\n} from \"../../../editorObjects/Editor\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { getModelBBoxFromBeadType } from \"../../loadModels\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeAddBead extends MouseEventsBase {\n  constructor() {\n    super();\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    const bbox = getModelBBoxFromBeadType(BeadTypes.TOHO_15);\n    let width = 1;\n    let height = 1;\n    let depth = 1;\n    if (bbox) {\n      width = Math.abs(bbox.max.x - bbox.min.x);\n      height = Math.abs(bbox.max.y - bbox.min.y);\n      depth = Math.abs(bbox.max.z - bbox.min.z);\n    }\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    const action1: AddObjects = {\n      name: AppEventType.AddObjects,\n      payload: {\n        objects: [\n          {\n            position: { x: x, y: y, z: 1 },\n            width,\n            height,\n            objectType: ObjectTypes.Bead,\n          },\n        ],\n      },\n    };\n    sendEvent(action1);\n  }\n\n  onMove(event: PointerEvent) {}\n\n  onUp(event: PointerEvent) {}\n}\n","export class MouseDragHelper {\n  isDragged: boolean = false;\n  isDragStarted: boolean = false;\n  end: { x: number; y: number } = { x: 0, y: 0 };\n  start: { x: number; y: number } = { x: 0, y: 0 };\n  shouldBehaveLikeMove: boolean = false;\n\n  onDown(x: number, y: number) {\n    this.isDragStarted = true;\n    this.start.x = x;\n    this.start.y = y;\n    this.end.x = x;\n    this.end.y = y;\n  }\n  \n  onUp() {\n    this.isDragStarted = false;\n    this.isDragged = false;\n    this.start.x = 0;\n    this.start.y = 0;\n    this.end.x = 0;\n    this.end.y = 0;\n    this.shouldBehaveLikeMove = false;\n  }\n\n  onMove(x: number, y: number) {\n    if (this.isDragStarted == true) {\n      this.end.x = x;\n      this.end.y = y;\n      if (this.isDragged === false) {\n        const { start, end } = this;\n        const deltaX = end.x - start.x;\n        const deltaY = end.y - start.y;\n\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\n          this.isDragged = true;\n        }\n      }\n    }\n  }\n}\n","import { Vector2 } from \"three\";\n\nexport class MouseSelectionHelper {\n  element: HTMLDivElement;\n  renderer: any;\n  startPoint: Vector2;\n  pointTopLeft: Vector2;\n  pointBottomRight: Vector2;\n  isDown: boolean;\n\n  constructor() {\n    this.element = document.createElement(\"div\");\n    this.element.style.pointerEvents = \"none\";\n    this.element.style.background = \"rgba(75, 160, 255, 0.3)\";\n    this.element.style.border = \"1px solid #55aaff\";\n    this.element.style.position = \"absolute\";\n    this.element.style.zIndex = \"2\";\n    this.startPoint = new Vector2();\n    this.pointTopLeft = new Vector2();\n    this.pointBottomRight = new Vector2();\n    this.isDown = false;\n  }\n\n  setRenderer(renderer) {\n    this.renderer = renderer;\n  }\n\n  onDown(screenX: number, screenY: number) {\n    this.isDown = true;\n    this.renderer.domElement.parentElement.appendChild(this.element);\n\n    // this.element.setAttribute(\"style\", `\n    //   left: ${screenX}px;\n    //   top: ${screenY}px;\n    //   width: 0px;\n    //   height: 0px;\n    // `);\n    this.element.style.left = screenX + \"px\";\n    this.element.style.top = screenY + \"px\";\n    this.element.style.width = \"0px\";\n    this.element.style.height = \"0px\";\n\n    this.startPoint.x = screenX;\n    this.startPoint.y = screenY;\n  }\n\n  onMove(screenX: number, screenY: number) {\n    if (this.isDown) {\n      this.pointBottomRight.x = Math.max(this.startPoint.x, screenX);\n      this.pointBottomRight.y = Math.max(this.startPoint.y, screenY);\n      this.pointTopLeft.x = Math.min(this.startPoint.x, screenX);\n      this.pointTopLeft.y = Math.min(this.startPoint.y, screenY);\n\n      this.element.style.left = this.pointTopLeft.x + \"px\";\n      this.element.style.top = this.pointTopLeft.y + \"px\";\n      this.element.style.width =\n        this.pointBottomRight.x - this.pointTopLeft.x + \"px\";\n      this.element.style.height =\n        this.pointBottomRight.y - this.pointTopLeft.y + \"px\";\n    }\n  }\n\n  onUp() {\n    if (this.element.parentElement !== null) {\n      this.element.parentElement.removeChild(this.element);\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport {\n  AddObjects,\n  AppEventType,\n  ChangeUiSettings,\n} from \"../../../controllers/AppEventType\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { getBeadIdFromThreeName } from \"../../../editorObjects/Bead\";\nimport {\n  EditorMode,\n  ObjectTypes,\n  Point,\n  Region,\n} from \"../../../editorObjects/Editor\";\nimport { buildPoint } from \"../../../editorObjects/Point\";\nimport { buildRegion } from \"../../../editorObjects/Region\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"./../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"./../MouseSelectionHelper\";\nimport { screenToWorld } from \"./../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeAddRegion extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  mouseSelectionHelper: MouseSelectionHelper;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { top, left } = this.boundingClientRect;\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n    this.mouseSelectionHelper.onDown(screenX, screenY);\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { width, height, top, left } = this.boundingClientRect;\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n    this.mouseSelectionHelper.onMove(screenX, screenY);\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onMove(x, y);\n  }\n\n  onUp(event: PointerEvent) {\n    // const { getState, dispatch } = appStore;\n    // const { dispatch } = appStore;\n    // const state = getState();\n    const minX = Math.min(\n      this.mouseDragHelper.start.x,\n      this.mouseDragHelper.end.x\n    );\n    const minY = Math.min(\n      this.mouseDragHelper.start.y,\n      this.mouseDragHelper.end.y\n    );\n    const width = Math.abs(\n      this.mouseDragHelper.end.x - this.mouseDragHelper.start.x\n    );\n    const height = Math.abs(\n      this.mouseDragHelper.end.y - this.mouseDragHelper.start.y\n    );\n    // let defaultRegion: Partial<Region> = {\n    //  ...this.draftState.ui.regionTemplate,\n    // };\n    // defaultRegion.id = undefined;\n    // defaultRegion.position = buildPoint(minX + width / 2, minY + height / 2);\n    // defaultRegion.height = height;\n    // defaultRegion.width = width;\n\n    const action1: AddObjects = {\n      name: AppEventType.AddObjects,\n      payload: {\n        objects: [\n          {\n            objectType: ObjectTypes.Region,\n            height,\n            width,\n            position: {\n              x: minX + width / 2,\n              y: minY + height / 2,\n              z: 1\n            },\n          },\n        ],\n      },\n    };\n    sendEvent(action1);\n    const action2: ChangeUiSettings = {\n      name: AppEventType.ChangeUiSettings,\n      payload: {\n        uiSettings: {\n          mode: EditorMode.SelectOrMove,\n        },\n      },\n    };\n    sendEvent(action2);\n    // dispatch(\n    //   Actions.Region.action_addRegion(\n    //     this.mouseDragHelper.start as Point,\n    //     this.mouseDragHelper.end as Point\n    //   )\n    // );\n    // dispatch(\n    //   Actions.ChangeEditorMode.action_onChangeEditorMode(\n    //     EditorMode.SelectOrMove\n    //   )\n    // );\n    this.mouseDragHelper.onUp();\n    this.mouseSelectionHelper.onUp();\n  }\n}\n","import * as THREE from \"three\";\nimport { AppEventType, RemoveObjects } from \"../../../controllers/AppEventType\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { getBeadIdFromThreeName } from \"../../../editorObjects/Bead\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"./../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"./../MouseSelectionHelper\";\nimport { screenToWorld } from \"./../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeDelete extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  mouseSelectionHelper: MouseSelectionHelper;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n    if (appThree.el === null) {\n      throw new Error(\"no el in dom\");\n    }\n    const { top, left } = appThree.el.getBoundingClientRect();\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n    this.mouseSelectionHelper.onDown(screenX, screenY);\n  }\n\n  onMove(event: PointerEvent) {}\n\n  onUp(event: PointerEvent) {\n    // const { getState, dispatch } = appStore;\n    // const state = getState();\n    if (this.mouseDragHelper.isDragged === true) {\n      // do nothing\n    } else if (\n      this.mouseDragHelper.isDragged === false &&\n      this.mouseDragHelper.isDragStarted === true\n    ) {\n      if (appThree.el !== null) {\n        const {\n          width,\n          height,\n          top,\n          left,\n        } = appThree.el.getBoundingClientRect();\n        this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n        this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n\n        this.intersects = this.getActiveObjectsFromIntersect(\n          event.clientX,\n          event.clientY\n        );\n        const firstClickedActiveObject = this.intersects.length > 0;\n\n        if (firstClickedActiveObject) {\n          console.log(\n            \"usuwam firstClickedActiveObject\",\n            firstClickedActiveObject,\n            this.intersects[0].object.userData.id\n          );\n          const objectId = this.intersects[0].object.userData.id;\n          const childrenIds = this.getIdsFromGroupOrInGroup(objectId);\n          const action: RemoveObjects = {\n            name: AppEventType.RemoveObjects,\n            payload: {\n              ids: [objectId, ...childrenIds],\n            },\n          };\n          sendEvent(action);\n          // dispatch(\n          //   Actions.Toolbar.action_deleteObjects([\n          //     this.intersects[0].object.userData.id,\n          //   ])\n          // );\n        }\n        // this.raycaster.setFromCamera(this.mouse, appThree.camera);\n        // const intersects = this.raycaster.intersectObjects(\n        //   appThree.scene.children,\n        //   true\n        // );\n        // const beadsIds: string[] = [];\n        // intersects.forEach((e) => {\n        //   const id = getBeadIdFromThreeName(e.object.name);\n        //   if (id !== undefined) {\n        //     if (state.appData.beads[id]) {\n        //       beadsIds.push(id);\n        //     } else {\n        //       console.warn(\"bead id missing in store\", id);\n        //     }\n        //   }\n        // });\n        // dispatch(Actions.Toolbar.action_deleteBeads(beadsIds));\n      }\n    } else {\n      // do nothing\n    }\n    this.mouseDragHelper.onUp();\n    this.mouseSelectionHelper.onUp();\n  }\n}\n","import { appStore } from \"../immerReducers/appStore\";\nimport { Actions } from \"../immerReducers/store\";\nimport { Store } from \"./store\";\n\nexport const refreshReactState = (newState: Store) => {\nconst { dispatch } = appStore;\ndispatch(Actions.Main.updateEditorState(newState))\n}","import { xor } from \"lodash\";\n\nexport const keyCodeToKeyName = {\n  8: \"backspace\",\n  9: \"tab\",\n  13: \"enter\",\n  16: \"shift\",\n  17: \"ctrl\",\n  18: \"alt\",\n  20: \"capslock\",\n  27: \"escape\",\n  32: \"space\",\n  33: \"pageup\",\n  34: \"pagedown\",\n  35: \"end\",\n  36: \"home\",\n  37: \"left\",\n  38: \"up\",\n  39: \"right\",\n  40: \"down\",\n  45: \"ins\",\n  46: \"del\",\n  91: \"meta\",\n  93: \"meta\",\n  224: \"meta\",\n\n  106: \"*\",\n  107: \"+\",\n  109: \"-\",\n  110: \".\",\n  111: \"/\",\n  186: \";\",\n  187: \"=\",\n  188: \",\",\n  189: \"-\",\n  190: \".\",\n  191: \"/\",\n  192: \"`\",\n  219: \"[\",\n  220: \"\\\\\",\n  221: \"]\",\n  222: \"'\",\n\n  ArrowUp: \"Up\",\n  ArrowDown: \"Down\",\n  ArrowLeft: \"Left\",\n  ArrowRight: \"Right\",\n};\n\nexport const modifiers = {\n  ShiftLeft: \"shift\",\n  ShiftRight: \"shift\",\n  AltLeft: \"alt\",\n  AltRight: \"alt\",\n  MetaLeft: \"meta\",\n  MetaRight: \"meta\",\n  ControlLeft: \"control\",\n  ControlRight: \"control\",\n};\n\nexport const isEventModifier = (event) => {\n  // new browsers\n  if (\"code\" in event) {\n    return !!modifiers[event.code];\n  }\n\n  // old browsers\n  return (\n    event.which === 16 ||\n    event.which === 17 ||\n    event.which === 18 ||\n    event.which === 91\n  );\n};\n\nexport const getKeyEventName = (event) => {\n  let keyName = \"\";\n  const keys: string[] = [];\n\n  if (\"code\" in event) {\n    keyName = keyCodeToKeyName[event.code]\n      ? keyCodeToKeyName[event.code]\n      : event.code;\n  } else {\n    const keyCode = event.which;\n    keyName = String.fromCharCode(keyCode).toLowerCase();\n    if (keyCodeToKeyName[keyCode]) {\n      keyName = keyCodeToKeyName[keyCode];\n    }\n  }\n\n  //   if (event.altKey) {\n  //     keys.push(\"Alt\");\n  //   }\n\n  //   if (event.shiftKey) {\n  //     keys.push(\"Shift\");\n  //   }\n\n  //   if (event.ctrlKey) {\n  //     keys.push(\"Ctrl\");\n  //   }\n\n  //   if (event.metaKey) {\n  //     keys.push(\"Meta\");\n  //   }\n\n  keys.push(keyName);\n\n  return keys.join(\"+\");\n};\n\nexport const isInputElement = (element) => {\n  if (!element || !element.tagName) {\n    return false;\n  }\n\n  return (\n    element.tagName === \"BUTTON\" ||\n    element.tagName === \"INPUT\" ||\n    element.tagName === \"SELECT\" ||\n    element.tagName === \"TEXTAREA\"\n  );\n};\n\nexport const defaultMonitor = (eventName) => {\n  // console.log(\":keyboard event:\", eventName);\n};\n\nexport const isInputEvent = (event) => {\n  return isInputElement(event.target || event.nativeEvent.target);\n};\n\nlet __preventDefaultEvents = false;\nlet __ignoreInputEvents = false;\nlet __pressed = {};\nlet __element: Element | Document | undefined = undefined;\nlet __subscriptions = {};\nlet __monitor: (\n  eventName: string,\n  matched: boolean,\n  event: any\n) => void = defaultMonitor;\n\nexport function initKeybinding(element: Element | Document | null = null) {\n  if (typeof window === \"undefined\") {\n    // not a browser environment?\n    return false;\n  }\n\n  // default element is the window document\n  if (element === null) {\n    __element = window.document;\n  }\n\n  // ignore input events, except when the element is an input.\n  __ignoreInputEvents = !isInputElement(__element);\n\n  let hidden, visibilityChange;\n  if (typeof document.hidden !== \"undefined\") {\n    // Opera 12.10 and Firefox 18 and later support\n    hidden = \"hidden\";\n    visibilityChange = \"visibilitychange\";\n  } else if (typeof (document as any).msHidden !== \"undefined\") {\n    hidden = \"msHidden\";\n    visibilityChange = \"msvisibilitychange\";\n  } else if (typeof (document as any).webkitHidden !== \"undefined\") {\n    hidden = \"webkitHidden\";\n    visibilityChange = \"webkitvisibilitychange\";\n  }\n  function handleVisibilityChange() {\n    // console.log(\"handleVisibilityChange.... \", document[hidden]);\n    if (document[hidden]) {\n      __pressed = {};\n    }\n  }\n  if (\n    typeof document.addEventListener === \"undefined\" ||\n    hidden === undefined\n  ) {\n    console.warn(\n      \"This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API.\"\n    );\n  } else {\n    document.addEventListener(visibilityChange, handleVisibilityChange, false);\n    // console.log(\"podpinamm... visibilityChange\");\n  }\n}\n\n// creates a subscription and returns the unsubscribe function;\nexport const subscribeKeys = (\n  name: string,\n  callback: (event: KeyboardEvent, pressed: string[]) => void\n) => {\n  // Subscripton names are lowercased so both 'Shift+Space' and 'shift+space' works.\n  name = name.toLowerCase();\n  // remove spaces so both 'Shift + Space' and 'shift+space' works.\n  name.replace(/\\s/, \"\");\n\n  if (typeof __subscriptions[name] === \"undefined\") {\n    __subscriptions[name] = [];\n  }\n\n  __subscriptions[name].push(callback);\n\n  return {\n    unsubscribe: () => {\n      const index = __subscriptions[name].indexOf(callback);\n      __subscriptions[name].splice(index, 1);\n    },\n  };\n};\n\n// alows to set a monitor function that will run on every event\nexport function setMonitor(\n  enabled: boolean,\n  monitorFn?: (eventName: string, matched: boolean, event: any) => void\n) {\n  if (enabled === false) {\n    __monitor = () => {};\n  } else {\n    if (monitorFn !== undefined) {\n      __monitor = monitorFn;\n    } else {\n      __monitor = defaultMonitor;\n    }\n  }\n}\n\nexport function startListeningKeys() {\n  if (__element !== undefined) {\n    (__element as any).addEventListener(\"keydown\", handleKeyEvent);\n    __element.addEventListener(\"keyup\", unhandleKeyEvent);\n  }\n}\n\nexport function stopListeningKeys() {\n  if (__element !== undefined) {\n    (__element as any).removeEventListener(\"keydown\", handleKeyEvent);\n    __element.removeEventListener(\"keyup\", unhandleKeyEvent);\n  }\n}\n\nexport function setPreventDefault(newValue: boolean) {\n  __preventDefaultEvents = newValue;\n}\n\nexport function isPressedKey(eventName: string) {\n  return __pressed[eventName] === true;\n}\nexport function isPressedKeys(eventNames: string[]) {\n  return xor(Object.keys(__pressed), eventNames).length === 0;\n}\n\nexport function getKeysPressed() {\n  return Object.keys(__pressed);\n}\n\nfunction unhandleKeyEvent(event: Event) {\n  __pressed = {};\n}\n\n// listens to the event and fires the appropiate event subscription\nfunction handleKeyEvent(event: KeyboardEvent) {\n  if (__preventDefaultEvents === true) {\n    event.preventDefault();\n  }\n\n  //   console.log(\"handleKeyEventhandleKeyEvent\", 1);\n  //   if (isEventModifier(event)) {\n  //     return;\n  //   }\n  //   console.log(\"handleKeyEventhandleKeyEvent\", 2);\n\n  //   if (__ignoreInputEvents && isInputEvent(event)) {\n  //     return;\n  //   }\n\n  const eventName = getKeyEventName(event);\n  const listeners = __subscriptions[eventName.toLowerCase()] || [];\n\n  if (typeof __monitor === \"function\") {\n    const matched = listeners.length > 0;\n    __monitor(eventName, matched, event);\n  }\n  __pressed[eventName.toLowerCase()] = true;\n\n  if (listeners.length > 0) {\n    event.preventDefault();\n  }\n\n  let propagate = true;\n\n  for (let i = listeners.length - 1; i >= 0; i--) {\n    if (listeners[i]) {\n      propagate = listeners[i](event, Object.keys(__pressed));\n    }\n    if (propagate === false) {\n      break;\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport { Frustum, Vector3 } from \"three\";\nimport { ObjectTypes } from \"../../editorObjects/Editor\";\n\nexport class SelectionFilter {\n  frustum: THREE.Frustum = new Frustum();\n  center: THREE.Vector3 = new Vector3();\n\n  tmpPoint: THREE.Vector3 = new Vector3();\n\n  vecNear: THREE.Vector3 = new Vector3();\n  vecTopLeft: THREE.Vector3 = new Vector3();\n  vecTopRight: THREE.Vector3 = new Vector3();\n  vecDownRight: THREE.Vector3 = new Vector3();\n  vecDownLeft: THREE.Vector3 = new Vector3();\n  vecFarTopLeft: THREE.Vector3 = new Vector3();\n  vecFarTopRight: THREE.Vector3 = new Vector3();\n  vecFarDownRight: THREE.Vector3 = new Vector3();\n  vecFarDownLeft: THREE.Vector3 = new Vector3();\n\n  vectemp1: THREE.Vector3 = new Vector3();\n  vectemp2: THREE.Vector3 = new Vector3();\n  vectemp3: THREE.Vector3 = new Vector3();\n  startPoint: THREE.Vector3;\n  endPoint: THREE.Vector3;\n  collection: any[];\n  deep: number = Number.MAX_VALUE;\n  camera?: THREE.OrthographicCamera;\n  scene?: THREE.Scene;\n  selectedIds: string[];\n\n  constructor() {\n    this.startPoint = new Vector3();\n    this.endPoint = new Vector3();\n    this.collection = [];\n    this.selectedIds = [];\n  }\n\n  setCamera(camera: THREE.OrthographicCamera) {\n    this.camera = camera;\n  }\n\n  setScene(scene: THREE.Scene) {\n    this.scene = scene;\n  }\n\n  select(startPoint?: THREE.Vector3, endPoint?: THREE.Vector3) {\n    this.startPoint = startPoint ?? this.startPoint;\n    this.endPoint = endPoint ?? this.endPoint;\n    this.collection = [];\n\n    if (!this.scene) {\n      return this.collection;\n    }\n\n    this.selectedIds = [];\n    this.updateFrustum(this.startPoint, this.endPoint);\n\n    // @TODO: NEED pixel-perfect match\n    this.searchChildInFrustum(this.frustum, this.scene);\n    this.selectedIds = [];\n    // this.scene.children.forEach((child) => {\n    //   child.traverse((object) => {\n    //     if (object instanceof THREE.Mesh && object.name.length > 0) {\n    //       // @TODO: NEED pixel-perfect match\n    //       const bbox = new THREE.Box3().setFromObject(object);\n    //       if (this.frustum.intersectsBox(bbox)) {\n    //         this.collection.push(object);\n    //       }\n    //       if (this.frustum.intersectsObject(object)) {\n    //         this.collection.push(object);\n    //       }\n    //     }\n    //   });\n    // });\n    return this.collection;\n  }\n\n  selectIds(startPoint?: THREE.Vector3, endPoint?: THREE.Vector3) {\n    this.startPoint = startPoint ?? this.startPoint;\n    this.endPoint = endPoint ?? this.endPoint;\n    this.collection = [];\n\n    if (!this.scene) {\n      return this.collection;\n    }\n\n    this.selectedIds = [];\n    this.updateFrustum(this.startPoint, this.endPoint);\n    this.searchChildInFrustum(this.frustum, this.scene);\n    return this.selectedIds\n  }\n\n\n  updateFrustum(_startPoint?: THREE.Vector3, _endPoint?: THREE.Vector3) {\n    if (!this.camera) {\n      return;\n    }\n    const startPoint = _startPoint ?? this.startPoint;\n    const endPoint = _endPoint ?? this.endPoint;\n\n    // Avoid invalid frustum\n    if (startPoint.x === endPoint.x) {\n      endPoint.x += Number.EPSILON;\n    }\n\n    if (startPoint.y === endPoint.y) {\n      endPoint.y += Number.EPSILON;\n    }\n\n    this.camera.updateProjectionMatrix();\n    this.camera.updateMatrixWorld();\n\n    if (this.camera.isOrthographicCamera) {\n      var left = Math.min(startPoint.x, endPoint.x);\n      var top = Math.max(startPoint.y, endPoint.y);\n      var right = Math.max(startPoint.x, endPoint.x);\n      var down = Math.min(startPoint.y, endPoint.y);\n\n      this.vecTopLeft.set(left, top, -1);\n      this.vecTopRight.set(right, top, -1);\n      this.vecDownRight.set(right, down, -1);\n      this.vecDownLeft.set(left, down, -1);\n\n      this.vecFarTopLeft.set(left, top, 1);\n      this.vecFarTopRight.set(right, top, 1);\n      this.vecFarDownRight.set(right, down, 1);\n      this.vecFarDownLeft.set(left, down, 1);\n\n      this.vecTopLeft.unproject(this.camera);\n      this.vecTopRight.unproject(this.camera);\n      this.vecDownRight.unproject(this.camera);\n      this.vecDownLeft.unproject(this.camera);\n\n      this.vecFarTopLeft.unproject(this.camera);\n      this.vecFarTopRight.unproject(this.camera);\n      this.vecFarDownRight.unproject(this.camera);\n      this.vecFarDownLeft.unproject(this.camera);\n\n      var planes = this.frustum.planes;\n\n      planes[0].setFromCoplanarPoints(\n        this.vecTopLeft,\n        this.vecFarTopLeft,\n        this.vecFarTopRight\n      );\n      planes[1].setFromCoplanarPoints(\n        this.vecTopRight,\n        this.vecFarTopRight,\n        this.vecFarDownRight\n      );\n      planes[2].setFromCoplanarPoints(\n        this.vecFarDownRight,\n        this.vecFarDownLeft,\n        this.vecDownLeft\n      );\n      planes[3].setFromCoplanarPoints(\n        this.vecFarDownLeft,\n        this.vecFarTopLeft,\n        this.vecTopLeft\n      );\n      planes[4].setFromCoplanarPoints(\n        this.vecTopRight,\n        this.vecDownRight,\n        this.vecDownLeft\n      );\n      planes[5].setFromCoplanarPoints(\n        this.vecFarDownRight,\n        this.vecFarTopRight,\n        this.vecFarTopLeft\n      );\n      planes[5].normal.multiplyScalar(-1);\n    } else {\n      console.error(\"THREE.SelectionBox: Unsupported camera type.\");\n    }\n  }\n\n  // @INFO: Not used, there is need for pixel perfect raycasting\n  searchChildInFrustum(frustum: THREE.Frustum, object: any) {\n    if (object.isMesh || object.isLine || object.isPoints) {\n      if (object.material !== undefined) {\n        // if (object.geometry.boundingSphere === null) {\n        //   object.geometry.computeBoundingSphere();\n        // }\n        const data = object.userData;\n        const id = data?.id ?? undefined;\n        if (id !== undefined) {\n          // const isLocked = data?.isLocked ?? false;\n          const objectType = data?.objectType ?? undefined;\n          const isAppObject =\n            objectType === ObjectTypes.Bead ||\n            objectType === ObjectTypes.Region ||\n            objectType === ObjectTypes.Group ||\n            objectType === ObjectTypes.PreviewProject3D;\n\n          if (isAppObject === true) {\n            const bbox = new THREE.Box3().setFromObject(object);\n            if (frustum.intersectsBox(bbox)) {\n              if (this.selectedIds.includes(id) === false) {\n                this.collection.push(object);\n                this.selectedIds.push(id);\n              }\n            }\n          }\n        }\n\n        // this.center.copy(\n        //   object.geometry.boundingSphere.center\n        // );\n        // this.center.applyMatrix4(object.matrixWorld);\n        // if (frustum.containsPoint(this.center)) {\n        //   this.collection.push(object);\n        // }\n      }\n    }\n\n    if (object.children && object.children.length > 0) {\n      for (var x = 0; x < object.children.length; x++) {\n        this.searchChildInFrustum(frustum, object.children[x]);\n      }\n    }\n  }\n}\n","import { EditorMode } from \"../../editorObjects/Editor\";\nimport { appThree } from \"../renderThreejs\";\nimport { MouseEventsEditorModeAddBead } from \"./mouseEventEditorMode/MouseEventsEditorModeAddBead\";\nimport { MouseEventsEditorModeAddRegion } from \"./mouseEventEditorMode/MouseEventsEditorModeAddRegion\";\nimport { MouseEventsEditorModeDelete } from \"./mouseEventEditorMode/MouseEventsEditorModeDelete\";\nimport { MouseEventsEditorModeSelectOrMove } from \"./mouseEventEditorMode/MouseEventsEditorModeSelectOrMove\";\nimport { MouseEventsEditorModeIdle } from \"./mouseEventEditorMode/MouseEventsEditorModeIdle\";\nimport { MouseEventsEditorModePaint } from \"./mouseEventEditorMode/MouseEventsEditorModePaint\";\nimport { MouseEventsEditorModeSelectMultiple } from \"./mouseEventEditorMode/MouseEventsEditorModeSelectMultiple\";\nimport { getStore } from \"../../controllers/store\";\nimport {\n  AppEventType,\n  ChangeUiSettingsZoom,\n} from \"../../controllers/AppEventType\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport { setMousePositionAtWindow } from \"./mouseScreenPosition\";\n\nlet moudeEditorModeIdle,\n  moudeEditorModeSelectOrMove,\n  moudeEditorModePaint,\n  moudeEditorModeDelete,\n  moudeEditorModeAddRegion,\n  moudeEditorModeAddBead,\n  moudeEditorModeSelectMultiple;\n\nexport const initMouseListeners = () => {\n  window.addEventListener(\"resize\", onWindowResize, false);\n\n  appThree.el.addEventListener(\"pointerdown\", onPointerDown, false);\n  appThree.el.addEventListener(\"pointermove\", onPointerMove, false);\n  appThree.el.addEventListener(\"pointerup\", onPointerUp, false);\n  appThree.el.addEventListener(\"mouseout\", onPointerOut, false);\n  appThree.el.addEventListener(\"wheel\", onWheel, false);\n\n  moudeEditorModeIdle = new MouseEventsEditorModeIdle();\n  moudeEditorModeSelectOrMove = new MouseEventsEditorModeSelectOrMove();\n  moudeEditorModePaint = new MouseEventsEditorModePaint();\n  moudeEditorModeDelete = new MouseEventsEditorModeDelete();\n  moudeEditorModeAddRegion = new MouseEventsEditorModeAddRegion();\n  moudeEditorModeAddBead = new MouseEventsEditorModeAddBead();\n  moudeEditorModeSelectMultiple = new MouseEventsEditorModeSelectMultiple();\n};\n\nfunction onWheel(event) {\n  event.preventDefault();\n  if (appThree.el === null) {\n    return;\n  }\n\n  const store = getStore();\n  // const { width, height, top, left } = appThree.el.getBoundingClientRect();\n\n  // const screenX = event.clientX - left;\n  // const screenY = event.clientY - top;\n\n  // const cameraX = appThree.camera.position.x;\n  // const cameraY = appThree.camera.position.y;\n\n  // const mouseXInWorldBefore = (screenX - width / 2) * store.ui.zoomScale;\n  // const mouseYInWorldBefore = -1 * (screenY - height / 2) * store.ui.zoomScale;\n\n  // const zoomChange = store.ui.zoomScale >= 0.35 ? 0.02 * 5 : 0.01;\n  // const zoomMax = 100;\n  // const zoomMin = 0.0125;\n  // let sceneScale = 1;\n  // sceneScale = store.ui.zoomScale + Math.sign(event.deltaY) * zoomChange;\n  // sceneScale = Math.min(Math.max(zoomMin, sceneScale), zoomMax);\n\n  // const mouseXInWorldAfter = (screenX - width / 2) * sceneScale;\n  // const mouseYInWorldAfter = -1 * (screenY - height / 2) * sceneScale;\n\n  // appThree.camera.left = (width * sceneScale) / -2;\n  // appThree.camera.right = (width * sceneScale) / 2;\n  // appThree.camera.top = (height * sceneScale) / 2;\n  // appThree.camera.bottom = (height * sceneScale) / -2;\n  // appThree.camera.updateProjectionMatrix();\n\n  // const diffX = mouseXInWorldBefore - mouseXInWorldAfter;\n  // const diffY = mouseYInWorldBefore - mouseYInWorldAfter;\n\n  // appThree.camera.position.x = cameraX + diffX;\n  // appThree.camera.position.y = cameraY + diffY;\n  // appThree.camera.lookAt(\n  //   appThree.camera.position.x,\n  //   appThree.camera.position.y,\n  //   0\n  // );\n\n  // const rect10x10FromScreenToWorld = getRect10x10FromScreenToWorld();\n  // appThree.camera.userData = { sceneScale, rect10x10FromScreenToWorld };\n\n  const updateUiEvent: ChangeUiSettingsZoom = {\n    name: AppEventType.ChangeUiSettingsZoom,\n    payload: {\n      zoomType: \"zoomByScroll\",\n      useAnimation: false,\n      clientX: event.clientX,\n      clientY: event.clientY,\n      scrollDelta: event.deltaY,\n    },\n  };\n  sendEvent(updateUiEvent);\n\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onWheel(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onWheel(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onWheel(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onWheel(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onWheel(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onWheel(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onWheel(event);\n  }\n}\n\nfunction onWindowResize(event) {\n  if (appThree.el !== null) {\n    const { width, height } = appThree.el.getBoundingClientRect();\n    appThree.camera.left = width / -2;\n    appThree.camera.right = width / 2;\n    appThree.camera.top = height / 2;\n    appThree.camera.bottom = height / -2;\n    appThree.camera.updateProjectionMatrix();\n    appThree.renderer.setSize(width, height);\n  }\n\n  const store = getStore();\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onResize(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onResize(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onResize(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onResize(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onResize(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onResize(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onResize(event);\n  }\n}\n\nfunction onPointerDown(event: PointerEvent) {\n  const store = getStore();\n\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onDown(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onDown(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onDown(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onDown(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onDown(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onDown(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onDown(event);\n  }\n}\n\nfunction onPointerUp(event: MouseEvent) {\n  const store = getStore();\n  if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onUp(event);\n  } else if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onUp(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onUp(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onUp(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onUp(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onUp(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onUp(event);\n  }\n}\n\nfunction onPointerOut(event: MouseEvent) {\n  setMousePositionAtWindow(undefined, undefined);\n  onPointerUp(event);\n}\n\nfunction onPointerMove(event: MouseEvent) {\n  setMousePositionAtWindow(event.clientX, event.clientY);\n\n  const store = getStore();\n\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onMove(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onMove(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onMove(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onMove(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onMove(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onMove(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onMove(event);\n  }\n}\n","import { appThree } from \"../../renderThreejs\";\nimport * as THREE from \"three\";\nimport { getStore } from \"../../../controllers/store\";\n\nexport class MouseEventsIdle {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n\n  constructor() {\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n\n    if (this.boundingClientRect === undefined) {\n      return [];\n    }\n\n    this.isCameraGrabed = true;\n\n    this.boundingClientRect = appThree.el.getBoundingClientRect();\n    const { top, left } = this.boundingClientRect;\n\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n\n    this.startDragMousePosition.x = screenX;\n    this.startDragMousePosition.y = screenY;\n\n    this.startDragCamera.x = appThree.camera.position.x;\n    this.startDragCamera.y = appThree.camera.position.y;\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n\n    if (this.isCameraGrabed === true) {\n      const store = getStore();\n\n      const { top, left } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n      const sceneScale = store.ui.zoomScale;\n\n      const screenMouseDiffX = this.startDragMousePosition.x - screenX;\n      const screenMouseDiffY = this.startDragMousePosition.y - screenY;\n\n      const mouseDiffXInWorldSpace = screenMouseDiffX * sceneScale;\n      const mouseDiffYInWorldSpace = screenMouseDiffY * sceneScale;\n\n      const cameraX = this.startDragCamera.x + mouseDiffXInWorldSpace;\n      const cameraY = this.startDragCamera.y - mouseDiffYInWorldSpace;\n\n      appThree.camera.position.x = cameraX;\n      appThree.camera.position.y = cameraY;\n      appThree.camera.lookAt(cameraX, cameraY, 0);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    this.boundingClientRect = undefined;\n    if (this.isCameraGrabed === true) {\n      this.isCameraGrabed = false;\n    }\n  }\n}\n","import { produce } from \"immer\";\nimport {\n  AppEventType,\n  ChangeObjectsProperty,\n  ChangeSelectObjects,\n} from \"../../../controllers/AppEventType\";\nimport { refreshReactState } from \"../../../controllers/refreshReactState\";\nimport { getStore, setStore } from \"../../../controllers/store\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport {\n  AppObject,\n  Bead,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n  Region,\n} from \"../../../editorObjects/Editor\";\nimport { getStateObjectFromObjectId } from \"../../../editorObjects/editorGetters\";\nimport { getTopBarPosition } from \"../../eventEmitterHandlers\";\nimport { getKeysPressed, isPressedKey } from \"../../keyboard/keyMap\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"../MouseSelectionHelper\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport { SelectionFilter } from \"../SelectionFilter\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\nimport { MouseEventsIdle } from \"./MouseEventsIdle\";\n\nexport class MouseEventsEditorModeSelectOrMove extends MouseEventsBase {\n  actionType:\n    | \"moveCamera\"\n    | \"moveAllSelectedObjects\"\n    | \"moveEditBBox\"\n    | \"moveObjectGroup\"\n    | \"moveSingleObject\"\n    | \"selectMultipleObjects\"\n    | \"deselectMultipleObjects\"\n    | undefined;\n  // isCameraGrabed: boolean;\n  // startDragMousePosition: THREE.Vector2;\n  // startDragCamera: THREE.Vector2;\n  // boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  // mouse: THREE.Vector2;\n  // raycaster: THREE.Raycaster;\n  selectionBox: SelectionFilter;\n  mouseSelectionHelper: MouseSelectionHelper;\n  prevEditBBox: any | undefined;\n  mouseEventsIdle: MouseEventsIdle;\n\n  constructor() {\n    super();\n    // this.boundingClientRect = undefined;\n    // this.isCameraGrabed = false;\n    // this.startDragMousePosition = new THREE.Vector2();\n    // this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    // this.mouse = new THREE.Vector2();\n    // this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n\n    this.selectionBox = new SelectionFilter();\n    this.selectionBox.setCamera(appThree.camera);\n    this.selectionBox.setScene(appThree.scene);\n\n    this.mouseEventsIdle = new MouseEventsIdle();\n    this.actionType = undefined;\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    console.log(\n      \"MouseEventsEditorModeSelectOrMove: jak z kliknieciem???\",\n      getKeysPressed(),\n      isPressedKey(\"space\")\n    );\n\n    if (isPressedKey(\"space\")) {\n      this.actionType = \"moveCamera\";\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      this.mouseEventsIdle.onDown(event);\n      console.log(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    // event.altKey;\n    // event.shiftKey;\n    // event.ctrlKey;\n\n    // if (isPressedKey(\"altleft\") || isPressedKey(\"altright\")) {\n    if (event.altKey) {\n      // if (firstSelectedLocked === true) {\n      //   return;\n      // }\n      this.actionType = \"deselectMultipleObjects\";\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      if (appThree.el !== null) {\n        this.boundingClientRect = appThree.el.getBoundingClientRect();\n      }\n      if (this.boundingClientRect === undefined) {\n        return;\n      }\n      const { top, left, width, height } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n\n      this.mouseSelectionHelper.onDown(screenX, screenY);\n\n      this.selectionBox.startPoint.set(\n        ((event.clientX - left) / width) * 2 - 1,\n        -((event.clientY - top) / height) * 2 + 1,\n        0\n      );\n      console.log(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    if (event.shiftKey) {\n      // if (firstSelectedLocked === true) {\n      //   return;\n      // }\n      // if (isPressedKey(\"shiftleft\") || isPressedKey(\"shiftright\")) {\n      this.actionType = \"selectMultipleObjects\";\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      if (appThree.el !== null) {\n        this.boundingClientRect = appThree.el.getBoundingClientRect();\n      }\n      if (this.boundingClientRect === undefined) {\n        return;\n      }\n      const { top, left, width, height } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n\n      this.mouseSelectionHelper.onDown(screenX, screenY);\n\n      this.selectionBox.startPoint.set(\n        ((event.clientX - left) / width) * 2 - 1,\n        -((event.clientY - top) / height) * 2 + 1,\n        0\n      );\n      console.log(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    this.actionType = undefined;\n    this.intersects = this.getActiveObjectsFromIntersect(\n      event.clientX,\n      event.clientY\n    );\n    const firstClickedActiveObject = this.intersects.length > 0;\n\n    if (firstClickedActiveObject) {\n      // object,camera,renderer.domElement.width,renderer.domElement.height,true\n      // const value = getTopBarPositionInScreen(this.intersects[0].object);\n      // const el = document.querySelector(\n      //   \".actions-wrapper\"\n      // ) as HTMLDivElement | null;\n      // if (el !== null) {\n      //   el.style.position = \"fixed\";\n      //   el.style.top = `${value.y}px`;\n      //   el.style.left = `${value.x}px`;\n      //   el.style.transform = \"none\";\n      // }\n      // console.log(\"???\", value);\n\n      // const { getState } = appStore;\n      // const state = getState();\n      const store = getStore();\n      const id = this.intersects[0].object.userData.id ?? undefined;\n      // const clicked = store.objects[id]\n      const clicked = this.intersects[0].object.userData as AppObject;\n      const clickedId = clicked.id;\n      // store\n      const clickedItemInSelectedObjects = store.selectedIds.includes(\n        clickedId\n      );\n\n      let selectedIsLocked: any = false;\n      store.selectedIds.forEach((id) => {\n        if (store.objects[id].isLocked === true) {\n          selectedIsLocked = true;\n        }\n      });\n\n      if (clicked.isLocked === true) {\n        sendEvent(this.getSelectionForSingleObjectIdAction(clickedId));\n        // if (store.selectedIds.length === 0) {\n        //   // sendEvent(\n        //   //   this.getSelectionAppendAction([clickedId], undefined, false)\n        //   // );\n        //   sendEvent(this.getSelectionForSingleObjectIdAction(clickedId))\n        // } else {\n        //   sendEvent(this.getSelectionForSingleObjectIdAction(clickedId));\n        //   // do nothing\n        // }\n      } else if (selectedIsLocked === true) {\n        sendEvent(this.getSelectionForSingleObjectIdAction(clickedId));\n        // nothing\n      } else if (clickedItemInSelectedObjects) {\n        this.actionType = \"moveAllSelectedObjects\";\n        const { x, y } = screenToWorld(event.clientX, event.clientY);\n        // console.log(\"-------------- \", event.clientX, event.clientY, x, y);\n        this.mouseDragHelper.onDown(x, y);\n      } else {\n        const isEditBBox =\n          clicked.objectType !== undefined &&\n          clicked.objectType === ObjectTypes.SceneEditBBox;\n\n        if (isEditBBox) {\n          this.actionType = \"moveEditBBox\";\n          const { x, y } = screenToWorld(event.clientX, event.clientY);\n          this.mouseDragHelper.onDown(x, y);\n        } else {\n          const isGroup =\n            clicked.objectType !== undefined &&\n            clicked.objectType === ObjectTypes.Group;\n\n          const isGroupChild =\n            clicked[groupIdKey] !== undefined && clicked[groupIdKey].length > 0;\n\n          const isClickedOnGroup = isGroup || isGroupChild;\n\n          if (isClickedOnGroup) {\n            this.actionType = \"moveObjectGroup\";\n          } else {\n            this.actionType = \"moveSingleObject\";\n          }\n          const { x, y } = screenToWorld(event.clientX, event.clientY);\n          this.mouseDragHelper.onDown(x, y);\n        }\n      }\n    } else {\n      this.actionType = \"moveCamera\";\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      this.mouseEventsIdle.onDown(event);\n    }\n\n    console.log(\n      \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n      this.actionType\n    );\n\n    // if (this.intersects.length > 0) {\n    //   this.actionType = \"objectMove\";\n    //   const { x, y } = screenToWorld(event.clientX, event.clientY);\n    //   this.mouseDragHelper.onDown(x, y);\n    //   // action_unselectAll\n    //   // this.createEditBBox();\n    // } else {\n    //   this.actionType = \"cameraMove\";\n    //   this.mouseEventsIdle.onDown(event);\n    // }\n\n    // if (\n    //   state.ui.selectedBeadsIdsCount === 0 &&\n    //   state.ui.selectedRegionsIdsCount === 0\n    // ) {\n    //   const { width, height, top, left } = this.boundingClientRect;\n    //   const screenX = event.clientX - left;\n    //   const screenY = event.clientY - top;\n    //   this.mouseSelectionHelper.onDown(screenX, screenY);\n    //   this.selectionBox.startPoint.set(\n    //     ((event.clientX - left) / width) * 2 - 1,\n    //     -((event.clientY - top) / height) * 2 + 1,\n    //     0\n    //   );\n    // } else {\n    //   const { width, height, top, left } = this.boundingClientRect;\n    //   this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n    //   this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n    //   this.raycaster.setFromCamera(this.mouse, appThree.camera);\n\n    //   const intersects = this.raycaster.intersectObjects(\n    //     appThree.scene.children,\n    //     true\n    //   );\n\n    //   if (intersects.length > 0) {\n    //   }\n    //   const beadsIds: string[] = [];\n    //   const regionIds: string[] = [];\n    //   const editBBoxIds: string[] = [];\n    //   intersects.forEach((e) => {\n    //     const name = e.object.name;\n    //     const beadId = getBeadIdFromThreeName(name);\n    //     if (beadId !== undefined) {\n    //       if (state.appData.beads[beadId]) {\n    //         if (beadsIds.includes(beadId) === false) {\n    //           beadsIds.push(beadId);\n    //           return;\n    //         }\n    //       } else {\n    //         console.warn(\"bead id missing in store\", beadId);\n    //       }\n    //     }\n\n    //     const regionId = getRegionIdFromThreeName(name);\n    //     if (regionId !== undefined) {\n    //       if (state.appData.regions[regionId]) {\n    //         if (regionIds.includes(regionId) === false) {\n    //           regionIds.push(regionId);\n    //           return;\n    //         }\n    //       } else {\n    //         console.warn(\"region id missing in store\", regionId);\n    //       }\n    //     }\n\n    //     const editBBoxId = getEditBBoxIdFromThreeName(name);\n    //     if (editBBoxId !== undefined) {\n    //       if (state.ui.editBBox && state.ui.editBBox.id === editBBoxId) {\n    //         if (editBBoxIds.includes(editBBoxId) === false) {\n    //           editBBoxIds.push(editBBoxId);\n    //           return;\n    //         }\n    //       } else {\n    //         console.warn(\"editbbox id missing in store\", editBBoxId);\n    //       }\n    //     }\n    //   });\n\n    //   if (editBBoxIds.length > 0) {\n    //     this.mouseDragHelper.shouldBehaveLikeMove = true;\n    //     this.createEditBBox();\n    //   } else {\n    //     const diffBeads = difference(\n    //       beadsIds,\n    //       Object.keys(state.ui.selectedBeadsIds)\n    //     );\n\n    //     const diffRegions = difference(\n    //       regionIds,\n    //       Object.keys(state.ui.selectedRegionsIds)\n    //     );\n\n    //     if (\n    //       (beadsIds.length > 0 && diffBeads.length === 0) ||\n    //       (regionIds.length > 0 && diffRegions.length === 0)\n    //     ) {\n    //       this.mouseDragHelper.shouldBehaveLikeMove = true;\n    //       this.createEditBBox();\n    //     } else {\n    //       const { width, height, top, left } = this.boundingClientRect;\n    //       const screenX = event.clientX - left;\n    //       const screenY = event.clientY - top;\n    //       this.mouseSelectionHelper.onDown(screenX, screenY);\n    //       this.selectionBox.startPoint.set(\n    //         ((event.clientX - left) / width) * 2 - 1,\n    //         -((event.clientY - top) / height) * 2 + 1,\n    //         0\n    //       );\n    //     }\n    //   }\n    // }\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.actionType === undefined) {\n      return;\n    }\n\n    // console.log(\"jak z kliknieciem???\", getKeysPressed(), isPressedKey(\"space\"));\n\n    if (this.actionType === \"moveCamera\") {\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onMove(x, y);\n      this.mouseEventsIdle.onMove(event);\n      this.updateUIAtMove(false);\n    }\n\n    if (this.actionType === \"moveAllSelectedObjects\") {\n      this.moveAllSelectedObjects(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === \"moveSingleObject\") {\n      this.moveSingleObject(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === \"moveObjectGroup\") {\n      this.moveObjectGroup(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === \"moveEditBBox\") {\n      this.moveEditBBox(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === \"selectMultipleObjects\") {\n      this.selectMultipleObjects(event.clientX, event.clientY, true);\n    }\n\n    if (this.actionType === \"deselectMultipleObjects\") {\n      this.selectMultipleObjects(event.clientX, event.clientY, false);\n    }\n\n    // if (this.actionType === \"objectMove\") {\n    //   const { x, y } = screenToWorld(event.clientX, event.clientY);\n    //   this.mouseDragHelper.onMove(x, y);\n    //   this.moveSelectedObjectsByDiff();\n    //   // this.refreshEditBBox();\n    // }\n    // if (this.boundingClientRect === undefined) {\n    //   return;\n    // }\n    // const { getState, dispatch } = appStore;\n    // const state = getState();\n\n    // const { width, height, top, left } = this.boundingClientRect;\n\n    // if (this.mouseDragHelper.shouldBehaveLikeMove === true) {\n    //   const { x, y } = screenToWorld(event.clientX, event.clientY);\n    //   this.mouseDragHelper.onMove(x, y);\n    //   const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    //   const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    //   Object.keys(state.ui.selectedBeadsIds).forEach((beadId) => {\n    //     const name = getThreeNameFromBeadId(beadId);\n    //     const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //     if (object !== undefined) {\n    //       object.position.x = state.appData.beads[beadId].position.x + diffX;\n    //       object.position.y = state.appData.beads[beadId].position.y + diffY;\n    //     }\n    //   });\n    //   Object.keys(state.ui.selectedRegionsIds).forEach((regionId) => {\n    //     const name = getThreeNameFromRegionId(\n    //       regionId,\n    //       RegionChildSuffix.CONTENT\n    //     );\n    //     const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //     if (object !== undefined) {\n    //       object.position.x =\n    //         state.appData.regions[regionId].position.x + diffX;\n    //       object.position.y =\n    //         state.appData.regions[regionId].position.y + diffY;\n    //     }\n    //   });\n\n    //   if (this.prevEditBBox) {\n    //     this.refreshEditBBox(diffX, diffY);\n    //   }\n    // } else {\n    //   if (this.mouseDragHelper.isDragStarted === true) {\n    //     const { x, y } = screenToWorld(event.clientX, event.clientY);\n\n    //     this.mouseDragHelper.onMove(x, y);\n\n    //     if (this.mouseDragHelper.isDragStarted === true) {\n    //       this.selectionBox.endPoint.set(\n    //         ((event.clientX - left) / width) * 2 - 1,\n    //         -((event.clientY - top) / height) * 2 + 1,\n    //         1\n    //       );\n\n    //       const allSelected = this.selectionBox.select();\n    //       const beadsIds: string[] = [];\n    //       const regionIds: string[] = [];\n    //       allSelected.forEach((object) => {\n    //         const beadId = getBeadIdFromThreeName(object.name);\n    //         if (beadId !== undefined) {\n    //           if (state.appData.beads[beadId]) {\n    //             if (beadsIds.includes(beadId) === false) {\n    //               beadsIds.push(beadId);\n    //             }\n    //           } else {\n    //             console.warn(\"bead id missing in store\", beadId);\n    //           }\n    //         }\n\n    //         const regionId = getRegionIdFromThreeName(object.name);\n    //         if (regionId !== undefined) {\n    //           if (state.appData.regions[regionId]) {\n    //             if (regionIds.includes(regionId) === false) {\n    //               regionIds.push(regionId);\n    //             }\n    //           } else {\n    //             console.warn(\"region id missing in store\", regionId);\n    //           }\n    //         }\n    //       });\n\n    //       dispatch(\n    //         Actions.MouseSelection.action_selectIntersectObjects(\n    //           beadsIds,\n    //           regionIds\n    //         )\n    //       );\n    //     }\n    //   }\n\n    //   const screenX = event.clientX - left;\n    //   const screenY = event.clientY - top;\n\n    //   this.mouseSelectionHelper.onMove(screenX, screenY);\n    // }\n  }\n\n  onUp(event: PointerEvent) {\n    // stopListeningKeys();\n    if (this.actionType === undefined) {\n      return;\n    }\n\n    // const { dispatch } = appStore;\n\n    if (this.actionType === \"moveCamera\") {\n      this.mouseEventsIdle.onUp(event);\n      if (this.mouseDragHelper.isDragged === false) {\n        const store = getStore();\n        const action: ChangeSelectObjects = {\n          name: AppEventType.ChangeSelectObjects,\n          payload: {\n            change: store.selectedIds.map((id) => {\n              return {\n                id,\n                isSelected: false,\n              };\n            }),\n          },\n        };\n        sendEvent(action);\n        // dispatch(Actions.MouseSelection.action_unselectAll());\n      } else {\n        this.updateUIAtMove(true);\n        const store = getStore();\n        const newStore = produce(store, (draft) => {\n          const position = getTopBarPosition(\n            store.selectedIds.map((id) => {\n              return { id, objectType: store.objects[id].objectType };\n            })\n          );\n          draft.ui.selectedTopBarPosition = position;\n        });\n        setStore(newStore);\n        refreshReactState(newStore);\n      }\n      this.mouseDragHelper.onUp();\n    }\n\n    if (this.actionType === \"moveObjectGroup\") {\n      this.updateUIAtMove(true);\n      if (this.mouseDragHelper.isDragged === true) {\n        console.log(\n          \"MouseEventsEditorModeSelectOrMove: aktualizuje pozycje groupy i wiele\"\n        );\n        const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n        const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          const ids = this.getIdsFromGroupOrInGroup(objectId);\n          // console.log(\"??\", ids, objectId);\n          sendEvent(\n            this.getMoveObjectsAction([objectId, ...ids], diffX, diffY)\n          );\n          // const store = getStore();\n          // const action: ChangeObjectsProperty = {\n          //   name: AppEventType.ChangeObjectsProperty,\n          //   payload: {\n          //     change: [\n          //       {\n          //         id: objectId,\n          //         property: {\n          //           position: {\n          //             x: store.objects[objectId].position.x + diffX,\n          //             y: store.objects[objectId].position.y + diffY,\n          //           },\n          //         },\n          //       },\n          //     ],\n          //   },\n          // };\n          // sendEvent(action);\n\n          // dispatch(\n          //   Actions.MouseSelection.action_moveClickedObject(\n          //     diffX,\n          //     diffY,\n          //     objectId\n          //   )\n          // );\n        }\n        this.mouseDragHelper.onUp();\n      } else {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          if (\n            isPressedKey(\"controlleft\") ||\n            isPressedKey(\"controlright\") ||\n            isPressedKey(\"shiftleft\") ||\n            isPressedKey(\"shiftright\")\n          ) {\n            const store = getStore();\n            const clickedObjectIsLocked =\n              store.objects[objectId] !== undefined\n                ? store.objects[objectId].isLocked === true\n                : false;\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n              // nothing\n            } else if (clickedObjectIsLocked === false) {\n              sendEvent(\n                this.getSelectionAppendAction([objectId], undefined, false)\n              );\n            }\n            // dispatch(\n            //   Actions.MouseSelection.action_appendSelectIntersectObject([\n            //     objectId,\n            //   ])\n            // );\n          } else {\n            const store = getStore();\n            if (store.selectedIds.length === 0) {\n              sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n            } else {\n              const clickedObjectIsLocked =\n                store.objects[objectId] !== undefined\n                  ? store.objects[objectId].isLocked === true\n                  : false;\n              let selectedIsLocked: any = false;\n              store.selectedIds.forEach((id) => {\n                if (store.objects[id].isLocked === true) {\n                  selectedIsLocked = true;\n                }\n              });\n              if (selectedIsLocked === true) {\n                // nothing\n              } else if (clickedObjectIsLocked === false) {\n                sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n              }\n            }\n            // sendEvent(this.getSelectionAppendAction([objectId], true));\n            // dispatch(\n            //   Actions.MouseSelection.action_selectIntersectObject(objectId)\n            // );\n          }\n        }\n        console.log(\"MouseEventsEditorModeSelectOrMove: zaznaczam group\");\n        this.mouseDragHelper.onUp();\n      }\n    }\n\n    if (this.actionType === \"moveSingleObject\") {\n      this.updateUIAtMove(true);\n      if (this.mouseDragHelper.isDragged === true) {\n        console.log(\n          \"MouseEventsEditorModeSelectOrMove: aktualizuje pozycje single object\"\n        );\n        const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n        const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          sendEvent(this.getMoveObjectsAction([objectId], diffX, diffY));\n          // dispatch(\n          //   Actions.MouseSelection.action_moveClickedObject(\n          //     diffX,\n          //     diffY,\n          //     objectId\n          //   )\n          // );\n        }\n\n        this.mouseDragHelper.onUp();\n      } else {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          if (\n            isPressedKey(\"controlleft\") ||\n            isPressedKey(\"controlright\") ||\n            isPressedKey(\"shiftleft\") ||\n            isPressedKey(\"shiftright\")\n          ) {\n            const store = getStore();\n            const clickedObjectIsLocked =\n              store.objects[objectId] !== undefined\n                ? store.objects[objectId].isLocked === true\n                : false;\n\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n              // nothing\n            } else if (clickedObjectIsLocked === false) {\n              sendEvent(\n                this.getSelectionAppendAction([objectId], undefined, true)\n              );\n            }\n            // dispatch(\n            //   Actions.MouseSelection.action_appendSelectIntersectObject([\n            //     objectId,\n            //   ])\n            // );\n          } else {\n            const store = getStore();\n            if (store.selectedIds.length === 0) {\n              sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n            } else {\n              const clickedObjectIsLocked =\n                store.objects[objectId] !== undefined\n                  ? store.objects[objectId].isLocked === true\n                  : false;\n              let selectedIsLocked: any = false;\n              store.selectedIds.forEach((id) => {\n                if (store.objects[id].isLocked === true) {\n                  selectedIsLocked = true;\n                }\n              });\n              if (selectedIsLocked === true) {\n                // nothing\n              } else if (clickedObjectIsLocked === false) {\n                sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n              }\n            }\n\n            // dispatch(\n            //   Actions.MouseSelection.action_selectIntersectObject(objectId)\n            // );\n          }\n        }\n        console.log(\n          \"MouseEventsEditorModeSelectOrMove: zaznaczam single object\"\n        );\n        this.mouseDragHelper.onUp();\n      }\n    }\n\n    if (this.actionType === \"moveAllSelectedObjects\") {\n      this.updateUIAtMove(true);\n\n      if (this.mouseDragHelper.isDragged === true) {\n        console.log(\n          \"MouseEventsEditorModeSelectOrMove: aktualizuje pozycje wszystkich zaznaczonych\"\n        );\n        const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n        const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n        const store = getStore();\n        sendEvent(this.getMoveObjectsAction(store.selectedIds, diffX, diffY));\n        if (appThree.additionalData.selectedBBox !== undefined) {\n          appThree.additionalData.selectedBBox.topLeft.x += diffX;\n          appThree.additionalData.selectedBBox.topLeft.y += diffY;\n          appThree.additionalData.selectedBBox.topRight.x += diffX;\n          appThree.additionalData.selectedBBox.topRight.y += diffY;\n          appThree.additionalData.selectedBBox.bottomLeft.x += diffX;\n          appThree.additionalData.selectedBBox.bottomLeft.y += diffY;\n          appThree.additionalData.selectedBBox.bottomRight.x += diffX;\n          appThree.additionalData.selectedBBox.bottomRight.y += diffY;\n        }\n        // dispatch(\n        //   Actions.MouseSelection.action_moveAllSelectedObjects(diffX, diffY)\n        // );\n        this.mouseDragHelper.onUp();\n      } else {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (\n          isPressedKey(\"controlleft\") ||\n          isPressedKey(\"controlright\") ||\n          isPressedKey(\"shiftleft\") ||\n          isPressedKey(\"shiftright\")\n        ) {\n          sendEvent(\n            this.getSelectionAppendAction([objectId], undefined, false)\n          );\n          // dispatch(\n          //   Actions.MouseSelection.action_appendSelectIntersectObject([\n          //     objectId,\n          //   ])\n          // );\n        }\n        this.mouseDragHelper.onUp();\n      }\n\n      // const { getState } = appStore;\n      // const state = getState();\n      // if (state.ui.editBBox !== undefined) {\n      //   const objectId = state.ui.editBBox.id;\n      //   const name = getStateObjectFromObjectId(\n      //     objectId,\n      //     ObjectTypes.SceneEditBBox\n      //   );\n      //   if (name === undefined) {\n      //     return;\n      //   }\n\n      //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      //   if (object === undefined) {\n      //     console.warn(\"object not found in app scene for id\", objectId, name);\n      //     return;\n      //   }\n\n      //   object.visible = true;\n      // }\n    }\n\n    if (this.actionType === \"moveEditBBox\") {\n      if (this.mouseDragHelper.isDragged === true) {\n        console.log(\n          \"MouseEventsEditorModeSelectOrMove: aktualizuje pozycje wszystkich zaznaczonych i edit bbox\"\n        );\n        const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n        const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n        const store = getStore();\n        sendEvent(this.getMoveObjectsAction(store.selectedIds, diffX, diffY));\n        // dispatch(\n        //   Actions.MouseSelection.action_moveAllSelectedObjects(diffX, diffY)\n        // );\n        this.mouseDragHelper.onUp();\n      } else {\n        const store = getStore();\n        const action: ChangeSelectObjects = {\n          name: AppEventType.ChangeSelectObjects,\n          payload: {\n            change: store.selectedIds.map((id) => {\n              return {\n                id,\n                isSelected: false,\n              };\n            }),\n          },\n        };\n        sendEvent(action);\n        // dispatch(Actions.MouseSelection.action_unselectAll());\n        this.mouseDragHelper.onUp();\n      }\n\n      // const { getState } = appStore;\n      // const state = getState();\n      // if (state.ui.editBBox !== undefined) {\n      //   const objectId = state.ui.editBBox.id;\n      //   const name = getStateObjectFromObjectId(\n      //     objectId,\n      //     ObjectTypes.SceneEditBBox\n      //   );\n      //   if (name === undefined) {\n      //     return;\n      //   }\n\n      //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      //   if (object === undefined) {\n      //     console.warn(\"object not found in app scene for id\", objectId, name);\n      //     return;\n      //   }\n\n      //   object.visible = true;\n      // }\n    }\n\n    if (this.actionType === \"selectMultipleObjects\") {\n      if (isPressedKey(\"shiftleft\") || isPressedKey(\"shiftright\")) {\n        if (this.mouseDragHelper.isDragged === false) {\n          this.intersects = this.getActiveObjectsFromIntersect(\n            event.clientX,\n            event.clientY\n          );\n          const firstClickedActiveObject = this.intersects.length > 0;\n          if (firstClickedActiveObject) {\n            const clicked = this.intersects[0].object.userData as AppObject;\n            const clickedId = clicked.id;\n            if (clickedId !== undefined) {\n              const store = getStore();\n              const clickedObjectIsLocked =\n                store.objects[clickedId] !== undefined\n                  ? store.objects[clickedId].isLocked === true\n                  : false;\n              let selectedIsLocked: any = false;\n              store.selectedIds.forEach((id) => {\n                if (store.objects[id].isLocked === true) {\n                  selectedIsLocked = true;\n                }\n              });\n              if (selectedIsLocked === true) {\n                // nothing\n              } else if (clickedObjectIsLocked === false) {\n                sendEvent(\n                  this.getSelectionAppendAction([clickedId], undefined, false)\n                );\n              }\n\n              // dispatch(\n              //   Actions.MouseSelection.action_appendSelectIntersectObject([\n              //     clickedId,\n              //   ])\n              // );\n            }\n          }\n          this.intersects = [];\n        } else {\n          if (this.boundingClientRect !== undefined) {\n            const { top, left, width, height } = this.boundingClientRect;\n            this.selectionBox.endPoint.set(\n              ((event.clientX - left) / width) * 2 - 1,\n              -((event.clientY - top) / height) * 2 + 1,\n              1\n            );\n            const store = getStore();\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n              // nothing\n            } else {\n              // const { dispatch } = appStore;\n              const allSelectedIds = this.selectionBox.selectIds();\n\n              sendEvent(\n                this.getSelectionAppendAction(allSelectedIds, true, false)\n              );\n            }\n            // dispatch(\n            //   Actions.MouseSelection.action_appendSelectIntersectObject(\n            //     allSelectedIds,\n            //     true,\n            //     true\n            //   )\n            // );\n          }\n        }\n      }\n      this.mouseDragHelper.onUp();\n      this.mouseSelectionHelper.onUp();\n    }\n\n    if (this.actionType === \"deselectMultipleObjects\") {\n      if (isPressedKey(\"altleft\") || isPressedKey(\"altright\")) {\n        if (this.mouseDragHelper.isDragged === false) {\n          this.intersects = this.getActiveObjectsFromIntersect(\n            event.clientX,\n            event.clientY\n          );\n          const firstClickedActiveObject = this.intersects.length > 0;\n          if (firstClickedActiveObject) {\n            const clicked = this.intersects[0].object.userData as AppObject;\n            const clickedId = clicked.id;\n            if (clickedId !== undefined) {\n              sendEvent(\n                this.getSelectionAppendAction([clickedId], false, true)\n              );\n\n              // dispatch(\n              //   Actions.MouseSelection.action_appendSelectIntersectObject(\n              //     [clickedId],\n              //     true,\n              //     false\n              //   )\n              // );\n            }\n          }\n\n          this.intersects = [];\n        } else {\n          if (this.boundingClientRect !== undefined) {\n            const { top, left, width, height } = this.boundingClientRect;\n            this.selectionBox.endPoint.set(\n              ((event.clientX - left) / width) * 2 - 1,\n              -((event.clientY - top) / height) * 2 + 1,\n              1\n            );\n            // const { dispatch } = appStore;\n            const allSelectedIds = this.selectionBox.selectIds();\n\n            sendEvent(\n              this.getSelectionAppendAction(allSelectedIds, false, false)\n            );\n            // dispatch(\n            //   Actions.MouseSelection.action_appendSelectIntersectObject(\n            //     allSelectedIds,\n            //     true,\n            //     false\n            //   )\n            // );\n          }\n        }\n      }\n\n      this.mouseDragHelper.onUp();\n      this.mouseSelectionHelper.onUp();\n    }\n\n    // if (this.actionType === \"objectMove\") {\n    //   const objects = this.groupObjectsByTypeFromIntersect(this.intersects, 1);\n    //   const beadIds: string[] = objects.Bead.map((e) => e.object.userData.id);\n    //   const regionIds: string[] = objects.Region.map(\n    //     (e) => e.object.userData.id\n    //   );\n\n    //   if (this.mouseDragHelper.isDragged === true) {\n    //     const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    //     const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    //     dispatch(\n    //       Actions.MouseSelectionaction_movedSelectedOrIntersected(diffX, diffY, beadIds, regionIds)\n    //     );\n    //   } else {\n    //     dispatch(Actions.MouseSelectionaction_selectIntersectObjects(beadIds, regionIds));\n    //   }\n\n    //   this.mouseDragHelper.onUp();\n    // }\n\n    this.actionType = undefined;\n    // const { getState, dispatch } = appStore;\n    // const state = getState();\n    // if (this.mouseDragHelper.shouldBehaveLikeMove === true) {\n    //   const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    //   const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    //   if (this.prevEditBBox) {\n    //     this.refreshEditBBox(diffX, diffY);\n    //   }\n    //   this.mouseDragHelper.shouldBehaveLikeMove = false;\n    //   this.prevEditBBox = undefined;\n    //   dispatch(Actions.MouseSelection.action_movedSelected(diffX, diffY));\n    // } else {\n    //   if (this.mouseDragHelper.isDragged === true) {\n    //     // do nothing\n    //   } else if (\n    //     this.mouseDragHelper.isDragged === false &&\n    //     this.mouseDragHelper.isDragStarted === true\n    //   ) {\n    //     if (this.boundingClientRect === undefined) {\n    //       return;\n    //     }\n\n    //     const { width, height, top, left } = this.boundingClientRect;\n    //     this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n    //     this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n    //     this.raycaster.setFromCamera(this.mouse, appThree.camera);\n    //     const intersects = this.raycaster.intersectObjects(\n    //       appThree.scene.children,\n    //       true\n    //     );\n    //     const beadsIds: string[] = [];\n    //     const regionIds: string[] = [];\n    //     intersects.forEach((e) => {\n    //       const name = e.object.name;\n    //       const beadId = getBeadIdFromThreeName(name);\n    //       if (beadId !== undefined) {\n    //         if (state.appData.beads[beadId]) {\n    //           if (beadsIds.includes(beadId) === false) {\n    //             beadsIds.push(beadId);\n    //           }\n    //         } else {\n    //           console.warn(\"bead id missing in store\", beadId);\n    //         }\n    //       }\n\n    //       const regionId = getRegionIdFromThreeName(name);\n    //       if (regionId !== undefined) {\n    //         if (state.appData.regions[regionId]) {\n    //           if (regionIds.includes(regionId) === false) {\n    //             regionIds.push(regionId);\n    //           }\n    //         } else {\n    //           console.warn(\"region id missing in store\", regionId);\n    //         }\n    //       }\n    //     });\n\n    //     dispatch(\n    //       Actions.MouseSelection.action_selectIntersectObjects(\n    //         beadsIds,\n    //         regionIds\n    //       )\n    //     );\n    //   } else {\n    //     dispatch(Actions.MouseSelection.action_selectIntersectObjects([], []));\n    //   }\n    // }\n    // this.mouseDragHelper.onUp();\n    // this.mouseSelectionHelper.onUp();\n  }\n\n  getMoveObjectsAction(objectIds: string[], diffX: number, diffY: number) {\n    const store = getStore();\n\n    const ids: string[] = [];\n    const change: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n    objectIds.forEach((objectId) => {\n      const childrenIds = this.getIdsFromGroupOrInGroup(objectId);\n      if (store.objects[objectId] !== undefined) {\n        if (ids.includes(objectId) === false) {\n          ids.push(objectId);\n          change.push({\n            id: objectId,\n            properties: {\n              position: {\n                x: store.objects[objectId].position.x + diffX,\n                y: store.objects[objectId].position.y + diffY,\n                z: store.objects[objectId].position.z,\n              },\n            },\n          });\n        }\n      }\n      childrenIds.forEach((id) => {\n        if (store.objects[id] !== undefined) {\n          if (ids.includes(objectId) === false) {\n            ids.push(objectId);\n            change.push({\n              id: id,\n              properties: {\n                position: {\n                  x: store.objects[id].position.x + diffX,\n                  y: store.objects[id].position.y + diffY,\n                  z: store.objects[objectId].position.z,\n                },\n              },\n            });\n          }\n        }\n      });\n    });\n\n    const action: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: change,\n      },\n    };\n\n    return action;\n  }\n\n  getSelectionForSingleObjectIdAction(id: string) {\n    const store = getStore();\n    const change: ChangeSelectObjects[\"payload\"][\"change\"] = [];\n\n    store.selectedIds.forEach((_id) => {\n      const childrenIds = this.getIdsFromGroupOrInGroup(_id);\n      change.push({\n        id: _id,\n        isSelected: false,\n      });\n      childrenIds.forEach((__id) => {\n        change.push({\n          id: __id,\n          isSelected: false,\n        });\n      });\n    });\n\n    change.push({\n      id,\n      isSelected: true,\n    });\n    const childrenIds = this.getIdsFromGroupOrInGroup(id);\n    childrenIds.forEach((_id) => {\n      change.push({\n        id: _id,\n        isSelected: true,\n      });\n    });\n\n    const action: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change,\n      },\n    };\n\n    return action;\n  }\n\n  getSelectionAppendAction(\n    objectIds: string[],\n    _newIsSelected?: boolean,\n    _addWithIsLock?: boolean\n  ) {\n    const store = getStore();\n    const change: ChangeSelectObjects[\"payload\"][\"change\"] = [];\n    const addWithIsLock = _addWithIsLock ?? false;\n\n    // console.log(\"**** getSelectionAppendAction ---- 00 \", _addWithIsLock);\n\n    objectIds.forEach((objectId) => {\n      const isLocked =\n        store.objects[objectId] !== undefined &&\n        store.objects[objectId].isLocked === true;\n\n      // console.log(\n      //   \"**** getSelectionAppendAction ---- \",\n      //   objectId,\n      //   addWithIsLock === true,\n      //   addWithIsLock === false && isLocked === false,\n      //   addWithIsLock === true ||\n      //     (addWithIsLock === false && isLocked === false),\n      //   \"IsLocked: \",\n      //   isLocked\n      // );\n      if (\n        addWithIsLock === true ||\n        (addWithIsLock === false && isLocked === false)\n      ) {\n        const isSelected = store.selectedIds.includes(objectId) === true;\n        const newSelected =\n          _newIsSelected === undefined ? !isSelected : _newIsSelected;\n        const childrenIds = this.getIdsFromGroupOrInGroup(objectId);\n        change.push({\n          id: objectId,\n          isSelected: newSelected,\n        });\n        childrenIds.forEach((id) => {\n          change.push({\n            id: id,\n            isSelected: newSelected,\n          });\n        });\n      }\n    });\n\n    const action: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change,\n      },\n    };\n\n    return action;\n  }\n\n  selectMultipleObjects(\n    clientX: number,\n    clientY: number,\n    shouldBeSelected: boolean\n  ) {\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { top, left, width, height } = this.boundingClientRect;\n    const screenX = clientX - left;\n    const screenY = clientY - top;\n    this.mouseSelectionHelper.onMove(screenX, screenY);\n\n    // this.selectionBox.endPoint.set(\n    //   ((clientX - left) / width) * 2 - 1,\n    //   -((clientY - top) / height) * 2 + 1,\n    //   1\n    // );\n    // const { dispatch } = appStore;\n    // const allSelectedIds = this.selectionBox.selectIds();\n\n    // allSelectedIds.forEach((id) => {\n    //   dispatch(\n    //     Actions.MouseSelection.action_appendSelectIntersectObject(\n    //       id,\n    //       true,\n    //       shouldBeSelected\n    //     )\n    //   );\n    // });\n  }\n\n  moveSingleObject(clientX: number, clientY: number) {\n    // const { getState } = appStore;\n    // const state = getState();\n    const store = getStore();\n\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n    const clicked = this.intersects[0].object.userData;\n    const objectId = clicked.id;\n    if (objectId === undefined) {\n      console.warn(\"objectId not found in clicked item\", clicked);\n      return;\n    }\n    const obj = store.objects[objectId];\n    if (obj === undefined) {\n      console.warn(\"objectId not found in app store\", objectId, clicked);\n      return;\n    }\n    const name = getStateObjectFromObjectId(objectId, obj.objectType);\n    if (name === undefined) {\n      return;\n    }\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object === undefined) {\n      console.warn(\"object not found in app state for id\", objectId, clicked);\n      return;\n    }\n\n    if (store.objects[objectId].objectType === ObjectTypes.Region) {\n      const region = store.objects[objectId] as Region;\n      if (region.snapBeadsToCell === true) {\n        if (region.childrenGridIds.length > 0) {\n          region.childrenGridIds.forEach((id) => {\n            if (id !== undefined && store.objects[id] !== undefined) {\n              const bead = store.objects[id];\n              if (bead === undefined) {\n                console.warn(\"object not exists in app\", objectId);\n                return;\n              }\n              const name = getStateObjectFromObjectId(bead.id, bead.objectType);\n              if (name === undefined) {\n                return;\n              }\n              const child_object = appThree.scene.getObjectByUserDataProperty(\n                \"name\",\n                name\n              );\n              if (child_object === undefined) {\n                console.warn(\n                  \"object not found in app scene for id\",\n                  objectId,\n                  name\n                );\n                return;\n              }\n              child_object.position.x = store.objects[id].position.x + diffX;\n              child_object.position.y = store.objects[id].position.y + diffY;\n            }\n          });\n        }\n      }\n    }\n\n    // console.log(\"przesuwam...\", diffX, diffY);\n    object.position.x = store.objects[objectId].position.x + diffX;\n    object.position.y = store.objects[objectId].position.y + diffY;\n\n    this.updateUIAtMove(false);\n  }\n\n  moveObjectGroup(clientX: number, clientY: number) {\n    // const { dispatch, getState } = appStore;\n    // const state = getState();\n    const store = getStore();\n\n    const { x, y } = screenToWorld(clientX, clientY);\n\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n    const clicked = this.intersects[0].object.userData;\n    let objectId = clicked.id;\n    if (objectId === undefined) {\n      console.warn(\"objectId not found in clicked item\", clicked);\n      return;\n    }\n    let group = store.objects[objectId];\n    if (group === undefined) {\n      console.warn(\"objectId not found in app store\", objectId);\n      return;\n    }\n\n    // const isGroup =\n    //   group.objectType !== undefined && group.objectType === ObjectTypes.Group;\n\n    const isGroupChild =\n      group[groupIdKey] !== undefined && group[groupIdKey].length > 0;\n\n    if (isGroupChild) {\n      objectId = group[groupIdKey];\n      group = store.objects[objectId];\n    }\n\n    const name = getStateObjectFromObjectId(objectId, group.objectType);\n    if (name === undefined) {\n      return;\n    }\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object === undefined) {\n      console.warn(\"object not found in app state for id\", objectId);\n      return;\n    }\n    object.position.x = store.objects[objectId].position.x + diffX;\n    object.position.y = store.objects[objectId].position.y + diffY;\n\n    (group as Group).childrenIds.forEach((id) => {\n      const children: AppObject | undefined = store.objects[id];\n      if (children === undefined) {\n        console.warn(\"object not exists in app\", id);\n        return;\n      }\n      const name = getStateObjectFromObjectId(children.id, children.objectType);\n      if (name === undefined) {\n        return;\n      }\n      const child = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (child === undefined) {\n        console.warn(\"object not found in app scene for id\", id, name);\n        return;\n      }\n      child.position.x = store.objects[id].position.x + diffX;\n      child.position.y = store.objects[id].position.y + diffY;\n    });\n\n    this.updateUIAtMove(false);\n  }\n\n  moveEditBBox(clientX: number, clientY: number) {\n    this.moveAllSelectedObjects(clientX, clientY);\n    // const { dispatch, getState } = appStore;\n    // const state = getState();\n\n    const store = getStore();\n    // if (state.ui.editBBox !== undefined) {\n    //   const objectId = state.ui.editBBox.id;\n    //   const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    //   const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    //   const name = getStateObjectFromObjectId(\n    //     objectId,\n    //     ObjectTypes.SceneEditBBox\n    //   );\n    //   if (name === undefined) {\n    //     return;\n    //   }\n\n    //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //   if (object === undefined) {\n    //     console.warn(\"object not found in app scene for id\", objectId, name);\n    //     return;\n    //   }\n\n    //   object.position.x = object.userData.position.x + diffX;\n    //   object.position.y = object.userData.position.y + diffY;\n    // }\n  }\n\n  moveAllSelectedObjects(clientX: number, clientY: number) {\n    // const { dispatch, getState } = appStore;\n    // const state = getState();\n\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    // console.log(\"-------------- \", clientX, clientY, x, y, diffX, diffY);\n\n    const store = getStore();\n\n    store.selectedIds.forEach((objectId) => {\n      const obj: AppObject | undefined = store.objects[objectId];\n      if (obj === undefined) {\n        console.warn(\"object not exists in app\", objectId);\n        return;\n      }\n      const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n      if (name === undefined) {\n        return;\n      }\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        console.warn(\"object not found in app scene for id\", objectId, name);\n        return;\n      }\n\n      if (store.objects[objectId].objectType === ObjectTypes.Region) {\n        if (appThree.additionalData.selectedBBox !== undefined) {\n          for (let i = appThree.scene.children.length - 1; i >= 0; i--) {\n            if (appThree.scene.children[i].layers.mask === 4) {\n              const name = appThree.scene.children[i].userData[\"name\"];\n\n              appThree.scene.children[i].position.x =\n                appThree.additionalData.selectedBBox[name].x + diffX;\n\n              appThree.scene.children[i].position.y =\n                appThree.additionalData.selectedBBox[name].y + diffY;\n            }\n          }\n        }\n        const region = store.objects[objectId] as Region;\n        if (region.snapBeadsToCell === true) {\n          if (region.childrenGridIds.length > 0) {\n            region.childrenGridIds.forEach((id) => {\n              if (id !== undefined && store.objects[id] !== undefined) {\n                const bead = store.objects[id];\n                if (bead === undefined) {\n                  console.warn(\"object not exists in app\", objectId);\n                  return;\n                }\n                const name = getStateObjectFromObjectId(\n                  bead.id,\n                  bead.objectType\n                );\n                if (name === undefined) {\n                  return;\n                }\n                const child_object = appThree.scene.getObjectByUserDataProperty(\n                  \"name\",\n                  name\n                );\n                if (child_object === undefined) {\n                  console.warn(\n                    \"object not found in app scene for id\",\n                    objectId,\n                    name\n                  );\n                  return;\n                }\n                child_object.position.x = store.objects[id].position.x + diffX;\n                child_object.position.y = store.objects[id].position.y + diffY;\n              }\n            });\n          }\n        }\n      }\n\n      object.position.x = store.objects[objectId].position.x + diffX;\n      object.position.y = store.objects[objectId].position.y + diffY;\n    });\n\n    this.updateUIAtMove(false);\n    // if (state.ui.editBBox !== undefined) {\n    //   const objectId = state.ui.editBBox.id;\n    //   const name = getStateObjectFromObjectId(\n    //     objectId,\n    //     ObjectTypes.SceneEditBBox\n    //   );\n    //   if (name === undefined) {\n    //     return;\n    //   }\n\n    //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //   if (object === undefined) {\n    //     console.warn(\"object not found in app scene for id\", objectId, name);\n    //     return;\n    //   }\n\n    //   object.visible = false;\n    // }\n  }\n\n  updateUIAtMove(visible: boolean) {\n    if (visible === false) {\n      this.hideTopBar();\n    } else {\n      this.showTopBar();\n    }\n  }\n\n  hideTopBar() {\n    const selector = \".selected-objects-top-bar\";\n    const topBar = document.querySelector(selector) as HTMLDivElement | null;\n    if (topBar === null) {\n      return;\n    }\n    topBar.style.display = \"none\";\n  }\n\n  showTopBar() {\n    const selector = \".selected-objects-top-bar\";\n    const topBar = document.querySelector(selector) as HTMLDivElement | null;\n    if (topBar === null) {\n      return;\n    }\n    topBar.style.display = \"block\";\n  }\n\n  // moveSelectedObjectsByDiff() {\n  //   const { getState } = appStore;\n  //   const state = getState();\n  //   // const store = getStore()\n\n  //   const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n  //   const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n  //   const objects = this.groupObjectsByTypeFromIntersect(this.intersects, 1);\n  //   const regionIds: string[] = Object.keys(state.ui.selectedRegionsIds);\n  //   objects.Region.forEach((obj) => {\n  //     const id = obj.object.userData.id ?? undefined;\n  //     if (id !== undefined) {\n  //       if (regionIds.includes(id) === false) {\n  //         regionIds.push(id);\n  //       }\n  //     }\n  //   });\n\n  //   const beadIds: string[] = Object.keys(state.ui.selectedBeadsIds);\n  //   objects.Bead.forEach((obj) => {\n  //     const id = obj.object.userData.id ?? undefined;\n  //     if (id !== undefined) {\n  //       if (beadIds.includes(id) === false) {\n  //         beadIds.push(id);\n  //       }\n  //     }\n  //   });\n\n  //   beadIds.forEach((beadId) => {\n  //     const name = getThreeNameFromBeadId(beadId);\n  //     const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //     if (object !== undefined) {\n  //       object.position.x = state.appData.beads[beadId].position.x + diffX;\n  //       object.position.y = state.appData.beads[beadId].position.y + diffY;\n  //     }\n  //   });\n\n  //   regionIds.forEach((regionId) => {\n  //     const name = getThreeNameFromRegionId(regionId);\n  //     const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //     if (object !== undefined) {\n  //       object.position.x = state.appData.regions[regionId].position.x + diffX;\n  //       object.position.y = state.appData.regions[regionId].position.y + diffY;\n  //     }\n  //   });\n  // }\n\n  // createEditBBox() {\n  //   const { getState } = appStore;\n  //   const state = getState();\n  //   getEventEmitter().emit(\n  //     EventNames.action_updateEditBBox,\n  //     {\n  //       editBBox: state.ui.editBBox,\n  //       prevEditBBox: state.ui.editBBox,\n  //     },\n  //     state\n  //   );\n\n  //   return;\n\n  //   // if (state.ui.editBBox === undefined) {\n  //   //   this.prevEditBBox = undefined;\n  //   //   return;\n  //   // }\n  //   // const name = getThreeNameFromEditBBoxId(state.ui.editBBox.id);\n  //   // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //   // if (object === undefined) {\n  //   //   this.prevEditBBox = undefined;\n  //   //   return;\n  //   // }\n  //   // this.prevEditBBox = {\n  //   //   id: state.ui.editBBox.id,\n  //   //   x: object.position.x,\n  //   //   y: object.position.y,\n  //   // };\n\n  //   // const nameTL = getThreeNameFromEditBBoxId(\n  //   //   state.ui.editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n  //   // );\n  //   // const objectTL = appThree.scene.getObjectByUserDataProperty(\"name\", nameTL);\n  //   // if (objectTL !== undefined) {\n  //   //   this.prevEditBBox.resizeXTL = objectTL.position.x;\n  //   //   this.prevEditBBox.resizeYTL = objectTL.position.y;\n  //   // }\n\n  //   // const nameTR = getThreeNameFromEditBBoxId(\n  //   //   state.ui.editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n  //   // );\n  //   // const objectTR = appThree.scene.getObjectByUserDataProperty(\"name\", nameTR);\n  //   // if (objectTR !== undefined) {\n  //   //   this.prevEditBBox.resizeXTR = objectTR.position.x;\n  //   //   this.prevEditBBox.resizeYTR = objectTR.position.y;\n  //   // }\n  //   // const nameBL = getThreeNameFromEditBBoxId(\n  //   //   state.ui.editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n  //   // );\n  //   // const objectBL = appThree.scene.getObjectByUserDataProperty(\"name\", nameBL);\n  //   // if (objectBL !== undefined) {\n  //   //   this.prevEditBBox.resizeXBL = objectBL.position.x;\n  //   //   this.prevEditBBox.resizeYBL = objectBL.position.y;\n  //   // }\n  //   // const nameBR = getThreeNameFromEditBBoxId(\n  //   //   state.ui.editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n  //   // );\n  //   // const objectBR = appThree.scene.getObjectByUserDataProperty(\"name\", nameBR);\n  //   // if (objectBR !== undefined) {\n  //   //   this.prevEditBBox.resizeXBR = objectBR.position.x;\n  //   //   this.prevEditBBox.resizeYBR = objectBR.position.y;\n  //   // }\n  // }\n\n  // refreshEditBBox() {\n  //   const { getState } = appStore;\n  //   const state = getState();\n  //   getEventEmitter().emit(\n  //     EventNames.action_updateEditBBox,\n  //     {\n  //       editBBox: state.ui.editBBox,\n  //       prevEditBBox: state.ui.editBBox,\n  //     },\n  //     state\n  //   );\n\n  //   return;\n\n  //   // if (this.prevEditBBox === undefined) {\n  //   //   return;\n  //   // }\n  //   // const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n  //   // const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n  //   // const name = getThreeNameFromEditBBoxId(this.prevEditBBox.id);\n  //   // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //   // if (object !== undefined) {\n  //   //   object.position.x = this.prevEditBBox.x + diffX;\n  //   //   object.position.y = this.prevEditBBox.y + diffY;\n  //   // }\n\n  //   // const nameTL = getThreeNameFromEditBBoxId(\n  //   //   this.prevEditBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n  //   // );\n  //   // const objectTL = appThree.scene.getObjectByUserDataProperty(\"name\", nameTL);\n  //   // if (objectTL !== undefined) {\n  //   //   objectTL.position.x = this.prevEditBBox.resizeXTL + diffX;\n  //   //   objectTL.position.y = this.prevEditBBox.resizeYTL + diffY;\n  //   // }\n\n  //   // const nameTR = getThreeNameFromEditBBoxId(\n  //   //   this.prevEditBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n  //   // );\n  //   // const objectTR = appThree.scene.getObjectByUserDataProperty(\"name\", nameTR);\n  //   // if (objectTR !== undefined) {\n  //   //   objectTR.position.x = this.prevEditBBox.resizeXTR + diffX;\n  //   //   objectTR.position.y = this.prevEditBBox.resizeYTR + diffY;\n  //   // }\n\n  //   // const nameBL = getThreeNameFromEditBBoxId(\n  //   //   this.prevEditBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n  //   // );\n  //   // const objectBL = appThree.scene.getObjectByUserDataProperty(\"name\", nameBL);\n  //   // if (objectBL !== undefined) {\n  //   //   objectBL.position.x = this.prevEditBBox.resizeXBL + diffX;\n  //   //   objectBL.position.y = this.prevEditBBox.resizeYBL + diffY;\n  //   // }\n  //   // const nameBR = getThreeNameFromEditBBoxId(\n  //   //   this.prevEditBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n  //   // );\n  //   // const objectBR = appThree.scene.getObjectByUserDataProperty(\"name\", nameBR);\n  //   // if (objectBR !== undefined) {\n  //   //   objectBR.position.x = this.prevEditBBox.resizeXBR + diffX;\n  //   //   objectBR.position.y = this.prevEditBBox.resizeYBR + diffY;\n  //   // }\n  // }\n}\n","import * as THREE from \"three\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeIdle extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    this.isCameraGrabed = true;\n\n    if (appThree.el === null) {\n      return;\n    }\n\n    this.boundingClientRect = appThree.el.getBoundingClientRect();\n    const { top, left } = this.boundingClientRect;\n\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n\n    this.startDragMousePosition.x = screenX;\n    this.startDragMousePosition.y = screenY;\n\n    this.startDragCamera.x = appThree.camera.position.x;\n    this.startDragCamera.y = appThree.camera.position.y;\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n\n    if (this.isCameraGrabed === true) {\n      const { getState } = appStore;\n      const state = getState();\n\n      const { top, left } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n      const sceneScale = state.ui.zoomScale;\n\n      const screenMouseDiffX = this.startDragMousePosition.x - screenX;\n      const screenMouseDiffY = this.startDragMousePosition.y - screenY;\n\n      const mouseDiffXInWorldSpace = screenMouseDiffX * sceneScale;\n      const mouseDiffYInWorldSpace = screenMouseDiffY * sceneScale;\n\n      const cameraX = this.startDragCamera.x + mouseDiffXInWorldSpace;\n      const cameraY = this.startDragCamera.y - mouseDiffYInWorldSpace;\n\n      appThree.camera.position.x = cameraX;\n      appThree.camera.position.y = cameraY;\n      appThree.camera.lookAt(cameraX, cameraY, 0);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    this.boundingClientRect = undefined;\n    if (this.isCameraGrabed === true) {\n      this.isCameraGrabed = false;\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport { getBeadIdFromThreeName } from \"../../../editorObjects/Bead\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"./../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"./../MouseSelectionHelper\";\nimport { screenToWorld } from \"./../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModePaint extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  mouseSelectionHelper: MouseSelectionHelper;\n\n  \n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n  }\n\n  onMove(event: PointerEvent) {\n    const { getState, dispatch } = appStore;\n    const state = getState();\n\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n\n    if (this.mouseDragHelper.isDragStarted === true) {\n      const { width, height, top, left } = this.boundingClientRect;\n\n      this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n      this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n\n      this.raycaster.setFromCamera(this.mouse, appThree.camera);\n      const intersects = this.raycaster.intersectObjects(\n        appThree.scene.children,\n        true\n      );\n\n      // if (intersects.length > 0) {\n      //   const beadsIds: string[] = [];\n      //   intersects.forEach((e) => {\n      //     const name = e.object.name;\n      //     const beadId = getBeadIdFromThreeName(name);\n      //     if (beadId !== undefined) {\n      //       if (state.appData.beads[beadId]) {\n      //         if (beadsIds.includes(beadId) === false) {\n      //           beadsIds.push(beadId);\n      //         }\n      //         return;\n      //       } else {\n      //         console.warn(\n      //           \"bead id missing in store\",\n      //           beadId,\n      //           name,\n      //           Object.keys(state.appData.beads).includes(beadId),\n      //           Object.keys(state.appData.beads)\n      //         );\n      //       }\n      //     }\n      //   });\n      //   if (beadsIds.length > 0) {\n      //     dispatch(\n      //       Actions.Toolbar.action_changeBeadColorToBeadTemplate(beadsIds)\n      //     );\n      //   }\n      // }\n\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n      this.mouseSelectionHelper.onMove(screenX, screenY);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    const { getState, dispatch } = appStore;\n    const state = getState();\n    if (this.mouseDragHelper.isDragged === true) {\n      // do nothing\n    } else if (\n      this.mouseDragHelper.isDragged === false &&\n      this.mouseDragHelper.isDragStarted === true\n    ) {\n      if (this.boundingClientRect === undefined) {\n        return;\n      }\n      const { width, height, top, left } = this.boundingClientRect;\n\n      this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n      this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n\n      this.raycaster.setFromCamera(this.mouse, appThree.camera);\n      const intersects = this.raycaster.intersectObjects(\n        appThree.scene.children,\n        true\n      );\n\n      // if (intersects.length > 0) {\n      //   const beadsIds: string[] = [];\n      //   intersects.forEach((e) => {\n      //     const id = getBeadIdFromThreeName(e.object.name);\n      //     if (id !== undefined) {\n      //       if (state.appData.beads[id]) {\n      //         beadsIds.push(id);\n      //       } else {\n      //         console.warn(\"bead id missing in store\", id);\n      //       }\n      //     }\n      //   });\n      //   if (beadsIds.length > 0) {\n      //     dispatch(\n      //       Actions.Toolbar.action_changeBeadColorToBeadTemplate(beadsIds)\n      //     );\n      //   }\n      // }\n    }\n\n    this.mouseDragHelper.onUp();\n    this.mouseSelectionHelper.onUp();\n  }\n}\n","import { difference } from \"lodash\";\nimport * as THREE from \"three\";\nimport {\n  getBeadIdFromThreeName,\n  getThreeNameFromBeadId,\n} from \"../../../editorObjects/Bead\";\nimport {\n  EditBBoxChildSuffix,\n  getEditBBoxIdFromThreeName,\n  getThreeNameFromEditBBoxId,\n} from \"../../../editorObjects/EditBBox\";\nimport { EditBBox } from \"../../../editorObjects/Editor\";\nimport { buildPoint } from \"../../../editorObjects/Point\";\nimport {\n  getRegionIdFromThreeName,\n  getThreeNameFromRegionId,\n  RegionChildSuffix,\n} from \"../../../editorObjects/Region\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"../MouseSelectionHelper\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport { SelectionFilter } from \"../SelectionFilter\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeSelectMultiple extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  selectionBox: SelectionFilter;\n  mouseSelectionHelper: MouseSelectionHelper;\n  prevEditBBox: any | undefined;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n\n    this.selectionBox = new SelectionFilter();\n    this.selectionBox.setCamera(appThree.camera);\n    this.selectionBox.setScene(appThree.scene);\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {}\n\n  onMove(event: PointerEvent) {}\n\n  onUp(event: PointerEvent) {}\n}\n","import * as THREE from \"three\";\n\nlet mousePosition: undefined | THREE.Vector2 = undefined;\nexport const getMousePositionAtWindow = () => {\n  return mousePosition;\n};\nexport const setMousePositionAtWindow = (clientX?: number, clientY?: number) => {\n  if (!clientX || !clientY) {\n    mousePosition = undefined;\n  } else {\n    const newPos = new THREE.Vector2();\n    newPos.x = clientX;\n    newPos.y = clientY;\n    mousePosition = newPos;\n  }\n//   console.log(\"new mouse position\", mousePosition);\n};\n","import { appThree } from \"../renderThreejs\";\nimport { screenToWorld } from \"./screenToWorld\";\n\nexport const getRect10x10FromScreenToWorld = () => {\n  const viewportOffset = appThree.el.getBoundingClientRect();\n  const w = 10;\n  const h = 10;\n  const x1 = viewportOffset.left;\n  const x2 = viewportOffset.left + w;\n  const y1 = viewportOffset.top;\n  const y2 = viewportOffset.top + h;\n  const pos1 = screenToWorld(x1, y1);\n  const pos2 = screenToWorld(x2, y2);\n  const maxX = Math.max(pos1.x, pos2.x);\n  const minX = Math.min(pos1.x, pos2.x);\n  const minY = Math.min(pos1.y, pos2.y);\n  const maxY = Math.max(pos1.y, pos2.y);\n  const rect10x10FromScreenToWorld = {\n    min: {\n      x: minX,\n      y: minY,\n    },\n    max: {\n      x: maxX,\n      y: maxY,\n    },\n    w: maxX - minX,\n    h: maxY - minY,\n  };\n  return rect10x10FromScreenToWorld;\n};\n","import produce from \"immer\";\nimport { times } from \"lodash\";\nimport {\n  AddObjects,\n  RemoveObjects,\n  ChangeSelectObjects,\n  ChangeObjectsProperty,\n  ClipboardCut,\n  ClipboardPaste,\n  AddMultipleBeads,\n  ChangeSelectedObjectsAlignment,\n  DuplicateObjects,\n  GroupObjects,\n  UngroupObjects,\n} from \"./AppEventType\";\nimport { SimpleHistoryEvent } from \"./store\";\nimport { sendEvent } from \"./storeController\";\n\nexport interface HistoryEvent<D, R, U> {\n  do: D;\n  redo: R;\n  undo: U;\n  createdAt: string;\n}\nexport interface AddObjectsHistory\n  extends HistoryEvent<AddObjects, AddObjects, RemoveObjects> {}\n\nexport interface DuplicateObjectsHistory\n  extends HistoryEvent<DuplicateObjects, DuplicateObjects, RemoveObjects> {}\n\nexport interface RemoveObjectsHistory\n  extends HistoryEvent<RemoveObjects, RemoveObjects, AddObjects> {}\nexport interface ChangeSelectObjectsHistory\n  extends HistoryEvent<\n    ChangeSelectObjects,\n    ChangeSelectObjects,\n    ChangeSelectObjects\n  > {}\nexport interface ChangeObjectsPropertyHistory\n  extends HistoryEvent<\n    ChangeObjectsProperty,\n    ChangeObjectsProperty,\n    ChangeObjectsProperty\n  > {}\nexport interface ClipboardCutHistory\n  extends HistoryEvent<ClipboardCut, ClipboardCut, ClipboardPaste> {}\nexport interface ClipboardPasteHistory\n  extends HistoryEvent<ClipboardPaste, ClipboardPaste, RemoveObjects> {}\nexport interface AddMultipleBeadsHistory\n  extends HistoryEvent<AddMultipleBeads, AddObjects, RemoveObjects> {}\nexport interface ChangeSelectedObjectsAlignmentHistory\n  extends HistoryEvent<\n    ChangeSelectedObjectsAlignment,\n    ChangeSelectedObjectsAlignment,\n    ChangeObjectsProperty\n  > {}\nexport interface GroupObjectsHistory\n  extends HistoryEvent<GroupObjects, GroupObjects, UngroupObjects> {}\nexport interface UngroupObjectsHistory\n  extends HistoryEvent<UngroupObjects, UngroupObjects, GroupObjects> {}\n\nexport type AppHistoryEvents =\n  | AddObjectsHistory\n  | RemoveObjectsHistory\n  | ChangeSelectObjectsHistory\n  | ChangeObjectsPropertyHistory\n  | ClipboardCutHistory\n  | ClipboardPasteHistory\n  | AddMultipleBeadsHistory\n  | ChangeSelectedObjectsAlignmentHistory\n  | DuplicateObjectsHistory\n  | GroupObjectsHistory\n  | UngroupObjectsHistory;\n\nexport class AppHistory {\n  events: AppHistoryEvents[] = [];\n  index: number = 0;\n  maxHistoryRecords: number = 100;\n  push(arg: AppHistoryEvents): void {\n    const len = this.events.length;\n    if (len !== this.index) {\n      this.events.splice(this.index, len - this.index);\n    }\n    this.events.push(arg);\n    this.index += 1;\n    if (this.events.length > this.maxHistoryRecords) {\n      const diff = this.events.length - this.maxHistoryRecords;\n      this.events.splice(0, diff);\n      this.index = this.index - diff;\n    }\n  }\n  front(): AppHistoryEvents | undefined {\n    const event = this.events[this.index];\n    this.index += 1;\n    if (this.index > this.events.length) {\n      this.index = this.events.length;\n    }\n    return event;\n  }\n  back(): AppHistoryEvents | undefined {\n    const event = this.events[this.index - 1];\n    this.index -= 1;\n    if (this.index <= 0) {\n      this.index = 0;\n    }\n    return event;\n  }\n  getSimpleHistoryEvents() {\n    return this.events.map((e, i) => {\n      return {\n        name: e.do.name,\n        isActive: i < this.index,\n        createdAt: e.createdAt,\n      } as SimpleHistoryEvent;\n    });\n  }\n  canRedo() {\n    return this.index !== this.events.length;\n  }\n  canUndo() {\n    return this.index > 0;\n  }\n}\n\nexport const undoHistory = () => {\n  const history = getHistory();\n  const lastEvent = history.back();\n  if (lastEvent !== undefined) {\n    sendEvent(lastEvent.undo, false);\n  }\n};\n\nexport const redoHistory = () => {\n  const history = getHistory();\n  const lastEvent = history.front();\n  if (lastEvent !== undefined) {\n    sendEvent(lastEvent.redo, false);\n  }\n};\n\nexport const jumpToIndexHistory = (index: number) => {\n  const history = getHistory();\n  const lastIndex = history.index - 1;\n\n  if (index === lastIndex) {\n    // do nothing\n  } else if (index >= 0 && index < lastIndex) {\n    times(lastIndex - index).forEach(() => {\n      undoHistory();\n    });\n  } else if (index < history.events.length && index > lastIndex) {\n    times(index - lastIndex).forEach(() => {\n      redoHistory();\n    });\n  }\n};\n\nlet history: AppHistory;\n\nexport const initHistory = () => {\n  history = new AppHistory();\n};\n\nexport const getHistory = () => {\n  return history;\n};\n","import * as THREE from \"three\";\nimport { addLightFromUI, triggerAddBeadToScene } from \"./eventEmitterHandlers\";\nimport { AppObject, Bead, ObjectTypes } from \"../editorObjects/Editor\";\nimport { AppThreeScene } from \"./renderThreejs\";\nimport { getStore } from \"../controllers/store\";\n\nexport let thumbnailsGenerator: ThumbnailsGenerator;\n\nexport const initThumbnailsGenerator = () => {\n  try {\n    const rootEl = document.createElement(\"div\");\n    rootEl.setAttribute(\"id\", \"thumbnailsGeneratorRoot\");\n    thumbnailsGenerator = new ThumbnailsGenerator(rootEl);\n    rootEl.appendChild(thumbnailsGenerator.renderer.domElement);\n    rootEl.style.display = \"none\";\n    document.body.appendChild(rootEl);\n    // loadAppModels(thumbnailsGenerator);\n  } catch (err) {\n    console.error(\"initThumbnailsGenerator err:\", err.toString());\n  }\n};\n\nclass ThumbnailsGenerator {\n  el: HTMLElement;\n  // camera: THREE.OrthographicCamera;\n  scene: AppThreeScene;\n  renderer: THREE.WebGLRenderer;\n  cache: { [key: string]: string };\n  constructor(el: HTMLElement) {\n    this.el = el;\n    this.cache = {};\n    // const { width, height } = el.getBoundingClientRect();\n\n    // this.camera = new THREE.OrthographicCamera(\n    //   width / -2,\n    //   width / 2,\n    //   height / 2,\n    //   height / -2,\n    //   0,\n    //   1000\n    // );\n\n    // this.camera.position.set(0, 0, 500);\n    // this.camera.lookAt(0, 0, 0);\n\n    this.scene = new THREE.Scene() as any;\n    this.scene.background = new THREE.Color(\"#fff\");\n\n    this.renderer = new THREE.WebGLRenderer({\n      antialias: true,\n      preserveDrawingBuffer: true,\n    });\n    // this.renderer.setSize(width, height);\n  }\n\n  getObjectThumbnail(\n    object: AppObject,\n    imgWidth: number,\n    imgHeight: number,\n    forceCache: boolean = false\n  ) {\n    const cacheData: any = {\n      imgWidth,\n      imgHeight,\n      width: object.width,\n      height: object.height,\n      depth: object.depth,\n      rotateX: object.rotateX,\n      rotateY: object.rotateY,\n      rotateZ: object.rotateZ,\n    };\n    if (object.objectType === ObjectTypes.Bead) {\n      cacheData.type = (object as Bead).type;\n      cacheData.color = (object as Bead).color;\n    }\n\n    const cacheId = JSON.stringify(cacheData);\n    if (forceCache === true || this.cache[cacheId] === undefined) {\n      const content = this.createObjectThumbnail(object, imgWidth, imgHeight);\n      if (content === undefined) {\n        return undefined;\n      } else {\n        this.cache[cacheId] = content;\n      }\n    }\n    return this.cache[cacheId];\n  }\n\n  createObjectThumbnail(\n    object: AppObject,\n    imgWidth: number,\n    imgHeight: number\n  ) {\n    try {\n      this.renderer.setSize(imgWidth, imgHeight);\n\n      this.scene.clear();\n\n      if (object.objectType !== ObjectTypes.Bead) {\n        console.warn(\"object.objectType not supported yet\");\n        return;\n      }\n\n      const object3d = triggerAddBeadToScene(object as Bead, this.scene);\n\n      if (object3d === undefined) {\n        console.warn(\"triggerAddBeadToScene object not created in scene\");\n        return;\n      }\n\n      object3d.position.x = 0;\n      object3d.position.y = 0;\n\n      const bbox = new THREE.Box3();\n      bbox.expandByObject(object3d);\n\n      let width = 1;\n      let height = 1;\n      // let depth = 1;\n\n      if (bbox) {\n        width = Math.abs(bbox.max.x - bbox.min.x);\n        height = Math.abs(bbox.max.y - bbox.min.y);\n        // depth = Math.abs(bbox.max.z - bbox.min.z);\n      }\n\n      const objectRatio = width / height;\n      const ratioImage = imgWidth / imgHeight;\n      let baseWidth = 1;\n      let baseHeight = 1;\n      if (ratioImage < objectRatio) {\n        baseWidth = width;\n        baseHeight = baseWidth * ratioImage;\n      } else {\n        baseHeight = height;\n        baseWidth = baseHeight / ratioImage;\n      }\n      const halfWidth = (baseWidth + baseWidth * 0.1) / 2;\n      const halfHeight = (baseHeight + baseHeight * 0.1) / 2;\n\n      const camera = new THREE.OrthographicCamera(\n        halfWidth * -1,\n        halfWidth,\n        halfHeight,\n        halfHeight * -1,\n        0,\n        1000\n      );\n\n      camera.position.set(0, 0, 500);\n      camera.lookAt(0, 0, 0);\n\n      const store = getStore();\n      store.ui.lights.forEach((lightConfig) => {\n        addLightFromUI(lightConfig, this.scene);\n      });\n\n      this.renderer.render(this.scene, camera);\n\n      const MIME_TYPE = \"image/png\";\n      const content = this.renderer.domElement.toDataURL(MIME_TYPE);\n      //   .replace(\"image/png\", \"image/octet-stream\");\n      // const link = document.createElement(\"a\");\n      // document.body.appendChild(link);\n      // link.download = \"coralinio-preview.png\";\n      // link.href = content;\n      // link.click();\n      // document.body.removeChild(link);\n\n      this.scene.clear();\n\n      return content;\n\n      // var img = new Image();\n      // img.src = content;\n      // img.id = \"1111111111111111\"\n      // document.body.appendChild(img);\n    } catch (e) {\n      console.log(\"getObjectThumbnail error:\", e);\n      return;\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport { initEventEmitterHandlers } from \"./eventEmitterHandlers\";\nimport { loadAppModels } from \"./loadModels\";\nimport { initMouseListeners } from \"./mouseListeners/mouseListeners\";\nimport { getRect10x10FromScreenToWorld } from \"./mouseListeners/getRect10x10FromScreenToWorld\";\nimport {\n  initKeybinding,\n  startListeningKeys,\n  subscribeKeys,\n} from \"./keyboard/keyMap\";\nimport {\n  initHistory,\n  redoHistory,\n  undoHistory,\n} from \"../controllers/AppHistory\";\nimport { getStore, initStore } from \"../controllers/store\";\nimport { clipboardCopy, clipboardCut, clipboardPaste } from \"./clipboard\";\nimport { initThumbnailsGenerator } from \"./thumbnailsGenerator\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { AppEventType, RemoveObjects } from \"../controllers/AppEventType\";\nimport { Point } from \"../editorObjects/Editor\";\n\nexport let appThree: AppThree;\n\nexport const renderThreejs = (\n  el: HTMLElement | null,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  return initCanvasApp(el, canvas, context);\n};\n\nexport const unmountThreejs = (el: HTMLElement | null) => {\n  if (el) {\n    el.innerHTML = \"\";\n\n    if (el.classList.contains(\"active\") === true) {\n      el.classList.remove(\"active\");\n    }\n  }\n  return new Promise((resolve) => {\n    resolve(undefined);\n  });\n};\n\nconst initCanvasApp = async (\n  el: HTMLElement | null,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  if (el === null) {\n    console.warn(\"no html el element found\");\n    return;\n  }\n\n  if (el.classList.contains(\"active\") === false) {\n    el.classList.add(\"active\");\n  }\n\n  try {\n    initStore();\n    initHistory();\n    initKeybinding();\n    appThree = new AppThree(el, canvas, context);\n    el.appendChild(appThree.renderer.domElement);\n    await loadAppModels(appThree);\n    initMouseListeners();\n    initEventEmitterHandlers();\n    requestAnimationFrame(threeRender);\n    startListeningKeys();\n\n    const rect10x10FromScreenToWorld = getRect10x10FromScreenToWorld();\n    appThree.camera.userData = { sceneScale: 1, rect10x10FromScreenToWorld };\n    subscribeKeys(\"keyz\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        console.log(\"listener:: undohistory\");\n        undoHistory();\n      }\n      return false;\n    });\n    subscribeKeys(\"keyy\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        console.log(\"listener:: redohistory\");\n        redoHistory();\n      }\n      return false;\n    });\n    subscribeKeys(\"keyc\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        console.log(\"listener:: copy\");\n        clipboardCopy();\n      }\n      return false;\n    });\n    subscribeKeys(\"keyx\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        console.log(\"listener:: cut\");\n        clipboardCut();\n      }\n      return false;\n    });\n    subscribeKeys(\"keyv\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        console.log(\"listener:: paste\");\n        clipboardPaste();\n      }\n      return false;\n    });\n    subscribeKeys(\"delete\", (event, pressed) => {\n      console.log(\"listener:: delete\");\n      const store = getStore();\n      if (store.selectedIds.length > 0) {\n        const action: RemoveObjects = {\n          name: AppEventType.RemoveObjects,\n          payload: {\n            ids: store.selectedIds,\n          },\n        };\n        sendEvent(action);\n      }\n      return false;\n    });\n\n    // console.log(\"co w odpowiedzi?\", rectangle(0, 0, 2, 2, {} as any, {\n    //   brickSize: 10,\n    //   brickHeight: 25,\n    //   brickWidth: 20,\n    //   color: \"red\",\n    //   filled: true,\n    //   palette: [],\n    // }));\n    initThumbnailsGenerator();\n  } catch (err) {\n    console.error(\"err:\", err.toString());\n  }\n  return;\n};\n\nexport interface AppThreeScene extends THREE.Scene {\n  getObjectByUserDataProperty: (\n    name: string,\n    value: any\n  ) => undefined | THREE.Object3D;\n}\n\nclass AppThree {\n  el: HTMLElement;\n  camera: THREE.OrthographicCamera;\n  scene: AppThreeScene;\n  renderer: THREE.WebGLRenderer;\n  additionalData: {\n    selectedBBox:\n      | {\n          topLeft: Point;\n          topRight: Point;\n          bottomLeft: Point;\n          bottomRight: Point;\n        }\n      | undefined;\n  };\n  constructor(\n    el: HTMLElement,\n    canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n    context: WebGLRenderingContext | undefined\n  ) {\n    this.el = el;\n    const { width, height } = el.getBoundingClientRect();\n\n    this.additionalData = {\n      selectedBBox: undefined,\n    };\n    this.camera = new THREE.OrthographicCamera(\n      width / -2,\n      width / 2,\n      height / 2,\n      height / -2,\n      0,\n      1000\n    );\n\n    this.camera.position.set(0, 0, 500);\n    this.camera.lookAt(0, 0, 0);\n    this.camera.layers.enable(2);\n\n    this.scene = new THREE.Scene() as any;\n    this.scene.background = new THREE.Color(\"#f2f2f2\");\n\n    this.renderer = new THREE.WebGLRenderer({\n      canvas: canvas ?? undefined,\n      context: context ?? undefined,\n      antialias: true,\n      preserveDrawingBuffer: true,\n    });\n    // this.renderer.setPixelRatio(window.devicePixelRatio);\n\n    this.renderer.setSize(width, height);\n  }\n}\n\nfunction threeRender() {\n  if (needToResizeRendererToDisplaySize(appThree.renderer)) {\n    appThree.camera.updateProjectionMatrix();\n  }\n\n  appThree.renderer.render(appThree.scene, appThree.camera);\n  requestAnimationFrame(threeRender);\n}\n\nfunction needToResizeRendererToDisplaySize(renderer) {\n  const canvas = renderer.domElement;\n  const width = canvas.clientWidth;\n  const height = canvas.clientHeight;\n  const needResize = canvas.width !== width || canvas.height !== height;\n  if (needResize) {\n    renderer.setSize(width, height, false);\n  }\n  return needResize;\n}\n\n// @TODO: HOW TO EXTEND THREE JS MODULE?\n// declare module \"three\" {\n//   export class Object3D {\n//     getObjectByUserDataProperty: (\n//       name: string,\n//       value: any\n//     ) => undefined | Object3D;\n//   }\n// }\n// source: https://github.com/mrdoob/three.js/blob/0fbc8afb348198e4924d9805d1d4be5869264418/src/core/Object3D.js#L85\n// source: https://discourse.threejs.org/t/getobject-by-any-custom-property-present-in-userdata-of-object/3378\n(THREE.Object3D.prototype as any).getObjectByUserDataProperty = function (\n  name: string,\n  value: any\n) {\n  if (this.userData[name] === value) return this;\n\n  for (var i = 0, l = this.children.length; i < l; i++) {\n    var child = this.children[i];\n    var object = child.getObjectByUserDataProperty(name, value);\n\n    if (object !== undefined) {\n      return object;\n    }\n  }\n\n  return undefined;\n};\n","import { cloneDeep } from \"lodash\";\nimport * as THREE from \"three\";\nimport {\n  AddObjects,\n  AppEventType,\n  ChangeSelectObjects,\n  ClipboardCopy,\n  ClipboardCut,\n  ClipboardPaste,\n  RemoveObjects,\n} from \"../controllers/AppEventType\";\nimport { getStore } from \"../controllers/store\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { AppObject, Group, ObjectTypes } from \"../editorObjects/Editor\";\n\nexport interface ClipboardContent {\n  objects: AppObject[];\n}\nlet clipboardContent: ClipboardContent | undefined = undefined;\n\nexport const setClipboardBoardContent = (\n  content: ClipboardContent | undefined\n) => {\n  clipboardContent = content;\n};\n\nexport const getClipboardBoardContent = () => {\n  return clipboardContent;\n};\n\nexport const clipboardCopy = () => {\n  const event: ClipboardCopy = {\n    name: AppEventType.ClipboardCopy,\n    payload: {},\n  };\n  sendEvent(event);\n};\n\nexport const clipboardCut = () => {\n  const event: ClipboardCut = {\n    name: AppEventType.ClipboardCut,\n    payload: {},\n  };\n  sendEvent(event);\n};\n\nexport const clipboardPaste = () => {\n  if (clipboardContent === undefined) {\n    return;\n  }\n  const event: ClipboardPaste = {\n    name: AppEventType.ClipboardPaste,\n    payload: {\n      objects: clipboardContent.objects,\n    },\n  };\n  sendEvent(event);\n};\n","import * as THREE from \"three\";\nimport { getStore } from \"../../controllers/store\";\nimport { appStore } from \"../../immerReducers/appStore\";\nimport { appThree } from \"../renderThreejs\";\n\nexport const screenToWorld = (\n  clientX: number,\n  clientY: number\n): THREE.Vector2 => {\n  if (appThree.el === null) {\n    throw new Error(\"no el in dom\");\n  }\n  if (!appStore) {\n    throw new Error(\"no el in dom\");\n  }\n  // const { getState } = appStore;\n  // const state = getState();\n  const store = getStore();\n  const sceneScale = store.ui.zoomScale;\n  const { width, height, top, left } = appThree.el.getBoundingClientRect();\n  const screenX = clientX - left; // canvasX\n  const screenY = clientY - top; // canvasY\n  const x = (screenX - width / 2) * sceneScale + appThree.camera.position.x;\n  const y = (-screenY + height / 2) * sceneScale + appThree.camera.position.y;\n  return new THREE.Vector2(x, y);\n};\n\nexport const worldToScreen = (pos: THREE.Vector3) => {\n  if (!appStore) {\n    throw new Error(\"no el in dom\");\n  }\n  // const { getState } = appStore;\n  // const state = getState();\n  // const store = getStore();\n  // const sceneScale = store.ui.zoomScale;\n  const { width, height, top, left } = appThree.el.getBoundingClientRect();\n  var vector = pos.clone();\n  // vector.setFromMatrixPosition(obj.matrixWorld);\n  var widthHalf = width / 2;\n  var heightHalf = height / 2;\n  \n  vector.project(appThree.camera);\n  // console.log(\"??? \", vector)\n  // console.log(\"------\", vector.x, vector.y, sceneScale);\n  vector.x = vector.x * widthHalf + widthHalf + left;\n  vector.y = -(vector.y * heightHalf) + heightHalf + top;\n  return vector;\n};\n\nexport const getTopBarPositionInScreenFromObject = (bbox: THREE.Box3) => {\n  // const pos = worldToScreen(obj);\n\n  // const bbox = new THREE.Box3();\n  // bbox.expandByObject(obj);\n  if (isFinite(bbox.min.x) === false || isFinite(bbox.max.y) === false) {\n    return undefined;\n  }\n\n  // const offset = new THREE.Vector3();\n  // offset.x = bbox.min.x;\n  // offset.y = bbox.min.y;\n\n  // console.log(\n  //   \"getTopBarPositionInScreenFromObject bbox.min\",\n  //   bbox.min,\n  //   bbox.max\n  // );\n\n  // bbox.getCenter().x\n  var vector = new THREE.Vector3();\n  vector.x = bbox.min.x + (bbox.max.x - bbox.min.x) / 2;\n  vector.y = bbox.max.y;\n\n  // vector = obj.localToWorld(vector);\n  // vector.sub(offset);\n  const pos2 = worldToScreen(vector);\n\n  if(pos2.x < 0){\n    pos2.x = 0;\n  } \n  if(pos2.y < 70){\n    pos2.y = 70;\n  } \n\n  // var vector2 = new THREE.Vector3();\n  // vector2.add()\n  // vector.add(pos2)\n\n  return pos2;\n};\n\nexport const getTopBarPositionInScreenFromBBox = (vector: THREE.Vector3) => {\n  return worldToScreen(vector);\n};\n","import { merge, times } from \"lodash\";\nimport * as THREE from \"three\";\nimport { ChangeObjectsProperty } from \"../controllers/AppEventType\";\nimport {\n  BeadChildSuffix,\n  getThreeNameFromBeadId,\n  getThreeUserDataFromBead,\n} from \"../editorObjects/Bead\";\nimport {\n  EditBBoxChildSuffix,\n  getThreeNameFromEditBBoxId,\n  getThreeUserDataFromEditBBox,\n} from \"../editorObjects/EditBBox\";\nimport {\n  AppObject,\n  Bead,\n  BeadMaterialTypes,\n  BeadTypes,\n  EditBBox,\n  Editor,\n  Group,\n  NAME_SEPARATOR,\n  ObjectTypes,\n  PreviewProject3D,\n  Region,\n  ThreeGridHelperConfig,\n  ThreeLightConfig,\n} from \"../editorObjects/Editor\";\nimport { getStateObjectFromObjectId } from \"../editorObjects/editorGetters\";\nimport {\n  getThreeUserDataFromGroup,\n  GroupChildSuffix,\n} from \"../editorObjects/Group\";\nimport {\n  getThreeUserDataFromPreviewProject3D,\n  PreviewProject3DChildSuffix,\n} from \"../editorObjects/PreviewProject3D\";\nimport {\n  getThreeNameFromRegionId,\n  getThreeUserDataFromRegion,\n  RegionChildSuffix,\n} from \"../editorObjects/Region\";\nimport { EventNames, getEventEmitter } from \"../EventEmitter\";\nimport { getModelBBoxFromBeadType, getModelFromBeadType } from \"./loadModels\";\nimport { getTopBarPositionInScreenFromObject } from \"./mouseListeners/screenToWorld\";\nimport { appThree, AppThreeScene } from \"./renderThreejs\";\n\nexport const initEventEmitterHandlers = () => {\n  const eventEmitter = getEventEmitter();\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_color, (data) => {\n    data.beadIds.forEach((id) => {\n      const name = getThreeNameFromBeadId(id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n      if (object === undefined) {\n        return;\n      }\n\n      object.traverse((child) => {\n        if (child instanceof THREE.Mesh) {\n          if (child.material) {\n            (child.material as THREE.MeshPhysicalMaterial).color.set(\n              data.color\n            );\n          }\n        }\n      });\n    });\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_height, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      const bbox = getModelBBoxFromBeadType(bead.type);\n      let width = 1;\n      let height = 1;\n      let depth = 1;\n      if (bbox) {\n        width = Math.abs(bbox.max.x - bbox.min.x);\n        height = Math.abs(bbox.max.y - bbox.min.y);\n        depth = Math.abs(bbox.max.z - bbox.min.z);\n      }\n      object.scale.x = bead.width / width;\n      object.scale.y = bead.height / height;\n      object.scale.z = bead.depth / depth;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_unselectAll, (data) => {\n    data.diffStateSelectedIds.forEach((obj) => {\n      if (obj.objectType === ObjectTypes.Bead) {\n        triggerSelectBead(obj.id, obj.isSelected);\n      } else if (obj.objectType === ObjectTypes.Region) {\n        triggerSelectRegion(obj.id, obj.isSelected);\n      }\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_width, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      const bbox = getModelBBoxFromBeadType(bead.type);\n      let width = 1;\n      let height = 1;\n      let depth = 1;\n      if (bbox) {\n        width = Math.abs(bbox.max.x - bbox.min.x);\n        height = Math.abs(bbox.max.y - bbox.min.y);\n        depth = Math.abs(bbox.max.z - bbox.min.z);\n      }\n      object.scale.x = bead.width / width;\n      object.scale.y = bead.height / height;\n      object.scale.z = bead.depth / depth;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_depth, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      const bbox = getModelBBoxFromBeadType(bead.type);\n      let width = 1;\n      let height = 1;\n      let depth = 1;\n      if (bbox) {\n        width = Math.abs(bbox.max.x - bbox.min.x);\n        height = Math.abs(bbox.max.y - bbox.min.y);\n        depth = Math.abs(bbox.max.z - bbox.min.z);\n      }\n      object.scale.x = bead.width / width;\n      object.scale.y = bead.height / height;\n      object.scale.z = bead.depth / depth;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_type, (data) => {\n    data.beadIds.forEach((id) => {\n      const name = getThreeNameFromBeadId(id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      appThree.scene.remove(object);\n    });\n\n    data.beads.forEach((bead: Bead) => {\n      triggerAddBeadToScene(bead, appThree.scene);\n      triggerSelectBead(bead.id, true);\n    });\n\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_rotate, (data) => {\n    data.beadIds.forEach((id) => {\n      const name = getThreeNameFromBeadId(id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n\n      object.rotation.x = THREE.MathUtils.DEG2RAD * data.rotateX;\n      object.rotation.y = THREE.MathUtils.DEG2RAD * data.rotateY;\n      object.rotation.z = THREE.MathUtils.DEG2RAD * data.rotateZ;\n    });\n\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_selectBeads, (data) => {\n    data.diffStates.forEach((bead) => {\n      const id = Object.keys(bead)[0];\n      const value = Object.values(bead)[0] as boolean;\n      triggerSelectBead(id, value);\n    });\n  });\n\n  eventEmitter.on(EventNames.action_selectIntersectObject, (data) => {\n    data.diffStateSelectedIds.forEach((obj) => {\n      if (obj.objectType === ObjectTypes.Bead) {\n        triggerSelectBead(obj.id, obj.isSelected);\n      } else if (obj.objectType === ObjectTypes.Region) {\n        triggerSelectRegion(obj.id, obj.isSelected);\n      }\n    });\n\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_selectIntersectObjects, (data) => {\n    if (data?.selectedBeads?.diffStates) {\n      data.selectedBeads?.diffStates?.forEach((bead) => {\n        const id = Object.keys(bead)[0];\n        const value = Object.values(bead)[0] as boolean;\n        triggerSelectBead(id, value);\n      });\n    }\n    if (data?.selectedRegions?.diffStates) {\n      data.selectedRegions?.diffStates?.forEach((region) => {\n        const id = Object.keys(region)[0];\n        const value = Object.values(region)[0] as boolean;\n        triggerSelectRegion(id, value);\n      });\n    }\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_updateZoomSCale, (data) => {\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_updateEditBBox, (data) => {\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_selectRegions, (data) => {\n    const selectedIds: string[] = [];\n    data.diffStates.forEach((bead) => {\n      const id = Object.keys(bead)[0];\n      const value = Object.values(bead)[0] as boolean;\n      triggerSelectRegion(id, value);\n      if (value === true) {\n        selectedIds.push(id);\n      }\n    });\n  });\n\n  eventEmitter.on(EventNames.action_deleteBeads, (data) => {\n    triggerDeleteBeadIds(data.beadIds);\n  });\n\n  eventEmitter.on(EventNames.action_deleteSelectedBeads, (data) => {\n    triggerDeleteBeadIds(data.beadIds);\n  });\n\n  eventEmitter.on(EventNames.action_deleteObjects, (data) => {\n    triggerDeleteObjectIds(data.toDeleteObjectIds);\n  });\n\n  eventEmitter.on(EventNames.action_addBeadOnClick, (data) => {\n    const bead = data.bead as Bead;\n    triggerAddBeadToScene(bead, appThree.scene);\n  });\n\n  eventEmitter.on(EventNames.action_updateLight, (data) => {\n    const { name, field, value } = data;\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object !== undefined) {\n      const light = object as THREE.DirectionalLight;\n      if (data.field === \"color\") {\n        light.color = data.value;\n      }\n      if (data.field === \"intensity\") {\n        light.intensity = data.value;\n      }\n    }\n  });\n\n  eventEmitter.on(EventNames.action_addRegion, (data) => {\n    const region = data.region as Region;\n    triggerRegionToScene(region);\n  });\n\n  eventEmitter.on(EventNames.action_moveClickedObject, (data) => {\n    data.movedObjects.forEach((obj) => {\n      const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n      if (name === undefined) {\n        return;\n      }\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.position.x = obj.position.x;\n      object.position.y = obj.position.y;\n    });\n  });\n\n  eventEmitter.on(EventNames.action_moveAllSelectedObjects, (data) => {\n    data.movedObjects.forEach((obj) => {\n      const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n      if (name === undefined) {\n        return;\n      }\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.position.x = obj.position.x;\n      object.position.y = obj.position.y;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_movedSelected, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id, BeadChildSuffix.MAIN);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.position.x = bead.position.x;\n      object.position.y = bead.position.y;\n    });\n    data.regions.forEach((region: Region) => {\n      const name = getThreeNameFromRegionId(region.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      console.log(\"co bylo?\", object.position.x, region.position.x);\n      object.position.x = region.position.x;\n      object.position.y = region.position.y;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.updateEditorState, () => {});\n\n  eventEmitter.on(EventNames.action_changeBeadColorToBeadTemplate, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.traverse((child) => {\n        if (child instanceof THREE.Mesh) {\n          child.material = new THREE.MeshPhysicalMaterial({\n            flatShading: true,\n            reflectivity: 1,\n            color: data.color,\n          });\n        }\n      });\n    });\n  });\n\n  eventEmitter.on(EventNames.action_fastAddBeads, (data) => {\n    Object.keys(data.beads).forEach((id) => {\n      const bead = data.beads[id] as Bead;\n      triggerAddBeadToScene(bead, appThree.scene);\n    });\n\n    data.prevSelectedBeadIds.forEach((beadId) => {\n      triggerSelectBead(beadId, false);\n    });\n  });\n\n  eventEmitter.on(EventNames.action_snapToLineSelectedBeads, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.position.x = bead.position.x;\n      object.position.y = bead.position.y;\n    });\n  });\n\n  eventEmitter.on(EventNames.action_onChangeEditorMode, (data) => {\n    data.prevSelectedBeadIds.forEach((beadId) => {\n      triggerSelectBead(beadId, false);\n    });\n  });\n\n  eventEmitter.on(EventNames.action_readSavedCanvas, (data) => {\n    Object.keys(data.objects).forEach((id) => {\n      const obj = data.objects[id] as AppObject;\n      if (obj.objectType === ObjectTypes.Bead) {\n        triggerAddBeadToScene(obj as Bead, appThree.scene);\n      } else if (obj.objectType === ObjectTypes.Region) {\n        triggerRegionToScene(obj as Region);\n      } else if (obj.objectType === ObjectTypes.Group) {\n        triggerGroupToScene(obj as Group);\n      } else if (obj.objectType === ObjectTypes.PreviewProject3D) {\n        triggerPreviewProject3DToScene(obj as PreviewProject3D);\n      }\n    });\n    // Object.keys(data.beads).forEach((id) => {\n    //   const bead = data.beads[id] as Bead;\n    //   triggerAddBeadToScene(bead);\n    // });\n    // Object.keys(data.regions).forEach((id) => {\n    //   const region = data.regions[id] as Region;\n    //   triggerRegionToScene(region);\n    // });\n  });\n\n  eventEmitter.on(EventNames.startAppEvent, (data: { state: Editor }) => {\n    console.log(\"startAppEvent: ...\", data.state.ui.lights);\n\n    if (data.state.ui.lights && data.state.ui.lights.length > 0) {\n      data.state.ui.lights.forEach((l) => {\n        if (l.type === \"THREE.DirectionalLight\") {\n          const light = new THREE.DirectionalLight(l.color, l.intensity);\n          light.position.set(\n            l.position?.x ?? 0,\n            l.position?.y ?? 0,\n            l.position?.z ?? 10\n          );\n          light.name = l.name;\n          light.userData = merge({}, light, {\n            objectType: ObjectTypes.SceneLight,\n            name: `${ObjectTypes.SceneLight}${NAME_SEPARATOR}${light.id}`,\n          });\n          appThree.scene.add(light);\n        }\n      });\n    }\n    if (data.state.ui.grid.isVisible) {\n      const size = 100000;\n      const grid = new THREE.GridHelper(1, size / 10, \"#e9e9e9\", \"#eee\");\n      grid.position.x = 0;\n      grid.position.y = 0;\n      grid.position.z = -500;\n      grid.scale.x = size;\n      grid.scale.y = size;\n      grid.scale.z = size;\n\n      grid.rotation.x = THREE.MathUtils.DEG2RAD * 90;\n      grid.rotation.y = THREE.MathUtils.DEG2RAD * 0;\n      grid.rotation.z = THREE.MathUtils.DEG2RAD * 0;\n      grid.userData = merge({}, data.state.ui.grid, {\n        objectType: ObjectTypes.SceneBackgroundGrid,\n        name: `${ObjectTypes.SceneBackgroundGrid}${NAME_SEPARATOR}${data.state.ui.grid.id}`,\n      });\n\n      appThree.scene.add(grid);\n    }\n  });\n};\n\nexport const clearThreeScene = () => {\n  appThree.scene.clear();\n};\n\nexport const addLightFromUI = (\n  config: ThreeLightConfig,\n  scene: AppThreeScene\n) => {\n  if (config.type === \"THREE.DirectionalLight\") {\n    const light = new THREE.DirectionalLight(config.color, config.intensity);\n    light.position.set(\n      config.position?.x ?? 0,\n      config.position?.y ?? 0,\n      config.position?.z ?? 10\n    );\n    light.name = config.name;\n    light.userData = merge({}, light, {\n      objectType: ObjectTypes.SceneLight,\n      name: `${ObjectTypes.SceneLight}${NAME_SEPARATOR}${light.id}`,\n    });\n    scene.add(light);\n  }\n};\n\nexport const addGridFromUi = (config: ThreeGridHelperConfig) => {\n  const size = 100000;\n  const grid = new THREE.GridHelper(1, size / 10, \"#e9e9e9\", \"#eee\");\n  grid.position.x = 0;\n  grid.position.y = 0;\n  grid.position.z = -500;\n  grid.scale.x = size;\n  grid.scale.y = size;\n  grid.scale.z = size;\n\n  grid.rotation.x = THREE.MathUtils.DEG2RAD * 90;\n  grid.rotation.y = THREE.MathUtils.DEG2RAD * 0;\n  grid.rotation.z = THREE.MathUtils.DEG2RAD * 0;\n  grid.userData = merge({}, config, {\n    objectType: ObjectTypes.SceneBackgroundGrid,\n    name: `${ObjectTypes.SceneBackgroundGrid}${NAME_SEPARATOR}${config.id}`,\n  });\n  appThree.scene.add(grid);\n};\n\nexport const addObjectByObjectType = (object: AppObject) => {\n  const { objectType } = object;\n  if (objectType === ObjectTypes.Bead) {\n    triggerAddBeadToScene(object as any, appThree.scene);\n  }\n  if (objectType === ObjectTypes.Region) {\n    triggerRegionToScene(object as any);\n  }\n  if (objectType === ObjectTypes.Group) {\n    triggerGroupToScene(object as any);\n  }\n  if (objectType === ObjectTypes.PreviewProject3D) {\n    triggerPreviewProject3DToScene(object as any);\n  }\n};\n\nexport const updateObjectsProperty = (event: ChangeObjectsProperty) => {\n  // @TODO: update\n  // event.payload.change.forEach(obj => {\n  //   obj.id\n  // })\n};\n\nexport const getTopBarPosition = (\n  objects: { id: string; objectType: ObjectTypes }[]\n) => {\n  const bbox = new THREE.Box3();\n\n  objects.forEach((obj) => {\n    const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n    if (name === undefined) {\n      return;\n    }\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object === undefined) {\n      return;\n    }\n    bbox.expandByObject(object);\n  });\n\n  return getTopBarPositionInScreenFromObject(bbox);\n  // console.log('jaki mam bbox?', bbox.min, bbox.max)\n};\n\nexport const updateObjectPosition = (\n  objectId: string,\n  objectType: ObjectTypes,\n  positionX: number,\n  positionY: number\n) => {\n  const name = getStateObjectFromObjectId(objectId, objectType);\n  if (name === undefined) {\n    return;\n  }\n  const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  if (object === undefined) {\n    return;\n  }\n  object.position.x = positionX;\n  object.position.y = positionY;\n};\n\nexport const triggerSelectBead = (id: string, shouldSelect: boolean) => {\n  const name = getThreeNameFromBeadId(id);\n  const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n  if (object === undefined) {\n    return;\n  }\n\n  (object as any).traverse((child) => {\n    if (child instanceof THREE.Mesh) {\n      if (child.material) {\n        if (shouldSelect === true) {\n          (child.material as THREE.MeshPhysicalMaterial).emissive.set(0x171717);\n        } else {\n          (child.material as THREE.MeshPhysicalMaterial).emissive.set(0);\n        }\n      }\n    }\n  });\n  if (shouldSelect === true) {\n    const bbox = new THREE.Box3();\n\n    bbox.expandByObject(object as any);\n\n    const x = bbox.min.x;\n    const y = bbox.min.y;\n    const w = Math.abs(bbox.max.x - bbox.min.x);\n    const h = Math.abs(bbox.max.y - bbox.min.y);\n    const z = 1;\n\n    // const material = new THREE.LineBasicMaterial({\n    //   color: \"#5794fc\",\n    // });\n\n    const width = 1;\n    const height = 1;\n    const rectWidth = width - 0.0;\n    const rectHeight = height - 0.0;\n    const rectShape = new THREE.Shape()\n      .moveTo(rectWidth / 2, rectHeight / 2)\n      .lineTo((rectWidth / 2) * -1, rectHeight / 2)\n      .lineTo((rectWidth / 2) * -1, (rectHeight / 2) * -1)\n      .lineTo(rectWidth / 2, (rectHeight / 2) * -1);\n\n    rectShape.autoClose = true;\n\n    const _rectPoints = rectShape.getPoints();\n    const _rectGeometryPoints = new THREE.BufferGeometry().setFromPoints(\n      _rectPoints\n    );\n    const _lineMaterial = new THREE.MeshBasicMaterial({ color: 0x0040f0 });\n    const lines = new THREE.Line(_rectGeometryPoints, _lineMaterial);\n\n    // const geometry = new THREE.BufferGeometry().setFromPoints(points);\n\n    // const lines = new THREE.LineSegments(geometry, material);\n\n    // const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n    // const material = new THREE.MeshBasicMaterial({\n    //   color: \"#5794fc\",\n    //   side: THREE.FrontSide,\n    //   opacity: 0.99,\n    //   transparent: false,\n    // });\n    // const lines = new THREE.Mesh(geometry, material);\n    lines.userData = getThreeUserDataFromBead(\n      (object as any).userData,\n      BeadChildSuffix.SELECTION_CHILD\n    );\n\n    const rectangleFrame = new THREE.Group();\n    rectangleFrame.userData = getThreeUserDataFromBead(\n      (object as any).userData,\n      BeadChildSuffix.SELECTION\n    );\n    // rectangleFrame.scale.x = 1;\n    // rectangleFrame.scale.y = 1;\n    // rectangleFrame.scale.z = 1;\n    rectangleFrame.userData.position.x = x + w / 2;\n    rectangleFrame.userData.position.y = y + h / 2;\n    rectangleFrame.position.x = x + w / 2;\n    rectangleFrame.position.y = y + h / 2;\n    rectangleFrame.position.z = -460;\n    rectangleFrame.scale.x = w;\n    rectangleFrame.scale.y = h;\n    rectangleFrame.scale.z = z;\n    rectangleFrame.add(lines);\n    object.attach(rectangleFrame);\n  } else {\n    const name = getThreeNameFromBeadId(id, BeadChildSuffix.SELECTION);\n    const _object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (_object === undefined) {\n      return;\n    }\n    object.remove(_object);\n  }\n};\n\nexport const triggerRegionToScene = (region: Region) => {\n  const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  // @TODO: zmiana koloru i opacity\n  const material = new THREE.MeshBasicMaterial({\n    color: \"rgb(0,0,0)\",\n    side: THREE.FrontSide,\n    opacity: 0.1,\n    transparent: true,\n  });\n  const regionBgThree = new THREE.Mesh(geometry, material);\n  regionBgThree.userData = getThreeUserDataFromRegion(\n    region,\n    RegionChildSuffix.BG\n  );\n\n  const regionGridCellsThree = new THREE.Group();\n  regionGridCellsThree.userData = getThreeUserDataFromRegion(\n    region,\n    RegionChildSuffix.GRID_CELLS\n  );\n\n  times(region.rows).forEach((row, i) => {\n    times(region.columns).forEach((column, j) => {\n      const width = 1 / region.columns;\n      const height = 1 / region.rows;\n      const rectWidth = width - 0.0;\n      const rectHeight = height - 0.0;\n      const rectShape = new THREE.Shape()\n        .moveTo(rectWidth / 2, rectHeight / 2)\n        .lineTo((rectWidth / 2) * -1, rectHeight / 2)\n        .lineTo((rectWidth / 2) * -1, (rectHeight / 2) * -1)\n        .lineTo(rectWidth / 2, (rectHeight / 2) * -1);\n\n      rectShape.autoClose = true;\n\n      const _rectPoints = rectShape.getPoints();\n      const _rectGeometryPoints = new THREE.BufferGeometry().setFromPoints(\n        _rectPoints\n      );\n      const _lineMaterial = new THREE.MeshBasicMaterial({ color: 0x0040f0 });\n      const _cell = new THREE.Line(_rectGeometryPoints, _lineMaterial);\n      _cell.userData = getThreeUserDataFromRegion(\n        region,\n        RegionChildSuffix.GRID_CELL\n      );\n      _cell.position.x = -1 * 0.5 + column * width + width / 2;\n      _cell.position.y = -1 * 0.5 + row * height + height / 2;\n\n      regionGridCellsThree.add(_cell);\n    });\n  });\n\n  const regionThree = new THREE.Group();\n  regionThree.userData = getThreeUserDataFromRegion(\n    region,\n    RegionChildSuffix.MAIN\n  );\n  regionThree.position.x = region.position.x;\n  regionThree.position.y = region.position.y;\n  regionThree.position.z = -300;\n  regionThree.scale.x = region.width;\n  regionThree.scale.y = region.height;\n  regionThree.scale.z = 1;\n\n  regionThree.rotation.x = THREE.MathUtils.DEG2RAD * region.rotateX;\n  regionThree.rotation.y = THREE.MathUtils.DEG2RAD * region.rotateY;\n  regionThree.rotation.z = THREE.MathUtils.DEG2RAD * region.rotateZ;\n\n  regionThree.add(regionBgThree);\n  regionThree.add(regionGridCellsThree);\n\n  // regionThree.layers.set(2)\n  // regionThree.layers.enableAll();\n  appThree.scene.add(regionThree);\n\n  // @TODO: CHeck lines\n  // const material = new THREE.LineBasicMaterial({ color: 0x0000ff });\n  // material.linewidth = 10\n  // const points: THREE.Vector3[] = [];\n  // points.push(new THREE.Vector3(-10, 0, 0));\n  // points.push(new THREE.Vector3(0, 10, 0));\n  // points.push(new THREE.Vector3(10, 0, 0));\n  // const geometry = new THREE.BufferGeometry().setFromPoints(points);\n  // const line = new THREE.Line(geometry, material);\n  // appThree.scene.add(line)\n};\n\nexport const triggerAddBeadToScene = (bead: Bead, scene: AppThreeScene) => {\n  const beadType = bead.type;\n  //  const beadTHREEObject = new THREE.Group();\n  const beadModel = getModelFromBeadType(beadType);\n\n  if (beadModel === undefined) {\n    console.warn(\"beadModel not found for type: \", beadType, bead.id);\n    return;\n  }\n\n  const object = scene.getObjectByUserDataProperty(\"id\", bead.id);\n\n  if (object !== undefined) {\n    console.warn(\"bead already in scene\", bead.id);\n    return;\n  }\n\n  beadModel.traverse((child) => {\n    child.userData = getThreeUserDataFromBead(bead, BeadChildSuffix.ANY);\n    if (child instanceof THREE.Mesh) {\n      if (bead.material === BeadMaterialTypes.Mat) {\n        child.material = new THREE.MeshPhysicalMaterial({\n          reflectivity: 1,\n          color: bead.color,\n        });\n      } else if (bead.material === BeadMaterialTypes.Shiny) {\n        child.material = new THREE.MeshPhongMaterial({\n          color: bead.color,\n        });\n      } else {\n        console.warn(\"unknow BeadMaterialTypes:\", bead.material);\n      }\n\n      // child.material = new THREE.MeshLambertMaterial({\n      //   color: bead.color,\n      // });\n\n      // child.material = new THREE.MeshStandardMaterial({\n      //   color: bead.color,\n      //   metalness: 0,\n      //   roughness: 0.5,\n      // });\n\n      // child.material = new THREE.MeshDepthMaterial();\n\n      // child.material = new THREE.MeshPhysicalMaterial({\n      //   flatShading: true,\n      //   reflectivity: 1,\n      //   color: bead.color,\n      // });\n    }\n    // child.layers.set(2);\n    if ((child as any).geometry) {\n      (child as any).geometry.computeBoundingBox();\n    }\n  });\n\n  const bbox = getModelBBoxFromBeadType(beadType);\n  let width = 1;\n  let height = 1;\n  let depth = 1;\n  if (bbox) {\n    width = Math.abs(bbox.max.x - bbox.min.x);\n    height = Math.abs(bbox.max.y - bbox.min.y);\n    depth = Math.abs(bbox.max.z - bbox.min.z);\n  }\n\n  beadModel.scale.x = bead.width / width;\n  beadModel.scale.y = bead.height / height;\n  beadModel.scale.z = bead.depth / depth;\n\n  beadModel.rotation.x = THREE.MathUtils.DEG2RAD * bead.rotateX;\n  beadModel.rotation.y = THREE.MathUtils.DEG2RAD * bead.rotateY;\n  beadModel.rotation.z = THREE.MathUtils.DEG2RAD * bead.rotateZ;\n\n  beadModel.position.x = bead.position.x;\n  beadModel.position.y = bead.position.y;\n  beadModel.position.z = bead.position.z;\n\n  beadModel.userData = getThreeUserDataFromBead(bead);\n  // beadModel.layers.set(2);\n\n  // beadTHREEObject.add(beadModel);\n\n  scene.add(beadModel);\n  return beadModel;\n};\n\nexport const triggerGroupToScene = (group: Group) => {\n  const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  const material = new THREE.MeshBasicMaterial({\n    color: \"rgb(0,0,0)\",\n    side: THREE.FrontSide,\n    opacity: 0.2,\n    transparent: true,\n  });\n  const groupBgThree = new THREE.Mesh(geometry, material);\n  groupBgThree.userData = getThreeUserDataFromGroup(group, GroupChildSuffix.BG);\n\n  const groupThree = new THREE.Group();\n  groupThree.userData = getThreeUserDataFromGroup(group, GroupChildSuffix.MAIN);\n  groupThree.position.x = group.position.x;\n  groupThree.position.y = group.position.y;\n  groupThree.position.z = -400;\n  groupThree.scale.x = group.width;\n  groupThree.scale.y = group.height;\n  groupThree.scale.z = 1;\n\n  // groupThree.rotation.x = THREE.MathUtils.DEG2RAD * group.rotateX;\n  // groupThree.rotation.y = THREE.MathUtils.DEG2RAD * group.rotateY;\n  // groupThree.rotation.z = THREE.MathUtils.DEG2RAD * group.rotateZ;\n  groupThree.add(groupBgThree);\n\n  appThree.scene.add(groupThree);\n};\n\nexport const triggerPreviewProject3DToScene = (\n  previewProject3D: PreviewProject3D\n) => {\n  const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  const material = new THREE.MeshBasicMaterial({\n    color: \"rgb(0,0,0)\",\n    side: THREE.FrontSide,\n    opacity: 0.1,\n    transparent: true,\n  });\n  const groupBgThree = new THREE.Mesh(geometry, material);\n  groupBgThree.userData = getThreeUserDataFromPreviewProject3D(\n    previewProject3D,\n    PreviewProject3DChildSuffix.BG\n  );\n\n  const groupThree = new THREE.Group();\n  groupThree.userData = getThreeUserDataFromPreviewProject3D(\n    previewProject3D,\n    PreviewProject3DChildSuffix.MAIN\n  );\n  groupThree.position.x = previewProject3D.position.x;\n  groupThree.position.y = previewProject3D.position.y;\n  // groupThree.position.z = -500;\n  groupThree.scale.x = previewProject3D.width;\n  groupThree.scale.y = previewProject3D.height;\n  groupThree.scale.z = 1;\n\n  // groupThree.rotation.x = THREE.MathUtils.DEG2RAD * previewProject3D.rotateX;\n  // groupThree.rotation.y = THREE.MathUtils.DEG2RAD * previewProject3D.rotateY;\n  // groupThree.rotation.z = THREE.MathUtils.DEG2RAD * previewProject3D.rotateZ;\n\n  groupThree.add(groupBgThree);\n\n  appThree.scene.add(groupThree);\n};\n\nexport const triggerDeleteObjectIds = (\n  objects: { id: string; objectType: ObjectTypes }[]\n) => {\n  objects.forEach((obj) => {\n    const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n    if (name === undefined) {\n      console.warn(\n        \"triggerDeleteObjectIds:: name cant be created\",\n        obj.id,\n        obj.objectType\n      );\n      return;\n    }\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object === undefined) {\n      console.warn(\"triggerDeleteObjectIds:: object not found by name\", name);\n      return;\n    }\n\n    appThree.scene.remove(object);\n\n    const __object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n    if (__object !== undefined) {\n      console.warn(\n        \"triggerDeleteObjectIds:: try double - object found by name in scene \",\n        name\n      );\n    }\n  });\n};\n\nexport const triggerDeleteBeadIds = (beadIds: string[]) => {\n  beadIds.forEach((beadId) => {\n    while (true) {\n      const name = getThreeNameFromBeadId(beadId);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        break;\n      }\n      appThree.scene.remove(object);\n    }\n    while (true) {\n      const name = getThreeNameFromBeadId(beadId, BeadChildSuffix.ANY);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        break;\n      }\n      appThree.scene.remove(object);\n    }\n  });\n};\n\nexport const triggerUpdateEditBBox = (\n  editBBox: EditBBox | undefined,\n  prevEditBBox: EditBBox | undefined\n) => {\n  if (editBBox === undefined) {\n    if (prevEditBBox !== undefined) {\n      const name = getThreeNameFromEditBBoxId(prevEditBBox.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object !== undefined) {\n        appThree.scene.remove(object);\n      }\n\n      // const nameB = getThreeNameFromEditBBoxId(\n      //   prevEditBBox.id,\n      //   EditBBoxChildSuffix.RESIZE_CONTAINER\n      // );\n      // const objectB = appThree.scene.getObjectByUserDataProperty(\n      //   \"name\",\n      //   nameB\n      // );\n      // if (objectB !== undefined) {\n      //   appThree.scene.remove(objectB);\n      // }\n    }\n    return;\n  }\n\n  const rect10x10FromScreenToWorld =\n    appThree.camera.userData[\"rect10x10FromScreenToWorld\"];\n  const dotSize = (rect10x10FromScreenToWorld.w ?? 10) * 0.5;\n\n  if (prevEditBBox === undefined) {\n    const editBBoxThree = new THREE.Group();\n\n    const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n    const material = new THREE.MeshBasicMaterial({\n      color: \"#5794fc\",\n      side: THREE.FrontSide,\n      opacity: 0.1,\n      transparent: true,\n    });\n    const editBBoxBgThree = new THREE.Mesh(geometry, material);\n    editBBoxBgThree.userData = getThreeUserDataFromEditBBox(\n      editBBox,\n      EditBBoxChildSuffix.BG\n    );\n\n    const bbox = new THREE.Box3();\n\n    if (editBBox.selectedIds.length > 0) {\n      editBBox.selectedIds.forEach((obj) => {\n        const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n        const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n        if (object === undefined) {\n          return;\n        }\n        bbox.expandByObject(object);\n      });\n    }\n\n    // if (editBBox.beadIds.length > 0) {\n    //   editBBox.beadIds.forEach((beadId) => {\n    //     const name = getThreeNameFromBeadId(beadId);\n    //     const object = appThree.scene.getObjectByUserDataProperty(\n    //       \"name\",\n    //       name\n    //     );\n    //     if (object === undefined) {\n    //       return;\n    //     }\n    //     bbox.expandByObject(object);\n    //   });\n    // }\n\n    // if (editBBox.regionsIds.length > 0) {\n    //   editBBox.regionsIds.forEach((regionsId) => {\n    //     const name = getThreeNameFromRegionId(regionsId);\n    //     const object = appThree.scene.getObjectByUserDataProperty(\n    //       \"name\",\n    //       name\n    //     );\n    //     if (object === undefined) {\n    //       return;\n    //     }\n    //     bbox.expandByObject(object);\n    //   });\n    // }\n\n    const x = bbox.min.x;\n    const y = bbox.min.y;\n    const w = Math.abs(bbox.max.x - bbox.min.x);\n    const h = Math.abs(bbox.max.y - bbox.min.y);\n    const z = 1;\n\n    editBBoxThree.userData = getThreeUserDataFromEditBBox(editBBox);\n    editBBoxThree.userData.position.x = x + w / 2;\n    editBBoxThree.userData.position.y = y + h / 2;\n    editBBoxThree.position.x = x + w / 2;\n    editBBoxThree.position.y = y + h / 2;\n    editBBoxThree.position.z = -460;\n    editBBoxThree.scale.x = w;\n    editBBoxThree.scale.y = h;\n    editBBoxThree.scale.z = z;\n    editBBoxThree.add(editBBoxBgThree);\n\n    // const editBBoxResizeThree = new THREE.Group();\n    // editBBoxResizeThree.userData = getThreeUserDataFromEditBBox(\n    //   editBBox,\n    //   EditBBoxChildSuffix.RESIZE_CONTAINER\n    // );\n    // editBBoxResizeThree.scale.x = 1;\n    // editBBoxResizeThree.scale.y = 1;\n    // editBBoxResizeThree.scale.z = 1;\n    // const __material = new THREE.MeshLambertMaterial({ color: \"#ffffff\" });\n    // const __boxGeometry = new THREE.CircleGeometry(1, 16);\n    // const _whiteDot = new THREE.Mesh(__boxGeometry, __material);\n    // _whiteDot.scale.x = 0.8;\n    // _whiteDot.scale.y = 0.8;\n    // _whiteDot.renderOrder = 2;\n\n    // const ___material = new THREE.MeshLambertMaterial({ color: \"#a9a9a9\" });\n    // const ___boxGeometry = new THREE.CircleGeometry(1, 16);\n    // const _grayDot = new THREE.Mesh(___boxGeometry, ___material);\n    // _grayDot.scale.x = 1;\n    // _grayDot.scale.y = 1;\n    // _grayDot.renderOrder = 1;\n\n    // const _baseDot = new THREE.Group();\n    // _baseDot.attach(_grayDot);\n    // _baseDot.attach(_whiteDot);\n\n    // const _dotTL = _baseDot.clone();\n    // _dotTL.position.x = bbox.min.x;\n    // _dotTL.position.y = bbox.max.y;\n    // _dotTL.scale.x = dotSize;\n    // _dotTL.scale.y = dotSize;\n    // _dotTL.userData = getThreeUserDataFromEditBBox(\n    //   editBBox,\n    //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n    // );\n    // editBBoxResizeThree.attach(_dotTL);\n\n    // const _dotTR = _baseDot.clone();\n    // _dotTR.position.x = bbox.max.x;\n    // _dotTR.position.y = bbox.max.y;\n    // _dotTR.scale.x = dotSize;\n    // _dotTR.scale.y = dotSize;\n    // _dotTR.userData = getThreeUserDataFromEditBBox(\n    //   editBBox,\n    //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n    // );\n    // editBBoxResizeThree.attach(_dotTR);\n\n    // const _dotBL = _baseDot.clone();\n    // _dotBL.position.x = bbox.min.x;\n    // _dotBL.position.y = bbox.min.y;\n    // _dotBL.scale.x = dotSize;\n    // _dotBL.scale.y = dotSize;\n    // _dotBL.userData = getThreeUserDataFromEditBBox(\n    //   editBBox,\n    //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n    // );\n    // editBBoxResizeThree.attach(_dotBL);\n\n    // const _dotBR = _baseDot.clone();\n    // _dotBR.position.x = bbox.max.x;\n    // _dotBR.position.y = bbox.min.y;\n    // _dotBR.scale.x = dotSize;\n    // _dotBR.scale.y = dotSize;\n    // _dotBL.userData = getThreeUserDataFromEditBBox(\n    //   editBBox,\n    //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n    // );\n    // editBBoxResizeThree.attach(_dotBR);\n\n    // appThree.scene.add(editBBoxResizeThree);\n    appThree.scene.add(editBBoxThree);\n  } else {\n    const name = getThreeNameFromEditBBoxId(prevEditBBox.id);\n    const editBBoxThree = appThree.scene.getObjectByUserDataProperty(\n      \"name\",\n      name\n    );\n\n    if (editBBoxThree === undefined) {\n      return;\n    }\n\n    const bbox = new THREE.Box3();\n\n    if (editBBox.selectedIds.length > 0) {\n      editBBox.selectedIds.forEach((obj) => {\n        const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n        const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n        if (object === undefined) {\n          return;\n        }\n\n        bbox.expandByObject(object);\n\n        const isGroup = obj.objectType === ObjectTypes.Group;\n        const isInGroup = obj.groupId !== undefined && obj.groupId.length > 0;\n        if (isGroup || isInGroup) {\n          console.log(\"robie bbox dla grupy..\", obj.id, obj.groupId);\n        }\n      });\n    }\n\n    // if (editBBox.beadIds.length > 0) {\n    //   editBBox.beadIds.forEach((beadId) => {\n    //     const name = getThreeNameFromBeadId(beadId);\n    //     const object = appThree.scene.getObjectByUserDataProperty(\n    //       \"name\",\n    //       name\n    //     );\n    //     if (object === undefined) {\n    //       return;\n    //     }\n    //     bbox.expandByObject(object);\n    //   });\n    // }\n\n    // if (editBBox.regionsIds.length > 0) {\n    //   editBBox.regionsIds.forEach((regionsId) => {\n    //     const name = getThreeNameFromRegionId(regionsId);\n    //     const object = appThree.scene.getObjectByUserDataProperty(\n    //       \"name\",\n    //       name\n    //     );\n    //     if (object === undefined) {\n    //       return;\n    //     }\n    //     bbox.expandByObject(object);\n    //   });\n    // }\n\n    const x = bbox.min.x;\n    const y = bbox.min.y;\n    const w = Math.abs(bbox.max.x - bbox.min.x);\n    const h = Math.abs(bbox.max.y - bbox.min.y);\n\n    console.log(\"jaki jest bbxo?\", bbox, x, y, w, h);\n\n    editBBoxThree.userData.position.x = x + w / 2;\n    editBBoxThree.userData.position.y = y + h / 2;\n    editBBoxThree.position.x = x + w / 2;\n    editBBoxThree.position.y = y + h / 2;\n    // editBBoxThree.position.z = 200;\n    editBBoxThree.scale.x = w;\n    editBBoxThree.scale.y = h;\n    editBBoxThree.scale.z = 1;\n\n    // const nameTL = getThreeNameFromEditBBoxId(\n    //   editBBox.id,\n    //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n    // );\n    // const _dotTL = appThree.scene.getObjectByUserDataProperty(\"name\", nameTL);\n    // if (_dotTL !== undefined) {\n    //   _dotTL.position.x = bbox.min.x;\n    //   _dotTL.position.y = bbox.max.y;\n    //   _dotTL.scale.x = dotSize;\n    //   _dotTL.scale.y = dotSize;\n    // }\n    // const nameTR = getThreeNameFromEditBBoxId(\n    //   editBBox.id,\n    //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n    // );\n    // const _dotTR = appThree.scene.getObjectByUserDataProperty(\"name\", nameTR);\n    // if (_dotTR !== undefined) {\n    //   _dotTR.position.x = bbox.max.x;\n    //   _dotTR.position.y = bbox.max.y;\n    //   _dotTR.scale.x = dotSize;\n    //   _dotTR.scale.y = dotSize;\n    // }\n    // const nameBL = getThreeNameFromEditBBoxId(\n    //   editBBox.id,\n    //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n    // );\n    // const _dotBL = appThree.scene.getObjectByUserDataProperty(\"name\", nameBL);\n    // if (_dotBL !== undefined) {\n    //   _dotBL.position.x = bbox.min.x;\n    //   _dotBL.position.y = bbox.min.y;\n    //   _dotBL.scale.x = dotSize;\n    //   _dotBL.scale.y = dotSize;\n    // }\n    // const nameBR = getThreeNameFromEditBBoxId(\n    //   editBBox.id,\n    //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n    // );\n    // const _dotBR = appThree.scene.getObjectByUserDataProperty(\"name\", nameBR);\n    // if (_dotBR !== undefined) {\n    //   _dotBR.position.x = bbox.max.x;\n    //   _dotBR.position.y = bbox.min.y;\n    //   _dotBR.scale.x = dotSize;\n    //   _dotBR.scale.y = dotSize;\n    // }\n  }\n};\n\nexport const triggerSelectRegion = (id: string, shouldSelect: boolean) => {\n  const name = getThreeNameFromRegionId(id);\n  const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n  if (object === undefined) {\n    console.warn(\"triggerSelectRegion: object not found by name\", name);\n    return;\n  }\n\n  if (shouldSelect === true) {\n    // if (appThree.additionalData.selectedBBox !== undefined) {\n    //   return;\n    // }\n    console.log(\"dodaj kropki\");\n\n    const bbox = new THREE.Box3();\n    bbox.expandByObject(object);\n    // console.log('jaki bbox?', bbox);\n    const resizeGroup = getResizeDots(bbox);\n    resizeGroup.forEach((obj) => {\n      appThree.scene.attach(obj);\n    });\n\n    appThree.additionalData.selectedBBox = {\n      topLeft: {\n        x: bbox.min.x,\n        y: bbox.max.y,\n        z: 0,\n      },\n      topRight: {\n        x: bbox.max.x,\n        y: bbox.max.y,\n        z: 0,\n      },\n      bottomLeft: {\n        x: bbox.min.x,\n        y: bbox.min.y,\n        z: 0,\n      },\n      bottomRight: {\n        x: bbox.max.x,\n        y: bbox.min.y,\n        z: 0,\n      },\n    };\n\n    // object.attach(resizeGroup)\n  } else {\n    console.log(\"usun kropki\");\n    for (let i = appThree.scene.children.length - 1; i >= 0; i--) {\n      if (appThree.scene.children[i].layers.mask === 4) {\n        appThree.scene.remove(appThree.scene.children[i]);\n      }\n    }\n\n    appThree.additionalData.selectedBBox = undefined;\n  }\n};\n\nconst getResizeDots = (bbox: THREE.Box3) => {\n  // const rect10x10FromScreenToWorld =\n  //   appThree.camera.userData[\"rect10x10FromScreenToWorld\"];\n  const sceneScale = appThree.camera.userData[\"sceneScale\"];\n  const dotSize = sceneScale; //(rect10x10FromScreenToWorld.w ?? 10) * 0.5;\n  const layerN = 2;\n\n  const objects: THREE.Object3D[] = [];\n\n  // const resizeGroup = new THREE.Group();\n\n  // editBBoxResizeThree.userData = getThreeUserDataFromEditBBox(\n  //   editBBox,\n  //   EditBBoxChildSuffix.RESIZE_CONTAINER\n  // );\n  // resizeGroup.scale.x = 1;\n  // resizeGroup.scale.y = 1;\n  // resizeGroup.scale.z = 1;\n  // resizeGroup.layers.set(layerN);\n\n  const __material = new THREE.MeshLambertMaterial({ color: \"#ffffff\" });\n  const __boxGeometry = new THREE.CircleGeometry(1, 16);\n  const _whiteDot = new THREE.Mesh(__boxGeometry, __material);\n  _whiteDot.scale.x = 10;\n  _whiteDot.scale.y = 10;\n  _whiteDot.renderOrder = 2;\n  _whiteDot.layers.set(layerN);\n\n  const ___material = new THREE.MeshLambertMaterial({ color: \"#a9a9a9\" });\n  const ___boxGeometry = new THREE.CircleGeometry(1, 16);\n  const _grayDot = new THREE.Mesh(___boxGeometry, ___material);\n  _grayDot.scale.x = 12;\n  _grayDot.scale.y = 12;\n  _grayDot.renderOrder = 1;\n  _grayDot.layers.set(layerN);\n\n  const _baseDot = new THREE.Group();\n  _baseDot.attach(_grayDot);\n  _baseDot.attach(_whiteDot);\n\n  const _dotTL = _baseDot.clone();\n  _dotTL.position.x = bbox.min.x;\n  _dotTL.position.y = bbox.max.y;\n  _dotTL.scale.x = dotSize;\n  _dotTL.scale.y = dotSize;\n  _dotTL.layers.set(layerN);\n  _dotTL.userData = {\n    name: \"topLeft\",\n  };\n  // _dotTL.userData = getThreeUserDataFromEditBBox(\n  //   editBBox,\n  //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n  // );\n  objects.push(_dotTL);\n\n  const _dotTR = _baseDot.clone();\n  _dotTR.position.x = bbox.max.x;\n  _dotTR.position.y = bbox.max.y;\n  _dotTR.scale.x = dotSize;\n  _dotTR.scale.y = dotSize;\n  _dotTR.layers.set(layerN);\n  _dotTR.userData = {\n    name: \"topRight\",\n  };\n  // _dotTR.userData = getThreeUserDataFromEditBBox(\n  //   editBBox,\n  //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n  // );\n  objects.push(_dotTR);\n\n  const _dotBL = _baseDot.clone();\n  _dotBL.position.x = bbox.min.x;\n  _dotBL.position.y = bbox.min.y;\n  _dotBL.scale.x = dotSize;\n  _dotBL.scale.y = dotSize;\n  _dotBL.layers.set(layerN);\n  _dotBL.userData = {\n    name: \"bottomLeft\",\n  };\n  // _dotBL.userData = getThreeUserDataFromEditBBox(\n  //   editBBox,\n  //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n  // );\n  objects.push(_dotBL);\n\n  const _dotBR = _baseDot.clone();\n  _dotBR.position.x = bbox.max.x;\n  _dotBR.position.y = bbox.min.y;\n  _dotBR.scale.x = dotSize;\n  _dotBR.scale.y = dotSize;\n  _dotBR.layers.set(layerN);\n  _dotBR.userData = {\n    name: \"bottomRight\",\n  };\n  objects.push(_dotBR);\n  // _dotBL.userData = getThreeUserDataFromEditBBox(\n  //   editBBox,\n  //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n  // );\n  // resizeGroup.attach(_dotBR);\n\n  return objects;\n};\n","import { AppEvents } from \"../AppEventType\";\nimport { Store } from \"../store\";\nimport { AppHistory } from \"../AppHistory\";\nimport produce from \"immer\";\nimport { getTopBarPosition } from \"../../threejs/eventEmitterHandlers\";\nimport { getMousePositionAtWindow } from \"../../threejs/mouseListeners/mouseScreenPosition\";\nimport { appThree } from \"../../threejs/renderThreejs\";\n\nexport class BaseEventHandler<T extends AppEvents> {\n  store: Store;\n  event: T;\n  history: AppHistory;\n  saveToHistory: boolean;\n  constructor(\n    event: T,\n    store: Store,\n    history: AppHistory,\n    saveToHistory: boolean\n  ) {\n    this.store = store;\n    this.history = history;\n    this.event = event;\n    this.saveToHistory = saveToHistory;\n  }\n\n  getNewStoreWithTopBarPosition(store: Store) {\n    return produce(store, (draft) => {\n      const position = getTopBarPosition(\n        store.selectedIds.map((id) => {\n          return { id, objectType: store.objects[id].objectType };\n        })\n      );\n      draft.ui.selectedTopBarPosition = position;\n    });\n  }\n\n  getCenterPosition() {\n    const { width, height, top, left } = appThree.el.getBoundingClientRect();\n    const posX = left + width / 2;\n    const posY = top + height / 2;\n    return { posX, posY };\n  }\n\n  getMousePosition() {\n    let posX = 0;\n    let posY = 0;\n    const pos = getMousePositionAtWindow();\n    if (pos === undefined) {\n      const center = this.getCenterPosition();\n      posX = center.posX;\n      posY = center.posY;\n    } else {\n      posX = pos.x;\n      posY = pos.y;\n    }\n    return { posX, posY };\n  }\n\n  getStoreWithHistory(_store?: Store) {\n    const store = _store === undefined ? this.store : _store;\n    return produce(store, (draft) => {\n      draft.history.canRedo = this.history.canRedo();\n      draft.history.canUndo = this.history.canUndo();\n      draft.history.events = this.history.getSimpleHistoryEvents();\n    });\n  }\n}\n","import { produce } from \"immer\";\nimport * as THREE from \"three\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport {\n  AppObject,\n  Bead,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n  Region,\n} from \"../../editorObjects/Editor\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { buildPreviewProject3D } from \"../../editorObjects/PreviewProject3D\";\nimport { buildRegion } from \"../../editorObjects/Region\";\nimport {\n  getTopBarPosition,\n  triggerSelectBead,\n  triggerSelectRegion,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { screenToWorld } from \"../../threejs/mouseListeners/screenToWorld\";\nimport { AppEvents } from \"../AppEventType\";\nimport { BaseEventHandler } from \"./BaseEventHandler\";\n\nexport class StoreObjectHandler<\n  T extends AppEvents\n> extends BaseEventHandler<T> {\n  getAppObjectFromCloneAppObject(object: Partial<AppObject>) {\n    if (object.objectType === undefined) {\n      console.warn(\"object type not found in payload: \", object);\n      return undefined;\n    }\n    if (object.objectType === ObjectTypes.Bead) {\n      return buildBead(object);\n    }\n    if (object.objectType === ObjectTypes.Region) {\n      return buildRegion(object);\n    }\n    if (object.objectType === ObjectTypes.Group) {\n      return buildGroup(object);\n    }\n    if (object.objectType === ObjectTypes.PreviewProject3D) {\n      return buildPreviewProject3D(object);\n    }\n    console.warn(\"unknow object type from payload: \", object);\n    return undefined;\n  }\n  selectObjectOnThreeScene(object: AppObject, isSelected: boolean) {\n    if (object === undefined) {\n      return;\n    }\n    if (object.objectType === ObjectTypes.Bead) {\n      triggerSelectBead(object.id, isSelected);\n    }\n    if (object.objectType === ObjectTypes.Region) {\n      triggerSelectRegion(object.id, isSelected);\n    }\n  }\n\n  deleteSelectedObjectsFromStore(ids: string[], objects: AppObject[]) {\n    return produce(this.store, (draft) => {\n      ids.forEach((id) => {\n        const object = this.store.objects[id];\n        if (draft.selectedIds.includes(id)) {\n          const index = draft.selectedIds.indexOf(id);\n          draft.selectedIds.splice(index, 1);\n          this.selectObjectOnThreeScene(object, false);\n        }\n\n        if (draft.objects[object.id] !== undefined) {\n          objects.push(object);\n          if (object.objectType === ObjectTypes.Region) {\n            (object as Region).childrenGridIds.forEach((_beadId) => {\n              if (_beadId !== undefined) {\n                (draft.objects[_beadId] as Bead).regionId = undefined;\n              }\n            });\n          }\n          delete draft.objects[object.id];\n        }\n      });\n\n      draft.ui.selectedTopBarPosition = getTopBarPosition(\n        draft.selectedIds.map((id) => {\n          return { id, objectType: draft.objects[id].objectType };\n        })\n      );\n    });\n  }\n\n  getPositionDiffFromMousePosition(objects: AppObject[]) {\n    const { posX, posY } = this.getMousePosition();\n    const worldPos = screenToWorld(posX, posY);\n    const bbox = new THREE.Box3();\n    objects.forEach((object) => {\n      const w = object.width / 2;\n      const h = object.height / 2;\n      const x = object.position.x;\n      const y = object.position.y;\n      bbox.expandByPoint(new THREE.Vector3().set(x - w, y - h, 0.1));\n      bbox.expandByPoint(new THREE.Vector3().set(x + w, y - h, 0.2));\n      bbox.expandByPoint(new THREE.Vector3().set(x - w, y + h, 0.1));\n      bbox.expandByPoint(new THREE.Vector3().set(x + w, y + h, 0.1));\n    });\n    const bboxCenter = new THREE.Vector3();\n    bbox.getCenter(bboxCenter);\n    const diffX = worldPos.x - bboxCenter.x;\n    const diffY = worldPos.y - bboxCenter.y;\n    return {\n      diffX,\n      diffY,\n    };\n  }\n\n  moveObjectsByDiff(objects: AppObject[], diffX: number, diffY: number) {\n    objects.forEach((object) => {\n      if (object.objectType === ObjectTypes.Group) {\n        object.position.x = object.position.x + diffX;\n        object.position.y = object.position.y + diffY;\n        objects.forEach((obj) => {\n          if ((object as Group).childrenIds.includes(obj.id)) {\n            obj.position.x = obj.position.x + diffX;\n            obj.position.y = obj.position.y + diffY;\n          }\n        });\n      } else {\n        if (object[groupIdKey] === undefined) {\n          object.position.x = object.position.x + diffX;\n          object.position.y = object.position.y + diffY;\n        }\n      }\n    });\n  }\n}\n","import produce from \"immer\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { AddObjects, AppEventType } from \"../AppEventType\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { setStore } from \"../store\";\nimport { AddObjectsHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  AppObject,\n  Bead,\n  ObjectTypes,\n  Region,\n} from \"../../editorObjects/Editor\";\nimport { buildRegion } from \"../../editorObjects/Region\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { buildPreviewProject3D } from \"../../editorObjects/PreviewProject3D\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class AddObjectHandler extends StoreObjectHandler<AddObjects> {\n  run() {\n    const objects: AppObject[] = [];\n    let newStore = produce(this.store, (draft) => {\n      this.event.payload.objects.forEach((object) => {\n        let newObject = this.getAppObjectFromCloneAppObject(object);\n        if (newObject == undefined) {\n          return;\n        }\n        if (newObject.objectType === ObjectTypes.Region) {\n          (newObject as Region).childrenGridIds.forEach((_beadId) => {\n            if (_beadId !== undefined) {\n              (draft.objects[_beadId] as Bead).regionId = newObject!.id;\n            }\n          });\n        }\n        draft.objects[newObject.id] = newObject;\n        objects.push(newObject);\n      });\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: AddObjectsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.AddObjects,\n          payload: { objects: objects },\n        },\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: { ids: objects.map((b) => b.id) },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    setStore(newStore);\n\n    objects.forEach((obj) => {\n      addObjectByObjectType(obj);\n    });\n\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { AppObject, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { AppEventType, RemoveObjects } from \"../AppEventType\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { setStore } from \"../store\";\nimport { RemoveObjectsHistory } from \"../AppHistory\";\nimport {\n  getTopBarPosition,\n  triggerDeleteObjectIds,\n  triggerSelectBead,\n  triggerSelectRegion,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class RemoveObjectHandler extends StoreObjectHandler<RemoveObjects> {\n  run() {\n    const { ids } = this.event.payload;\n    const objects: AppObject[] = [];\n    let newStore = this.deleteSelectedObjectsFromStore(ids, objects);\n    \n    if (this.saveToHistory) {\n      const historyEvent: RemoveObjectsHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.AddObjects,\n          payload: { objects },\n        },\n        createdAt: dayjs().toISOString()\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    setStore(newStore);\n    \n    triggerDeleteObjectIds(\n      objects.map((obj) => {\n        return { id: obj.id, objectType: obj.objectType };\n      })\n    );\n\n    refreshReactState(newStore);\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { ChangeSelectObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { appThree } from \"../../threejs/renderThreejs\";\n\nexport class ChangeSelectObjectsHandler extends StoreObjectHandler<ChangeSelectObjects> {\n  run() {\n    const { change } = this.event.payload;\n\n    const historyChange: { id: string; isSelected: boolean }[] = [];\n    let newStore = produce(this.store, (draft) => {\n      change.forEach((obj) => {\n        if (draft.objects[obj.id] === undefined) {\n          console.warn(\"no object found in store\", obj.id);\n          return;\n        }\n        if (draft.selectedIds.includes(obj.id) === true) {\n          if (obj.isSelected === true) {\n            // do nothing\n          } else {\n            draft.selectedIds.splice(draft.selectedIds.indexOf(obj.id), 1);\n          }\n        } else {\n          if (obj.isSelected === true) {\n            draft.selectedIds.push(obj.id);\n          } else {\n            // nothing\n          }\n        }\n        historyChange.push({\n          id: obj.id,\n          isSelected: obj.isSelected,\n        });\n      });\n    });\n    // setStore(newStore);\n\n    // @INFO: Remove later\n    // if (this.saveToHistory) {\n    //   const historyEvent: ChangeSelectObjectsHistory = {\n    //     do: this.event,\n    //     redo: this.event,\n    //     undo: {\n    //       name: AppEventType.ChangeSelectObjects,\n    //       payload: { change: historyChange },\n    //     },\n    //   };\n    //   this.history.push(historyEvent);\n    // }\n    // appThree.additionalData.selectedBBox = undefined;\n\n    historyChange.forEach((change) => {\n      const object = newStore.objects[change.id];\n      if (object === undefined) {\n        return;\n      }\n      this.selectObjectOnThreeScene(object, change.isSelected);\n    });\n    // refreshReactState(newStore);\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport {\n  addObjectByObjectType,\n  triggerDeleteObjectIds,\n  updateObjectPosition,\n} from \"../../threejs/eventEmitterHandlers\";\nimport {\n  ChangeObjectsProperty,\n  AppEventType,\n  ChangeObject,\n} from \"../AppEventType\";\nimport { ChangeObjectsPropertyHistory } from \"../AppHistory\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore, Store } from \"../store\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport {\n  AppObject,\n  Bead,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n  Point,\n  Region,\n} from \"../../editorObjects/Editor\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { WritableDraft } from \"immer/dist/internal\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport THREE from \"three\";\nimport { contain } from \"../../editorObjects/Point\";\n\ntype ObjectsMap = { [key: string]: AppObject };\n\nexport class ChangeObjectsPropertyHandler extends StoreObjectHandler<ChangeObjectsProperty> {\n  run() {\n    const added: AppObject[] = [];\n    const updated: ObjectsMap = {};\n    const removed: AppObject[] = [];\n    const { changes } = this.event.payload;\n    const historyChanges: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n    let newStore = produce(this.store, (draft) => {\n      changes.forEach((_singleChange) => {\n        if (draft.objects[_singleChange.id] === undefined) {\n          console.warn(\"no object found in store\", _singleChange.id);\n          return;\n        }\n        const singleHistoryChange: ChangeObject = {\n          id: _singleChange.id,\n          properties: {},\n          relatedChanges: [],\n          relatedCreateBeads: [],\n          relatedDeleteIds: [],\n        };\n        const keyNames = Object.keys(_singleChange.properties);\n        if (singleHistoryChange !== undefined) {\n          keyNames.forEach((key) => {\n            singleHistoryChange.properties[key] = cloneDeep(\n              draft.objects[_singleChange.id][key]\n            );\n          });\n        }\n        keyNames.forEach((key) => {\n          draft.objects[_singleChange.id][key] = cloneDeep(\n            _singleChange.properties[key]\n          );\n        });\n\n        if (_singleChange.relatedChanges) {\n          _singleChange.relatedChanges.forEach((_singeRelatedChange) => {\n            if (draft.objects[_singeRelatedChange.id] === undefined) {\n              console.warn(\"no object found in store\", _singeRelatedChange.id);\n              return;\n            }\n            const keyNames = Object.keys(_singeRelatedChange.properties);\n            keyNames.forEach((key) => {\n              draft.objects[_singeRelatedChange.id][key] = cloneDeep(\n                _singeRelatedChange.properties[key]\n              );\n            });\n          });\n        }\n\n        historyChanges.push(singleHistoryChange);\n      });\n\n      changes.forEach((_singleChange, index) => {\n        if (draft.objects[_singleChange.id] === undefined) {\n          console.warn(\"no object found in store\", _singleChange.id);\n          return;\n        }\n        const objectType = draft.objects[_singleChange.id].objectType;\n        const singleHistoryChange = historyChanges[index];\n\n        if (objectType === ObjectTypes.Bead) {\n          this.whenBead(\n            _singleChange,\n            draft,\n            singleHistoryChange,\n            added,\n            updated,\n            removed\n          );\n        }\n\n        if (objectType === ObjectTypes.Region) {\n          this.whenRegion(\n            _singleChange,\n            draft,\n            singleHistoryChange,\n            added,\n            updated,\n            removed\n          );\n        }\n      });\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: ChangeObjectsPropertyHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.ChangeObjectsProperty,\n          payload: {\n            changes: this.event.payload.changes.map(\n              ({ id, properties, relatedChanges }) => {\n                const index = historyChanges.findIndex((e) => e.id === id);\n                const relatedCreateBeads =\n                  index !== -1 ? historyChanges[index].relatedCreateBeads : [];\n\n                const relatedDeleteIds =\n                  index !== -1 ? historyChanges[index].relatedDeleteIds : [];\n\n                return {\n                  id,\n                  properties,\n                  relatedChanges,\n                  relatedCreateBeads,\n                  relatedDeleteIds,\n                };\n              }\n            ),\n          },\n        },\n        undo: {\n          name: AppEventType.ChangeObjectsProperty,\n          payload: { changes: historyChanges },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n\n    newStore = this.getStoreWithHistory(newStore);\n\n    // @INFO: CHANGES IN THREEJS\n    changes.forEach((_singleChange) => {\n      this.applyChangesToThree(_singleChange, newStore);\n      notifyBackend([\n        {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: newStore.objects[_singleChange.id],\n        },\n      ]);\n\n      if (_singleChange.relatedChanges) {\n        _singleChange.relatedChanges.forEach((_singeRelatedChange) => {\n          this.applyChangesToThree(_singeRelatedChange, newStore);\n          notifyBackend([\n            {\n              action: SaveEventType.UPDATE,\n              createdAt: new Date().toISOString(),\n              object: newStore.objects[_singeRelatedChange.id],\n            },\n          ]);\n        });\n      }\n    });\n\n    if (added.length > 0) {\n      added.forEach((obj) => {\n        addObjectByObjectType(obj);\n      });\n\n      notifyBackend(\n        added.map((object) => {\n          return {\n            action: SaveEventType.CREATE,\n            createdAt: new Date().toISOString(),\n            object,\n          };\n        })\n      );\n    }\n\n    const updatedKeys = Object.keys(updated);\n    if (updatedKeys.length > 0) {\n      triggerDeleteObjectIds(\n        updatedKeys.map((id) => {\n          return {\n            id,\n            objectType: newStore.objects[id].objectType,\n          };\n        })\n      );\n\n      updatedKeys.map((id) => {\n        addObjectByObjectType(newStore.objects[id]);\n      });\n\n      notifyBackend(\n        updatedKeys.map((id) => {\n          return {\n            action: SaveEventType.UPDATE,\n            createdAt: new Date().toISOString(),\n            object: newStore.objects[id],\n          };\n        })\n      );\n    }\n\n    if (removed.length > 0) {\n      triggerDeleteObjectIds(\n        removed.map((obj) => {\n          return { id: obj.id, objectType: obj.objectType };\n        })\n      );\n      notifyBackend(\n        removed.map((object) => {\n          return {\n            action: SaveEventType.DELETE,\n            createdAt: new Date().toISOString(),\n            object,\n          };\n        })\n      );\n    }\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n\n  applyChangesToThree(_singleChange: ChangeObject, _store: Store) {\n    if (_store.objects[_singleChange.id] === undefined) {\n      console.warn(\"no object found in store\", _singleChange.id);\n      return;\n    }\n    const object = _store.objects[_singleChange.id];\n    const inGroup =\n      object[groupIdKey] !== undefined && object[groupIdKey].length > 0;\n\n    const positionKey: keyof AppObject = \"position\";\n    // const objectType = _store.objects[_singleChange.id].objectType;\n    const keyNames = Object.keys(_singleChange.properties);\n    const isPositionOnly =\n      keyNames.length === 1 && keyNames.includes(positionKey) === true;\n    if (isPositionOnly && inGroup === false) {\n      updateObjectPosition(\n        _singleChange.id,\n        object.objectType,\n        object.position.x,\n        object.position.y\n      );\n    }\n    // else if (objectType === ObjectTypes.Region) {\n    // const isShapeOnly =\n    // keyNames.length === 1 && keyNames.includes(\"shape\") === true;\n    // }\n    else {\n      triggerDeleteObjectIds([\n        {\n          id: _singleChange.id,\n          objectType: object.objectType,\n        },\n      ]);\n\n      addObjectByObjectType(object);\n\n      if (inGroup) {\n        if (\n          object[groupIdKey] !== undefined &&\n          _store.objects[object[groupIdKey]]\n        ) {\n          (_store.objects[object[groupIdKey]] as Group).childrenIds.forEach(\n            (id) => {\n              const obj = _store.objects[id];\n              triggerDeleteObjectIds([\n                {\n                  id: id,\n                  objectType: obj.objectType,\n                },\n              ]);\n              addObjectByObjectType(obj);\n            }\n          );\n        }\n      }\n    }\n  }\n\n  whenBead(\n    _singleChange: ChangeObject,\n    draft: WritableDraft<Store>,\n    singleHistoryChange: ChangeObject,\n    added: AppObject[],\n    updated: ObjectsMap,\n    removed: AppObject[]\n  ) {\n    const positionKey: keyof AppObject = \"position\";\n    const regionIdKey: keyof Bead = \"regionId\";\n    const childrenGridIdsKey: keyof Region = \"childrenGridIds\";\n    const keyNames = Object.keys(_singleChange.properties);\n\n    if (keyNames.includes(positionKey)) {\n      let isBeadFoundRegion = false;\n      const bead = draft.objects[_singleChange.id] as Bead;\n      const regionId = (draft.objects[_singleChange.id] as Bead).regionId;\n\n      if (regionId !== undefined) {\n        const region = draft.objects[regionId] as Region;\n        const regionTopLeftX = region.position.x - region.width / 2;\n        const regionTopLeftY = region.position.y - region.height / 2;\n\n        const containBead = contain(\n          {\n            x: regionTopLeftX,\n            y: regionTopLeftY,\n            z: 0,\n          },\n          {\n            x: region.position.x + region.width / 2,\n            y: region.position.y + region.height / 2,\n            z: 0,\n          },\n          {\n            x: bead.position.x,\n            y: bead.position.y,\n            z: 0,\n          }\n        );\n\n        if (containBead === true) {\n          const cellW = region.width / region.columns;\n          const cellH = region.height / region.rows;\n          const columnIndex = Math.floor(\n            (bead.position.x - regionTopLeftX) / cellW\n          );\n          const rowIndex = Math.floor(\n            (bead.position.y - regionTopLeftY) / cellH\n          );\n          const newIndex = rowIndex * region.columns + columnIndex;\n\n          const oldIndex = region.childrenGridIds.indexOf(bead.id);\n          if (oldIndex !== -1 && oldIndex !== newIndex) {\n            draft.objects[regionId][childrenGridIdsKey][oldIndex] = undefined;\n          }\n          draft.objects[regionId][childrenGridIdsKey][newIndex] = bead.id;\n          isBeadFoundRegion = true;\n          if (region.snapBeadsToCell === true) {\n            const cellW = region.width / region.columns;\n            const cellH = region.height / region.rows;\n            const offsetX = columnIndex * cellW;\n            const offsetY = rowIndex * cellH;\n            const startX = region.position.x - region.width / 2;\n            const startY = region.position.y - region.height / 2;\n            const posX = startX + offsetX + cellW / 2;\n            const posY = startY + offsetY + cellH / 2;\n            draft.objects[bead.id].position.x = posX;\n            draft.objects[bead.id].position.y = posY;\n          }\n        }\n      }\n\n      if (isBeadFoundRegion === false) {\n        Object.keys(draft.objects).forEach((regionId) => {\n          if (draft.objects[regionId].objectType !== ObjectTypes.Region) {\n            return;\n          }\n          const region = draft.objects[regionId] as Region;\n          const regionTopLeftX = region.position.x - region.width / 2;\n          const regionTopLeftY = region.position.y - region.height / 2;\n\n          const containBead = contain(\n            {\n              x: regionTopLeftX,\n              y: regionTopLeftY,\n              z: 0,\n            },\n            {\n              x: region.position.x + region.width / 2,\n              y: region.position.y + region.height / 2,\n              z: 0,\n            },\n            {\n              x: bead.position.x,\n              y: bead.position.y,\n              z: 0,\n            }\n          );\n\n          if (containBead === false) {\n            return;\n          }\n\n          const cellW = region.width / region.columns;\n          const cellH = region.height / region.rows;\n          const columnIndex = Math.floor(\n            (bead.position.x - regionTopLeftX) / cellW\n          );\n          const rowIndex = Math.floor(\n            (bead.position.y - regionTopLeftY) / cellH\n          );\n\n          const newIndex = rowIndex * region.columns + columnIndex;\n\n          if (region.childrenGridIds[newIndex] === undefined) {\n            const currentIndex = region.childrenGridIds.indexOf(bead.id);\n            if (currentIndex !== -1 && currentIndex !== newIndex) {\n              draft.objects[regionId][childrenGridIdsKey][\n                currentIndex\n              ] = undefined;\n            }\n            draft.objects[regionId][childrenGridIdsKey][newIndex] = bead.id;\n\n            updated[regionId] = cloneDeep(draft.objects[regionId]);\n\n            if (draft.objects[bead.id][regionIdKey] !== undefined) {\n              const oldRegionId = draft.objects[bead.id][regionIdKey];\n              const oldRegion = draft.objects[oldRegionId] as Region;\n              const currentIndex = oldRegion.childrenGridIds.indexOf(bead.id);\n              if (currentIndex !== -1) {\n                draft.objects[oldRegionId][childrenGridIdsKey][\n                  currentIndex\n                ] = undefined;\n                updated[oldRegionId] = cloneDeep(draft.objects[oldRegionId]);\n              }\n            }\n\n            draft.objects[bead.id][regionIdKey] = region.id;\n            isBeadFoundRegion = true;\n\n            if (region.snapBeadsToCell === true) {\n              const cellW = region.width / region.columns;\n              const cellH = region.height / region.rows;\n              const offsetX = columnIndex * cellW;\n              const offsetY = rowIndex * cellH;\n              const startX = region.position.x - region.width / 2;\n              const startY = region.position.y - region.height / 2;\n              const posX = startX + offsetX + cellW / 2;\n              const posY = startY + offsetY + cellH / 2;\n              draft.objects[bead.id].position.x = posX;\n              draft.objects[bead.id].position.y = posY;\n            }\n          } else if (region.childrenGridIds[newIndex] === bead.id) {\n            if (region.snapBeadsToCell === true) {\n              const cellW = region.width / region.columns;\n              const cellH = region.height / region.rows;\n              const offsetX = columnIndex * cellW;\n              const offsetY = rowIndex * cellH;\n              const startX = region.position.x - region.width / 2;\n              const startY = region.position.y - region.height / 2;\n              const posX = startX + offsetX + cellW / 2;\n              const posY = startY + offsetY + cellH / 2;\n              draft.objects[bead.id].position.x = posX;\n              draft.objects[bead.id].position.y = posY;\n              isBeadFoundRegion = true;\n            }\n          }\n        });\n      }\n\n      if (isBeadFoundRegion === false) {\n        if (regionId !== undefined) {\n          const region = draft.objects[regionId] as Region;\n          const currentIndex = region.childrenGridIds.indexOf(bead.id);\n          if (currentIndex !== -1) {\n            draft.objects[regionId][childrenGridIdsKey][\n              currentIndex\n            ] = undefined;\n\n            updated[regionId] = cloneDeep(draft.objects[regionId]);\n          }\n\n          (draft.objects[_singleChange.id] as Bead).regionId = undefined;\n        }\n      }\n    }\n  }\n\n  whenRegion(\n    _singleChange: ChangeObject,\n    draft: WritableDraft<Store>,\n    singleHistoryChange: ChangeObject,\n    added: AppObject[],\n    updated: ObjectsMap,\n    removed: AppObject[]\n  ) {\n    const keyNames = Object.keys(_singleChange.properties);\n    const shapeKey: keyof Region = \"shape\";\n    const autoFillBeadsKey: keyof Region = \"autoFillBeads\";\n    const snapBeadsToCellKey: keyof Region = \"snapBeadsToCell\";\n    const rowsKey: keyof Region = \"rows\";\n    const columnsKey: keyof Region = \"columns\";\n    const positionKey: keyof Region = \"position\";\n\n    if (\n      _singleChange.relatedCreateBeads !== undefined &&\n      _singleChange.relatedCreateBeads.length > 0\n    ) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const relatedCreateBeadsIds: string[] = [];\n\n      _singleChange.relatedCreateBeads.forEach((bead) => {\n        if (draft.objects[bead.id] === undefined) {\n          console.warn(\"bead not found\", bead.id);\n          return;\n        }\n\n        relatedCreateBeadsIds.push(bead.id);\n\n        removed.push(cloneDeep(bead));\n\n        delete draft.objects[bead.id];\n      });\n\n      region.childrenGridIds.forEach((id, index) => {\n        if (id !== undefined && relatedCreateBeadsIds.includes(id)) {\n          (draft.objects[region.id] as Region).childrenGridIds[\n            index\n          ] = undefined;\n        }\n      });\n    }\n\n    if (keyNames.includes(rowsKey) || keyNames.includes(columnsKey)) {\n      const oldRows = singleHistoryChange.properties[rowsKey];\n      const oldColumns = singleHistoryChange.properties[columnsKey];\n      const region = draft.objects[_singleChange.id] as Region;\n      const newRows = region.rows;\n      const newColumns = region.columns;\n      const newSize = region.rows * region.columns;\n      const oldSize = region.childrenGridIds.length;\n      const newChildrenGridIds = Array(newSize).fill(undefined);\n      const autoFillBeadsEnabled = region[autoFillBeadsKey] === true;\n\n      const toDeleteBeadIds: string[] = [];\n      for (let i = 0; i < region.childrenGridIds.length; i++) {\n        const oldIndex = i;\n        const oldCurrentRow = Math.floor(i / oldColumns);\n        const oldCurrentCol = Math.floor(i % oldColumns);\n\n        let newIndex: number = oldCurrentCol + oldCurrentRow * newColumns;\n\n        if (oldCurrentCol >= newColumns || oldCurrentRow >= newRows) {\n          newIndex = newSize;\n\n          if (autoFillBeadsEnabled) {\n            const beadId = region.childrenGridIds[oldIndex];\n            if (beadId !== undefined && draft.objects[beadId] !== undefined) {\n              toDeleteBeadIds.push(beadId);\n              singleHistoryChange.relatedDeleteIds!.push(beadId);\n            }\n          }\n        }\n\n        if (newIndex < newSize) {\n          newChildrenGridIds[newIndex] = region.childrenGridIds[oldIndex];\n        }\n      }\n\n      toDeleteBeadIds.forEach((beadId) => {\n        if (draft.objects[beadId] === undefined) {\n          console.warn(\"bead not found\", beadId);\n          return;\n        }\n\n        removed.push(cloneDeep(draft.objects[beadId]));\n        delete draft.objects[beadId];\n      });\n\n      (draft.objects[region.id] as Region).childrenGridIds = newChildrenGridIds;\n    }\n\n    if (keyNames.includes(shapeKey)) {\n      // let fistObjectId: string | undefined = undefined;\n      // Object.keys(draft.objects).forEach((id) => {\n      //   if (draft.objects[id].objectType === ObjectTypes.Bead) {\n      //     fistObjectId = id;\n      //     return false;\n      //   }\n      // });\n      // if (fistObjectId) {\n      // singleHistoryChange.relatedChanges = [\n      //   {\n      //     id: fistObjectId,\n      //     properties: {\n      //       position: {\n      //         x: -10,\n      //         y: -10,\n      //       },\n      //     },\n      //   },\n      // ];\n      // }\n      // zmiana snap dla zaleznych beadsow\n      // zmiany w singleHistoryChange.relatedChanges\n    }\n\n    if (\n      keyNames.includes(positionKey) ||\n      keyNames.includes(snapBeadsToCellKey)\n    ) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const snapBeadsToCellEnabled = region[snapBeadsToCellKey] === true;\n      // const autoFillBeadsEnabled = region[autoFillBeadsKey] === true;\n      if (snapBeadsToCellEnabled) {\n        region.childrenGridIds.forEach((id, index) => {\n          if (id !== undefined) {\n            const currentRow = Math.floor(index / region.columns);\n            const currentCol = Math.floor(index % region.columns);\n            const cellW = region.width / region.columns;\n            const cellH = region.height / region.rows;\n            const offsetX = currentCol * cellW;\n            const offsetY = currentRow * cellH;\n            const startX = region.position.x - region.width / 2;\n            const startY = region.position.y - region.height / 2;\n            const posX = startX + offsetX + cellW / 2;\n            const posY = startY + offsetY + cellH / 2;\n            const oldPosition = cloneDeep(draft.objects[id].position);\n            draft.objects[id].position.x = posX;\n            draft.objects[id].position.y = posY;\n\n            updated[id] = cloneDeep(draft.objects[id]);\n\n            singleHistoryChange.relatedChanges?.push({\n              id,\n              properties: {\n                position: {\n                  x: oldPosition.x,\n                  y: oldPosition.y,\n                  z: oldPosition.z,\n                },\n              },\n            });\n          } else {\n            const region = draft.objects[_singleChange.id] as Region;\n            const size = region.rows * region.columns;\n\n            let foundObject = false;\n            Object.keys(draft.objects).forEach((id) => {\n              if (foundObject === true) {\n                return;\n              }\n              if (draft.objects[id].objectType !== ObjectTypes.Bead) {\n                return;\n              }\n\n              const bead = draft.objects[id] as Bead;\n\n              if (bead.groupId !== undefined) {\n                return;\n              }\n\n              if (bead.regionId !== undefined) {\n                return;\n              }\n\n              const currentRow = Math.floor(index / region.columns);\n              const currentCol = Math.floor(index % region.columns);\n              const cellW = region.width / region.columns;\n              const cellH = region.height / region.rows;\n              const regionTopLeftX = region.position.x - region.width / 2;\n              const regionTopLeftY = region.position.y - region.height / 2;\n\n              const containBead = contain(\n                {\n                  x: regionTopLeftX + currentCol * cellW,\n                  y: regionTopLeftY + currentRow * cellH,\n                  z: 0,\n                },\n                {\n                  x: regionTopLeftX + currentCol * cellW + cellW,\n                  y: regionTopLeftY + currentRow * cellH + cellH,\n                  z: 0,\n                },\n                {\n                  x: bead.position.x,\n                  y: bead.position.y,\n                  z: 0,\n                }\n              );\n\n              if (containBead === false) {\n                return;\n              }\n\n              (draft.objects[_singleChange.id] as Region).childrenGridIds[\n                index\n              ] = bead.id;\n              (draft.objects[bead.id] as Bead).regionId = region.id;\n\n              const offsetX = currentCol * cellW;\n              const offsetY = currentRow * cellH;\n              const startX = region.position.x - region.width / 2;\n              const startY = region.position.y - region.height / 2;\n              const posX = startX + offsetX + cellW / 2;\n              const posY = startY + offsetY + cellH / 2;\n              const oldPosition = cloneDeep(draft.objects[bead.id].position);\n\n              draft.objects[bead.id].position.x = posX;\n              draft.objects[bead.id].position.y = posY;\n\n              singleHistoryChange.relatedChanges?.push({\n                id: bead.id,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                  regionId: undefined,\n                },\n              });\n\n              updated[bead.id] = cloneDeep(draft.objects[bead.id]);\n              foundObject = true;\n            });\n\n            // updated.push(cloneDeep(draft.objects[region.id]));\n          }\n        });\n      } else {\n        const region = draft.objects[_singleChange.id] as Region;\n        const size = region.rows * region.columns;\n        const newChildrenGridIds = Array(size).fill(undefined);\n        let emptyCount = size;\n        const keys = Object.keys(draft.objects);\n        for (let i = 0; i < keys.length; i++) {\n          if (emptyCount <= 0) {\n            break;\n          }\n\n          const id = keys[i];\n\n          if (draft.objects[id].objectType !== ObjectTypes.Bead) {\n            continue;\n          }\n\n          const bead = draft.objects[id] as Bead;\n\n          if (bead.groupId !== undefined) {\n            continue;\n          }\n\n          if (bead.regionId !== region.id) {\n            continue;\n          }\n\n          const regionTopLeftX = region.position.x - region.width / 2;\n          const regionTopLeftY = region.position.y - region.height / 2;\n\n          const containBead = contain(\n            {\n              x: regionTopLeftX,\n              y: regionTopLeftY,\n              z: 0,\n            },\n            {\n              x: region.position.x + region.width / 2,\n              y: region.position.y + region.height / 2,\n              z: 0,\n            },\n            {\n              x: bead.position.x,\n              y: bead.position.y,\n              z: 0,\n            }\n          );\n\n          if (containBead === false) {\n            continue;\n          }\n\n          const cellW = region.width / region.columns;\n          const cellH = region.height / region.rows;\n          const columnIndex = Math.floor(\n            (bead.position.x - regionTopLeftX) / cellW\n          );\n          const rowIndex = Math.floor(\n            (bead.position.y - regionTopLeftY) / cellH\n          );\n\n          const newIndex = rowIndex * region.columns + columnIndex;\n\n          if (newChildrenGridIds[newIndex] === undefined) {\n            newChildrenGridIds[newIndex] = bead.id;\n            emptyCount = emptyCount - 1;\n          }\n        }\n\n        (draft.objects[_singleChange.id] as Region).childrenGridIds.forEach(\n          (beadId) => {\n            if (beadId !== undefined && draft.objects[beadId] !== undefined) {\n              if (newChildrenGridIds.includes(beadId) === false) {\n                singleHistoryChange.relatedChanges?.push({\n                  id: beadId,\n                  properties: {\n                    regionId: (draft.objects[beadId] as Bead).regionId,\n                  },\n                });\n              }\n\n              (draft.objects[beadId] as Bead).regionId = undefined;\n\n              updated[beadId] = cloneDeep(draft.objects[beadId]);\n            }\n          }\n        );\n\n        newChildrenGridIds.forEach((beadId) => {\n          if (beadId !== undefined) {\n            if ((draft.objects[beadId] as Bead).regionId === undefined) {\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  regionId: undefined,\n                },\n              });\n            }\n            (draft.objects[beadId] as Bead).regionId = region.id;\n\n            updated[beadId] = cloneDeep(draft.objects[beadId]);\n          }\n        });\n\n        (draft.objects[_singleChange.id] as Region).childrenGridIds = cloneDeep(\n          newChildrenGridIds\n        );\n      }\n    }\n\n    if (\n      keyNames.includes(autoFillBeadsKey) ||\n      keyNames.includes(rowsKey) ||\n      keyNames.includes(columnsKey) ||\n      keyNames.includes(positionKey)\n    ) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const autoFillBeadsEnabled = region[autoFillBeadsKey] === true;\n      const snapBeadsToCellEnabled = region[snapBeadsToCellKey] === true;\n      const size = region.rows * region.columns;\n      if (region.childrenGridIds.length !== size) {\n        console.warn(\n          \"region childrenIds size have not correct value\",\n          size,\n          region.childrenGridIds.length,\n          region.childrenGridIds\n        );\n        return;\n      }\n\n      if (autoFillBeadsEnabled) {\n        let nextIdIndex = 0;\n\n        region.childrenGridIds.forEach((id, index) => {\n          // @TODO: obecnie nie jest uwzgledniony rotate dla regionu.\n\n          if (id === undefined) {\n            const currentRow = Math.floor(index / region.columns);\n            const currentCol = Math.floor(index % region.columns);\n            const cellW = region.width / region.columns;\n            const cellH = region.height / region.rows;\n            const offsetX = currentCol * cellW;\n            const offsetY = currentRow * cellH;\n            const _id =\n              _singleChange.relatedCreateBeads?.[nextIdIndex]?.id ?? undefined;\n            if (\n              _singleChange.relatedCreateBeads !== undefined &&\n              _id === undefined\n            ) {\n              console.warn(\"id for bead is missing..\");\n            }\n            const bead = buildBead({\n              id: _id,\n              color: \"red\",\n              regionId: region.id,\n            });\n            nextIdIndex += 1;\n\n            const startX = region.position.x - region.width / 2;\n            const startY = region.position.y - region.height / 2;\n\n            bead.position.x = startX + offsetX + cellW / 2;\n            bead.position.y = startY + offsetY + cellH / 2;\n\n            draft.objects[bead.id] = bead;\n\n            region.childrenGridIds[index] = bead.id;\n\n            added.push(cloneDeep(bead));\n            singleHistoryChange.relatedCreateBeads!.push(cloneDeep(bead));\n          } else {\n            const currentRow = Math.floor(index / region.columns);\n            const currentCol = Math.floor(index % region.columns);\n            const cellW = region.width / region.columns;\n            const cellH = region.height / region.rows;\n            const offsetX = currentCol * cellW;\n            const offsetY = currentRow * cellH;\n            const startX = region.position.x - region.width / 2;\n            const startY = region.position.y - region.height / 2;\n            const posX = startX + offsetX + cellW / 2;\n            const posY = startY + offsetY + cellH / 2;\n            const oldPosition = cloneDeep(draft.objects[id].position);\n            draft.objects[id].position.x = posX;\n            draft.objects[id].position.y = posY;\n            updated[id] = cloneDeep(draft.objects[id]);\n            singleHistoryChange.relatedChanges?.push({\n              id,\n              properties: {\n                position: {\n                  x: oldPosition.x,\n                  y: oldPosition.y,\n                  z: oldPosition.z,\n                },\n              },\n            });\n          }\n        });\n      } else {\n        if (snapBeadsToCellEnabled) {\n          region.childrenGridIds.forEach((beadId, index) => {\n            if (beadId !== undefined) {\n              const currentRow = Math.floor(index / region.columns);\n              const currentCol = Math.floor(index % region.columns);\n              const cellW = region.width / region.columns;\n              const cellH = region.height / region.rows;\n              const offsetX = currentCol * cellW;\n              const offsetY = currentRow * cellH;\n              const startX = region.position.x - region.width / 2;\n              const startY = region.position.y - region.height / 2;\n              const posX = startX + offsetX + cellW / 2;\n              const posY = startY + offsetY + cellH / 2;\n              const oldPosition = cloneDeep(draft.objects[beadId].position);\n              draft.objects[beadId].position.x = posX;\n              draft.objects[beadId].position.y = posY;\n\n              updated[beadId] = cloneDeep(draft.objects[beadId]);\n\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                },\n              });\n            } else {\n              const region = draft.objects[_singleChange.id] as Region;\n\n              let foundObject = false;\n              Object.keys(draft.objects).forEach((id) => {\n                if (foundObject === true) {\n                  return;\n                }\n                if (draft.objects[id].objectType !== ObjectTypes.Bead) {\n                  return;\n                }\n\n                const bead = draft.objects[id] as Bead;\n\n                if (bead.groupId !== undefined) {\n                  return;\n                }\n\n                if (bead.regionId !== undefined) {\n                  return;\n                }\n\n                const currentRow = Math.floor(index / region.columns);\n                const currentCol = Math.floor(index % region.columns);\n                const cellW = region.width / region.columns;\n                const cellH = region.height / region.rows;\n                const regionTopLeftX = region.position.x - region.width / 2;\n                const regionTopLeftY = region.position.y - region.height / 2;\n\n                const containBead = contain(\n                  {\n                    x: regionTopLeftX + currentCol * cellW,\n                    y: regionTopLeftY + currentRow * cellH,\n                    z: 0,\n                  },\n                  {\n                    x: regionTopLeftX + currentCol * cellW + cellW,\n                    y: regionTopLeftY + currentRow * cellH + cellH,\n                    z: 0,\n                  },\n                  {\n                    x: bead.position.x,\n                    y: bead.position.y,\n                    z: 0,\n                  }\n                );\n\n                if (containBead === false) {\n                  return;\n                }\n\n                (draft.objects[_singleChange.id] as Region).childrenGridIds[\n                  index\n                ] = bead.id;\n                (draft.objects[bead.id] as Bead).regionId = region.id;\n\n                const offsetX = currentCol * cellW;\n                const offsetY = currentRow * cellH;\n                const startX = region.position.x - region.width / 2;\n                const startY = region.position.y - region.height / 2;\n                const posX = startX + offsetX + cellW / 2;\n                const posY = startY + offsetY + cellH / 2;\n                const oldPosition = cloneDeep(draft.objects[bead.id].position);\n\n                draft.objects[bead.id].position.x = posX;\n                draft.objects[bead.id].position.y = posY;\n\n                singleHistoryChange.relatedChanges?.push({\n                  id: bead.id,\n                  properties: {\n                    position: {\n                      x: oldPosition.x,\n                      y: oldPosition.y,\n                      z: oldPosition.z,\n                    },\n                    regionId: undefined,\n                  },\n                });\n\n                updated[bead.id] = cloneDeep(draft.objects[bead.id]);\n                foundObject = true;\n              });\n\n              // updated.push(cloneDeep(draft.objects[region.id]));\n            }\n          });\n        }\n      }\n    }\n  }\n}\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport { ChangeUiSettings } from \"../AppEventType\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\n\nexport class ChangeUiSettingsHandler extends BaseEventHandler<ChangeUiSettings> {\n  run() {\n    const { uiSettings } = this.event.payload;\n    let newStore = produce(this.store, (draft) => {\n      Object.keys(uiSettings).forEach((keyName) => {\n        draft.ui[keyName] = cloneDeep(uiSettings[keyName]);\n      });\n    });\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import { ClipboardCopy } from \"../AppEventType\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { setClipboardBoardContent } from \"../../threejs/clipboard\";\nimport { cloneDeep } from \"lodash\";\n\nexport class ClipboardCopyHandler extends BaseEventHandler<ClipboardCopy> {\n  run() {\n\n    const objects = this.store.selectedIds.map((id) => {\n      return cloneDeep(this.store.objects[id]);\n    });\n    setClipboardBoardContent({\n      objects,\n    });\n  }\n}\n\n\n","import { AppEventType, ClipboardCut } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { ClipboardCutHistory } from \"../AppHistory\";\nimport { triggerDeleteObjectIds } from \"../../threejs/eventEmitterHandlers\";\nimport { AppObject } from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setClipboardBoardContent } from \"../../threejs/clipboard\";\nimport { cloneDeep } from \"lodash\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class ClipboardCutHandler extends StoreObjectHandler<ClipboardCut> {\n  run() {\n    const ids: string[] = [];\n    const objects: AppObject[] = [];\n    const clonedObjects = this.store.selectedIds.map((id) => {\n      ids.push(id);\n      return cloneDeep(this.store.objects[id]);\n    });\n    setClipboardBoardContent({\n      objects: clonedObjects,\n    });\n    let newStore = this.deleteSelectedObjectsFromStore(ids, objects);\n\n    if (this.saveToHistory) {\n      const historyEvent: ClipboardCutHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.ClipboardPaste,\n          payload: {\n            objects: clonedObjects,\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    setStore(newStore);\n\n    triggerDeleteObjectIds(\n      objects.map((obj) => {\n        return { id: obj.id, objectType: obj.objectType };\n      })\n    );\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { AppEventType, ClipboardPaste } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { ClipboardPasteHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  AppObject,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n} from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { cloneDeep } from \"lodash\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\n/**\n * SUPER POWER!!!\n */\nexport class ClipboardPasteHandler extends StoreObjectHandler<ClipboardPaste> {\n  run() {\n    const mapIds = {};\n    const objects: AppObject[] = [];\n    this.event.payload.objects.forEach((obj) => {\n      if (!obj.id) {\n        return;\n      }\n      const oldId = obj.id;\n      const clone = cloneDeep(obj);\n      delete (clone as any).id;\n      let newObject = this.getAppObjectFromCloneAppObject(clone);\n      if (newObject == undefined) {\n        return;\n      }\n      mapIds[oldId] = newObject.id;\n      objects.push(newObject);\n    });\n    const { diffX, diffY } = this.getPositionDiffFromMousePosition(objects);\n    this.moveObjectsByDiff(objects, diffX, diffY);\n    objects.forEach((object) => {\n      if (object.objectType === ObjectTypes.Group) {\n        const newChildrenIds: string[] = [];\n        (object as Group).childrenIds.forEach((id) => {\n          newChildrenIds.push(mapIds[id]);\n        });\n        (object as Group).childrenIds = newChildrenIds;\n      }\n      if (object[groupIdKey] !== undefined) {\n        object[groupIdKey] = mapIds[object[groupIdKey]];\n      }\n    });\n    this.store.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(this.store.objects[id], false);\n    });\n    let newStore = produce(this.store, (draft) => {\n      draft.selectedIds = [];\n      objects.forEach((object) => {\n        draft.objects[object.id] = object;\n        draft.selectedIds.push(object.id);\n      });\n    });\n    objects.forEach((object) => {\n      addObjectByObjectType(object);\n      this.selectObjectOnThreeScene(object, true);\n    });\n    if (this.saveToHistory) {\n      const historyEvent: ClipboardPasteHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: {\n            ids: objects.map((object) => {\n              return object.id;\n            }),\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { AddMultipleBeads, AppEventType } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { AddMultipleBeadsHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport { AppObject } from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { cloneDeep, times } from \"lodash\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class AddMultipleBeadsHandler extends StoreObjectHandler<AddMultipleBeads> {\n  run() {\n    const objects: AppObject[] = [];\n    if (this.event.payload.figure === \"rectangle\") {\n      const defaultBead = buildBead({});\n      const beadMargin = 2;\n      times(this.event.payload.rows).forEach((row) => {\n        times(this.event.payload.columns).forEach((col) => {\n          const x = ((defaultBead.width ?? 1) + beadMargin) * row;\n          const y = ((defaultBead.height ?? 1) + beadMargin) * col * -1;\n          const bead = buildBead({\n            position: {\n              x,\n              y,\n            },\n          });\n          objects.push(bead);\n        });\n      });\n    } else {\n      console.warn(\"figure not found in event payload\");\n    }\n\n    const { diffX, diffY } = this.getPositionDiffFromMousePosition(objects);\n    this.moveObjectsByDiff(objects, diffX, diffY);\n\n    let newStore = produce(this.store, (draft) => {\n      objects.forEach((object) => {\n        draft.objects[object.id] = object;\n        draft.selectedIds.push(object.id);\n      });\n    });\n\n    this.store.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(this.store.objects[id], false);\n    });\n    objects.forEach((object) => {\n      addObjectByObjectType(object);\n      this.selectObjectOnThreeScene(object, true);\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: AddMultipleBeadsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.AddObjects,\n          payload: {\n            objects: cloneDeep(objects),\n          },\n        },\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: { ids: objects.map((object) => object.id) },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { ChangeUiSettingsZoom } from \"../AppEventType\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { getRect10x10FromScreenToWorld } from \"../../threejs/mouseListeners/getRect10x10FromScreenToWorld\";\nimport { appThree } from \"../../threejs/renderThreejs\";\n\nexport class ChangeUiSettingsZoomHandler extends BaseEventHandler<ChangeUiSettingsZoom> {\n  run() {\n    const { zoomType } = this.event.payload;\n    const screenCenter = this.getCenterPosition();\n\n    if (zoomType === \"zoomByScroll\") {\n      let { scrollDelta, clientX, clientY } = this.event.payload;\n      if (!clientX) {\n        clientX = screenCenter.posX;\n      }\n      if (!clientY) {\n        clientY = screenCenter.posY;\n      }\n      if (!scrollDelta) {\n        scrollDelta = 1;\n      }\n      const { top, left } = appThree.el.getBoundingClientRect();\n      const screenX = clientX - left;\n      const screenY = clientY - top;\n      const scrollSign = Math.sign(scrollDelta);\n      this.updateByScroll(screenX, screenY, scrollSign);\n    } else if (zoomType === \"zoomInScreenCenter\") {\n      this.updateByScroll(screenCenter.posX, screenCenter.posY, -1);\n    } else if (zoomType === \"zoomOutScreenCenter\") {\n      this.updateByScroll(screenCenter.posX, screenCenter.posY, 1);\n    }\n  }\n\n  updateByScroll(screenX: number, screenY: number, scrollSign: number) {\n    const { width, height } = appThree.el.getBoundingClientRect();\n    const cameraX = appThree.camera.position.x;\n    const cameraY = appThree.camera.position.y;\n\n    const mouseXInWorldBefore = (screenX - width / 2) * this.store.ui.zoomScale;\n    const mouseYInWorldBefore =\n      -1 * (screenY - height / 2) * this.store.ui.zoomScale;\n\n    const zoomChange = this.store.ui.zoomScale >= 0.35 ? 0.02 * 5 : 0.01;\n    const zoomMax = 100;\n    const zoomMin = 0.0125;\n    let sceneScale = 1;\n    sceneScale = this.store.ui.zoomScale + scrollSign * zoomChange;\n    sceneScale = Math.min(Math.max(zoomMin, sceneScale), zoomMax);\n\n    const mouseXInWorldAfter = (screenX - width / 2) * sceneScale;\n    const mouseYInWorldAfter = -1 * (screenY - height / 2) * sceneScale;\n\n    appThree.camera.left = (width * sceneScale) / -2;\n    appThree.camera.right = (width * sceneScale) / 2;\n    appThree.camera.top = (height * sceneScale) / 2;\n    appThree.camera.bottom = (height * sceneScale) / -2;\n    appThree.camera.updateProjectionMatrix();\n\n    const diffX = mouseXInWorldBefore - mouseXInWorldAfter;\n    const diffY = mouseYInWorldBefore - mouseYInWorldAfter;\n\n    appThree.camera.position.x = cameraX + diffX;\n    appThree.camera.position.y = cameraY + diffY;\n    appThree.camera.lookAt(\n      appThree.camera.position.x,\n      appThree.camera.position.y,\n      0\n    );\n\n    const rect10x10FromScreenToWorld = getRect10x10FromScreenToWorld();\n    appThree.camera.userData = { sceneScale, rect10x10FromScreenToWorld };\n\n    let newStore = produce(this.store, (draft) => {\n      draft.ui.zoomScale = sceneScale;\n    });\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    appThree.scene.children.forEach((child) => {\n      if (child.layers.mask === 4) {\n        child.scale.x = sceneScale;\n        child.scale.y = sceneScale;\n        child.scale.z = sceneScale;\n      }\n    });\n  }\n}\n","import produce from \"immer\";\nimport { ChangeUiSettingsSidebar, ChangeUiSettingsZoom } from \"../AppEventType\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\n\nexport class ChangeUiSettingsSidebarHandler extends BaseEventHandler<ChangeUiSettingsSidebar> {\n  run() {\n    const { panel, open, toggle } = this.event.payload;\n    let newStore = produce(this.store, (draft) => {\n      let newOpen = open;\n\n      if (panel === \"objects\") {\n        if (\n          toggle !== undefined &&\n          toggle === true &&\n          draft.ui.rightSidebar.panel === \"objects\"\n        ) {\n          newOpen = !draft.ui.rightSidebar.isOpen;\n        }\n        draft.ui.rightSidebar.isOpen = newOpen;\n        draft.ui.rightSidebar.panel = newOpen === false ? undefined : \"objects\";\n      }\n      if (panel === \"history\") {\n        if (\n          toggle !== undefined &&\n          toggle === true &&\n          draft.ui.rightSidebar.panel === \"history\"\n        ) {\n          newOpen = !draft.ui.rightSidebar.isOpen;\n        }\n        draft.ui.rightSidebar.isOpen = newOpen;\n        draft.ui.rightSidebar.panel = newOpen === false ? undefined : \"history\";\n      }\n\n      if (panel === \"comments\") {\n        if (\n          toggle !== undefined &&\n          toggle === true &&\n          draft.ui.leftSidebar.panel === \"comments\"\n        ) {\n          newOpen = !draft.ui.leftSidebar.isOpen;\n        }\n        draft.ui.leftSidebar.isOpen = newOpen;\n        draft.ui.leftSidebar.panel = newOpen === false ? undefined : \"comments\";\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport { updateObjectPosition } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  ChangeObjectsProperty,\n  AppEventType,\n  ChangeObject,\n  ChangeSelectedObjectsAlignment,\n  SnapToLineType,\n} from \"../AppEventType\";\nimport { ChangeSelectedObjectsAlignmentHistory } from \"../AppHistory\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class ChangeObjectsAlignmentHandler extends StoreObjectHandler<ChangeSelectedObjectsAlignment> {\n  run() {\n    const { snapType, selectedIds } = this.event.payload;\n    const updates: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n    const historyChanges: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n\n    let newStore = produce(this.store, (draft) => {\n      let maxX: number | undefined = undefined;\n      let minX: number | undefined = undefined;\n      let maxY: number | undefined = undefined;\n      let minY: number | undefined = undefined;\n\n      selectedIds.forEach((_id) => {\n        if (draft.objects[_id] === undefined) {\n          console.warn(\"no object found in store\", _id);\n          return;\n        }\n        const pos = draft.objects[_id].position;\n        const w = draft.objects[_id].width;\n        const h = draft.objects[_id].height;\n\n        if (minX === undefined) {\n          minX = pos.x;\n        } else if (pos.x < minX) {\n          minX = pos.x;\n        }\n\n        if (maxX === undefined) {\n          maxX = pos.x;\n        } else if (pos.x > maxX) {\n          maxX = pos.x;\n        }\n\n        if (minY === undefined) {\n          minY = pos.y;\n        } else if (pos.y < minY) {\n          minY = pos.y;\n        }\n\n        if (maxY === undefined) {\n          maxY = pos.y;\n        } else if (pos.y > maxY) {\n          maxY = pos.y;\n        }\n      });\n\n      if (snapType === SnapToLineType.X_MIN) {\n        if (minX !== undefined) {\n          const newPos = minX;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.x = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.X_MIDDLE) {\n        if (minX !== undefined && maxX !== undefined) {\n          const newPos = minX + (maxX - minX) / 2;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.x = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.X_MAX) {\n        if (maxX !== undefined) {\n          const newPos = maxX;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.x = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.Y_MIN) {\n        if (minY !== undefined) {\n          const newPos = minY;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.y = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.Y_MIDDLE) {\n        if (minY !== undefined && maxY !== undefined) {\n          const newPos = minY + (maxY - minY) / 2;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.y = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.Y_MAX) {\n        if (maxY !== undefined) {\n          const newPos = maxY;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.y = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else {\n        console.error(\"unknow SnapToLineType\", snapType);\n      }\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: ChangeSelectedObjectsAlignmentHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.ChangeObjectsProperty,\n          payload: { changes: historyChanges },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n\n    newStore = this.getStoreWithHistory(newStore);\n\n    // @INFO: CHANGES IN THREEJS\n    updates.forEach((_singleChange) => {\n      if (newStore.objects[_singleChange.id] === undefined) {\n        console.warn(\"no object found in store\", _singleChange.id);\n        return;\n      }\n      const object = newStore.objects[_singleChange.id];\n      updateObjectPosition(\n        _singleChange.id,\n        object.objectType,\n        object.position.x,\n        object.position.y\n      );\n    });\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      updates.map((_singleChange) => {\n        return {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: newStore.objects[_singleChange.id],\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { AddObjects, AppEventType, DuplicateObjects } from \"../AppEventType\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { setStore } from \"../store\";\nimport { AddObjectsHistory, DuplicateObjectsHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  AppObject,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n} from \"../../editorObjects/Editor\";\nimport { buildRegion } from \"../../editorObjects/Region\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { buildPreviewProject3D } from \"../../editorObjects/PreviewProject3D\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { cloneDeep } from \"lodash\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class DuplicateObjectsHandler extends StoreObjectHandler<DuplicateObjects> {\n  run() {\n    const mapIds = {};\n    const objects: AppObject[] = [];\n    this.event.payload.objects.forEach((obj) => {\n      if (!obj.id) {\n        return;\n      }\n      const oldId = obj.id;\n      const clone = cloneDeep(obj);\n      delete (clone as any).id;\n      let newObject = this.getAppObjectFromCloneAppObject(clone);\n      if (newObject == undefined) {\n        return;\n      }\n      mapIds[oldId] = newObject.id;\n      objects.push(newObject);\n    });\n    // const offsetY = Math.random() * 3 * (Math.random() < 0.5 ? -1 : 1);\n    // const offsetX = Math.random() * 3 * (Math.random() < 0.5 ? -1 : 1);\n    const { diffX, diffY } = this.getPositionDiffFromMousePosition(objects);\n    this.moveObjectsByDiff(objects, diffX, diffY);\n    // this.moveObjectsByDiff(objects, diffX + offsetX, diffY + offsetY);\n    objects.forEach((object) => {\n      if (object.objectType === ObjectTypes.Group) {\n        const newChildrenIds: string[] = [];\n        (object as Group).childrenIds.forEach((id) => {\n          newChildrenIds.push(mapIds[id]);\n        });\n        (object as Group).childrenIds = newChildrenIds;\n      }\n      if (object[groupIdKey] !== undefined) {\n        object[groupIdKey] = mapIds[object[groupIdKey]];\n      }\n    });\n    this.store.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(this.store.objects[id], false);\n    });\n    let newStore = produce(this.store, (draft) => {\n      draft.selectedIds = [];\n      objects.forEach((object) => {\n        draft.objects[object.id] = object;\n        draft.selectedIds.push(object.id);\n      });\n    });\n    objects.forEach((object) => {\n      addObjectByObjectType(object);\n      this.selectObjectOnThreeScene(object, true);\n    });\n    if (this.saveToHistory) {\n      const historyEvent: DuplicateObjectsHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: {\n            ids: objects.map((object) => {\n              return object.id;\n            }),\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { AppEventType, GroupObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { GroupObjectsHistory } from \"../AppHistory\";\nimport {\n  addObjectByObjectType,\n  triggerDeleteObjectIds,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { Group, groupIdKey, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport * as THREE from \"three\";\nimport { getStateObjectFromObjectId } from \"../../editorObjects/editorGetters\";\nimport { appThree } from \"../../threejs/renderThreejs\";\nimport { cloneDeep } from \"lodash\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class GroupObjectsHandler extends StoreObjectHandler<GroupObjects> {\n  run() {\n    const idsGroups: string[] = [];\n    const idsObjectsWithoutGroups: string[] = [];\n    const idsInGroup: string[] = [];\n    const removed: GroupObjects[\"payload\"][\"removed\"] = [];\n    const added: Group[] = [];\n\n    let newStore = produce(this.store, (draft) => {\n      let groupCount: any = 0;\n      let inGroupCount: any = 0;\n      let noGroupCount: any = 0;\n      this.event.payload.objects.forEach((objId) => {\n        if (draft.objects[objId.id] === undefined) {\n          console.warn(\"object not found in store\", objId.id);\n          return;\n        }\n        const object = draft.objects[objId.id];\n        const isGroup = object.objectType === ObjectTypes.Group;\n        const isInGroup =\n          object[groupIdKey] !== undefined && object[groupIdKey].length > 0;\n        if (isGroup) {\n          if (idsGroups.includes(object.id) === false) {\n            groupCount = groupCount + 1;\n            idsGroups.push(object.id);\n          }\n        } else if (isInGroup) {\n          inGroupCount = inGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n          idsInGroup.push(object.id);\n          if (\n            object[groupIdKey] &&\n            draft.objects[object[groupIdKey]] !== undefined\n          ) {\n            if (idsGroups.includes(object[groupIdKey]) === false) {\n              groupCount = groupCount + 1;\n              idsGroups.push(object[groupIdKey]);\n            }\n          }\n        } else {\n          noGroupCount = noGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n        }\n      });\n\n      if (\n        this.event.payload.removed !== undefined &&\n        this.event.payload.removed.length > 0\n      ) {\n        draft.selectedIds = [];\n        this.event.payload.removed.forEach((group) => {\n          if (group === undefined) {\n            return;\n          }\n          if (group.id === undefined) {\n            return;\n          }\n\n          const bbox = new THREE.Box3();\n\n          group.childrenIds.forEach((id) => {\n            const obj = draft.objects[id];\n            if (obj === undefined) {\n              return;\n            }\n            const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n            if (name === undefined) {\n              return;\n            }\n            const object = appThree.scene.getObjectByUserDataProperty(\n              \"name\",\n              name\n            );\n            if (object === undefined) {\n              return;\n            }\n            bbox.expandByObject(object);\n          });\n\n          const w = bbox.max.x - bbox.min.x;\n          const h = bbox.max.y - bbox.min.y;\n          const newGroup = buildGroup({\n            id: group.id,\n            childrenIds: group.childrenIds,\n            position: {\n              x: bbox.min.x + w / 2,\n              y: bbox.min.y + h / 2,\n            },\n            width: w,\n            height: h,\n          });\n\n          draft.objects[group.id] = newGroup;\n\n          added.push(newGroup);\n          draft.selectedIds.push(newGroup.id);\n\n          if (group.childrenIds !== undefined && group.childrenIds.length > 0) {\n            group.childrenIds.forEach((id) => {\n              if (draft.objects[id] === undefined) {\n                console.warn(\"object not found after group.childrenIds...\");\n                return;\n              }\n              draft.objects[id][groupIdKey] = newGroup.id;\n              draft.selectedIds.push(id);\n            });\n          }\n        });\n      } else {\n        idsGroups.forEach((id) => {\n          if (draft.objects[id] === undefined) {\n            return;\n          }\n          this.selectObjectOnThreeScene(draft.objects[id], false);\n          removed.push(cloneDeep(draft.objects[id] as Group));\n          delete draft.objects[id];\n        });\n\n        const bbox = new THREE.Box3();\n\n        idsObjectsWithoutGroups.forEach((id) => {\n          const obj = draft.objects[id];\n          const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n          if (name === undefined) {\n            return;\n          }\n          const object = appThree.scene.getObjectByUserDataProperty(\n            \"name\",\n            name\n          );\n          if (object === undefined) {\n            return;\n          }\n          bbox.expandByObject(object);\n        });\n\n        let newGroupId: string | undefined = undefined;\n\n        if (this.event.payload.added !== undefined) {\n          newGroupId = this.event.payload.added.id;\n        }\n\n        const w = bbox.max.x - bbox.min.x;\n        const h = bbox.max.y - bbox.min.y;\n        const newGroup = buildGroup({\n          id: newGroupId,\n          position: {\n            x: bbox.min.x + w / 2,\n            y: bbox.min.y + h / 2,\n          },\n          width: w,\n          height: h,\n          childrenIds: idsObjectsWithoutGroups,\n        });\n        draft.objects[newGroup.id] = newGroup;\n        added.push(newGroup);\n\n        idsObjectsWithoutGroups.forEach((id) => {\n          draft.objects[id][groupIdKey] = newGroup.id;\n        });\n\n        draft.selectedIds = [newGroup.id, ...idsObjectsWithoutGroups];\n      }\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: GroupObjectsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.GroupObjects,\n          payload: {\n            objects: this.event.payload.objects.map(({ id }) => {\n              return cloneDeep({ id });\n            }),\n            removed: this.event.payload.removed?.map(({ id, childrenIds }) => {\n              return cloneDeep({ id, childrenIds });\n            }),\n            added: added[0]\n              ? {\n                  id: added[0].id,\n                  childrenIds: added[0].childrenIds,\n                }\n              : undefined,\n          },\n        },\n        undo: {\n          name: AppEventType.UngroupObjects,\n          payload: {\n            objects: newStore.selectedIds.map((id) => {\n              return cloneDeep({ id });\n            }),\n            removed: removed.map(({ id, childrenIds }) => {\n              return cloneDeep({ id, childrenIds });\n            }),\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    this.event.payload.objects.forEach((object) => {\n      this.selectObjectOnThreeScene(object as any, false);\n    });\n\n    triggerDeleteObjectIds(\n      this.event.payload.objects.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    triggerDeleteObjectIds(\n      removed.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    idsObjectsWithoutGroups.forEach((id) => {\n      addObjectByObjectType(newStore.objects[id]);\n    });\n\n    added.forEach((obj) => {\n      addObjectByObjectType(newStore.objects[obj.id]);\n    });\n\n    newStore.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(newStore.objects[id], true);\n    });\n\n    notifyBackend(\n      added.map(({ id }) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      idsObjectsWithoutGroups.map((id) => {\n        return {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      removed.map(({ id }) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(this.store.objects[id]),\n        };\n      })\n    );\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import produce from \"immer\";\nimport { Group, groupIdKey, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { AppEventType, UngroupObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { UngroupObjectsHistory } from \"../AppHistory\";\nimport {\n  addObjectByObjectType,\n  triggerDeleteObjectIds,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { cloneDeep } from \"lodash\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport * as THREE from \"three\";\nimport { getStateObjectFromObjectId } from \"../../editorObjects/editorGetters\";\nimport { appThree } from \"../../threejs/renderThreejs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class UngroupObjectsHandler extends StoreObjectHandler<UngroupObjects> {\n  run() {\n    const idsGroups: string[] = [];\n    const idsInGroup: string[] = [];\n    const idsObjectsWithoutGroups: string[] = [];\n    const removed: UngroupObjects[\"payload\"][\"removed\"] = [];\n    const added: Group[] = [];\n\n    let newStore = produce(this.store, (draft) => {\n      let groupCount: any = 0;\n      let inGroupCount: any = 0;\n      let noGroupCount: any = 0;\n\n      this.event.payload.objects.forEach((objId) => {\n        if (draft.objects[objId.id] === undefined) {\n          console.warn(\"object not found in store\", objId.id);\n          return;\n        }\n        const object = draft.objects[objId.id];\n        const isGroup = object.objectType === ObjectTypes.Group;\n        const isInGroup =\n          object[groupIdKey] !== undefined && object[groupIdKey].length > 0;\n        if (isGroup) {\n          if (idsGroups.includes(object.id) === false) {\n            groupCount = groupCount + 1;\n            idsGroups.push(object.id);\n          }\n        } else if (isInGroup) {\n          inGroupCount = inGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n          idsInGroup.push(object.id);\n          if (\n            object[groupIdKey] !== undefined &&\n            draft.objects[object[groupIdKey]]\n          ) {\n            if (idsGroups.includes(object[groupIdKey]) === false) {\n              groupCount = groupCount + 1;\n              idsGroups.push(object[groupIdKey]);\n            }\n          }\n        } else {\n          noGroupCount = noGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n        }\n      });\n\n      if (\n        this.event.payload.removed !== undefined &&\n        this.event.payload.removed.length > 0\n      ) {\n        draft.selectedIds = [];\n        this.event.payload.objects.forEach(({ id }) => {\n          if (draft.objects[id] === undefined) {\n            return;\n          }\n          if (draft.objects[id].objectType === ObjectTypes.Group) {\n            this.selectObjectOnThreeScene(draft.objects[id], false);\n            const childrenIds = (draft.objects[id] as Group).childrenIds;\n            childrenIds.forEach((id) => {\n              draft.objects[id][groupIdKey] = undefined;\n            });\n            removed.push(cloneDeep({ childrenIds, id }));\n            delete draft.objects[id];\n            return;\n          }\n          draft.objects[id][groupIdKey] = undefined;\n        });\n        this.event.payload.removed.forEach((group) => {\n          if (group === undefined) {\n            return;\n          }\n          if (group.id === undefined) {\n            return;\n          }\n\n          const bbox = new THREE.Box3();\n\n          group.childrenIds.forEach((id) => {\n            const obj = draft.objects[id];\n            if (obj === undefined) {\n              return;\n            }\n            const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n            if (name === undefined) {\n              return;\n            }\n            const object = appThree.scene.getObjectByUserDataProperty(\n              \"name\",\n              name\n            );\n            if (object === undefined) {\n              return;\n            }\n            bbox.expandByObject(object);\n          });\n\n          const w = bbox.max.x - bbox.min.x;\n          const h = bbox.max.y - bbox.min.y;\n          const newGroup = buildGroup({\n            id: group.id,\n            childrenIds: group.childrenIds,\n            position: {\n              x: bbox.min.x + w / 2,\n              y: bbox.min.y + h / 2,\n            },\n            width: w,\n            height: h,\n          });\n\n          draft.objects[group.id] = newGroup;\n          added.push(newGroup);\n          draft.selectedIds.push(newGroup.id);\n\n          if (group.childrenIds) {\n            group.childrenIds.forEach((id) => {\n              if (draft.objects[id] === undefined) {\n                return;\n              }\n              draft.objects[id][groupIdKey] = newGroup.id;\n              draft.selectedIds.push(id);\n            });\n          }\n        });\n      } else {\n        idsGroups.forEach((id) => {\n          if (draft.objects[id] === undefined) {\n            return;\n          }\n          this.selectObjectOnThreeScene(draft.objects[id], false);\n          const childrenIds = (draft.objects[id] as Group).childrenIds;\n          childrenIds.forEach((id) => {\n            draft.objects[id][groupIdKey] = undefined;\n          });\n          removed.push(cloneDeep({ id, childrenIds }));\n          delete draft.objects[id];\n        });\n      }\n\n      draft.selectedIds = [...idsObjectsWithoutGroups];\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: UngroupObjectsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.UngroupObjects,\n          payload: {\n            objects: newStore.selectedIds.map((id) => {\n              return cloneDeep({ id });\n            }),\n            removed: this.event.payload.removed?.map(({ id, childrenIds }) => {\n              return cloneDeep({ id, childrenIds });\n            }),\n          },\n        },\n        undo: {\n          name: AppEventType.GroupObjects,\n          payload: {\n            objects: this.event.payload.objects,\n            removed: removed.map(({ id, childrenIds }) => {\n              return { id, childrenIds };\n            }),\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    this.event.payload.objects.forEach((object) => {\n      this.selectObjectOnThreeScene(object as any, false);\n    });\n\n    triggerDeleteObjectIds(\n      removed.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    // @TODO: po ungroup nie powinno by usuwania i dodawania wszystkich obiektow zaleznych\n    triggerDeleteObjectIds(\n      this.event.payload.objects.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    added.forEach((obj) => {\n      addObjectByObjectType(newStore.objects[obj.id]);\n    });\n\n    idsObjectsWithoutGroups.forEach((id) => {\n      addObjectByObjectType(newStore.objects[id]);\n    });\n\n    newStore.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(newStore.objects[id], true);\n    });\n\n    notifyBackend(\n      added.map(({ id }) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      idsObjectsWithoutGroups.map((id) => {\n        return {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      removed.map(({ id }) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(this.store.objects[id]),\n        };\n      })\n    );\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import { AddObjectHandler } from \"./EventHandlers/AddObjectHandler\";\nimport { AppEvents, AppEventType } from \"./AppEventType\";\nimport { getStore } from \"./store\";\nimport { RemoveObjectHandler } from \"./EventHandlers/RemoveObjectHandler\";\nimport { ChangeSelectObjectsHandler } from \"./EventHandlers/ChangeSelectObjectsHandler\";\nimport { ChangeObjectsPropertyHandler } from \"./EventHandlers/ChangeObjectsPropertyHandler\";\nimport { getHistory } from \"./AppHistory\";\nimport { ChangeUiSettingsHandler } from \"./EventHandlers/ChangeUiSettingsHandler\";\nimport { ClipboardCopyHandler } from \"./EventHandlers/ClipboardCopyHandler\";\nimport { ClipboardCutHandler } from \"./EventHandlers/ClipboardCutHandler\";\nimport { ClipboardPasteHandler } from \"./EventHandlers/ClipboardPasteHandler\";\nimport { AddMultipleBeadsHandler } from \"./EventHandlers/AddMultipleBeadsHandler\";\nimport { ChangeUiSettingsZoomHandler } from \"./EventHandlers/ChangeUiSettingsZoomHandler\";\nimport { ChangeUiSettingsSidebarHandler } from \"./EventHandlers/ChangeUiSettingsSidebarHandler\";\nimport { ChangeObjectsAlignmentHandler } from \"./EventHandlers/ChangeObjectsAlignmentHandler\";\nimport { DuplicateObjectsHandler } from \"./EventHandlers/DuplicateObjectsHandler\";\nimport { GroupObjectsHandler } from \"./EventHandlers/GroupObjectsHandler\";\nimport { UngroupObjectsHandler } from \"./EventHandlers/UngroupObjectsHandler\";\n\nexport const sendEvent = (event: AppEvents, saveToHistory: boolean = true) => {\n  console.log(\n    \"dispatchEvent\",\n    event.name,\n    event.payload,\n    \"saveToHistory\",\n    saveToHistory\n  );\n\n  const history = getHistory();\n  const store = getStore();\n  if (event.name === AppEventType.AddObjects) {\n    new AddObjectHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.RemoveObjects) {\n    new RemoveObjectHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.ChangeSelectObjects) {\n    new ChangeSelectObjectsHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.ChangeObjectsProperty) {\n    new ChangeObjectsPropertyHandler(\n      event,\n      store,\n      history,\n      saveToHistory\n    ).run();\n  } else if (event.name === AppEventType.ChangeUiSettings) {\n    new ChangeUiSettingsHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.ClipboardCopy) {\n    new ClipboardCopyHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.ClipboardCut) {\n    new ClipboardCutHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.ClipboardPaste) {\n    new ClipboardPasteHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.AddMultipleBeads) {\n    new AddMultipleBeadsHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.ChangeUiSettingsZoom) {\n    new ChangeUiSettingsZoomHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.ChangeUiSettingsSidebar) {\n    new ChangeUiSettingsSidebarHandler(\n      event,\n      store,\n      history,\n      saveToHistory\n    ).run();\n  } else if (event.name === AppEventType.ChangeObjectsAlignment) {\n    new ChangeObjectsAlignmentHandler(\n      event,\n      store,\n      history,\n      saveToHistory\n    ).run();\n  } else if (event.name === AppEventType.DuplicateObjects) {\n    new DuplicateObjectsHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.GroupObjects) {\n    new GroupObjectsHandler(event, store, history, saveToHistory).run();\n  } else if (event.name === AppEventType.UngroupObjects) {\n    new UngroupObjectsHandler(event, store, history, saveToHistory).run();\n  } else {\n    console.warn(\"event handler not found to name\", event);\n  }\n\n  return event;\n};\n","import React from \"react\";\nimport {\n  faAddressBook,\n  faAlignLeft,\n  faArrowsAlt,\n  faBorderNone,\n  faBurn,\n  faChevronDown,\n  faCrosshairs,\n  faLock,\n  faObjectGroup,\n  faObjectUngroup,\n  faSearch,\n  faShapes,\n  faSync,\n  faTimes,\n  faUnlock,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faEllipsisH } from \"@fortawesome/free-solid-svg-icons\";\nimport { ActionsTypes } from \"./ActionsTypes\";\nimport { useSelector } from \"react-redux\";\nimport { Bead, Editor } from \"../../editorObjects/Editor\";\nimport styled from \"styled-components\";\nimport {\n  AppEventType,\n  ChangeObject,\n  ChangeObjectsProperty,\n  ChangeSelectObject,\n  ChangeSelectObjects,\n  GroupObjects,\n  UngroupObjects,\n} from \"../../controllers/AppEventType\";\nimport { getStore } from \"../../controllers/store\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport { cloneDeep } from \"lodash\";\n\nexport const ActionsIconsWrapper: React.FC<{\n  actions: ActionsTypes[];\n  selectedAction?: ActionsTypes;\n  onClick: any;\n}> = (props) => {\n  return (\n    <GroupActionsStyles>\n      <div className={\"actions-group\"}>\n        {props.actions.map((action, index) => {\n          if (action === ActionsTypes.More) {\n            return (\n              <IconActionsTypeMore\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.EditBeadColor) {\n            return (\n              <IconActionsTypeEditBeadColor\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.EditRegionGridType) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faShapes} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditRegionGridSettings) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faBorderNone} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditPosition) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faCrosshairs} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditRotate) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faSync} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditWidthHeight) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faArrowsAlt} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditWidthHeightDepth) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faArrowsAlt} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.Alignment) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faAlignLeft} />\n\n                      <FontAwesomeIcon icon={faChevronDown} size={\"sm\"} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditBeadType) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faShapes} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditBeadProduct) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faSearch} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.Lock) {\n            return (\n              <IconActionsLock\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.Unlock) {\n            return (\n              <IconActionsUnlock\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.EditBeadMaterial) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faBurn} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.Group) {\n            return (\n              <IconActionsGroup\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.Ungroup) {\n            return (\n              <IconActionsUngroup\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else {\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faTimes} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          }\n        })}\n      </div>\n    </GroupActionsStyles>\n  );\n};\n\nexport const GroupActionsStyles = styled.div`\n  height: 100%;\n\n  .more-icon-action-type {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 40px;\n    svg path {\n      fill: var(--gray);\n    }\n    div {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n  }\n  .icon-action-type-color {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 50px;\n  }\n  .icon-action-type {\n    width: 50px;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: var(--standardPadding);\n    padding-right: var(--standardPadding);\n  }\n  .icon-action-type-color {\n    .value {\n      height: 30px;\n      width: 30px;\n      background: transparent;\n      border-radius: 30px;\n      border: 1px solid #000;\n    }\n  }\n  .action-item-wrapper {\n    height: 100%;\n    transition: all 0.4s ease-in-out;\n  }\n  .action-item-wrapper.active {\n    background: rgba(0, 0, 0, 0.2);\n  }\n  .actions-group {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    position: relative;\n    height: 100%;\n    &:before {\n      content: \"\";\n      position: absolute;\n      top: 50%;\n      left: calc(var(--standardPadding) * -1);\n      height: 70%;\n      transform: translate(0, -50%);\n      width: 1px;\n      background: var(--gray);\n    }\n  }\n  .align-icons-wrapper {\n    column-gap: var(--standardPadding);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  .long-press-wrapper {\n    height: 100%;\n    position: relative;\n    &.active {\n      .long-press-ghost {\n        max-width: 100%;\n      }\n    }\n    .long-press-ghost {\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 2;\n      overflow: hidden;\n      background: #eee;\n      max-width: 0%;\n      height: 100%;\n      transition-property: all;\n      animation-timing-function: cubic-bezier(0.25, 0.1, 1, 1);\n      animation-fill-mode: forwards;\n      width: 100%;\n    }\n    .long-press-icon {\n      position: relative;\n      z-index: 3;\n      height: 100%;\n      width: 110px;\n      display: flex;\n      column-gap: var(--standardPadding);\n      padding-left: 30px;\n      .icon-wrapper {\n        position: absolute;\n        top: 50%;\n        left: 5px;\n        transform: translate(0, -50%);\n        font-size: 18px;\n      }\n\n      .label-wrapper {\n        font-size: 13px;\n        display: flex;\n        justify-content: center;\n        text-align: center;\n        align-content: center;\n        position: absolute;\n        top: 50%;\n        left: 30px;\n        transform: translate(0, -50%);\n      }\n    }\n  }\n`;\n\nexport const ItemActionWrapper: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const elRef = React.useRef<HTMLDivElement | null>(null);\n  const onClick = () => {\n    if (elRef.current) {\n      const { offsetLeft, offsetParent, offsetWidth } = elRef.current;\n      let groupOffsetLeft = 0;\n      if (offsetParent) {\n        groupOffsetLeft = (offsetParent as HTMLDivElement).offsetLeft;\n      } else {\n        console.warn(\"ref parent element not found\");\n      }\n      const halfWidth = offsetWidth / 2;\n      const finalOffsetLeft = groupOffsetLeft + offsetLeft + halfWidth;\n      props.onClick(props.type, finalOffsetLeft);\n    } else {\n      console.warn(\"ref element not found\");\n    }\n  };\n  return (\n    <div\n      className={`action-item-wrapper ${\n        props.selectedAction !== undefined &&\n        props.selectedAction === props.type\n          ? \"active\"\n          : \"\"\n      }`}\n      ref={(e) => (elRef.current = e)}\n      onClick={onClick}\n    >\n      {props.children}\n    </div>\n  );\n};\n\nexport const IconActionsTypeMore: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  return (\n    <ItemActionWrapper\n      onClick={props.onClick}\n      type={props.type}\n      selectedAction={props.selectedAction}\n    >\n      <div className={`more-icon-action-type `}>\n        <div\n          // @TRANSLATION\n          data-tip={\"Color\"}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <FontAwesomeIcon icon={faEllipsisH} />\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nexport const IconActionsTypeEditBeadColor: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const backgroundColors = useSelector((state: Editor) => {\n    const colors: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const color = (state.objects[id] as Bead).color;\n      if (colors.includes(color) === false) {\n        colors.push(color);\n      }\n    });\n    return colors;\n  });\n\n  if (backgroundColors.length === 0) {\n    return <React.Fragment />;\n  }\n\n  return (\n    <ItemActionWrapper\n      onClick={props.onClick}\n      type={props.type}\n      selectedAction={props.selectedAction}\n    >\n      <div className={\"icon-action-type-color\"}>\n        <div\n          // @TRANSLATION\n          data-tip={\"More\"}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div\n            className={\"value\"}\n            style={{\n              background: `linear-gradient(to right, ${\n                backgroundColors.length === 1\n                  ? [backgroundColors[0], backgroundColors[0]].join()\n                  : backgroundColors.slice(0, 10).join()\n              })`,\n            }}\n          >\n            &nbsp;\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nconst IconActionsUnlock: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const [startLongPress, setStartLongPress] = React.useState(false);\n  const ms = 600;\n  const onSuccess = () => {\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              isLocked: false,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n    props.onClick(undefined, undefined);\n  };\n\n  React.useEffect(() => {\n    let timerId;\n    if (startLongPress) {\n      timerId = setTimeout(onSuccess, ms);\n    } else {\n      clearTimeout(timerId);\n    }\n\n    return () => {\n      clearTimeout(timerId);\n    };\n  }, [startLongPress]);\n\n  const start = React.useCallback(() => {\n    setStartLongPress(true);\n  }, []);\n\n  const stop = React.useCallback(() => {\n    setStartLongPress(false);\n  }, []);\n\n  return (\n    <div\n      onMouseDown={start}\n      onMouseUp={stop}\n      onMouseLeave={stop}\n      onTouchStart={start}\n      onTouchEnd={stop}\n      className={`long-press-wrapper ${startLongPress ? \"active\" : \"\"}`}\n    >\n      <div\n        className={`long-press-ghost`}\n        style={{ transitionDuration: `${ms}ms` }}\n      >\n        &nbsp;\n      </div>\n      <div className={\"long-press-icon\"}>\n        <div className={\"icon-wrapper\"}>\n          <FontAwesomeIcon icon={faLock} />\n        </div>\n        <div className={\"label-wrapper\"}>\n          <span>Long press to unlock</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst IconActionsLock: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const onClick = () => {\n    const store = getStore();\n    const _event: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change: store.selectedIds.map((id) => {\n          const _change: ChangeSelectObject = {\n            id,\n            isSelected: false,\n          };\n          return _change;\n        }),\n      },\n    };\n    sendEvent(_event);\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              isLocked: true,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <ItemActionWrapper onClick={onClick} type={ActionsTypes.Lock}>\n      <div className={\"icon-action-type\"}>\n        <div\n          // @TRANSLATION\n          data-tip={ActionsTypes.Lock}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div className={\"align-icons-wrapper\"}>\n            <FontAwesomeIcon icon={faUnlock} />\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nconst IconActionsGroup: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const onClick = () => {\n    const store = getStore();\n    const _event: GroupObjects = {\n      name: AppEventType.GroupObjects,\n      payload: {\n        objects: store.selectedIds.map((id) => {\n          return cloneDeep(store.objects[id]);\n        }),\n      },\n    };\n    sendEvent(_event);\n  };\n  return (\n    <ItemActionWrapper onClick={onClick} type={props.type}>\n      <div className={\"icon-action-type\"}>\n        <div\n          // @TRANSLATION\n          data-tip={props.type}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div className={\"align-icons-wrapper\"}>\n            <FontAwesomeIcon icon={faObjectGroup} />\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nconst IconActionsUngroup: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const onClick = () => {\n    const store = getStore();\n    const _event: UngroupObjects = {\n      name: AppEventType.UngroupObjects,\n      payload: {\n        objects: store.selectedIds.map((id) => {\n          return cloneDeep(store.objects[id]);\n        }),\n      },\n    };\n    sendEvent(_event);\n  };\n  return (\n    <ItemActionWrapper onClick={onClick} type={props.type}>\n      <div className={\"icon-action-type\"}>\n        <div\n          // @TRANSLATION\n          data-tip={props.type}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div className={\"align-icons-wrapper\"}>\n            <FontAwesomeIcon icon={faObjectUngroup} />\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n","// ts-nocheck\n\nimport React, { Component } from \"react\";\n// import PropTypes from \"prop-types\";\n\nconst KEYCODE_UP = 38;\nconst KEYCODE_DOWN = 40;\nconst IS_BROWSER = typeof document != \"undefined\";\nconst RE_NUMBER = /^[+-]?((\\.\\d+)|(\\d+(\\.\\d+)?))$/;\nconst RE_INCOMPLETE_NUMBER = /^([+-]0?|[0-9]*\\.0*|[+-]\\.0*|[+-]?\\d+\\.)?$/;\n\n/**\n * Just a simple helper to provide support for older IEs. This is not exactly a\n * polyfill for classList.add but it does what we need with minimal effort.\n * Works with single className only!\n */\nfunction addClass(element, className) {\n  if (element.classList) {\n    return element.classList.add(className);\n  }\n  if (!element.className.search(new RegExp(\"\\\\b\" + className + \"\\\\b\"))) {\n    element.className = \" \" + className;\n  }\n}\n\n/**\n * Just a simple helper to provide support for older IEs. This is not exactly a\n * polyfill for classList.remove but it does what we need with minimal effort.\n * Works with single className only!\n */\nfunction removeClass(element, className) {\n  if (element.className) {\n    if (element.classList) {\n      return element.classList.remove(className);\n    }\n\n    element.className = element.className.replace(\n      new RegExp(\"\\\\b\" + className + \"\\\\b\", \"g\"),\n      \"\"\n    );\n  }\n}\n\n/**\n * Lookup the object.prop and returns it. If it happens to be a function,\n * executes it with args and returns it's return value. It the prop does not\n * exist on the object, or if it equals undefined, or if it is a function that\n * returns undefined the defaultValue will be returned instead.\n * @param  {Object} object       The object to look into\n * @param  {String} prop         The property name\n * @param  {*}      defaultValue The default value\n * @param  {*[]}    args         Any additional arguments to pass to the\n *                               function (if the prop is a function).\n * @return {*}                   Whatever happens to be the return value\n */\nfunction access(object, prop, defaultValue, ...args) {\n  let result = object[prop];\n  if (typeof result == \"function\") {\n    result = result(...args);\n  }\n  return result === undefined ? defaultValue : result;\n}\n\n/* eslint-disable */\ntype NumericInputState = {\n  selectionStart?: number | null;\n  selectionEnd?: number | null;\n  btnDownHover?: boolean;\n  btnDownActive?: boolean;\n  btnUpHover?: boolean;\n  btnUpActive?: boolean;\n  value?: number | null;\n  stringValue?: string;\n};\n/*eslint-enable*/\n\ninterface NumericInputProps {\n  step?: any;\n  min?: any;\n  max?: any;\n  precision?: any;\n  maxLength?: any;\n  parse?: any;\n  format?: any;\n  className?: any;\n  disabled?: any;\n  readOnly?: any;\n  required?: any;\n  snap?: any;\n  noValidate?: any;\n  style?: any;\n  noStyle?: any;\n  type?: any;\n  pattern?: any;\n  onFocus?: any;\n  onBlur?: any;\n  onKeyDown?: any;\n  onChange?: any;\n  onInvalid?: any;\n  onValid?: any;\n  onInput?: any;\n  onSelect?: any;\n  size?: any;\n  value?: any;\n  defaultValue?: any;\n  strict?: any;\n  componentClass?: any;\n  mobile?: any;\n}\n\nexport class NumericInput extends Component<\n  NumericInputProps,\n  NumericInputState\n> {\n  // static propTypes = {\n  //   step: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   min: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   max: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   precision: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   maxLength: PropTypes.number,\n  //   parse: PropTypes.func,\n  //   format: PropTypes.func,\n  //   className: PropTypes.string,\n  //   disabled: PropTypes.bool,\n  //   readOnly: PropTypes.bool,\n  //   required: PropTypes.bool,\n  //   snap: PropTypes.bool,\n  //   noValidate: PropTypes.oneOfType([PropTypes.bool, PropTypes.string]),\n  //   style: PropTypes.oneOfType([PropTypes.object, PropTypes.bool]),\n  //   noStyle: PropTypes.bool,\n  //   type: PropTypes.string,\n  //   pattern: PropTypes.string,\n  //   onFocus: PropTypes.func,\n  //   onBlur: PropTypes.func,\n  //   onKeyDown: PropTypes.func,\n  //   onChange: PropTypes.func,\n  //   onInvalid: PropTypes.func,\n  //   onValid: PropTypes.func,\n  //   onInput: PropTypes.func,\n  //   onSelect: PropTypes.func,\n  //   size: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  //   value: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  //   defaultValue: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  //   strict: PropTypes.bool,\n  //   componentClass: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n  //   mobile(props, propName) {\n  //     let prop = props[propName];\n  //     if (\n  //       prop !== true &&\n  //       prop !== false &&\n  //       prop !== \"auto\" &&\n  //       typeof prop != \"function\"\n  //     ) {\n  //       return new Error(\n  //         'The \"mobile\" prop must be true, false, \"auto\" or a function'\n  //       );\n  //     }\n  //   },\n  // };\n\n  /**\n   * The default behavior is to start from 0, use step of 1 and display\n   * integers\n   */\n  static defaultProps = {\n    step: 1,\n    min: Number.MIN_SAFE_INTEGER || -9007199254740991,\n    max: Number.MAX_SAFE_INTEGER || 9007199254740991,\n    precision: null,\n    parse: null,\n    format: null,\n    mobile: \"auto\",\n    strict: false,\n    componentClass: \"input\",\n    style: {},\n  };\n\n  /**\n   * This are the default styles that act as base for all the component\n   * instances. One can modify this object to change the default styles\n   * of all the widgets on the page.\n   */\n  static style = {\n    // The wrapper (span)\n    wrap: {\n      position: \"relative\",\n      display: \"inline-block\",\n    },\n\n    \"wrap.hasFormControl\": {\n      display: \"block\",\n    },\n\n    // The increase button arrow (i)\n    arrowUp: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 0,\n      height: 0,\n      borderWidth: \"0 0.6ex 0.6ex 0.6ex\",\n      borderColor: \"transparent transparent rgba(0, 0, 0, 0.7)\",\n      borderStyle: \"solid\",\n      margin: \"-0.3ex 0 0 -0.56ex\",\n    },\n\n    // The decrease button arrow (i)\n    arrowDown: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 0,\n      height: 0,\n      borderWidth: \"0.6ex 0.6ex 0 0.6ex\",\n      borderColor: \"rgba(0, 0, 0, 0.7) transparent transparent\",\n      borderStyle: \"solid\",\n      margin: \"-0.3ex 0 0 -0.56ex\",\n    },\n\n    // The vertical segment of the plus sign (for mobile only)\n    plus: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 2,\n      height: 10,\n      background: \"rgba(0,0,0,.7)\",\n      margin: \"-5px 0 0 -1px\",\n    },\n\n    // The horizontal segment of the plus/minus signs (for mobile only)\n    minus: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 10,\n      height: 2,\n      background: \"rgba(0,0,0,.7)\",\n      margin: \"-1px 0 0 -5px\",\n    },\n\n    // Common styles for the up/down buttons (b)\n    btn: {\n      position: \"absolute\",\n      right: 2,\n      width: \"2.26ex\",\n      borderColor: \"rgba(0,0,0,.1)\",\n      borderStyle: \"solid\",\n      textAlign: \"center\",\n      cursor: \"default\",\n      transition: \"all 0.1s\",\n      background: \"rgba(0,0,0,.1)\",\n      boxShadow:\n        \"-1px -1px 3px rgba(0,0,0,.1) inset,\" +\n        \"1px 1px 3px rgba(255,255,255,.7) inset\",\n    },\n\n    btnUp: {\n      top: 2,\n      bottom: \"50%\",\n      borderRadius: \"2px 2px 0 0\",\n      borderWidth: \"1px 1px 0 1px\",\n    },\n\n    \"btnUp.mobile\": {\n      width: \"3.3ex\",\n      bottom: 2,\n      boxShadow: \"none\",\n      borderRadius: 2,\n      borderWidth: 1,\n    },\n\n    btnDown: {\n      top: \"50%\",\n      bottom: 2,\n      borderRadius: \"0 0 2px 2px\",\n      borderWidth: \"0 1px 1px 1px\",\n    },\n\n    \"btnDown.mobile\": {\n      width: \"3.3ex\",\n      bottom: 2,\n      left: 2,\n      top: 2,\n      right: \"auto\",\n      boxShadow: \"none\",\n      borderRadius: 2,\n      borderWidth: 1,\n    },\n\n    \"btn:hover\": {\n      background: \"rgba(0,0,0,.2)\",\n    },\n\n    \"btn:active\": {\n      background: \"rgba(0,0,0,.3)\",\n      boxShadow:\n        \"0 1px 3px rgba(0,0,0,.2) inset,\" +\n        \"-1px -1px 4px rgba(255,255,255,.5) inset\",\n    },\n\n    \"btn:disabled\": {\n      opacity: 0.5,\n      boxShadow: \"none\",\n      cursor: \"not-allowed\",\n    },\n\n    // The input (input[type=\"text\"])\n    input: {\n      paddingRight: \"3ex\",\n      boxSizing: \"border-box\",\n      fontSize: \"inherit\",\n    },\n\n    // The input with bootstrap class\n    \"input:not(.form-control)\": {\n      border: \"1px solid #ccc\",\n      borderRadius: 2,\n      paddingLeft: 4,\n      display: \"block\",\n      WebkitAppearance: \"none\",\n      lineHeight: \"normal\",\n    },\n\n    \"input.mobile\": {\n      paddingLeft: \" 3.4ex\",\n      paddingRight: \"3.4ex\",\n      textAlign: \"center\",\n    },\n\n    \"input:focus\": {},\n\n    \"input:disabled\": {\n      color: \"rgba(0, 0, 0, 0.3)\",\n      textShadow: \"0 1px 0 rgba(255, 255, 255, 0.8)\",\n    },\n  };\n\n  /**\n   * When click and hold on a button - the speed of auto changing the value.\n   * This is a static property and can be modified if needed.\n   */\n  static SPEED = 50;\n\n  /**\n   * When click and hold on a button - the delay before auto changing the value.\n   * This is a static property and can be modified if needed.\n   */\n  static DELAY = 500;\n\n  /**\n   * The constant indicating up direction (or increasing in general)\n   */\n  static DIRECTION_UP = \"up\";\n\n  /**\n   * The constant indicating down direction (or decreasing in general)\n   */\n  static DIRECTION_DOWN = \"down\";\n\n  /**\n   * The step timer\n   * @type {Number}\n   */\n  /**\n   * The step timer\n   * @type {Number}\n   */\n  _timer!: any;\n\n  /**\n   * This holds the last known validation error. We need to compare that with\n   * new errors and detect validation changes...\n   * @type {[type]}\n   */\n  /**\n   * This holds the last known validation error. We need to compare that with\n   * new errors and detect validation changes...\n   * @type {[type]}\n   */\n  _valid!: string;\n\n  _isStrict: boolean;\n  _ignoreValueChange!: boolean;\n  _isMounted!: boolean;\n  _inputFocus!: boolean;\n  // onTouchEnd: any;\n  refsWrapper: any;\n  refsInput: any;\n\n  /**\n   * The state of the component\n   * @type {Object}\n   */\n  state: NumericInputState;\n\n  /**\n   * The stop method (need to declare it here to use it in the constructor)\n   * @type {Function}\n   */\n  // stop: any;\n\n  /**\n   * Set the initial state and bind this.stop to the instance.\n   */\n  constructor(args: any) {\n    super(args);\n\n    this._isStrict = !!this.props.strict;\n\n    this.state = {\n      btnDownHover: false,\n      btnDownActive: false,\n      btnUpHover: false,\n      btnUpActive: false,\n      stringValue: \"\",\n      ...this._propsToState(this.props),\n    };\n    this.stop = this.stop.bind(this);\n    this.onTouchEnd = this.onTouchEnd.bind(this);\n    this.refsInput = null;\n    this.refsWrapper = null;\n  }\n\n  _propsToState(props) {\n    let out: NumericInputState = {};\n\n    if (props.hasOwnProperty(\"value\")) {\n      out.stringValue = String(\n        props.value || props.value === 0 ? props.value : \"\"\n      ).trim();\n\n      out.value = out.stringValue !== \"\" ? this._parse(props.value) : null;\n    } else if (!this._isMounted && props.hasOwnProperty(\"defaultValue\")) {\n      out.stringValue = String(\n        props.defaultValue || props.defaultValue === 0 ? props.defaultValue : \"\"\n      ).trim();\n\n      out.value =\n        props.defaultValue !== \"\" ? this._parse(props.defaultValue) : null;\n    }\n\n    return out;\n  }\n\n  /**\n   * Special care is taken for the \"value\" prop:\n   * - If not provided - set it to null\n   * - If the prop is a number - use it as is\n   * - Otherwise:\n   *     1. Convert it to string (falsy values become \"\")\n   *     2. Then trim it.\n   *     3. Then parse it to number (delegating to this.props.parse if any)\n   */\n  componentWillReceiveProps(props: NumericInputProps): void {\n    this._isStrict = !!props.strict;\n    let nextState = this._propsToState(props);\n    if (Object.keys(nextState).length) {\n      this._ignoreValueChange = true;\n      this.setState(nextState, () => {\n        this._ignoreValueChange = false;\n      });\n    }\n  }\n\n  /**\n   * Save the input selection right before rendering\n   */\n  componentWillUpdate(): void {\n    this.saveSelection();\n  }\n\n  /**\n   * After the component has been rendered into the DOM, do whatever is\n   * needed to \"reconnect\" it to the outer world, i.e. restore selection,\n   * call some of the callbacks, validate etc.\n   */\n  componentDidUpdate(\n    prevProps: NumericInputProps,\n    prevState: NumericInputProps\n  ): void {\n    // Call the onChange if needed. This is placed here because there are\n    // many reasons for changing the value and this is the common place\n    // that can capture them all\n\n    if (\n      !this._ignoreValueChange && // no onChange if re-rendered with different value prop\n      prevState.value !== this.state.value && // no onChange if the value remains the same\n      (!isNaN(this.state.value ?? Number.NaN) || this.state.value === null) // only if changing to number or null\n    ) {\n      this._invokeEventCallback(\n        \"onChange\",\n        this.state.value,\n        this.refsInput.value,\n        this.refsInput\n      );\n    }\n\n    // focus the input is needed (for example up/down buttons set\n    // this._inputFocus to true)\n    if (this._inputFocus) {\n      this.refsInput.focus();\n\n      // Restore selectionStart (if any)\n      if (this.state.selectionStart || this.state.selectionStart === 0) {\n        this.refsInput.selectionStart = this.state.selectionStart;\n      }\n\n      // Restore selectionEnd (if any)\n      if (this.state.selectionEnd || this.state.selectionEnd === 0) {\n        this.refsInput.selectionEnd = this.state.selectionEnd;\n      }\n    }\n\n    this.checkValidity();\n  }\n\n  /**\n   * This is used to clear the timer if any\n   */\n  componentWillUnmount(): void {\n    this._isMounted = false;\n    this.stop();\n  }\n\n  /**\n   * Adds getValueAsNumber and setValue methods to the input DOM element.\n   */\n  componentDidMount(): void {\n    this._isMounted = true;\n    this.refsInput.getValueAsNumber = () => this.state.value || 0;\n\n    this.refsInput.setValue = (value) => {\n      this.setState({\n        value: this._parse(value),\n        stringValue: value,\n      });\n    };\n\n    // This is a special case! If the component has the \"autoFocus\" prop\n    // and the browser did focus it we have to pass that to the onFocus\n    if (\n      !this._inputFocus &&\n      IS_BROWSER &&\n      document.activeElement === this.refsInput\n    ) {\n      this._inputFocus = true;\n      this.refsInput.focus();\n      this._invokeEventCallback(\"onFocus\", {\n        target: this.refsInput,\n        type: \"focus\",\n      });\n    }\n\n    this.checkValidity();\n  }\n\n  /**\n   * Saves the input selection in the state so that it can be restored after\n   * updates\n   */\n  saveSelection(): void {\n    this.state.selectionStart = this.refsInput.selectionStart;\n    this.state.selectionEnd = this.refsInput.selectionEnd;\n  }\n\n  /**\n   * Unless noValidate is set to true, the component will check the\n   * existing validation state (if any) and will toggle the \"has-error\"\n   * CSS class on the wrapper\n   */\n  checkValidity(): void {\n    let valid,\n      validationError = \"\";\n\n    let supportsValidation = !!this.refsInput.checkValidity;\n\n    // noValidate\n    let noValidate = !!(\n      this.props.noValidate && this.props.noValidate != \"false\"\n    );\n\n    this.refsInput.noValidate = noValidate;\n\n    // If \"noValidate\" is set or \"checkValidity\" is not supported then\n    // consider the element valid. Otherwise consider it invalid and\n    // make some additional checks below\n    valid = noValidate || !supportsValidation;\n\n    if (valid) {\n      validationError = \"\";\n    } else {\n      // In some browsers once a pattern is set it cannot be removed. The\n      // browser sets it to \"\" instead which results in validation\n      // failures...\n      if (this.refsInput.pattern === \"\") {\n        this.refsInput.pattern = this.props.required ? \".+\" : \".*\";\n      }\n\n      // Now check validity\n      if (supportsValidation) {\n        this.refsInput.checkValidity();\n        valid = this.refsInput.validity.valid;\n\n        if (!valid) {\n          validationError = this.refsInput.validationMessage;\n        }\n      }\n\n      // Some browsers might fail to validate maxLength\n      if (valid && supportsValidation && this.props.maxLength) {\n        if (this.refsInput.value.length > this.props.maxLength) {\n          validationError = \"This value is too long\";\n        }\n      }\n    }\n\n    validationError =\n      validationError ||\n      (valid ? \"\" : this.refsInput.validationMessage || \"Unknown Error\");\n\n    let validStateChanged = this._valid !== validationError;\n    this._valid = validationError;\n    if (validationError) {\n      addClass(this.refsWrapper, \"has-error\");\n      if (validStateChanged) {\n        this._invokeEventCallback(\n          \"onInvalid\",\n          validationError,\n          this.state.value,\n          this.refsInput.value\n        );\n      }\n    } else {\n      removeClass(this.refsWrapper, \"has-error\");\n      if (validStateChanged) {\n        this._invokeEventCallback(\n          \"onValid\",\n          this.state.value,\n          this.refsInput.value\n        );\n      }\n    }\n  }\n\n  /**\n   * Used internally to parse the argument x to it's numeric representation.\n   * If the argument cannot be converted to finite number returns 0; If a\n   * \"precision\" prop is specified uses it round the number with that\n   * precision (no fixed precision here because the return value is float, not\n   * string).\n   */\n  _toNumber(x: any): number {\n    let n = parseFloat(x);\n    if (isNaN(n) || !isFinite(n)) {\n      n = 0;\n    }\n\n    if (this._isStrict) {\n      let precision = access(this.props, \"precision\", null, this);\n      let q = Math.pow(10, precision === null ? 10 : precision);\n      let _min = +access(\n        this.props,\n        \"min\",\n        NumericInput.defaultProps.min,\n        this\n      );\n      let _max = +access(\n        this.props,\n        \"max\",\n        NumericInput.defaultProps.max,\n        this\n      );\n      n = Math.min(Math.max(n, _min), _max);\n      n = Math.round(n * q) / q;\n    }\n\n    return n;\n  }\n\n  /**\n   * This is used internally to parse any string into a number. It will\n   * delegate to this.props.parse function if one is provided. Otherwise it\n   * will just use parseFloat.\n   * @private\n   */\n  _parse(x: string): number {\n    x = String(x);\n    if (typeof this.props.parse == \"function\") {\n      return parseFloat(this.props.parse(x));\n    }\n    return parseFloat(x);\n  }\n\n  /**\n   * This is used internally to format a number to it's display representation.\n   * It will invoke the this.props.format function if one is provided.\n   * @private\n   */\n  _format(n: number): string {\n    let _n: string = this._toNumber(n).toString();\n    let precision = access(this.props, \"precision\", null, this);\n    if (precision !== null) {\n      _n = n.toFixed(precision);\n    }\n\n    _n += \"\";\n\n    if (this.props.format) {\n      return this.props.format(_n);\n    }\n\n    return _n;\n  }\n\n  /**\n   * The internal method that actually sets the new value on the input\n   * @private\n   */\n  _step(n: number, callback?: any): boolean {\n    let _isStrict = this._isStrict;\n    this._isStrict = true;\n\n    let _step = +access(\n      this.props,\n      \"step\",\n      NumericInput.defaultProps.step,\n      this,\n      n > 0 ? NumericInput.DIRECTION_UP : NumericInput.DIRECTION_DOWN\n    );\n\n    let _n = this._toNumber((this.state.value || 0) + _step * n);\n\n    if (this.props.snap) {\n      _n = Math.round(_n / _step) * _step;\n    }\n\n    this._isStrict = _isStrict;\n\n    if (_n !== this.state.value) {\n      this.setState({ value: _n, stringValue: _n + \"\" }, callback);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * This binds the Up/Down arrow key listeners\n   */\n  _onKeyDown(...args: Array<any>): void {\n    args[0].persist();\n    this._invokeEventCallback(\"onKeyDown\", ...args);\n    let e = args[0];\n    if (!e.isDefaultPrevented()) {\n      if (e.keyCode === KEYCODE_UP) {\n        e.preventDefault();\n        this._step(e.ctrlKey || e.metaKey ? 0.1 : e.shiftKey ? 10 : 1);\n      } else if (e.keyCode === KEYCODE_DOWN) {\n        e.preventDefault();\n        this._step(e.ctrlKey || e.metaKey ? -0.1 : e.shiftKey ? -10 : -1);\n      } else {\n        let value = this.refsInput.value,\n          length = value.length;\n        if (e.keyCode === 8) {\n          // backspace\n          if (\n            this.refsInput.selectionStart == this.refsInput.selectionEnd &&\n            this.refsInput.selectionEnd > 0 &&\n            value.length &&\n            value.charAt(this.refsInput.selectionEnd - 1) === \".\"\n          ) {\n            e.preventDefault();\n            this.refsInput.selectionStart = this.refsInput.selectionEnd =\n              this.refsInput.selectionEnd - 1;\n          }\n        } else if (e.keyCode === 46) {\n          // delete\n          if (\n            this.refsInput.selectionStart == this.refsInput.selectionEnd &&\n            this.refsInput.selectionEnd < length + 1 &&\n            value.length &&\n            value.charAt(this.refsInput.selectionEnd) === \".\"\n          ) {\n            e.preventDefault();\n            this.refsInput.selectionStart = this.refsInput.selectionEnd =\n              this.refsInput.selectionEnd + 1;\n          }\n        } else if (e.keyCode === 46) {\n          // @TODO: doda obsuge klikniecia enter\n        }\n      }\n    }\n  }\n\n  /**\n   * Stops the widget from auto-changing by clearing the timer (if any)\n   */\n  stop(): void {\n    if (this._timer) {\n      clearTimeout(this._timer);\n    }\n  }\n\n  /**\n   * Increments the value with one step and the enters a recursive calls\n   * after DELAY. This is bound to the mousedown event on the \"up\" button\n   * and will be stopped on mouseout/mouseup.\n   * @param {Boolean} _recursive The method is passing this to itself while\n   *  it is in recursive mode.\n   * @return void\n   */\n  increase(_recursive: boolean = false, callback?: Function): void {\n    this.stop();\n    this._step(1, callback);\n    let _max = +access(this.props, \"max\", NumericInput.defaultProps.max, this);\n    if (\n      isNaN(this.state.value ?? Number.NaN) ||\n      +(this.state.value ?? Number.NaN) < _max\n    ) {\n      this._timer = setTimeout(\n        () => {\n          this.increase(true);\n        },\n        _recursive ? NumericInput.SPEED : NumericInput.DELAY\n      );\n    }\n  }\n\n  /**\n   * Decrements the value with one step and the enters a recursive calls\n   * after DELAY. This is bound to the mousedown event on the \"down\" button\n   * and will be stopped on mouseout/mouseup.\n   * @param {Boolean} _recursive The method is passing this to itself while\n   *  it is in recursive mode.\n   * @return void\n   */\n  decrease(_recursive: boolean = false, callback?: Function): void {\n    this.stop();\n    this._step(-1, callback);\n    let _min = +access(this.props, \"min\", NumericInput.defaultProps.min, this);\n    if (\n      isNaN(this.state.value ?? Number.NaN) ||\n      +(this.state.value ?? Number.NaN) > _min\n    ) {\n      this._timer = setTimeout(\n        () => {\n          this.decrease(true);\n        },\n        _recursive ? NumericInput.SPEED : NumericInput.DELAY\n      );\n    }\n  }\n\n  /**\n   * Handles the mousedown event on the up/down buttons. Changes The\n   * internal value and sets up a delay for auto increment/decrement\n   * (until mouseup or mouseleave)\n   */\n  onMouseDown(dir: \"up\" | \"down\", callback?: Function): void {\n    if (dir == \"down\") {\n      this.decrease(false, callback);\n    } else if (dir == \"up\") {\n      this.increase(false, callback);\n    }\n  }\n\n  /**\n   * Handles the touchstart event on the up/down buttons. Changes The\n   * internal value and DOES NOT sets up a delay for auto increment/decrement.\n   * Note that this calls e.preventDefault() so the event is not used for\n   * creating a virtual mousedown after it\n   */\n  onTouchStart(dir: \"up\" | \"down\", e: Event): void {\n    e.preventDefault();\n    if (dir == \"down\") {\n      this.decrease();\n    } else if (dir == \"up\") {\n      this.increase();\n    }\n  }\n\n  onTouchEnd(e: Event): void {\n    e.preventDefault();\n    this.stop();\n  }\n\n  /**\n   * Helper method to invoke event callback functions if they are provided\n   * in the props.\n   * @param {String} callbackName The name of the function prop\n   * @param {*[]} args Any additional argument are passed thru\n   */\n  _invokeEventCallback(callbackName: string, ...args: Array<any>): void {\n    if (typeof this.props[callbackName] == \"function\") {\n      this.props[callbackName].call(null, ...args);\n    }\n  }\n\n  /**\n   * Renders an input wrapped in relative span and up/down buttons\n   * @return {Component}\n   */\n  render() {\n    let props = this.props;\n    let state = this.state;\n    let css: any = {};\n\n    let {\n      // These are ignored in rendering\n      step,\n      min,\n      max,\n      precision,\n      parse,\n      format,\n      mobile,\n      snap,\n      componentClass,\n      value,\n      type,\n      style,\n      defaultValue,\n      onInvalid,\n      onValid,\n      strict,\n      noStyle,\n\n      // The rest are passed to the input\n      ...rest\n    } = this.props;\n\n    noStyle = noStyle || style === false;\n\n    // Build the styles\n    for (let x in NumericInput.style) {\n      css[x] = Object.assign(\n        {},\n        NumericInput.style[x],\n        style ? style[x] || {} : {}\n      );\n    }\n\n    let hasFormControl =\n      props.className && /\\bform-control\\b/.test(props.className);\n\n    if (mobile == \"auto\") {\n      mobile = IS_BROWSER && \"ontouchstart\" in document;\n    }\n\n    if (typeof mobile == \"function\") {\n      mobile = mobile.call(this);\n    }\n    mobile = !!mobile;\n\n    let attrs = {\n      wrap: {\n        style: noStyle ? null : css.wrap,\n        className: \"react-numeric-input\",\n        ref: (e) => {\n          if (e != null && e != undefined) {\n            this.refsWrapper = e;\n          }\n        },\n        onMouseUp: undefined,\n        onMouseLeave: undefined,\n      },\n      input: {\n        ref: (e) => {\n          if (e != null && e != undefined) {\n            this.refsInput = e;\n          }\n        },\n        type: \"text\",\n        style: noStyle\n          ? null\n          : Object.assign(\n              {},\n              css.input,\n              !hasFormControl ? css[\"input:not(.form-control)\"] : {},\n              this._inputFocus ? css[\"input:focus\"] : {}\n            ),\n        ...rest,\n      },\n      btnUp: {\n        onMouseEnter: undefined,\n        onMouseDown: undefined,\n        onMouseUp: undefined,\n        onMouseLeave: undefined,\n        onTouchStart: undefined,\n        onTouchEnd: undefined,\n        style: noStyle\n          ? null\n          : Object.assign(\n              {},\n              css.btn,\n              css.btnUp,\n              props.disabled || props.readOnly\n                ? css[\"btn:disabled\"]\n                : state.btnUpActive\n                ? css[\"btn:active\"]\n                : state.btnUpHover\n                ? css[\"btn:hover\"]\n                : {}\n            ),\n      },\n      btnDown: {\n        onMouseEnter: undefined,\n        onMouseDown: undefined,\n        onMouseUp: undefined,\n        onMouseLeave: undefined,\n        onTouchStart: undefined,\n        onTouchEnd: undefined,\n        style: noStyle\n          ? null\n          : Object.assign(\n              {},\n              css.btn,\n              css.btnDown,\n              props.disabled || props.readOnly\n                ? css[\"btn:disabled\"]\n                : state.btnDownActive\n                ? css[\"btn:active\"]\n                : state.btnDownHover\n                ? css[\"btn:hover\"]\n                : {}\n            ),\n      },\n    };\n\n    let stringValue = String(\n      // if state.stringValue is set and not empty\n      state.stringValue ||\n        // else if state.value is set and not null|undefined\n        (state.value || state.value === 0 ? state.value : \"\") ||\n        // or finally use \"\"\n        \"\"\n    );\n\n    let loose = !this._isStrict && (this._inputFocus || !this._isMounted);\n\n    // incomplete number\n    if (loose && RE_INCOMPLETE_NUMBER.test(stringValue)) {\n      (attrs.input as any).value = stringValue;\n    }\n\n    // Not a number and not empty (loose mode only)\n    else if (loose && stringValue && !RE_NUMBER.test(stringValue)) {\n      (attrs.input as any).value = stringValue;\n    }\n\n    // number\n    else if (state.value || state.value === 0) {\n      (attrs.input as any).value = this._format(state.value);\n    }\n\n    // empty\n    else {\n      (attrs.input as any).value = \"\";\n    }\n\n    if (hasFormControl && !noStyle) {\n      Object.assign(attrs.wrap.style, css[\"wrap.hasFormControl\"]);\n    }\n\n    // mobile\n    if (mobile && !noStyle) {\n      Object.assign(attrs.input.style, css[\"input.mobile\"]);\n      Object.assign(attrs.btnUp.style, css[\"btnUp.mobile\"]);\n      Object.assign(attrs.btnDown.style, css[\"btnDown.mobile\"]);\n    }\n\n    // Attach event listeners if the widget is not disabled\n    if (!props.disabled && !props.readOnly) {\n      Object.assign(attrs.wrap, {\n        onMouseUp: this.stop,\n        onMouseLeave: this.stop,\n      });\n\n      Object.assign(attrs.btnUp, {\n        onTouchStart: this.onTouchStart.bind(this, \"up\"),\n        onTouchEnd: this.onTouchEnd,\n        onMouseEnter: () => {\n          this.setState({\n            btnUpHover: true,\n          });\n        },\n        onMouseLeave: () => {\n          this.stop();\n          this.setState({\n            btnUpHover: false,\n            btnUpActive: false,\n          });\n        },\n        onMouseUp: () => {\n          this.setState({\n            btnUpHover: true,\n            btnUpActive: false,\n          });\n        },\n        onMouseDown: (...args) => {\n          args[0].preventDefault();\n          args[0].persist();\n          this._inputFocus = true;\n          this.setState(\n            {\n              btnUpHover: true,\n              btnUpActive: true,\n            },\n            () => {\n              this._invokeEventCallback(\"onFocus\", ...args);\n              this.onMouseDown(\"up\");\n            }\n          );\n        },\n      });\n\n      Object.assign(attrs.btnDown, {\n        onTouchStart: this.onTouchStart.bind(this, \"down\"),\n        onTouchEnd: this.onTouchEnd,\n        onMouseEnter: () => {\n          this.setState({\n            btnDownHover: true,\n          });\n        },\n        onMouseLeave: () => {\n          this.stop();\n          this.setState({\n            btnDownHover: false,\n            btnDownActive: false,\n          });\n        },\n        onMouseUp: () => {\n          this.setState({\n            btnDownHover: true,\n            btnDownActive: false,\n          });\n        },\n        onMouseDown: (...args) => {\n          args[0].preventDefault();\n          args[0].persist();\n          this._inputFocus = true;\n          this.setState(\n            {\n              btnDownHover: true,\n              btnDownActive: true,\n            },\n            () => {\n              this._invokeEventCallback(\"onFocus\", ...args);\n              this.onMouseDown(\"down\");\n            }\n          );\n        },\n      });\n\n      Object.assign(attrs.input, {\n        onChange: (e) => {\n          const original = e.target.value;\n          let val: number | null = this._parse(original);\n          if (isNaN(val)) {\n            val = null;\n          }\n          this.setState({\n            value: this._isStrict ? this._toNumber(val) : val,\n            stringValue: original,\n          });\n        },\n        onKeyDown: this._onKeyDown.bind(this),\n        onInput: (...args) => {\n          this.saveSelection();\n          this._invokeEventCallback(\"onInput\", ...args);\n        },\n        onSelect: (...args) => {\n          this.saveSelection();\n          this._invokeEventCallback(\"onSelect\", ...args);\n        },\n        onFocus: (...args) => {\n          args[0].persist();\n          this._inputFocus = true;\n          const val = this._parse(args[0].target.value);\n          this.setState(\n            {\n              value: val,\n              stringValue: val || val === 0 ? val + \"\" : \"\",\n            },\n            () => {\n              this._invokeEventCallback(\"onFocus\", ...args);\n            }\n          );\n        },\n        onBlur: (...args) => {\n          let _isStrict = this._isStrict;\n          this._isStrict = true;\n          args[0].persist();\n          this._inputFocus = false;\n          const val = this._parse(args[0].target.value);\n          this.setState(\n            {\n              value: val,\n            },\n            () => {\n              this._invokeEventCallback(\"onBlur\", ...args);\n              this._isStrict = _isStrict;\n            }\n          );\n        },\n      });\n    } else {\n      if (!noStyle && props.disabled) {\n        Object.assign(attrs.input.style, css[\"input:disabled\"]);\n      }\n    }\n\n    const InputTag = componentClass || \"input\";\n\n    if (mobile) {\n      return (\n        <span {...attrs.wrap}>\n          <InputTag {...attrs.input} />\n          <b {...attrs.btnUp}>\n            <i style={noStyle ? null : css.minus} />\n            <i style={noStyle ? null : css.plus} />\n          </b>\n          <b {...attrs.btnDown}>\n            <i style={noStyle ? null : css.minus} />\n          </b>\n        </span>\n      );\n    }\n\n    return (\n      <span {...attrs.wrap}>\n        <InputTag {...attrs.input} />\n        <b {...attrs.btnUp}>\n          <i style={noStyle ? null : css.arrowUp} />\n        </b>\n        <b {...attrs.btnDown}>\n          <i style={noStyle ? null : css.arrowDown} />\n        </b>\n      </span>\n    );\n  }\n}\n","import {\n  faAlignCenter,\n  faAlignLeft,\n  faAlignRight,\n  faCheck,\n  faCircle,\n  faExclamationCircle,\n  faExclamationTriangle,\n  faPlay,\n  faSquare,\n  faSquareFull,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React from \"react\";\nimport { ColorResult, SwatchesPicker } from \"react-color\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport {\n  AppEvents,\n  AppEventType,\n  ChangeObject,\n  ChangeObjectsProperty,\n  ChangeSelectedObjectsAlignment,\n  ChangeUiSettings,\n  ClipboardCopy,\n  DuplicateObjects,\n  RemoveObjects,\n  SnapToLineType,\n} from \"../../controllers/AppEventType\";\nimport { getStore, setStore } from \"../../controllers/store\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport {\n  Editor,\n  Bead,\n  RegionShape,\n  Region,\n  BeadTypes,\n  BeadMaterialTypes,\n  ObjectTypes,\n} from \"../../editorObjects/Editor\";\nimport { ActionsTypes } from \"./ActionsTypes\";\nimport { NumericInput } from \"./NumericInput\";\nimport Slider from \"rc-slider\";\nimport \"rc-slider/assets/index.css\";\nimport { ChangeObjectsAlignmentHandler } from \"../../controllers/EventHandlers/ChangeObjectsAlignmentHandler\";\nimport { produce } from \"immer\";\nimport { refreshReactState } from \"../../controllers/refreshReactState\";\nimport { cloneDeep } from \"lodash\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { thumbnailsGenerator } from \"../../threejs/thumbnailsGenerator\";\n\nconst createSliderWithTooltip = Slider.createSliderWithTooltip;\nconst SliderPlus = createSliderWithTooltip(Slider);\n\nexport const PopupWrapper: React.FC<{\n  offsetLeft: number;\n  type: ActionsTypes;\n}> = (props) => {\n  let leftOffset = props.offsetLeft;\n  if (\n    props.type === ActionsTypes.EditRotate ||\n    props.type === ActionsTypes.EditPosition\n  ) {\n    leftOffset = props.offsetLeft - 150;\n  }\n  if (\n    props.type === ActionsTypes.EditWidthHeight ||\n    props.type === ActionsTypes.EditWidthHeightDepth\n  ) {\n    leftOffset = props.offsetLeft - 250;\n  }\n  return (\n    <PopupWrapperStyles>\n      <div\n        className={\"popup-wrapper\"}\n        style={{\n          left: leftOffset,\n        }}\n      >\n        {props.type === ActionsTypes.EditBeadColor ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadColorPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.More ? (\n          <div className={\"popup-wrapper-content\"}>\n            <MorePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRegionGridType ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRegionGridTypePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRegionGridSettings ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRegionGridSettingsPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditPosition ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditPositionPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRotate ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRotatePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditWidthHeight ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditWidthHeightPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditWidthHeightDepth ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditWidthHeightDepthPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.Alignment ? (\n          <div className={\"popup-wrapper-content\"}>\n            <AlignmentPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditBeadType ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadTypePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditBeadProduct ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadProductPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditBeadMaterial ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadMaterialPopup />\n          </div>\n        ) : null}\n\n        {!(\n          props.type === ActionsTypes.More ||\n          props.type === ActionsTypes.EditRegionGridType ||\n          props.type === ActionsTypes.EditPosition ||\n          props.type === ActionsTypes.EditRotate ||\n          props.type === ActionsTypes.EditWidthHeight ||\n          props.type === ActionsTypes.EditWidthHeightDepth ||\n          props.type === ActionsTypes.Alignment ||\n          props.type === ActionsTypes.EditRegionGridSettings ||\n          props.type === ActionsTypes.EditBeadType ||\n          props.type === ActionsTypes.EditBeadProduct ||\n          props.type === ActionsTypes.EditBeadMaterial ||\n          props.type === ActionsTypes.EditBeadColor\n        ) ? (\n          <div className={\"popup-wrapper-content\"}>\n            <div>popup of type: {props.type}</div>\n          </div>\n        ) : null}\n      </div>\n    </PopupWrapperStyles>\n  );\n};\n\nexport const PopupWrapperStyles = styled.div`\n  .popup-wrapper {\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    background: #fff;\n    transform: translate(-50%, 0);\n    margin-top: 8px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    padding: var(--standardPadding);\n  }\n  .region-type-selection {\n    display: flex;\n    column-gap: var(--standardPadding);\n  }\n  .region-type-item {\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n    &.active {\n      background: rgba(0, 0, 0, 0.1);\n    }\n    svg path {\n      transition: all 0.4s ease-in-out;\n    }\n    &:hover {\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .columns-input {\n    width: 120px;\n  }\n  .fieldset-wrapper fieldset {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    column-gap: var(--standardPadding);\n  }\n  .region-grid-settings {\n    display: flex;\n    flex-direction: column;\n    row-gap: var(--standardPadding);\n  }\n`;\n\nconst EditBeadColorPopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const backgroundColors = useSelector((state: Editor) => {\n    const colors: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const color = (state.objects[id] as Bead).color;\n      if (colors.includes(color) === false) {\n        colors.push(color);\n      }\n    });\n    return colors;\n  });\n\n  const onSelectColor = (color: ColorResult) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              color: color.hex,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <div>\n      <SwatchesPicker\n        width={300}\n        height={300}\n        onChangeComplete={onSelectColor}\n        color={backgroundColors.length > 1 ? undefined : backgroundColors[0]}\n      />\n    </div>\n  );\n};\n\nconst EditBeadTypePopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const types = useSelector((state: Editor) => {\n    const types: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const type = (state.objects[id] as Bead).type;\n      if (types.includes(type) === false) {\n        types.push(type);\n      }\n    });\n    return types;\n  });\n\n  const onSelect = (type: BeadTypes) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              type,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(BeadTypes.TOHO_MIYUKI);\n  };\n  const onSelectCircle = () => {\n    onSelect(BeadTypes.TOHO_SPHERE);\n  };\n  const onSelectTriangle = () => {\n    onSelect(BeadTypes.TOHO_15);\n  };\n  return (\n    <div style={{ display: \"flex\" }}>\n      <div\n        onClick={onSelectRectange}\n        className={`region-type-item ${\n          types.length === 1 && types[0] === BeadTypes.TOHO_MIYUKI\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        <FontAwesomeIcon icon={faSquareFull} />\n      </div>\n      <div\n        onClick={onSelectCircle}\n        className={`region-type-item ${\n          types.length === 1 && types[0] === BeadTypes.TOHO_SPHERE\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        <FontAwesomeIcon icon={faCircle} />\n      </div>\n      <div\n        onClick={onSelectTriangle}\n        className={`region-type-item ${\n          types.length === 1 && types[0] === BeadTypes.TOHO_15 ? \"active\" : \"\"\n        }`}\n      >\n        <FontAwesomeIcon icon={faSquare} />\n      </div>\n    </div>\n  );\n};\n\nconst EditBeadProductPopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const types = useSelector((state: Editor) => {\n    const types: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const type = (state.objects[id] as Bead).type;\n      if (types.includes(type) === false) {\n        types.push(type);\n      }\n    });\n    return types;\n  });\n  const onSelect = (type: BeadTypes) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              type,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(BeadTypes.TOHO_MIYUKI);\n  };\n  const onSelectCircle = () => {\n    onSelect(BeadTypes.TOHO_SPHERE);\n  };\n  const onSelectTriangle = () => {\n    onSelect(BeadTypes.TOHO_15);\n  };\n  const onSelectMore = () => {\n    const store = getStore();\n    const modalSearchProducts = cloneDeep(store.ui.modalSearchProducts);\n    modalSearchProducts.isOpen = true;\n    modalSearchProducts.successAction = \"updateBeadType\";\n    const event: ChangeUiSettings = {\n      name: AppEventType.ChangeUiSettings,\n      payload: {\n        uiSettings: {\n          modalSearchProducts,\n        },\n      },\n    };\n    sendEvent(event);\n  };\n  const bead1 = buildBead({ type: BeadTypes.TOHO_MIYUKI });\n  const bead2 = buildBead({ type: BeadTypes.TOHO_SPHERE });\n  const bead3 = buildBead({ type: BeadTypes.TOHO_15 });\n  // @TODO: doda ostatnio wybrane produkty do popup\n  return (\n    <div style={{ display: \"flex\", flexDirection: \"column\" }}>\n      <div style={{ display: \"flex\" }}>\n        <div\n          onClick={onSelectRectange}\n          className={`region-type-item ${\n            types.length === 1 && types[0] === BeadTypes.TOHO_MIYUKI\n              ? \"active\"\n              : \"\"\n          }`}\n        >\n          <img src={thumbnailsGenerator.getObjectThumbnail(bead1, 30, 30)} />\n        </div>\n        <div\n          onClick={onSelectCircle}\n          className={`region-type-item ${\n            types.length === 1 && types[0] === BeadTypes.TOHO_SPHERE\n              ? \"active\"\n              : \"\"\n          }`}\n        >\n          <img src={thumbnailsGenerator.getObjectThumbnail(bead2, 30, 30)} />\n        </div>\n        <div\n          onClick={onSelectTriangle}\n          className={`region-type-item ${\n            types.length === 1 && types[0] === BeadTypes.TOHO_15 ? \"active\" : \"\"\n          }`}\n        >\n          <img src={thumbnailsGenerator.getObjectThumbnail(bead3, 30, 30)} />\n        </div>\n      </div>\n\n      <div onClick={onSelectMore} style={{ cursor: \"pointer\" }}>\n        {/* @TRANS */}\n        Show all Products\n      </div>\n    </div>\n  );\n};\n\nconst EditBeadMaterialPopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const materialTypes = useSelector((state: Editor) => {\n    const types: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const type = (state.objects[id] as Bead).material;\n      if (types.includes(type) === false) {\n        types.push(type);\n      }\n    });\n    return types;\n  });\n\n  const onSelect = (material: BeadMaterialTypes) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              material,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(BeadMaterialTypes.Mat);\n  };\n  const onSelectCircle = () => {\n    onSelect(BeadMaterialTypes.Shiny);\n  };\n  return (\n    <div\n      style={{\n        width: 100,\n        display: \"flex\",\n        flexDirection: \"column\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n      }}\n    >\n      <div\n        onClick={onSelectRectange}\n        className={`region-type-item ${\n          materialTypes.length === 1 &&\n          materialTypes[0] === BeadMaterialTypes.Mat\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        {/* @TRANS */}\n        Mat\n      </div>\n      <div\n        onClick={onSelectCircle}\n        className={`region-type-item ${\n          materialTypes.length === 1 &&\n          materialTypes[0] === BeadMaterialTypes.Shiny\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        {/* @TRANS */}\n        Shine\n      </div>\n    </div>\n  );\n};\n\nconst EditRegionGridTypePopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n\n  const onSelect = (shape: RegionShape) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              shape,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(RegionShape.Rectangle);\n  };\n  // @TODO: doda kolejne ksztaty takie jak koo czy trojkt\n  //   const onSelectCircle = () => {\n  //     onSelect(RegionShape.Circle);\n  //   };\n  // const onSelectTriangle = () => {\n  //   onSelect(RegionShape.Triangle);\n  // };\n  return (\n    <div className={\"region-type-selection\"}>\n      <div onClick={onSelectRectange} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faSquare} />\n      </div>\n      {/* <div onClick={onSelectCircle} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faCircle} />\n      </div> */}\n      {/* <div onClick={onSelectTriangle} className={\"region-type-item\"}>\n        <FontAwesomeIcon\n          icon={faPlay}\n          style={{ transform: \"rotate(-90deg)\" }}\n        />\n      </div> */}\n    </div>\n  );\n};\n\nconst EditRegionGridSettingsPopup: React.FC<{}> = () => {\n  const { columns, rows } = useSelector((state: Editor) => {\n    const columns: number[] = [];\n    const rows: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (state.objects[id] === undefined) {\n        return;\n      }\n      if (state.objects[id].objectType !== ObjectTypes.Region) {\n        return;\n      }\n      const _columns = (state.objects[id] as Region).columns;\n      const _rows = (state.objects[id] as Region).rows;\n      if (columns.includes(_columns) === false) {\n        columns.push(_columns);\n      }\n      if (rows.includes(_rows) === false) {\n        rows.push(_rows);\n      }\n    });\n    return {\n      columns,\n      rows,\n    };\n  });\n\n  const onChangeRows = (values: number) => {\n    if (values === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const object = store.objects[id] as Region;\n          const change: ChangeObject = {\n            id,\n            properties: {\n              columns: object.columns,\n              rows: values,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeColumns = (values: number) => {\n    if (values === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const object = store.objects[id] as Region;\n          const change: ChangeObject = {\n            id,\n            properties: {\n              columns: values,\n              rows: object.rows,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div className={\"region-grid-settings\"}>\n      <div className={\"region-grid-settings-columns\"}>\n        <InputTypeNumber\n          defaultValue={columns.length > 1 ? undefined : columns[0]}\n          max={20}\n          min={1}\n          step={1}\n          showDecimal={false}\n          // @trans\n          label={\"Columns: \"}\n          onChange={onChangeColumns}\n        />\n      </div>\n      <div className={\"region-grid-settings-rows\"}>\n        <InputTypeNumber\n          max={20}\n          min={1}\n          step={1}\n          defaultValue={rows.length > 1 ? undefined : rows[0]}\n          showDecimal={false}\n          // @trans\n          label={\"Rows: \"}\n          onChange={onChangeRows}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst InputTypeNumber: React.FC<{\n  defaultValue: number | undefined;\n  label: string;\n  onChange: (values: number) => void;\n  min: number;\n  max: number;\n  step: number;\n  showDecimal: boolean;\n}> = (props) => {\n  function roundTo(n) {\n    var negative = false;\n    var digits = 2;\n    if (n < 0) {\n      negative = true;\n      n = n * -1;\n    }\n    var multiplicator = Math.pow(10, digits);\n    n = parseFloat((n * multiplicator).toFixed(11));\n    n = (Math.round(n) / multiplicator).toFixed(digits);\n    if (negative) {\n      n = (n * -1).toFixed(digits);\n    }\n    return n;\n  }\n\n  return (\n    <div>\n      <div className={\"fieldset-wrapper\"}>\n        <fieldset>\n          <label>{props.label}</label>\n          <NumericInput\n            min={props.min}\n            max={props.max}\n            step={props.step}\n            className={\"columns-input\"}\n            value={props.defaultValue}\n            strict={true}\n            onChange={props.onChange}\n            mobile={true}\n            format={props.showDecimal ? roundTo : undefined}\n            // parse={roundTo}\n          />\n        </fieldset>\n      </div>\n    </div>\n  );\n};\n\nconst EditPositionPopup: React.FC<{}> = (props) => {\n  const { x, y, z } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    const result_z: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _x = state.objects[id].position.x;\n      const _y = state.objects[id].position.y;\n      const _z = state.objects[id].position.z;\n      if (result_x.includes(_x) === false) {\n        result_x.push(_x);\n      }\n      if (result_y.includes(_y) === false) {\n        result_y.push(_y);\n      }\n      if (result_z.includes(_z) === false) {\n        result_z.push(_z);\n      }\n    });\n    return {\n      x: result_x,\n      y: result_y,\n      z: result_z,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const object = store.objects[id];\n          const change: ChangeObject = {\n            id,\n            properties: {\n              position: {\n                x: newValue,\n                y: object.position.y,\n                z: object.position.z,\n              },\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const object = store.objects[id];\n          const change: ChangeObject = {\n            id,\n            properties: {\n              position: {\n                x: object.position.x,\n                y: newValue,\n                z: object.position.z,\n              },\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  // const onChangeZ = (newValue: number) => {\n  //   if (newValue === undefined) {\n  //     return;\n  //   }\n  //   const store = getStore();\n  //   const event: ChangeObjectsProperty = {\n  //     name: AppEventType.ChangeObjectsProperty,\n  //     payload: {\n  //       changes: store.selectedIds.map((id) => {\n  //         if (!store.objects[id]) {\n  //           return {\n  //             id,\n  //             properties: {},\n  //           };\n  //         }\n  //         const object = store.objects[id];\n  //         const change: ChangeObject = {\n  //           id,\n  //           properties: {\n  //             position: {\n  //               x: object.position.x,\n  //               y: object.position.y,\n  //               z: newValue,\n  //             },\n  //           },\n  //         };\n  //         return change;\n  //       }),\n  //     },\n  //   };\n  //   sendEvent(event);\n  // };\n  return (\n    <div>\n      <span>Position: </span>\n      <br />\n      <InputTypeNumber\n        defaultValue={x.length > 1 ? undefined : x[0]}\n        min={-1000}\n        max={1000}\n        showDecimal={false}\n        step={0.1}\n        // @trans\n        label={\"X: \"}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={x.length > 1 ? 0 : x[0]}\n        onChange={onChangeX}\n        min={-1000}\n        max={1000}\n      />\n      <InputTypeNumber\n        defaultValue={y.length > 1 ? undefined : y[0]}\n        min={-1000}\n        max={1000}\n        showDecimal={false}\n        step={0.1}\n        // @trans\n        label={\"Y: \"}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={y.length > 1 ? 0 : y[0]}\n        onChange={onChangeY}\n        min={-1000}\n        max={1000}\n      />\n      {/* @TODO: doda obsluge zmiany position z */}\n      {/* <InputTypeNumber\n        defaultValue={z.length > 1 ? undefined : z[0]}\n        min={-500}\n        max={500}\n        // @trans\n        label={\"Z: \"}\n        onChange={onChangeZ}\n      />\n      <SliderWrapper value={z.length > 1 ? 0 : z[0]} onChange={onChangeZ}\n        min={-1000}\n        max={1000} /> */}\n    </div>\n  );\n};\n\nconst SliderWrapper: React.FC<{\n  value: number;\n  onChange: any;\n  min: number;\n  max: number;\n}> = (props) => {\n  const [value, setValue] = React.useState<number>(props.value);\n  return (\n    <div style={{ marginBottom: 8, marginTop: 8 }}>\n      <SliderPlus\n        step={1}\n        min={props.min}\n        max={props.max}\n        value={value}\n        onChange={(value) => {\n          setValue(value);\n        }}\n        onAfterChange={(value) => {\n          props.onChange(value);\n        }}\n      />\n    </div>\n  );\n};\n\nconst EditRotatePopup: React.FC<{}> = (props) => {\n  const { x, y, z } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    const result_z: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _x = state.objects[id].rotateX;\n      const _y = state.objects[id].rotateY;\n      const _z = state.objects[id].rotateZ;\n      if (result_x.includes(_x) === false) {\n        result_x.push(_x);\n      }\n      if (result_y.includes(_y) === false) {\n        result_y.push(_y);\n      }\n      if (result_z.includes(_z) === false) {\n        result_z.push(_z);\n      }\n    });\n    return {\n      x: result_x,\n      y: result_y,\n      z: result_z,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              rotateX: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              rotateY: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeZ = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              rotateZ: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div>\n      <span>Rotate: </span>\n      <br />\n      <InputTypeNumber\n        defaultValue={x.length > 1 ? undefined : x[0]}\n        min={-360}\n        max={360}\n        showDecimal={false}\n        step={1}\n        // @trans\n        label={\"X: \"}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={x.length > 1 ? 0 : x[0]}\n        onChange={onChangeX}\n        max={360}\n        min={-360}\n      />\n      <InputTypeNumber\n        defaultValue={y.length > 1 ? undefined : y[0]}\n        min={-360}\n        max={360}\n        showDecimal={false}\n        step={1}\n        // @trans\n        label={\"Y: \"}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={y.length > 1 ? 0 : y[0]}\n        onChange={onChangeY}\n        max={360}\n        min={-360}\n      />\n\n      <InputTypeNumber\n        defaultValue={z.length > 1 ? undefined : z[0]}\n        min={-360}\n        max={360}\n        step={1}\n        showDecimal={false}\n        // @trans\n        label={\"Z: \"}\n        onChange={onChangeZ}\n      />\n      <SliderWrapper\n        value={z.length > 1 ? 0 : z[0]}\n        onChange={onChangeZ}\n        max={360}\n        min={-360}\n      />\n    </div>\n  );\n};\n\nconst EditWidthHeightPopup: React.FC<{}> = (props) => {\n  const { width, height } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _width = state.objects[id].width;\n      const _height = state.objects[id].height;\n      if (result_x.includes(_width) === false) {\n        result_x.push(_width);\n      }\n      if (result_y.includes(_height) === false) {\n        result_y.push(_height);\n      }\n    });\n    return {\n      width: result_x,\n      height: result_y,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              width: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              height: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div>\n      <br />\n      <InputTypeNumber\n        defaultValue={width.length > 1 ? undefined : width[0]}\n        max={500}\n        min={1}\n        step={0.1}\n        showDecimal={true}\n        // @trans\n        label={\"Width: \"}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={width.length > 1 ? 0 : width[0]}\n        onChange={onChangeX}\n        max={500}\n        min={1}\n      />\n      <InputTypeNumber\n        defaultValue={height.length > 1 ? undefined : height[0]}\n        max={500}\n        min={1}\n        step={0.1}\n        showDecimal={true}\n        // @trans\n        label={\"Height: \"}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={height.length > 1 ? 0 : height[0]}\n        onChange={onChangeY}\n        max={500}\n        min={1}\n      />\n    </div>\n  );\n};\n\nconst EditWidthHeightDepthPopup: React.FC<{}> = (props) => {\n  const { width, height, depth } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    const result_z: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _x = state.objects[id].width;\n      const _y = state.objects[id].height;\n      const _z = state.objects[id].depth;\n      if (result_x.includes(_x) === false) {\n        result_x.push(_x);\n      }\n      if (result_y.includes(_y) === false) {\n        result_y.push(_y);\n      }\n      if (result_z.includes(_z) === false) {\n        result_z.push(_z);\n      }\n    });\n    return {\n      width: result_x,\n      height: result_y,\n      depth: result_z,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              width: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              height: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeZ = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              depth: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div>\n      <span>Size: </span>\n      <br />\n      <InputTypeNumber\n        defaultValue={width.length > 1 ? undefined : width[0]}\n        min={1}\n        max={500}\n        showDecimal={true}\n        step={0.1}\n        // @trans\n        label={\"Width: \"}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={width.length > 1 ? 0 : width[0]}\n        onChange={onChangeX}\n        min={1}\n        max={500}\n      />\n      <InputTypeNumber\n        defaultValue={height.length > 1 ? undefined : height[0]}\n        min={1}\n        max={500}\n        showDecimal={true}\n        step={0.1}\n        // @trans\n        label={\"Height: \"}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={height.length > 1 ? 0 : height[0]}\n        onChange={onChangeY}\n        min={1}\n        max={500}\n      />\n\n      <InputTypeNumber\n        defaultValue={depth.length > 1 ? undefined : depth[0]}\n        min={1}\n        max={500}\n        showDecimal={true}\n        step={0.1}\n        // @trans\n        label={\"Depth: \"}\n        onChange={onChangeZ}\n      />\n      <SliderWrapper\n        value={depth.length > 1 ? 0 : depth[0]}\n        onChange={onChangeZ}\n        min={1}\n        max={500}\n      />\n    </div>\n  );\n};\n\nconst AlignmentPopup: React.FC<{}> = (props) => {\n  const sendSnapTo = (snapType: SnapToLineType) => {\n    const store = getStore();\n\n    const event: ChangeSelectedObjectsAlignment = {\n      name: AppEventType.ChangeObjectsAlignment,\n      payload: {\n        selectedIds: store.selectedIds,\n        snapType,\n      },\n    };\n    sendEvent(event);\n  };\n\n  const onClickAlighXLeft = () => {\n    sendSnapTo(SnapToLineType.X_MIN);\n  };\n  const onClickAlighXMiddle = () => {\n    sendSnapTo(SnapToLineType.X_MIDDLE);\n  };\n  const onClickAlighXRight = () => {\n    sendSnapTo(SnapToLineType.X_MAX);\n  };\n  const onClickAlighYLeft = () => {\n    sendSnapTo(SnapToLineType.Y_MIN);\n  };\n  const onClickAlighYMiddle = () => {\n    sendSnapTo(SnapToLineType.Y_MIDDLE);\n  };\n  const onClickAlighYRight = () => {\n    sendSnapTo(SnapToLineType.Y_MAX);\n  };\n  const uiButton = getComputedStyle(document.body).getPropertyValue(\n    \"--uiButton\"\n  );\n  return (\n    <div>\n      X: <br />\n      <button onClick={onClickAlighXLeft}>\n        <FontAwesomeIcon icon={faAlignLeft} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighXMiddle}>\n        <FontAwesomeIcon icon={faAlignCenter} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighXRight}>\n        <FontAwesomeIcon icon={faAlignRight} color={uiButton} size={\"lg\"} />\n      </button>\n      <br />\n      <br />\n      Y: <br />\n      <button onClick={onClickAlighYLeft}>\n        <FontAwesomeIcon icon={faAlignLeft} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighYMiddle}>\n        <FontAwesomeIcon icon={faAlignCenter} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighYRight}>\n        <FontAwesomeIcon icon={faAlignRight} color={uiButton} size={\"lg\"} />\n      </button>\n    </div>\n  );\n};\n\nconst MorePopup: React.FC<{}> = (props) => {\n  const onlyRegionsInfo = useSelector((state: Editor) => {\n    let snapToCellChecked: \"allFalse\" | \"mixed\" | \"allTrue\" | \"unknow\" =\n      \"unknow\";\n    let autoFillChecked: \"allFalse\" | \"mixed\" | \"allTrue\" | \"unknow\" = \"unknow\";\n    let regionIds: string[] = [];\n    let onlyRegions: boolean = state.selectedIds.length > 0 ? true : false;\n    for (let i = 0; i < state.selectedIds.length; i++) {\n      const id = state.selectedIds[i];\n      if (state.objects[id] === undefined) {\n        continue;\n      }\n      const objectType = state.objects[id].objectType;\n      if (objectType !== ObjectTypes.Region) {\n        onlyRegions = false;\n        break;\n      }\n\n      const _value1 = (state.objects[id] as Region).snapBeadsToCell;\n      if (snapToCellChecked === \"unknow\") {\n        snapToCellChecked = _value1 === true ? \"allTrue\" : \"allFalse\";\n      } else {\n        if (snapToCellChecked === \"allTrue\" && _value1 === false) {\n          snapToCellChecked = \"mixed\";\n        } else if (snapToCellChecked === \"allFalse\" && _value1 === true) {\n          snapToCellChecked = \"mixed\";\n        }\n      }\n\n      const _value2 = (state.objects[id] as Region).autoFillBeads;\n      if (autoFillChecked === \"unknow\") {\n        autoFillChecked = _value2 === true ? \"allTrue\" : \"allFalse\";\n      } else {\n        if (autoFillChecked === \"allTrue\" && _value2 === false) {\n          autoFillChecked = \"mixed\";\n        } else if (autoFillChecked === \"allFalse\" && _value2 === true) {\n          autoFillChecked = \"mixed\";\n        }\n      }\n\n      regionIds.push(id);\n    }\n    return { onlyRegions, snapToCellChecked, autoFillChecked, regionIds };\n  });\n\n  const onClickDuplicate = () => {\n    const store = getStore();\n    const event: DuplicateObjects = {\n      name: AppEventType.DuplicateObjects,\n      payload: {\n        objects: store.selectedIds.map((id) => store.objects[id]),\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickDelete = () => {\n    const store = getStore();\n    const event: RemoveObjects = {\n      name: AppEventType.RemoveObjects,\n      payload: {\n        ids: store.selectedIds,\n      },\n    };\n    sendEvent(event);\n  };\n  // const onClickCopy = () => {\n  //   const event: ClipboardCopy = {\n  //     name: AppEventType.ClipboardCopy,\n  //     payload: {},\n  //   };\n  //   sendEvent(event);\n  // };\n  const onClickAutofill = () => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: onlyRegionsInfo.regionIds.map((id) => {\n          let newValue: boolean = true;\n          if (onlyRegionsInfo.autoFillChecked === \"allTrue\") {\n            newValue = false;\n          } else if (onlyRegionsInfo.autoFillChecked === \"allFalse\") {\n            newValue = true;\n          } else {\n            newValue = true;\n          }\n          return {\n            id,\n            properties: {\n              autoFillBeads: newValue,\n            },\n          };\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickSnaptocell = () => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: onlyRegionsInfo.regionIds.map((id) => {\n          let newValue: boolean = true;\n          if (onlyRegionsInfo.snapToCellChecked === \"allTrue\") {\n            newValue = false;\n          } else if (onlyRegionsInfo.snapToCellChecked === \"allFalse\") {\n            newValue = true;\n          } else {\n            newValue = true;\n          }\n          return {\n            id,\n            properties: {\n              snapBeadsToCell: newValue,\n            },\n          };\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        minWidth: 220,\n      }}\n    >\n      {onlyRegionsInfo.onlyRegions === true ? (\n        <React.Fragment>\n          {/* @TRANS */}\n          <div onClick={onClickAutofill}>\n            <span>Autofill</span>\n            {onlyRegionsInfo.autoFillChecked === \"allTrue\" ? (\n              <FontAwesomeIcon icon={faCheck} color={\"#000\"} />\n            ) : null}\n            {onlyRegionsInfo.autoFillChecked === \"mixed\" ? (\n              <FontAwesomeIcon icon={faExclamationCircle} color={\"#444\"} />\n            ) : null}\n          </div>\n\n          {/* @TRANS */}\n          <div onClick={onClickSnaptocell}>\n            <span>Snap to cell</span>\n            {onlyRegionsInfo.snapToCellChecked === \"allTrue\" ? (\n              <FontAwesomeIcon icon={faCheck} color={\"#000\"} />\n            ) : null}\n\n            {onlyRegionsInfo.snapToCellChecked === \"mixed\" ? (\n              <FontAwesomeIcon icon={faExclamationCircle} color={\"#444\"} />\n            ) : null}\n          </div>\n        </React.Fragment>\n      ) : null}\n      {/* <div onClick={onClickCopy}>Copy</div> */}\n      {/* @TRANS */}\n      <div onClick={onClickDuplicate}>Duplicate</div>\n      {/* @TRANS */}\n      <div onClick={onClickDelete}>Delete</div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Bead, Editor, Group, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { Actions, ActionsTypes, MapActionObjectType } from \"./ActionsTypes\";\nimport { ActionsIconsWrapper } from \"./ActionsIconsWrapper\";\nimport { PopupWrapper } from \"./PopupWrapper\";\nimport { getStore } from \"../../controllers/store\";\n\nexport const TopBarContent: React.FC<{ x: number; y: number }> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const actionsGrouped = useSelector((state: Editor) => {\n    const selectedActions: ActionsTypes[] = [];\n    state.selectedIds.forEach((id) => {\n      if (state.objects[id]) {\n        const objectType = state.objects[id].objectType;\n        const actionsForType = MapActionObjectType[objectType];\n        if (selectedActions.length === 0) {\n          actionsForType.forEach((action) => {\n            selectedActions.push(action);\n          });\n        } else {\n          for (let i = selectedActions.length - 1; i >= 0; i--) {\n            const action = selectedActions[i];\n            if (actionsForType.includes(action) === false) {\n              selectedActions.splice(selectedActions.indexOf(action), 1);\n            }\n          }\n        }\n      }\n    });\n    const result: ActionsTypes[][] = [];\n    let groupedResults: { [key: string]: ActionsTypes[] } = {};\n    selectedActions.forEach((action) => {\n      if (Actions[action]) {\n        if (action === ActionsTypes.Alignment) {\n          if (state.selectedIds.length === 1) {\n            return;\n          }\n        }\n        if (action === ActionsTypes.Lock || action === ActionsTypes.Unlock) {\n          if (state.selectedIds.length === 1) {\n            const id = state.selectedIds[0];\n            const obj = state.objects[id];\n            if (obj.isLocked === true) {\n              groupedResults = {};\n              groupedResults[Actions[ActionsTypes.Unlock].groupId] = [\n                ActionsTypes.Unlock,\n              ];\n              return false;\n            }\n            if (obj.isLocked === false && action === ActionsTypes.Unlock) {\n              return;\n            }\n          } else {\n            let containsLockedGroup: any = false;\n            state.selectedIds.forEach((objectId) => {\n              if (state.objects[objectId] === undefined) {\n                return;\n              }\n\n              const isGroup =\n                state.objects[objectId].objectType === ObjectTypes.Group;\n              const groupIdKey: keyof Bead = \"groupId\";\n              const isInGroup =\n                state.objects[objectId][groupIdKey] !== undefined &&\n                state.objects[objectId][groupIdKey]!.length > 0;\n              const groupId = state.objects[objectId][groupIdKey]!;\n              if (isGroup) {\n                const obj = state.objects[objectId];\n                if (obj.isLocked === true) {\n                  groupedResults = {};\n                  groupedResults[Actions[ActionsTypes.Unlock].groupId] = [\n                    ActionsTypes.Unlock,\n                  ];\n                  containsLockedGroup = true;\n                  return false;\n                }\n                if (obj.isLocked === false && action === ActionsTypes.Unlock) {\n                  containsLockedGroup = true;\n                  return;\n                }\n              } else if (isInGroup) {\n                const obj = state.objects[groupId];\n                if (obj.isLocked === true) {\n                  groupedResults = {};\n                  groupedResults[Actions[ActionsTypes.Unlock].groupId] = [\n                    ActionsTypes.Unlock,\n                  ];\n                  containsLockedGroup = true;\n                  return false;\n                }\n                if (obj.isLocked === false && action === ActionsTypes.Unlock) {\n                  containsLockedGroup = true;\n                  return;\n                }\n              }\n            });\n            if (containsLockedGroup === true) {\n              return;\n            } else {\n              if (action === ActionsTypes.Unlock) {\n                return;\n              }\n            }\n          }\n        }\n        if (action === ActionsTypes.Group || action === ActionsTypes.Ungroup) {\n          if (state.selectedIds.length === 1) {\n            return;\n          } else {\n            //@TODO: zmienic typ z any na boolean\n            let containsRegion: any = false;\n            let anySelectedBeadInRegion: any = false;\n\n            // let containsGroup: any = false;\n            // let allCount: any = state.selectedIds.length;\n            let groupCount: any = 0;\n            let inGroupCount: any = 0;\n            let noGroupCount: any = 0;\n\n            state.selectedIds.forEach((objectId) => {\n              if (containsRegion === true) {\n                return;\n              }\n              if (anySelectedBeadInRegion === true) {\n                return;\n              }\n              if (state.objects[objectId] === undefined) {\n                return;\n              }\n              if (state.objects[objectId].objectType === ObjectTypes.Region) {\n                containsRegion = true;\n                return;\n              }\n\n              if (state.objects[objectId].objectType === ObjectTypes.Bead) {\n                if ((state.objects[objectId] as Bead).regionId !== undefined) {\n                  anySelectedBeadInRegion = true;\n                  return;\n                }\n              }\n\n              const isGroup =\n                state.objects[objectId].objectType === ObjectTypes.Group;\n\n              const groupIdKey: keyof Bead = \"groupId\";\n              const isInGroup =\n                state.objects[objectId][groupIdKey] !== undefined &&\n                state.objects[objectId][groupIdKey]!.length > 0;\n              if (isGroup) {\n                groupCount = groupCount + 1;\n              } else if (isInGroup) {\n                inGroupCount = inGroupCount + 1;\n              } else {\n                noGroupCount = noGroupCount + 1;\n              }\n            });\n\n            if (containsRegion === true) {\n              return;\n            }\n\n            if (anySelectedBeadInRegion === true) {\n              return;\n            }\n\n            // console.log(\n            //   \"------------- jak jest?\",\n            //   allCount,\n            //   groupCount,\n            //   inGroupCount,\n            //   noGroupCount\n            // );\n            if (noGroupCount === 0 && groupCount > 0) {\n              if (action === ActionsTypes.Group) {\n                return;\n              }\n            } else if (groupCount > 0 || inGroupCount > 0) {\n              // do nothing\n            } else {\n              if (action === ActionsTypes.Ungroup) {\n                return;\n              }\n            }\n          }\n        }\n        if (!groupedResults[Actions[action].groupId]) {\n          groupedResults[Actions[action].groupId] = [action];\n        } else {\n          groupedResults[Actions[action].groupId].push(action);\n        }\n      }\n    });\n    Object.keys(groupedResults)\n      .sort((groupIdA, groupIdB) => {\n        const firstActionA = groupedResults[groupIdA][0];\n        const firstActionB = groupedResults[groupIdB][0];\n        const groupSortOrderA = Actions[firstActionA].groupSortOrder;\n        const groupSortOrderB = Actions[firstActionB].groupSortOrder;\n        return groupSortOrderA === groupSortOrderB\n          ? 0\n          : groupSortOrderA > groupSortOrderB\n          ? 1\n          : -1;\n      })\n      .forEach((groupId) => {\n        const actions = groupedResults[groupId].sort((actionA, actionB) => {\n          return Actions[actionA].sortOrder === Actions[actionB].sortOrder\n            ? 0\n            : Actions[actionA].sortOrder > Actions[actionB].sortOrder\n            ? 1\n            : -1;\n        });\n        result.push(actions);\n      });\n    return result;\n  });\n  const [popupInfo, setPopupInfo] = React.useState<{\n    isOpen: boolean;\n    type: ActionsTypes | undefined;\n    offsetLeft: number;\n  }>({\n    isOpen: false,\n    type: undefined,\n    offsetLeft: 0,\n  });\n  const onClickAnyIcon = (type: ActionsTypes, offsetLeft: number) => {\n    const newValue = type === popupInfo.type ? !popupInfo.isOpen : true;\n    setPopupInfo({\n      isOpen: newValue,\n      type,\n      offsetLeft,\n    });\n  };\n\n  React.useEffect(() => {\n    setPopupInfo({\n      isOpen: false,\n      type: undefined,\n      offsetLeft: 0,\n    });\n  }, [selectedIds]);\n\n  return (\n    <div\n      className={`selected-objects-top-bar`}\n      style={{\n        top: props.y,\n        left: props.x,\n      }}\n    >\n      <div className={\"content-wrapper\"}>\n        <div className={\"action-icons-wrapper\"}>\n          {actionsGrouped.map((actions, index) => {\n            return (\n              <ActionsIconsWrapper\n                key={index}\n                actions={actions}\n                onClick={onClickAnyIcon}\n                selectedAction={\n                  popupInfo.isOpen === true && popupInfo.type !== undefined\n                    ? popupInfo.type\n                    : undefined\n                }\n              />\n            );\n          })}\n        </div>\n\n        {popupInfo.isOpen === true && popupInfo.type !== undefined ? (\n          <PopupWrapper\n            offsetLeft={popupInfo.offsetLeft}\n            type={popupInfo.type}\n          />\n        ) : null}\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Bead, Editor } from \"../../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport { TopBarContent } from \"./TopBarContent\";\n\nexport const SelectedObjectsTopBar: React.FC<{}> = (props) => {\n  const selectedTopBarPosition = useSelector((state: Editor) => {\n    return state.ui.selectedTopBarPosition;\n  });\n\n  if (selectedTopBarPosition === undefined) {\n    return null;\n  }\n\n  return (\n    <SelectedObjectsTopBarStyles\n      style={{\n        zIndex:\n          selectedTopBarPosition === undefined\n            ? \"-5\"\n            : (\"var(--zIndexSelectedObjectsTopBar)\" as any),\n      }}\n    >\n      {selectedTopBarPosition !== undefined ? (\n        <TopBarContent\n          x={selectedTopBarPosition.x}\n          y={selectedTopBarPosition.y}\n        />\n      ) : null}\n    </SelectedObjectsTopBarStyles>\n  );\n};\n\nexport const SelectedObjectsTopBarStyles = styled.div`\n  .selected-objects-top-bar {\n    position: fixed;\n    z-index: var(--zIndexSelectedObjectsTopBar);\n  }\n\n  .content-wrapper {\n    position: absolute;\n    left: 50%;\n    transform: translate(-50%, -65px);\n    height: 55px;\n    padding: 0 12px;\n    background: #fff;\n    border-radius: 4;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n  }\n  .action-icons-wrapper {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    column-gap: calc(var(--standardPadding) * 2);\n    width: 100%;\n    height: 100%;\n  }\n\n  .action-icons-wrapper > div:nth-last-child(1) .actions-group:before {\n    background: transparent;\n  }\n\n  .action-icons-wrapper > div:first-child .actions-group:before {\n    background: transparent;\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faTimes } from \"@fortawesome/free-solid-svg-icons\";\nimport { getStore, setStore } from \"../controllers/store\";\nimport produce from \"immer\";\nimport { refreshReactState } from \"../controllers/refreshReactState\";\nimport styled from \"styled-components\";\n\nexport const EditProjectModal: React.FC<{}> = () => {\n  const project = useSelector((state: Editor) => {\n    return state.board;\n  });\n  const [name, setName] = React.useState(project?.name ?? \"\");\n  if (!project) {\n    return <React.Fragment />;\n  }\n  if (project.editModalVisible === false) {\n    return <React.Fragment />;\n  }\n  const onClickCancel = () => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.editModalVisible = false;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const setNewProjectName = (newName: string) => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.name = newName;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n\n  return (\n    <EditProjectModalStyles>\n      <div className={\"edit-modal-popup\"}>\n        <div className={\"edit-modal-popup-overlay\"} onClick={onClickCancel}>\n          &nbsp;\n        </div>\n        <div className={\"edit-modal-popup-content-wrapper\"}>\n          <div className={\"edit-modal-popup-content\"}>\n            <div className={\"btn-cancel\"} onClick={onClickCancel}>\n              <FontAwesomeIcon icon={faTimes} color={\"#000\"} />\n            </div>\n\n            <h2>Edycja projektu</h2>\n            <div>\n              <input\n                name={\"name\"}\n                className={\"input\"}\n                value={name}\n                onChange={(event) => {\n                  setName(event.target.value);\n                }}\n                onBlur={(event) => {\n                  const newName = event.target.value;\n                  if (newName.length > 0) {\n                    setNewProjectName(newName);\n                  }\n                }}\n              />\n            </div>\n\n            <div className={\"actions\"}></div>\n          </div>\n        </div>\n      </div>\n    </EditProjectModalStyles>\n  );\n};\n\nexport const EditProjectModalStyles = styled.div`\n  .edit-modal-popup {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 100;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    overflow-x: hidden;\n    overflow-y: auto;\n  }\n  .edit-modal-popup-overlay {\n    background: rgba(0, 0, 0, 0.4);\n    transition: all 0.4s ease-in-out;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n  .edit-modal-popup-content-wrapper {\n    position: absolute;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100%;\n  }\n  .edit-modal-popup-content {\n    background: #fff;\n    padding: 32px;\n    width: 520px;\n    box-sizing: border-box;\n    transition: all 0.25s ease-out;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    transition: all 0.4s ease-in-out;\n    z-index: 2;\n    position: relative;\n  }\n  .actions {\n    display: flex;\n    justify-content: flex-end;\n  }\n  .btn-cancel {\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 5;\n    width: 45px;\n    height: 45px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    /* border: 1px solid #eee; */\n    /* color: #000; */\n    /* padding: 10px 15px; */\n    /* border-radius: 4px; */\n    /* width: 90px; */\n    cursor: pointer;\n  }\n  .input {\n    border: none;\n    border-bottom: 1px solid rgba(5, 0, 56, 0.2);\n    padding: 8px 0 4px;\n    font-size: 24px;\n    transition: all 0.4s ease-in-out;\n    border-radius: 0;\n    box-shadow: none;\n    margin-bottom: 10px;\n\n    &:hover {\n      border-bottom-color: rgba(5, 0, 56, 0.4);\n    }\n    &:focus {\n      border-bottom-color: var(--uiButtonActive);\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faReply,\n  faStar as faStarSolid,\n  faUpload,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { faStar as faStarRegular } from \"@fortawesome/free-regular-svg-icons\";\nimport { redoHistory, undoHistory } from \"../controllers/AppHistory\";\nimport { getStore, setStore } from \"../controllers/store\";\nimport produce from \"immer\";\nimport { refreshReactState } from \"../controllers/refreshReactState\";\nimport { appThree } from \"../threejs/renderThreejs\";\nimport styled from \"styled-components\";\nimport { Link } from \"react-router-dom\";\n\nexport const ProjectInfoWrapper: React.FC<{}> = (props) => {\n  const { canRedo, canUndo } = useSelector((state: Editor) => {\n    const { canRedo, canUndo } = state.history;\n    return {\n      canRedo,\n      canUndo,\n    };\n  });\n  const board = useSelector((state: Editor) => {\n    return state.board;\n  });\n  const onClickRedo = () => {\n    if (canRedo) {\n      redoHistory();\n    }\n  };\n  const onClickUndo = () => {\n    if (canUndo) {\n      undoHistory();\n    }\n  };\n  const onClickName = () => {\n    if (!board) {\n      return;\n    }\n    if (!board.canToggleToFavourite) {\n      return;\n    }\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.editModalVisible = true;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const onClickLogo = () => {\n    // window.alert(\"back to home\");\n  };\n  const onClickFavourite = () => {\n    if (!board) {\n      return;\n    }\n    if (!board.canToggleToFavourite) {\n      return;\n    }\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.isFavourite = !draft.board.isFavourite;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const onClickExportAsImage = () => {\n    try {\n      const content = appThree.renderer.domElement\n        .toDataURL(\"image/png\")\n        .replace(\"image/png\", \"image/octet-stream\");\n      const link = document.createElement(\"a\");\n      document.body.appendChild(link);\n      link.download = \"coralinio-preview.png\";\n      link.href = content;\n      link.click();\n      document.body.removeChild(link);\n    } catch (e) {\n      console.log(e);\n      return;\n    }\n  };\n\n  return (\n    <ProjectInfoWrapperStyles>\n      <div className={\"project-info-wrapper\"}>\n        <div className={\"block-with-info\"}>\n          <div\n            className=\"coralinio-logo\"\n            onClick={onClickLogo}\n            // @TRANSLATION\n            data-tip={\"Back to Home\"}\n            data-place={\"bottom\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <Link to=\"/\">coralinio</Link>\n            </div>\n          </div>\n\n          {board?.name ? (\n            <div\n              className={\"project-name\"}\n              onClick={onClickName}\n              data-tip={board?.name ?? \"\"}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <div className={\"value\"}>{board?.name ?? \"\"}</div>\n            </div>\n          ) : null}\n\n          {board?.canToggleToFavourite ? (\n            <div\n              className={\"add-to-fav\"}\n              onClick={onClickFavourite}\n              // @TRANSLATION\n              data-tip={\n                board.isFavourite === true\n                  ? \"Remove from favourite\"\n                  : \"Add to favourite\"\n              }\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <FontAwesomeIcon\n                icon={board.isFavourite ? faStarSolid : faStarRegular}\n              />\n            </div>\n          ) : null}\n\n          {board?.canExportAsImage ? (\n            <div\n              className={\"export-as-image\"}\n              onClick={onClickExportAsImage}\n              // @TRANSLATION\n              data-tip={\"Export as Image\"}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <FontAwesomeIcon icon={faUpload} />\n            </div>\n          ) : null}\n        </div>\n\n        {canRedo || canUndo ? (\n          <div className={\"block-with-history\"}>\n            <div\n              className={`undo-button ${canUndo ? \"active\" : \"inactive\"}`}\n              onClick={onClickUndo}\n              // @TRANSLATION\n              data-tip={\"UNDO\"}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <span className=\"icon\">\n                <FontAwesomeIcon icon={faReply} />\n              </span>\n            </div>\n\n            <div\n              className={`redo-button ${canRedo ? \"active\" : \"inactive\"} `}\n              onClick={onClickRedo}\n              // @TRANSLATION\n              data-tip={\"REDO\"}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <span className=\"icon\">\n                <FontAwesomeIcon\n                  icon={faReply}\n                  style={{ transform: \"scaleX(-1)\" }}\n                />\n              </span>\n            </div>\n          </div>\n        ) : null}\n      </div>\n    </ProjectInfoWrapperStyles>\n  );\n};\n\nexport const ProjectInfoWrapperStyles = styled.div`\n  .project-info-wrapper {\n    position: absolute;\n    top: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: 10;\n    display: flex;\n    column-gap: calc(var(--standardPadding) * 2);\n    transition: all 0.4s ease-in-out;\n  }\n  .block-with-info {\n    background: #fff;\n    height: 55px;\n    display: flex;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n    column-gap: calc(var(--standardPadding) * 2);\n\n    .coralinio-logo {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      .value {\n        width: 120px;\n        transition: all 0.4s ease-in-out;\n        a {\n          transition: all 0.4s ease-in-out;\n          font-size: 29px;\n          font-family: \"Fredoka One\", cursive;\n          font-weight: 400;\n          text-transform: lowercase;\n          color: var(--uiButton);\n        }\n        &:hover a {\n          color: var(--uiButtonActive);\n        }\n      }\n    }\n    .project-name {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: \"\";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      .value {\n        font-size: 20px;\n        max-width: 200px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        font-family: \"Open Sans\", sans-serif;\n        font-weight: 400;\n      }\n    }\n    .add-to-fav {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: \"\";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n    .export-as-image {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: \"\";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n  }\n\n  .block-with-history {\n    display: flex;\n    background: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 55px;\n\n    .redo-button,\n    .undo-button {\n      width: 45px;\n      height: 100%;\n      padding-left: calc(var(--standardPadding) * 2);\n      padding-right: calc(var(--standardPadding) * 2);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &.active:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n      &.inactive {\n        svg path {\n          fill: var(--uiButtonInActive);\n        }\n      }\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faMinus, faPlus } from \"@fortawesome/free-solid-svg-icons\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport {\n  AppEventType,\n  ChangeUiSettingsZoom,\n} from \"../controllers/AppEventType\";\nimport styled from \"styled-components\";\n\nexport const MinimapWrapper: React.FC<{}> = (props) => {\n  const { zoomScale } = useSelector((state: Editor) => {\n    const { zoomScale } = state.ui;\n    return {\n      zoomScale,\n    };\n  });\n  const onClickPlus = () => {\n    const updateUiEvent: ChangeUiSettingsZoom = {\n      name: AppEventType.ChangeUiSettingsZoom,\n      payload: {\n        zoomType: \"zoomInScreenCenter\",\n        useAnimation: true,\n      },\n    };\n    sendEvent(updateUiEvent);\n  };\n  const onClickMinus = () => {\n    const updateUiEvent: ChangeUiSettingsZoom = {\n      name: AppEventType.ChangeUiSettingsZoom,\n      payload: {\n        zoomType: \"zoomOutScreenCenter\",\n        useAnimation: true,\n      },\n    };\n    sendEvent(updateUiEvent);\n  };\n  return (\n    <MinimapWrapperStyles>\n      <div className={\"minimap-wrapper\"}>\n        <div className={\"minimap-wrapper-content\"}>\n          <div\n            className={\"item\"}\n            onClick={onClickMinus}\n            // @TRANSLATION\n            data-tip={\"Zoom Out\"}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon icon={faMinus} />\n            </div>\n          </div>\n          <div\n            className={\"item\"}\n            onClick={onClickPlus}\n            // @TRANSLATION\n            data-tip={`Zoom In`}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon icon={faPlus} />\n            </div>\n          </div>\n          <div\n            className={\"item-text\"}\n            // @TRANSLATION\n            data-tip={`Zoom percentage`}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>{Math.round((1 / zoomScale) * 100)}%</div>\n          </div>\n        </div>\n      </div>\n    </MinimapWrapperStyles>\n  );\n};\n\nexport const MinimapWrapperStyles = styled.div`\n  .minimap-wrapper {\n    position: absolute;\n    z-index: var(--zIndexMinimap);\n    bottom: var(--standardPadding);\n    right: var(--standardPadding);\n    transition: all 0.4s ease-in-out;\n    width: var(--minimapWidth);\n  }\n  .minimap-wrapper-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding) / 2;\n  }\n  .item {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 45px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    cursor: pointer;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .item-text {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 70px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    font-size: 18px;\n    font-weight: 600;\n  }\n`;\n","import React from \"react\";\nimport { Bead, Editor, ObjectTypes } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { thumbnailsGenerator } from \"../threejs/thumbnailsGenerator\";\nimport { cloneDeep } from \"lodash\";\n\nexport const BeadsSummary: React.FC<{}> = () => {\n  const { groupedCount } = useSelector((state: Editor) => {\n    const groups: {\n      [key: string]: {\n        count: number;\n        example: Bead;\n        textName: string;\n        textTooltip: string;\n      };\n    } = {};\n    Object.keys(state.objects).forEach((id) => {\n      if (state.objects[id].objectType === ObjectTypes.Bead) {\n        const bead = state.objects[id] as Bead;\n        const groupData: any = {\n          width: bead.width,\n          height: bead.height,\n          depth: bead.depth,\n          // rotateX: bead.rotateX,\n          // rotateY: bead.rotateY,\n          // rotateZ: bead.rotateZ,\n          type: bead.type,\n          color: bead.color,\n        };\n        const groupId = JSON.stringify(groupData);\n\n        if (groups[groupId] === undefined) {\n          const item = cloneDeep(bead) as Bead;\n          item.rotateX = 90;\n          item.rotateY = 0;\n          item.rotateZ = 0;\n          groups[groupId] = {\n            count: 1,\n            example: item,\n            textName: `${item.color}`,\n            textTooltip: `${item.color} - 1x`,\n          };\n        } else {\n          const newCount = groups[groupId].count + 1;\n          groups[groupId].count = newCount;\n          groups[groupId].textTooltip = `${bead.color} - ${newCount}x`;\n        }\n      }\n    });\n    const groupedCount: {\n      count: number;\n      example: Bead;\n      textName: string;\n      textTooltip: string;\n      textCount: string;\n    }[] = [];\n    const maxGroups = 10;\n    Object.keys(groups).forEach((id, index) => {\n      if (index > maxGroups) {\n        return;\n      }\n      const group = groups[id];\n      const textCount = `${group.count}x`;\n      groupedCount.push({\n        count: group.count,\n        example: group.example,\n        textName: group.textName,\n        textTooltip: group.textName,\n        textCount,\n      });\n    });\n    return {\n      groupedCount,\n    };\n  });\n  const onClickOpenObjectsPanel = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        panel: \"objects\",\n        open: true,\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <BeadsSummaryStyles>\n      <div className={\"beads-summary\"}>\n        <div\n          className={\"beads-summary-content\"}\n          onClick={onClickOpenObjectsPanel}\n        >\n          {groupedCount.map((group, index) => {\n            if (!group) {\n              return null;\n            }\n            if (!group.example) {\n              return null;\n            }\n            if (!thumbnailsGenerator) {\n              return null;\n            }\n            const imgSrc = thumbnailsGenerator.getObjectThumbnail(\n              group.example,\n              30,\n              30\n            );\n            return (\n              <div\n                className={\"bead-count\"}\n                key={index}\n                // @TRANSLATION\n                data-tip={group.textTooltip}\n                data-place={\"top\"}\n                data-type={\"dark\"}\n                data-effect={\"solid\"}\n              >\n                <span className={\"preview\"}>\n                  <img src={imgSrc} />\n                </span>\n                <span className={\"value\"}>{group.textCount}</span>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </BeadsSummaryStyles>\n  );\n};\n\nexport const BeadsSummaryStyles = styled.div`\n  .beads-summary {\n    position: absolute;\n    bottom: var(--standardPadding);\n    right: calc(var(--standardPadding) + 170px + var(--standardPadding));\n    z-index: var(--zIndexBeadsSummary);\n    transition: all 0.4s ease-in-out;\n  }\n  .beads-summary-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding);\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n  }\n  .bead-count {\n    display: flex;\n    flex-direction: column;\n    cursor: pointer;\n\n    .value {\n      font-size: 15px;\n      font-weight: 600;\n    }\n\n    .preview {\n      width: 30px;\n      height: 30px;\n      /* border: 1px solid #eee; */\n      /* border-radius: 30px; */\n      /* font-size: 8px; */\n      /* line-height: 27px; */\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      white-space: nowrap;\n      overflow: hidden;\n    }\n  }\n`;\n","import React from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faPlus,\n  faEdit,\n  faArrowsAlt,\n  faPaintBrush,\n  faPlusSquare,\n  faTh,\n  faTrashAlt,\n  faTable,\n  faSquare,\n  faBraille,\n  faMousePointer,\n  faSquareFull,\n  faCircle,\n  faExpand,\n  faReply,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { AppObject, EditorMode } from \"../../editorObjects/Editor\";\n// import { uiButton } from \"../colors\";\nimport { useDispatch } from \"react-redux\";\nimport { Actions } from \"../../immerReducers/store\";\nimport { times } from \"lodash\";\nimport ReactTooltip from \"react-tooltip\";\nimport styled from \"styled-components\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport {\n  AddMultipleBeads,\n  AddObjects,\n  AppEventType,\n  ChangeUiSettings,\n} from \"../../controllers/AppEventType\";\nimport { getStore } from \"../../controllers/store\";\n\nexport const EditorModes = ({ editorMode }) => {\n  // const dispatch = useDispatch();\n\n  const onChangeEditorMode = (newEditorMode: EditorMode) => {\n    const action: ChangeUiSettings = {\n      name: AppEventType.ChangeUiSettings,\n      payload: {\n        uiSettings: {\n          mode: newEditorMode,\n        },\n      },\n    };\n    sendEvent(action);\n    // dispatch(Actions.ChangeEditorMode.action_onChangeEditorMode(newEditorMode));\n  };\n\n  return (\n    <div className=\"\">\n      {/* <StateButton\n        label={\"Przegldanie\"}\n        icon={<FontAwesomeIcon icon={faMousePointer} />}\n        onClick={() => onChangeEditorMode(EditorMode.Idle)}\n        isSelected={editorMode === EditorMode.Idle}\n      /> */}\n\n      <StateButton\n        label={\"Zaznacz lub przesu\"}\n        icon={<FontAwesomeIcon icon={faMousePointer} />}\n        onClick={() => onChangeEditorMode(EditorMode.SelectOrMove)}\n        isSelected={editorMode === EditorMode.SelectOrMove}\n      />\n\n      <StateButton\n        label={\"Zaznacz wiele koralikw\"}\n        icon={<FontAwesomeIcon icon={faExpand} />}\n        onClick={() => onChangeEditorMode(EditorMode.SelectMultiple)}\n        isSelected={editorMode === EditorMode.SelectMultiple}\n      />\n\n      {/* <StateButton\n        label={\"Edit Lines\"}\n        icon={<FontAwesomeIcon icon={faEdit} />}\n        onClick={() => onChangeEditorMode(EditorMode.EditLines)}\n        isSelected={editorMode === EditorMode.EditLines}\n      /> */}\n      {/* <StateButton\n        label={\"AddLine\"}\n        icon={<FontAwesomeIcon icon={faPlus} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddLine)}\n        isSelected={editorMode === EditorMode.AddLine}\n      /> */}\n\n      <StateButton\n        label={\"Dodaj koraliki\"}\n        icon={<FontAwesomeIcon icon={faCircle} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddBeads)}\n        isSelected={editorMode === EditorMode.AddBeads}\n      />\n\n      <StateButton\n        label={\"Pomaluj koraliki\"}\n        icon={<FontAwesomeIcon icon={faPaintBrush} />}\n        onClick={() => onChangeEditorMode(EditorMode.PaintBeads)}\n        isSelected={editorMode === EditorMode.PaintBeads}\n      />\n\n      <StateButton\n        label={\"Usu koraliki\"}\n        icon={<FontAwesomeIcon icon={faTrashAlt} />}\n        onClick={() => onChangeEditorMode(EditorMode.DeleteBeads)}\n        isSelected={editorMode === EditorMode.DeleteBeads}\n      />\n\n      <StateButton\n        label={\"Dodaj region z siatk\"}\n        icon={<FontAwesomeIcon icon={faTable} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddRegion)}\n        isSelected={editorMode === EditorMode.AddRegion}\n      />\n\n      <FastAddBeadsButton\n        label={\"Dodaj wiele koralikw\"}\n        icon={<FontAwesomeIcon icon={faTh} />}\n      />\n    </div>\n  );\n};\n\nconst StateButton: React.FC<{\n  label: string;\n  isSelected: boolean;\n  onClick: any;\n  icon: React.ReactChild;\n}> = (props) => {\n  return (\n    <ButtonStyles>\n      <div\n        className={`action-button ${props.isSelected ? \"is-active\" : \"\"}`}\n        onClick={props.onClick}\n        data-tip={props.label}\n        data-place={\"right\"}\n        data-type={\"dark\"}\n        data-effect={\"solid\"}\n      >\n        <span className=\"icon\">{props.icon}</span>\n      </div>\n    </ButtonStyles>\n  );\n};\n\nconst ButtonStyles = styled.div`\n  .action-button {\n    border: none;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: var(--uiButton);\n    animation: all 0.5s ease-in-out;\n    min-height: 40px;\n    .icon svg,\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      animation: all 0.5s ease-in-out;\n    }\n  }\n  .action-button:hover,\n  .action-button.is-active {\n    color: var(--uiButtonActive);\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      fill: var(--uiButtonActive);\n    }\n  }\n`;\n\nconst FastAddBeadsButton: React.FC<{ label: string; icon: any }> = (props) => {\n  const dispatch = useDispatch();\n  const defaultDimesions = [20, 20];\n  const defaultSelected = [1, 1];\n  const [dimensions, setDimensions] = React.useState<number[]>(\n    defaultDimesions\n  );\n  const [selected, setSelected] = React.useState<number[]>(defaultSelected);\n  const [selectionVisible, setVisible] = React.useState<boolean>(false);\n\n  const toggleSelection = () => {\n    setVisible(!selectionVisible);\n  };\n  const onSelect = (rowIndex: number, colIndex: number) => {\n    // dispatch(Actions.Toolbar.action_fastAddBeads(rowIndex, colIndex));\n    const action: AddMultipleBeads = {\n      name: AppEventType.AddMultipleBeads,\n      payload: {\n        rows: rowIndex,\n        columns: colIndex,\n        figure: \"rectangle\",\n      },\n    };\n    sendEvent(action);\n\n    toggleSelection();\n    setDimensions(defaultDimesions);\n    setSelected(defaultSelected);\n  };\n  const onCancel = () => {\n    setDimensions(defaultDimesions);\n    setVisible(false);\n  };\n  return (\n    <div style={{ position: \"relative\" }}>\n      <ButtonStyles>\n        <div\n          className={`action-button ${selectionVisible ? \"is-active\" : \"\"}`}\n          onClick={toggleSelection}\n          data-tip={selectionVisible === true ? undefined : props.label}\n          data-place={\"right\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n          data-tip-disable={selectionVisible === true}\n        >\n          <span className={`icon`}>{props.icon}</span>\n        </div>\n      </ButtonStyles>\n\n      {selectionVisible === true ? (\n        <SelectionStyles>\n          <SelectionFrame\n            selected={selected}\n            dimensions={dimensions}\n            setSelected={setSelected}\n            setDimensions={setDimensions}\n            onSelect={onSelect}\n            onCancel={onCancel}\n          />\n        </SelectionStyles>\n      ) : null}\n    </div>\n  );\n};\n\nconst SelectionFrame: React.FC<{\n  selected: number[];\n  dimensions: number[];\n  setSelected: any;\n  setDimensions: any;\n  onSelect: (a: number, b: number) => void;\n  onCancel: any;\n}> = (props) => {\n  const divRef = React.useRef<any | null>(null);\n  useOutsideClick(divRef, () => {\n    props.onCancel();\n  });\n  return (\n    <div className=\"selection\">\n      <div\n        className={\"rect-wrapper\"}\n        style={{ width: props.dimensions[0] * 15 }}\n        ref={(e) => {\n          divRef.current = e;\n        }}\n      >\n        {times(props.dimensions[0]).map((rowIndex) => (\n          <div className={\"row-wrapper\"} key={rowIndex}>\n            {times(props.dimensions[1]).map((colIndex) => {\n              const onMouseEnter = () => {\n                props.setSelected([rowIndex + 1, colIndex + 1]);\n\n                // @TODO:\n                // const max = 20;\n                // const min = 5;\n\n                // // const isLastCol = dimensions[1] - 1 === colIndex;\n                // // const isLastRow = dimensions[0] - 1 === rowIndex;\n                // // if (isLastCol || isLastRow) {\n                //   let nextRow = rowIndex;\n                //   if (rowIndex < min - 1) {\n                //     nextRow = min;\n                //   } else if (rowIndex > max) {\n                //     nextRow = max;\n                //   } else {\n                //     const isLast = dimensions[0] - 1 === rowIndex;\n                //     if (isLast) {\n                //       nextRow = Math.min(max, dimensions[0] + 1);\n                //     } else {\n                //       nextRow = rowIndex;\n                //     }\n                //   }\n                //   const nextCol = 5;\n                //   // let nextCol = colIndex;\n                //   // if (colIndex < min - 1) {\n                //   //   nextCol = min;\n                //   // } else if (colIndex > max) {\n                //   //   nextCol = max;\n                //   // } else {\n                //   //   const isLast = dimensions[1] - 1 === colIndex;\n                //   //   if (isLast) {\n                //   //     nextCol = Math.min(max, dimensions[1] + 1);\n                //   //   } else {\n                //   //     nextCol = colIndex;\n                //   //   }\n                //   // }\n\n                //   console.log(\"zmianiam wielkosc:\", nextRow, nextCol);\n                //   props.setDimensions([nextRow, nextCol]);\n                // }\n              };\n              const onClick = () => {\n                props.onSelect(rowIndex + 1, colIndex + 1);\n              };\n              return (\n                <div\n                  key={colIndex}\n                  className={`rect ${\n                    colIndex < props.selected[1] && rowIndex < props.selected[0]\n                      ? \"selected\"\n                      : \"\"\n                  }`}\n                  onMouseEnter={onMouseEnter}\n                  onClick={onClick}\n                >\n                  &nbsp;\n                </div>\n              );\n            })}\n          </div>\n        ))}\n      </div>\n      <div className={\"label-wrapper\"}>\n        {props.selected[0]}x{props.selected[1]}\n      </div>\n    </div>\n  );\n};\n\nconst useOutsideClick = (ref, callback) => {\n  const handleClick = (e) => {\n    if (ref.current && !ref.current.contains(e.target)) {\n      callback();\n    }\n  };\n\n  React.useEffect(() => {\n    document.addEventListener(\"click\", handleClick);\n\n    return () => {\n      document.removeEventListener(\"click\", handleClick);\n    };\n  });\n};\n\nconst SelectionStyles = styled.div`\n  .selection {\n    position: absolute;\n    top: 0px;\n    left: 65px;\n    min-width: calc(5 * 10px + 20px);\n    min-height: 100px;\n    background: #fff;\n    z-index: 10;\n    border: 1px solid #dbdbdb;\n    padding: 10px 10px 0px 10px;\n    box-sizing: border-box;\n  }\n  .selection .rect-wrapper {\n    display: flex;\n  }\n  .selection .label-wrapper {\n    font-size: 12px;\n    color: #000;\n    text-align: center;\n    width: 100%;\n  }\n  .selection .rect {\n    width: 15px;\n    height: 15px;\n    border: 1px solid #fff;\n    background: transparent;\n    padding: 1px;\n    box-shadow: inset 0px 0px 0px 1px #e3e1e1;\n  }\n  .selection .rect.selected {\n    background: var(--btns_bg);\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { EditorModes } from \"./Toolbar/EditorModes\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\n\nexport const ActionsWrapper: React.FC<{}> = () => {\n  const editorMode = useSelector((state: Editor) => {\n    return state.ui.mode;\n  });\n\n  return (\n    <ActionsWrapperStyles>\n      <div className=\"actions-wrapper\">\n        <div className={\"actions-content\"}>\n          <EditorModes editorMode={editorMode} />\n        </div>\n      </div>\n    </ActionsWrapperStyles>\n  );\n};\n\nexport const ActionsWrapperStyles = styled.div`\n  .actions-wrapper {\n    position: absolute;\n    z-index: var(--zIndexActions);\n    left: var(--standardPadding);\n    top: 50%;\n    transform: translate(0, -50%);\n    width: 56px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 0;\n    transition: all 0.4s ease-in-out;\n  }\n  .actions-content {\n    padding: 0;\n    background-color: rgba(255, 255, 255, 1);\n    padding: 12px 0;\n    transition: height 0.2s linear, top 0.2s linear;\n    border-radius: 4px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    width: 100%;\n  }\n`;\n","import { faTimes } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React from \"react\";\nimport styled from \"styled-components\";\n\nexport const PanelContentStyles = styled.div`\n  .content-wrapper {\n    padding: calc(var(--standardPadding) * 2);\n    position: relative;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: flex-start;\n    flex-direction: column;\n    overflow: auto;\n    max-height: 100%;\n  }\n  .close-wrapper {\n    position: absolute;\n    top: calc(var(--standardPadding) * 1);\n    right: calc(var(--standardPadding) * 1);\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n  }\n  .title {\n    font-size: 30px;\n    font-weight: 600;\n    margin-bottom: var(--standardPadding);\n  }\n`;\n\nexport const CloseButton: React.FC<{ onClick: any }> = (props) => {\n  return (\n    <div className={\"close-wrapper\"} onClick={props.onClick}>\n      <FontAwesomeIcon icon={faTimes} color={\"#000\"} size={\"2x\"} />\n    </div>\n  );\n};\n","import React from \"react\";\nimport { AppObject, Editor, ObjectTypes } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport styled from \"styled-components\";\nimport { CloseButton, PanelContentStyles } from \"./PanelContentStyles\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faHistory } from \"@fortawesome/free-solid-svg-icons\";\nimport dayjs from \"dayjs\";\nimport { jumpToIndexHistory } from \"../controllers/AppHistory\";\nimport { thumbnailsGenerator } from \"../threejs/thumbnailsGenerator\";\n\nexport const RightSidebar: React.FC<{}> = () => {\n  const rightSidebar = useSelector((state: Editor) => {\n    return state.ui.rightSidebar;\n  });\n\n  return (\n    <RightSidebarStyles>\n      <div className={\"right-sidebar-wrapper\"}>\n        {rightSidebar.isOpen === true ? (\n          <>\n            {rightSidebar.panel === \"history\" ? <HistoryPanel /> : null}\n\n            {rightSidebar.panel === \"objects\" ? <ObjectsPanel /> : null}\n          </>\n        ) : null}\n      </div>\n    </RightSidebarStyles>\n  );\n};\n\nexport const RightSidebarStyles = styled.div`\n  .right-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    right: calc(var(--leftSidebarWidth) * -1);\n    width: var(--leftSidebarWidth);\n    z-index: var(--zIndexRightSidebar);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n`;\n\nconst HistoryPanel: React.FC<{}> = () => {\n  const onClickCloseHistory = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: false,\n        panel: \"history\",\n      },\n    };\n    sendEvent(event);\n  };\n  const events = useSelector((state: Editor) => {\n    return state.history.events;\n  });\n  return (\n    <PanelContentStyles>\n      <div className={\"content-wrapper\"}>\n        <div className={\"title\"}>History events</div>\n        <CloseButton onClick={onClickCloseHistory} />\n        <HistoryPanelStyles>\n          <div className={\"events\"}>\n            {events.map((_, i, events) => {\n              const index = events.length - 1 - i;\n              const event = events[index];\n              if (!event) {\n                return <React.Fragment />;\n              }\n              const onClickHistoryItem = () => {\n                jumpToIndexHistory(index);\n              };\n              const fullCreatedAt = dayjs(event.createdAt).format();\n              return (\n                <div\n                  key={i}\n                  className={`event ${event.isActive ? \"active\" : \"inactive\"}`}\n                  onClick={onClickHistoryItem}\n                >\n                  <div className={\"icon\"}>\n                    <FontAwesomeIcon icon={faHistory} />\n                  </div>\n                  <div className={\"name\"}>{event.name}</div>\n                  <div\n                    className={\"time\"}\n                    // @TRANSLATION\n                    data-tip={fullCreatedAt}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    {dayjs(event.createdAt).format(\"HH:mm:ss\")}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </HistoryPanelStyles>\n      </div>\n    </PanelContentStyles>\n  );\n};\n\nconst HistoryPanelStyles = styled.div`\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .events {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow: scroll;\n  }\n  .event {\n    display: grid;\n    grid-template-columns: 45px 1fr 100px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    cursor: pointer;\n    &.active {\n      background: #fff;\n      .icon {\n        svg path {\n          fill: #000;\n        }\n      }\n      .name {\n        color: #000;\n      }\n    }\n    &.inactive {\n      .icon {\n        svg path {\n          fill: #e9e9e9;\n        }\n      }\n      .name {\n        color: #e9e9e9;\n      }\n    }\n    &:hover {\n      background: #ccc;\n    }\n\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .time {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      white-space: nowrap;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      color: #c9c9c9;\n    }\n  }\n`;\n\nconst ObjectsPanel: React.FC<{}> = () => {\n  const onClickCloseObjects = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: false,\n        panel: \"objects\",\n      },\n    };\n    sendEvent(event);\n  };\n\n  const objects = useSelector((state: Editor) => {\n    return state.objects;\n  });\n  type Filters = \"all\" | \"beads\" | \"groups\" | \"other\";\n  const [filterSelected, setFilterSelected] = React.useState<Filters>(\"all\");\n  const [selectedObjects, setSelectedObjects] = React.useState<AppObject[]>([]);\n  const onClickFilter = (filter: Filters) => {\n    setFilterSelected(filter);\n    if (filter === \"all\") {\n      setSelectedObjects(\n        Object.keys(objects).map((id) => {\n          return objects[id];\n        })\n      );\n    } else if (filter === \"beads\") {\n      setSelectedObjects(\n        Object.keys(objects)\n          .map((id) => {\n            return objects[id];\n          })\n          .filter((e) => e.objectType === ObjectTypes.Bead)\n      );\n    } else if (filter === \"groups\") {\n      setSelectedObjects(\n        Object.keys(objects)\n          .map((id) => {\n            return objects[id];\n          })\n          .filter((e) => e.objectType === ObjectTypes.Group)\n      );\n    } else if (filter === \"other\") {\n      setSelectedObjects(\n        Object.keys(objects)\n          .map((id) => {\n            return objects[id];\n          })\n          .filter(\n            (e) =>\n              !(\n                e.objectType === ObjectTypes.Bead ||\n                e.objectType === ObjectTypes.Group\n              )\n          )\n      );\n    }\n  };\n  const onClickFilterAll = () => {\n    onClickFilter(\"all\");\n  };\n  const onClickFilterBeads = () => {\n    onClickFilter(\"beads\");\n  };\n  const onClickFilterGroups = () => {\n    onClickFilter(\"groups\");\n  };\n  const onClickFilterOther = () => {\n    onClickFilter(\"other\");\n  };\n\n  React.useEffect(() => {\n    onClickFilter(filterSelected);\n  }, [objects]);\n  return (\n    <PanelContentStyles>\n      <div className={\"content-wrapper\"}>\n        <div className={\"title\"}>Objects</div>\n        <CloseButton onClick={onClickCloseObjects} />\n        <ObjectsPanelStyles>\n          <div className={\"filters\"}>\n            <div\n              className={`filter ${filterSelected === \"all\" ? \"active\" : \"\"}`}\n              onClick={onClickFilterAll}\n              // @TRANS\n            >\n              All\n            </div>\n            <div\n              className={`filter ${filterSelected === \"beads\" ? \"active\" : \"\"}`}\n              onClick={onClickFilterBeads}\n              // @TRANS\n            >\n              Beads\n            </div>\n            <div\n              className={`filter ${\n                filterSelected === \"groups\" ? \"active\" : \"\"\n              }`}\n              onClick={onClickFilterGroups}\n              // @TRANS\n            >\n              Groups\n            </div>\n            <div\n              className={`filter ${filterSelected === \"other\" ? \"active\" : \"\"}`}\n              onClick={onClickFilterOther}\n              // @TRANS\n            >\n              Others\n            </div>\n          </div>\n          <div className={\"objects\"}>\n            {selectedObjects.map((object, index) => {\n              if (!object) {\n                return <React.Fragment />;\n              }\n\n              const isBead = object.objectType === ObjectTypes.Bead;\n              const onClickObject = () => {\n                if (isBead) {\n                  thumbnailsGenerator.getObjectThumbnail(object, 500, 500);\n                }\n              };\n              return (\n                <div key={index} className={\"object\"} onClick={onClickObject}>\n                  <div className={\"icon\"}>\n                    {isBead ? (\n                      <img\n                        src={thumbnailsGenerator.getObjectThumbnail(\n                          object,\n                          30,\n                          30\n                        )}\n                      />\n                    ) : (\n                      <FontAwesomeIcon icon={faHistory} />\n                    )}\n                  </div>\n                  <div className={\"name\"}>{object.objectType}</div>\n                  <div className={\"id\"}>ID:{object.id}</div>\n                </div>\n              );\n            })}\n          </div>\n        </ObjectsPanelStyles>\n      </div>\n    </PanelContentStyles>\n  );\n};\n\nconst ObjectsPanelStyles = styled.div`\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .filters {\n    background: #ebebef;\n    border-radius: 4px;\n    padding: 2px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    .filter {\n      border-radius: 4px;\n      padding: 10px 15px;\n    }\n    .filter.active {\n      background: #fff;\n    }\n  }\n\n  .objects {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n  }\n  .object {\n    display: grid;\n    grid-template-columns: 45px 1fr 200px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    width: 100%;\n    &:hover {\n      background: #e9e9e9;\n    }\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .id {\n      font-size: 10px;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      width: 100%;\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { CloseButton, PanelContentStyles } from \"./PanelContentStyles\";\n\nexport const LeftSidebar: React.FC<{}> = () => {\n  const leftSidebar = useSelector((state: Editor) => {\n    return state.ui.leftSidebar;\n  });\n  return (\n    <LeftSidebarStyles>\n      <div className={\"left-sidebar-wrapper\"}>\n        {leftSidebar.isOpen === true ? (\n          <>{leftSidebar.panel === \"comments\" ? <CommentsPanel /> : null}</>\n        ) : null}\n      </div>\n    </LeftSidebarStyles>\n  );\n};\n\nexport const LeftSidebarStyles = styled.div`\n  .left-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    left: calc(var(--leftSidebarWidth) * -1);\n    z-index: var(--zIndexLeftSidebar);\n    width: var(--leftSidebarWidth);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n`;\n\nconst CommentsPanel: React.FC<{}> = () => {\n  const onClickCloseComments = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: false,\n        panel: \"comments\",\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <PanelContentStyles>\n      <div className={\"content-wrapper\"}>\n        <div className={\"title\"}>Comments</div>\n        <div>List is empty...</div>\n        <CloseButton onClick={onClickCloseComments} />\n      </div>\n    </PanelContentStyles>\n  );\n};\n","import React from \"react\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faAngleDoubleLeft,\n  faAngleDoubleRight,\n  faComment,\n  faHistory,\n  faListAlt,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport styled from \"styled-components\";\nimport { useSelector } from \"react-redux\";\nimport { Editor } from \"../editorObjects/Editor\";\n\nexport const BottomBar: React.FC<{}> = (props) => {\n  const [isOpen, setIsOpen] = React.useState(true);\n  const leftSidebar = useSelector((state: Editor) => {\n    return state.ui.leftSidebar;\n  });\n  const rightSidebar = useSelector((state: Editor) => {\n    return state.ui.rightSidebar;\n  });\n  const toggleBar = () => {\n    setIsOpen(!isOpen);\n  };\n  const onClickOpenComments = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: true,\n        panel: \"comments\",\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickOpenHistory = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: true,\n        panel: \"history\",\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickOpenObjects = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: true,\n        panel: \"objects\",\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <BottomBarStyles>\n      <div className={`bottom-bar-wrapper ${isOpen ? \"open\" : \"closed\"}`}>\n        <div className={\"buttons\"}>\n          <div\n            className={`item ${\n              leftSidebar.panel === \"comments\" ? \"active\" : \"inactive\"\n            }`}\n            onClick={onClickOpenComments}\n            // @TRANSLATION\n            data-tip={`Comments`}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon icon={faComment} />\n            </div>\n          </div>\n          <div\n            className={`item ${\n              rightSidebar.panel === \"history\" ? \"active\" : \"inactive\"\n            }`}\n            onClick={onClickOpenHistory}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon\n                icon={faHistory}\n                // @TRANSLATION\n                data-tip={`History events`}\n                data-place={\"top\"}\n                data-type={\"dark\"}\n                data-effect={\"solid\"}\n              />\n            </div>\n          </div>\n          <div\n            className={`item ${\n              rightSidebar.panel === \"objects\" ? \"active\" : \"inactive\"\n            }`}\n            onClick={onClickOpenObjects}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon\n                icon={faListAlt}\n                // @TRANSLATION\n                data-tip={`Objects`}\n                data-place={\"top\"}\n                data-type={\"dark\"}\n                data-effect={\"solid\"}\n              />\n            </div>\n          </div>\n        </div>\n        <div className={\"toggle-item\"} onClick={toggleBar}>\n          <div className={\"value\"}>\n            <FontAwesomeIcon\n              icon={isOpen ? faAngleDoubleLeft : faAngleDoubleRight}\n            />\n          </div>\n        </div>\n      </div>\n    </BottomBarStyles>\n  );\n};\n\nexport const BottomBarStyles = styled.div`\n  .bottom-bar-wrapper {\n    position: absolute;\n    bottom: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: var(--zIndexBottomBar);\n    width: auto;\n    display: flex;\n    /* transition: all 0.4s ease-in-out; */\n    background: #fff;\n    height: 55px;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1),\n      left 0.4s ease-in-out;\n    &.open {\n    }\n    &.closed {\n      .buttons {\n        width: 0;\n      }\n    }\n  }\n  .buttons {\n    overflow: hidden;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1);\n    width: 100%;\n    white-space: nowrap;\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &.active,\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .toggle-item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      fill: #e9e9e9;\n    }\n  }\n`;\n","import React, { useRef, useState } from \"react\";\nimport { Editor, EditorMode } from \"../editorObjects/Editor\";\n// import { AddLineMode } from \"./Line/AddLineMode\";\n// import { EditorChangeState } from \"./Toolbar/EditorChangeState\";\nimport { useSelector, useStore, useDispatch } from \"react-redux\";\nimport { MouseSelectionBeads } from \"./Bead/MouseSelectionBeads\";\n// import { MouseSelectionLines } from \"./Line/MouseSelectionLines\";\nimport { DisplayBeads } from \"./Bead/DisplayBeads\";\n// import { DisplayLines } from \"./Line/DisplayLines\";\nimport { GroupSelectionPlaceholder } from \"./operations/GroupSelectionPlaceholder\";\n// import { PickBeadColor } from \"./Toolbar/PickColor\";\n// import { ChangeLinePosition } from \"./Toolbar/ChangeLinePosition\";\n// import { PickBeadType } from \"./Toolbar/PickBeadType\";\n// import { ChangeBeadRotate } from \"./Toolbar/ChangeBeadRotate\";\n// import { LineInspector } from \"./Toolbar/LineInspector\";\n// import { Actions } from \"../store\";\n// import { EditToolbar } from \"./Toolbar/EditToolbar\";\n// import { ToolbarEditLines } from \"./Toolbar/Modes/ToolbarEditLines\";\nimport { ToolbarEditBeads } from \"./Toolbar/Modes/ToolbarEditBeads\";\n// import { ToolbarAddLine } from \"./Toolbar/Modes/ToolbarAddLine\";\nimport { ToolbarIdle } from \"./Toolbar/Modes/ToolbarIdle\";\nimport { DisplayGridLines } from \"./operations/DisplayGridLines\";\nimport { TopbarMain } from \"./Topbar/TopbarMain\";\nimport { TopbarSecoundary } from \"./Topbar/TopbarSecoundary\";\nimport { Brush } from \"./operations/Brush\";\nimport { ToolbarPaint } from \"./Toolbar/Modes/ToolbarPaint\";\nimport { BackgroundImage } from \"./operations/BackgroundImage\";\nimport { AddBeadsMode } from \"./Bead/AddBeadsMode\";\nimport { ToolbarAddBeads } from \"./Toolbar/Modes/ToolbarAddBeads\";\nimport { PanZoom } from \"react-easy-panzoom\";\nimport { Actions } from \"../immerReducers/store\";\nimport { ReactReduxContext } from \"react-redux\";\nimport ReactResizeDetector from \"react-resize-detector\";\nimport { SelectedObjectsTopBar } from \"./SelectedObjectsTopBar/SelectedObjectsTopBar\";\nimport ReactTooltip from \"react-tooltip\";\nimport { EditProjectModal } from \"./EditProjectModal\";\nimport { ProjectInfoWrapper } from \"./ProjectInfoWrapper\";\nimport { ChangeUiSettings } from \"../controllers/AppEventType\";\nimport { MinimapWrapper } from \"./MinimapWrapper\";\nimport { BeadsSummary } from \"./BeadsSummary\";\nimport { ActionsWrapper } from \"./ActionsWrapper\";\nimport { RightSidebar } from \"./RightSidebar\";\nimport { LeftSidebar } from \"./LeftSidebar\";\nimport { BottomBar } from \"./BottomBar\";\nimport styled from \"styled-components\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faSyncAlt } from \"@fortawesome/free-solid-svg-icons\";\n\nexport const EditorScene = () => {\n  const leftSidebarOpen = useSelector((state: Editor) => {\n    return state.ui.leftSidebar.isOpen;\n  });\n  const rightSidebarOpen = useSelector((state: Editor) => {\n    return state.ui.rightSidebar.isOpen;\n  });\n\n  return (\n    <div>\n      <ReactTooltip />\n      <EditProjectModal />\n      <EditorMainStyles>\n        <div\n          className={`scene \n          ${leftSidebarOpen ? \"left-sidebar-open\" : \"\"} \n          ${rightSidebarOpen ? \"right-sidebar-open\" : \"\"}`}\n        >\n          <LoadingInfo />\n          <ProjectInfoWrapper />\n          <MinimapWrapper />\n          <BeadsSummary />\n          <ActionsWrapper />\n          <BottomBar />\n          <LeftSidebar />\n          <RightSidebar />\n\n          <SelectedObjectsTopBar />\n        </div>\n      </EditorMainStyles>\n    </div>\n  );\n};\n\nconst EditorMainStyles = styled.div`\n  .scene {\n    border: 1px solid #e0e0e0;\n    position: relative;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: flex-start;\n    box-sizing: border-box;\n    height: 100vh;\n\n    .block-loading {\n      position: absolute;\n      top: 0;\n      left: 0;\n      background: rgba(255, 255, 255, 0.9);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      height: 100%;\n      z-index: var(--zIndexBlockLoading);\n      svg {\n        animation: rotating 2s linear infinite;\n      }\n    }\n\n    &.right-sidebar-open {\n      .right-sidebar-wrapper {\n        right: 0;\n      }\n\n      .minimap-wrapper {\n        right: calc(var(--standardPadding) + var(--leftSidebarWidth));\n      }\n      .beads-summary {\n        right: calc(\n          var(--standardPadding) + var(--leftSidebarWidth) +\n            var(--standardPadding) + var(--minimapWidth)\n        );\n      }\n    }\n\n    &.left-sidebar-open {\n      .left-sidebar-wrapper {\n        left: 0;\n      }\n      .project-info-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .actions-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .bottom-bar-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n    }\n  }\n\n  @keyframes rotating {\n    from {\n      -ms-transform: rotate(0deg);\n      -moz-transform: rotate(0deg);\n      -webkit-transform: rotate(0deg);\n      -o-transform: rotate(0deg);\n      transform: rotate(0deg);\n    }\n    to {\n      -ms-transform: rotate(360deg);\n      -moz-transform: rotate(360deg);\n      -webkit-transform: rotate(360deg);\n      -o-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n`;\n\nconst LoadingInfo: React.FC<{}> = () => {\n  const loading = useSelector((state: Editor) => {\n    return state.ui.blockThreejs.loading;\n  });\n\n  if (loading === false) {\n    return <React.Fragment />;\n  }\n  \n  return (\n    <div className={\"block-loading\"}>\n      <FontAwesomeIcon icon={faSyncAlt} />\n    </div>\n  );\n};\n\n/* .scene-wrapper {\n    position: relative;\n    outline: none;\n    user-select: none;\n    width: calc(100% - 100px - 300px);\n    height: calc(100vh - 71px);\n    background: #e4e4e4;\n    box-sizing: border-box;\n    overflow: hidden;\n  } */\n// const ToolBarStyles = styled.div`\n//   .fieldset {\n//     padding-bottom: 5px;\n//     padding-top: 5px;\n//     display: flex;\n//     justify-content: flex-start;\n//     align-items: center;\n//   }\n\n//   .fieldset .label {\n//     font-family: \"Open Sans\", sans-serif;\n//     font-size: 16px;\n//     line-height: 30px;\n//     font-weight: 300;\n//     padding: 0;\n//     margin: 0;\n//     padding-left: 10px;\n//     padding-right: 10px;\n//     display: flex;\n//     flex-direction: row;\n//     flex-wrap: nowrap;\n//     align-items: center;\n//   }\n\n//   .fieldset .input {\n//     border: none;\n//     background: none;\n//     border-bottom: 1px solid #dfdfdf;\n//     color: #6e6e6e;\n//     font-size: 14px;\n//     line-height: 30px;\n//     font-family: \"Open Sans\", sans-serif;\n//     box-shadow: none;\n//     max-width: 200px;\n//     padding: 0;\n//     margin: 0;\n//   }\n\n//   .fieldset .input[type=\"number\"] {\n//     max-width: 50px;\n//   }\n// `;\n\n// class PanZoomWrapper extends React.Component<{ children, updatePosition }> {\n//   htmlDivInstance: HTMLDivElement | null = null;\n//   componentDidMount() {\n//     if (this.htmlDivInstance !== null) {\n//       const boundingClientRect = this.htmlDivInstance.getBoundingClientRect();\n//       this.props.updatePosition(boundingClientRect);\n//     }\n//   }\n//   render() {\n//     return (\n//       <div ref={refInstance => this.htmlDivInstance = refInstance}>\n//         {this.props.children}\n//       </div>\n//     )\n//   }\n// }\n\n// const Lights: React.FC<{}> = (props) => {\n//   const dispatch = useDispatch();\n//   const lights = useSelector((state: Editor) => {\n//     return state.ui.lights;\n//   });\n//   return (\n//     <LightsStyles>\n//       <div className={\"toolbar-lights\"}>\n//         {lights.map((l, index) => {\n//           const onChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n//             const newValue = Number(event.target.value) / 100;\n//             // console.log(\"co mam?\", newValue);\n//             // dispatch(\n//             //   Actions.Toolbar.action_updateLight(index, \"intensity\", newValue)\n//             // );\n//           };\n//           return (\n//             <div key={l.name} className={\"light\"}>\n//               <div className={\"info\"}>{JSON.stringify(l)}</div>\n//               <div className={\"fields\"}>\n//                 <fieldset>\n//                   <label>intensity: </label>\n//                   <input\n//                     type=\"range\"\n//                     name={`${l.name}_${l.intensity}`}\n//                     value={(l.intensity ?? 0) * 100}\n//                     onChange={onChange}\n//                     min=\"1\"\n//                     max=\"99\"\n//                     step=\"1\"\n//                   />\n//                 </fieldset>\n//               </div>\n//             </div>\n//           );\n//         })}\n//       </div>\n//     </LightsStyles>\n//   );\n// };\n// const LightsStyles = styled.div`\n//   .toolbar-lights {\n//     background: #ddd;\n//     width: 100%;\n//     border: none;\n//     box-sizing: border-box;\n//     position: absolute;\n//     bottom: 0;\n//     left: 0;\n//   }\n//   .light {\n//     border: 1px solid #000;\n//     border-radius: 3px;\n//     margin-bottom: 10px;\n//     padding: 10px;\n//   }\n//   .light .info {\n//     font-size: 11px;\n//     line-height: 13px;\n//     display: block;\n//     margin-bottom: 5px;\n//     width: 100%;\n//     overflow: hidden;\n//     word-break: break-all;\n//     white-space: pre-line;\n//   }\n//   .light .fields {\n//     display: flex;\n//     justify-content: center;\n//     align-items: center;\n//   }\n//   .light .fields fieldset {\n//     display: flex;\n//     justify-content: center;\n//     align-items: center;\n//     column-gap: 10px;\n//   }\n// `;\n\n// const state = useSelector((state: Editor) => {\n//   return state;\n// });\n// const store = useStore();\n// const state = store.getState();\n// console.log(\"EditorRerender: \", state);\n\n// @TODO: Dodac funkcje ktora zostaje uruchomiona po rozpoczeciu aplikajci\n// const dispatch = useDispatch();\n// const [firstPass, setFirstPass] = useState(false);\n// useEffect(() => {\n//   if (process.env.NODE_ENV && process.env.NODE_ENV === \"development\") {\n//     if (firstPass === false) {\n//       dispatch(Actions.Persist.action_readSavedCanvas());\n//       // dispatch(\n//       //   Actions.ChangeEditorMode.action_onChangeEditorMode(\n//       //     EditorMode.EditLines\n//       //   )\n//       // );\n//       // dispatch(Actions.Draggable.action_onClickLastestLine());\n//       setFirstPass(true);\n//     }\n//   }\n// });\n\n// const panZoomRef = useRef<any>(null);\n\n// if (!state) {\n//   return <div>Error in app</div>;\n// }\n\n// const preventPan = (event, x, y) => {\n//   console.log('??', event, x, y)\n//   return true;\n// }\n\n// const onStateChange = (event) => {\n//   if (panZoomRef && panZoomRef.current !== null) {\n//     const boundingClientRect = panZoomRef.current.getContainerBoundingRect();\n//     dispatch(\n//       Actions.Draggable.action_updateSceneZoom({\n//         ...event,\n//         top: boundingClientRect.top,\n//         left: boundingClientRect.left,\n//       })\n//     );\n//   } else {\n//     dispatch(\n//       Actions.Draggable.action_updateSceneZoom({\n//         ...event,\n//         top: 0,\n//         left: 0,\n//       })\n//     );\n//   }\n// };\n// const onResizeSceneWrapper = (width, height) => {\n//   dispatch(\n//     Actions.Draggable.action_updateSceneWrapperSize({\n//       width,\n//       height,\n//     })\n//   );\n// };\n\n// const updatePosition = (event) => {\n//   dispatch(Actions.Draggable.action_updatePanZoomWrapperRect(event));\n// }\n\n{\n  /* <div className={\"scene-wrapper\"}> */\n}\n\n{\n  /* <div className=\"topbar-wrapper\">\n          <TopbarMain />\n          <TopbarSecoundary />\n        </div> */\n}\n{\n  /* <ReactResizeDetector\n            handleWidth\n            handleHeight\n            skipOnMount={false}\n            onResize={onResizeSceneWrapper}\n          /> */\n}\n{\n  /* <PanZoom\n          style={{ width: \"100%\", height: \"100%\", position: \"absolute\" }}\n          disabled={editorMode !== EditorMode.Idle}\n          ref={panZoomRef}\n          onStateChange={onStateChange}\n          keyMapping={{\n            \"87\": { x: 0, y: -1, z: 0 },\n            \"83\": { x: 0, y: 1, z: 0 },\n            \"65\": { x: -1, y: 0, z: 0 },\n            \"68\": { x: 1, y: 0, z: 0 }\n          }}\n        >\n          <div>{`This content can be panned and zoomed.`}</div>\n          <BackgroundImage />\n\n          <AddBeadsMode isActive={editorMode === EditorMode.AddBeads} />\n\n          <MouseSelectionBeads\n            isVisible={editorMode === EditorMode.EditBeads}\n          />\n\n          <DisplayBeads mode={editorMode} />\n\n         \n\n          <DisplayGridLines isVisible={editorMode === EditorMode.EditLines} />\n\n          <GroupSelectionPlaceholder mode={editorMode} />\n\n          <Brush isVisible={editorMode === EditorMode.PaintBeads} />\n        </PanZoom> */\n}\n{\n  /* <DisplayLines mode={editorMode} /> */\n}\n{\n  /* <AddLineMode isActive={editorMode === EditorMode.AddLine} /> */\n}\n\n{\n  /* <MouseSelectionLines isVisible={editorMode === EditorMode.EditLines} /> */\n}\n{\n  /* </div> */\n}\n\n{\n  /* <div className={\"toolbar-wrapper\"}>\n            <div className={\"toolbar-content\"}> */\n}\n{\n  /* <ToolBarStyles> */\n}\n{\n  /* <ToolbarEditLines isVisible={editorMode === EditorMode.EditLines} /> */\n}\n{\n  /* <ToolbarEditBeads\n                isVisible={editorMode === EditorMode.SelectOrMove}\n              /> */\n}\n{\n  /* <ToolbarAddLine isVisible={editorMode === EditorMode.AddLine} /> */\n}\n{\n  /* <ToolbarIdle isVisible={editorMode === EditorMode.Idle} /> */\n}\n{\n  /* <ToolbarPaint isVisible={editorMode === EditorMode.PaintBeads} /> */\n}\n{\n  /* <ToolbarAddBeads isVisible={editorMode === EditorMode.AddBeads} /> */\n}\n\n{\n  /* <Lights /> */\n}\n{\n  /* <ChangeLinePosition mode={editorMode} />\n\n        <PickBeadType mode={editorMode} />\n        <ChangeBeadRotate mode={editorMode} />\n        <PickBeadColor mode={editorMode} />\n        <LineInspector mode={editorMode} />\n\n        <EditToolbar mode={editorMode} /> */\n}\n{\n  /* </ToolBarStyles> */\n}\n{\n  /* </div>\n          </div> */\n}\n","import { fetchBoard } from \"../ApiService\";\nimport { AppEvents } from \"../controllers/AppEventType\";\nimport { buildBead } from \"../editorObjects/Bead\";\nimport { AppObject, BeadTypes, RegionShape } from \"../editorObjects/Editor\";\nimport { buildGroup } from \"../editorObjects/Group\";\nimport { buildPoint } from \"../editorObjects/Point\";\nimport { buildPreviewProject3D } from \"../editorObjects/PreviewProject3D\";\nimport { buildRegion } from \"../editorObjects/Region\";\nimport { getModelBBoxFromBeadType } from \"./loadModels\";\n\nexport const getProjectData = (\n  id: string\n): Promise<{ board: { uuid: string; name: string }; objects: AppObject[] }> => {\n  if (id === \"demo\") {\n    return new Promise((resolve, reject) => {\n      getDemoProjectData().then((response) => {\n        resolve(response);\n      });\n    });\n  }\n\n  return new Promise((resolve, reject) => {\n    fetchBoard(id)\n      .then((response) => {\n        resolve(response);\n      })\n      .catch((err) => reject(err));\n  });\n};\n\nexport const getDemoProjectData = (): Promise<{\n  board: { uuid: string; name: string };\n  objects: AppObject[];\n}> => {\n  return new Promise((resolve, reject) => {\n    const objects = {};\n    const bbox = getModelBBoxFromBeadType(BeadTypes.TOHO_SPHERE);\n    let width = 1;\n    let height = 1;\n    let depth = 1;\n    if (bbox) {\n      width = Math.abs(bbox.max.x - bbox.min.x);\n      height = Math.abs(bbox.max.y - bbox.min.y);\n      depth = Math.abs(bbox.max.z - bbox.min.z);\n    }\n    // for (let i = 0; i < 10 * 10; i = i + 10) {\n    //   for (let j = 0; j < 10 * 50; j = j + 10) {\n    //     const b1 = buildBead({\n    //       width,\n    //       height,\n    //       depth,\n    //       type: BeadTypes.TOHO_SPHERE,\n    //       color: Math.random() > 0.5 ? \"red\" : \"blue\",\n    //       position: {\n    //         x: i,\n    //         y: j,\n    //       },\n    //     });\n    //     objects[b1.id] = b1;\n    //   }\n    // }\n\n    // const region = buildRegion({\n    //   height: 100,\n    //   width: 100,\n    //   shape: RegionShape.Rectangle,\n    //   settings: {\n    //     columns: 3,\n    //     rows: 3,\n    //   },\n    //   position: buildPoint(-100, -110),\n    // });\n\n    // objects[region.id] = region;\n\n    // const region2 = buildRegion({\n    //   height: 200,\n    //   width: 200,\n    //   shape: RegionShape.Triangle,\n    //   settings: {\n    //     columns: 4,\n    //     rows: 2,\n    //   },\n    //   position: buildPoint(-300, -10),\n    // });\n\n    // objects[region2.id] = region2;\n\n    // const group = buildGroup({\n    //   height: 250,\n    //   width: 250,\n    //   position: buildPoint(250, 250),\n    // });\n    // const subRegion = buildRegion({\n    //   height: 50,\n    //   width: 50,\n    //   position: buildPoint(200, 200),\n    //   groupId: group.id,\n    // });\n    // const subBead = buildBead({\n    //   width,\n    //   height,\n    //   depth,\n    //   type: BeadTypes.TOHO_SPHERE,\n    //   position: buildPoint(300, 300),\n    //   groupId: group.id,\n    // });\n    // group.childrenIds = [subBead.id, subRegion.id];\n    // objects[subBead.id] = subBead;\n    // objects[subRegion.id] = subRegion;\n    // objects[group.id] = group;\n\n    // const previewProject3D = buildPreviewProject3D({\n    //   height: 50,\n    //   width: 50,\n    //   position: buildPoint(500, 500),\n    //   color: \"red\",\n    // });\n    // objects[previewProject3D.id] = previewProject3D;\n\n    resolve({\n      board: {\n        uuid: \"123\",\n        name: \"Projekt testowy\",\n      },\n      objects: Object.keys(objects).map((id) => {\n        return objects[id];\n      }),\n    });\n  });\n};\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport { AppEventType } from \"./controllers/AppEventType\";\nimport { redoHistory, undoHistory } from \"./controllers/AppHistory\";\nimport { refreshReactState } from \"./controllers/refreshReactState\";\nimport { emptyStore, getStore, setStore } from \"./controllers/store\";\nimport { sendEvent } from \"./controllers/storeController\";\nimport { buildBead } from \"./editorObjects/Bead\";\nimport { ObjectTypes } from \"./editorObjects/Editor\";\nimport { buildRegion } from \"./editorObjects/Region\";\nimport { getDemoProjectData, getProjectData } from \"./threejs/apiControler\";\nimport {\n  clearThreeScene,\n  addLightFromUI,\n  addGridFromUi,\n  addObjectByObjectType,\n} from \"./threejs/eventEmitterHandlers\";\nimport { appThree } from \"./threejs/renderThreejs\";\n\nexport const prepareBoard = (id: string) => {\n  return getProjectData(id).then((data) => {\n    return new Promise((resolve, reject) => {\n      clearThreeScene();\n\n      const store = getStore();\n\n      const newStore = produce(store, (draft) => {\n        draft.board = cloneDeep(emptyStore.board);\n        draft.history = cloneDeep(emptyStore.history);\n        draft.objects = cloneDeep(emptyStore.objects);\n        draft.selectedIds = cloneDeep(emptyStore.selectedIds);\n        draft.ui = cloneDeep(emptyStore.ui);\n\n        if (data.objects !== undefined && data.objects.length > 0) {\n          data.objects.forEach((object) => {\n            draft.objects[object.id] = object;\n          });\n        }\n\n        draft.board.name = data.board?.name ?? \"\";\n        draft.board.uuid = data.board?.uuid ?? \"\";\n        draft.board.canEdit = true;\n        draft.ui.blockThreejs.loading = false;\n      });\n\n      setStore(newStore);\n\n      store.ui.lights.forEach((light) => {\n        addLightFromUI(light, appThree.scene);\n      });\n\n      if (store.ui.grid) {\n        addGridFromUi(store.ui.grid);\n      }\n\n      Object.keys(newStore.objects).forEach((id) => {\n        addObjectByObjectType(newStore.objects[id]);\n      });\n\n      refreshReactState(newStore);\n\n      testRegions();\n      resolve(undefined);\n    });\n  });\n};\n\nexport const clearBoard = (id: string) => {\n  return new Promise<void>((resolve) => {\n    clearThreeScene();\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      draft = cloneDeep(emptyStore);\n    });\n\n    refreshReactState(newStore);\n    resolve();\n  });\n};\n\nconst testRegions = () => {\n  const beadr = buildBead({\n    id: \"beadr\",\n    color: \"red\",\n    position: {\n      x: 0,\n      y: 0,\n    },\n  });\n  const beadg = buildBead({\n    id: \"beadg\",\n    color: \"green\",\n    position: {\n      x: 50,\n      y: 0,\n    },\n  });\n  const beadb = buildBead({\n    id: \"beadb\",\n    color: \"blue\",\n    position: {\n      x: 100,\n      y: 0,\n    },\n  });\n\n  const regionA = buildRegion({\n    id: \"regionA\",\n    position: {\n      x: 100,\n      y: 100,\n    },\n    width: 100,\n    height: 100,\n  });\n\n  const regionB = buildRegion({\n    id: \"regionB\",\n    position: {\n      x: 250,\n      y: 100,\n    },\n    width: 100,\n    height: 100,\n  });\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [beadr, beadg, beadb, regionA, regionB],\n    },\n  });\n  // sendEvent({\n  //   name: AppEventType.ChangeSelectObjects,\n  //   payload: {\n  //     change: [{ id: \"regionA\", isSelected: true }],\n  //   },\n  // });\n  // sendEvent({\n  //   name: AppEventType.ChangeUiSettingsZoom,\n  //   payload: {\n  //     zoomType: \"zoomInScreenCenter\",\n  //     useAnimation: false,\n  //   },\n  // });\n  // sendEvent({\n  //   name: AppEventType.ChangeUiSettingsZoom,\n  //   payload: {\n  //     zoomType: \"zoomOutScreenCenter\",\n  //     useAnimation: false,\n  //   },\n  // });\n};\n\nconst testGroup = () => {\n  const beadr = buildBead({\n    id: \"beadr\",\n    color: \"red\",\n    position: {\n      x: 0,\n      y: 0,\n    },\n  });\n  const beadg = buildBead({\n    id: \"beadg\",\n    color: \"green\",\n    position: {\n      x: 50,\n      y: 0,\n    },\n  });\n  const beadb = buildBead({\n    id: \"beadb\",\n    color: \"blue\",\n    position: {\n      x: 100,\n      y: 0,\n    },\n  });\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [beadr, beadg, beadb],\n    },\n  });\n  const __s1 = getStore();\n  console.log(\"__s1\", Object.keys(__s1.objects));\n  sendEvent({\n    name: AppEventType.GroupObjects,\n    payload: {\n      objects: [__s1.objects[\"beadr\"], __s1.objects[\"beadg\"]],\n    },\n  });\n  const __s2 = getStore();\n  console.log(\"__s2\", Object.keys(__s2.objects));\n  sendEvent({\n    name: AppEventType.GroupObjects,\n    payload: {\n      objects: [\n        __s2.objects[\"beadr\"],\n        __s2.objects[\"beadg\"],\n        __s2.objects[\"beadb\"],\n      ],\n    },\n  });\n  const __s2a = getStore();\n  console.log(\"__s2a\", Object.keys(__s2a.objects));\n  undoHistory();\n  const __s3 = getStore();\n  console.log(\"__s3\", Object.keys(__s3.objects));\n  undoHistory();\n  const __s3a = getStore();\n  console.log(\"__s3a\", Object.keys(__s3a.objects));\n  redoHistory();\n  const __s4 = getStore();\n  console.log(\"__s4\", Object.keys(__s4.objects));\n  redoHistory();\n  const __s4a = getStore();\n  console.log(\"__s4a\", Object.keys(__s4a.objects));\n};\n","import React from \"react\";\nimport { EditorScene } from \"./components/Editor\";\nimport { Provider } from \"react-redux\";\nimport { appStore } from \"./immerReducers/appStore\";\nimport { useParams } from \"react-router-dom\";\nimport { renderThreejs, unmountThreejs } from \"./threejs/renderThreejs\";\nimport { clearBoard, prepareBoard } from \"./prepareBoard\";\nimport { AppData } from \"./AppData\";\nimport { startBatchQueue, stopBatchQueue } from \"./ApiService\";\n\nexport const PageBoard: React.FC<{\n  data: AppData;\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined;\n  context: WebGLRenderingContext | undefined;\n}> = (props) => {\n  // React.useEffect(() => {\n  // appStore.dispatch({\n  //   type: \"startAppEvent\",\n  //   payload: { state: appStore.getState() },\n  // });\n  // appStore.dispatch(Actions.Persist.action_readSavedCanvas());\n  // }, []);\n  let { uuid } = useParams<{ uuid: string }>();\n\n  React.useEffect(() => {\n    \n    renderThreejs(\n      document.getElementById(\"threejs\"),\n      props.canvas,\n      props.context\n    ).then(() => {\n      prepareBoard(uuid);\n\n      if (uuid !== \"demo\" && props.data.save_events === true) {\n        startBatchQueue(uuid);\n      }\n    });\n\n    return () => {\n      stopBatchQueue(uuid);\n      clearBoard(uuid);\n      unmountThreejs(document.getElementById(\"threejs\"));\n    };\n  }, []);\n\n  return (\n    <div className=\"App\">\n      <Provider store={appStore}>\n        <EditorScene />\n      </Provider>\n    </div>\n  );\n};\n","import { AppData } from \"./AppData\";\nimport React from \"react\";\nimport { createContext } from \"use-context-selector\";\n\nconst initialState: State = {\n  isAuthorized: false,\n  data: undefined,\n};\n\nexport const AuthContext = createContext<{ state: State; dispatch: Dispatch }>({\n  state: initialState,\n  dispatch: () => null,\n});\n\ntype State =\n  | {\n      isAuthorized: true;\n      data: AppData;\n    }\n  | {\n      isAuthorized: false;\n      data: undefined;\n    };\n\ntype Action = { type: \"logout\" };\ntype Dispatch = (action: Action) => void;\n\nconst reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"logout\":\n      return {\n        isAuthorized: false,\n        data: undefined,\n      };\n    default:\n      return state;\n  }\n};\n\nexport const useValue = (startState: State) => {\n  return React.useReducer(reducer, startState);\n};\n","import React from \"react\";\nimport { Link, useHistory, useLocation } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { useContextSelector, useContextUpdate } from \"use-context-selector\";\nimport { AppData } from \"./AppData\";\nimport { AuthContext } from \"./AuthContext\";\n\nexport const PageHome: React.FC<{\n  data: AppData;\n}> = () => {\n  const dispatch = useContextSelector(AuthContext, (ctx) => ctx.dispatch);\n  const history = useHistory();\n  const onClickLogout = () => {\n    dispatch({\n      type: \"logout\",\n    });\n    history.replace(\"/\");\n  };\n  const onClickBoards = () => {\n    history.push(\"/boards\");\n  };\n  return (\n    <PageStyles>\n      <div>\n        <h2>Welcome</h2>\n        <button onClick={onClickBoards} className={\"btn-light\"}>\n          Boards\n        </button>\n        <button onClick={onClickLogout} className={\"btn-light\"}>\n          Logout\n        </button>\n      </div>\n    </PageStyles>\n  );\n};\n\nconst PageStyles = styled.div`\n  padding: 1em;\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #000;\n    margin-bottom: 10px;\n    margin-right: 10px;\n    cursor: pointer;\n  }\n  h2 {\n    margin-bottom: 0.5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n`;\n","import React from \"react\";\n\nexport const PageNoMatch: React.FC<{ data: any }> = (props) => {\n  return <div>page NO MATCH</div>;\n};\n","import React from \"react\";\nexport const PageNotAutorized: React.FC<{ data: any }> = (props) => {\n  return <div>Not autorized</div>;\n};\n","import React from \"react\";\nimport \"bulma/css/bulma.css\";\nimport \"./App.css\";\n// import { buildBead } from \"./editorObjects/Bead\";\n// import { Actions } from \"./immerReducers/store\";\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\n// import { sendEvent } from \"./controllers/storeController\";\n// import { AppEventType } from \"./controllers/AppEventType\";\n// import { setApiFromAppData } from \"./ApiService\";\nimport { AppData } from \"./AppData\";\nimport { PageBoards } from \"./PageBoards\";\nimport { PageBoard } from \"./PageBoard\";\nimport { PageHome } from \"./PageHome\";\nimport { PageNoMatch } from \"./PageNoMatch\";\nimport { PageNotAutorized } from \"./PageNotAutorized\";\nimport { useContextSelector } from \"use-context-selector\";\nimport { AuthContext, useValue } from \"./AuthContext\";\n\nconst App: React.FC<{\n  data: AppData;\n}> = (props) => {\n  console.log(\"render App.tsx\");\n  const isAuthorized = (props.data?.token ?? \"\").length > 0;\n  const [state, dispatch] = useValue(\n    isAuthorized === true\n      ? {\n          isAuthorized: true,\n          data: props.data,\n        }\n      : {\n          isAuthorized: false,\n          data: undefined,\n        }\n  );\n  return (\n    <AuthContext.Provider value={{ state, dispatch }}>\n      <Routes data={props.data} />\n    </AuthContext.Provider>\n  );\n};\n\nconst Routes: React.FC<{\n  data: AppData;\n}> = (props) => {\n  const isAuthorized = useContextSelector(\n    AuthContext,\n    (ctx) => ctx.state.isAuthorized\n  );\n  return (\n    <Router hashType={\"slash\"}>\n      {isAuthorized ? (\n        <Switch>\n          <Route exact path=\"/\">\n            <PageHome data={props.data} />\n          </Route>\n          <Route exact path=\"/boards\">\n            <PageBoards data={props.data} />\n          </Route>\n          <Route exact path=\"/board/:uuid\">\n            <PageBoard\n              data={props.data}\n              canvas={undefined}\n              context={undefined}\n            />\n          </Route>\n          <Route path=\"*\">\n            <PageNoMatch data={props.data} />\n          </Route>\n        </Switch>\n      ) : (\n        <Switch>\n          <Route exact path=\"/\">\n            <PageNotAutorized data={props.data} />\n          </Route>\n          <Route path=\"*\">\n            <PageNoMatch data={props.data} />\n          </Route>\n        </Switch>\n      )}\n    </Router>\n  );\n};\n\nexport default App;\n\n// \"homepage\": \"https://rpcal.github.io/coralinio-preview/build/\",\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport { AppData } from \"./AppData\";\nimport packageJson from \"./../package.json\";\nimport { setApiFromAppData } from \"./ApiService\";\nimport { merge } from \"lodash\";\n\nconsole.log(\"start app with version: \", packageJson.version);\nconst root = document.getElementById(\"root\");\nif (root !== null) {\n  const threejs = document.createElement(\"div\");\n  threejs.setAttribute(\"id\", \"threejs\");\n  if (root.parentNode) {\n    root.parentNode.insertBefore(threejs, root.nextSibling);\n  }\n\n  try {\n    let data: AppData = {\n      apiHost: \"http://localhost:9000/\",\n      token:\n        \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1dWlkIjoiYzY2Nzg4Y2QtZjM2OS1mNWU5LWFmOTEtYjhlNWI3NmIyNDZhIiwidXNlcm5hbWUiOiJyb2JlZWUiLCJpYXQiOjE2MTcyNTc3NjJ9.LgUWUiFdkarrIfR5FORUI6cnEBHyPgCDmJJXAQlEuBQ\",\n      // token: \"\",\n      user: {\n        username: \"robeee\",\n        uuid: \"dc073641-01a4-107e-ae84-d3ec995bfc80\",\n      },\n      save_events: false,\n    };\n    const hash = root.getAttribute(\"data-hash\");\n    if (hash) {\n      const hashData = JSON.parse(hash);\n      data = merge({}, data, hashData);\n    }\n    setApiFromAppData(data);\n    ReactDOM.render(<App data={data} />, root);\n  } catch (err) {}\n}\n"],"sourceRoot":""}