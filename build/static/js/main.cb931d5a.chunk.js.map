{"version":3,"sources":["editorObjects/Editor.tsx","editorObjects/Point.ts","editorObjects/Bead.ts","ApiService.ts","components/colors.ts","components/SelectedObjectsTopBar/ActionsTypes.tsx","PageBoards.tsx","controllers/AppEventType.ts","logger.ts","controllers/store.ts","editorObjects/Group.ts","editorObjects/PreviewProject3D.ts","editorObjects/Region.ts","threejs/OBJLoader.js","threejs/loadModels.ts","immerReducers/MainImmerReducer.tsx","immerReducers/store.tsx","immerReducers/appStore.tsx","threejs/mouseListeners/MouseDragHelper.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsBase.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeAddBead.ts","threejs/mouseListeners/MouseSelectionHelper.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeAddRegion.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeDelete.ts","controllers/refreshReactState.ts","threejs/keyboard/keyMap.ts","editorObjects/EditBBox.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeSelectOrMove.ts","threejs/SelectBBox.ts","threejs/mouseListeners/SelectionFilter.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsIdle.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeSelectMultiple.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeIdle.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModePaint.ts","threejs/mouseListeners/mouseListeners.ts","threejs/mouseListeners/mouseScreenPosition.ts","threejs/mouseListeners/getRect10x10FromScreenToWorld.ts","controllers/AppHistory.ts","threejs/thumbnailsGenerator.ts","threejs/renderThreejs.ts","threejs/clipboard.ts","threejs/mouseListeners/screenToWorld.ts","threejs/eventEmitterHandlers.ts","controllers/BaseHandlers/BaseEventHandler.ts","controllers/BaseHandlers/StoreObjectHandler.ts","controllers/EventHandlers/AddObjectHandler.ts","controllers/EventHandlers/RemoveObjectHandler.ts","controllers/EventHandlers/ChangeSelectObjectsHandler.ts","controllers/EventHandlers/ChangeObjectsPropertyHandler.ts","controllers/EventHandlers/ChangeUiSettingsHandler.ts","controllers/EventHandlers/ClipboardCopyHandler.ts","controllers/EventHandlers/ClipboardCutHandler.ts","controllers/EventHandlers/ClipboardPasteHandler.ts","controllers/EventHandlers/AddMultipleBeadsHandler.ts","controllers/EventHandlers/ChangeUiSettingsZoomHandler.ts","controllers/EventHandlers/ChangeUiSettingsSidebarHandler.ts","controllers/EventHandlers/ChangeObjectsAlignmentHandler.ts","controllers/EventHandlers/DuplicateObjectsHandler.ts","controllers/EventHandlers/GroupObjectsHandler.ts","controllers/EventHandlers/UngroupObjectsHandler.ts","controllers/storeController.ts","components/SelectedObjectsTopBar/ActionsIconsWrapper.tsx","components/SelectedObjectsTopBar/NumericInput.tsx","components/SelectedObjectsTopBar/PopupWrapper.tsx","components/SelectedObjectsTopBar/TopBarContent.tsx","components/SelectedObjectsTopBar/SelectedObjectsTopBar.tsx","components/ModalEditBoard.tsx","components/ProjectInfoWrapper.tsx","components/MinimapWrapper.tsx","components/BeadsSummary.tsx","components/Toolbar/EditorModes.tsx","components/ActionsWrapper.tsx","components/PanelContentStyles.tsx","components/RightSidebar.tsx","components/LeftSidebar.tsx","components/BottomBar.tsx","components/ModalSearchProducts.tsx","components/Editor.tsx","threejs/apiControler.ts","prepareBoard.tsx","PageBoard.tsx","AuthContext.tsx","PageHome.tsx","PageNoMatch.tsx","PageNotAutorized.tsx","GlobalAppStyles.tsx","i18n.ts","App.tsx","index.tsx"],"names":["BeadTypes","BeadMaterialTypes","RegionGridType","RegionShape","ObjectTypes","EditorMode","EditorMenuMain","EditorGridType","BrushType","NAME_SEPARATOR","BeadChildSuffix","buildPoint","x","y","z","contain","p1","p2","p","apiHost","tempBoardId","SaveEventType","getThreeNameFromBeadId","id","childSuffix","MAIN","Bead","getThreeUserDataFromBead","bead","merge","name","buildBead","props","defaults","THREE","generateUUID","position","type","MODEL_TOHO_ROUND","material","Mat","rotateX","rotateY","rotateZ","lineRotate","color","height","width","depth","keepAspectRatio","canLockOrUnlock","isLocked","objectType","groupId","undefined","regionId","headers","handleError","err","reject","console","error","sendingEnabled","lastSendTimestamp","Date","getTime","toSendEventsQueue","ActionsTypes","ActionsGroupTypes","notifyBackend","events","length","forEach","event","push","debouncedSend","debounce","triggerSendBatchEvents","trailing","now","log","body","JSON","stringify","changes","Promise","resolve","fetch","method","then","res","json","response","statusCode","message","status","catch","sendBoardBatchEvents","PageBoards","useTranslation","t","history","useHistory","React","useState","boards","state","setBoards","useEffect","data","save_events","PageStyles","onClick","board","uuid","className","to","data-test","map","styled","div","AppEventType","SnapToLineType","MapActionObjectType","EditBeadProduct","EditBeadType","EditBeadMaterial","EditBeadColor","Alignment","EditWidthHeightDepth","EditPosition","EditRotate","Group","Ungroup","Lock","Unlock","More","Region","EditRegionShape","EditRegionGridType","EditRegionGridSettings","EditWidthHeight","PreviewProject3D","Actions","sortOrder","EditBeadsProperies","groupSortOrder","EditRegionProperies","Transform","LockOrUnlock","GroupOrUngroup","store","GroupChildSuffix","enabled","logger","warn","defaultStore","objects","selectedIds","canRedo","canUndo","canEdit","canToggleToFavourite","isFavourite","canExportAsImage","editModalVisible","ui","modalSearchProducts","isOpen","successAction","advBlockVisible","producer","q","cachedResponse","scrollPosition","leftSidebar","panel","rightSidebar","zoomScale","mode","SelectOrMove","lights","intensity","grid","Hex","hexSize","snapEnabled","isVisible","selectedTopBarPosition","blockThreejs","loading","emptyStore","cloneDeep","getStore","setStore","newStore","refreshThreejs","refreshReact","shouldRefreshThree","shouldRefreshReact","PreviewProject3DChildSuffix","getThreeNameFromGroupId","getThreeUserDataFromGroup","group","buildGroup","childrenIds","RegionChildSuffix","getThreeNameFromPreviewProject3DId","getThreeUserDataFromPreviewProject3D","obj","getThreeNameFromRegionId","getThreeUserDataFromRegion","region","getBricksColumnsAndRowsCount","currentColumns","columns","rows","isActiveRegionCell","index","shape","Rectangle","newSize","gridType","Bricks","rowOdd","Math","floor","isNotLastColumn","Triangle","_row","column","row","isInside","lastColumnIndex","min","ratio","max","beadsCountInRow","emptyCells","offsetFromStart","offsetFromEnd","insideRegionTriange","buildRegion","Rectangles","beadIds","opacity","autoFillBeads","snapBeadsToCell","childrenGridIds","newRegion","size","newChildrenGridIds","Array","fill","BufferGeometry","FileLoader","Float32BufferAttribute","LineBasicMaterial","LineSegments","Loader","Material","Mesh","MeshPhongMaterial","Points","PointsMaterial","Vector3","OBJLoader","object_pattern","material_library_pattern","material_use_pattern","map_use_pattern","vA","vB","vC","ab","cb","ParserState","object","vertices","normals","colors","uvs","materials","materialLibraries","startObject","fromDeclaration","this","previousMaterial","currentMaterial","_finalize","geometry","hasUVIndices","smooth","startMaterial","libraries","previous","inherited","groupCount","splice","mtllib","isArray","groupStart","groupEnd","clone","cloned","bind","end","lastMultiMaterial","mi","declared","finalize","parseVertexIndex","value","len","parseInt","parseNormalIndex","parseUVIndex","addVertex","a","b","c","src","dst","addVertexPoint","addVertexLine","addNormal","addFaceNormal","fromArray","subVectors","cross","normalize","addColor","addUV","addDefaultUV","addUVLine","addFace","ua","ub","uc","na","nb","nc","vLen","ia","ib","ic","nLen","uvLen","addPointGeometry","vi","l","addLineGeometry","uvi","manager","call","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","loader","setPath","path","setRequestHeader","requestHeader","setWithCredentials","withCredentials","text","parse","e","itemError","setMaterials","indexOf","replace","lines","split","line","lineFirstChar","result","trimLeft","i","trim","charAt","parseFloat","vertexData","substr","faceVertices","j","jl","vertex","vertexParts","v1","v2","v3","lineParts","substring","lineVertices","lineUVs","li","llen","parts","pointData","exec","test","toLowerCase","container","concat","isLine","isPoints","hasVertexColors","buffergeometry","setAttribute","mesh","createdMaterials","miLen","materialHash","sourceMaterial","materialPoints","sizeAttenuation","copy","materialLine","flatShading","vertexColors","addGroup","add","points","base3dModels","model_cylinder","model","bbox","model_sphere","model_fire_polish","model_toho_round","loadAppModels","models","filename","key","objLoader","loadAsync","setFromObject","toString","MainImmerReducer","newState","draftState","ImmerReducer","Main","createActionCreators","composeReducers","createReducerFunction","appStore","createStore","MouseDragHelper","isDragged","isDragStarted","start","shouldBehaveLikeMove","deltaX","deltaY","abs","MouseEventsBase","boundingClientRect","mouse","raycaster","intersects","layers","enable","clientX","clientY","appThree","el","getBoundingClientRect","top","left","setFromCamera","camera","intersectObjects","scene","children","getObjectsFromIntersect","getIntersect","filter","userData","SceneEditBBox","objectId","isGroup","isInGroup","maxItems","selected","MouseEventsEditorModeAddBead","mouseDragHelper","lastAddPosition","screenToWorld","onDown","addBead","set","onMove","currPosition","distanceTo","onUp","worldX","wordlY","action1","AddObjects","payload","sendEvent","MouseSelectionHelper","element","renderer","startPoint","pointTopLeft","pointBottomRight","isDown","document","createElement","style","pointerEvents","background","border","zIndex","Vector2","screenX","screenY","domElement","parentElement","appendChild","removeChild","MouseEventsEditorModeAddRegion","isCameraGrabed","startDragMousePosition","startDragCamera","mouseSelectionHelper","setRenderer","minX","minY","action2","ChangeUiSettings","uiSettings","MouseEventsEditorModeDelete","touchedIds","touchBead","RemoveObjects","ids","beadsIds","Set","has","triggerDeleteBeadIds","from","refreshReactState","dispatch","updateEditorState","keyCodeToKeyName","8","9","13","16","17","18","20","27","32","33","34","35","36","37","38","39","40","45","46","91","93","224","106","107","109","110","111","186","187","188","189","190","191","192","219","220","221","222","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","defaultMonitor","eventName","__preventDefaultEvents","__pressed","__element","__subscriptions","__monitor","initKeybinding","hidden","visibilityChange","window","handleVisibilityChange","msHidden","webkitHidden","addEventListener","EditBBoxChildSuffix","subscribeKeys","callback","unsubscribe","isPressedKey","unhandleKeyEvent","handleKeyEvent","preventDefault","keyName","keys","code","keyCode","which","String","fromCharCode","join","getKeyEventName","listeners","matched","propagate","ActionType","getThreeNameFromEditBBoxId","selectBBoxInstance","getSelectBBox","SelectBBox","rotation","rectangles","internalId","dotBrName","dotBlName","dotTrName","dotTlName","selectBboxGroupName","selectBBoxBgName","boxGeometry","layerRoot","layerChild","worldPosEnd","startPos","dotsStartPositions","selectBBoxBgStartPosition","selectBBoxBgStartScale","selectBBoxBgEndPosition","selectBBoxBgEndScale","getResizeDots","dotSize","__material","__boxGeometry","_whiteDot","scale","renderOrder","___material","___boxGeometry","_grayDot","_baseDot","attach","_dotTL","_dotTR","_dotBL","_dotBR","tl","isSelected","tr","bl","br","BG","DOT_RESIZE_BOTTOM_RIGHT","DOT_RESIZE_BOTTOM_LEFT","DOT_RESIZE_TOP_RIGHT","DOT_RESIZE_TOP_LEFT","get","diffX","diffY","selectBBoxGoup","syncRectsWithStore","mask","item","parent","dotTl","dotTr","dotBl","dotBr","selectBBoxBg","updateHandleAndBg","diffPosition","sub","diffScale","divide","newPosition","currScale","newScale","multiply","objectOffset","properties","ChangeObjectsProperty","rectangle","toDelete","toCreate","rectIndex","findIndex","isRectExists","deleteHandleAndBg","createHandleAndBg","remove","delete","side","transparent","selectBBoxLines","getRectLine","dot","x1","x2","y1","y2","rectShape","moveTo","lineTo","autoClose","_rectLinesPoints","getPoints","_rectLinesGeometryPoints","setFromPoints","_rectLinesMaterial","rect","DEG2RAD","expandByObject","getCenter","clear","_bbox","getRectBBox","_pos","centerX","centerY","_w","_h","_line","_dotTl","_dotTr","_dotBl","_dotBr","SelectionFilter","frustum","Frustum","center","tmpPoint","vecNear","vecTopLeft","vecTopRight","vecDownRight","vecDownLeft","vecFarTopLeft","vecFarTopRight","vecFarDownRight","vecFarDownLeft","vectemp1","vectemp2","vectemp3","endPoint","collection","deep","Number","MAX_VALUE","updateFrustum","searchChildInFrustum","_startPoint","_endPoint","EPSILON","updateProjectionMatrix","updateMatrixWorld","isOrthographicCamera","right","down","unproject","planes","setFromCoplanarPoints","normal","multiplyScalar","isMesh","intersectsBox","includes","MouseEventsIdle","sceneScale","mouseDiffXInWorldSpace","mouseDiffYInWorldSpace","cameraX","cameraY","lookAt","MouseEventsEditorModeSelectOrMove","actionType","selectionBox","prevEditBBox","mouseEventsIdle","setCamera","setScene","moveCamera","altKey","deselectMultipleObjects","shiftKey","selectMultipleObjects","selectBBox","isHandle","editSelectBBox","onDownEdit","clicked","clickedId","clickedItemInSelectedObjects","selectedIsLocked","getSelectionForSingleObjectIdAction","moveAllSelectedObjects","onDownMove","isGroupChild","isClickedOnGroup","moveObjectGroup","moveSingleObject","isChild","moveSelectBBox","updateUIAtMove","onMoveEdit","onMoveMove","action","ChangeSelectObjects","change","produce","draft","getTopBarPosition","getIdsFromGroupOrInGroup","getMoveObjectsAction","clickedObjectIsLocked","getSelectionAppendAction","onUpMove","getActiveObjectsFromIntersect","allSelectedIds","selectIds","onUpEdit","objectIds","_id","__id","_newIsSelected","_addWithIsLock","addWithIsLock","newSelected","shouldBeSelected","child_object","child","visible","hideTopBar","showTopBar","topBar","querySelector","display","MouseEventsEditorModeIdle","getState","MouseEventsEditorModePaint","paintBead","moudeEditorModeIdle","moudeEditorModeSelectOrMove","moudeEditorModePaint","moudeEditorModeDelete","moudeEditorModeAddRegion","moudeEditorModeAddBead","moudeEditorModeSelectMultiple","MouseEventsEditorModeSelectMultiple","mousePosition","setMousePositionAtWindow","newPos","onWheel","updateUiEvent","ChangeUiSettingsZoom","zoomType","useAnimation","scrollDelta","Idle","DeleteBeads","PaintBeads","AddRegion","AddBeads","SelectMultiple","onWindowResize","bottom","setSize","onResize","onPointerDown","onPointerUp","onPointerOut","onPointerMove","thumbnailsGenerator","getRect10x10FromScreenToWorld","viewportOffset","pos1","pos2","maxX","maxY","w","h","AppHistory","maxHistoryRecords","arg","diff","do","isActive","createdAt","undoHistory","lastEvent","getHistory","back","undo","redoHistory","front","redo","clipboardContent","setClipboardBoardContent","content","clipboardCopy","ClipboardCopy","clipboardCut","ClipboardCut","clipboardPaste","ClipboardPaste","initThumbnailsGenerator","rootEl","ThumbnailsGenerator","cache","antialias","preserveDrawingBuffer","imgWidth","imgHeight","forceCache","cacheData","cacheId","createObjectThumbnail","object3d","getThreeBeadModel","ratioImage","baseWidth","baseHeight","halfWidth","halfHeight","lightConfig","addLightFromUI","render","toDataURL","initCanvasApp","canvas","context","classList","contains","AppThree","requestAnimationFrame","threeRender","rect10x10FromScreenToWorld","pressed","ctrlKey","metaKey","Map","clientWidth","clientHeight","needResize","needToResizeRendererToDisplaySize","Error","worldToScreen","pos","vector","widthHalf","heightHalf","project","config","light","SceneLight","addObjectByObjectType","triggerAddBeadToScene","triggerRegionToScene","triggerGroupToScene","triggerPreviewProject3DToScene","isFinite","getTopBarPositionInScreenFromObject","updateObjectPosition","positionX","positionY","regionBgThree","regionGridCellsThree","GRID_CELLS","beadId","isCellActive","cellWidth","cellHeight","_rectPoints","_rectGeometryPoints","_lineMaterial","_cell","GRID_CELL","offsetX","regionThree","traverse","shouldSelect","emissive","triggerSelectBead","beadType","beadModel","MODEL_CYLINDER","MODEL_FIRE_POLISH","MODEL_SPHERE","getModelFromBeadType","ANY","reflectivity","Shiny","computeBoundingBox","skipObjects","groupBgThree","groupThree","previewProject3D","triggerDeleteObjectIds","BaseEventHandler","saveToHistory","posX","posY","getCenterPosition","_store","getSimpleHistoryEvents","StoreObjectHandler","buildPreviewProject3D","updateRect","selectObjectOnThreeScene","_beadId","getMousePosition","worldPos","expandByPoint","bboxCenter","AddObjectHandler","newObject","getAppObjectFromCloneAppObject","historyEvent","formatISO","getStoreWithHistory","CREATE","toISOString","RemoveObjectHandler","deleteSelectedObjectsFromStore","DELETE","ChangeSelectObjectsHandler","historyChange","getNewStoreWithTopBarPosition","ChangeObjectsPropertyHandler","added","updated","removed","historyChanges","_singleChange","singleHistoryChange","relatedChanges","shouldBeCreated","shouldBeDeleted","keyNames","_singeRelatedChange","whenBead","whenRegion","exists","applyChangesToThree","UPDATE","updatedKeys","inGroup","isBeadFoundRegion","isRegionContainBead","getRegionCellIndex","newIndex","oldIndex","getRegionCellCenter","currentIndex","oldRegionId","shapeKey","gridTypeKey","autoFillBeadsKey","snapBeadsToCellKey","rowsKey","columnsKey","positionKey","tempIds","oldRows","oldColumns","oldShape","oldGridType","autoFillBeadsEnabled","getRegionChildrenGridIdsAfterResize","toDeleteBeadIds","oldPosition","foundObject","isRegionCellContainBead","emptyCellsCount","snapBeadsToCellEnabled","nextIdIndexFromCreated","getRegionCellCenterFromCellIndex","getIdFromUndoOrRedo","nextIdIndexFromDeleted","newRows","newColumns","oldCurrentRow","oldCurrentCol","newIndexIsActive","oldMiddle","newMiddle","newColumn","ceil","newRow","regionTopLeftX","regionTopLeftY","cellIndex","currentRow","currentCol","cellW","cellH","_offsetX","rowIndex","columnIndex","offsetY","distX","ChangeUiSettingsHandler","ClipboardCopyHandler","ClipboardCutHandler","clonedObjects","ClipboardPasteHandler","mapIds","oldId","getPositionDiffFromMousePosition","moveObjectsByDiff","newChildrenIds","AddMultipleBeadsHandler","figure","defaultBead","times","col","ChangeUiSettingsZoomHandler","screenCenter","scrollSign","sign","updateByScroll","mouseXInWorldBefore","mouseYInWorldBefore","zoomChange","mouseXInWorldAfter","mouseYInWorldAfter","ChangeUiSettingsSidebarHandler","open","toggle","newOpen","ChangeObjectsAlignmentHandler","snapType","updates","X_MIN","X_MIDDLE","X_MAX","Y_MIN","Y_MIDDLE","Y_MAX","DuplicateObjectsHandler","GroupObjectsHandler","idsGroups","idsObjectsWithoutGroups","idsInGroup","objId","newGroup","newGroupId","GroupObjects","UngroupObjects","UngroupObjectsHandler","classNames","AddMultipleBeads","ChangeUiSettingsSidebar","ChangeObjectsAlignment","DuplicateObjects","handler","run","ActionsIconsWrapper","GroupActionsStyles","actions","selectedAction","data-tip","data-place","data-type","data-effect","icon","faShapes","faBorderNone","faCrosshairs","faSync","faArrowsAlt","faAlignLeft","faChevronDown","faSearch","faBurn","faTimes","ItemActionWrapper","elRef","useRef","ref","current","offsetLeft","offsetParent","offsetWidth","groupOffsetLeft","finalOffsetLeft","IconActionsTypeMore","faEllipsisH","IconActionsTypeEditBeadColor","backgroundColors","useSelector","Fragment","slice","IconActionsUnlock","startLongPress","setStartLongPress","onSuccess","timerId","setTimeout","clearTimeout","useCallback","stop","onMouseDown","onMouseUp","onMouseLeave","onTouchStart","onTouchEnd","transitionDuration","faLock","IconActionsLock","_event","faUnlock","IconActionsGroup","faObjectGroup","IconActionsUngroup","faObjectUngroup","IS_BROWSER","RE_NUMBER","RE_INCOMPLETE_NUMBER","access","prop","defaultValue","args","NumericInput","_timer","_valid","_isStrict","_ignoreValueChange","_isMounted","_inputFocus","refsWrapper","refsInput","strict","btnDownHover","btnDownActive","btnUpHover","btnUpActive","stringValue","_propsToState","out","hasOwnProperty","_parse","nextState","setState","saveSelection","prevProps","prevState","isNaN","NaN","_invokeEventCallback","focus","selectionStart","selectionEnd","checkValidity","getValueAsNumber","setValue","activeElement","target","valid","validationError","supportsValidation","noValidate","pattern","required","validity","validationMessage","maxLength","validStateChanged","search","RegExp","addClass","removeClass","n","precision","pow","_min","defaultProps","_max","round","_n","_toNumber","toFixed","format","_step","step","DIRECTION_UP","DIRECTION_DOWN","snap","persist","isDefaultPrevented","_recursive","increase","SPEED","DELAY","decrease","dir","callbackName","css","mobile","componentClass","noStyle","onInvalid","onValid","rest","hasFormControl","attrs","wrap","input","btnUp","onMouseEnter","btn","disabled","readOnly","btnDown","loose","_format","onChange","original","val","onKeyDown","_onKeyDown","onInput","onSelect","onFocus","onBlur","InputTag","minus","plus","arrowUp","arrowDown","Component","MIN_SAFE_INTEGER","MAX_SAFE_INTEGER","borderWidth","borderColor","borderStyle","margin","textAlign","cursor","transition","boxShadow","borderRadius","paddingRight","boxSizing","fontSize","paddingLeft","WebkitAppearance","lineHeight","textShadow","SliderPlus","createSliderWithTooltip","Slider","PopupWrapper","leftOffset","PopupWrapperStyles","EditBeadColorPopup","SwatchesPickerStyles","onChangeComplete","hex","EditBeadTypePopup","types","faSquareFull","faCircle","faSquare","EditBeadProductPopup","bead1","bead2","bead3","flexDirection","getObjectThumbnail","alt","EditBeadMaterialPopup","materialTypes","justifyContent","alignItems","EditRegionGridTypePopup","cols","faGripHorizontal","faAlignCenter","EditRegionShapePopup","faPlay","transform","EditRegionGridSettingsPopup","onlyBricks","onlyShapeTriange","_columns","_rows","showRows","showDecimal","label","values","InputTypeNumber","negative","multiplicator","EditPositionPopup","result_x","result_y","result_z","_x","_y","_z","onChangeX","newValue","onChangeY","SliderWrapper","marginBottom","marginTop","onAfterChange","EditRotatePopup","onChangeZ","EditWidthHeightPopup","_width","_height","EditWidthHeightDepthPopup","AlignmentPopup","sendSnapTo","uiButton","getComputedStyle","getPropertyValue","faAlignRight","MorePopup","onlyRegionsInfo","snapToCellChecked","autoFillChecked","regionIds","onlyRegions","_value1","_value2","minWidth","faCheck","faExclamationCircle","TopBarContent","actionsGrouped","selectedActions","actionsForType","groupedResults","containsLockedGroup","containsRegion","anySelectedBeadInRegion","inGroupCount","noGroupCount","sort","groupIdA","groupIdB","firstActionA","firstActionB","groupSortOrderA","groupSortOrderB","actionA","actionB","popupInfo","setPopupInfo","onClickAnyIcon","SelectedObjectsTopBar","SelectedObjectsTopBarStyles","ModalEditBoard","setName","onClickCancel","ModalEditProjectStyles","placeholder","newName","setNewProjectName","ProjectInfoWrapper","ProjectInfoWrapperStyles","faStarSolid","faStarRegular","link","download","href","click","faUpload","faReply","MinimapWrapper","MinimapWrapperStyles","faMinus","faPlus","BeadsSummary","groupedCount","groups","groupData","count","example","textName","textTooltip","newCount","textCount","BeadsSummaryStyles","imgSrc","EditorModes","editorMode","onChangeEditorMode","newEditorMode","faMousePointer","faExpand","faPaintBrush","faTrashAlt","testId","faTable","faTh","StateButton","ButtonStyles","FastAddBeadsButton","defaultDimesions","defaultSelected","dimensions","setDimensions","setSelected","selectionVisible","setVisible","toggleSelection","data-tip-disable","SelectionStyles","colIndex","onCancel","SelectionFrame","divRef","useOutsideClick","handleClick","removeEventListener","ActionsWrapper","ActionsWrapperStyles","PanelContentStyles","CloseButton","RightSidebar","RightSidebarStyles","HistoryPanel","HistoryPanelStyles","_","lastIndex","jumpToIndexHistory","faHistory","date","toDate","ObjectsPanel","filterSelected","setFilterSelected","selectedObjects","setSelectedObjects","onClickFilter","ObjectsPanelStyles","isBead","LeftSidebar","LeftSidebarStyles","CommentsPanel","BottomBar","setIsOpen","BottomBarStyles","faComment","faListAlt","faAngleDoubleLeft","faAngleDoubleRight","ModalSearchProducts","Content","productsRef","setQ","setProducer","setColor","setAdvBlockVisible","setLoading","setError","setData","scrollTop","onStartSearch","_q","_producer","_color","queryString","URLSearchParams","append","bead_products","bead_geometry","file_name","getNum","replaceAll","bead_color","fetchBeadProducts","triggerSearch","onClickBeadProducer","onClickBeadColorCategory","ModalSearchProductsStyles","autoComplete","onKeyPress","faChevronUp","category","onSelectProduct","display_name","bead_product_uuid","ProducerItem","BeadColorCategory","backgroundColor","EditorScene","leftSidebarOpen","rightSidebarOpen","EditorMainStyles","LoadingInfo","faSyncAlt","getProjectData","getDemoProjectData","fetchBoard","prepareBoard","SceneBackgroundGrid","addGridFromUi","testRegions","beadr","beadg","beadb","regionA","regionB","regionC","onStart","renderThreejs","getElementById","onEnd","innerHTML","PageBoard","useParams","initialState","isAuthorized","AuthContext","createContext","reducer","PageHome","useContextSelector","ctx","localStorage","removeItem","location","PageNoMatch","PageNotAutorized","BulmaReset","AppReactStyles","AppVariables","AppFonts","GlobalAppStyles","createGlobalStyle","locales","enUS","pl","i18next","use","HttpApi","LanguageDetector","initReactI18next","sprintf","init","debug","preload","whitelist","ns","fallbackLng","fallbackNS","defaultNS","saveMissing","initImmediate","interpolation","escapeValue","lng","isDate","localesKey","locale","formatDate","formatRelative","formatDistance","addSuffix","returnEmptyString","overloadTranslationOptionHandler","backend","loadPath","translationHost","detection","order","lookupQuerystring","lookupCookie","lookupLocalStorage","lookupSessionStorage","caches","react","useSuspense","Routes","hashType","exact","App","startState","token","useReducer","fallback","I18nextProvider","i18n","Provider","packageJson","version","process","root","threejs","parentNode","insertBefore","nextSibling","user","username","hash","getAttribute","hashData","ReactDOM"],"mappings":"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","file":"static/js/main.cb931d5a.chunk.js","sourcesContent":["import { Store } from \"../controllers/store\";\n\nexport interface Point {\n  x: number;\n  y: number;\n  z: number;\n  // [immerable]: boolean;\n}\n\nexport enum BeadTypes {\n  // TOHO_MIYUKI = \"TOHO_MIYUKI\",\n  // TOHO_15 = \"TOHO_15\",\n  // TOHO_SPHERE = \"TOHO_SPHERE\",\n  MODEL_SPHERE = \"MODEL_SPHERE\",\n  MODEL_CYLINDER = \"MODEL_CYLINDER\",\n  MODEL_FIRE_POLISH = \"MODEL_FIRE_POLISH\",\n  MODEL_TOHO_ROUND = \"MODEL_TOHO_ROUND\",\n}\n\nexport interface AppObjectProps {\n  id: string;\n  position: Point;\n  width: number;\n  height: number;\n  depth: number;\n  rotateX: number;\n  rotateY: number;\n  rotateZ: number;\n  objectType: ObjectTypes;\n  isLocked: boolean;\n  canLockOrUnlock: boolean;\n}\n\nexport interface PreviewProject3D extends AppObjectProps {\n  color: string;\n}\n\nexport enum BeadMaterialTypes {\n  \"Shiny\" = \"Shiny\",\n  \"Mat\" = \"Mat\",\n}\n\nexport interface Bead extends AppObjectProps {\n  type: BeadTypes;\n  color: string;\n  material: BeadMaterialTypes;\n  lineRotate: number;\n  keepAspectRatio: boolean;\n  regionId: string | undefined;\n  groupId: string | undefined;\n}\n\nexport const groupIdKey: keyof Bead = \"groupId\";\n\nexport interface EditBBox {\n  id: string;\n  position: Point;\n  // [immerable]: boolean;\n  width: number;\n  height: number;\n  depth: number;\n  rotateX: number;\n  rotateY: number;\n  rotateZ: number;\n  editable: boolean;\n  selectedIds: {\n    id: string;\n    objectType: ObjectTypes;\n    groupId: string | undefined;\n  }[];\n  canLockOrUnlock: true;\n  isLocked: false;\n  objectType: ObjectTypes;\n  bbox?: THREE.Box3;\n}\n\nexport interface Line {\n  id: string;\n  start: Point;\n  end: Point;\n  beadIds: string[];\n  // [immerable]: boolean;\n  settings: {\n    beadsCount: number;\n    beadsAutoCount: boolean;\n    beadsSpacing: number;\n    beadsAutoSpacing: boolean;\n    defaultBead: Partial<Bead>;\n  };\n}\n\nexport enum RegionGridType {\n  Rectangles = \"Rectangles\",\n  Bricks = \"Bricks\",\n}\n\nexport enum RegionShape {\n  Rectangle = \"Rectangle\",\n  Triangle = \"Triangle\",\n  Circle = \"Circle\",\n}\n\nexport interface Region extends AppObjectProps {\n  beadIds: string[];\n  gridType: RegionGridType;\n  shape: RegionShape;\n  opacity: number;\n  columns: number;\n  rows: number;\n  autoFillBeads: boolean;\n  snapBeadsToCell: boolean;\n  childrenGridIds: (string | undefined)[];\n  // settings: {\n  // beadsCount: number;\n  // beadsAutoCount: boolean;\n  // beadsSpacing: number;\n  // beadsAutoSpacing: boolean;\n  // defaultBead: Partial<Bead>;\n  // };\n}\n\nexport interface Group extends AppObjectProps {\n  objectType: ObjectTypes;\n  childrenIds: string[];\n}\n\nexport interface AppData {\n  objects: { [s: string]: AppObject };\n  /**@deprecated */\n  beads: { [s: string]: Bead };\n  /**@deprecated */\n  lines: { [s: string]: Line };\n  /**@deprecated */\n  regions: { [s: string]: Region };\n}\n\nexport type AppObject = Bead | Region | Group | PreviewProject3D;\nexport type AppObjectKeys =\n  | keyof Bead\n  | keyof Region\n  | keyof Group\n  | keyof PreviewProject3D;\n\n// const dupa: MappedTypeWithNewProperties<AppObject> = {\n//   beadIds:\n// }\n\nexport enum ObjectTypes {\n  Bead = \"Bead\",\n  Region = \"Region\",\n  Group = \"Group\",\n  PreviewProject3D = \"PreviewProject3D\",\n  SceneEditBBox = \"SceneEditBBox\",\n  SceneBackgroundGrid = \"SceneBackgroundGrid\",\n  SceneLight = \"SceneLight\",\n}\nexport const NAME_SEPARATOR = \"__\";\n\nexport enum EditorMode {\n  Idle = \"Idle\",\n  EditLines = \"EditLines\",\n  AddLine = \"AddLine\",\n  SelectOrMove = \"SelectOrMove\",\n  SelectMultiple = \"SelectMultiple\",\n  AddBeads = \"AddBeads\",\n  DeleteBeads = \"DeleteBeads\",\n  PaintBeads = \"ColorPaint\",\n  AddRegion = \"AddRegion\",\n}\nexport enum EditorMenuMain {\n  None = \"None\",\n  File = \"File\",\n  Grid = \"Grid\",\n  Background = \"Background\",\n}\nexport enum EditorGridType {\n  Hex = \"Hex\",\n  Box = \"Box\",\n}\nexport enum BrushType {\n  Color = \"Color\",\n}\nexport interface ThreeLightConfig {\n  id: string;\n  type: \"THREE.DirectionalLight\" | \"THREE.AmbientLight\";\n  name: string;\n  color?: string | number | THREE.Color | undefined;\n  intensity?: number | undefined;\n  position?: {\n    x: number;\n    y: number;\n    z: number;\n  };\n}\n\nexport interface ThreeGridHelperConfig {\n  id: string;\n  type: EditorGridType;\n  hexSize: number;\n  snapEnabled: boolean;\n  isVisible: boolean;\n  width: number;\n  height: number;\n}\n\n// export interface EditorUi {\n//   mode: EditorMode;\n//   lights: ThreeLightConfig[];\n//   zoomScale: number;\n//   lineSettings: DeepPartial<Line>;\n//   saveInfo: {\n//     saved: boolean;\n//     haveUnsavedChanges: boolean;\n//   };\n//   /**@deprecated */\n//   selectedLinesIds: { [s: string]: boolean };\n//   /**@deprecated */\n//   selectedLinesIdsCount: number;\n//   /**@deprecated */\n//   selectedBeadsIds: { [s: string]: boolean };\n//   /**@deprecated */\n//   selectedBeadsIdsCount: number;\n//   /**@deprecated */\n//   selectedRegionsIds: { [s: string]: boolean };\n//   /**@deprecated */\n//   selectedRegionsIdsCount: number;\n//   selectedIds: string[];\n//   selectedIdsAsKeys: { [s: string]: boolean };\n//   selectedIdsCount: number;\n//   selectedTopBarPosition: THREE.Vector3 | undefined;\n//   editBBox: EditBBox | undefined;\n//   mouseSelection: {\n//     start: Point;\n//     end: Point;\n//     isDragStarted: boolean;\n//     isDragged: boolean;\n//   };\n//   currentMenuMainOpen: EditorMenuMain;\n//   grid: ThreeGridHelperConfig;\n//   currentBeadChain: {\n//     isDragEnabled: boolean;\n//     beadIds: string[];\n//   };\n//   beadsTemplate: {\n//     width: number;\n//     height: number;\n//     depth: number;\n//     type: BeadTypes;\n//     color: string;\n//     rotateX: number;\n//     rotateY: number;\n//     rotateZ: number;\n//     keepAspectRatio: boolean;\n//   };\n//   regionTemplate: {\n//     gridType: RegionGridType;\n//   };\n//   brush: {\n//     type: BrushType;\n//     size: number;\n//     color: string;\n//   };\n//   background: {\n//     image: {\n//       url: string;\n//       scale: number;\n//       position: Point;\n//       opacity: number;\n//     };\n//   };\n//   sceneWrapperWidth: number;\n//   sceneWrapperHeight: number;\n//   sceneWrapperPosition: {\n//     x: number;\n//     y: number;\n//     angle: number;\n//     scale: number;\n//     top: number;\n//     left: number;\n//   };\n// }\n\nexport interface Editor extends Store {\n  // appData: AppData;\n  // ui: StoreUiSettings;\n}\n","import { Point } from \"./Editor\";\n\nexport const buildPoint = (\n  x: number = 0,\n  y: number = 0,\n  z: number = 0\n): Point => {\n  return {\n    x,\n    y,\n    z,\n    // [immerable]: true,\n  } as Point;\n};\n\nexport const getLength = (point: Point) => {\n  return Math.sqrt(point.x * point.x + point.y * point.y);\n};\n\nexport const normalize = (point: Point) => {\n  const length = getLength(point);\n  const useLen = length === 0;\n  const x = useLen ? 0 : point.x / length;\n  const y = useLen ? 0 : point.y / length;\n  return buildPoint(x, y);\n};\n\nexport const scale = (point: Point, scalar: number) => {\n  return buildPoint(point.x * scalar, point.y * scalar);\n};\n\nexport const add = (point: Point, x: number, y: number) => {\n  return buildPoint(point.x + x, point.y + y);\n};\n\nexport const sub = (point: Point, x: number, y: number) => {\n  return buildPoint(point.x - x, point.y - y);\n};\n\nexport const getDistance = (x1, y1, x2, y2): number => {\n  return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n};\n\nexport const getDistanceBetweenPoints = (start: Point, end: Point): number => {\n  return Math.sqrt(\n    (end.x - start.x) * (end.x - start.x) +\n      (end.y - start.y) * (end.y - start.y)\n  );\n};\n\nexport const getRotate = (y, x) => {\n  return Math.atan2(y, x);\n};\n\nexport const contain = (p1: Point, p2: Point, p: Point): boolean => {\n  return p.x > p1.x && p.x < p2.x && p.y > p1.y && p.y < p2.y;\n};\n\nexport const toRadian = (radians: number) => {\n  return (radians / 180) * Math.PI;\n};\n\nexport const toDeg = (radians: number) => {\n  return (radians * 180) / Math.PI;\n};\n","import {\n  Bead,\n  BeadMaterialTypes,\n  BeadTypes,\n  NAME_SEPARATOR,\n  ObjectTypes,\n} from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport { defaulBeadColor } from \"../components/colors\";\nimport * as THREE from \"three\";\n\nexport enum BeadChildSuffix {\n  MAIN = \"MAIN\",\n  ANY = \"beadChildOf\",\n  SELECTION = \"SELECTION\",\n  SELECTION_CHILD = \"SELECTION_CHILD\",\n}\n\nexport const getThreeNameFromBeadId = (\n  id: string,\n  childSuffix: BeadChildSuffix = BeadChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.Bead}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getBeadIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.Bead) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromBead = (\n  bead: Bead,\n  childSuffix?: BeadChildSuffix\n) => {\n  return merge({}, bead, {\n    name: getThreeNameFromBeadId(bead.id, childSuffix),\n  });\n};\n\n// let index = 0;\n// const names = \"ABCDEFGHIJKLMNOPRSTQWYZ\";\n\nexport const buildBead = (props: DeepPartial<Bead>): Bead => {\n  // if (props.id === undefined && names[index] !== undefined) {\n  //   props.id = names[index];\n  //   index = index + 1;\n  // }\n  const defaults: Bead = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    type: BeadTypes.MODEL_TOHO_ROUND,\n    material: BeadMaterialTypes.Mat,\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n    lineRotate: 0,\n    color: defaulBeadColor,\n    height: 10,\n    width: 10,\n    depth: 10,\n    keepAspectRatio: false,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.Bead,\n    // [immerable]: true,\n    groupId: undefined,\n    regionId: undefined,\n  };\n\n  return merge(defaults, props);\n};\n","import { debounce } from \"lodash\";\nimport { AppData } from \"./AppData\";\nimport { buildBead } from \"./editorObjects/Bead\";\nimport { AppObject, Bead, BeadTypes } from \"./editorObjects/Editor\";\n\nlet apiHost: string;\nlet headers: { [key: string]: any } = {\n  \"Content-Type\": \"application/json\",\n};\n\nexport const setApiFromAppData = (data: AppData) => {\n  apiHost = data.apiHost;\n  headers[\"Authorization\"] = \"Bearer \" + data.token;\n};\n\nconst handleError = (err: any, reject: any) => {\n  console.error(\"request error\", err);\n  reject(\"err\");\n};\n\nexport const prepareBoardsList = (): Promise<{\n  boards: {\n    uuid: string;\n    name: string;\n  }[];\n}> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/list\", {\n      method: \"GET\",\n      headers,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        resolve({\n          boards: response.boards,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nexport const fetchBoard = (\n  id: string\n): Promise<{ board: { uuid: string; name: string }; objects: AppObject[] }> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/one/\" + id, {\n      method: \"GET\",\n      headers,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        // console.log(\"co tam jest??\", response.objects);\n        resolve({\n          board: response.board,\n          objects: Object.keys(response.objects).map(\n            (key) => response.objects[key]\n          ),\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nexport interface BeadResponse {\n  display_name: string;\n  bead_product_uuid: string;\n  data: {\n    id: string;\n    internal_id: string;\n    bead_producer: {\n      uuid: string;\n      internal_id: string;\n      name: string;\n    };\n    bead_material: {\n      uuid: string;\n      internal_id: string;\n      display_name: string;\n    };\n    bead_geometry: {\n      uuid: string;\n      internal_id: string;\n      width: string;\n      height: string;\n      depth: string;\n      whole: string;\n      file_name: string;\n    };\n    bead_color: {\n      uuid: string;\n      internal_id: string;\n      display_name: string;\n      hex: string;\n    };\n    bead_color_category: {\n      uuid: string;\n      internal_id: string;\n      display_name: string;\n      hex: string;\n    };\n  };\n}\n\nexport const fetchBeadProducts = (\n  q?: string,\n  producer?: string,\n  color?: string\n): Promise<{\n  response: { bead: Bead; item: BeadResponse }[];\n}> => {\n  return new Promise((resolve, reject) => {\n    const queryString = new URLSearchParams();\n    if (q !== undefined && q.length > 0) {\n      queryString.append(\"q\", q);\n    }\n    if (producer !== undefined && producer.length > 0) {\n      queryString.append(\"producer\", producer);\n    }\n    if (color !== undefined && color.length > 0) {\n      queryString.append(\"color_category\", color);\n    }\n    return fetch(apiHost + \"api/bead_products/list?\" + queryString.toString(), {\n      method: \"GET\",\n      headers,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        let result: { bead: Bead; item: BeadResponse }[] = [];\n        if (\n          response &&\n          response.bead_products &&\n          response.bead_products.length > 0\n        ) {\n          result = (response?.bead_products as BeadResponse[]).map((item) => {\n            let type: BeadTypes | undefined = undefined;\n            if (\n              item &&\n              item.data &&\n              item.data.bead_geometry &&\n              item.data.bead_geometry.file_name\n            ) {\n              if (\n                item.data.bead_geometry.file_name === \"model_toho_round.obj\"\n              ) {\n                type = BeadTypes.MODEL_TOHO_ROUND;\n              }\n              if (item.data.bead_geometry.file_name === \"model_cylinder.obj\") {\n                type = BeadTypes.MODEL_CYLINDER;\n              }\n              if (\n                item.data.bead_geometry.file_name === \"model_fire_polish.obj\"\n              ) {\n                type = BeadTypes.MODEL_FIRE_POLISH;\n              }\n            }\n            const { height, width, depth } = item.data.bead_geometry;\n            const getNum = (value) => {\n              if (value === undefined || value === null || value === \"\") {\n                return 1;\n              }\n              return value.includes(\",\")\n                ? Number(value.replaceAll(\",\", \".\"))\n                : Number(value);\n            };\n            return {\n              bead: buildBead({\n                id: item.data.id,\n                color: item.data.bead_color.hex,\n                type,\n                height: getNum(height),\n                width: getNum(width),\n                depth: getNum(depth),\n              }),\n              item,\n            };\n          });\n        }\n        resolve({\n          response: result,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nexport const createBoard = (\n  name?: string\n): Promise<{ board: { uuid: string; name: string } }> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/create\", {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({ name: name ?? \"\" }),\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        resolve({\n          board: response.board,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\nexport const sendBoardBatchEvents = (\n  id: string,\n  body: string\n): Promise<{ status: boolean }> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/events/\" + id, {\n      method: \"POST\",\n      headers,\n      body,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        resolve({\n          status: response.statusCode,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nlet tempBoardId: string | undefined;\nlet sendingEnabled: boolean = false;\nlet sendingIntervalMs: number = 500;\nlet sendingInterval: any = undefined;\nlet lastSendTimestamp: any = new Date().getTime();\nlet toSendEventsQueue: SaveEvent[] = [];\n\nexport enum SaveEventType {\n  CREATE = \"CREATE\",\n  UPDATE = \"UPDATE\",\n  DELETE = \"DELETE\",\n}\nexport interface SaveEvent {\n  action: SaveEventType;\n  object: AppObject;\n  createdAt: string;\n}\n\nexport const notifyBackend = (events: SaveEvent[]) => {\n  if (sendingEnabled === true) {\n    if (events.length > 0) {\n      events.forEach((event) => {\n        toSendEventsQueue.push(event);\n      });\n      debouncedSend();\n    }\n  }\n};\nconst debouncedSend = debounce(\n  () => triggerSendBatchEvents(),\n  sendingIntervalMs,\n  { trailing: true }\n);\n\nexport const startBatchQueue = (id: string) => {\n  sendingEnabled = true;\n  tempBoardId = id;\n  lastSendTimestamp = new Date().getTime();\n  // sendingInterval = setInterval(debouncedSend, 250);\n};\n\nconst triggerSendBatchEvents = () => {\n  const now = new Date().getTime();\n  console.log(\n    \"triggerSendBatchEvents: diff: \",\n    now - lastSendTimestamp,\n    toSendEventsQueue.length > 0\n  );\n  if (toSendEventsQueue.length > 0 && tempBoardId !== undefined) {\n    const body = JSON.stringify({ changes: toSendEventsQueue });\n    toSendEventsQueue = [];\n    sendBoardBatchEvents(tempBoardId, body);\n  }\n  lastSendTimestamp = now;\n};\n\nexport const stopBatchQueue = (id: string) => {\n  sendingEnabled = false;\n  if (tempBoardId !== undefined) {\n    tempBoardId = undefined;\n  }\n  if (sendingInterval !== undefined) {\n    clearInterval(sendingInterval);\n  }\n  if (toSendEventsQueue.length > 0) {\n    toSendEventsQueue = [];\n  }\n};","export const uiButton = \"#aeaeae\"\nexport const defaulBeadColor = \"#4fc3f7\";","import { ObjectTypes } from \"../../editorObjects/Editor\";\n\nexport enum ActionsTypes {\n  EditBeadProduct = \"EditBeadProduct\",\n  EditBeadType = \"EditBeadType\",\n  EditBeadMaterial = \"EditBeadMaterial\",\n  EditBeadColor = \"EditBeadColor\",\n\n  EditRegionShape = \"EditRegionShape\",\n  EditRegionGridType = \"EditRegionGridType\",\n  EditRegionGridSettings = \"EditRegionGridSettings\",\n\n  EditPosition = \"EditPosition\",\n  EditRotate = \"EditRotate\",\n  EditWidthHeight = \"EditWidthHeight\",\n  EditWidthHeightDepth = \"EditWidthHeightDepth\",\n\n  Alignment = \"Alignment\",\n  Lock = \"Lock\",\n  Unlock = \"Unlock\",\n  Group = \"Group\",\n  Ungroup = \"Ungroup\",\n\n  More = \"More\",\n}\n\nexport enum ActionsGroupTypes {\n  EditBeadsProperies = \"EditBeadsProperies\",\n  EditRegionProperies = \"EditRegionProperies\",\n  Transform = \"Transform\",\n  LockOrUnlock = \"LockOrUnlock\",\n  GroupOrUngroup = \"GroupOrUngroup\",\n  More = \"More\",\n}\n\nexport const MapActionObjectType: { [key: string]: ActionsTypes[] } = {\n  [ObjectTypes.Bead]: [\n    ActionsTypes.EditBeadProduct,\n    ActionsTypes.EditBeadType,\n    ActionsTypes.EditBeadMaterial,\n    ActionsTypes.EditBeadColor,\n    ActionsTypes.Alignment,\n    ActionsTypes.EditWidthHeightDepth,\n    ActionsTypes.EditPosition,\n    ActionsTypes.EditRotate,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n  [ObjectTypes.Region]: [\n    ActionsTypes.EditRegionShape,\n    ActionsTypes.EditRegionGridType,\n    ActionsTypes.EditRegionGridSettings,\n    ActionsTypes.EditWidthHeight,\n    ActionsTypes.EditPosition,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n  [ObjectTypes.Group]: [\n    ActionsTypes.EditPosition,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n  [ObjectTypes.PreviewProject3D]: [\n    ActionsTypes.EditPosition,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n};\n\nexport interface IActions {\n  [key: string]: {\n    name: ActionsTypes;\n    sortOrder: number;\n    groupId: ActionsGroupTypes;\n    groupSortOrder: number;\n  };\n}\n\nexport const Actions: IActions = {\n  [ActionsTypes.EditBeadProduct]: {\n    name: ActionsTypes.EditBeadProduct,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditBeadType]: {\n    name: ActionsTypes.EditBeadType,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditBeadMaterial]: {\n    name: ActionsTypes.EditBeadMaterial,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditBeadColor]: {\n    name: ActionsTypes.EditBeadColor,\n    sortOrder: 40,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditRegionShape]: {\n    name: ActionsTypes.EditRegionShape,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.EditRegionProperies,\n    groupSortOrder: 40,\n  },\n  [ActionsTypes.EditRegionGridType]: {\n    name: ActionsTypes.EditRegionGridType,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.EditRegionProperies,\n    groupSortOrder: 40,\n  },\n  [ActionsTypes.EditRegionGridSettings]: {\n    name: ActionsTypes.EditRegionGridSettings,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.EditRegionProperies,\n    groupSortOrder: 40,\n  },\n  [ActionsTypes.EditPosition]: {\n    name: ActionsTypes.EditPosition,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.EditRotate]: {\n    name: ActionsTypes.EditRotate,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.EditWidthHeight]: {\n    name: ActionsTypes.EditWidthHeight,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.EditWidthHeightDepth]: {\n    name: ActionsTypes.EditWidthHeightDepth,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.Alignment]: {\n    name: ActionsTypes.Alignment,\n    sortOrder: 50,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.Lock]: {\n    name: ActionsTypes.Lock,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.LockOrUnlock,\n    groupSortOrder: 90,\n  },\n  [ActionsTypes.Unlock]: {\n    name: ActionsTypes.Unlock,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.LockOrUnlock,\n    groupSortOrder: 90,\n  },\n  [ActionsTypes.Group]: {\n    name: ActionsTypes.Group,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.GroupOrUngroup,\n    groupSortOrder: 80,\n  },\n  [ActionsTypes.Ungroup]: {\n    name: ActionsTypes.Ungroup,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.GroupOrUngroup,\n    groupSortOrder: 80,\n  },\n  [ActionsTypes.More]: {\n    name: ActionsTypes.More,\n    sortOrder: 1,\n    groupId: ActionsGroupTypes.More,\n    groupSortOrder: 100,\n  },\n};\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { createBoard, prepareBoardsList } from \"./ApiService\";\nimport { AppData } from \"./AppData\";\n\nexport const PageBoards: React.FC<{\n  data: AppData;\n}> = (props) => {\n  const [t] = useTranslation([\"boards\"]);\n  let history = useHistory();\n  const [state, setBoards] = React.useState<{\n    boards: { uuid: string; name: string }[];\n  }>({ boards: [] });\n\n  const onClickCreate = () => {\n    createBoard().then((response) => {\n      history.push(`/board/${response.board.uuid}`);\n    });\n  };\n\n  React.useEffect(() => {\n    if (props.data.save_events === true) {\n      prepareBoardsList().then((response) => {\n        setBoards({\n          boards: response.boards,\n        });\n      });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <PageStyles>\n      <div>\n        <h2>{t(\"boards:title\")}</h2>\n        <button onClick={onClickCreate} className={\"btn-primary\"}>\n          {t(\"boards:links.create_board\")}\n        </button>\n\n        <table>\n          <thead>\n            <tr>\n              <th>{t(\"boards:table.column_name\")}</th>\n              <th>{t(\"boards:table.column_actions\")}</th>\n            </tr>\n          </thead>\n\n          <tbody>\n            <tr>\n              <td>{t(\"boards:links.demo_board_name\")}</td>\n              <td>\n                <Link to=\"/board/demo\" data-test=\"demoboard\">\n                  {t(\"boards:links.demo_board\")}\n                </Link>\n              </td>\n            </tr>\n\n            {state.boards.map((board) => {\n              return (\n                <tr key={board.uuid}>\n                  <td>{board.name}</td>\n                  <td>\n                    <Link to={`/board/${board.uuid}`}>\n                      {t(\"boards:links.edit_board\")}\n                    </Link>\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n\n        <Link className={\"btn-light\"} to=\"/\">\n          {t(\"boards:links.back_to_home\")}\n        </Link>\n      </div>\n    </PageStyles>\n  );\n};\n\nconst PageStyles = styled.div`\n  padding: 1em;\n  table {\n    width: 100%;\n    max-width: 100%;\n    margin-bottom: 1rem;\n    background-color: transparent;\n  }\n  table td,\n  table th {\n    padding: 0.75rem;\n    vertical-align: top;\n    border-top: 1px solid #dee2e6;\n  }\n  table th {\n    color: #000;\n    background-color: #e9ecef;\n    border-color: #e9ecef;\n    vertical-align: bottom;\n    border-bottom: 2px solid #dee2e6;\n  }\n  table tbody tr:hover td {\n    color: #495057;\n    background-color: #e9ecef;\n    border-color: #dee2e6;\n  }\n  .btn-primary {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #fff;\n    background-color: #007bff;\n    border-color: #007bff;\n    margin-bottom: 10px;\n  }\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #f8f9fa;\n    margin-bottom: 10px;\n  }\n  h2 {\n    margin-bottom: 0.5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n`;\n","import { AppObject, Bead, Group } from \"../editorObjects/Editor\";\nimport { StoreUiSettings } from \"./store\";\n\n// PAMIETAJ o tym aby dodac rownie \"event do history w AppHistory.ts\nexport enum AppEventType {\n  AddObjects = \"AddObjects\",\n  DuplicateObjects = \"DuplicateObjects\",\n  RemoveObjects = \"RemoveObjects\",\n  ChangeSelectObjects = \"ChangeSelectObjects\",\n  ChangeObjectsProperty = \"ChangeObjectsProperty\",\n  ChangeObjectsAlignment = \"ChangeObjectsAlignment\",\n  ClipboardCut = \"ClipboardCut\",\n  ClipboardCopy = \"ClipboardCopy\",\n  ClipboardPaste = \"ClipboardPaste\",\n  AddMultipleBeads = \"AddMultipleBeads\",\n  ChangeUiSettings = \"ChangeUiSettings\",\n  ChangeUiSettingsZoom = \"ChangeUiSettingsZoom\",\n  ChangeUiSettingsSidebar = \"ChangeUiSettingsSidebar\",\n  GroupObjects = \"GroupObjects\",\n  UngroupObjects = \"UngroupObjects\",\n}\n\nexport type AddMultipleBeads = {\n  name: AppEventType.AddMultipleBeads;\n  payload: { rows: number; columns: number; figure: \"rectangle\" };\n};\n\nexport type ClipboardCut = {\n  name: AppEventType.ClipboardCut;\n  payload: {};\n};\n\nexport type ClipboardCopy = {\n  name: AppEventType.ClipboardCopy;\n  payload: {};\n};\n\nexport type ClipboardPaste = {\n  name: AppEventType.ClipboardPaste;\n  payload: {\n    objects: AppObject[];\n  };\n};\n\nexport enum SnapToLineType {\n  X_MIN = \"X_MIN\",\n  X_MAX = \"X_MAX\",\n  X_MIDDLE = \"X_MIDDLE\",\n  Y_MIN = \"Y_MIN\",\n  Y_MAX = \"Y_MAX\",\n  Y_MIDDLE = \"Y_MIDDLE\",\n}\n\nexport type ChangeSelectedObjectsAlignment = {\n  name: AppEventType.ChangeObjectsAlignment;\n  payload: {\n    selectedIds: string[];\n    snapType: SnapToLineType;\n  };\n};\n\nexport type ChangeUiSettings = {\n  name: AppEventType.ChangeUiSettings;\n  payload: { uiSettings: Partial<StoreUiSettings> };\n};\n\nexport type ChangeUiSettingsSidebar = {\n  name: AppEventType.ChangeUiSettingsSidebar;\n  payload: {\n    panel: \"objects\" | \"history\" | \"comments\";\n    open: boolean;\n    toggle?: boolean;\n  };\n};\n\nexport type ChangeUiSettingsZoom = {\n  name: AppEventType.ChangeUiSettingsZoom;\n  payload: {\n    zoomType: \"zoomByScroll\" | \"zoomInScreenCenter\" | \"zoomOutScreenCenter\";\n    useAnimation: boolean;\n    clientX?: number;\n    clientY?: number;\n    scrollDelta?: number;\n  };\n};\n\nexport type AddObjects = {\n  name: AppEventType.AddObjects;\n  payload: { objects: Partial<AppObject>[] };\n};\n\nexport type GroupObjects = {\n  name: AppEventType.GroupObjects;\n  payload: {\n    objects: Pick<AppObject, \"id\">[];\n    removed?: Pick<Group, \"id\" | \"childrenIds\">[];\n    added?: Pick<Group, \"id\" | \"childrenIds\">;\n  };\n};\n\nexport type UngroupObjects = {\n  name: AppEventType.UngroupObjects;\n  payload: {\n    objects: Pick<AppObject, \"id\">[];\n    removed?: Pick<Group, \"id\" | \"childrenIds\">[];\n  };\n};\n\nexport type DuplicateObjects = {\n  name: AppEventType.DuplicateObjects;\n  payload: { objects: Partial<AppObject>[] };\n};\n\nexport type RemoveObjects = {\n  name: AppEventType.RemoveObjects;\n  payload: { ids: string[] };\n};\n\nexport type ChangeSelectObject = {\n  id: string;\n  isSelected: boolean;\n};\nexport type ChangeSelectObjects = {\n  name: AppEventType.ChangeSelectObjects;\n  payload: { change: ChangeSelectObject[] };\n};\n\nexport type MappedTypeWithNewProperties<T> = {\n  [Properties in keyof T]: T[Properties];\n};\n\nexport type AppObjectKeys = MappedTypeWithNewProperties<Partial<AppObject>>;\nexport type ChangeObject = {\n  id: string;\n  properties: AppObjectKeys;\n  relatedChanges?: ChangeObject[];\n  shouldBeCreated?: Bead[];\n  shouldBeDeleted?: Bead[];\n};\nexport type ChangeObjectsProperty = {\n  name: AppEventType.ChangeObjectsProperty;\n  payload: {\n    changes: ChangeObject[];\n  };\n};\n\nexport type AppEvents =\n  | AddObjects\n  | RemoveObjects\n  | ChangeSelectObjects\n  | ChangeObjectsProperty\n  | ClipboardCut\n  | ClipboardCopy\n  | ClipboardPaste\n  | AddMultipleBeads\n  | ChangeUiSettings\n  | ChangeUiSettingsZoom\n  | ChangeUiSettingsSidebar\n  | ChangeSelectedObjectsAlignment\n  | DuplicateObjects\n  | GroupObjects\n  | UngroupObjects;\n","// @TODO: wybrac logger dla frontend\nlet enabled = true;\nexport const logger = {\n  log: (...arg) => {\n    if (enabled) {\n      console.log(...arg);\n    }\n  },\n  error: (...arg) => {\n    if (enabled) {\n      console.error(...arg);\n    }\n  },\n  warn: (...arg) => {\n    if (enabled) {\n      console.warn(...arg);\n    }\n  },\n  trace: (...arg) => {\n    if (enabled) {\n      console.log(...arg);\n    }\n  },\n  disableAll: () => {\n    enabled = false;\n  },\n  enableAll: () => {\n    enabled = true;\n  },\n};\n","import { cloneDeep } from \"lodash\";\nimport * as THREE from \"three\";\nimport {\n  AppObject,\n  EditorGridType,\n  EditorMode,\n  ThreeGridHelperConfig,\n  ThreeLightConfig,\n} from \"../editorObjects/Editor\";\nimport { logger } from \"../logger\";\n\nexport interface StoreUiSettings {\n  zoomScale: number;\n  mode: EditorMode;\n  lights: ThreeLightConfig[];\n  grid: ThreeGridHelperConfig;\n  selectedTopBarPosition: THREE.Vector3 | undefined;\n  modalSearchProducts: {\n    isOpen: boolean;\n    successAction: \"updateBeadType\" | undefined;\n    advBlockVisible: boolean;\n    q: string;\n    producer: string;\n    color: string;\n    cachedResponse: any[];\n    scrollPosition: number;\n  };\n  leftSidebar: {\n    isOpen: boolean;\n    panel: \"comments\" | undefined;\n  };\n  rightSidebar: {\n    isOpen: boolean;\n    panel: \"history\" | \"objects\" | undefined;\n  };\n  blockThreejs: {\n    loading: boolean;\n    error: string | undefined;\n  };\n}\nexport interface SimpleHistoryEvent {\n  name: string;\n  isActive: boolean;\n  createdAt: string;\n}\nexport interface StoreHistory {\n  events: SimpleHistoryEvent[];\n  canRedo: boolean;\n  canUndo: boolean;\n}\n\nexport interface StoreBoard {\n  uuid: string;\n  isFavourite: boolean;\n  canToggleToFavourite: boolean;\n  canEdit: boolean;\n  canExportAsImage: boolean;\n  name: string;\n  editModalVisible: boolean;\n}\nexport interface Store {\n  objects: { [s: string]: AppObject };\n  selectedIds: string[];\n  ui: StoreUiSettings;\n  history: StoreHistory;\n  board: StoreBoard;\n}\n\nlet store: Store;\n\nexport const defaultStore: Store = {\n  objects: {},\n  selectedIds: [],\n  history: {\n    canRedo: false,\n    canUndo: false,\n    events: [],\n  },\n  board: {\n    uuid: \"\",\n    name: \"\",\n    canEdit: true,\n    canToggleToFavourite: true,\n    isFavourite: false,\n    canExportAsImage: true,\n    editModalVisible: false,\n  },\n  ui: {\n    modalSearchProducts: {\n      isOpen: false,\n      successAction: undefined,\n      advBlockVisible: false,\n      color: \"\",\n      producer: \"\",\n      q: \"\",\n      cachedResponse: [],\n      scrollPosition: 0\n    },\n    leftSidebar: {\n      isOpen: false,\n      panel: undefined,\n    },\n    rightSidebar: {\n      isOpen: false,\n      panel: undefined,\n    },\n    zoomScale: 1,\n    mode: EditorMode.SelectOrMove,\n    lights: [\n      {\n        id: THREE.MathUtils.generateUUID(),\n        type: \"THREE.DirectionalLight\",\n        name: \"main_light_1\",\n        color: \"#FFF\",\n        intensity: 0.8,\n        position: {\n          x: 0,\n          y: 0,\n          z: 10,\n        },\n      },\n      {\n        id: THREE.MathUtils.generateUUID(),\n        type: \"THREE.DirectionalLight\",\n        name: \"main_light_2\",\n        color: \"#FFF\",\n        intensity: 0.4,\n        position: {\n          x: 0,\n          y: 0,\n          z: 10,\n        },\n      },\n    ],\n    grid: {\n      id: THREE.MathUtils.generateUUID(),\n      type: EditorGridType.Hex,\n      hexSize: 30,\n      snapEnabled: true,\n      isVisible: true,\n      width: 30,\n      height: 30,\n    },\n    selectedTopBarPosition: undefined,\n    blockThreejs: {\n      loading: true,\n      error: undefined,\n    },\n  },\n};\n\nexport const emptyStore: Store = {\n  objects: {},\n  selectedIds: [],\n  history: {\n    canRedo: false,\n    canUndo: false,\n    events: [],\n  },\n  board: {\n    canEdit: false,\n    canToggleToFavourite: false,\n    uuid: \"\",\n    isFavourite: false,\n    name: \"...\",\n    canExportAsImage: true,\n    editModalVisible: false,\n  },\n  ui: cloneDeep(defaultStore.ui),\n};\n\nexport const initStore = () => {\n  store = cloneDeep(defaultStore);\n};\n\nexport const getStore = () => {\n  return store;\n};\n\nexport const setStore = (newStore: Store) => {\n  logger.log(\"APPSTORE: setStore\", newStore, newStore.selectedIds);\n  store = newStore;\n};\n\nlet refreshThreejs: boolean = true;\nlet refreshReact: boolean = true;\n\nexport const shouldRefreshThree = () => {\n  return refreshThreejs;\n};\n\nexport const shouldRefreshReact = () => {\n  return refreshReact;\n};\n\nexport const setRefreshStates = (\n  _refreshThreejs: boolean = true,\n  _refreshReact: boolean = true\n) => {\n  refreshThreejs = _refreshThreejs;\n  refreshReact = _refreshReact;\n};\n","import { Group, NAME_SEPARATOR, ObjectTypes } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum GroupChildSuffix {\n  MAIN = \"MAIN\",\n  BG = \"bg\",\n  ANY = \"GroupChildOf\",\n}\n\nexport const getThreeNameFromGroupId = (\n  id: string,\n  childSuffix: GroupChildSuffix = GroupChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.Group}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getGroupIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.Group) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromGroup = (\n  group: Group,\n  childSuffix?: GroupChildSuffix\n) => {\n  return merge({}, group, {\n    name: getThreeNameFromGroupId(group.id, childSuffix),\n  });\n};\n\nexport const buildGroup = (props: DeepPartial<Group>): Group => {\n  const defaults: Group = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    rotateX: 90,\n    rotateY: 0,\n    rotateZ: 0,\n    height: 10,\n    width: 10,\n    depth: 10,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.Group,\n    childrenIds: [],\n  };\n\n  return merge(defaults, props);\n};\n","import { NAME_SEPARATOR, ObjectTypes, PreviewProject3D } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum PreviewProject3DChildSuffix {\n  MAIN = \"MAIN\",\n  BG = \"BG\",\n  ANY = \"PreviewProject3DChildOf\",\n}\n\nexport const getThreeNameFromPreviewProject3DId = (\n  id: string,\n  childSuffix: PreviewProject3DChildSuffix = PreviewProject3DChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.PreviewProject3D}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getPreviewProject3DIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.PreviewProject3D) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromPreviewProject3D = (\n  obj: PreviewProject3D,\n  childSuffix?: PreviewProject3DChildSuffix\n) => {\n  return merge({}, obj, {\n    name: getThreeNameFromPreviewProject3DId(obj.id, childSuffix),\n  });\n};\n\nexport const buildPreviewProject3D = (\n  props: DeepPartial<PreviewProject3D>\n): PreviewProject3D => {\n  const defaults: PreviewProject3D = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    rotateX: 90,\n    rotateY: 0,\n    rotateZ: 0,\n    height: 10,\n    width: 10,\n    depth: 10,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.PreviewProject3D,\n    color: \"red\",\n  };\n\n  return merge(defaults, props);\n};\n","import {\n  NAME_SEPARATOR,\n  ObjectTypes,\n  Region,\n  RegionGridType,\n  RegionShape,\n} from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum RegionChildSuffix {\n  MAIN = \"main\",\n  BG = \"bg\",\n  GRID_CELLS = \"GRID_CELLS\",\n  GRID_CELL = \"gridCell\",\n  CONTENT = \"content\",\n}\n\nexport const getThreeNameFromRegionId = (\n  id: string,\n  childSuffix: RegionChildSuffix = RegionChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.Region}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getRegionIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.Region) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromRegion = (\n  region: Region,\n  childSuffix?: RegionChildSuffix\n) => {\n  return merge({}, region, {\n    name: getThreeNameFromRegionId(region.id, childSuffix),\n  });\n};\n\nexport const getBricksColumnsAndRowsCount = (currentColumns: number) => {\n  return {\n    columns: currentColumns,\n    rows: currentColumns,\n  };\n};\n\nexport const insideRegionTriange = (\n  region: Region,\n  _row: number,\n  column: number\n): {\n  isInside: boolean;\n  lastColumnIndex: number;\n} => {\n  const row = region.rows - _row - 1;\n  if (row >= region.rows || column < 0 || column >= region.columns) {\n    return { isInside: false, lastColumnIndex: 0 };\n  }\n  const min = region.columns % 2 === 0 ? 2 : 1;\n  const ratio = Math.max(0, row) / (region.rows - 1);\n  let beadsCountInRow =\n    min +\n    Math.min(Math.floor((region.columns - min) * ratio), region.columns - min);\n  if (region.columns % 2 !== beadsCountInRow % 2) {\n    beadsCountInRow++;\n  }\n  const emptyCells = region.columns - beadsCountInRow;\n  const offsetFromStart = Math.floor(emptyCells / 2);\n  const offsetFromEnd = beadsCountInRow + offsetFromStart;\n  const lastColumnIndex = offsetFromEnd;\n\n  let isInside: boolean = true;\n  if (column < offsetFromStart) {\n    isInside = false;\n  } else if (column >= offsetFromEnd) {\n    isInside = false;\n  }\n  return { isInside, lastColumnIndex };\n};\n\nexport const isActiveRegionCell = (region: Region, index: number) => {\n  if (region.shape === RegionShape.Rectangle) {\n    const newSize = region.rows * region.columns;\n    if (index >= 0 && index < newSize) {\n      const offsetEnabled = region.gridType === RegionGridType.Bricks;\n      if (offsetEnabled) {\n        const row = Math.floor(index / region.columns);\n        const column = Math.floor(index % region.columns);\n        const rowOdd = row % 2 !== 0;\n        const isNotLastColumn = column !== region.columns - 1;\n        if ((rowOdd === true && isNotLastColumn) || rowOdd === false) {\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        return true;\n      }\n    } else {\n      return false;\n    }\n  } else if (region.shape === RegionShape.Triangle) {\n    const row = Math.floor(index / region.columns);\n    const column = Math.floor(index % region.columns);\n    const { isInside, lastColumnIndex } = insideRegionTriange(\n      region,\n      row,\n      column\n    );\n    if (isInside === true) {\n      const offsetEnabled = region.gridType === RegionGridType.Bricks;\n      if (offsetEnabled) {\n        const row = Math.floor(index / region.columns);\n        const column = Math.floor(index % region.columns);\n        const rowOdd = row % 2 !== 0;\n        const isNotLastColumn = column !== lastColumnIndex - 1;\n        if ((rowOdd === true && isNotLastColumn) || rowOdd === false) {\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        return true;\n      }\n    } else {\n      return false;\n    }\n  } else {\n    console.error(\"region shape not handled\", region.shape);\n    return false;\n  }\n};\n\nexport const buildRegion = (props: DeepPartial<Region>): Region => {\n  const defaults: Region = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    gridType: RegionGridType.Rectangles,\n    shape: RegionShape.Rectangle,\n    height: 10,\n    width: 10,\n    beadIds: [],\n    opacity: 0.5,\n    columns: 3,\n    rows: 3,\n    autoFillBeads: false,\n    snapBeadsToCell: true,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.Region,\n    childrenGridIds: [],\n    depth: 1,\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n  };\n  const newRegion = merge(defaults, props);\n  const size = newRegion.rows * newRegion.columns;\n  const newChildrenGridIds = Array(size).fill(undefined);\n  newRegion.childrenGridIds = merge(newChildrenGridIds, props.childrenGridIds);\n\n  return newRegion;\n};\n","/* eslint-disable */\n// @TODO: zamieni to, gdy bedzie mozna normalnie importowac threejs\n// import {\n// \tBufferGeometry,\n// \tFileLoader,\n// \tFloat32BufferAttribute,\n// \tGroup,\n// \tLineBasicMaterial,\n// \tLineSegments,\n// \tLoader,\n// \tMaterial,\n// \tMesh,\n// \tMeshPhongMaterial,\n// \tPoints,\n// \tPointsMaterial,\n// \tVector3\n// } from '../../../build/three.module.js';\nimport * as THREE from \"three\";\nconst {\n  BufferGeometry,\n  FileLoader,\n  Float32BufferAttribute,\n  Group,\n  LineBasicMaterial,\n  LineSegments,\n  Loader,\n  Material,\n  Mesh,\n  MeshPhongMaterial,\n  Points,\n  PointsMaterial,\n  Vector3,\n} = THREE;\n\nvar OBJLoader = (function () {\n  // o object_name | g group_name\n  var object_pattern = /^[og]\\s*(.+)?/;\n  // mtllib file_reference\n  var material_library_pattern = /^mtllib /;\n  // usemtl material_name\n  var material_use_pattern = /^usemtl /;\n  // usemap map_name\n  var map_use_pattern = /^usemap /;\n\n  var vA = new Vector3();\n  var vB = new Vector3();\n  var vC = new Vector3();\n\n  var ab = new Vector3();\n  var cb = new Vector3();\n\n  function ParserState() {\n    var state = {\n      objects: [],\n      object: {},\n\n      vertices: [],\n      normals: [],\n      colors: [],\n      uvs: [],\n\n      materials: {},\n      materialLibraries: [],\n\n      startObject: function (name, fromDeclaration) {\n        // If the current object (initial from reset) is not from a g/o declaration in the parsed\n        // file. We need to use it for the first parsed g/o to keep things in sync.\n        if (this.object && this.object.fromDeclaration === false) {\n          this.object.name = name;\n          this.object.fromDeclaration = fromDeclaration !== false;\n          return;\n        }\n\n        var previousMaterial =\n          this.object && typeof this.object.currentMaterial === \"function\"\n            ? this.object.currentMaterial()\n            : undefined;\n\n        if (this.object && typeof this.object._finalize === \"function\") {\n          this.object._finalize(true);\n        }\n\n        this.object = {\n          name: name || \"\",\n          fromDeclaration: fromDeclaration !== false,\n\n          geometry: {\n            vertices: [],\n            normals: [],\n            colors: [],\n            uvs: [],\n            hasUVIndices: false,\n          },\n          materials: [],\n          smooth: true,\n\n          startMaterial: function (name, libraries) {\n            var previous = this._finalize(false);\n\n            // New usemtl declaration overwrites an inherited material, except if faces were declared\n            // after the material, then it must be preserved for proper MultiMaterial continuation.\n            if (previous && (previous.inherited || previous.groupCount <= 0)) {\n              this.materials.splice(previous.index, 1);\n            }\n\n            var material = {\n              index: this.materials.length,\n              name: name || \"\",\n              mtllib:\n                Array.isArray(libraries) && libraries.length > 0\n                  ? libraries[libraries.length - 1]\n                  : \"\",\n              smooth: previous !== undefined ? previous.smooth : this.smooth,\n              groupStart: previous !== undefined ? previous.groupEnd : 0,\n              groupEnd: -1,\n              groupCount: -1,\n              inherited: false,\n\n              clone: function (index) {\n                var cloned = {\n                  index: typeof index === \"number\" ? index : this.index,\n                  name: this.name,\n                  mtllib: this.mtllib,\n                  smooth: this.smooth,\n                  groupStart: 0,\n                  groupEnd: -1,\n                  groupCount: -1,\n                  inherited: false,\n                };\n                cloned.clone = this.clone.bind(cloned);\n                return cloned;\n              },\n            };\n\n            this.materials.push(material);\n\n            return material;\n          },\n\n          currentMaterial: function () {\n            if (this.materials.length > 0) {\n              return this.materials[this.materials.length - 1];\n            }\n\n            return undefined;\n          },\n\n          _finalize: function (end) {\n            var lastMultiMaterial = this.currentMaterial();\n            if (lastMultiMaterial && lastMultiMaterial.groupEnd === -1) {\n              lastMultiMaterial.groupEnd = this.geometry.vertices.length / 3;\n              lastMultiMaterial.groupCount =\n                lastMultiMaterial.groupEnd - lastMultiMaterial.groupStart;\n              lastMultiMaterial.inherited = false;\n            }\n\n            // Ignore objects tail materials if no face declarations followed them before a new o/g started.\n            if (end && this.materials.length > 1) {\n              for (var mi = this.materials.length - 1; mi >= 0; mi--) {\n                if (this.materials[mi].groupCount <= 0) {\n                  this.materials.splice(mi, 1);\n                }\n              }\n            }\n\n            // Guarantee at least one empty material, this makes the creation later more straight forward.\n            if (end && this.materials.length === 0) {\n              this.materials.push({\n                name: \"\",\n                smooth: this.smooth,\n              });\n            }\n\n            return lastMultiMaterial;\n          },\n        };\n\n        // Inherit previous objects material.\n        // Spec tells us that a declared material must be set to all objects until a new material is declared.\n        // If a usemtl declaration is encountered while this new object is being parsed, it will\n        // overwrite the inherited material. Exception being that there was already face declarations\n        // to the inherited material, then it will be preserved for proper MultiMaterial continuation.\n\n        if (\n          previousMaterial &&\n          previousMaterial.name &&\n          typeof previousMaterial.clone === \"function\"\n        ) {\n          var declared = previousMaterial.clone(0);\n          declared.inherited = true;\n          this.object.materials.push(declared);\n        }\n\n        this.objects.push(this.object);\n      },\n\n      finalize: function () {\n        if (this.object && typeof this.object._finalize === \"function\") {\n          this.object._finalize(true);\n        }\n      },\n\n      parseVertexIndex: function (value, len) {\n        var index = parseInt(value, 10);\n        return (index >= 0 ? index - 1 : index + len / 3) * 3;\n      },\n\n      parseNormalIndex: function (value, len) {\n        var index = parseInt(value, 10);\n        return (index >= 0 ? index - 1 : index + len / 3) * 3;\n      },\n\n      parseUVIndex: function (value, len) {\n        var index = parseInt(value, 10);\n        return (index >= 0 ? index - 1 : index + len / 2) * 2;\n      },\n\n      addVertex: function (a, b, c) {\n        var src = this.vertices;\n        var dst = this.object.geometry.vertices;\n\n        dst.push(src[a + 0], src[a + 1], src[a + 2]);\n        dst.push(src[b + 0], src[b + 1], src[b + 2]);\n        dst.push(src[c + 0], src[c + 1], src[c + 2]);\n      },\n\n      addVertexPoint: function (a) {\n        var src = this.vertices;\n        var dst = this.object.geometry.vertices;\n\n        dst.push(src[a + 0], src[a + 1], src[a + 2]);\n      },\n\n      addVertexLine: function (a) {\n        var src = this.vertices;\n        var dst = this.object.geometry.vertices;\n\n        dst.push(src[a + 0], src[a + 1], src[a + 2]);\n      },\n\n      addNormal: function (a, b, c) {\n        var src = this.normals;\n        var dst = this.object.geometry.normals;\n\n        dst.push(src[a + 0], src[a + 1], src[a + 2]);\n        dst.push(src[b + 0], src[b + 1], src[b + 2]);\n        dst.push(src[c + 0], src[c + 1], src[c + 2]);\n      },\n\n      addFaceNormal: function (a, b, c) {\n        var src = this.vertices;\n        var dst = this.object.geometry.normals;\n\n        vA.fromArray(src, a);\n        vB.fromArray(src, b);\n        vC.fromArray(src, c);\n\n        cb.subVectors(vC, vB);\n        ab.subVectors(vA, vB);\n        cb.cross(ab);\n\n        cb.normalize();\n\n        dst.push(cb.x, cb.y, cb.z);\n        dst.push(cb.x, cb.y, cb.z);\n        dst.push(cb.x, cb.y, cb.z);\n      },\n\n      addColor: function (a, b, c) {\n        var src = this.colors;\n        var dst = this.object.geometry.colors;\n\n        if (src[a] !== undefined) dst.push(src[a + 0], src[a + 1], src[a + 2]);\n        if (src[b] !== undefined) dst.push(src[b + 0], src[b + 1], src[b + 2]);\n        if (src[c] !== undefined) dst.push(src[c + 0], src[c + 1], src[c + 2]);\n      },\n\n      addUV: function (a, b, c) {\n        var src = this.uvs;\n        var dst = this.object.geometry.uvs;\n\n        dst.push(src[a + 0], src[a + 1]);\n        dst.push(src[b + 0], src[b + 1]);\n        dst.push(src[c + 0], src[c + 1]);\n      },\n\n      addDefaultUV: function () {\n        var dst = this.object.geometry.uvs;\n\n        dst.push(0, 0);\n        dst.push(0, 0);\n        dst.push(0, 0);\n      },\n\n      addUVLine: function (a) {\n        var src = this.uvs;\n        var dst = this.object.geometry.uvs;\n\n        dst.push(src[a + 0], src[a + 1]);\n      },\n\n      addFace: function (a, b, c, ua, ub, uc, na, nb, nc) {\n        var vLen = this.vertices.length;\n\n        var ia = this.parseVertexIndex(a, vLen);\n        var ib = this.parseVertexIndex(b, vLen);\n        var ic = this.parseVertexIndex(c, vLen);\n\n        this.addVertex(ia, ib, ic);\n        this.addColor(ia, ib, ic);\n\n        // normals\n\n        if (na !== undefined && na !== \"\") {\n          var nLen = this.normals.length;\n\n          ia = this.parseNormalIndex(na, nLen);\n          ib = this.parseNormalIndex(nb, nLen);\n          ic = this.parseNormalIndex(nc, nLen);\n\n          this.addNormal(ia, ib, ic);\n        } else {\n          this.addFaceNormal(ia, ib, ic);\n        }\n\n        // uvs\n\n        if (ua !== undefined && ua !== \"\") {\n          var uvLen = this.uvs.length;\n\n          ia = this.parseUVIndex(ua, uvLen);\n          ib = this.parseUVIndex(ub, uvLen);\n          ic = this.parseUVIndex(uc, uvLen);\n\n          this.addUV(ia, ib, ic);\n\n          this.object.geometry.hasUVIndices = true;\n        } else {\n          // add placeholder values (for inconsistent face definitions)\n\n          this.addDefaultUV();\n        }\n      },\n\n      addPointGeometry: function (vertices) {\n        this.object.geometry.type = \"Points\";\n\n        var vLen = this.vertices.length;\n\n        for (var vi = 0, l = vertices.length; vi < l; vi++) {\n          var index = this.parseVertexIndex(vertices[vi], vLen);\n\n          this.addVertexPoint(index);\n          this.addColor(index);\n        }\n      },\n\n      addLineGeometry: function (vertices, uvs) {\n        this.object.geometry.type = \"Line\";\n\n        var vLen = this.vertices.length;\n        var uvLen = this.uvs.length;\n\n        for (var vi = 0, l = vertices.length; vi < l; vi++) {\n          this.addVertexLine(this.parseVertexIndex(vertices[vi], vLen));\n        }\n\n        for (var uvi = 0, l = uvs.length; uvi < l; uvi++) {\n          this.addUVLine(this.parseUVIndex(uvs[uvi], uvLen));\n        }\n      },\n    };\n\n    state.startObject(\"\", false);\n\n    return state;\n  }\n\n  //\n\n  function OBJLoader(manager) {\n    Loader.call(this, manager);\n\n    this.materials = null;\n  }\n\n  OBJLoader.prototype = Object.assign(Object.create(Loader.prototype), {\n    constructor: OBJLoader,\n\n    load: function (url, onLoad, onProgress, onError) {\n      var scope = this;\n\n      var loader = new FileLoader(this.manager);\n      loader.setPath(this.path);\n      loader.setRequestHeader(this.requestHeader);\n      loader.setWithCredentials(this.withCredentials);\n      loader.load(\n        url,\n        function (text) {\n          try {\n            onLoad(scope.parse(text));\n          } catch (e) {\n            if (onError) {\n              onError(e);\n            } else {\n              console.error(e);\n            }\n\n            scope.manager.itemError(url);\n          }\n        },\n        onProgress,\n        onError\n      );\n    },\n\n    setMaterials: function (materials) {\n      this.materials = materials;\n\n      return this;\n    },\n\n    parse: function (text) {\n      var state = new ParserState();\n\n      if (text.indexOf(\"\\r\\n\") !== -1) {\n        // This is faster than String.split with regex that splits on both\n        text = text.replace(/\\r\\n/g, \"\\n\");\n      }\n\n      if (text.indexOf(\"\\\\\\n\") !== -1) {\n        // join lines separated by a line continuation character (\\)\n        text = text.replace(/\\\\\\n/g, \"\");\n      }\n\n      var lines = text.split(\"\\n\");\n      var line = \"\",\n        lineFirstChar = \"\";\n      var lineLength = 0;\n      var result = [];\n\n      // Faster to just trim left side of the line. Use if available.\n      var trimLeft = typeof \"\".trimLeft === \"function\";\n\n      for (var i = 0, l = lines.length; i < l; i++) {\n        line = lines[i];\n\n        line = trimLeft ? line.trimLeft() : line.trim();\n\n        lineLength = line.length;\n\n        if (lineLength === 0) continue;\n\n        lineFirstChar = line.charAt(0);\n\n        // @todo invoke passed in handler if any\n        if (lineFirstChar === \"#\") continue;\n\n        if (lineFirstChar === \"v\") {\n          var data = line.split(/\\s+/);\n\n          switch (data[0]) {\n            case \"v\":\n              state.vertices.push(\n                parseFloat(data[1]),\n                parseFloat(data[2]),\n                parseFloat(data[3])\n              );\n              if (data.length >= 7) {\n                state.colors.push(\n                  parseFloat(data[4]),\n                  parseFloat(data[5]),\n                  parseFloat(data[6])\n                );\n              } else {\n                // if no colors are defined, add placeholders so color and vertex indices match\n\n                state.colors.push(undefined, undefined, undefined);\n              }\n\n              break;\n            case \"vn\":\n              state.normals.push(\n                parseFloat(data[1]),\n                parseFloat(data[2]),\n                parseFloat(data[3])\n              );\n              break;\n            case \"vt\":\n              state.uvs.push(parseFloat(data[1]), parseFloat(data[2]));\n              break;\n          }\n        } else if (lineFirstChar === \"f\") {\n          var lineData = line.substr(1).trim();\n          var vertexData = lineData.split(/\\s+/);\n          var faceVertices = [];\n\n          // Parse the face vertex data into an easy to work with format\n\n          for (var j = 0, jl = vertexData.length; j < jl; j++) {\n            var vertex = vertexData[j];\n\n            if (vertex.length > 0) {\n              var vertexParts = vertex.split(\"/\");\n              faceVertices.push(vertexParts);\n            }\n          }\n\n          // Draw an edge between the first vertex and all subsequent vertices to form an n-gon\n\n          var v1 = faceVertices[0];\n\n          for (var j = 1, jl = faceVertices.length - 1; j < jl; j++) {\n            var v2 = faceVertices[j];\n            var v3 = faceVertices[j + 1];\n\n            state.addFace(\n              v1[0],\n              v2[0],\n              v3[0],\n              v1[1],\n              v2[1],\n              v3[1],\n              v1[2],\n              v2[2],\n              v3[2]\n            );\n          }\n        } else if (lineFirstChar === \"l\") {\n          var lineParts = line.substring(1).trim().split(\" \");\n          var lineVertices = [],\n            lineUVs = [];\n\n          if (line.indexOf(\"/\") === -1) {\n            lineVertices = lineParts;\n          } else {\n            for (var li = 0, llen = lineParts.length; li < llen; li++) {\n              var parts = lineParts[li].split(\"/\");\n\n              if (parts[0] !== \"\") lineVertices.push(parts[0]);\n              if (parts[1] !== \"\") lineUVs.push(parts[1]);\n            }\n          }\n\n          state.addLineGeometry(lineVertices, lineUVs);\n        } else if (lineFirstChar === \"p\") {\n          var lineData = line.substr(1).trim();\n          var pointData = lineData.split(\" \");\n\n          state.addPointGeometry(pointData);\n        } else if ((result = object_pattern.exec(line)) !== null) {\n          // o object_name\n          // or\n          // g group_name\n\n          // WORKAROUND: https://bugs.chromium.org/p/v8/issues/detail?id=2869\n          // var name = result[ 0 ].substr( 1 ).trim();\n          var name = (\" \" + result[0].substr(1).trim()).substr(1);\n\n          state.startObject(name);\n        } else if (material_use_pattern.test(line)) {\n          // material\n\n          state.object.startMaterial(\n            line.substring(7).trim(),\n            state.materialLibraries\n          );\n        } else if (material_library_pattern.test(line)) {\n          // mtl file\n\n          state.materialLibraries.push(line.substring(7).trim());\n        } else if (map_use_pattern.test(line)) {\n          // the line is parsed but ignored since the loader assumes textures are defined MTL files\n          // (according to https://www.okino.com/conv/imp_wave.htm, 'usemap' is the old-style Wavefront texture reference method)\n\n          console.warn(\n            'THREE.OBJLoader: Rendering identifier \"usemap\" not supported. Textures must be defined in MTL files.'\n          );\n        } else if (lineFirstChar === \"s\") {\n          result = line.split(\" \");\n\n          // smooth shading\n\n          // @todo Handle files that have varying smooth values for a set of faces inside one geometry,\n          // but does not define a usemtl for each face set.\n          // This should be detected and a dummy material created (later MultiMaterial and geometry groups).\n          // This requires some care to not create extra material on each smooth value for \"normal\" obj files.\n          // where explicit usemtl defines geometry groups.\n          // Example asset: examples/models/obj/cerberus/Cerberus.obj\n\n          /*\n           * http://paulbourke.net/dataformats/obj/\n           * or\n           * http://www.cs.utah.edu/~boulos/cs3505/obj_spec.pdf\n           *\n           * From chapter \"Grouping\" Syntax explanation \"s group_number\":\n           * \"group_number is the smoothing group number. To turn off smoothing groups, use a value of 0 or off.\n           * Polygonal elements use group numbers to put elements in different smoothing groups. For free-form\n           * surfaces, smoothing groups are either turned on or off; there is no difference between values greater\n           * than 0.\"\n           */\n          if (result.length > 1) {\n            var value = result[1].trim().toLowerCase();\n            state.object.smooth = value !== \"0\" && value !== \"off\";\n          } else {\n            // ZBrush can produce \"s\" lines #11707\n            state.object.smooth = true;\n          }\n\n          var material = state.object.currentMaterial();\n          if (material) material.smooth = state.object.smooth;\n        } else {\n          // Handle null terminated files without exception\n          if (line === \"\\0\") continue;\n\n          console.warn('THREE.OBJLoader: Unexpected line: \"' + line + '\"');\n        }\n      }\n\n      state.finalize();\n\n      var container = new Group();\n      container.materialLibraries = [].concat(state.materialLibraries);\n\n      var hasPrimitives = !(\n        state.objects.length === 1 &&\n        state.objects[0].geometry.vertices.length === 0\n      );\n\n      if (hasPrimitives === true) {\n        for (var i = 0, l = state.objects.length; i < l; i++) {\n          var object = state.objects[i];\n          var geometry = object.geometry;\n          var materials = object.materials;\n          var isLine = geometry.type === \"Line\";\n          var isPoints = geometry.type === \"Points\";\n          var hasVertexColors = false;\n\n          // Skip o/g line declarations that did not follow with any faces\n          if (geometry.vertices.length === 0) continue;\n\n          var buffergeometry = new BufferGeometry();\n\n          buffergeometry.setAttribute(\n            \"position\",\n            new Float32BufferAttribute(geometry.vertices, 3)\n          );\n\n          if (geometry.normals.length > 0) {\n            buffergeometry.setAttribute(\n              \"normal\",\n              new Float32BufferAttribute(geometry.normals, 3)\n            );\n          }\n\n          if (geometry.colors.length > 0) {\n            hasVertexColors = true;\n            buffergeometry.setAttribute(\n              \"color\",\n              new Float32BufferAttribute(geometry.colors, 3)\n            );\n          }\n\n          if (geometry.hasUVIndices === true) {\n            buffergeometry.setAttribute(\n              \"uv\",\n              new Float32BufferAttribute(geometry.uvs, 2)\n            );\n          }\n\n          // Create materials\n\n          var createdMaterials = [];\n\n          for (var mi = 0, miLen = materials.length; mi < miLen; mi++) {\n            var sourceMaterial = materials[mi];\n            var materialHash =\n              sourceMaterial.name +\n              \"_\" +\n              sourceMaterial.smooth +\n              \"_\" +\n              hasVertexColors;\n            var material = state.materials[materialHash];\n\n            if (this.materials !== null) {\n              material = this.materials.create(sourceMaterial.name);\n\n              // mtl etc. loaders probably can't create line materials correctly, copy properties to a line material.\n              if (\n                isLine &&\n                material &&\n                !(material instanceof LineBasicMaterial)\n              ) {\n                var materialLine = new LineBasicMaterial();\n                Material.prototype.copy.call(materialLine, material);\n                materialLine.color.copy(material.color);\n                material = materialLine;\n              } else if (\n                isPoints &&\n                material &&\n                !(material instanceof PointsMaterial)\n              ) {\n                var materialPoints = new PointsMaterial({\n                  size: 10,\n                  sizeAttenuation: false,\n                });\n                Material.prototype.copy.call(materialPoints, material);\n                materialPoints.color.copy(material.color);\n                materialPoints.map = material.map;\n                material = materialPoints;\n              }\n            }\n\n            if (material === undefined) {\n              if (isLine) {\n                material = new LineBasicMaterial();\n              } else if (isPoints) {\n                material = new PointsMaterial({\n                  size: 1,\n                  sizeAttenuation: false,\n                });\n              } else {\n                material = new MeshPhongMaterial();\n              }\n\n              material.name = sourceMaterial.name;\n              material.flatShading = sourceMaterial.smooth ? false : true;\n              material.vertexColors = hasVertexColors;\n\n              state.materials[materialHash] = material;\n            }\n\n            createdMaterials.push(material);\n          }\n\n          // Create mesh\n\n          var mesh;\n\n          if (createdMaterials.length > 1) {\n            for (var mi = 0, miLen = materials.length; mi < miLen; mi++) {\n              var sourceMaterial = materials[mi];\n              buffergeometry.addGroup(\n                sourceMaterial.groupStart,\n                sourceMaterial.groupCount,\n                mi\n              );\n            }\n\n            if (isLine) {\n              mesh = new LineSegments(buffergeometry, createdMaterials);\n            } else if (isPoints) {\n              mesh = new Points(buffergeometry, createdMaterials);\n            } else {\n              mesh = new Mesh(buffergeometry, createdMaterials);\n            }\n          } else {\n            if (isLine) {\n              mesh = new LineSegments(buffergeometry, createdMaterials[0]);\n            } else if (isPoints) {\n              mesh = new Points(buffergeometry, createdMaterials[0]);\n            } else {\n              mesh = new Mesh(buffergeometry, createdMaterials[0]);\n            }\n          }\n\n          mesh.name = object.name;\n\n          container.add(mesh);\n        }\n      } else {\n        // if there is only the default parser state object with no geometry data, interpret data as point cloud\n\n        if (state.vertices.length > 0) {\n          var material = new PointsMaterial({\n            size: 1,\n            sizeAttenuation: false,\n          });\n\n          var buffergeometry = new BufferGeometry();\n\n          buffergeometry.setAttribute(\n            \"position\",\n            new Float32BufferAttribute(state.vertices, 3)\n          );\n\n          if (state.colors.length > 0 && state.colors[0] !== undefined) {\n            buffergeometry.setAttribute(\n              \"color\",\n              new Float32BufferAttribute(state.colors, 3)\n            );\n            material.vertexColors = true;\n          }\n\n          var points = new Points(buffergeometry, material);\n          container.add(points);\n        }\n      }\n\n      return container;\n    },\n  });\n\n  return OBJLoader;\n})();\n\nexport { OBJLoader };\n","import { OBJLoader } from \"./OBJLoader\";\nimport * as THREE from \"three\";\nimport { BeadTypes } from \"../editorObjects/Editor\";\nimport { logger } from \"../logger\";\n// import { appThree } from \"./renderThreejs\";\n// import { BasisTextureLoader } from \"three/examples/jsm/loaders/BasisTextureLoader\";\n\nconst base3dModels: Base3dModels = {\n  model_cylinder: { model: null, bbox: null },\n  model_sphere: { model: null, bbox: null },\n  model_fire_polish: { model: null, bbox: null },\n  model_toho_round: { model: null, bbox: null },\n};\n\nexport type Base3dModelNames =\n  | \"model_sphere\"\n  | \"model_cylinder\"\n  | \"model_fire_polish\"\n  | \"model_toho_round\";\n\nexport type Base3dModels = {\n  [day in Base3dModelNames]: {\n    model: THREE.Object3D | null;\n    bbox: THREE.Box3 | null;\n    texture?: any;\n  };\n};\n\nconst isDev = !process.env.NODE_ENV || process.env.NODE_ENV === \"development\";\nconst modelsHost = isDev\n  ? \"./models3d/\"\n  : \"https://rpcal.github.io/coralinio-preview/build/models3d/\";\n\nexport const loadAppModels = async () => {\n  const models: { filename: string; key: Base3dModelNames }[] = [\n    {\n      filename: \"model_cylinder.obj\",\n      key: \"model_cylinder\",\n    },\n    {\n      filename: \"model_fire_polish.obj\",\n      key: \"model_fire_polish\",\n    },\n    {\n      filename: \"model_sphere.obj\",\n      key: \"model_sphere\",\n    },\n    {\n      filename: \"model_toho_round.obj\",\n      key: \"model_toho_round\",\n    },\n  ];\n  for await (const model of models) {\n    try {\n      const objLoader = new OBJLoader();\n      const object = await objLoader.loadAsync(modelsHost + model.filename);\n      logger.log(`loadAppModels: success to load ${model.key}`);\n      base3dModels[model.key].model = object.clone();\n      base3dModels[model.key].bbox = new THREE.Box3().setFromObject(object);\n    } catch (err) {\n      logger.error(`loadAppModels: error - ${err.toString()}`);\n    }\n  }\n\n  // {\n  // console.log(\"------------- zaczynam wczytuwac??\");\n  // const loader = new BasisTextureLoader();\n  // loader.setTranscoderPath(\"js/libs/basis/\");\n  // loader.detectSupport(appThree.renderer);\n  // loader.load(\n  //   modelsHost + \"canestra_di_frutta_caravaggio.basis\",\n  //   (texture) => {\n  //     texture.encoding = THREE.sRGBEncoding;\n  //     base3dModels[\"model_cylinder\"].texture = texture;\n  //     // material.map = texture;\n  //     // material.needsUpdate = true;\n\n  //     // render();\n  //     console.log(\"------------- wczytano texture\");\n  //   },\n  //   () => {\n  //     console.log(\"on progress?\")\n  //   },\n  //   function (error) {\n  //     console.error(error);\n  //   }\n  // );\n\n  // base3dModels[\"model_cylinder\"].texture = new THREE.TextureLoader().load(\n  //   modelsHost + \"canestra_di_frutta_caravaggio.basis\"\n  // );\n  // }\n\n  //@TODO: Przelicz wielkosci aby uzyc ich przy dodawaniu kolek\n  // {\n  //   try {\n  //     const object = await objLoader.loadAsync(\n  //       modelsHost + \"model_cylinder.obj\"\n  //     );\n  //     console.log(\"OBJLoader: \", \"odczytano plik model_cylinder \");\n  //     base3dModels[\"model_cylinder\"].model = object.clone();\n  //     base3dModels[\"model_cylinder\"].bbox = new THREE.Box3().setFromObject(\n  //       object\n  //     );\n  //   } catch (err) {\n  //     console.error(\"OBJLoader: \", \"nie mozna doczytac model_cylinder\");\n  //   }\n  // }\n\n  // {\n  //   try {\n  //     const object = await objLoader.loadAsync(\n  //       modelsHost + \"model_fire_polish.obj\"\n  //     );\n  //     console.log(\"OBJLoader: \", \"odczytano plik model_fire_polish \");\n  //     base3dModels[\"model_fire_polish\"].model = object.clone();\n  //     base3dModels[\"model_fire_polish\"].bbox = new THREE.Box3().setFromObject(\n  //       object\n  //     );\n  //   } catch (err) {\n  //     console.error(\"OBJLoader: \", \"nie mozna doczytac model_fire_polish\");\n  //   }\n  // }\n\n  // {\n  //   try {\n  //     const object = await objLoader.loadAsync(\n  //       modelsHost + \"model_toho_round.obj\"\n  //     );\n  //     console.log(\"OBJLoader: \", \"odczytano plik model_toho_round \");\n  //     base3dModels[\"model_toho_round\"].model = object.clone();\n  //     base3dModels[\"model_toho_round\"].bbox = new THREE.Box3().setFromObject(\n  //       object\n  //     );\n\n  //     console.log(\"co odczytano?\", base3dModels[\"model_toho_round\"].bbox);\n  //   } catch (err) {\n  //     console.error(\"OBJLoader: \", \"nie mozna doczytac model_toho_round\");\n  //   }\n  // }\n\n  // @INFO: Loading external models\n  // {\n  //   const objLoader = new OBJLoader();\n  //   const baseBeadPath = \"./3dmodels/bead_2020_02_05.obj\";\n  //   objLoader.load(\n  //     baseBeadPath,\n  //     (object) => {\n  //       console.log(\"OBJLoader: \", \"odczytano plik: \", baseBeadPath);\n  //       object.position.set(10, 10, 10);\n  //       object.scale.x = 10;\n  //       object.scale.y = 10;\n  //       object.scale.z = 10;\n  //       base3dModels[\"baseBead\"] = object.clone();\n  //     },\n  //     (xhr) => {\n  //       console.log(\n  //         \"OBJLoader: \",\n  //         (xhr.loaded / xhr.total) * 100 + \"% loaded\"\n  //       );\n  //     },\n  //     (error) => {\n  //       console.error(\"OBJLoader: \", error);\n  //     }\n  //   );\n  // }\n\n  // scene.background = new THREE.TextureLoader().load(require('./img/background.jpg').default);\n  //  {\n  //     var bg_geometry = new THREE.PlaneGeometry(1000, 1000, 1);\n  //     var bg_material = new THREE.MeshBasicMaterial({\n  //       color: \"#ccc\",\n  //       side: THREE.DoubleSide,\n  //     });\n  //     var bg_plane = new THREE.Mesh(bg_geometry, bg_material);\n  //     scene.add(bg_plane);\n  //   }\n\n  //   {\n  //     var bg_geometry = new THREE.PlaneGeometry(1000, 1000, 1);\n  //     var bg_material = new THREE.MeshBasicMaterial({\n  //       color: \"#ccc\",\n  //       side: THREE.DoubleSide,\n  //     });\n  //     var bg_plane = new THREE.Mesh(bg_geometry, bg_material);\n  //     scene.add(bg_plane);\n  //   }\n};\n\nexport const getModelFromBeadType = (type: BeadTypes) => {\n  let beadModel: THREE.Object3D | undefined;\n\n  if (type === BeadTypes.MODEL_CYLINDER) {\n    if (base3dModels.model_cylinder.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.model_cylinder.model.clone();\n  }\n\n  if (type === BeadTypes.MODEL_FIRE_POLISH) {\n    if (base3dModels.model_fire_polish.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.model_fire_polish.model.clone();\n  }\n\n  if (type === BeadTypes.MODEL_TOHO_ROUND) {\n    if (base3dModels.model_toho_round.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.model_toho_round.model.clone();\n  }\n\n  if (type === BeadTypes.MODEL_SPHERE) {\n    if (base3dModels.model_sphere.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.model_sphere.model.clone();\n  }\n\n  return beadModel;\n};\n\nexport const getModelBBoxFromBeadType = (type: BeadTypes) => {\n  if (type === BeadTypes.MODEL_CYLINDER) {\n    return base3dModels.model_cylinder.bbox;\n  }\n\n  if (type === BeadTypes.MODEL_SPHERE) {\n    return base3dModels.model_sphere.bbox;\n  }\n\n  if (type === BeadTypes.MODEL_FIRE_POLISH) {\n    return base3dModels.model_fire_polish.bbox;\n  }\n\n  if (type === BeadTypes.MODEL_TOHO_ROUND) {\n    return base3dModels.model_toho_round.bbox;\n  }\n\n  console.warn(\"missing model for bead type : \", type);\n\n  return null;\n};\n\nexport const getModelTexture = () => {\n  return base3dModels.model_cylinder.texture;\n};\n","import { Editor } from \"../editorObjects/Editor\";\nimport { ImmerReducer } from \"immer-reducer\";\nimport { Store } from \"../controllers/store\";\n\nexport class MainImmerReducer extends ImmerReducer<Editor> {\n  // /** @deprecated */\n  // action_test() {}\n  // /** @deprecated */\n  // action_restoreState() {}\n  updateEditorState(newState: Store) {\n    this.draftState.objects = newState.objects;\n    this.draftState.selectedIds = newState.selectedIds;\n    this.draftState.ui = newState.ui;\n    this.draftState.board = newState.board;\n    this.draftState.history = newState.history;\n  }\n}\n","// import {\n//   Editor,\n//   EditorMode,\n//   BeadTypes,\n//   EditorMenuMain,\n//   EditorGridType,\n//   BrushType,\n//   RegionGridType,\n// } from \"../editorObjects/Editor\";\n// import { buildPoint } from \"../editorObjects/Point\";\nimport { composeReducers } from \"immer-reducer\";\nimport { createActionCreators, createReducerFunction } from \"immer-reducer\";\n// import { DraggableOperationsImmerReducer } from \"./DraggableOperationsImmerReducer\";\n// import { PersistImmerReducer } from \"./PersistImmerReducer\";\n// import { ChangeEditorModeImmerReducer } from \"./ChangeEditorModeImmerReducer\";\nimport { MainImmerReducer } from \"./MainImmerReducer\";\n// import { MouseSelectionImmerReducer } from \"./MouseSelectionImmerReducer\";\n// import { ToolbarImmerReducer } from \"./ToolbarImmerReducer\";\n// import { defaulBeadColor } from \"../components/colors\";\n// import { TopbarImmerReducer } from \"./TopbarImmerReducer\";\n// import { PaintImmerReducer } from \"./PaintImmerReducer\";\n// import { buildBead } from \"../editorObjects/Bead\";\n// import { produce } from \"immer\";\n// import { getEventEmitter } from \"../EventEmitter\";\n// import { RegionImmerReducer } from \"./RegionImmerReducer\";\n// import * as THREE from \"three\";\nimport { defaultStore } from \"../controllers/store\";\n\n// const defaultBead = buildBead({});\n\n// const defaultAppData: Editor = {\n//   appData: {\n//     objects: {},\n//     beads: {},\n//     lines: {},\n//     regions: {},\n//   },\n// ui: {\n//   zoomScale: 1,\n//   lights: [\n//     {\n//       id: THREE.MathUtils.generateUUID(),\n//       type: \"THREE.DirectionalLight\",\n//       name: \"main_light_1\",\n//       color: \"#FFF\",\n//       intensity: 0.8,\n//       position: {\n//         x: 0,\n//         y: 0,\n//         z: 10,\n//       },\n//     },\n//     {\n//       id: THREE.MathUtils.generateUUID(),\n//       type: \"THREE.DirectionalLight\",\n//       name: \"main_light_2\",\n//       color: \"#FFF\",\n//       intensity: 0.4,\n//       position: {\n//         x: 0,\n//         y: 0,\n//         z: 10,\n//       },\n//     },\n//   ],\n// lineSettings: {\n//   settings: {\n//     beadsAutoCount: true,\n//     beadsAutoSpacing: true,\n//     beadsCount: 0,\n//     beadsSpacing: 0,\n//     defaultBead: {\n//       type: BeadTypes.MODEL_SPHERE,\n//       rotateX: 90,\n//       rotateY: 0,\n//       rotateZ: 0,\n//       color: defaulBeadColor,\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: false,\n//     },\n//   },\n// },\n// saveInfo: {\n//   saved: false,\n//   haveUnsavedChanges: false,\n// },\n// selectedRegionsIds: {},\n// selectedRegionsIdsCount: 0,\n// selectedLinesIds: {},\n// selectedLinesIdsCount: 0,\n// selectedBeadsIds: {},\n// selectedBeadsIdsCount: 0,\n\n// selectedIds: [],\n// selectedIdsAsKeys: {},\n// selectedIdsCount: 0,\n// selectedTopBarPosition: undefined,\n// editBBox: undefined,\n// mouseSelection: {\n//   start: buildPoint(0, 0),\n//   end: buildPoint(0, 0),\n//   isDragStarted: false,\n//   isDragged: false,\n// },\n// currentMenuMainOpen: EditorMenuMain.None,\n// grid: {\n//   id: THREE.MathUtils.generateUUID(),\n//   type: EditorGridType.Hex,\n//   hexSize: 30,\n//   snapEnabled: true,\n//   isVisible: true,\n//   width: 30,\n//   height: 30,\n// },\n// brush: {\n//   type: BrushType.Color,\n//   size: 50,\n//   color: defaulBeadColor,\n// },\n// background: {\n//   image: {\n//     url: \"\",\n//     scale: 1,\n//     position: buildPoint(0, 0),\n//     opacity: 0.5,\n//   },\n// },\n// beadsTemplate: {\n//   color: defaultBead.color,\n//   width: defaultBead.width,\n//   height: defaultBead.height,\n//   depth: defaultBead.depth,\n//   keepAspectRatio: defaultBead.keepAspectRatio,\n//   rotateX: defaultBead.rotateX,\n//   rotateY: defaultBead.rotateY,\n//   rotateZ: defaultBead.rotateZ,\n//   type: defaultBead.type,\n// },\n// currentBeadChain: {\n//   isDragEnabled: false,\n//   beadIds: [],\n// },\n// sceneWrapperWidth: 0,\n// sceneWrapperHeight: 0,\n// sceneWrapperPosition: {\n//   x: 0,\n//   y: 0,\n//   angle: 0,\n//   scale: 0,\n//   top: 0,\n//   left: 0,\n// },\n// regionTemplate: {\n//   gridType: RegionGridType.Rectangles,\n// },\n// },\n// mode: EditorMode.SelectOrMove,\n// };\n\nexport const Actions = {\n  Main: createActionCreators(MainImmerReducer),\n  // Draggable: createActionCreators(DraggableOperationsImmerReducer),\n  // Persist: createActionCreators(PersistImmerReducer),\n  // ChangeEditorMode: createActionCreators(ChangeEditorModeImmerReducer),\n  // MouseSelection: createActionCreators(MouseSelectionImmerReducer),\n  // Toolbar: createActionCreators(ToolbarImmerReducer),\n  // Topbar: createActionCreators(TopbarImmerReducer),\n  // Paint: createActionCreators(PaintImmerReducer),\n  // Region: createActionCreators(RegionImmerReducer),\n};\n\n// const eventEmitter = getEventEmitter();\n\n// const reducerForEventEmitter = produce((state, action) => {\n//   eventEmitter.emit(action.type, action.payload, state);\n// }, {});\n\nexport const store = composeReducers(\n  createReducerFunction(MainImmerReducer, defaultStore)\n  // createReducerFunction(DraggableOperationsImmerReducer, defaultAppData),\n  // createReducerFunction(PersistImmerReducer, defaultAppData),\n  // createReducerFunction(ToolbarImmerReducer, defaultAppData),\n  // createReducerFunction(TopbarImmerReducer, defaultAppData),\n  // createReducerFunction(ChangeEditorModeImmerReducer, defaultAppData),\n  // createReducerFunction(MouseSelectionImmerReducer, defaultAppData),\n  // createReducerFunction(PaintImmerReducer, defaultAppData),\n  // createReducerFunction(RegionImmerReducer, defaultAppData),\n  // reducerForEventEmitter\n);\n","import { createStore } from \"redux\";\n// import thunk from \"redux-thunk\";\nimport { store } from \"./store\";\n\nexport const appStore = createStore(\n  store,\n  // \"__REDUX_DEVTOOLS_EXTENSION__\" in window &&\n  //   (window as any).__REDUX_DEVTOOLS_EXTENSION__()\n  // applyMiddleware(thunk)\n);\n","export class MouseDragHelper {\n  isDragged: boolean = false;\n  isDragStarted: boolean = false;\n  end: { x: number; y: number } = { x: 0, y: 0 };\n  start: { x: number; y: number } = { x: 0, y: 0 };\n  shouldBehaveLikeMove: boolean = false;\n\n  onDown(x: number, y: number) {\n    this.isDragStarted = true;\n    this.isDragged = false;\n    this.start.x = x;\n    this.start.y = y;\n    this.end.x = x;\n    this.end.y = y;\n  }\n  \n  onUp() {\n    this.isDragStarted = false;\n    this.isDragged = false;\n    this.start.x = 0;\n    this.start.y = 0;\n    this.end.x = 0;\n    this.end.y = 0;\n    this.shouldBehaveLikeMove = false;\n  }\n\n  onMove(x: number, y: number) {\n    if (this.isDragStarted === true) {\n      this.end.x = x;\n      this.end.y = y;\n      if (this.isDragged === false) {\n        const { start, end } = this;\n        const deltaX = end.x - start.x;\n        const deltaY = end.y - start.y;\n\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\n          this.isDragged = true;\n        }\n      }\n    }\n  }\n}\n","import { appThree } from \"../../renderThreejs\";\nimport * as THREE from \"three\";\nimport { Group, groupIdKey, ObjectTypes } from \"../../../editorObjects/Editor\";\nimport { getStore } from \"../../../controllers/store\";\n\nexport class MouseEventsBase {\n  boundingClientRect: DOMRect | undefined;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  intersects: THREE.Intersection[];\n\n  constructor() {\n    this.boundingClientRect = undefined;\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n    this.raycaster.layers.enable(3);\n    this.intersects = [];\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {}\n\n  onMove(event: PointerEvent) {}\n\n  onUp(event: PointerEvent) {}\n\n  getIntersect(clientX: number, clientY: number) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n\n    if (this.boundingClientRect === undefined) {\n      return [];\n    }\n\n    const { width, height, top, left } = this.boundingClientRect;\n    this.mouse.x = ((clientX - left) / width) * 2 - 1;\n    this.mouse.y = -((clientY - top) / height) * 2 + 1;\n    this.raycaster.setFromCamera(this.mouse, appThree.camera);\n    // @TODO: use raycaster with layers\n    // this.raycaster.layers.\n    return this.raycaster.intersectObjects(appThree.scene.children, true);\n  }\n\n  getIntersectObjects(clientX: number, clientY: number) {\n    return this.getObjectsFromIntersect(this.getIntersect(clientX, clientY));\n  }\n\n  getActiveObjectsFromIntersect(clientX: number, clientY: number) {\n    const intersects = this.getIntersect(clientX, clientY);\n    return intersects.filter((obj) => {\n      const data = obj.object.userData;\n      const objectType = data?.objectType ?? undefined;\n      return (\n        objectType === ObjectTypes.Bead ||\n        objectType === ObjectTypes.Region ||\n        objectType === ObjectTypes.Group ||\n        objectType === ObjectTypes.PreviewProject3D\n      );\n    });\n  }\n\n  getObjectsFromIntersect(intersects: THREE.Intersection[]) {\n    const { Bead, Region, SceneEditBBox } = ObjectTypes;\n    return intersects.filter((obj) => {\n      const objectType = obj?.object?.userData?.objectType ?? undefined;\n      return (\n        objectType === Bead ||\n        objectType === Region ||\n        objectType === SceneEditBBox\n      );\n    });\n  }\n\n  getIdsFromGroupOrInGroup(objectId: string) {\n    const store = getStore();\n    if (store.objects[objectId] === undefined) {\n      return [];\n    }\n    // store.objects[objectId].objectType;\n    const isGroup = store.objects[objectId].objectType === ObjectTypes.Group;\n    const isInGroup =\n      store.objects[objectId][groupIdKey] !== undefined &&\n      store.objects[objectId][groupIdKey].length > 0;\n    const groupId = store.objects[objectId][groupIdKey];\n    if (isGroup) {\n      return (store.objects[objectId] as Group).childrenIds;\n    } else if (isInGroup) {\n      return [groupId, ...(store.objects[groupId] as Group).childrenIds];\n    } else {\n      return [];\n    }\n  }\n\n  groupObjectsByTypeFromIntersect(\n    intersects: THREE.Intersection[],\n    maxItems?: number\n  ) {\n    // const { Bead, Region, SceneEditBBox } = ObjectTypes;\n    const result: {\n      Bead: THREE.Intersection[];\n      Region: THREE.Intersection[];\n      SceneEditBBox: THREE.Intersection[];\n    } = {\n      Bead: [],\n      Region: [],\n      SceneEditBBox: [],\n    };\n    const selected: number[] = [];\n    intersects.forEach((obj, index) => {\n      if (maxItems !== undefined) {\n        if (selected.length >= maxItems) {\n          return;\n        }\n      }\n      const id = obj?.object?.userData?.id ?? undefined;\n      const objectType = obj?.object?.userData?.objectType ?? undefined;\n      // const isLocked = obj?.object?.userData?.isLocked ?? false;\n\n      if (id !== undefined) {\n        if (objectType !== undefined) {\n          result[objectType].push(obj);\n          selected.push(index);\n        }\n      }\n    });\n    return result;\n  }\n}\n","import * as THREE from \"three\";\nimport { AddObjects, AppEventType } from \"../../../controllers/AppEventType\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { ObjectTypes } from \"../../../editorObjects/Editor\";\nimport { MouseDragHelper } from \"../MouseDragHelper\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeAddBead extends MouseEventsBase {\n  mouseDragHelper: MouseDragHelper;\n  lastAddPosition: THREE.Vector2;\n\n  constructor() {\n    super();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.lastAddPosition = new THREE.Vector2();\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n    this.addBead(x, y);\n    this.lastAddPosition.set(x, y);\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.mouseDragHelper.isDragStarted === true) {\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onMove(x, y);\n      const currPosition = new THREE.Vector2(x, y);\n      const distance = this.lastAddPosition.distanceTo(currPosition);\n      if (distance > 10) {\n        this.lastAddPosition = currPosition.clone();\n        this.addBead(x, y);\n      }\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    this.mouseDragHelper.onUp();\n    this.lastAddPosition = new THREE.Vector2();\n  }\n\n  addBead(worldX: number, wordlY: number) {\n    const action1: AddObjects = {\n      name: AppEventType.AddObjects,\n      payload: {\n        objects: [\n          {\n            objectType: ObjectTypes.Bead,\n            position: { x: worldX, y: wordlY, z: 1 },\n          },\n        ],\n      },\n    };\n    sendEvent(action1);\n  }\n}\n","import { Vector2 } from \"three\";\n\nexport class MouseSelectionHelper {\n  element: HTMLDivElement;\n  renderer: any;\n  startPoint: Vector2;\n  pointTopLeft: Vector2;\n  pointBottomRight: Vector2;\n  isDown: boolean;\n\n  constructor() {\n    this.element = document.createElement(\"div\");\n    this.element.style.pointerEvents = \"none\";\n    this.element.style.background = \"rgba(75, 160, 255, 0.3)\";\n    this.element.style.border = \"1px solid #55aaff\";\n    this.element.style.position = \"absolute\";\n    this.element.style.zIndex = \"2\";\n    this.startPoint = new Vector2();\n    this.pointTopLeft = new Vector2();\n    this.pointBottomRight = new Vector2();\n    this.isDown = false;\n  }\n\n  setRenderer(renderer) {\n    this.renderer = renderer;\n  }\n\n  onDown(screenX: number, screenY: number) {\n    this.isDown = true;\n\n    if (this.renderer.domElement && this.renderer.domElement.parentElement) {\n      this.renderer.domElement.parentElement.appendChild(this.element);\n    }\n    // document.body.appendChild(this.element);\n\n    // this.element.setAttribute(\"style\", `\n    //   left: ${screenX}px;\n    //   top: ${screenY}px;\n    //   width: 0px;\n    //   height: 0px;\n    // `);\n\n    if (this.element) {\n      this.element.style.left = screenX + \"px\";\n      this.element.style.top = screenY + \"px\";\n      this.element.style.width = \"0px\";\n      this.element.style.height = \"0px\";\n    }\n\n    this.startPoint.x = screenX;\n    this.startPoint.y = screenY;\n  }\n\n  onMove(screenX: number, screenY: number) {\n    if (this.isDown) {\n      this.pointBottomRight.x = Math.max(this.startPoint.x, screenX);\n      this.pointBottomRight.y = Math.max(this.startPoint.y, screenY);\n      this.pointTopLeft.x = Math.min(this.startPoint.x, screenX);\n      this.pointTopLeft.y = Math.min(this.startPoint.y, screenY);\n\n      if (this.element) {\n        this.element.style.left = this.pointTopLeft.x + \"px\";\n        this.element.style.top = this.pointTopLeft.y + \"px\";\n        this.element.style.width =\n          this.pointBottomRight.x - this.pointTopLeft.x + \"px\";\n        this.element.style.height =\n          this.pointBottomRight.y - this.pointTopLeft.y + \"px\";\n      }\n    }\n  }\n\n  onUp() {\n    // document.body.removeChild(this.element);\n    if (this.element && this.element.parentElement !== null) {\n      this.element.parentElement.removeChild(this.element);\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport {\n  AddObjects,\n  AppEventType,\n  ChangeUiSettings,\n} from \"../../../controllers/AppEventType\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { EditorMode, ObjectTypes } from \"../../../editorObjects/Editor\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"./../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"./../MouseSelectionHelper\";\nimport { screenToWorld } from \"./../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeAddRegion extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  mouseSelectionHelper: MouseSelectionHelper;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { top, left } = this.boundingClientRect;\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n    this.mouseSelectionHelper.onDown(screenX, screenY);\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { top, left } = this.boundingClientRect;\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n    this.mouseSelectionHelper.onMove(screenX, screenY);\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onMove(x, y);\n  }\n\n  onUp(event: PointerEvent) {\n    // const { getState, dispatch } = appStore;\n    // const { dispatch } = appStore;\n    // const state = getState();\n    const minX = Math.min(\n      this.mouseDragHelper.start.x,\n      this.mouseDragHelper.end.x\n    );\n    const minY = Math.min(\n      this.mouseDragHelper.start.y,\n      this.mouseDragHelper.end.y\n    );\n    const width = Math.abs(\n      this.mouseDragHelper.end.x - this.mouseDragHelper.start.x\n    );\n    const height = Math.abs(\n      this.mouseDragHelper.end.y - this.mouseDragHelper.start.y\n    );\n    // let defaultRegion: Partial<Region> = {\n    //  ...this.draftState.ui.regionTemplate,\n    // };\n    // defaultRegion.id = undefined;\n    // defaultRegion.position = buildPoint(minX + width / 2, minY + height / 2);\n    // defaultRegion.height = height;\n    // defaultRegion.width = width;\n\n    const action1: AddObjects = {\n      name: AppEventType.AddObjects,\n      payload: {\n        objects: [\n          {\n            objectType: ObjectTypes.Region,\n            height,\n            width,\n            position: {\n              x: minX + width / 2,\n              y: minY + height / 2,\n              z: 1,\n            },\n          },\n        ],\n      },\n    };\n    sendEvent(action1);\n    const action2: ChangeUiSettings = {\n      name: AppEventType.ChangeUiSettings,\n      payload: {\n        uiSettings: {\n          mode: EditorMode.SelectOrMove,\n        },\n      },\n    };\n    sendEvent(action2);\n    // dispatch(\n    //   Actions.Region.action_addRegion(\n    //     this.mouseDragHelper.start as Point,\n    //     this.mouseDragHelper.end as Point\n    //   )\n    // );\n    // dispatch(\n    //   Actions.ChangeEditorMode.action_onChangeEditorMode(\n    //     EditorMode.SelectOrMove\n    //   )\n    // );\n    this.mouseDragHelper.onUp();\n    this.mouseSelectionHelper.onUp();\n  }\n}\n","import * as THREE from \"three\";\nimport { AppEventType } from \"../../../controllers/AppEventType\";\nimport { getStore } from \"../../../controllers/store\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { ObjectTypes } from \"../../../editorObjects/Editor\";\nimport { triggerDeleteBeadIds } from \"../../eventEmitterHandlers\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"./../MouseDragHelper\";\nimport { screenToWorld } from \"./../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeDelete extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  touchedIds: string[];\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n    this.touchedIds = [];\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    this.touchedIds = [];\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n    this.touchBead(event.clientX, event.clientY);\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.mouseDragHelper.isDragStarted === true) {\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onMove(x, y);\n      this.touchBead(event.clientX, event.clientY);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    if (this.touchedIds.length > 0) {\n      sendEvent({\n        name: AppEventType.RemoveObjects,\n        payload: {\n          ids: this.touchedIds,\n        },\n      });\n    }\n    this.mouseDragHelper.onUp();\n  }\n\n  touchBead(clientX: number, clientY: number) {\n    if (this.boundingClientRect !== undefined) {\n      const { width, height, top, left } = this.boundingClientRect;\n\n      this.mouse.x = ((clientX - left) / width) * 2 - 1;\n      this.mouse.y = -((clientY - top) / height) * 2 + 1;\n\n      this.raycaster.setFromCamera(this.mouse, appThree.camera);\n\n      const intersects = this.raycaster.intersectObjects(\n        appThree.scene.children,\n        true\n      );\n\n      if (intersects.length > 0) {\n        const store = getStore();\n        const beadsIds: Set<string> = new Set<string>();\n        intersects.forEach((obj) => {\n          const id = obj.object.userData?.id ?? undefined;\n          if (\n            id !== undefined &&\n            store.objects[id] !== undefined &&\n            store.objects[id].objectType === ObjectTypes.Bead &&\n            beadsIds.has(id) === false\n          ) {\n            beadsIds.add(id);\n          }\n        });\n\n        triggerDeleteBeadIds(Array.from(beadsIds));\n      }\n    }\n  }\n}\n","import { appStore } from \"../immerReducers/appStore\";\nimport { Actions } from \"../immerReducers/store\";\nimport { Store } from \"./store\";\n\nexport const refreshReactState = (newState: Store) => {\n  const { dispatch } = appStore;\n  dispatch(Actions.Main.updateEditorState(newState));\n};\n","import { xor } from \"lodash\";\n\nexport const keyCodeToKeyName = {\n  8: \"backspace\",\n  9: \"tab\",\n  13: \"enter\",\n  16: \"shift\",\n  17: \"ctrl\",\n  18: \"alt\",\n  20: \"capslock\",\n  27: \"escape\",\n  32: \"space\",\n  33: \"pageup\",\n  34: \"pagedown\",\n  35: \"end\",\n  36: \"home\",\n  37: \"left\",\n  38: \"up\",\n  39: \"right\",\n  40: \"down\",\n  45: \"ins\",\n  46: \"del\",\n  91: \"meta\",\n  93: \"meta\",\n  224: \"meta\",\n\n  106: \"*\",\n  107: \"+\",\n  109: \"-\",\n  110: \".\",\n  111: \"/\",\n  186: \";\",\n  187: \"=\",\n  188: \",\",\n  189: \"-\",\n  190: \".\",\n  191: \"/\",\n  192: \"`\",\n  219: \"[\",\n  220: \"\\\\\",\n  221: \"]\",\n  222: \"'\",\n\n  ArrowUp: \"Up\",\n  ArrowDown: \"Down\",\n  ArrowLeft: \"Left\",\n  ArrowRight: \"Right\",\n};\n\nexport const modifiers = {\n  ShiftLeft: \"shift\",\n  ShiftRight: \"shift\",\n  AltLeft: \"alt\",\n  AltRight: \"alt\",\n  MetaLeft: \"meta\",\n  MetaRight: \"meta\",\n  ControlLeft: \"control\",\n  ControlRight: \"control\",\n};\n\nexport const isEventModifier = (event) => {\n  // new browsers\n  if (\"code\" in event) {\n    return !!modifiers[event.code];\n  }\n\n  // old browsers\n  return (\n    event.which === 16 ||\n    event.which === 17 ||\n    event.which === 18 ||\n    event.which === 91\n  );\n};\n\nexport const getKeyEventName = (event) => {\n  let keyName = \"\";\n  const keys: string[] = [];\n\n  if (\"code\" in event) {\n    keyName = keyCodeToKeyName[event.code]\n      ? keyCodeToKeyName[event.code]\n      : event.code;\n  } else {\n    const keyCode = event.which;\n    keyName = String.fromCharCode(keyCode).toLowerCase();\n    if (keyCodeToKeyName[keyCode]) {\n      keyName = keyCodeToKeyName[keyCode];\n    }\n  }\n\n  //   if (event.altKey) {\n  //     keys.push(\"Alt\");\n  //   }\n\n  //   if (event.shiftKey) {\n  //     keys.push(\"Shift\");\n  //   }\n\n  //   if (event.ctrlKey) {\n  //     keys.push(\"Ctrl\");\n  //   }\n\n  //   if (event.metaKey) {\n  //     keys.push(\"Meta\");\n  //   }\n\n  keys.push(keyName);\n\n  return keys.join(\"+\");\n};\n\nexport const isInputElement = (element) => {\n  if (!element || !element.tagName) {\n    return false;\n  }\n\n  return (\n    element.tagName === \"BUTTON\" ||\n    element.tagName === \"INPUT\" ||\n    element.tagName === \"SELECT\" ||\n    element.tagName === \"TEXTAREA\"\n  );\n};\n\nexport const defaultMonitor = (eventName) => {\n  // console.log(\":keyboard event:\", eventName);\n};\n\nexport const isInputEvent = (event) => {\n  return isInputElement(event.target || event.nativeEvent.target);\n};\n\nlet __preventDefaultEvents = false;\n// let __ignoreInputEvents = false;\nlet __pressed = {};\nlet __element: Element | Document | undefined = undefined;\nlet __subscriptions = {};\nlet __monitor: (\n  eventName: string,\n  matched: boolean,\n  event: any\n) => void = defaultMonitor;\n\nexport function initKeybinding(element: Element | Document | null = null) {\n  if (typeof window === \"undefined\") {\n    // not a browser environment?\n    return false;\n  }\n\n  // default element is the window document\n  if (element === null) {\n    __element = window.document;\n  }\n\n  // ignore input events, except when the element is an input.\n  // __ignoreInputEvents = !isInputElement(__element);\n\n  let hidden, visibilityChange;\n  if (typeof document.hidden !== \"undefined\") {\n    // Opera 12.10 and Firefox 18 and later support\n    hidden = \"hidden\";\n    visibilityChange = \"visibilitychange\";\n  } else if (typeof (document as any).msHidden !== \"undefined\") {\n    hidden = \"msHidden\";\n    visibilityChange = \"msvisibilitychange\";\n  } else if (typeof (document as any).webkitHidden !== \"undefined\") {\n    hidden = \"webkitHidden\";\n    visibilityChange = \"webkitvisibilitychange\";\n  }\n  function handleVisibilityChange() {\n    // console.log(\"handleVisibilityChange.... \", document[hidden]);\n    if (document[hidden]) {\n      __pressed = {};\n    }\n  }\n  if (\n    typeof document.addEventListener === \"undefined\" ||\n    hidden === undefined\n  ) {\n    console.warn(\n      \"This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API.\"\n    );\n  } else {\n    document.addEventListener(visibilityChange, handleVisibilityChange, false);\n    // console.log(\"podpinamm... visibilityChange\");\n  }\n}\n\n// creates a subscription and returns the unsubscribe function;\nexport const subscribeKeys = (\n  name: string,\n  callback: (event: KeyboardEvent, pressed: string[]) => void\n) => {\n  // Subscripton names are lowercased so both 'Shift+Space' and 'shift+space' works.\n  name = name.toLowerCase();\n  // remove spaces so both 'Shift + Space' and 'shift+space' works.\n  name.replace(/\\s/, \"\");\n\n  if (typeof __subscriptions[name] === \"undefined\") {\n    __subscriptions[name] = [];\n  }\n\n  __subscriptions[name].push(callback);\n\n  return {\n    unsubscribe: () => {\n      const index = __subscriptions[name].indexOf(callback);\n      __subscriptions[name].splice(index, 1);\n    },\n  };\n};\n\n// alows to set a monitor function that will run on every event\nexport function setMonitor(\n  enabled: boolean,\n  monitorFn?: (eventName: string, matched: boolean, event: any) => void\n) {\n  if (enabled === false) {\n    __monitor = () => {};\n  } else {\n    if (monitorFn !== undefined) {\n      __monitor = monitorFn;\n    } else {\n      __monitor = defaultMonitor;\n    }\n  }\n}\n\nexport function startListeningKeys() {\n  if (__element !== undefined) {\n    (__element as any).addEventListener(\"keydown\", handleKeyEvent);\n    __element.addEventListener(\"keyup\", unhandleKeyEvent);\n  }\n}\n\nexport function stopListeningKeys() {\n  if (__element !== undefined) {\n    (__element as any).removeEventListener(\"keydown\", handleKeyEvent);\n    __element.removeEventListener(\"keyup\", unhandleKeyEvent);\n  }\n}\n\nexport function setPreventDefault(newValue: boolean) {\n  __preventDefaultEvents = newValue;\n}\n\nexport function isPressedKey(eventName: string) {\n  return __pressed[eventName] === true;\n}\nexport function isPressedKeys(eventNames: string[]) {\n  return xor(Object.keys(__pressed), eventNames).length === 0;\n}\n\nexport function getKeysPressed() {\n  return Object.keys(__pressed);\n}\n\nfunction unhandleKeyEvent(event: Event) {\n  __pressed = {};\n}\n\n// listens to the event and fires the appropiate event subscription\nfunction handleKeyEvent(event: KeyboardEvent) {\n  if (__preventDefaultEvents === true) {\n    event.preventDefault();\n  }\n\n  //   console.log(\"handleKeyEventhandleKeyEvent\", 1);\n  //   if (isEventModifier(event)) {\n  //     return;\n  //   }\n  //   console.log(\"handleKeyEventhandleKeyEvent\", 2);\n\n  //   if (__ignoreInputEvents && isInputEvent(event)) {\n  //     return;\n  //   }\n\n  const eventName = getKeyEventName(event);\n  const listeners = __subscriptions[eventName.toLowerCase()] || [];\n\n  if (typeof __monitor === \"function\") {\n    const matched = listeners.length > 0;\n    __monitor(eventName, matched, event);\n  }\n  __pressed[eventName.toLowerCase()] = true;\n\n  if (listeners.length > 0) {\n    event.preventDefault();\n  }\n\n  let propagate = true;\n\n  for (let i = listeners.length - 1; i >= 0; i--) {\n    if (listeners[i]) {\n      propagate = listeners[i](event, Object.keys(__pressed));\n    }\n    if (propagate === false) {\n      break;\n    }\n  }\n}\n","import { EditBBox, NAME_SEPARATOR, ObjectTypes } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum EditBBoxChildSuffix {\n  MAIN = \"MAIN\",\n  BG = \"BG\",\n  EDIT_CONTAINER = \"EDIT_CONTAINER\",\n  LINES = \"LINES\",\n  WHITE_DOT_BG = \"WHITE_DOT_BG\",\n  GRAY_DOT_BG = \"GRAY_DOT_BG\",\n  RESIZE_CONTAINER = \"RESIZE_CONTAINER\",\n  DOT_RESIZE_TOP_LEFT = \"DOT_RESIZE_TOP_LEFT\",\n  DOT_RESIZE_TOP_RIGHT = \"DOT_RESIZE_TOP_RIGHT\",\n  DOT_RESIZE_BOTTOM_LEFT = \"DOT_RESIZE_BOTTOM_LEFT\",\n  DOT_RESIZE_BOTTOM_RIGHT = \"DOT_RESIZE_BOTTOM_RIGHT\",\n}\n\nexport const getThreeNameFromEditBBoxId = (\n  id: string,\n  childSuffix: EditBBoxChildSuffix = EditBBoxChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.SceneEditBBox}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getEditBBoxIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.SceneEditBBox) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromEditBBox = (\n  id: string,\n  childSuffix?: EditBBoxChildSuffix\n) => {\n  return {\n    id,\n    name: getThreeNameFromEditBBoxId(id, childSuffix),\n  };\n};\n\nexport const buildEditBBox = (props: DeepPartial<EditBBox>): EditBBox => {\n  const defaults: EditBBox = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n    height: 0,\n    width: 0,\n    depth: 10,\n    editable: true,\n    // beadIds: [],\n    // regionsIds: [],\n    selectedIds: [],\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.SceneEditBBox,\n  };\n\n  return merge(defaults, props);\n};\n","import { produce } from \"immer\";\nimport {\n  AppEventType,\n  ChangeObjectsProperty,\n  ChangeSelectObjects,\n} from \"../../../controllers/AppEventType\";\nimport { refreshReactState } from \"../../../controllers/refreshReactState\";\nimport { getStore, setStore } from \"../../../controllers/store\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport {\n  AppObject,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n  Region,\n} from \"../../../editorObjects/Editor\";\nimport { logger } from \"../../../logger\";\nimport { getTopBarPosition } from \"../../eventEmitterHandlers\";\nimport { getKeysPressed, isPressedKey } from \"../../keyboard/keyMap\";\nimport { appThree } from \"../../renderThreejs\";\nimport { getSelectBBox } from \"../../SelectBBox\";\nimport { MouseDragHelper } from \"../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"../MouseSelectionHelper\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport { SelectionFilter } from \"../SelectionFilter\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\nimport { MouseEventsIdle } from \"./MouseEventsIdle\";\n\nenum ActionType {\n  moveCamera = \"moveCamera\",\n  moveAllSelectedObjects = \"moveAllSelectedObjects\",\n  moveSelectBBox = \"moveSelectBBox\",\n  editSelectBBox = \"editSelectBBox\",\n  moveObjectGroup = \"moveObjectGroup\",\n  moveSingleObject = \"moveSingleObject\",\n  selectMultipleObjects = \"selectMultipleObjects\",\n  deselectMultipleObjects = \"deselectMultipleObjects\",\n}\n\nexport class MouseEventsEditorModeSelectOrMove extends MouseEventsBase {\n  actionType: ActionType | undefined;\n  mouseDragHelper: MouseDragHelper;\n  selectionBox: SelectionFilter;\n  mouseSelectionHelper: MouseSelectionHelper;\n  prevEditBBox: any | undefined;\n  mouseEventsIdle: MouseEventsIdle;\n\n  constructor() {\n    super();\n    this.mouseDragHelper = new MouseDragHelper();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n\n    this.selectionBox = new SelectionFilter();\n    this.selectionBox.setCamera(appThree.camera);\n    this.selectionBox.setScene(appThree.scene);\n\n    this.mouseEventsIdle = new MouseEventsIdle();\n    this.actionType = undefined;\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    logger.trace(\n      \"MouseEventsEditorModeSelectOrMove: jak z kliknieciem???\",\n      getKeysPressed(),\n      isPressedKey(\"space\")\n    );\n\n    if (isPressedKey(\"space\")) {\n      this.actionType = ActionType.moveCamera;\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      this.mouseEventsIdle.onDown(event);\n      logger.trace(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    if (event.altKey) {\n      this.actionType = ActionType.deselectMultipleObjects;\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      if (appThree.el !== null) {\n        this.boundingClientRect = appThree.el.getBoundingClientRect();\n      }\n      if (this.boundingClientRect === undefined) {\n        return;\n      }\n      const { top, left, width, height } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n\n      this.mouseSelectionHelper.onDown(screenX, screenY);\n\n      this.selectionBox.startPoint.set(\n        ((event.clientX - left) / width) * 2 - 1,\n        -((event.clientY - top) / height) * 2 + 1,\n        0\n      );\n      logger.trace(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    if (event.shiftKey) {\n      this.actionType = ActionType.selectMultipleObjects;\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      if (appThree.el !== null) {\n        this.boundingClientRect = appThree.el.getBoundingClientRect();\n      }\n      if (this.boundingClientRect === undefined) {\n        return;\n      }\n      const { top, left, width, height } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n\n      this.mouseSelectionHelper.onDown(screenX, screenY);\n\n      this.selectionBox.startPoint.set(\n        ((event.clientX - left) / width) * 2 - 1,\n        -((event.clientY - top) / height) * 2 + 1,\n        0\n      );\n      logger.trace(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    this.actionType = undefined;\n\n    const intersects = this.getIntersect(event.clientX, event.clientY);\n    const selectBBox = getSelectBBox();\n\n    if (selectBBox.isHandle(intersects)) {\n      this.actionType = ActionType.editSelectBBox;\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      selectBBox.onDownEdit(intersects);\n      return;\n    }\n\n    this.intersects = intersects.filter((obj) => {\n      const data = obj.object.userData;\n      const objectType = data?.objectType ?? undefined;\n      return (\n        objectType === ObjectTypes.Bead ||\n        objectType === ObjectTypes.Region ||\n        objectType === ObjectTypes.Group ||\n        objectType === ObjectTypes.PreviewProject3D\n      );\n    });\n\n    const firstClickedActiveObject = this.intersects.length > 0;\n\n    if (firstClickedActiveObject) {\n      const store = getStore();\n      const clicked = this.intersects[0].object.userData as AppObject;\n      const clickedId = clicked.id;\n      const clickedItemInSelectedObjects = store.selectedIds.includes(\n        clickedId\n      );\n\n      let selectedIsLocked: any = false;\n      store.selectedIds.forEach((id) => {\n        if (store.objects[id].isLocked === true) {\n          selectedIsLocked = true;\n        }\n      });\n\n      if (clicked.isLocked === true) {\n        sendEvent(this.getSelectionForSingleObjectIdAction(clickedId));\n      } else if (selectedIsLocked === true) {\n        sendEvent(this.getSelectionForSingleObjectIdAction(clickedId));\n      } else if (clickedItemInSelectedObjects) {\n        this.actionType = ActionType.moveAllSelectedObjects;\n        const { x, y } = screenToWorld(event.clientX, event.clientY);\n        this.mouseDragHelper.onDown(x, y);\n        selectBBox.onDownMove();\n      } else {\n        const isGroup =\n          clicked.objectType !== undefined &&\n          clicked.objectType === ObjectTypes.Group;\n\n        const isGroupChild =\n          clicked[groupIdKey] !== undefined && clicked[groupIdKey].length > 0;\n\n        const isClickedOnGroup = isGroup || isGroupChild;\n\n        if (isClickedOnGroup) {\n          this.actionType = ActionType.moveObjectGroup;\n        } else {\n          this.actionType = ActionType.moveSingleObject;\n        }\n        const { x, y } = screenToWorld(event.clientX, event.clientY);\n        this.mouseDragHelper.onDown(x, y);\n      }\n    } else {\n      if (selectBBox.isChild(intersects)) {\n        this.actionType = ActionType.moveSelectBBox;\n        const { x, y } = screenToWorld(event.clientX, event.clientY);\n        this.mouseDragHelper.onDown(x, y);\n        selectBBox.onDownMove();\n      } else {\n        this.actionType = ActionType.moveCamera;\n        const { x, y } = screenToWorld(event.clientX, event.clientY);\n        this.mouseDragHelper.onDown(x, y);\n        this.mouseEventsIdle.onDown(event);\n      }\n    }\n\n    logger.trace(\n      \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n      this.actionType\n    );\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.actionType === undefined) {\n      return;\n    }\n\n    if (this.actionType === ActionType.moveCamera) {\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onMove(x, y);\n      this.mouseEventsIdle.onMove(event);\n      this.updateUIAtMove(false);\n    }\n\n    if (this.actionType === ActionType.moveAllSelectedObjects) {\n      this.moveAllSelectedObjects(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === ActionType.moveSingleObject) {\n      this.moveSingleObject(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === ActionType.moveObjectGroup) {\n      this.moveObjectGroup(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === ActionType.selectMultipleObjects) {\n      this.selectMultipleObjects(event.clientX, event.clientY, true);\n    }\n\n    if (this.actionType === ActionType.deselectMultipleObjects) {\n      this.selectMultipleObjects(event.clientX, event.clientY, false);\n    }\n\n    const selectBBox = getSelectBBox();\n\n    if (this.actionType === ActionType.editSelectBBox) {\n      this.updateUIAtMove(false);\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onMove(x, y);\n      const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n      const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n      selectBBox.onMoveEdit(diffX, diffY);\n    }\n\n    if (this.actionType === ActionType.moveSelectBBox) {\n      this.moveAllSelectedObjects(event.clientX, event.clientY);\n      this.updateUIAtMove(false);\n      const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n      const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n      selectBBox.onMoveMove(diffX, diffY);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    if (this.actionType === undefined) {\n      return;\n    }\n\n    if (this.actionType === ActionType.moveCamera) {\n      this.mouseEventsIdle.onUp(event);\n      if (this.mouseDragHelper.isDragged === false) {\n        const store = getStore();\n        const action: ChangeSelectObjects = {\n          name: AppEventType.ChangeSelectObjects,\n          payload: {\n            change: store.selectedIds.map((id) => {\n              return {\n                id,\n                isSelected: false,\n              };\n            }),\n          },\n        };\n        sendEvent(action);\n      } else {\n        this.updateUIAtMove(true);\n        const store = getStore();\n        const newStore = produce(store, (draft) => {\n          const position = getTopBarPosition(\n            store.selectedIds.map((id) => {\n              return { id, objectType: store.objects[id].objectType };\n            })\n          );\n          draft.ui.selectedTopBarPosition = position;\n        });\n        setStore(newStore);\n        refreshReactState(newStore);\n      }\n      this.mouseDragHelper.onUp();\n    }\n\n    if (this.actionType === ActionType.moveObjectGroup) {\n      const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n      const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n      if (!(Math.abs(diffY) === 0 && Math.abs(diffY) === 0)) {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          const ids = this.getIdsFromGroupOrInGroup(objectId);\n          sendEvent(\n            this.getMoveObjectsAction([objectId, ...ids], diffX, diffY)\n          );\n        }\n      }\n\n      if (this.mouseDragHelper.isDragged === false) {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          if (\n            isPressedKey(\"controlleft\") ||\n            isPressedKey(\"controlright\") ||\n            isPressedKey(\"shiftleft\") ||\n            isPressedKey(\"shiftright\")\n          ) {\n            const store = getStore();\n            const clickedObjectIsLocked =\n              store.objects[objectId] !== undefined\n                ? store.objects[objectId].isLocked === true\n                : false;\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n            } else if (clickedObjectIsLocked === false) {\n              sendEvent(\n                this.getSelectionAppendAction([objectId], undefined, false)\n              );\n            }\n          } else {\n            const store = getStore();\n            if (store.selectedIds.length === 0) {\n              sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n            } else {\n              const clickedObjectIsLocked =\n                store.objects[objectId] !== undefined\n                  ? store.objects[objectId].isLocked === true\n                  : false;\n              let selectedIsLocked: any = false;\n              store.selectedIds.forEach((id) => {\n                if (store.objects[id].isLocked === true) {\n                  selectedIsLocked = true;\n                }\n              });\n              if (selectedIsLocked === true) {\n              } else if (clickedObjectIsLocked === false) {\n                sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n              }\n            }\n          }\n        }\n        logger.trace(\"MouseEventsEditorModeSelectOrMove: zaznaczam group\");\n      }\n      this.updateUIAtMove(true);\n      this.mouseDragHelper.onUp();\n    }\n\n    if (this.actionType === ActionType.moveSingleObject) {\n      const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n      const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n      if (!(Math.abs(diffY) === 0 && Math.abs(diffY) === 0)) {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          sendEvent(this.getMoveObjectsAction([objectId], diffX, diffY));\n        }\n      }\n\n      if (this.mouseDragHelper.isDragged === false) {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          if (\n            isPressedKey(\"controlleft\") ||\n            isPressedKey(\"controlright\") ||\n            isPressedKey(\"shiftleft\") ||\n            isPressedKey(\"shiftright\")\n          ) {\n            const store = getStore();\n            const clickedObjectIsLocked =\n              store.objects[objectId] !== undefined\n                ? store.objects[objectId].isLocked === true\n                : false;\n\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n              // nothing\n            } else if (clickedObjectIsLocked === false) {\n              sendEvent(\n                this.getSelectionAppendAction([objectId], undefined, true)\n              );\n            }\n          } else {\n            const store = getStore();\n            if (store.selectedIds.length === 0) {\n              sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n            } else {\n              const clickedObjectIsLocked =\n                store.objects[objectId] !== undefined\n                  ? store.objects[objectId].isLocked === true\n                  : false;\n              let selectedIsLocked: any = false;\n              store.selectedIds.forEach((id) => {\n                if (store.objects[id].isLocked === true) {\n                  selectedIsLocked = true;\n                }\n              });\n              if (selectedIsLocked === true) {\n              } else if (clickedObjectIsLocked === false) {\n                sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n              }\n            }\n          }\n        }\n        logger.trace(\n          \"MouseEventsEditorModeSelectOrMove: zaznaczam single object\"\n        );\n      }\n      this.updateUIAtMove(true);\n      this.mouseDragHelper.onUp();\n    }\n\n    if (this.actionType === ActionType.moveAllSelectedObjects) {\n      const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n      const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n      if (!(Math.abs(diffY) === 0 && Math.abs(diffY) === 0)) {\n        const store = getStore();\n        sendEvent(this.getMoveObjectsAction(store.selectedIds, diffX, diffY));\n      }\n\n      if (\n        isPressedKey(\"controlleft\") ||\n        isPressedKey(\"controlright\") ||\n        isPressedKey(\"shiftleft\") ||\n        isPressedKey(\"shiftright\")\n      ) {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        sendEvent(this.getSelectionAppendAction([objectId], undefined, false));\n      }\n\n      this.mouseDragHelper.onUp();\n      getSelectBBox().onUpMove();\n      this.updateUIAtMove(true);\n    }\n\n    if (this.actionType === ActionType.selectMultipleObjects) {\n      if (isPressedKey(\"shiftleft\") || isPressedKey(\"shiftright\")) {\n        if (this.mouseDragHelper.isDragged === false) {\n          this.intersects = this.getActiveObjectsFromIntersect(\n            event.clientX,\n            event.clientY\n          );\n          const firstClickedActiveObject = this.intersects.length > 0;\n          if (firstClickedActiveObject) {\n            const clicked = this.intersects[0].object.userData as AppObject;\n            const clickedId = clicked.id;\n            if (clickedId !== undefined) {\n              const store = getStore();\n              const clickedObjectIsLocked =\n                store.objects[clickedId] !== undefined\n                  ? store.objects[clickedId].isLocked === true\n                  : false;\n              let selectedIsLocked: any = false;\n              store.selectedIds.forEach((id) => {\n                if (store.objects[id].isLocked === true) {\n                  selectedIsLocked = true;\n                }\n              });\n              if (selectedIsLocked === true) {\n              } else if (clickedObjectIsLocked === false) {\n                sendEvent(\n                  this.getSelectionAppendAction([clickedId], undefined, false)\n                );\n              }\n            }\n          }\n          this.intersects = [];\n        } else {\n          if (this.boundingClientRect !== undefined) {\n            const { top, left, width, height } = this.boundingClientRect;\n            this.selectionBox.endPoint.set(\n              ((event.clientX - left) / width) * 2 - 1,\n              -((event.clientY - top) / height) * 2 + 1,\n              1\n            );\n            const store = getStore();\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n            } else {\n              const allSelectedIds = this.selectionBox.selectIds();\n\n              sendEvent(\n                this.getSelectionAppendAction(allSelectedIds, true, false)\n              );\n            }\n          }\n        }\n      }\n      this.mouseDragHelper.onUp();\n      this.mouseSelectionHelper.onUp();\n    }\n\n    if (this.actionType === ActionType.deselectMultipleObjects) {\n      if (isPressedKey(\"altleft\") || isPressedKey(\"altright\")) {\n        if (this.mouseDragHelper.isDragged === false) {\n          this.intersects = this.getActiveObjectsFromIntersect(\n            event.clientX,\n            event.clientY\n          );\n          const firstClickedActiveObject = this.intersects.length > 0;\n          if (firstClickedActiveObject) {\n            const clicked = this.intersects[0].object.userData as AppObject;\n            const clickedId = clicked.id;\n            if (clickedId !== undefined) {\n              sendEvent(\n                this.getSelectionAppendAction([clickedId], false, true)\n              );\n            }\n          }\n\n          this.intersects = [];\n        } else {\n          if (this.boundingClientRect !== undefined) {\n            const { top, left, width, height } = this.boundingClientRect;\n            this.selectionBox.endPoint.set(\n              ((event.clientX - left) / width) * 2 - 1,\n              -((event.clientY - top) / height) * 2 + 1,\n              1\n            );\n            const allSelectedIds = this.selectionBox.selectIds();\n\n            sendEvent(\n              this.getSelectionAppendAction(allSelectedIds, false, false)\n            );\n          }\n        }\n      }\n\n      this.mouseDragHelper.onUp();\n      this.mouseSelectionHelper.onUp();\n    }\n\n    const selectBBox = getSelectBBox();\n\n    if (this.actionType === ActionType.editSelectBBox) {\n      this.updateUIAtMove(true);\n      // @TODO\n      selectBBox.onUpEdit();\n    }\n\n    if (this.actionType === ActionType.moveSelectBBox) {\n      this.updateUIAtMove(true);\n      const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n      const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n      const store = getStore();\n      sendEvent(this.getMoveObjectsAction(store.selectedIds, diffX, diffY));\n      selectBBox.onUpMove();\n      this.mouseDragHelper.onUp();\n      if (Math.abs(diffX) < 0.5 && Math.abs(diffY) < 0.5) {\n        const store = getStore();\n        const action: ChangeSelectObjects = {\n          name: AppEventType.ChangeSelectObjects,\n          payload: {\n            change: store.selectedIds.map((id) => {\n              return {\n                id,\n                isSelected: false,\n              };\n            }),\n          },\n        };\n        sendEvent(action);\n      }\n    }\n\n    this.actionType = undefined;\n  }\n\n  getMoveObjectsAction(objectIds: string[], diffX: number, diffY: number) {\n    const store = getStore();\n\n    const ids: string[] = [];\n    const change: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n    objectIds.forEach((objectId) => {\n      const childrenIds = this.getIdsFromGroupOrInGroup(objectId);\n      if (store.objects[objectId] !== undefined) {\n        if (ids.includes(objectId) === false) {\n          ids.push(objectId);\n          change.push({\n            id: objectId,\n            properties: {\n              position: {\n                x: store.objects[objectId].position.x + diffX,\n                y: store.objects[objectId].position.y + diffY,\n                z: store.objects[objectId].position.z,\n              },\n            },\n          });\n        }\n      }\n      childrenIds.forEach((id) => {\n        if (store.objects[id] !== undefined) {\n          if (ids.includes(objectId) === false) {\n            ids.push(objectId);\n            change.push({\n              id: id,\n              properties: {\n                position: {\n                  x: store.objects[id].position.x + diffX,\n                  y: store.objects[id].position.y + diffY,\n                  z: store.objects[objectId].position.z,\n                },\n              },\n            });\n          }\n        }\n      });\n    });\n\n    const action: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: change,\n      },\n    };\n\n    return action;\n  }\n\n  getSelectionForSingleObjectIdAction(id: string) {\n    const store = getStore();\n    const change: ChangeSelectObjects[\"payload\"][\"change\"] = [];\n\n    store.selectedIds.forEach((_id) => {\n      const childrenIds = this.getIdsFromGroupOrInGroup(_id);\n      change.push({\n        id: _id,\n        isSelected: false,\n      });\n      childrenIds.forEach((__id) => {\n        change.push({\n          id: __id,\n          isSelected: false,\n        });\n      });\n    });\n\n    change.push({\n      id,\n      isSelected: true,\n    });\n    const childrenIds = this.getIdsFromGroupOrInGroup(id);\n    childrenIds.forEach((_id) => {\n      change.push({\n        id: _id,\n        isSelected: true,\n      });\n    });\n\n    const action: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change,\n      },\n    };\n\n    return action;\n  }\n\n  getSelectionAppendAction(\n    objectIds: string[],\n    _newIsSelected?: boolean,\n    _addWithIsLock?: boolean\n  ) {\n    const store = getStore();\n    const change: ChangeSelectObjects[\"payload\"][\"change\"] = [];\n    const addWithIsLock = _addWithIsLock ?? false;\n\n    objectIds.forEach((objectId) => {\n      const isLocked =\n        store.objects[objectId] !== undefined &&\n        store.objects[objectId].isLocked === true;\n      if (\n        addWithIsLock === true ||\n        (addWithIsLock === false && isLocked === false)\n      ) {\n        const isSelected = store.selectedIds.includes(objectId) === true;\n        const newSelected =\n          _newIsSelected === undefined ? !isSelected : _newIsSelected;\n        const childrenIds = this.getIdsFromGroupOrInGroup(objectId);\n        change.push({\n          id: objectId,\n          isSelected: newSelected,\n        });\n        childrenIds.forEach((id) => {\n          change.push({\n            id: id,\n            isSelected: newSelected,\n          });\n        });\n      }\n    });\n\n    const action: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change,\n      },\n    };\n\n    return action;\n  }\n\n  selectMultipleObjects(\n    clientX: number,\n    clientY: number,\n    shouldBeSelected: boolean\n  ) {\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { top, left } = this.boundingClientRect;\n    const screenX = clientX - left;\n    const screenY = clientY - top;\n    this.mouseSelectionHelper.onMove(screenX, screenY);\n  }\n\n  moveSingleObject(clientX: number, clientY: number) {\n    const store = getStore();\n\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n    const clicked = this.intersects[0].object.userData;\n    const objectId = clicked.id;\n    if (objectId === undefined) {\n      logger.warn(\"objectId not found in clicked item\", clicked);\n      return;\n    }\n    // const obj = store.objects[objectId];\n    // if (obj === undefined) {\n    //   logger.warn(\"objectId not found in app store\", objectId, clicked);\n    //   return;\n    // }\n\n    // const name = getStateObjectFromObjectId(objectId, obj.objectType);\n    // if (name === undefined) {\n    //   return;\n    // }\n    // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n    const object = appThree.objects.get(objectId);\n    if (object === undefined) {\n      logger.warn(\"object not found in app state for id\", objectId, clicked);\n      return;\n    }\n\n    if (store.objects[objectId].objectType === ObjectTypes.Region) {\n      const region = store.objects[objectId] as Region;\n      if (region.snapBeadsToCell === true) {\n        if (region.childrenGridIds.length > 0) {\n          region.childrenGridIds.forEach((id) => {\n            if (id !== undefined && store.objects[id] !== undefined) {\n              const bead = store.objects[id];\n              if (bead === undefined) {\n                logger.warn(\"object not exists in app\", objectId);\n                return;\n              }\n              // const name = getStateObjectFromObjectId(bead.id, bead.objectType);\n              // if (name === undefined) {\n              //   return;\n              // }\n              // const child_object = appThree.scene.getObjectByUserDataProperty(\n              //   \"name\",\n              //   name\n              // );\n              const child_object = appThree.objects.get(bead.id);\n              if (child_object === undefined) {\n                logger.warn(\n                  \"object not found in app scene for id\",\n                  objectId\n                  // name\n                );\n                return;\n              }\n              child_object.position.x = store.objects[id].position.x + diffX;\n              child_object.position.y = store.objects[id].position.y + diffY;\n            }\n          });\n        }\n      }\n    }\n\n    object.position.x = store.objects[objectId].position.x + diffX;\n    object.position.y = store.objects[objectId].position.y + diffY;\n\n    this.updateUIAtMove(false);\n  }\n\n  moveObjectGroup(clientX: number, clientY: number) {\n    const store = getStore();\n\n    const { x, y } = screenToWorld(clientX, clientY);\n\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n    const clicked = this.intersects[0].object.userData;\n    let objectId = clicked.id;\n    if (objectId === undefined) {\n      logger.warn(\"objectId not found in clicked item\", clicked);\n      return;\n    }\n    let group = store.objects[objectId];\n    if (group === undefined) {\n      logger.warn(\"objectId not found in app store\", objectId);\n      return;\n    }\n\n    const isGroupChild =\n      group[groupIdKey] !== undefined && group[groupIdKey].length > 0;\n\n    if (isGroupChild) {\n      objectId = group[groupIdKey];\n      group = store.objects[objectId];\n    }\n\n    // const name = getStateObjectFromObjectId(objectId, group.objectType);\n    // if (name === undefined) {\n    //   return;\n    // }\n    // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    const object = appThree.objects.get(objectId);\n    if (object === undefined) {\n      logger.warn(\"object not found in app state for id\", objectId);\n      return;\n    }\n    object.position.x = store.objects[objectId].position.x + diffX;\n    object.position.y = store.objects[objectId].position.y + diffY;\n\n    (group as Group).childrenIds.forEach((id) => {\n      const children: AppObject | undefined = store.objects[id];\n      if (children === undefined) {\n        logger.warn(\"object not exists in app\", id);\n        return;\n      }\n      // const name = getStateObjectFromObjectId(children.id, children.objectType);\n      // if (name === undefined) {\n      //   return;\n      // }\n      // const child = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      const child = appThree.objects.get(children.id);\n      if (child === undefined) {\n        logger.warn(\"object not found in app scene for id\", id);\n        return;\n      }\n      child.position.x = store.objects[id].position.x + diffX;\n      child.position.y = store.objects[id].position.y + diffY;\n    });\n\n    this.updateUIAtMove(false);\n  }\n\n  moveAllSelectedObjects(clientX: number, clientY: number) {\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n    const store = getStore();\n\n    store.selectedIds.forEach((objectId) => {\n      const obj: AppObject | undefined = store.objects[objectId];\n      if (obj === undefined) {\n        logger.warn(\"object not exists in app\", objectId);\n        return;\n      }\n      const object = appThree.objects.get(objectId);\n      if (object === undefined) {\n        logger.warn(\"object not found in app scene for id\", objectId);\n        return;\n      }\n\n      if (store.objects[objectId].objectType === ObjectTypes.Region) {\n        const region = store.objects[objectId] as Region;\n        if (region.snapBeadsToCell === true) {\n          if (region.childrenGridIds.length > 0) {\n            region.childrenGridIds.forEach((id) => {\n              if (id !== undefined && store.objects[id] !== undefined) {\n                const bead = store.objects[id];\n                if (bead === undefined) {\n                  logger.warn(\"object not exists in app\", objectId);\n                  return;\n                }\n                const child_object = appThree.objects.get(objectId);\n                if (child_object === undefined) {\n                  logger.warn(\n                    \"object not found in app scene for id\",\n                    objectId\n                  );\n                  return;\n                }\n                child_object.position.x = store.objects[id].position.x + diffX;\n                child_object.position.y = store.objects[id].position.y + diffY;\n              }\n            });\n          }\n        }\n      }\n\n      object.position.x = store.objects[objectId].position.x + diffX;\n      object.position.y = store.objects[objectId].position.y + diffY;\n    });\n\n    const selectBBox = getSelectBBox();\n    selectBBox.onMoveMove(diffX, diffY);\n\n    this.updateUIAtMove(false);\n  }\n\n  updateUIAtMove(visible: boolean) {\n    if (visible === false) {\n      this.hideTopBar();\n    } else {\n      this.showTopBar();\n    }\n  }\n\n  hideTopBar() {\n    const selector = \".selected-objects-top-bar\";\n    const topBar = document.querySelector(selector) as HTMLDivElement | null;\n    if (topBar === null) {\n      return;\n    }\n    topBar.style.display = \"none\";\n  }\n\n  showTopBar() {\n    const selector = \".selected-objects-top-bar\";\n    const topBar = document.querySelector(selector) as HTMLDivElement | null;\n    if (topBar === null) {\n      return;\n    }\n    topBar.style.display = \"block\";\n  }\n}\n","import * as THREE from \"three\";\nimport { clone, cloneDeep } from \"lodash\";\nimport {\n  EditBBoxChildSuffix,\n  getThreeNameFromEditBBoxId,\n} from \"../editorObjects/EditBBox\";\nimport { appThree } from \"./renderThreejs\";\nimport { getStore } from \"../controllers/store\";\nimport { logger } from \"../logger\";\nimport { ObjectTypes } from \"../editorObjects/Editor\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { AppEventType, ChangeObject } from \"../controllers/AppEventType\";\n\nlet selectBBoxInstance: SelectBBox | null = null;\n\nexport type SelectBBoxRect = {\n  id: string;\n  position: THREE.Vector3;\n  width: number;\n  height: number;\n  depth: number;\n  rotation: THREE.Vector3;\n};\n\nexport const getSelectBBox = (): SelectBBox => {\n  if (selectBBoxInstance == null) {\n    selectBBoxInstance = new SelectBBox();\n  }\n  return selectBBoxInstance;\n};\n\nexport const clearSelectBBox = () => {\n  selectBBoxInstance = null;\n};\n\nexport class SelectBBox {\n  rotation: THREE.Vector3;\n  // /**@deprecated */\n  // position: THREE.Vector3;\n  // width: number;\n  // height: number;\n  // depth: number;\n  rectangles: SelectBBoxRect[];\n  internalId: string;\n  dotBrName: string;\n  dotBlName: string;\n  dotTrName: string;\n  dotTlName: string;\n  selectBboxGroupName: string;\n  selectBBoxBgName: string;\n  boxGeometry: THREE.BoxGeometry;\n  obj: THREE.Mesh<THREE.BoxGeometry, THREE.Material | THREE.Material[]>;\n  layerRoot: number;\n  layerChild: number;\n  worldPosEnd: { x: number; y: number };\n  startPos: number[][];\n  dotsStartPositions: {\n    tl: { isSelected: boolean; position?: THREE.Vector3 };\n    tr: { isSelected: boolean; position?: THREE.Vector3 };\n    bl: { isSelected: boolean; position?: THREE.Vector3 };\n    br: { isSelected: boolean; position?: THREE.Vector3 };\n  };\n  selectBBoxBgStartPosition: THREE.Vector3;\n  selectBBoxBgStartScale: THREE.Vector3;\n  selectBBoxBgEndPosition: THREE.Vector3;\n  selectBBoxBgEndScale: THREE.Vector3;\n\n  constructor() {\n    this.dotsStartPositions = {\n      tl: { isSelected: false, position: undefined },\n      tr: { isSelected: false, position: undefined },\n      bl: { isSelected: false, position: undefined },\n      br: { isSelected: false, position: undefined },\n    };\n    this.worldPosEnd = { x: 0, y: 0 };\n    this.startPos = [];\n    this.layerRoot = 2;\n    this.layerChild = 3;\n    this.rotation = new THREE.Vector3(0, 0, 0);\n    // this.position = new THREE.Vector3(0, 0, 0);\n    // this.width = 0;\n    // this.height = 0;\n    // this.depth = 0;\n    this.rectangles = [];\n    this.internalId = THREE.MathUtils.generateUUID();\n    this.selectBboxGroupName = getThreeNameFromEditBBoxId(this.internalId);\n    this.selectBBoxBgName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.BG\n    );\n    this.dotBrName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n    );\n    this.dotBlName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n    );\n    this.dotTrName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n    );\n    this.dotTlName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n    );\n    this.boxGeometry = new THREE.BoxGeometry(1, 1, 1);\n    this.obj = new THREE.Mesh(this.boxGeometry);\n    this.selectBBoxBgStartPosition = new THREE.Vector3();\n    this.selectBBoxBgStartScale = new THREE.Vector3();\n    this.selectBBoxBgEndPosition = new THREE.Vector3();\n    this.selectBBoxBgEndScale = new THREE.Vector3();\n  }\n\n  isChild(intersects: THREE.Intersection[]) {\n    let result = false;\n    intersects.forEach((i) => {\n      if (i.object.userData.name === this.selectBBoxBgName) {\n        result = true;\n      }\n    });\n    return result;\n  }\n  onDownMove() {\n    const selectBBoxBgName = appThree.objects.get(this.selectBBoxBgName);\n    if (selectBBoxBgName) {\n      this.startPos.push([\n        selectBBoxBgName.position.x,\n        selectBBoxBgName.position.y,\n      ]);\n    }\n    const dotBlName = appThree.objects.get(this.dotBlName);\n    if (dotBlName) {\n      this.startPos.push([dotBlName.position.x, dotBlName.position.y]);\n    }\n    const dotBrName = appThree.objects.get(this.dotBrName);\n    if (dotBrName) {\n      this.startPos.push([dotBrName.position.x, dotBrName.position.y]);\n    }\n    const dotTlName = appThree.objects.get(this.dotTlName);\n    if (dotTlName) {\n      this.startPos.push([dotTlName.position.x, dotTlName.position.y]);\n    }\n    const dotTrName = appThree.objects.get(this.dotTrName);\n    if (dotTrName) {\n      this.startPos.push([dotTrName.position.x, dotTrName.position.y]);\n    }\n  }\n\n  onMoveMove(diffX: number, diffY: number) {\n    const selectBBoxGoup = appThree.objects.get(this.selectBBoxBgName);\n    if (selectBBoxGoup) {\n      selectBBoxGoup.position.x = this.startPos[0][0] + diffX;\n      selectBBoxGoup.position.y = this.startPos[0][1] + diffY;\n    }\n    const dotBlName = appThree.objects.get(this.dotBlName);\n    if (dotBlName) {\n      dotBlName.position.x = this.startPos[1][0] + diffX;\n      dotBlName.position.y = this.startPos[1][1] + diffY;\n    }\n    const dotBrName = appThree.objects.get(this.dotBrName);\n    if (dotBrName) {\n      dotBrName.position.x = this.startPos[2][0] + diffX;\n      dotBrName.position.y = this.startPos[2][1] + diffY;\n    }\n    const dotTlName = appThree.objects.get(this.dotTlName);\n    if (dotTlName) {\n      dotTlName.position.x = this.startPos[3][0] + diffX;\n      dotTlName.position.y = this.startPos[3][1] + diffY;\n    }\n    const dotTrName = appThree.objects.get(this.dotTrName);\n    if (dotTrName) {\n      dotTrName.position.x = this.startPos[4][0] + diffX;\n      dotTrName.position.y = this.startPos[4][1] + diffY;\n    }\n  }\n\n  onUpMove() {\n    this.startPos = [];\n    this.syncRectsWithStore();\n  }\n\n  isHandle(intersects: THREE.Intersection[]) {\n    let result = false;\n    intersects.forEach((i) => {\n      if (i.object.layers.mask === 8) {\n        result = true;\n      }\n    });\n    return result;\n  }\n  onDownEdit(intersects: THREE.Intersection[]) {\n    this.dotsStartPositions = {\n      tl: { isSelected: false, position: undefined },\n      tr: { isSelected: false, position: undefined },\n      bl: { isSelected: false, position: undefined },\n      br: { isSelected: false, position: undefined },\n    };\n    // debugger;\n    for (let i = 0; i < intersects.length; i++) {\n      const item = intersects[i];\n      if (item.object.layers.mask === 8) {\n        if (item.object.parent !== null) {\n          const name = item.object.parent.userData.name;\n          if (name !== undefined) {\n            if (name === this.dotBlName) {\n              this.dotsStartPositions.bl.isSelected = true;\n              break;\n            }\n            if (name === this.dotBrName) {\n              this.dotsStartPositions.br.isSelected = true;\n              break;\n            }\n            if (name === this.dotTlName) {\n              this.dotsStartPositions.tl.isSelected = true;\n              break;\n            }\n            if (name === this.dotTrName) {\n              this.dotsStartPositions.tr.isSelected = true;\n              break;\n            }\n          }\n        }\n      }\n    }\n    const dotTl = appThree.objects.get(this.dotTlName);\n    if (dotTl) {\n      this.dotsStartPositions.tl.position = cloneDeep(dotTl.position);\n    }\n    const dotTr = appThree.objects.get(this.dotTrName);\n    if (dotTr) {\n      this.dotsStartPositions.tr.position = cloneDeep(dotTr.position);\n    }\n    const dotBl = appThree.objects.get(this.dotBlName);\n    if (dotBl) {\n      this.dotsStartPositions.bl.position = cloneDeep(dotBl.position);\n    }\n    const dotBr = appThree.objects.get(this.dotBrName);\n    if (dotBr) {\n      this.dotsStartPositions.br.position = cloneDeep(dotBr.position);\n    }\n    const selectBBoxBg = appThree.objects.get(this.selectBBoxBgName);\n    if (selectBBoxBg) {\n      this.selectBBoxBgStartPosition = clone(selectBBoxBg.position);\n      this.selectBBoxBgStartScale = clone(selectBBoxBg.scale);\n    }\n  }\n\n  onMoveEdit(diffX: number, diffY: number) {\n    if (this.dotsStartPositions.tl.isSelected === true) {\n      const dotTl = appThree.objects.get(this.dotTlName);\n      if (dotTl && this.dotsStartPositions.tl.position) {\n        dotTl.position.x = this.dotsStartPositions.tl.position.x + diffX;\n        dotTl.position.y = this.dotsStartPositions.tl.position.y + diffY;\n      }\n      const dotTr = appThree.objects.get(this.dotTrName);\n      if (dotTr && this.dotsStartPositions.tr.position) {\n        dotTr.position.y = this.dotsStartPositions.tr.position.y + diffY;\n      }\n      const dotBl = appThree.objects.get(this.dotBlName);\n      if (dotBl && this.dotsStartPositions.bl.position) {\n        dotBl.position.x = this.dotsStartPositions.bl.position.x + diffX;\n      }\n    }\n\n    if (this.dotsStartPositions.tr.isSelected === true) {\n      const dotTr = appThree.objects.get(this.dotTrName);\n      if (dotTr && this.dotsStartPositions.tr.position) {\n        dotTr.position.x = this.dotsStartPositions.tr.position.x + diffX;\n        dotTr.position.y = this.dotsStartPositions.tr.position.y + diffY;\n      }\n      const dotTl = appThree.objects.get(this.dotTlName);\n      if (dotTl && this.dotsStartPositions.tl.position) {\n        dotTl.position.y = this.dotsStartPositions.tl.position.y + diffY;\n      }\n      const dotBr = appThree.objects.get(this.dotBrName);\n      if (dotBr && this.dotsStartPositions.br.position) {\n        dotBr.position.x = this.dotsStartPositions.br.position.x + diffX;\n      }\n    }\n\n    if (this.dotsStartPositions.bl.isSelected === true) {\n      const dotBl = appThree.objects.get(this.dotBlName);\n      if (dotBl && this.dotsStartPositions.bl.position) {\n        dotBl.position.x = this.dotsStartPositions.bl.position.x + diffX;\n        dotBl.position.y = this.dotsStartPositions.bl.position.y + diffY;\n      }\n      const dotBr = appThree.objects.get(this.dotBrName);\n      if (dotBr && this.dotsStartPositions.br.position) {\n        dotBr.position.y = this.dotsStartPositions.br.position.y + diffY;\n      }\n      const dotTl = appThree.objects.get(this.dotTlName);\n      if (dotTl && this.dotsStartPositions.tl.position) {\n        dotTl.position.x = this.dotsStartPositions.tl.position.x + diffX;\n      }\n    }\n\n    if (this.dotsStartPositions.br.isSelected === true) {\n      const dotBr = appThree.objects.get(this.dotBrName);\n      if (dotBr && this.dotsStartPositions.br.position) {\n        dotBr.position.x = this.dotsStartPositions.br.position.x + diffX;\n        dotBr.position.y = this.dotsStartPositions.br.position.y + diffY;\n      }\n      const dotBl = appThree.objects.get(this.dotBlName);\n      if (dotBl && this.dotsStartPositions.bl.position) {\n        dotBl.position.y = this.dotsStartPositions.bl.position.y + diffY;\n      }\n      const dotTr = appThree.objects.get(this.dotTrName);\n      if (dotTr && this.dotsStartPositions.tr.position) {\n        dotTr.position.x = this.dotsStartPositions.tr.position.x + diffX;\n      }\n    }\n\n    const selectBBoxBg = appThree.objects.get(this.selectBBoxBgName);\n    const dotTl = appThree.objects.get(this.dotTlName);\n    const dotBr = appThree.objects.get(this.dotBrName);\n\n    if (selectBBoxBg && dotTl && dotBr) {\n      // debugger;\n      const bbox = new THREE.Box3();\n      bbox.min.x = dotTl.position.x;\n      bbox.min.y = dotTl.position.y;\n      bbox.max.x = dotBr.position.x;\n      bbox.max.y = dotBr.position.y;\n      bbox.max.z = selectBBoxBg.position.z;\n      bbox.min.z = selectBBoxBg.position.z;\n      this.updateHandleAndBg(bbox);\n\n      this.selectBBoxBgEndPosition = clone(selectBBoxBg.position);\n      this.selectBBoxBgEndScale = clone(selectBBoxBg.scale);\n\n      const store = getStore();\n      if (store.selectedIds.length === 1) {\n        store.selectedIds.forEach((id) => {\n          const obj = store.objects[id];\n          if (obj === undefined) {\n            return;\n          }\n          if (obj.objectType !== ObjectTypes.Region) {\n            return;\n          }\n          const object = appThree.objects.get(id);\n          if (object === undefined) {\n            return;\n          }\n\n          const diffPosition = this.selectBBoxBgEndPosition\n            .clone()\n            .sub(this.selectBBoxBgStartPosition);\n\n          const diffScale = this.selectBBoxBgEndScale\n            .clone()\n            .divide(this.selectBBoxBgStartScale);\n\n          const currPosition = new THREE.Vector3(\n            obj.position.x,\n            obj.position.y,\n            obj.position.z\n          );\n          const newPosition = currPosition.add(diffPosition);\n          object.position.set(newPosition.x, newPosition.y, newPosition.z);\n\n          const currScale = new THREE.Vector3(obj.width, obj.height, obj.depth);\n          const newScale = currScale.clone().multiply(diffScale);\n          object.scale.set(newScale.x, newScale.y, currScale.z);\n        });\n      } else {\n        store.selectedIds.forEach((id) => {\n          const obj = store.objects[id];\n          if (obj === undefined) {\n            return;\n          }\n          if (obj.objectType !== ObjectTypes.Region) {\n            return;\n          }\n          const object = appThree.objects.get(id);\n          if (object === undefined) {\n            return;\n          }\n\n          const ratio = this.selectBBoxBgEndScale\n            .clone()\n            .divide(this.selectBBoxBgStartScale);\n\n          const diffPosition = this.selectBBoxBgEndPosition\n            .clone()\n            .sub(this.selectBBoxBgStartPosition);\n\n          // const diffRatio = diffScale.clone();\n          // this.selectBBoxBgEndPosition\n          //   .clone()\n          //   .divide(this.selectBBoxBgStartPosition);\n\n          const currPosition = new THREE.Vector3(\n            obj.position.x,\n            obj.position.y,\n            obj.position.z\n          );\n          const objectOffset = this.selectBBoxBgEndPosition\n            .clone()\n            .sub(currPosition);\n\n          // const proportionObjToWholeBbox = objectOffset\n          //   .clone()\n          //   .divide(this.selectBBoxBgStartScale.clone());\n\n          // const aaa = diffPosition\n          //   .clone()\n          //   .sub(\n          //     diffPosition\n          //       .clone()\n          //       .multiply(proportionObjToWholeBbox.clone().divideScalar(2))\n          //   );\n\n          // x2 = x1 * ratioScale + diffX;\n\n          const currScale = new THREE.Vector3(obj.width, obj.height, obj.depth);\n          // const aaaa = currPosition.clone().multiply(ratio.clone());\n          // const newPosition = aaaa.clone().add(diffPosition).sub(currPosition.clone());\n          const newPosition = currPosition\n            .add(diffPosition.clone())\n            .add(objectOffset.clone().multiply(ratio.clone()));\n\n          // console.log(\n          //   \"info:\",\n          //   obj.id,\n          //   \"x1\",\n          //   currPosition.clone().x,\n          //   \"ratio:\",\n          //   ratio.clone().x,\n          //   \"diffX:\",\n          //   diffPosition.clone().x,\n          //   \"x2:\",\n          //   newPosition.clone().x\n          // );\n\n          // const newPosition = newCurrPosition.add(\n          //   diffScale.clone().multiply(currScale.clone().divideScalar(2))\n          // );\n\n          // debugger;\n          // const newPosition = currPosition.add(aaa);\n          object.position.set(newPosition.x, newPosition.y, currPosition.z);\n\n          const newScale = currScale.clone().multiply(ratio);\n          object.scale.set(newScale.x, newScale.y, currScale.z);\n        });\n      }\n    }\n  }\n\n  onUpEdit() {\n    this.dotsStartPositions = {\n      tl: { isSelected: false, position: undefined },\n      tr: { isSelected: false, position: undefined },\n      bl: { isSelected: false, position: undefined },\n      br: { isSelected: false, position: undefined },\n    };\n\n    const store = getStore();\n    if (store.selectedIds.length === 1) {\n      const changes: ChangeObject[] = [];\n      const diffPosition = this.selectBBoxBgEndPosition\n        .clone()\n        .sub(this.selectBBoxBgStartPosition);\n\n      const diffScale = this.selectBBoxBgEndScale\n        .clone()\n        .divide(this.selectBBoxBgStartScale);\n      store.selectedIds.forEach((id) => {\n        const obj = store.objects[id];\n        if (obj === undefined) {\n          return;\n        }\n        if (obj.objectType !== ObjectTypes.Region) {\n          return;\n        }\n        const object = appThree.objects.get(id);\n        if (object === undefined) {\n          return;\n        }\n\n        const currPosition = new THREE.Vector3(\n          obj.position.x,\n          obj.position.y,\n          obj.position.z\n        );\n        const newPosition = currPosition.add(diffPosition);\n        const currScale = new THREE.Vector3(obj.width, obj.height, obj.depth);\n        const newScale = currScale.clone().multiply(diffScale);\n        changes.push({\n          id,\n          properties: {\n            position: {\n              x: newPosition.x,\n              y: newPosition.y,\n              z: newPosition.z,\n            },\n            width: newScale.x,\n            height: newScale.y,\n            depth: currScale.z,\n          },\n        });\n      });\n      sendEvent({\n        name: AppEventType.ChangeObjectsProperty,\n        payload: {\n          changes,\n        },\n      });\n    }\n  }\n\n  syncRectsWithStore() {\n    const store = getStore();\n    const rectangles: SelectBBoxRect[] = [];\n    this.rectangles.forEach(({ id }) => {\n      const object = store.objects[id];\n      if (!object) {\n        logger.warn(\"missing id\", id);\n        return;\n      }\n      rectangles.push({\n        depth: object.depth,\n        height: object.height,\n        width: object.width,\n        id: object.id,\n        position: new THREE.Vector3(\n          object.position.x,\n          object.position.y,\n          object.position.z\n        ),\n        rotation: new THREE.Vector3(\n          object.rotateX,\n          object.rotateY,\n          object.rotateZ\n        ),\n      });\n    });\n    this.rectangles = rectangles;\n\n    const bbox = this.getSelectBBox();\n    // this.position = new THREE.Vector3();\n    // bbox.getCenter(this.position);\n    // this.width = bbox.max.x - bbox.min.x;\n    // this.height = bbox.max.y - bbox.min.y;\n    // this.depth = bbox.max.z - bbox.min.z;\n    this.updateHandleAndBg(bbox);\n  }\n\n  updateRect(rectangle: SelectBBoxRect, isSelected: boolean) {\n    let toDelete = false;\n    let toCreate = false;\n    const rectIndex = this.rectangles.findIndex((e) => e.id === rectangle.id);\n    const isRectExists = rectIndex !== -1;\n\n    if (isSelected === true && isRectExists === false) {\n      toCreate = true;\n    } else if (isSelected === false && isRectExists === true) {\n      toDelete = true;\n    }\n\n    if (toCreate === false && toDelete === false) {\n      return;\n    }\n\n    if (toDelete) {\n      this.rectangles.splice(rectIndex, 1);\n    }\n\n    if (toCreate) {\n      this.rectangles.push(cloneDeep(rectangle));\n    }\n\n    if (this.rectangles.length === 1) {\n      this.rotation = this.rectangles[0].rotation;\n    } else {\n      this.rotation = new THREE.Vector3(0, 0, 0);\n    }\n\n    const bbox = this.getSelectBBox();\n    // this.position = new THREE.Vector3();\n    // bbox.getCenter(this.position);\n    // this.width = bbox.max.x - bbox.min.x;\n    // this.height = bbox.max.y - bbox.min.y;\n    // this.depth = bbox.max.z - bbox.min.z;\n\n    if (this.rectangles.length === 0) {\n      this.deleteHandleAndBg();\n    } else {\n      const object = appThree.objects.get(this.selectBboxGroupName);\n\n      if (object === undefined) {\n        this.createHandleAndBg(bbox);\n      }\n      this.updateHandleAndBg(bbox);\n    }\n  }\n\n  deleteHandleAndBg() {\n    const object = appThree.objects.get(this.selectBboxGroupName);\n    if (object !== undefined) {\n      if (object.parent !== undefined && object.parent !== null) {\n        object.parent.remove(object);\n      }\n    }\n    appThree.objects.delete(this.dotBlName);\n    appThree.objects.delete(this.dotBrName);\n    appThree.objects.delete(this.dotTlName);\n    appThree.objects.delete(this.dotTrName);\n    appThree.objects.delete(this.selectBBoxBgName);\n    appThree.objects.delete(this.selectBboxGroupName);\n  }\n\n  createHandleAndBg(bbox: THREE.Box3) {\n    // create bbox\n    const selectBBoxGoup = new THREE.Group();\n    selectBBoxGoup.userData.name = this.selectBboxGroupName;\n\n    const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n    const material = new THREE.MeshBasicMaterial({\n      color: \"rgb(0,0,0)\",\n      side: THREE.FrontSide,\n      opacity: 0.2,\n      transparent: true,\n    });\n    const selectBBoxBg = new THREE.Mesh(geometry, material);\n    selectBBoxBg.userData.name = this.selectBBoxBgName;\n\n    const selectBBoxLines = this.getRectLine(-0.5, 0.5, -0.5, 0.5);\n    selectBBoxBg.add(selectBBoxLines);\n\n    const resizeDots = this.getResizeDots(bbox);\n\n    resizeDots.forEach((dot) => {\n      appThree.objects.set(dot.userData.name, dot);\n      selectBBoxGoup.attach(dot);\n    });\n\n    selectBBoxGoup.add(selectBBoxBg);\n    appThree.scene.add(selectBBoxGoup);\n\n    appThree.objects.set(this.selectBboxGroupName, selectBBoxGoup);\n    appThree.objects.set(this.selectBBoxBgName, selectBBoxBg);\n  }\n\n  getRectLine(x1: number, x2: number, y1: number, y2: number) {\n    const rectShape = new THREE.Shape()\n      .moveTo(x1, y1)\n      .lineTo(x2, y1)\n      .lineTo(x2, y2)\n      .lineTo(x1, y2);\n\n    rectShape.autoClose = true;\n\n    const _rectLinesPoints = rectShape.getPoints();\n    const _rectLinesGeometryPoints = new THREE.BufferGeometry().setFromPoints(\n      _rectLinesPoints\n    );\n    const _rectLinesMaterial = new THREE.MeshBasicMaterial({\n      color: 0x0040f0,\n      opacity: 1,\n      transparent: true,\n    });\n    return new THREE.Line(_rectLinesGeometryPoints, _rectLinesMaterial);\n  }\n\n  getRectBBox(rect: SelectBBoxRect) {\n    const { width, height, depth, position, rotation } = rect;\n    const bbox = new THREE.Box3();\n    this.obj.scale.set(width, height, depth);\n    this.obj.position.set(position.x, position.y, position.z);\n    this.obj.rotation.set(\n      THREE.MathUtils.DEG2RAD * rotation.x,\n      THREE.MathUtils.DEG2RAD * rotation.y,\n      THREE.MathUtils.DEG2RAD * rotation.z\n    );\n    bbox.expandByObject(this.obj);\n    return bbox;\n  }\n\n  getSelectBBox() {\n    const bbox = new THREE.Box3();\n    this.rectangles.forEach((rect) => {\n      const { width, height, depth, position, rotation } = rect;\n      this.obj.scale.set(width, height, depth);\n      this.obj.position.set(position.x, position.y, position.z);\n      this.obj.rotation.set(\n        THREE.MathUtils.DEG2RAD * rotation.x,\n        THREE.MathUtils.DEG2RAD * rotation.y,\n        THREE.MathUtils.DEG2RAD * rotation.z\n      );\n      bbox.expandByObject(this.obj);\n    });\n    return bbox;\n  }\n\n  updateHandleAndBg(bbox: THREE.Box3) {\n    const position = new THREE.Vector3();\n    bbox.getCenter(position);\n    const width = bbox.max.x - bbox.min.x;\n    const height = bbox.max.y - bbox.min.y;\n    const depth = bbox.max.z - bbox.min.z;\n\n    const selectBBoxBg = appThree.objects.get(this.selectBBoxBgName);\n    if (selectBBoxBg !== undefined) {\n      // const bbox = this.getSelectBBox();\n      selectBBoxBg.position.set(position.x, position.y, position.z);\n      selectBBoxBg.scale.set(width, height, depth);\n      // _bg.rotation.set(this.rotation.x, this.rotation.y, this.rotation.z);\n\n      selectBBoxBg.clear();\n\n      const selectBBoxLines = this.getRectLine(-0.5, 0.5, -0.5, 0.5);\n      selectBBoxBg.add(selectBBoxLines);\n\n      if (this.rectangles.length >= 2) {\n        const position = new THREE.Vector3();\n        bbox.getCenter(position);\n        const width = bbox.max.x - bbox.min.x;\n        const height = bbox.max.y - bbox.min.y;\n        this.rectangles.forEach((rect) => {\n          const _bbox = this.getRectBBox(rect);\n          const _pos = new THREE.Vector3();\n          _bbox.getCenter(_pos);\n          const centerX = (_pos.x - position.x) / width;\n          const centerY = (_pos.y - position.y) / height;\n          const _w = (_bbox.max.x - _bbox.min.x) / width;\n          const _h = (_bbox.max.y - _bbox.min.y) / height;\n          const x1 = centerX - _w / 2;\n          const x2 = centerX + _w / 2;\n          const y1 = centerY - _h / 2;\n          const y2 = centerY + _h / 2;\n          const _line = this.getRectLine(x1, x2, y1, y2);\n          // debugger;\n          selectBBoxBg.add(_line);\n        });\n      }\n    }\n\n    const _dotTl = appThree.objects.get(this.dotTlName);\n    if (_dotTl !== undefined) {\n      const v1 = new THREE.Vector3(\n        bbox.min.x - position.x,\n        bbox.min.y - position.y,\n        bbox.min.z - position.z\n      );\n      _dotTl.position.set(\n        position.x + v1.x,\n        position.y + v1.y,\n        position.z + v1.z\n      );\n    }\n\n    const _dotTr = appThree.objects.get(this.dotTrName);\n    if (_dotTr !== undefined) {\n      const v1 = new THREE.Vector3(\n        bbox.max.x - position.x,\n        bbox.min.y - position.y,\n        bbox.min.z - position.z\n      );\n      _dotTr.position.set(\n        position.x + v1.x,\n        position.y + v1.y,\n        position.z + v1.z\n      );\n    }\n\n    const _dotBl = appThree.objects.get(this.dotBlName);\n    if (_dotBl !== undefined) {\n      const v1 = new THREE.Vector3(\n        bbox.min.x - position.x,\n        bbox.max.y - position.y,\n        bbox.min.z - position.z\n      );\n      _dotBl.position.set(\n        position.x + v1.x,\n        position.y + v1.y,\n        position.z + v1.z\n      );\n    }\n\n    const _dotBr = appThree.objects.get(this.dotBrName);\n    if (_dotBr !== undefined) {\n      const v1 = new THREE.Vector3(\n        bbox.max.x - position.x,\n        bbox.max.y - position.y,\n        bbox.min.z - position.z\n      );\n      _dotBr.position.set(\n        position.x + v1.x,\n        position.y + v1.y,\n        position.z + v1.z\n      );\n    }\n  }\n\n  getResizeDots = (bbox: THREE.Box3) => {\n    const objects: THREE.Object3D[] = [];\n    const sceneScale = appThree.camera.userData[\"sceneScale\"];\n    const dotSize = sceneScale; //(rect10x10FromScreenToWorld.w ?? 10) * 0.5;\n\n    const __material = new THREE.MeshLambertMaterial({ color: \"#ffffff\" });\n    const __boxGeometry = new THREE.CircleGeometry(1, 16);\n    const _whiteDot = new THREE.Mesh(__boxGeometry, __material);\n    _whiteDot.scale.x = 10;\n    _whiteDot.scale.y = 10;\n    _whiteDot.renderOrder = 2;\n    _whiteDot.layers.set(this.layerChild);\n\n    const ___material = new THREE.MeshLambertMaterial({ color: \"#a9a9a9\" });\n    const ___boxGeometry = new THREE.CircleGeometry(1, 16);\n    const _grayDot = new THREE.Mesh(___boxGeometry, ___material);\n    _grayDot.scale.x = 12;\n    _grayDot.scale.y = 12;\n    _grayDot.renderOrder = 1;\n    _grayDot.layers.set(this.layerChild);\n\n    const _baseDot = new THREE.Group();\n    _baseDot.layers.set(this.layerRoot);\n    _baseDot.attach(_grayDot);\n    _baseDot.attach(_whiteDot);\n\n    const _dotTL = _baseDot.clone();\n    _dotTL.position.x = bbox.min.x;\n    _dotTL.position.y = bbox.min.y;\n    _dotTL.scale.x = dotSize;\n    _dotTL.scale.y = dotSize;\n    _dotTL.userData.name = this.dotTlName;\n    objects.push(_dotTL);\n\n    const _dotTR = _baseDot.clone();\n    _dotTR.position.x = bbox.max.x;\n    _dotTR.position.y = bbox.min.y;\n    _dotTR.scale.x = dotSize;\n    _dotTR.scale.y = dotSize;\n    _dotTR.userData.name = this.dotTrName;\n    objects.push(_dotTR);\n\n    const _dotBL = _baseDot.clone();\n    _dotBL.position.x = bbox.min.x;\n    _dotBL.position.y = bbox.max.y;\n    _dotBL.scale.x = dotSize;\n    _dotBL.scale.y = dotSize;\n    _dotBL.userData.name = this.dotBlName;\n    objects.push(_dotBL);\n\n    const _dotBR = _baseDot.clone();\n    _dotBR.position.x = bbox.max.x;\n    _dotBR.position.y = bbox.max.y;\n    _dotBR.scale.x = dotSize;\n    _dotBR.scale.y = dotSize;\n    _dotBR.userData.name = this.dotBrName;\n    objects.push(_dotBR);\n    return objects;\n  };\n}\n","import * as THREE from \"three\";\nimport { Frustum, Vector3 } from \"three\";\nimport { ObjectTypes } from \"../../editorObjects/Editor\";\n\nexport class SelectionFilter {\n  frustum: THREE.Frustum = new Frustum();\n  center: THREE.Vector3 = new Vector3();\n\n  tmpPoint: THREE.Vector3 = new Vector3();\n\n  vecNear: THREE.Vector3 = new Vector3();\n  vecTopLeft: THREE.Vector3 = new Vector3();\n  vecTopRight: THREE.Vector3 = new Vector3();\n  vecDownRight: THREE.Vector3 = new Vector3();\n  vecDownLeft: THREE.Vector3 = new Vector3();\n  vecFarTopLeft: THREE.Vector3 = new Vector3();\n  vecFarTopRight: THREE.Vector3 = new Vector3();\n  vecFarDownRight: THREE.Vector3 = new Vector3();\n  vecFarDownLeft: THREE.Vector3 = new Vector3();\n\n  vectemp1: THREE.Vector3 = new Vector3();\n  vectemp2: THREE.Vector3 = new Vector3();\n  vectemp3: THREE.Vector3 = new Vector3();\n  startPoint: THREE.Vector3;\n  endPoint: THREE.Vector3;\n  collection: any[];\n  deep: number = Number.MAX_VALUE;\n  camera?: THREE.OrthographicCamera;\n  scene?: THREE.Scene;\n  selectedIds: string[];\n\n  constructor() {\n    this.startPoint = new Vector3();\n    this.endPoint = new Vector3();\n    this.collection = [];\n    this.selectedIds = [];\n  }\n\n  setCamera(camera: THREE.OrthographicCamera) {\n    this.camera = camera;\n  }\n\n  setScene(scene: THREE.Scene) {\n    this.scene = scene;\n  }\n\n  select(startPoint?: THREE.Vector3, endPoint?: THREE.Vector3) {\n    this.startPoint = startPoint ?? this.startPoint;\n    this.endPoint = endPoint ?? this.endPoint;\n    this.collection = [];\n\n    if (!this.scene) {\n      return this.collection;\n    }\n\n    this.selectedIds = [];\n    this.updateFrustum(this.startPoint, this.endPoint);\n\n    // @TODO: NEED pixel-perfect match\n    this.searchChildInFrustum(this.frustum, this.scene);\n    this.selectedIds = [];\n    // this.scene.children.forEach((child) => {\n    //   child.traverse((object) => {\n    //     if (object instanceof THREE.Mesh && object.name.length > 0) {\n    //       // @TODO: NEED pixel-perfect match\n    //       const bbox = new THREE.Box3().setFromObject(object);\n    //       if (this.frustum.intersectsBox(bbox)) {\n    //         this.collection.push(object);\n    //       }\n    //       if (this.frustum.intersectsObject(object)) {\n    //         this.collection.push(object);\n    //       }\n    //     }\n    //   });\n    // });\n    return this.collection;\n  }\n\n  selectIds(startPoint?: THREE.Vector3, endPoint?: THREE.Vector3) {\n    this.startPoint = startPoint ?? this.startPoint;\n    this.endPoint = endPoint ?? this.endPoint;\n    this.collection = [];\n\n    if (!this.scene) {\n      return this.collection;\n    }\n\n    this.selectedIds = [];\n    this.updateFrustum(this.startPoint, this.endPoint);\n    this.searchChildInFrustum(this.frustum, this.scene);\n    return this.selectedIds\n  }\n\n\n  updateFrustum(_startPoint?: THREE.Vector3, _endPoint?: THREE.Vector3) {\n    if (!this.camera) {\n      return;\n    }\n    const startPoint = _startPoint ?? this.startPoint;\n    const endPoint = _endPoint ?? this.endPoint;\n\n    // Avoid invalid frustum\n    if (startPoint.x === endPoint.x) {\n      endPoint.x += Number.EPSILON;\n    }\n\n    if (startPoint.y === endPoint.y) {\n      endPoint.y += Number.EPSILON;\n    }\n\n    this.camera.updateProjectionMatrix();\n    this.camera.updateMatrixWorld();\n\n    if (this.camera.isOrthographicCamera) {\n      var left = Math.min(startPoint.x, endPoint.x);\n      var top = Math.max(startPoint.y, endPoint.y);\n      var right = Math.max(startPoint.x, endPoint.x);\n      var down = Math.min(startPoint.y, endPoint.y);\n\n      this.vecTopLeft.set(left, top, -1);\n      this.vecTopRight.set(right, top, -1);\n      this.vecDownRight.set(right, down, -1);\n      this.vecDownLeft.set(left, down, -1);\n\n      this.vecFarTopLeft.set(left, top, 1);\n      this.vecFarTopRight.set(right, top, 1);\n      this.vecFarDownRight.set(right, down, 1);\n      this.vecFarDownLeft.set(left, down, 1);\n\n      this.vecTopLeft.unproject(this.camera);\n      this.vecTopRight.unproject(this.camera);\n      this.vecDownRight.unproject(this.camera);\n      this.vecDownLeft.unproject(this.camera);\n\n      this.vecFarTopLeft.unproject(this.camera);\n      this.vecFarTopRight.unproject(this.camera);\n      this.vecFarDownRight.unproject(this.camera);\n      this.vecFarDownLeft.unproject(this.camera);\n\n      var planes = this.frustum.planes;\n\n      planes[0].setFromCoplanarPoints(\n        this.vecTopLeft,\n        this.vecFarTopLeft,\n        this.vecFarTopRight\n      );\n      planes[1].setFromCoplanarPoints(\n        this.vecTopRight,\n        this.vecFarTopRight,\n        this.vecFarDownRight\n      );\n      planes[2].setFromCoplanarPoints(\n        this.vecFarDownRight,\n        this.vecFarDownLeft,\n        this.vecDownLeft\n      );\n      planes[3].setFromCoplanarPoints(\n        this.vecFarDownLeft,\n        this.vecFarTopLeft,\n        this.vecTopLeft\n      );\n      planes[4].setFromCoplanarPoints(\n        this.vecTopRight,\n        this.vecDownRight,\n        this.vecDownLeft\n      );\n      planes[5].setFromCoplanarPoints(\n        this.vecFarDownRight,\n        this.vecFarTopRight,\n        this.vecFarTopLeft\n      );\n      planes[5].normal.multiplyScalar(-1);\n    } else {\n      console.error(\"THREE.SelectionBox: Unsupported camera type.\");\n    }\n  }\n\n  // @INFO: Not used, there is need for pixel perfect raycasting\n  searchChildInFrustum(frustum: THREE.Frustum, object: any) {\n    if (object.isMesh || object.isLine || object.isPoints) {\n      if (object.material !== undefined) {\n        // if (object.geometry.boundingSphere === null) {\n        //   object.geometry.computeBoundingSphere();\n        // }\n        const data = object.userData;\n        const id = data?.id ?? undefined;\n        if (id !== undefined) {\n          // const isLocked = data?.isLocked ?? false;\n          const objectType = data?.objectType ?? undefined;\n          const isAppObject =\n            objectType === ObjectTypes.Bead ||\n            objectType === ObjectTypes.Region ||\n            objectType === ObjectTypes.Group ||\n            objectType === ObjectTypes.PreviewProject3D;\n\n          if (isAppObject === true) {\n            const bbox = new THREE.Box3().setFromObject(object);\n            if (frustum.intersectsBox(bbox)) {\n              if (this.selectedIds.includes(id) === false) {\n                this.collection.push(object);\n                this.selectedIds.push(id);\n              }\n            }\n          }\n        }\n\n        // this.center.copy(\n        //   object.geometry.boundingSphere.center\n        // );\n        // this.center.applyMatrix4(object.matrixWorld);\n        // if (frustum.containsPoint(this.center)) {\n        //   this.collection.push(object);\n        // }\n      }\n    }\n\n    if (object.children && object.children.length > 0) {\n      for (var x = 0; x < object.children.length; x++) {\n        this.searchChildInFrustum(frustum, object.children[x]);\n      }\n    }\n  }\n}\n","import { appThree } from \"../../renderThreejs\";\nimport * as THREE from \"three\";\nimport { getStore } from \"../../../controllers/store\";\n\nexport class MouseEventsIdle {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n\n  constructor() {\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n\n    if (this.boundingClientRect === undefined) {\n      return [];\n    }\n\n    this.isCameraGrabed = true;\n\n    this.boundingClientRect = appThree.el.getBoundingClientRect();\n    const { top, left } = this.boundingClientRect;\n\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n\n    this.startDragMousePosition.x = screenX;\n    this.startDragMousePosition.y = screenY;\n\n    this.startDragCamera.x = appThree.camera.position.x;\n    this.startDragCamera.y = appThree.camera.position.y;\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n\n    if (this.isCameraGrabed === true) {\n      const store = getStore();\n\n      const { top, left } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n      const sceneScale = store.ui.zoomScale;\n\n      const screenMouseDiffX = this.startDragMousePosition.x - screenX;\n      const screenMouseDiffY = this.startDragMousePosition.y - screenY;\n\n      const mouseDiffXInWorldSpace = screenMouseDiffX * sceneScale;\n      const mouseDiffYInWorldSpace = screenMouseDiffY * sceneScale;\n\n      const cameraX = this.startDragCamera.x + mouseDiffXInWorldSpace;\n      const cameraY = this.startDragCamera.y - mouseDiffYInWorldSpace;\n\n      appThree.camera.position.x = cameraX;\n      appThree.camera.position.y = cameraY;\n      appThree.camera.lookAt(cameraX, cameraY, 0);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    this.boundingClientRect = undefined;\n    if (this.isCameraGrabed === true) {\n      this.isCameraGrabed = false;\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport {\n  ChangeSelectObjects,\n  AppEventType,\n} from \"../../../controllers/AppEventType\";\nimport { getStore } from \"../../../controllers/store\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { AppObject, ObjectTypes, Region } from \"../../../editorObjects/Editor\";\nimport { logger } from \"../../../logger\";\nimport { isPressedKey } from \"../../keyboard/keyMap\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"../MouseSelectionHelper\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport { SelectionFilter } from \"../SelectionFilter\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\nimport { MouseEventsIdle } from \"./MouseEventsIdle\";\n\nenum ActionType {\n  moveCamera = \"moveCamera\",\n  selectMultipleObjects = \"selectMultipleObjects\",\n  deselectMultipleObjects = \"deselectMultipleObjects\",\n}\n\nexport class MouseEventsEditorModeSelectMultiple extends MouseEventsBase {\n  actionType: ActionType | undefined;\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  selectionBox: SelectionFilter;\n  mouseSelectionHelper: MouseSelectionHelper;\n  prevEditBBox: any | undefined;\n  mouseEventsIdle: MouseEventsIdle;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n\n    this.selectionBox = new SelectionFilter();\n    this.selectionBox.setCamera(appThree.camera);\n    this.selectionBox.setScene(appThree.scene);\n\n    this.mouseEventsIdle = new MouseEventsIdle();\n    this.actionType = undefined;\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (isPressedKey(\"space\")) {\n      this.actionType = ActionType.moveCamera;\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      this.mouseEventsIdle.onDown(event);\n      logger.trace(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    if (event.altKey) {\n      this.actionType = ActionType.deselectMultipleObjects;\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      if (appThree.el !== null) {\n        this.boundingClientRect = appThree.el.getBoundingClientRect();\n      }\n      if (this.boundingClientRect === undefined) {\n        return;\n      }\n      const { top, left, width, height } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n\n      this.mouseSelectionHelper.onDown(screenX, screenY);\n\n      this.selectionBox.startPoint.set(\n        ((event.clientX - left) / width) * 2 - 1,\n        -((event.clientY - top) / height) * 2 + 1,\n        0\n      );\n      logger.trace(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    this.actionType = ActionType.selectMultipleObjects;\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { top, left, width, height } = this.boundingClientRect;\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n\n    this.mouseSelectionHelper.onDown(screenX, screenY);\n\n    this.selectionBox.startPoint.set(\n      ((event.clientX - left) / width) * 2 - 1,\n      -((event.clientY - top) / height) * 2 + 1,\n      0\n    );\n    logger.trace(\n      \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n      this.actionType\n    );\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.actionType === undefined) {\n      return;\n    }\n\n    if (this.actionType === ActionType.moveCamera) {\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onMove(x, y);\n      this.mouseEventsIdle.onMove(event);\n      this.updateUIAtMove(false);\n    }\n\n    if (this.actionType === ActionType.selectMultipleObjects) {\n      this.selectMultipleObjects(event.clientX, event.clientY, true);\n    }\n\n    if (this.actionType === ActionType.deselectMultipleObjects) {\n      this.selectMultipleObjects(event.clientX, event.clientY, false);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    if (this.actionType === ActionType.selectMultipleObjects) {\n      if (this.mouseDragHelper.isDragged === false) {\n        this.intersects = this.getActiveObjectsFromIntersect(\n          event.clientX,\n          event.clientY\n        );\n        const firstClickedActiveObject = this.intersects.length > 0;\n        if (firstClickedActiveObject) {\n          const clicked = this.intersects[0].object.userData as AppObject;\n          const clickedId = clicked.id;\n          if (clickedId !== undefined) {\n            const store = getStore();\n            const clickedObjectIsLocked =\n              store.objects[clickedId] !== undefined\n                ? store.objects[clickedId].isLocked === true\n                : false;\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n            } else if (clickedObjectIsLocked === false) {\n              sendEvent(\n                this.getSelectionAppendAction([clickedId], undefined, false)\n              );\n            }\n          }\n        }\n        this.intersects = [];\n      } else {\n        if (this.boundingClientRect !== undefined) {\n          const { top, left, width, height } = this.boundingClientRect;\n          this.selectionBox.endPoint.set(\n            ((event.clientX - left) / width) * 2 - 1,\n            -((event.clientY - top) / height) * 2 + 1,\n            1\n          );\n          const store = getStore();\n          let selectedIsLocked: any = false;\n          store.selectedIds.forEach((id) => {\n            if (store.objects[id].isLocked === true) {\n              selectedIsLocked = true;\n            }\n          });\n          if (selectedIsLocked === true) {\n          } else {\n            const allSelectedIds = this.selectionBox.selectIds();\n\n            sendEvent(\n              this.getSelectionAppendAction(allSelectedIds, true, false)\n            );\n          }\n        }\n      }\n      this.mouseDragHelper.onUp();\n      this.mouseSelectionHelper.onUp();\n    }\n\n    if (this.actionType === ActionType.deselectMultipleObjects) {\n      if (isPressedKey(\"altleft\") || isPressedKey(\"altright\")) {\n        if (this.mouseDragHelper.isDragged === false) {\n          this.intersects = this.getActiveObjectsFromIntersect(\n            event.clientX,\n            event.clientY\n          );\n          const firstClickedActiveObject = this.intersects.length > 0;\n          if (firstClickedActiveObject) {\n            const clicked = this.intersects[0].object.userData as AppObject;\n            const clickedId = clicked.id;\n            if (clickedId !== undefined) {\n              sendEvent(\n                this.getSelectionAppendAction([clickedId], false, true)\n              );\n            }\n          }\n\n          this.intersects = [];\n        } else {\n          if (this.boundingClientRect !== undefined) {\n            const { top, left, width, height } = this.boundingClientRect;\n            this.selectionBox.endPoint.set(\n              ((event.clientX - left) / width) * 2 - 1,\n              -((event.clientY - top) / height) * 2 + 1,\n              1\n            );\n            const allSelectedIds = this.selectionBox.selectIds();\n\n            sendEvent(\n              this.getSelectionAppendAction(allSelectedIds, false, false)\n            );\n          }\n        }\n      }\n\n      this.mouseDragHelper.onUp();\n      this.mouseSelectionHelper.onUp();\n    }\n  }\n\n  getSelectionAppendAction(\n    objectIds: string[],\n    _newIsSelected?: boolean,\n    _addWithIsLock?: boolean\n  ) {\n    const store = getStore();\n    const change: ChangeSelectObjects[\"payload\"][\"change\"] = [];\n    const addWithIsLock = _addWithIsLock ?? false;\n\n    objectIds.forEach((objectId) => {\n      const isLocked =\n        store.objects[objectId] !== undefined &&\n        store.objects[objectId].isLocked === true;\n      if (\n        addWithIsLock === true ||\n        (addWithIsLock === false && isLocked === false)\n      ) {\n        const isSelected = store.selectedIds.includes(objectId) === true;\n        const newSelected =\n          _newIsSelected === undefined ? !isSelected : _newIsSelected;\n        const childrenIds = this.getIdsFromGroupOrInGroup(objectId);\n        change.push({\n          id: objectId,\n          isSelected: newSelected,\n        });\n        childrenIds.forEach((id) => {\n          change.push({\n            id: id,\n            isSelected: newSelected,\n          });\n        });\n      }\n    });\n\n    const action: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change,\n      },\n    };\n\n    return action;\n  }\n\n  selectMultipleObjects(\n    clientX: number,\n    clientY: number,\n    shouldBeSelected: boolean\n  ) {\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { top, left } = this.boundingClientRect;\n    const screenX = clientX - left;\n    const screenY = clientY - top;\n    this.mouseSelectionHelper.onMove(screenX, screenY);\n  }\n\n  moveSingleObject(clientX: number, clientY: number) {\n    const store = getStore();\n\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n    const clicked = this.intersects[0].object.userData;\n    const objectId = clicked.id;\n    if (objectId === undefined) {\n      logger.warn(\"objectId not found in clicked item\", clicked);\n      return;\n    }\n\n    const object = appThree.objects.get(objectId);\n    if (object === undefined) {\n      logger.warn(\"object not found in app state for id\", objectId, clicked);\n      return;\n    }\n\n    if (store.objects[objectId].objectType === ObjectTypes.Region) {\n      const region = store.objects[objectId] as Region;\n      if (region.snapBeadsToCell === true) {\n        if (region.childrenGridIds.length > 0) {\n          region.childrenGridIds.forEach((id) => {\n            if (id !== undefined && store.objects[id] !== undefined) {\n              const bead = store.objects[id];\n              if (bead === undefined) {\n                logger.warn(\"object not exists in app\", objectId);\n                return;\n              }\n              const child_object = appThree.objects.get(bead.id);\n              if (child_object === undefined) {\n                logger.warn(\"object not found in app scene for id\", objectId);\n                return;\n              }\n              child_object.position.x = store.objects[id].position.x + diffX;\n              child_object.position.y = store.objects[id].position.y + diffY;\n            }\n          });\n        }\n      }\n    }\n\n    object.position.x = store.objects[objectId].position.x + diffX;\n    object.position.y = store.objects[objectId].position.y + diffY;\n\n    this.updateUIAtMove(false);\n  }\n\n  updateUIAtMove(visible: boolean) {\n    if (visible === false) {\n      this.hideTopBar();\n    } else {\n      this.showTopBar();\n    }\n  }\n\n  hideTopBar() {\n    const selector = \".selected-objects-top-bar\";\n    const topBar = document.querySelector(selector) as HTMLDivElement | null;\n    if (topBar === null) {\n      return;\n    }\n    topBar.style.display = \"none\";\n  }\n\n  showTopBar() {\n    const selector = \".selected-objects-top-bar\";\n    const topBar = document.querySelector(selector) as HTMLDivElement | null;\n    if (topBar === null) {\n      return;\n    }\n    topBar.style.display = \"block\";\n  }\n}\n","import * as THREE from \"three\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeIdle extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    this.isCameraGrabed = true;\n\n    if (appThree.el === null) {\n      return;\n    }\n\n    this.boundingClientRect = appThree.el.getBoundingClientRect();\n    const { top, left } = this.boundingClientRect;\n\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n\n    this.startDragMousePosition.x = screenX;\n    this.startDragMousePosition.y = screenY;\n\n    this.startDragCamera.x = appThree.camera.position.x;\n    this.startDragCamera.y = appThree.camera.position.y;\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n\n    if (this.isCameraGrabed === true) {\n      const { getState } = appStore;\n      const state = getState();\n\n      const { top, left } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n      const sceneScale = state.ui.zoomScale;\n\n      const screenMouseDiffX = this.startDragMousePosition.x - screenX;\n      const screenMouseDiffY = this.startDragMousePosition.y - screenY;\n\n      const mouseDiffXInWorldSpace = screenMouseDiffX * sceneScale;\n      const mouseDiffYInWorldSpace = screenMouseDiffY * sceneScale;\n\n      const cameraX = this.startDragCamera.x + mouseDiffXInWorldSpace;\n      const cameraY = this.startDragCamera.y - mouseDiffYInWorldSpace;\n\n      appThree.camera.position.x = cameraX;\n      appThree.camera.position.y = cameraY;\n      appThree.camera.lookAt(cameraX, cameraY, 0);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    this.boundingClientRect = undefined;\n    if (this.isCameraGrabed === true) {\n      this.isCameraGrabed = false;\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport { AppEventType } from \"../../../controllers/AppEventType\";\nimport { getStore } from \"../../../controllers/store\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { Bead, ObjectTypes } from \"../../../editorObjects/Editor\";\nimport { paintBead } from \"../../eventEmitterHandlers\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"./../MouseDragHelper\";\nimport { screenToWorld } from \"./../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModePaint extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  touchedIds: string[];\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n    this.touchedIds = [];\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    this.touchedIds = [];\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n    this.touchBead(event.clientX, event.clientY);\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.mouseDragHelper.isDragStarted === true) {\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onMove(x, y);\n      this.touchBead(event.clientX, event.clientY);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    if (this.touchedIds.length > 0) {\n      const color = \"pink\";\n      sendEvent({\n        name: AppEventType.ChangeObjectsProperty,\n        payload: {\n          changes: this.touchedIds.map((id) => {\n            return {\n              id,\n              properties: {\n                color,\n              },\n            };\n          }),\n        },\n      });\n    }\n    this.mouseDragHelper.onUp();\n  }\n\n  touchBead(clientX: number, clientY: number) {\n    if (this.boundingClientRect !== undefined) {\n      const { width, height, top, left } = this.boundingClientRect;\n\n      this.mouse.x = ((clientX - left) / width) * 2 - 1;\n      this.mouse.y = -((clientY - top) / height) * 2 + 1;\n\n      this.raycaster.setFromCamera(this.mouse, appThree.camera);\n\n      const intersects = this.raycaster.intersectObjects(\n        appThree.scene.children,\n        true\n      );\n\n      if (intersects.length > 0) {\n        const store = getStore();\n        const beadsIds: Set<string> = new Set<string>();\n        intersects.forEach((obj) => {\n          const id = obj.object.userData?.id ?? undefined;\n          if (\n            id !== undefined &&\n            store.objects[id] !== undefined &&\n            store.objects[id].objectType === ObjectTypes.Bead &&\n            beadsIds.has(id) === false\n          ) {\n            beadsIds.add(id);\n          }\n        });\n\n        const ids = Array.from(beadsIds);\n\n        if (ids.length > 0) {\n          const color = \"pink\";\n          ids.forEach((id) => {\n            this.touchedIds.push(id);\n\n            if (store.objects[id] !== undefined) {\n              paintBead(store.objects[id] as Bead, store.selectedIds, color);\n            }\n          });\n        }\n      }\n    }\n  }\n}\n","import { EditorMode } from \"../../editorObjects/Editor\";\nimport { appThree } from \"../renderThreejs\";\nimport { MouseEventsEditorModeAddBead } from \"./mouseEventEditorMode/MouseEventsEditorModeAddBead\";\nimport { MouseEventsEditorModeAddRegion } from \"./mouseEventEditorMode/MouseEventsEditorModeAddRegion\";\nimport { MouseEventsEditorModeDelete } from \"./mouseEventEditorMode/MouseEventsEditorModeDelete\";\nimport { MouseEventsEditorModeSelectOrMove } from \"./mouseEventEditorMode/MouseEventsEditorModeSelectOrMove\";\nimport { MouseEventsEditorModeIdle } from \"./mouseEventEditorMode/MouseEventsEditorModeIdle\";\nimport { MouseEventsEditorModePaint } from \"./mouseEventEditorMode/MouseEventsEditorModePaint\";\nimport { MouseEventsEditorModeSelectMultiple } from \"./mouseEventEditorMode/MouseEventsEditorModeSelectMultiple\";\nimport { getStore } from \"../../controllers/store\";\nimport {\n  AppEventType,\n  ChangeUiSettingsZoom,\n} from \"../../controllers/AppEventType\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport { setMousePositionAtWindow } from \"./mouseScreenPosition\";\nimport { logger } from \"../../logger\";\n\nlet moudeEditorModeIdle,\n  moudeEditorModeSelectOrMove,\n  moudeEditorModePaint,\n  moudeEditorModeDelete,\n  moudeEditorModeAddRegion,\n  moudeEditorModeAddBead,\n  moudeEditorModeSelectMultiple;\n\nexport const initMouseListeners = () => {\n  logger.log(\"initMouseListeners... bind\")\n  window.addEventListener(\"resize\", onWindowResize, false);\n\n  appThree.el.addEventListener(\"pointerdown\", onPointerDown, false);\n  appThree.el.addEventListener(\"pointermove\", onPointerMove, false);\n  appThree.el.addEventListener(\"pointerup\", onPointerUp, false);\n  appThree.el.addEventListener(\"mouseout\", onPointerOut, false);\n  appThree.el.addEventListener(\"wheel\", onWheel, false);\n\n  moudeEditorModeIdle = new MouseEventsEditorModeIdle();\n  moudeEditorModeSelectOrMove = new MouseEventsEditorModeSelectOrMove();\n  moudeEditorModePaint = new MouseEventsEditorModePaint();\n  moudeEditorModeDelete = new MouseEventsEditorModeDelete();\n  moudeEditorModeAddRegion = new MouseEventsEditorModeAddRegion();\n  moudeEditorModeAddBead = new MouseEventsEditorModeAddBead();\n  moudeEditorModeSelectMultiple = new MouseEventsEditorModeSelectMultiple();\n};\n\nfunction onWheel(event) {\n  event.preventDefault();\n  if (appThree.el === null) {\n    return;\n  }\n\n  const store = getStore();\n  // const { width, height, top, left } = appThree.el.getBoundingClientRect();\n\n  // const screenX = event.clientX - left;\n  // const screenY = event.clientY - top;\n\n  // const cameraX = appThree.camera.position.x;\n  // const cameraY = appThree.camera.position.y;\n\n  // const mouseXInWorldBefore = (screenX - width / 2) * store.ui.zoomScale;\n  // const mouseYInWorldBefore = -1 * (screenY - height / 2) * store.ui.zoomScale;\n\n  // const zoomChange = store.ui.zoomScale >= 0.35 ? 0.02 * 5 : 0.01;\n  // const zoomMax = 100;\n  // const zoomMin = 0.0125;\n  // let sceneScale = 1;\n  // sceneScale = store.ui.zoomScale + Math.sign(event.deltaY) * zoomChange;\n  // sceneScale = Math.min(Math.max(zoomMin, sceneScale), zoomMax);\n\n  // const mouseXInWorldAfter = (screenX - width / 2) * sceneScale;\n  // const mouseYInWorldAfter = -1 * (screenY - height / 2) * sceneScale;\n\n  // appThree.camera.left = (width * sceneScale) / -2;\n  // appThree.camera.right = (width * sceneScale) / 2;\n  // appThree.camera.top = (height * sceneScale) / 2;\n  // appThree.camera.bottom = (height * sceneScale) / -2;\n  // appThree.camera.updateProjectionMatrix();\n\n  // const diffX = mouseXInWorldBefore - mouseXInWorldAfter;\n  // const diffY = mouseYInWorldBefore - mouseYInWorldAfter;\n\n  // appThree.camera.position.x = cameraX + diffX;\n  // appThree.camera.position.y = cameraY + diffY;\n  // appThree.camera.lookAt(\n  //   appThree.camera.position.x,\n  //   appThree.camera.position.y,\n  //   0\n  // );\n\n  // const rect10x10FromScreenToWorld = getRect10x10FromScreenToWorld();\n  // appThree.camera.userData = { sceneScale, rect10x10FromScreenToWorld };\n\n  const updateUiEvent: ChangeUiSettingsZoom = {\n    name: AppEventType.ChangeUiSettingsZoom,\n    payload: {\n      zoomType: \"zoomByScroll\",\n      useAnimation: false,\n      clientX: event.clientX,\n      clientY: event.clientY,\n      scrollDelta: event.deltaY,\n    },\n  };\n  sendEvent(updateUiEvent);\n\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onWheel(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onWheel(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onWheel(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onWheel(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onWheel(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onWheel(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onWheel(event);\n  }\n}\n\nfunction onWindowResize(event) {\n  if (appThree.el !== null) {\n    const { width, height } = appThree.el.getBoundingClientRect();\n    appThree.camera.left = width / -2;\n    appThree.camera.right = width / 2;\n    appThree.camera.top = height / 2;\n    appThree.camera.bottom = height / -2;\n    appThree.camera.updateProjectionMatrix();\n    appThree.renderer.setSize(width, height);\n  }\n\n  const store = getStore();\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onResize(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onResize(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onResize(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onResize(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onResize(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onResize(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onResize(event);\n  }\n}\n\nfunction onPointerDown(event: PointerEvent) {\n  const store = getStore();\n\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onDown(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onDown(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onDown(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onDown(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onDown(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onDown(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onDown(event);\n  }\n}\n\nfunction onPointerUp(event: MouseEvent) {\n  const store = getStore();\n  if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onUp(event);\n  } else if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onUp(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onUp(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onUp(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onUp(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onUp(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onUp(event);\n  }\n}\n\nfunction onPointerOut(event: MouseEvent) {\n  setMousePositionAtWindow(undefined, undefined);\n  onPointerUp(event);\n}\n\nfunction onPointerMove(event: MouseEvent) {\n  setMousePositionAtWindow(event.clientX, event.clientY);\n\n  const store = getStore();\n\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onMove(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onMove(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onMove(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onMove(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onMove(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onMove(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onMove(event);\n  }\n}\n","import * as THREE from \"three\";\n\nlet mousePosition: undefined | THREE.Vector2 = undefined;\nexport const getMousePositionAtWindow = () => {\n  return mousePosition;\n};\nexport const setMousePositionAtWindow = (clientX?: number, clientY?: number) => {\n  if (!clientX || !clientY) {\n    mousePosition = undefined;\n  } else {\n    const newPos = new THREE.Vector2();\n    newPos.x = clientX;\n    newPos.y = clientY;\n    mousePosition = newPos;\n  }\n//   console.log(\"new mouse position\", mousePosition);\n};\n","import { appThree } from \"../renderThreejs\";\nimport { screenToWorld } from \"./screenToWorld\";\n\nexport const getRect10x10FromScreenToWorld = () => {\n  const viewportOffset = appThree.el.getBoundingClientRect();\n  const w = 10;\n  const h = 10;\n  const x1 = viewportOffset.left;\n  const x2 = viewportOffset.left + w;\n  const y1 = viewportOffset.top;\n  const y2 = viewportOffset.top + h;\n  const pos1 = screenToWorld(x1, y1);\n  const pos2 = screenToWorld(x2, y2);\n  const maxX = Math.max(pos1.x, pos2.x);\n  const minX = Math.min(pos1.x, pos2.x);\n  const minY = Math.min(pos1.y, pos2.y);\n  const maxY = Math.max(pos1.y, pos2.y);\n  const rect10x10FromScreenToWorld = {\n    min: {\n      x: minX,\n      y: minY,\n    },\n    max: {\n      x: maxX,\n      y: maxY,\n    },\n    w: maxX - minX,\n    h: maxY - minY,\n  };\n  return rect10x10FromScreenToWorld;\n};\n","import { times } from \"lodash\";\nimport {\n  AddObjects,\n  RemoveObjects,\n  ChangeSelectObjects,\n  ChangeObjectsProperty,\n  ClipboardCut,\n  ClipboardPaste,\n  AddMultipleBeads,\n  ChangeSelectedObjectsAlignment,\n  DuplicateObjects,\n  GroupObjects,\n  UngroupObjects,\n} from \"./AppEventType\";\nimport { SimpleHistoryEvent } from \"./store\";\nimport { sendEvent } from \"./storeController\";\n\nexport interface HistoryEvent<D, R, U> {\n  do: D;\n  redo: R;\n  undo: U;\n  createdAt: string;\n}\nexport interface AddObjectsHistory\n  extends HistoryEvent<AddObjects, AddObjects, RemoveObjects> {}\n\nexport interface DuplicateObjectsHistory\n  extends HistoryEvent<DuplicateObjects, DuplicateObjects, RemoveObjects> {}\n\nexport interface RemoveObjectsHistory\n  extends HistoryEvent<RemoveObjects, RemoveObjects, AddObjects> {}\nexport interface ChangeSelectObjectsHistory\n  extends HistoryEvent<\n    ChangeSelectObjects,\n    ChangeSelectObjects,\n    ChangeSelectObjects\n  > {}\nexport interface ChangeObjectsPropertyHistory\n  extends HistoryEvent<\n    ChangeObjectsProperty,\n    ChangeObjectsProperty,\n    ChangeObjectsProperty\n  > {}\nexport interface ClipboardCutHistory\n  extends HistoryEvent<ClipboardCut, ClipboardCut, ClipboardPaste> {}\nexport interface ClipboardPasteHistory\n  extends HistoryEvent<ClipboardPaste, ClipboardPaste, RemoveObjects> {}\nexport interface AddMultipleBeadsHistory\n  extends HistoryEvent<AddMultipleBeads, AddObjects, RemoveObjects> {}\nexport interface ChangeSelectedObjectsAlignmentHistory\n  extends HistoryEvent<\n    ChangeSelectedObjectsAlignment,\n    ChangeSelectedObjectsAlignment,\n    ChangeObjectsProperty\n  > {}\nexport interface GroupObjectsHistory\n  extends HistoryEvent<GroupObjects, GroupObjects, UngroupObjects> {}\nexport interface UngroupObjectsHistory\n  extends HistoryEvent<UngroupObjects, UngroupObjects, GroupObjects> {}\n\nexport type AppHistoryEvents =\n  | AddObjectsHistory\n  | RemoveObjectsHistory\n  | ChangeSelectObjectsHistory\n  | ChangeObjectsPropertyHistory\n  | ClipboardCutHistory\n  | ClipboardPasteHistory\n  | AddMultipleBeadsHistory\n  | ChangeSelectedObjectsAlignmentHistory\n  | DuplicateObjectsHistory\n  | GroupObjectsHistory\n  | UngroupObjectsHistory;\n\nexport class AppHistory {\n  events: AppHistoryEvents[] = [];\n  index: number = 0;\n  maxHistoryRecords: number = 100;\n  push(arg: AppHistoryEvents): void {\n    const len = this.events.length;\n    if (len !== this.index) {\n      this.events.splice(this.index, len - this.index);\n    }\n    this.events.push(arg);\n    this.index += 1;\n    if (this.events.length > this.maxHistoryRecords) {\n      const diff = this.events.length - this.maxHistoryRecords;\n      this.events.splice(0, diff);\n      this.index = this.index - diff;\n    }\n  }\n  front(): AppHistoryEvents | undefined {\n    const event = this.events[this.index];\n    this.index += 1;\n    if (this.index > this.events.length) {\n      this.index = this.events.length;\n    }\n    return event;\n  }\n  back(): AppHistoryEvents | undefined {\n    const event = this.events[this.index - 1];\n    this.index -= 1;\n    if (this.index <= 0) {\n      this.index = 0;\n    }\n    return event;\n  }\n  getSimpleHistoryEvents() {\n    return this.events.map((e, i) => {\n      return {\n        name: e.do.name,\n        isActive: i < this.index,\n        createdAt: e.createdAt,\n      } as SimpleHistoryEvent;\n    });\n  }\n  canRedo() {\n    return this.index !== this.events.length;\n  }\n  canUndo() {\n    return this.index > 0;\n  }\n}\n\nexport const undoHistory = () => {\n  const history = getHistory();\n  const lastEvent = history.back();\n  if (lastEvent !== undefined) {\n    sendEvent(lastEvent.undo, false);\n  }\n};\n\nexport const redoHistory = () => {\n  const history = getHistory();\n  const lastEvent = history.front();\n  if (lastEvent !== undefined) {\n    sendEvent(lastEvent.redo, false);\n  }\n};\n\nexport const jumpToIndexHistory = (index: number) => {\n  const history = getHistory();\n  const lastIndex = history.index - 1;\n\n  if (index === lastIndex) {\n    // do nothing\n  } else if (index >= 0 && index < lastIndex) {\n    times(lastIndex - index).forEach(() => {\n      undoHistory();\n    });\n  } else if (index < history.events.length && index > lastIndex) {\n    times(index - lastIndex).forEach(() => {\n      redoHistory();\n    });\n  }\n};\n\nlet history: AppHistory;\n\nexport const initHistory = () => {\n  history = new AppHistory();\n};\n\nexport const getHistory = () => {\n  return history;\n};\n","import * as THREE from \"three\";\nimport {\n  addLightFromUI,\n  getThreeBeadModel\n} from \"./eventEmitterHandlers\";\nimport { AppObject, Bead, ObjectTypes } from \"../editorObjects/Editor\";\nimport { AppThreeScene } from \"./renderThreejs\";\nimport { getStore } from \"../controllers/store\";\n\nexport let thumbnailsGenerator: ThumbnailsGenerator;\n\nexport const initThumbnailsGenerator = () => {\n  try {\n    const rootEl = document.createElement(\"div\");\n    rootEl.setAttribute(\"id\", \"thumbnailsGeneratorRoot\");\n    thumbnailsGenerator = new ThumbnailsGenerator(rootEl);\n    rootEl.appendChild(thumbnailsGenerator.renderer.domElement);\n    rootEl.style.display = \"none\";\n    document.body.appendChild(rootEl);\n    // loadAppModels(thumbnailsGenerator);\n  } catch (err) {\n    console.error(\"initThumbnailsGenerator err:\", err.toString());\n  }\n};\n\nclass ThumbnailsGenerator {\n  el: HTMLElement;\n  // camera: THREE.OrthographicCamera;\n  scene: AppThreeScene;\n  renderer: THREE.WebGLRenderer;\n  cache: { [key: string]: string };\n  constructor(el: HTMLElement) {\n    this.el = el;\n    this.cache = {};\n    // const { width, height } = el.getBoundingClientRect();\n\n    // this.camera = new THREE.OrthographicCamera(\n    //   width / -2,\n    //   width / 2,\n    //   height / 2,\n    //   height / -2,\n    //   0,\n    //   1000\n    // );\n\n    // this.camera.position.set(0, 0, 500);\n    // this.camera.lookAt(0, 0, 0);\n\n    this.scene = new THREE.Scene() as any;\n    this.scene.background = new THREE.Color(\"#fff\");\n\n    this.renderer = new THREE.WebGLRenderer({\n      antialias: true,\n      preserveDrawingBuffer: true,\n    });\n    // this.renderer.setSize(width, height);\n  }\n\n  getObjectThumbnail(\n    object: AppObject,\n    imgWidth: number,\n    imgHeight: number,\n    forceCache: boolean = false\n  ) {\n    const cacheData: any = {\n      imgWidth,\n      imgHeight,\n      width: object.width,\n      height: object.height,\n      depth: object.depth,\n      rotateX: object.rotateX,\n      rotateY: object.rotateY,\n      rotateZ: object.rotateZ,\n    };\n    if (object.objectType === ObjectTypes.Bead) {\n      cacheData.type = (object as Bead).type;\n      cacheData.color = (object as Bead).color;\n    }\n\n    const cacheId = JSON.stringify(cacheData);\n    if (forceCache === true || this.cache[cacheId] === undefined) {\n      const content = this.createObjectThumbnail(object, imgWidth, imgHeight);\n      if (content === undefined) {\n        return undefined;\n      } else {\n        this.cache[cacheId] = content;\n      }\n    }\n    return this.cache[cacheId];\n  }\n\n  createObjectThumbnail(\n    object: AppObject,\n    imgWidth: number,\n    imgHeight: number\n  ) {\n    try {\n      this.renderer.setSize(imgWidth, imgHeight);\n\n      this.scene.clear();\n\n      if (object.objectType !== ObjectTypes.Bead) {\n        console.warn(\"object.objectType not supported yet\");\n        return;\n      }\n\n      const object3d = getThreeBeadModel(object as Bead);\n\n      if (object3d === undefined) {\n        console.warn(\"triggerAddBeadToScene object not created in scene\");\n        return;\n      }\n\n\n      object3d.position.x = 0;\n      object3d.position.y = 0;\n\n      this.scene.add(object3d);\n\n      const bbox = new THREE.Box3();\n      bbox.expandByObject(object3d);\n\n      let width = 1;\n      let height = 1;\n      // let depth = 1;\n\n      if (bbox) {\n        width = Math.abs(bbox.max.x - bbox.min.x);\n        height = Math.abs(bbox.max.y - bbox.min.y);\n        // depth = Math.abs(bbox.max.z - bbox.min.z);\n      }\n\n      const objectRatio = width / height;\n      const ratioImage = imgWidth / imgHeight;\n      let baseWidth = 1;\n      let baseHeight = 1;\n      if (ratioImage < objectRatio) {\n        baseWidth = width;\n        baseHeight = baseWidth * ratioImage;\n      } else {\n        baseHeight = height;\n        baseWidth = baseHeight / ratioImage;\n      }\n      const halfWidth = (baseWidth + baseWidth * 0.1) / 2;\n      const halfHeight = (baseHeight + baseHeight * 0.1) / 2;\n\n      const camera = new THREE.OrthographicCamera(\n        halfWidth * -1,\n        halfWidth,\n        halfHeight,\n        halfHeight * -1,\n        0,\n        1000\n      );\n\n      camera.position.set(0, 0, 500);\n      camera.lookAt(0, 0, 0);\n\n      const store = getStore();\n      store.ui.lights.forEach((lightConfig) => {\n        addLightFromUI(lightConfig, this.scene);\n      });\n\n      this.renderer.render(this.scene, camera);\n\n      const MIME_TYPE = \"image/png\";\n      const content = this.renderer.domElement.toDataURL(MIME_TYPE);\n      //   .replace(\"image/png\", \"image/octet-stream\");\n      // const link = document.createElement(\"a\");\n      // document.body.appendChild(link);\n      // link.download = \"coralinio-preview.png\";\n      // link.href = content;\n      // link.click();\n      // document.body.removeChild(link);\n\n      this.scene.clear();\n\n      return content;\n\n      // var img = new Image();\n      // img.src = content;\n      // img.id = \"1111111111111111\"\n      // document.body.appendChild(img);\n    } catch (e) {\n      console.log(\"getObjectThumbnail error:\", e);\n      return;\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport { loadAppModels } from \"./loadModels\";\nimport { initMouseListeners } from \"./mouseListeners/mouseListeners\";\nimport { getRect10x10FromScreenToWorld } from \"./mouseListeners/getRect10x10FromScreenToWorld\";\nimport {\n  initKeybinding,\n  startListeningKeys,\n  subscribeKeys,\n} from \"./keyboard/keyMap\";\nimport {\n  initHistory,\n  redoHistory,\n  undoHistory,\n} from \"../controllers/AppHistory\";\nimport { getStore, initStore } from \"../controllers/store\";\nimport { clipboardCopy, clipboardCut, clipboardPaste } from \"./clipboard\";\nimport { initThumbnailsGenerator } from \"./thumbnailsGenerator\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { AppEventType, RemoveObjects } from \"../controllers/AppEventType\";\nimport { logger } from \"../logger\";\n\nexport let appThree: AppThree;\n\nexport const renderThreejs = (\n  el: HTMLElement | null,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  return initCanvasApp(el, canvas, context);\n};\n\nexport const unmountThreejs = (el: HTMLElement | null) => {\n  if (el !== undefined && el !== null) {\n    el.innerHTML = \"\";\n\n    if (el.classList && el.classList.contains(\"active\") === true) {\n      el.classList.remove(\"active\");\n    }\n  }\n  return new Promise((resolve) => {\n    resolve(undefined);\n  });\n};\n\nconst initCanvasApp = async (\n  el: HTMLElement | null,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  if (el === null) {\n    logger.warn(\"no html el element found\");\n    return;\n  }\n\n  if (el.classList.contains(\"active\") === false) {\n    el.classList.add(\"active\");\n  }\n\n  try {\n    initStore();\n    initHistory();\n    initKeybinding();\n    appThree = new AppThree(el, canvas, context);\n    el.appendChild(appThree.renderer.domElement);\n    await loadAppModels();\n    initMouseListeners();\n    // initEventEmitterHandlers();\n    requestAnimationFrame(threeRender);\n    startListeningKeys();\n\n    const rect10x10FromScreenToWorld = getRect10x10FromScreenToWorld();\n    appThree.camera.userData = { sceneScale: 1, rect10x10FromScreenToWorld };\n    subscribeKeys(\"keyz\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        logger.trace(\"listener:: undohistory\");\n        undoHistory();\n      }\n      return false;\n    });\n    subscribeKeys(\"keyy\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        logger.trace(\"listener:: redohistory\");\n        redoHistory();\n      }\n      return false;\n    });\n    subscribeKeys(\"keyc\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        logger.trace(\"listener:: copy\");\n        clipboardCopy();\n      }\n      return false;\n    });\n    subscribeKeys(\"keyx\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        logger.trace(\"listener:: cut\");\n        clipboardCut();\n      }\n      return false;\n    });\n    subscribeKeys(\"keyv\", (event, pressed) => {\n      if (event.ctrlKey || event.metaKey) {\n        logger.trace(\"listener:: paste\");\n        clipboardPaste();\n      }\n      return false;\n    });\n    subscribeKeys(\"delete\", (event, pressed) => {\n      logger.trace(\"listener:: delete\");\n      const store = getStore();\n      if (store.selectedIds.length > 0) {\n        const action: RemoveObjects = {\n          name: AppEventType.RemoveObjects,\n          payload: {\n            ids: store.selectedIds,\n          },\n        };\n        sendEvent(action);\n      }\n      return false;\n    });\n\n    initThumbnailsGenerator();\n  } catch (err) {\n    console.error(\"err:\", err.toString());\n  }\n  return;\n};\n\nexport interface AppThreeScene extends THREE.Scene {}\n\nclass AppThree {\n  el: HTMLElement;\n  camera: THREE.OrthographicCamera;\n  scene: AppThreeScene;\n  renderer: THREE.WebGLRenderer;\n  objects: Map<String, THREE.Object3D>;\n  constructor(\n    el: HTMLElement,\n    canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n    context: WebGLRenderingContext | undefined\n  ) {\n    this.el = el;\n    const { width, height } = el.getBoundingClientRect();\n    this.objects = new Map<String, THREE.Object3D>();\n    this.camera = new THREE.OrthographicCamera(\n      width / -2,\n      width / 2,\n      height / 2,\n      height / -2,\n      0,\n      1000\n    );\n\n    this.camera.position.set(0, 0, 500);\n    this.camera.lookAt(0, 0, 0);\n    this.camera.layers.enable(2);\n    this.camera.layers.enable(3);\n\n    this.scene = new THREE.Scene() as any;\n    this.scene.background = new THREE.Color(\"#f2f2f2\");\n\n    this.renderer = new THREE.WebGLRenderer({\n      canvas: canvas ?? undefined,\n      context: context ?? undefined,\n      antialias: true,\n      preserveDrawingBuffer: true,\n    });\n    // this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(width, height);\n  }\n}\n\nfunction threeRender() {\n  if (needToResizeRendererToDisplaySize(appThree.renderer)) {\n    appThree.camera.updateProjectionMatrix();\n  }\n\n  appThree.renderer.render(appThree.scene, appThree.camera);\n  requestAnimationFrame(threeRender);\n}\n\nfunction needToResizeRendererToDisplaySize(renderer) {\n  const canvas = renderer.domElement;\n  const width = canvas.clientWidth;\n  const height = canvas.clientHeight;\n  const needResize = canvas.width !== width || canvas.height !== height;\n  if (needResize) {\n    renderer.setSize(width, height, false);\n  }\n  return needResize;\n}\n\n// @TODO: HOW TO EXTEND THREE JS MODULE?\n// declare module \"three\" {\n//   export class Object3D {\n//     getObjectByUserDataProperty: (\n//       name: string,\n//       value: any\n//     ) => undefined | Object3D;\n//   }\n// }\n// source: https://github.com/mrdoob/three.js/blob/0fbc8afb348198e4924d9805d1d4be5869264418/src/core/Object3D.js#L85\n// source: https://discourse.threejs.org/t/getobject-by-any-custom-property-present-in-userdata-of-object/3378\n/** @deprecated */\n// (THREE.Object3D.prototype as any).getObjectByUserDataProperty = function (\n//   name: string,\n//   value: any\n// ) {\n//   if (this.userData[name] === value) return this;\n\n//   for (var i = 0, l = this.children.length; i < l; i++) {\n//     var child = this.children[i];\n//     var object = child.getObjectByUserDataProperty(name, value);\n\n//     if (object !== undefined) {\n//       return object;\n//     }\n//   }\n\n//   return undefined;\n// };\n\n// @TODO: sprawdz lerna.js\n// console.log(\"co w odpowiedzi?\", rectangle(0, 0, 2, 2, {} as any, {\n//   brickSize: 10,\n//   brickHeight: 25,\n//   brickWidth: 20,\n//   color: \"red\",\n//   filled: true,\n//   palette: [],\n// }));\n","import {\n  AppEventType,\n  ClipboardCopy,\n  ClipboardCut,\n  ClipboardPaste,\n} from \"../controllers/AppEventType\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { AppObject } from \"../editorObjects/Editor\";\n\nexport interface ClipboardContent {\n  objects: AppObject[];\n}\nlet clipboardContent: ClipboardContent | undefined = undefined;\n\nexport const setClipboardBoardContent = (\n  content: ClipboardContent | undefined\n) => {\n  clipboardContent = content;\n};\n\nexport const getClipboardBoardContent = () => {\n  return clipboardContent;\n};\n\nexport const clipboardCopy = () => {\n  const event: ClipboardCopy = {\n    name: AppEventType.ClipboardCopy,\n    payload: {},\n  };\n  sendEvent(event);\n};\n\nexport const clipboardCut = () => {\n  const event: ClipboardCut = {\n    name: AppEventType.ClipboardCut,\n    payload: {},\n  };\n  sendEvent(event);\n};\n\nexport const clipboardPaste = () => {\n  if (clipboardContent === undefined) {\n    return;\n  }\n  const event: ClipboardPaste = {\n    name: AppEventType.ClipboardPaste,\n    payload: {\n      objects: clipboardContent.objects,\n    },\n  };\n  sendEvent(event);\n};\n","import * as THREE from \"three\";\nimport { getStore } from \"../../controllers/store\";\nimport { appStore } from \"../../immerReducers/appStore\";\nimport { appThree } from \"../renderThreejs\";\n\nexport const screenToWorld = (\n  clientX: number,\n  clientY: number\n): THREE.Vector2 => {\n  if (appThree.el === null) {\n    throw new Error(\"no el in dom\");\n  }\n  if (!appStore) {\n    throw new Error(\"no el in dom\");\n  }\n  // const { getState } = appStore;\n  // const state = getState();\n  const store = getStore();\n  const sceneScale = store.ui.zoomScale;\n  const { width, height, top, left } = appThree.el.getBoundingClientRect();\n  const screenX = clientX - left; // canvasX\n  const screenY = clientY - top; // canvasY\n  const x = (screenX - width / 2) * sceneScale + appThree.camera.position.x;\n  const y = (-screenY + height / 2) * sceneScale + appThree.camera.position.y;\n  return new THREE.Vector2(x, y);\n};\n\nexport const worldToScreen = (pos: THREE.Vector3) => {\n  if (!appStore) {\n    throw new Error(\"no el in dom\");\n  }\n  // const { getState } = appStore;\n  // const state = getState();\n  // const store = getStore();\n  // const sceneScale = store.ui.zoomScale;\n  const { width, height, top, left } = appThree.el.getBoundingClientRect();\n  var vector = pos.clone();\n  // vector.setFromMatrixPosition(obj.matrixWorld);\n  var widthHalf = width / 2;\n  var heightHalf = height / 2;\n  \n  vector.project(appThree.camera);\n  // console.log(\"??? \", vector)\n  // console.log(\"------\", vector.x, vector.y, sceneScale);\n  vector.x = vector.x * widthHalf + widthHalf + left;\n  vector.y = -(vector.y * heightHalf) + heightHalf + top;\n  return vector;\n};\n\nexport const getTopBarPositionInScreenFromObject = (bbox: THREE.Box3) => {\n  // const pos = worldToScreen(obj);\n\n  // const bbox = new THREE.Box3();\n  // bbox.expandByObject(obj);\n  if (isFinite(bbox.min.x) === false || isFinite(bbox.max.y) === false) {\n    return undefined;\n  }\n\n  // const offset = new THREE.Vector3();\n  // offset.x = bbox.min.x;\n  // offset.y = bbox.min.y;\n\n  // console.log(\n  //   \"getTopBarPositionInScreenFromObject bbox.min\",\n  //   bbox.min,\n  //   bbox.max\n  // );\n\n  // bbox.getCenter().x\n  var vector = new THREE.Vector3();\n  vector.x = bbox.min.x + (bbox.max.x - bbox.min.x) / 2;\n  vector.y = bbox.max.y;\n\n  // vector = obj.localToWorld(vector);\n  // vector.sub(offset);\n  const pos2 = worldToScreen(vector);\n\n  if(pos2.x < 0){\n    pos2.x = 0;\n  } \n  if(pos2.y < 70){\n    pos2.y = 70;\n  } \n\n  // var vector2 = new THREE.Vector3();\n  // vector2.add()\n  // vector.add(pos2)\n\n  return pos2;\n};\n\nexport const getTopBarPositionInScreenFromBBox = (vector: THREE.Vector3) => {\n  return worldToScreen(vector);\n};\n","import * as THREE from \"three\";\nimport { merge } from \"lodash\";\nimport { ChangeObjectsProperty } from \"../controllers/AppEventType\";\nimport {\n  BeadChildSuffix,\n  getThreeUserDataFromBead,\n} from \"../editorObjects/Bead\";\nimport {\n  AppObject,\n  Bead,\n  BeadMaterialTypes,\n  Group,\n  NAME_SEPARATOR,\n  ObjectTypes,\n  PreviewProject3D,\n  Region,\n  RegionGridType,\n  ThreeGridHelperConfig,\n  ThreeLightConfig,\n} from \"../editorObjects/Editor\";\nimport {\n  getThreeUserDataFromGroup,\n  GroupChildSuffix,\n} from \"../editorObjects/Group\";\nimport {\n  getThreeUserDataFromPreviewProject3D,\n  PreviewProject3DChildSuffix,\n} from \"../editorObjects/PreviewProject3D\";\nimport {\n  getThreeUserDataFromRegion,\n  isActiveRegionCell,\n  RegionChildSuffix,\n} from \"../editorObjects/Region\";\nimport { getModelBBoxFromBeadType, getModelFromBeadType } from \"./loadModels\";\nimport { getTopBarPositionInScreenFromObject } from \"./mouseListeners/screenToWorld\";\nimport { appThree, AppThreeScene } from \"./renderThreejs\";\n\n/**@deprecated */\n// export const initEventEmitterHandlers = () => {\n//   const eventEmitter = getEventEmitter();\n\n//   eventEmitter.on(EventNames.action_changeSelectedBeads_color, (data) => {\n//     data.beadIds.forEach((id) => {\n//       const name = getThreeNameFromBeadId(id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n//       if (object === undefined) {\n//         return;\n//       }\n\n//       object.traverse((child) => {\n//         if (child instanceof THREE.Mesh) {\n//           if (child.material) {\n//             (child.material as THREE.MeshPhysicalMaterial).color.set(\n//               data.color\n//             );\n//           }\n//         }\n//       });\n//     });\n//   });\n\n//   eventEmitter.on(EventNames.action_changeSelectedBeads_height, (data) => {\n//     data.beads.forEach((bead: Bead) => {\n//       const name = getThreeNameFromBeadId(bead.id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       const bbox = getModelBBoxFromBeadType(bead.type);\n//       let width = 1;\n//       let height = 1;\n//       let depth = 1;\n//       if (bbox) {\n//         width = Math.abs(bbox.max.x - bbox.min.x);\n//         height = Math.abs(bbox.max.y - bbox.min.y);\n//         depth = Math.abs(bbox.max.z - bbox.min.z);\n//       }\n//       object.scale.x = bead.width / width;\n//       object.scale.y = bead.height / height;\n//       object.scale.z = bead.depth / depth;\n//     });\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_unselectAll, (data) => {\n//     data.diffStateSelectedIds.forEach((obj) => {\n//       if (obj.objectType === ObjectTypes.Bead) {\n//         triggerSelectBead(obj.id, obj.isSelected);\n//       } else if (obj.objectType === ObjectTypes.Region) {\n//         triggerSelectRegion(obj.id, obj.isSelected);\n//       }\n//     });\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_changeSelectedBeads_width, (data) => {\n//     data.beads.forEach((bead: Bead) => {\n//       const name = getThreeNameFromBeadId(bead.id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       const bbox = getModelBBoxFromBeadType(bead.type);\n//       let width = 1;\n//       let height = 1;\n//       let depth = 1;\n//       if (bbox) {\n//         width = Math.abs(bbox.max.x - bbox.min.x);\n//         height = Math.abs(bbox.max.y - bbox.min.y);\n//         depth = Math.abs(bbox.max.z - bbox.min.z);\n//       }\n//       object.scale.x = bead.width / width;\n//       object.scale.y = bead.height / height;\n//       object.scale.z = bead.depth / depth;\n//     });\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_changeSelectedBeads_depth, (data) => {\n//     data.beads.forEach((bead: Bead) => {\n//       const name = getThreeNameFromBeadId(bead.id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       const bbox = getModelBBoxFromBeadType(bead.type);\n//       let width = 1;\n//       let height = 1;\n//       let depth = 1;\n//       if (bbox) {\n//         width = Math.abs(bbox.max.x - bbox.min.x);\n//         height = Math.abs(bbox.max.y - bbox.min.y);\n//         depth = Math.abs(bbox.max.z - bbox.min.z);\n//       }\n//       object.scale.x = bead.width / width;\n//       object.scale.y = bead.height / height;\n//       object.scale.z = bead.depth / depth;\n//     });\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_changeSelectedBeads_type, (data) => {\n//     data.beadIds.forEach((id) => {\n//       const name = getThreeNameFromBeadId(id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       appThree.scene.remove(object);\n//     });\n\n//     data.beads.forEach((bead: Bead) => {\n//       triggerAddBeadToScene(bead, appThree.scene);\n//       triggerSelectBead(bead.id, true);\n//     });\n\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_changeSelectedBeads_rotate, (data) => {\n//     data.beadIds.forEach((id) => {\n//       const name = getThreeNameFromBeadId(id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n\n//       object.rotation.x = THREE.MathUtils.DEG2RAD * data.rotateX;\n//       object.rotation.y = THREE.MathUtils.DEG2RAD * data.rotateY;\n//       object.rotation.z = THREE.MathUtils.DEG2RAD * data.rotateZ;\n//     });\n\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_selectBeads, (data) => {\n//     data.diffStates.forEach((bead) => {\n//       const id = Object.keys(bead)[0];\n//       const value = Object.values(bead)[0] as boolean;\n//       triggerSelectBead(id, value);\n//     });\n//   });\n\n//   eventEmitter.on(EventNames.action_selectIntersectObject, (data) => {\n//     data.diffStateSelectedIds.forEach((obj) => {\n//       if (obj.objectType === ObjectTypes.Bead) {\n//         triggerSelectBead(obj.id, obj.isSelected);\n//       } else if (obj.objectType === ObjectTypes.Region) {\n//         triggerSelectRegion(obj.id, obj.isSelected);\n//       }\n//     });\n\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_selectIntersectObjects, (data) => {\n//     if (data?.selectedBeads?.diffStates) {\n//       data.selectedBeads?.diffStates?.forEach((bead) => {\n//         const id = Object.keys(bead)[0];\n//         const value = Object.values(bead)[0] as boolean;\n//         triggerSelectBead(id, value);\n//       });\n//     }\n//     if (data?.selectedRegions?.diffStates) {\n//       data.selectedRegions?.diffStates?.forEach((region) => {\n//         const id = Object.keys(region)[0];\n//         const value = Object.values(region)[0] as boolean;\n//         triggerSelectRegion(id, value);\n//       });\n//     }\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_updateZoomSCale, (data) => {\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_updateEditBBox, (data) => {\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_selectRegions, (data) => {\n//     const selectedIds: string[] = [];\n//     data.diffStates.forEach((bead) => {\n//       const id = Object.keys(bead)[0];\n//       const value = Object.values(bead)[0] as boolean;\n//       triggerSelectRegion(id, value);\n//       if (value === true) {\n//         selectedIds.push(id);\n//       }\n//     });\n//   });\n\n//   eventEmitter.on(EventNames.action_deleteBeads, (data) => {\n//     triggerDeleteBeadIds(data.beadIds);\n//   });\n\n//   eventEmitter.on(EventNames.action_deleteSelectedBeads, (data) => {\n//     triggerDeleteBeadIds(data.beadIds);\n//   });\n\n//   eventEmitter.on(EventNames.action_deleteObjects, (data) => {\n//     triggerDeleteObjectIds(data.toDeleteObjectIds);\n//   });\n\n//   eventEmitter.on(EventNames.action_addBeadOnClick, (data) => {\n//     const bead = data.bead as Bead;\n//     triggerAddBeadToScene(bead, appThree.scene);\n//   });\n\n//   eventEmitter.on(EventNames.action_updateLight, (data) => {\n//     const { name, field, value } = data;\n//     const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//     if (object !== undefined) {\n//       const light = object as THREE.DirectionalLight;\n//       if (data.field === \"color\") {\n//         light.color = data.value;\n//       }\n//       if (data.field === \"intensity\") {\n//         light.intensity = data.value;\n//       }\n//     }\n//   });\n\n//   eventEmitter.on(EventNames.action_addRegion, (data) => {\n//     const region = data.region as Region;\n//     triggerRegionToScene(region);\n//   });\n\n//   eventEmitter.on(EventNames.action_moveClickedObject, (data) => {\n//     data.movedObjects.forEach((obj) => {\n//       const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n//       if (name === undefined) {\n//         return;\n//       }\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       object.position.x = obj.position.x;\n//       object.position.y = obj.position.y;\n//     });\n//   });\n\n//   eventEmitter.on(EventNames.action_moveAllSelectedObjects, (data) => {\n//     data.movedObjects.forEach((obj) => {\n//       const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n//       if (name === undefined) {\n//         return;\n//       }\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       object.position.x = obj.position.x;\n//       object.position.y = obj.position.y;\n//     });\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.action_movedSelected, (data) => {\n//     data.beads.forEach((bead: Bead) => {\n//       const name = getThreeNameFromBeadId(bead.id, BeadChildSuffix.MAIN);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       object.position.x = bead.position.x;\n//       object.position.y = bead.position.y;\n//     });\n//     data.regions.forEach((region: Region) => {\n//       const name = getThreeNameFromRegionId(region.id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       logger.trace(\"co bylo?\", object.position.x, region.position.x);\n//       object.position.x = region.position.x;\n//       object.position.y = region.position.y;\n//     });\n//     triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n//   });\n\n//   eventEmitter.on(EventNames.updateEditorState, () => {});\n\n//   eventEmitter.on(EventNames.action_changeBeadColorToBeadTemplate, (data) => {\n//     data.beads.forEach((bead: Bead) => {\n//       const name = getThreeNameFromBeadId(bead.id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       object.traverse((child) => {\n//         if (child instanceof THREE.Mesh) {\n//           child.material = new THREE.MeshPhysicalMaterial({\n//             flatShading: true,\n//             reflectivity: 1,\n//             color: data.color,\n//           });\n//         }\n//       });\n//     });\n//   });\n\n//   eventEmitter.on(EventNames.action_fastAddBeads, (data) => {\n//     Object.keys(data.beads).forEach((id) => {\n//       const bead = data.beads[id] as Bead;\n//       triggerAddBeadToScene(bead, appThree.scene);\n//     });\n\n//     data.prevSelectedBeadIds.forEach((beadId) => {\n//       triggerSelectBead(beadId, false);\n//     });\n//   });\n\n//   eventEmitter.on(EventNames.action_snapToLineSelectedBeads, (data) => {\n//     data.beads.forEach((bead: Bead) => {\n//       const name = getThreeNameFromBeadId(bead.id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       object.position.x = bead.position.x;\n//       object.position.y = bead.position.y;\n//     });\n//   });\n\n//   eventEmitter.on(EventNames.action_onChangeEditorMode, (data) => {\n//     data.prevSelectedBeadIds.forEach((beadId) => {\n//       triggerSelectBead(beadId, false);\n//     });\n//   });\n\n//   eventEmitter.on(EventNames.action_readSavedCanvas, (data) => {\n//     Object.keys(data.objects).forEach((id) => {\n//       const obj = data.objects[id] as AppObject;\n//       if (obj.objectType === ObjectTypes.Bead) {\n//         triggerAddBeadToScene(obj as Bead, appThree.scene);\n//       } else if (obj.objectType === ObjectTypes.Region) {\n//         triggerRegionToScene(obj as Region);\n//       } else if (obj.objectType === ObjectTypes.Group) {\n//         triggerGroupToScene(obj as Group);\n//       } else if (obj.objectType === ObjectTypes.PreviewProject3D) {\n//         triggerPreviewProject3DToScene(obj as PreviewProject3D);\n//       }\n//     });\n//     // Object.keys(data.beads).forEach((id) => {\n//     //   const bead = data.beads[id] as Bead;\n//     //   triggerAddBeadToScene(bead);\n//     // });\n//     // Object.keys(data.regions).forEach((id) => {\n//     //   const region = data.regions[id] as Region;\n//     //   triggerRegionToScene(region);\n//     // });\n//   });\n\n//   eventEmitter.on(EventNames.startAppEvent, (data: { state: Editor }) => {\n//     console.log(\"startAppEvent: ...\", data.state.ui.lights);\n\n//     if (data.state.ui.lights && data.state.ui.lights.length > 0) {\n//       data.state.ui.lights.forEach((l) => {\n//         if (l.type === \"THREE.DirectionalLight\") {\n//           const light = new THREE.DirectionalLight(l.color, l.intensity);\n//           light.position.set(\n//             l.position?.x ?? 0,\n//             l.position?.y ?? 0,\n//             l.position?.z ?? 10\n//           );\n//           light.name = l.name;\n//           light.userData = merge({}, light, {\n//             objectType: ObjectTypes.SceneLight,\n//             name: `${ObjectTypes.SceneLight}${NAME_SEPARATOR}${light.id}`,\n//           });\n//           appThree.scene.add(light);\n//         }\n//       });\n//     }\n//     if (data.state.ui.grid.isVisible) {\n//       const size = 100000;\n//       const grid = new THREE.GridHelper(1, size / 10, \"#e9e9e9\", \"#eee\");\n//       grid.position.x = 0;\n//       grid.position.y = 0;\n//       grid.position.z = -500;\n//       grid.scale.x = size;\n//       grid.scale.y = size;\n//       grid.scale.z = size;\n\n//       grid.rotation.x = THREE.MathUtils.DEG2RAD * 90;\n//       grid.rotation.y = THREE.MathUtils.DEG2RAD * 0;\n//       grid.rotation.z = THREE.MathUtils.DEG2RAD * 0;\n//       grid.userData = merge({}, data.state.ui.grid, {\n//         objectType: ObjectTypes.SceneBackgroundGrid,\n//         name: `${ObjectTypes.SceneBackgroundGrid}${NAME_SEPARATOR}${data.state.ui.grid.id}`,\n//       });\n\n//       appThree.scene.add(grid);\n//     }\n//   });\n// };\n\nexport const clearThreeScene = () => {\n  appThree.scene.clear();\n};\n\nexport const addLightFromUI = (\n  config: ThreeLightConfig,\n  scene: AppThreeScene\n) => {\n  if (config.type === \"THREE.DirectionalLight\") {\n    const light = new THREE.DirectionalLight(config.color, config.intensity);\n    light.position.set(\n      config.position?.x ?? 0,\n      config.position?.y ?? 0,\n      config.position?.z ?? 10\n    );\n    light.name = config.name;\n    light.userData = merge({}, light, {\n      objectType: ObjectTypes.SceneLight,\n      name: `${ObjectTypes.SceneLight}${NAME_SEPARATOR}${light.id}`,\n    });\n    scene.add(light);\n  }\n};\n\nexport const addGridFromUi = (config: ThreeGridHelperConfig) => {\n  const size = 100000;\n  const grid = new THREE.GridHelper(1, size / 10, \"#e9e9e9\", \"#eee\");\n  grid.position.x = 0;\n  grid.position.y = 0;\n  grid.position.z = -500;\n  grid.scale.x = size;\n  grid.scale.y = size;\n  grid.scale.z = size;\n\n  grid.rotation.x = THREE.MathUtils.DEG2RAD * 90;\n  grid.rotation.y = THREE.MathUtils.DEG2RAD * 0;\n  grid.rotation.z = THREE.MathUtils.DEG2RAD * 0;\n  grid.userData = merge({}, config, {\n    objectType: ObjectTypes.SceneBackgroundGrid,\n    name: `${ObjectTypes.SceneBackgroundGrid}${NAME_SEPARATOR}${config.id}`,\n  });\n  appThree.scene.add(grid);\n};\n\nexport const addObjectByObjectType = (object: AppObject) => {\n  const { objectType } = object;\n  if (objectType === ObjectTypes.Bead) {\n    triggerAddBeadToScene(object as any, appThree.scene, false);\n  }\n  if (objectType === ObjectTypes.Region) {\n    triggerRegionToScene(object as any);\n  }\n  if (objectType === ObjectTypes.Group) {\n    triggerGroupToScene(object as any);\n  }\n  if (objectType === ObjectTypes.PreviewProject3D) {\n    triggerPreviewProject3DToScene(object as any);\n  }\n};\n\nexport const updateObjectsProperty = (event: ChangeObjectsProperty) => {\n  // @TODO: update\n  // event.payload.change.forEach(obj => {\n  //   obj.id\n  // })\n};\n\nexport const getTopBarPosition = (\n  objects: { id: string; objectType: ObjectTypes }[]\n) => {\n  const bbox = new THREE.Box3();\n\n  objects.forEach((obj) => {\n    const object = appThree.objects.get(obj.id);\n    if (object !== undefined) {\n      bbox.expandByObject(object);\n    }\n    // const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n    // if (name === undefined) {\n    //   return;\n    // }\n    // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    // if (object === undefined) {\n    //   return;\n    // }\n  });\n\n  return getTopBarPositionInScreenFromObject(bbox);\n  // console.log('jaki mam bbox?', bbox.min, bbox.max)\n};\n\nexport const updateObjectPosition = (\n  objectId: string,\n  objectType: ObjectTypes,\n  positionX: number,\n  positionY: number\n) => {\n  const object = appThree.objects.get(objectId);\n  if (object !== undefined) {\n    object.position.x = positionX;\n    object.position.y = positionY;\n  }\n  // const name = getStateObjectFromObjectId(objectId, objectType);\n  // if (name === undefined) {\n  //   return;\n  // }\n  // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  // if (object === undefined) {\n  //   return;\n  // }\n};\n\nexport const triggerSelectBead = (id: string, shouldSelect: boolean) => {\n  const object = appThree.objects.get(id);\n  if (object !== undefined) {\n    object.traverse((child) => {\n      if (child instanceof THREE.Mesh) {\n        if (child.material) {\n          if (shouldSelect === true) {\n            (child.material as THREE.MeshPhysicalMaterial).emissive.set(\n              0x171717\n            );\n          } else {\n            (child.material as THREE.MeshPhysicalMaterial).emissive.set(0);\n          }\n        }\n      }\n    });\n  }\n\n  // const name = getThreeNameFromBeadId(id);\n  // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n  // if (object === undefined) {\n  //   return;\n  // }\n\n  // if (shouldSelect === true) {\n  //   const bbox = new THREE.Box3();\n\n  //   bbox.expandByObject(object as any);\n\n  //   const x = bbox.min.x;\n  //   const y = bbox.min.y;\n  //   const w = Math.abs(bbox.max.x - bbox.min.x);\n  //   const h = Math.abs(bbox.max.y - bbox.min.y);\n  //   const z = 1;\n\n  //   // const material = new THREE.LineBasicMaterial({\n  //   //   color: \"#5794fc\",\n  //   // });\n\n  //   const width = 1;\n  //   const height = 1;\n  //   const rectWidth = width - 0.0;\n  //   const rectHeight = height - 0.0;\n  //   const rectShape = new THREE.Shape()\n  //     .moveTo(rectWidth / 2, rectHeight / 2)\n  //     .lineTo((rectWidth / 2) * -1, rectHeight / 2)\n  //     .lineTo((rectWidth / 2) * -1, (rectHeight / 2) * -1)\n  //     .lineTo(rectWidth / 2, (rectHeight / 2) * -1);\n\n  //   rectShape.autoClose = true;\n\n  //   const _rectPoints = rectShape.getPoints();\n  //   const _rectGeometryPoints = new THREE.BufferGeometry().setFromPoints(\n  //     _rectPoints\n  //   );\n  //   const _lineMaterial = new THREE.MeshBasicMaterial({ color: 0x0040f0 });\n  //   const lines = new THREE.Line(_rectGeometryPoints, _lineMaterial);\n\n  //   // const geometry = new THREE.BufferGeometry().setFromPoints(points);\n\n  //   // const lines = new THREE.LineSegments(geometry, material);\n\n  //   // const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  //   // const material = new THREE.MeshBasicMaterial({\n  //   //   color: \"#5794fc\",\n  //   //   side: THREE.FrontSide,\n  //   //   opacity: 0.99,\n  //   //   transparent: false,\n  //   // });\n  //   // const lines = new THREE.Mesh(geometry, material);\n  //   lines.userData = getThreeUserDataFromBead(\n  //     (object as any).userData,\n  //     BeadChildSuffix.SELECTION_CHILD\n  //   );\n\n  //   const rectangleFrame = new THREE.Group();\n  //   rectangleFrame.userData = getThreeUserDataFromBead(\n  //     (object as any).userData,\n  //     BeadChildSuffix.SELECTION\n  //   );\n  //   // rectangleFrame.scale.x = 1;\n  //   // rectangleFrame.scale.y = 1;\n  //   // rectangleFrame.scale.z = 1;\n  //   rectangleFrame.userData.position.x = x + w / 2;\n  //   rectangleFrame.userData.position.y = y + h / 2;\n  //   rectangleFrame.position.x = x + w / 2;\n  //   rectangleFrame.position.y = y + h / 2;\n  //   rectangleFrame.position.z = -460;\n  //   rectangleFrame.scale.x = w;\n  //   rectangleFrame.scale.y = h;\n  //   rectangleFrame.scale.z = z;\n  //   rectangleFrame.add(lines);\n  //   object.attach(rectangleFrame);\n  // } else {\n  //   const name = getThreeNameFromBeadId(id, BeadChildSuffix.SELECTION);\n  //   const _object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //   if (_object === undefined) {\n  //     return;\n  //   }\n  //   object.remove(_object);\n  // }\n};\n\nexport const triggerRegionToScene = (region: Region) => {\n  const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  // @TODO: zmiana koloru i opacity\n  const material = new THREE.MeshBasicMaterial({\n    color: \"rgb(0,0,0)\",\n    side: THREE.FrontSide,\n    opacity: 0.1,\n    transparent: true,\n  });\n  const regionBgThree = new THREE.Mesh(geometry, material);\n  regionBgThree.userData = getThreeUserDataFromRegion(\n    region,\n    RegionChildSuffix.BG\n  );\n\n  const regionGridCellsThree = new THREE.Group();\n  regionGridCellsThree.userData = getThreeUserDataFromRegion(\n    region,\n    RegionChildSuffix.GRID_CELLS\n  );\n\n  region.childrenGridIds.forEach((beadId, index) => {\n    const row = Math.floor(index / region.columns);\n    const column = Math.floor(index % region.columns);\n    const isCellActive = isActiveRegionCell(region, index);\n    const cellWidth = 1 / region.columns;\n    const cellHeight = 1 / region.rows;\n    const halfWidth = cellWidth / 2;\n    const halfHeight = cellHeight / 2;\n    const x1 = halfWidth;\n    const x2 = -halfWidth;\n    const y1 = halfHeight;\n    const y2 = -halfHeight;\n    const rectShape = new THREE.Shape()\n      .moveTo(x1, y1)\n      .lineTo(x2, y1)\n      .lineTo(x2, y2)\n      .lineTo(x1, y2);\n\n    rectShape.autoClose = true;\n\n    const _rectPoints = rectShape.getPoints();\n    const _rectGeometryPoints = new THREE.BufferGeometry().setFromPoints(\n      _rectPoints\n    );\n    const _lineMaterial = new THREE.MeshBasicMaterial({\n      color: isCellActive ? 0x0040f0 : \"red\",\n      opacity: isCellActive ? 1 : 0,\n      transparent: isCellActive ? false : true,\n    });\n    const _cell = new THREE.Line(_rectGeometryPoints, _lineMaterial);\n    _cell.userData = getThreeUserDataFromRegion(\n      region,\n      RegionChildSuffix.GRID_CELL\n    );\n    const offsetEnabled = region.gridType === RegionGridType.Bricks;\n    const offsetX = offsetEnabled ? (row % 2 === 0 ? 0 : halfWidth) : 0;\n    const x = cellWidth * column + halfWidth;\n    _cell.position.x = x + offsetX - 0.5;\n    const y = cellHeight * row + halfHeight;\n    _cell.position.y = y - 0.5;\n    regionGridCellsThree.add(_cell);\n  });\n\n  const regionThree = new THREE.Group();\n  regionThree.userData = getThreeUserDataFromRegion(\n    region,\n    RegionChildSuffix.MAIN\n  );\n  regionThree.position.x = region.position.x;\n  regionThree.position.y = region.position.y;\n  regionThree.position.z = -300;\n  regionThree.scale.x = region.width;\n  regionThree.scale.y = region.height;\n  regionThree.scale.z = 1;\n\n  regionThree.rotation.x = THREE.MathUtils.DEG2RAD * region.rotateX;\n  regionThree.rotation.y = THREE.MathUtils.DEG2RAD * region.rotateY;\n  regionThree.rotation.z = THREE.MathUtils.DEG2RAD * region.rotateZ;\n\n  regionThree.add(regionBgThree);\n  regionThree.add(regionGridCellsThree);\n\n  // regionThree.layers.set(2)\n  // regionThree.layers.enableAll();\n  appThree.objects.set(region.id, regionThree);\n  appThree.scene.add(regionThree);\n\n  // @TODO: CHeck lines\n  // const material = new THREE.LineBasicMaterial({ color: 0x0000ff });\n  // material.linewidth = 10\n  // const points: THREE.Vector3[] = [];\n  // points.push(new THREE.Vector3(-10, 0, 0));\n  // points.push(new THREE.Vector3(0, 10, 0));\n  // points.push(new THREE.Vector3(10, 0, 0));\n  // const geometry = new THREE.BufferGeometry().setFromPoints(points);\n  // const line = new THREE.Line(geometry, material);\n  // appThree.scene.add(line)\n};\n\nexport const paintBead = (bead: Bead, selectedIds: string[], color: string) => {\n  const object = appThree.objects.get(bead.id);\n  if (object !== undefined) {\n    if (object instanceof THREE.Mesh) {\n      object?.material?.color?.set(color);\n    }\n    object.traverse((child) => {\n      if (child instanceof THREE.Mesh) {\n        child.material?.color?.set(color);\n      }\n    });\n    if (selectedIds.includes(bead.id)) {\n      triggerSelectBead(bead.id, true);\n    }\n  }\n};\n\nconst getBeadModelMaterial = (material: BeadMaterialTypes, color: string) => {\n\n  // const material = new THREE.MeshBasicMaterial( { map: texture } );\n  // const texture = getModelTexture()\n  if (material === BeadMaterialTypes.Mat) {\n    return new THREE.MeshPhysicalMaterial({\n      reflectivity: 1,\n      color: color,\n      // map: texture\n    });\n  } else if (material === BeadMaterialTypes.Shiny) {\n    return new THREE.MeshPhongMaterial({\n      color: color,\n      // map: texture\n    });\n  } else {\n    console.warn(\"unknow BeadMaterialTypes:\", material);\n  }\n\n  // return new THREE.MeshLambertMaterial({\n  //   color: bead.color,\n  // });\n\n  // return new THREE.MeshStandardMaterial({\n  //   color: bead.color,\n  //   metalness: 0,\n  //   roughness: 0.5,\n  // });\n\n  // return new THREE.MeshDepthMaterial();\n\n  // return new THREE.MeshPhysicalMaterial({\n  //   flatShading: true,\n  //   reflectivity: 1,\n  //   color: bead.color,\n  // });\n};\n\nexport const getThreeBeadModel = (bead: Bead) => {\n  const beadType = bead.type;\n  const beadModel = getModelFromBeadType(beadType);\n\n  if (beadModel === undefined) {\n    console.warn(\"beadModel not found for type: \", beadType, bead.id);\n    return ;\n  }\n\n\n  beadModel.traverse((child) => {\n    child.userData = getThreeUserDataFromBead(bead, BeadChildSuffix.ANY);\n    if (child instanceof THREE.Mesh) {\n      child.material = getBeadModelMaterial(bead.material, bead.color);\n    }\n    if ((child as any).geometry) {\n      (child as any).geometry.computeBoundingBox();\n    }\n  });\n\n  const bbox = getModelBBoxFromBeadType(beadType);\n  let width: number = 1;\n  let height: number = 1;\n  let depth: number = 1;\n  if (bbox) {\n    width = Math.abs(bbox.max.x - bbox.min.x);\n    height = Math.abs(bbox.max.y - bbox.min.y);\n    depth = Math.abs(bbox.max.z - bbox.min.z);\n  }\n\n  beadModel.scale.x = bead.width / width;\n  beadModel.scale.y = bead.height / height;\n  beadModel.scale.z = bead.depth / depth;\n\n  beadModel.rotation.x = THREE.MathUtils.DEG2RAD * bead.rotateX;\n  beadModel.rotation.y = THREE.MathUtils.DEG2RAD * bead.rotateY;\n  beadModel.rotation.z = THREE.MathUtils.DEG2RAD * bead.rotateZ;\n\n  beadModel.position.x = bead.position.x;\n  beadModel.position.y = bead.position.y;\n  beadModel.position.z = bead.position.z;\n\n  beadModel.userData = getThreeUserDataFromBead(bead);\n  return beadModel;\n}\n\nexport const triggerAddBeadToScene = (\n  bead: Bead,\n  scene: AppThreeScene,\n  skipObjects: boolean = false\n) => {\n  const object = appThree.objects.get(bead.id);\n\n  if (object !== undefined) {\n    console.warn(\"bead already in scene\", bead.id);\n    return ;\n  }\n\n  const beadModel = getThreeBeadModel(bead);\n \n  if(beadModel === undefined){\n    return ;\n  }\n\n  if (skipObjects === false) {\n    appThree.objects.set(bead.id, beadModel);\n  }\n\n  scene.add(beadModel);\n};\n\nexport const triggerGroupToScene = (group: Group) => {\n  const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  const material = new THREE.MeshBasicMaterial({\n    color: \"rgb(0,0,0)\",\n    side: THREE.FrontSide,\n    opacity: 0.2,\n    transparent: true,\n  });\n  const groupBgThree = new THREE.Mesh(geometry, material);\n  groupBgThree.userData = getThreeUserDataFromGroup(group, GroupChildSuffix.BG);\n\n  const groupThree = new THREE.Group();\n  groupThree.userData = getThreeUserDataFromGroup(group, GroupChildSuffix.MAIN);\n  groupThree.position.x = group.position.x;\n  groupThree.position.y = group.position.y;\n  groupThree.position.z = -400;\n  groupThree.scale.x = group.width;\n  groupThree.scale.y = group.height;\n  groupThree.scale.z = 1;\n\n  // groupThree.rotation.x = THREE.MathUtils.DEG2RAD * group.rotateX;\n  // groupThree.rotation.y = THREE.MathUtils.DEG2RAD * group.rotateY;\n  // groupThree.rotation.z = THREE.MathUtils.DEG2RAD * group.rotateZ;\n  groupThree.add(groupBgThree);\n  appThree.objects.set(group.id, groupThree);\n  appThree.scene.add(groupThree);\n};\n\nexport const triggerPreviewProject3DToScene = (\n  previewProject3D: PreviewProject3D\n) => {\n  const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  const material = new THREE.MeshBasicMaterial({\n    color: \"rgb(0,0,0)\",\n    side: THREE.FrontSide,\n    opacity: 0.1,\n    transparent: true,\n  });\n  const groupBgThree = new THREE.Mesh(geometry, material);\n  groupBgThree.userData = getThreeUserDataFromPreviewProject3D(\n    previewProject3D,\n    PreviewProject3DChildSuffix.BG\n  );\n\n  const groupThree = new THREE.Group();\n  groupThree.userData = getThreeUserDataFromPreviewProject3D(\n    previewProject3D,\n    PreviewProject3DChildSuffix.MAIN\n  );\n  groupThree.position.x = previewProject3D.position.x;\n  groupThree.position.y = previewProject3D.position.y;\n  // groupThree.position.z = -500;\n  groupThree.scale.x = previewProject3D.width;\n  groupThree.scale.y = previewProject3D.height;\n  groupThree.scale.z = 1;\n\n  // groupThree.rotation.x = THREE.MathUtils.DEG2RAD * previewProject3D.rotateX;\n  // groupThree.rotation.y = THREE.MathUtils.DEG2RAD * previewProject3D.rotateY;\n  // groupThree.rotation.z = THREE.MathUtils.DEG2RAD * previewProject3D.rotateZ;\n\n  groupThree.add(groupBgThree);\n  appThree.objects.set(previewProject3D.id, groupThree);\n  appThree.scene.add(groupThree);\n};\n\nexport const triggerDeleteObjectIds = (\n  objects: { id: string; objectType: ObjectTypes }[]\n) => {\n  objects.forEach((obj) => {\n    const object = appThree.objects.get(obj.id);\n    // const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n    // if (name === undefined) {\n    //   console.warn(\n    //     \"triggerDeleteObjectIds:: name cant be created\",\n    //     obj.id,\n    //     obj.objectType\n    //   );\n    //   return;\n    // }\n    // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    // if (object === undefined) {\n    //   console.warn(\"triggerDeleteObjectIds:: object not found by name\", name);\n    //   return;\n    // }\n\n    if (object !== undefined) {\n      if (object.parent) {\n        object.parent.remove(object);\n      }\n      // appThree.scene.remove(object);\n      appThree.objects.delete(obj.id);\n    }\n    // const __object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    // if (__object !== undefined) {\n    //   console.warn(\n    //     \"triggerDeleteObjectIds:: try double - object found by name in scene \",\n    //     name\n    //   );\n    // }\n  });\n};\n\nexport const triggerDeleteBeadIds = (beadIds: string[]) => {\n  beadIds.forEach((beadId) => {\n    const object = appThree.objects.get(beadId);\n    if (object !== undefined) {\n      if (object.parent) {\n        object.parent.remove(object);\n      }\n      appThree.objects.delete(beadId);\n    }\n    // while (true) {\n    //   const name = getThreeNameFromBeadId(beadId);\n    //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //   if (object === undefined) {\n    //     break;\n    //   }\n    //   appThree.scene.remove(object);\n    // }\n    // while (true) {\n    //   const name = getThreeNameFromBeadId(beadId, BeadChildSuffix.ANY);\n    //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //   if (object === undefined) {\n    //     break;\n    //   }\n    //   appThree.scene.remove(object);\n    // }\n  });\n};\n\n// export const triggerUpdateEditBBox = (\n//   editBBox: EditBBox | undefined,\n//   prevEditBBox: EditBBox | undefined\n// ) => {\n//   if (editBBox === undefined) {\n//     if (prevEditBBox !== undefined) {\n//       const name = getThreeNameFromEditBBoxId(prevEditBBox.id);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object !== undefined) {\n//         appThree.scene.remove(object);\n//       }\n\n//       // const nameB = getThreeNameFromEditBBoxId(\n//       //   prevEditBBox.id,\n//       //   EditBBoxChildSuffix.RESIZE_CONTAINER\n//       // );\n//       // const objectB = appThree.scene.getObjectByUserDataProperty(\n//       //   \"name\",\n//       //   nameB\n//       // );\n//       // if (objectB !== undefined) {\n//       //   appThree.scene.remove(objectB);\n//       // }\n//     }\n//     return;\n//   }\n\n// const rect10x10FromScreenToWorld =\n//   appThree.camera.userData[\"rect10x10FromScreenToWorld\"];\n// const dotSize = (rect10x10FromScreenToWorld.w ?? 10) * 0.5;\n\n// if (prevEditBBox === undefined) {\n//   const editBBoxThree = new THREE.Group();\n\n//   const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n//   const material = new THREE.MeshBasicMaterial({\n//     color: \"#5794fc\",\n//     side: THREE.FrontSide,\n//     opacity: 0.1,\n//     transparent: true,\n//   });\n//   const editBBoxBgThree = new THREE.Mesh(geometry, material);\n//   editBBoxBgThree.userData = getThreeUserDataFromEditBBox(\n//     editBBox,\n//     EditBBoxChildSuffix.BG\n//   );\n\n//   const bbox = new THREE.Box3();\n\n//   if (editBBox.selectedIds.length > 0) {\n//     editBBox.selectedIds.forEach((obj) => {\n//       const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n//       bbox.expandByObject(object);\n//     });\n//   }\n\n//   // if (editBBox.beadIds.length > 0) {\n//   //   editBBox.beadIds.forEach((beadId) => {\n//   //     const name = getThreeNameFromBeadId(beadId);\n//   //     const object = appThree.scene.getObjectByUserDataProperty(\n//   //       \"name\",\n//   //       name\n//   //     );\n//   //     if (object === undefined) {\n//   //       return;\n//   //     }\n//   //     bbox.expandByObject(object);\n//   //   });\n//   // }\n\n//   // if (editBBox.regionsIds.length > 0) {\n//   //   editBBox.regionsIds.forEach((regionsId) => {\n//   //     const name = getThreeNameFromRegionId(regionsId);\n//   //     const object = appThree.scene.getObjectByUserDataProperty(\n//   //       \"name\",\n//   //       name\n//   //     );\n//   //     if (object === undefined) {\n//   //       return;\n//   //     }\n//   //     bbox.expandByObject(object);\n//   //   });\n//   // }\n\n//   const x = bbox.min.x;\n//   const y = bbox.min.y;\n//   const w = Math.abs(bbox.max.x - bbox.min.x);\n//   const h = Math.abs(bbox.max.y - bbox.min.y);\n//   const z = 1;\n\n//   editBBoxThree.userData = getThreeUserDataFromEditBBox(editBBox);\n//   editBBoxThree.userData.position.x = x + w / 2;\n//   editBBoxThree.userData.position.y = y + h / 2;\n//   editBBoxThree.position.x = x + w / 2;\n//   editBBoxThree.position.y = y + h / 2;\n//   editBBoxThree.position.z = -460;\n//   editBBoxThree.scale.x = w;\n//   editBBoxThree.scale.y = h;\n//   editBBoxThree.scale.z = z;\n//   editBBoxThree.add(editBBoxBgThree);\n\n//   // const editBBoxResizeThree = new THREE.Group();\n//   // editBBoxResizeThree.userData = getThreeUserDataFromEditBBox(\n//   //   editBBox,\n//   //   EditBBoxChildSuffix.RESIZE_CONTAINER\n//   // );\n//   // editBBoxResizeThree.scale.x = 1;\n//   // editBBoxResizeThree.scale.y = 1;\n//   // editBBoxResizeThree.scale.z = 1;\n//   // const __material = new THREE.MeshLambertMaterial({ color: \"#ffffff\" });\n//   // const __boxGeometry = new THREE.CircleGeometry(1, 16);\n//   // const _whiteDot = new THREE.Mesh(__boxGeometry, __material);\n//   // _whiteDot.scale.x = 0.8;\n//   // _whiteDot.scale.y = 0.8;\n//   // _whiteDot.renderOrder = 2;\n\n//   // const ___material = new THREE.MeshLambertMaterial({ color: \"#a9a9a9\" });\n//   // const ___boxGeometry = new THREE.CircleGeometry(1, 16);\n//   // const _grayDot = new THREE.Mesh(___boxGeometry, ___material);\n//   // _grayDot.scale.x = 1;\n//   // _grayDot.scale.y = 1;\n//   // _grayDot.renderOrder = 1;\n\n//   // const _baseDot = new THREE.Group();\n//   // _baseDot.attach(_grayDot);\n//   // _baseDot.attach(_whiteDot);\n\n//   // const _dotTL = _baseDot.clone();\n//   // _dotTL.position.x = bbox.min.x;\n//   // _dotTL.position.y = bbox.max.y;\n//   // _dotTL.scale.x = dotSize;\n//   // _dotTL.scale.y = dotSize;\n//   // _dotTL.userData = getThreeUserDataFromEditBBox(\n//   //   editBBox,\n//   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n//   // );\n//   // editBBoxResizeThree.attach(_dotTL);\n\n//   // const _dotTR = _baseDot.clone();\n//   // _dotTR.position.x = bbox.max.x;\n//   // _dotTR.position.y = bbox.max.y;\n//   // _dotTR.scale.x = dotSize;\n//   // _dotTR.scale.y = dotSize;\n//   // _dotTR.userData = getThreeUserDataFromEditBBox(\n//   //   editBBox,\n//   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n//   // );\n//   // editBBoxResizeThree.attach(_dotTR);\n\n//   // const _dotBL = _baseDot.clone();\n//   // _dotBL.position.x = bbox.min.x;\n//   // _dotBL.position.y = bbox.min.y;\n//   // _dotBL.scale.x = dotSize;\n//   // _dotBL.scale.y = dotSize;\n//   // _dotBL.userData = getThreeUserDataFromEditBBox(\n//   //   editBBox,\n//   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n//   // );\n//   // editBBoxResizeThree.attach(_dotBL);\n\n//   // const _dotBR = _baseDot.clone();\n//   // _dotBR.position.x = bbox.max.x;\n//   // _dotBR.position.y = bbox.min.y;\n//   // _dotBR.scale.x = dotSize;\n//   // _dotBR.scale.y = dotSize;\n//   // _dotBL.userData = getThreeUserDataFromEditBBox(\n//   //   editBBox,\n//   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n//   // );\n//   // editBBoxResizeThree.attach(_dotBR);\n\n//   // appThree.scene.add(editBBoxResizeThree);\n//   appThree.scene.add(editBBoxThree);\n// } else {\n//   const name = getThreeNameFromEditBBoxId(prevEditBBox.id);\n//   const editBBoxThree = appThree.scene.getObjectByUserDataProperty(\n//     \"name\",\n//     name\n//   );\n\n//   if (editBBoxThree === undefined) {\n//     return;\n//   }\n\n//   const bbox = new THREE.Box3();\n\n//   if (editBBox.selectedIds.length > 0) {\n//     editBBox.selectedIds.forEach((obj) => {\n//       const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n//       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n//       if (object === undefined) {\n//         return;\n//       }\n\n//       bbox.expandByObject(object);\n\n//       const isGroup = obj.objectType === ObjectTypes.Group;\n//       const isInGroup = obj.groupId !== undefined && obj.groupId.length > 0;\n//       if (isGroup || isInGroup) {\n//         console.log(\"robie bbox dla grupy..\", obj.id, obj.groupId);\n//       }\n//     });\n//   }\n\n//   // if (editBBox.beadIds.length > 0) {\n//   //   editBBox.beadIds.forEach((beadId) => {\n//   //     const name = getThreeNameFromBeadId(beadId);\n//   //     const object = appThree.scene.getObjectByUserDataProperty(\n//   //       \"name\",\n//   //       name\n//   //     );\n//   //     if (object === undefined) {\n//   //       return;\n//   //     }\n//   //     bbox.expandByObject(object);\n//   //   });\n//   // }\n\n//   // if (editBBox.regionsIds.length > 0) {\n//   //   editBBox.regionsIds.forEach((regionsId) => {\n//   //     const name = getThreeNameFromRegionId(regionsId);\n//   //     const object = appThree.scene.getObjectByUserDataProperty(\n//   //       \"name\",\n//   //       name\n//   //     );\n//   //     if (object === undefined) {\n//   //       return;\n//   //     }\n//   //     bbox.expandByObject(object);\n//   //   });\n//   // }\n\n//   const x = bbox.min.x;\n//   const y = bbox.min.y;\n//   const w = Math.abs(bbox.max.x - bbox.min.x);\n//   const h = Math.abs(bbox.max.y - bbox.min.y);\n\n//   console.log(\"jaki jest bbxo?\", bbox, x, y, w, h);\n\n//   editBBoxThree.userData.position.x = x + w / 2;\n//   editBBoxThree.userData.position.y = y + h / 2;\n//   editBBoxThree.position.x = x + w / 2;\n//   editBBoxThree.position.y = y + h / 2;\n//   // editBBoxThree.position.z = 200;\n//   editBBoxThree.scale.x = w;\n//   editBBoxThree.scale.y = h;\n//   editBBoxThree.scale.z = 1;\n\n//   // const nameTL = getThreeNameFromEditBBoxId(\n//   //   editBBox.id,\n//   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n//   // );\n//   // const _dotTL = appThree.scene.getObjectByUserDataProperty(\"name\", nameTL);\n//   // if (_dotTL !== undefined) {\n//   //   _dotTL.position.x = bbox.min.x;\n//   //   _dotTL.position.y = bbox.max.y;\n//   //   _dotTL.scale.x = dotSize;\n//   //   _dotTL.scale.y = dotSize;\n//   // }\n//   // const nameTR = getThreeNameFromEditBBoxId(\n//   //   editBBox.id,\n//   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n//   // );\n//   // const _dotTR = appThree.scene.getObjectByUserDataProperty(\"name\", nameTR);\n//   // if (_dotTR !== undefined) {\n//   //   _dotTR.position.x = bbox.max.x;\n//   //   _dotTR.position.y = bbox.max.y;\n//   //   _dotTR.scale.x = dotSize;\n//   //   _dotTR.scale.y = dotSize;\n//   // }\n//   // const nameBL = getThreeNameFromEditBBoxId(\n//   //   editBBox.id,\n//   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n//   // );\n//   // const _dotBL = appThree.scene.getObjectByUserDataProperty(\"name\", nameBL);\n//   // if (_dotBL !== undefined) {\n//   //   _dotBL.position.x = bbox.min.x;\n//   //   _dotBL.position.y = bbox.min.y;\n//   //   _dotBL.scale.x = dotSize;\n//   //   _dotBL.scale.y = dotSize;\n//   // }\n//   // const nameBR = getThreeNameFromEditBBoxId(\n//   //   editBBox.id,\n//   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n//   // );\n//   // const _dotBR = appThree.scene.getObjectByUserDataProperty(\"name\", nameBR);\n//   // if (_dotBR !== undefined) {\n//   //   _dotBR.position.x = bbox.max.x;\n//   //   _dotBR.position.y = bbox.min.y;\n//   //   _dotBR.scale.x = dotSize;\n//   //   _dotBR.scale.y = dotSize;\n//   // }\n// }\n// };\n\n// export const triggerSelectRegion = (id: string, shouldSelect: boolean) => {\n//   const name = getThreeNameFromRegionId(id);\n//   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n//   if (object === undefined) {\n//     console.warn(\"triggerSelectRegion: object not found by name\", name);\n//     return;\n//   }\n\n// if (shouldSelect === true) {\n//   // if (appThree.additionalData.selectedBBox !== undefined) {\n//   //   return;\n//   // }\n//   // console.log(\"dodaj kropki\");\n\n//   const bbox = new THREE.Box3();\n//   bbox.expandByObject(object);\n//   // console.log('jaki bbox?', bbox);\n//   const resizeGroup = getResizeDots(bbox);\n//   resizeGroup.forEach((obj) => {\n//     appThree.scene.attach(obj);\n//   });\n\n//   appThree.additionalData.selectedBBox = {\n//     topLeft: {\n//       x: bbox.min.x,\n//       y: bbox.max.y,\n//       z: 0,\n//     },\n//     topRight: {\n//       x: bbox.max.x,\n//       y: bbox.max.y,\n//       z: 0,\n//     },\n//     bottomLeft: {\n//       x: bbox.min.x,\n//       y: bbox.min.y,\n//       z: 0,\n//     },\n//     bottomRight: {\n//       x: bbox.max.x,\n//       y: bbox.min.y,\n//       z: 0,\n//     },\n//   };\n\n//   // object.attach(resizeGroup)\n// } else {\n//   // console.log(\"usun kropki\");\n//   for (let i = appThree.scene.children.length - 1; i >= 0; i--) {\n//     if (appThree.scene.children[i].layers.mask === 4) {\n//       appThree.scene.remove(appThree.scene.children[i]);\n//     }\n//   }\n\n//   appThree.additionalData.selectedBBox = undefined;\n// }\n// };\n","import { AppEvents } from \"../AppEventType\";\nimport { Store } from \"../store\";\nimport { AppHistory } from \"../AppHistory\";\nimport produce from \"immer\";\nimport { getTopBarPosition } from \"../../threejs/eventEmitterHandlers\";\nimport { getMousePositionAtWindow } from \"../../threejs/mouseListeners/mouseScreenPosition\";\nimport { appThree } from \"../../threejs/renderThreejs\";\n\nexport class BaseEventHandler<T extends AppEvents> {\n  store: Store;\n  event: T;\n  history: AppHistory;\n  saveToHistory: boolean;\n  constructor(\n    event: T,\n    store: Store,\n    history: AppHistory,\n    saveToHistory: boolean\n  ) {\n    this.store = store;\n    this.history = history;\n    this.event = event;\n    this.saveToHistory = saveToHistory;\n  }\n\n  getNewStoreWithTopBarPosition(store: Store) {\n    return produce(store, (draft) => {\n      const position = getTopBarPosition(\n        store.selectedIds.map((id) => {\n          return { id, objectType: store.objects[id].objectType };\n        })\n      );\n      draft.ui.selectedTopBarPosition = position;\n    });\n  }\n\n  getCenterPosition() {\n    const { width, height, top, left } = appThree.el.getBoundingClientRect();\n    const posX = left + width / 2;\n    const posY = top + height / 2;\n    return { posX, posY };\n  }\n\n  getMousePosition() {\n    let posX = 0;\n    let posY = 0;\n    const pos = getMousePositionAtWindow();\n    if (pos === undefined) {\n      const center = this.getCenterPosition();\n      posX = center.posX;\n      posY = center.posY;\n    } else {\n      posX = pos.x;\n      posY = pos.y;\n    }\n    return { posX, posY };\n  }\n\n  getStoreWithHistory(_store?: Store) {\n    const store = _store === undefined ? this.store : _store;\n    return produce(store, (draft) => {\n      draft.history.canRedo = this.history.canRedo();\n      draft.history.canUndo = this.history.canUndo();\n      draft.history.events = this.history.getSimpleHistoryEvents();\n    });\n  }\n}\n","import { produce } from \"immer\";\nimport * as THREE from \"three\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport {\n  AppObject,\n  Bead,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n  Region,\n} from \"../../editorObjects/Editor\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { buildPreviewProject3D } from \"../../editorObjects/PreviewProject3D\";\nimport { buildRegion } from \"../../editorObjects/Region\";\nimport { getTopBarPosition } from \"../../threejs/eventEmitterHandlers\";\nimport { screenToWorld } from \"../../threejs/mouseListeners/screenToWorld\";\nimport { getSelectBBox } from \"../../threejs/SelectBBox\";\nimport { AppEvents } from \"../AppEventType\";\nimport { BaseEventHandler } from \"./BaseEventHandler\";\n\nexport interface IBaseEventHandler {\n  run(refreshThreejs: boolean, refreshReact: boolean): void;\n}\nexport class StoreObjectHandler<T extends AppEvents>\n  extends BaseEventHandler<T>\n  implements IBaseEventHandler {\n  run(refreshThreejs: boolean = true, refreshReact: boolean = true) {}\n\n  getAppObjectFromCloneAppObject(object: Partial<AppObject>) {\n    if (object.objectType === undefined) {\n      console.warn(\"object type not found in payload: \", object);\n      return undefined;\n    }\n    if (object.objectType === ObjectTypes.Bead) {\n      return buildBead(object);\n    }\n    if (object.objectType === ObjectTypes.Region) {\n      return buildRegion(object);\n    }\n    if (object.objectType === ObjectTypes.Group) {\n      return buildGroup(object);\n    }\n    if (object.objectType === ObjectTypes.PreviewProject3D) {\n      return buildPreviewProject3D(object);\n    }\n    console.warn(\"unknow object type from payload: \", object);\n    return undefined;\n  }\n\n  selectObjectOnThreeScene(object: AppObject, isSelected: boolean) {\n    if (object === undefined) {\n      return;\n    }\n\n    getSelectBBox().updateRect(\n      {\n        depth: object.depth,\n        height: object.height,\n        width: object.width,\n        id: object.id,\n        position: new THREE.Vector3(\n          object.position.x,\n          object.position.y,\n          object.position.z\n        ),\n        rotation: new THREE.Vector3(\n          object.rotateX,\n          object.rotateY,\n          object.rotateZ\n        ),\n      },\n      isSelected\n    );\n\n    // if (object.objectType === ObjectTypes.Bead) {\n    //   triggerSelectBead(object.id, isSelected);\n    // }\n    // if (object.objectType === ObjectTypes.Region) {\n    //   triggerSelectRegion(object.id, isSelected);\n    // }\n  }\n\n  deleteSelectedObjectsFromStore(ids: string[], objects: AppObject[]) {\n    return produce(this.store, (draft) => {\n      ids.forEach((id) => {\n        const object = this.store.objects[id];\n        if (draft.selectedIds.includes(id)) {\n          const index = draft.selectedIds.indexOf(id);\n          draft.selectedIds.splice(index, 1);\n          this.selectObjectOnThreeScene(object, false);\n        }\n\n        if (draft.objects[object.id] !== undefined) {\n          objects.push(object);\n          if (object.objectType === ObjectTypes.Region) {\n            (object as Region).childrenGridIds.forEach((_beadId) => {\n              if (_beadId !== undefined) {\n                (draft.objects[_beadId] as Bead).regionId = undefined;\n              }\n            });\n          }\n          delete draft.objects[object.id];\n        }\n      });\n\n      draft.ui.selectedTopBarPosition = getTopBarPosition(\n        draft.selectedIds.map((id) => {\n          return { id, objectType: draft.objects[id].objectType };\n        })\n      );\n    });\n  }\n\n  getPositionDiffFromMousePosition(objects: AppObject[]) {\n    const { posX, posY } = this.getMousePosition();\n    const worldPos = screenToWorld(posX, posY);\n    const bbox = new THREE.Box3();\n    objects.forEach((object) => {\n      const w = object.width / 2;\n      const h = object.height / 2;\n      const x = object.position.x;\n      const y = object.position.y;\n      bbox.expandByPoint(new THREE.Vector3().set(x - w, y - h, 0.1));\n      bbox.expandByPoint(new THREE.Vector3().set(x + w, y - h, 0.2));\n      bbox.expandByPoint(new THREE.Vector3().set(x - w, y + h, 0.1));\n      bbox.expandByPoint(new THREE.Vector3().set(x + w, y + h, 0.1));\n    });\n    const bboxCenter = new THREE.Vector3();\n    bbox.getCenter(bboxCenter);\n    const diffX = worldPos.x - bboxCenter.x;\n    const diffY = worldPos.y - bboxCenter.y;\n    return {\n      diffX,\n      diffY,\n    };\n  }\n\n  moveObjectsByDiff(objects: AppObject[], diffX: number, diffY: number) {\n    objects.forEach((object) => {\n      if (object.objectType === ObjectTypes.Group) {\n        object.position.x = object.position.x + diffX;\n        object.position.y = object.position.y + diffY;\n        objects.forEach((obj) => {\n          if ((object as Group).childrenIds.includes(obj.id)) {\n            obj.position.x = obj.position.x + diffX;\n            obj.position.y = obj.position.y + diffY;\n          }\n        });\n      } else {\n        if (object[groupIdKey] === undefined) {\n          object.position.x = object.position.x + diffX;\n          object.position.y = object.position.y + diffY;\n        }\n      }\n    });\n  }\n}\n","import produce from \"immer\";\nimport { AddObjects, AppEventType } from \"../AppEventType\";\nimport { setStore, shouldRefreshReact, shouldRefreshThree } from \"../store\";\nimport { AddObjectsHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  AppObject,\n  Bead,\n  ObjectTypes,\n  Region,\n} from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { formatISO } from \"date-fns\";\n\nexport class AddObjectHandler extends StoreObjectHandler<AddObjects> {\n  run() {\n    const objects: AppObject[] = [];\n    let newStore = produce(this.store, (draft) => {\n      this.event.payload.objects.forEach((object) => {\n        let newObject = this.getAppObjectFromCloneAppObject(object);\n        if (newObject === undefined) {\n          return;\n        }\n        if (newObject.objectType === ObjectTypes.Region) {\n          (newObject as Region).childrenGridIds.forEach((_beadId) => {\n            if (_beadId !== undefined) {\n              (draft.objects[_beadId] as Bead).regionId = newObject!.id;\n            }\n          });\n        }\n        draft.objects[newObject.id] = newObject;\n        objects.push(newObject);\n      });\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: AddObjectsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.AddObjects,\n          payload: { objects: objects },\n        },\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: { ids: objects.map((b) => b.id) },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    setStore(newStore);\n\n    if (shouldRefreshThree()) {\n      objects.forEach((obj) => {\n        addObjectByObjectType(obj);\n      });\n    }\n\n    if (shouldRefreshReact()) {\n      refreshReactState(newStore);\n    }\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import { AppObject } from \"../../editorObjects/Editor\";\nimport { AppEventType, RemoveObjects } from \"../AppEventType\";\nimport { setStore, shouldRefreshReact, shouldRefreshThree } from \"../store\";\nimport { RemoveObjectsHistory } from \"../AppHistory\";\nimport { triggerDeleteObjectIds } from \"../../threejs/eventEmitterHandlers\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { formatISO } from \"date-fns\";\n\nexport class RemoveObjectHandler extends StoreObjectHandler<RemoveObjects> {\n  run() {\n    const { ids } = this.event.payload;\n    const objects: AppObject[] = [];\n    let newStore = this.deleteSelectedObjectsFromStore(ids, objects);\n\n    if (this.saveToHistory) {\n      const historyEvent: RemoveObjectsHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.AddObjects,\n          payload: { objects },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    setStore(newStore);\n\n    if (shouldRefreshThree()) {\n      triggerDeleteObjectIds(\n        objects.map((obj) => {\n          return { id: obj.id, objectType: obj.objectType };\n        })\n      );\n    }\n\n    if (shouldRefreshReact()) {\n      refreshReactState(newStore);\n    }\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { ChangeSelectObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\n\nexport class ChangeSelectObjectsHandler extends StoreObjectHandler<ChangeSelectObjects> {\n  run() {\n    const { change } = this.event.payload;\n\n    const historyChange: { id: string; isSelected: boolean }[] = [];\n    let newStore = produce(this.store, (draft) => {\n      change.forEach((obj) => {\n        if (draft.objects[obj.id] === undefined) {\n          console.warn(\"no object found in store\", obj.id);\n          return;\n        }\n        if (draft.selectedIds.includes(obj.id) === true) {\n          if (obj.isSelected === true) {\n            // do nothing\n          } else {\n            draft.selectedIds.splice(draft.selectedIds.indexOf(obj.id), 1);\n          }\n        } else {\n          if (obj.isSelected === true) {\n            draft.selectedIds.push(obj.id);\n          } else {\n            // nothing\n          }\n        }\n        historyChange.push({\n          id: obj.id,\n          isSelected: obj.isSelected,\n        });\n      });\n    });\n    // setStore(newStore);\n\n    // @INFO: Remove later\n    // if (this.saveToHistory) {\n    //   const historyEvent: ChangeSelectObjectsHistory = {\n    //     do: this.event,\n    //     redo: this.event,\n    //     undo: {\n    //       name: AppEventType.ChangeSelectObjects,\n    //       payload: { change: historyChange },\n    //     },\n    //   };\n    //   this.history.push(historyEvent);\n    // }\n    // appThree.additionalData.selectedBBox = undefined;\n\n    historyChange.forEach((change) => {\n      const object = newStore.objects[change.id];\n      if (object === undefined) {\n        return;\n      }\n      this.selectObjectOnThreeScene(object, change.isSelected);\n    });\n    // refreshReactState(newStore);\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport {\n  addObjectByObjectType,\n  triggerDeleteObjectIds,\n  updateObjectPosition,\n} from \"../../threejs/eventEmitterHandlers\";\nimport {\n  ChangeObjectsProperty,\n  AppEventType,\n  ChangeObject,\n} from \"../AppEventType\";\nimport { ChangeObjectsPropertyHistory } from \"../AppHistory\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport {\n  setStore,\n  shouldRefreshReact,\n  shouldRefreshThree,\n  Store,\n} from \"../store\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport {\n  AppObject,\n  Bead,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n  Point,\n  Region,\n  RegionGridType,\n  RegionShape,\n} from \"../../editorObjects/Editor\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { WritableDraft } from \"immer/dist/internal\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { contain } from \"../../editorObjects/Point\";\nimport { isActiveRegionCell } from \"../../editorObjects/Region\";\nimport { logger } from \"../../logger\";\nimport { getSelectBBox } from \"../../threejs/SelectBBox\";\nimport { formatISO } from \"date-fns\";\n\ntype ObjectsMap = { [key: string]: AppObject };\n\nexport class ChangeObjectsPropertyHandler extends StoreObjectHandler<ChangeObjectsProperty> {\n  run() {\n    const added: AppObject[] = [];\n    const updated: ObjectsMap = {};\n    const removed: AppObject[] = [];\n    const { changes } = this.event.payload;\n    const historyChanges: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n    let newStore = produce(this.store, (draft) => {\n      changes.forEach((_singleChange) => {\n        if (draft.objects[_singleChange.id] === undefined) {\n          logger.warn(\"no object found in store\", _singleChange.id);\n          return;\n        }\n        const singleHistoryChange: ChangeObject = {\n          id: _singleChange.id,\n          properties: {},\n          relatedChanges: [],\n          shouldBeCreated: [],\n          shouldBeDeleted: [],\n        };\n        const keyNames = Object.keys(_singleChange.properties);\n        if (singleHistoryChange !== undefined) {\n          keyNames.forEach((key) => {\n            singleHistoryChange.properties[key] = cloneDeep(\n              draft.objects[_singleChange.id][key]\n            );\n          });\n        }\n        keyNames.forEach((key) => {\n          draft.objects[_singleChange.id][key] = cloneDeep(\n            _singleChange.properties[key]\n          );\n        });\n\n        if (_singleChange.relatedChanges) {\n          _singleChange.relatedChanges.forEach((_singeRelatedChange) => {\n            if (draft.objects[_singeRelatedChange.id] === undefined) {\n              logger.warn(\"no object found in store\", _singeRelatedChange.id);\n              return;\n            }\n            const keyNames = Object.keys(_singeRelatedChange.properties);\n            keyNames.forEach((key) => {\n              draft.objects[_singeRelatedChange.id][key] = cloneDeep(\n                _singeRelatedChange.properties[key]\n              );\n            });\n          });\n        }\n\n        historyChanges.push(singleHistoryChange);\n      });\n\n      changes.forEach((_singleChange, index) => {\n        if (draft.objects[_singleChange.id] === undefined) {\n          logger.warn(\"no object found in store\", _singleChange.id);\n          return;\n        }\n        const objectType = draft.objects[_singleChange.id].objectType;\n        const singleHistoryChange = historyChanges[index];\n\n        if (objectType === ObjectTypes.Bead) {\n          this.whenBead(\n            _singleChange,\n            draft,\n            singleHistoryChange,\n            added,\n            updated,\n            removed\n          );\n        }\n\n        if (objectType === ObjectTypes.Region) {\n          this.whenRegion(\n            _singleChange,\n            draft,\n            singleHistoryChange,\n            added,\n            updated,\n            removed\n          );\n        }\n      });\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: ChangeObjectsPropertyHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.ChangeObjectsProperty,\n          payload: {\n            changes: this.event.payload.changes.map(\n              ({ id, properties, relatedChanges }) => {\n                const index = historyChanges.findIndex((e) => e.id === id);\n                const exists = index !== -1;\n                const shouldBeCreated = exists\n                  ? historyChanges[index].shouldBeDeleted\n                  : [];\n                const shouldBeDeleted = exists\n                  ? historyChanges[index].shouldBeCreated\n                  : [];\n\n                return {\n                  id,\n                  properties,\n                  relatedChanges,\n                  shouldBeCreated,\n                  shouldBeDeleted,\n                };\n              }\n            ),\n          },\n        },\n        undo: {\n          name: AppEventType.ChangeObjectsProperty,\n          payload: { changes: historyChanges },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n\n    newStore = this.getStoreWithHistory(newStore);\n\n    if (shouldRefreshThree()) {\n      // @INFO: CHANGES IN THREEJS\n      changes.forEach((_singleChange) => {\n        this.applyChangesToThree(_singleChange, newStore);\n        notifyBackend([\n          {\n            action: SaveEventType.UPDATE,\n            createdAt: new Date().toISOString(),\n            object: newStore.objects[_singleChange.id],\n          },\n        ]);\n\n        if (_singleChange.relatedChanges) {\n          _singleChange.relatedChanges.forEach((_singeRelatedChange) => {\n            this.applyChangesToThree(_singeRelatedChange, newStore);\n            notifyBackend([\n              {\n                action: SaveEventType.UPDATE,\n                createdAt: new Date().toISOString(),\n                object: newStore.objects[_singeRelatedChange.id],\n              },\n            ]);\n          });\n        }\n      });\n    }\n\n    if (shouldRefreshThree()) {\n      if (added.length > 0) {\n        added.forEach((obj) => {\n          addObjectByObjectType(obj);\n        });\n\n        notifyBackend(\n          added.map((object) => {\n            return {\n              action: SaveEventType.CREATE,\n              createdAt: new Date().toISOString(),\n              object,\n            };\n          })\n        );\n      }\n\n      const updatedKeys = Object.keys(updated);\n      if (updatedKeys.length > 0) {\n        triggerDeleteObjectIds(\n          updatedKeys.map((id) => {\n            return {\n              id,\n              objectType: newStore.objects[id].objectType,\n            };\n          })\n        );\n\n        updatedKeys.forEach((id) => {\n          addObjectByObjectType(newStore.objects[id]);\n        });\n\n        notifyBackend(\n          updatedKeys.map((id) => {\n            return {\n              action: SaveEventType.UPDATE,\n              createdAt: new Date().toISOString(),\n              object: newStore.objects[id],\n            };\n          })\n        );\n      }\n\n      if (removed.length > 0) {\n        triggerDeleteObjectIds(\n          removed.map((obj) => {\n            return { id: obj.id, objectType: obj.objectType };\n          })\n        );\n        notifyBackend(\n          removed.map((object) => {\n            return {\n              action: SaveEventType.DELETE,\n              createdAt: new Date().toISOString(),\n              object,\n            };\n          })\n        );\n      }\n    }\n\n    if (shouldRefreshThree()) {\n      newStore = this.getNewStoreWithTopBarPosition(newStore);\n    }\n\n    setStore(newStore);\n\n    if (shouldRefreshReact()) {\n      refreshReactState(newStore);\n    }\n\n    if (shouldRefreshThree()) {\n      const selectBBox = getSelectBBox();\n      selectBBox.syncRectsWithStore();\n    }\n  }\n\n  applyChangesToThree(_singleChange: ChangeObject, _store: Store) {\n    if (_store.objects[_singleChange.id] === undefined) {\n      logger.warn(\"no object found in store\", _singleChange.id);\n      return;\n    }\n    const object = _store.objects[_singleChange.id];\n    const inGroup =\n      object[groupIdKey] !== undefined && object[groupIdKey].length > 0;\n\n    const positionKey: keyof AppObject = \"position\";\n    // const objectType = _store.objects[_singleChange.id].objectType;\n    const keyNames = Object.keys(_singleChange.properties);\n    const isPositionOnly =\n      keyNames.length === 1 && keyNames.includes(positionKey) === true;\n    if (isPositionOnly && inGroup === false) {\n      updateObjectPosition(\n        _singleChange.id,\n        object.objectType,\n        object.position.x,\n        object.position.y\n      );\n    }\n    // else if (objectType === ObjectTypes.Region) {\n    // const isShapeOnly =\n    // keyNames.length === 1 && keyNames.includes(\"shape\") === true;\n    // }\n    else {\n      triggerDeleteObjectIds([\n        {\n          id: _singleChange.id,\n          objectType: object.objectType,\n        },\n      ]);\n\n      addObjectByObjectType(object);\n\n      if (inGroup) {\n        if (\n          object[groupIdKey] !== undefined &&\n          _store.objects[object[groupIdKey]]\n        ) {\n          (_store.objects[object[groupIdKey]] as Group).childrenIds.forEach(\n            (id) => {\n              const obj = _store.objects[id];\n              triggerDeleteObjectIds([\n                {\n                  id: id,\n                  objectType: obj.objectType,\n                },\n              ]);\n              addObjectByObjectType(obj);\n            }\n          );\n        }\n      }\n    }\n  }\n\n  whenBead(\n    _singleChange: ChangeObject,\n    draft: WritableDraft<Store>,\n    singleHistoryChange: ChangeObject,\n    added: AppObject[],\n    updated: ObjectsMap,\n    removed: AppObject[]\n  ) {\n    const positionKey: keyof AppObject = \"position\";\n    const regionIdKey: keyof Bead = \"regionId\";\n    const childrenGridIdsKey: keyof Region = \"childrenGridIds\";\n    const keyNames = Object.keys(_singleChange.properties);\n\n    if (keyNames.includes(positionKey)) {\n      let isBeadFoundRegion = false;\n      const bead = draft.objects[_singleChange.id] as Bead;\n      const regionId = (draft.objects[_singleChange.id] as Bead).regionId;\n\n      if (regionId !== undefined) {\n        const region = draft.objects[regionId] as Region;\n        if (this.isRegionContainBead(region, bead) === true) {\n          const { column, row, index: newIndex } = this.getRegionCellIndex(\n            bead.position.x,\n            bead.position.y,\n            region\n          );\n          // if (column < 0) {\n          //   console.warn(\"whenBead :: column < 0\", column, row, bead.id);\n          // }\n          const isActiveCell = isActiveRegionCell(region, newIndex);\n          if (isActiveCell === true) {\n            const oldIndex = region.childrenGridIds.indexOf(bead.id);\n            if (oldIndex !== -1 && oldIndex !== newIndex) {\n              draft.objects[regionId][childrenGridIdsKey][oldIndex] = undefined;\n            }\n            if (\n              draft.objects[regionId][childrenGridIdsKey][newIndex] !==\n              undefined\n            ) {\n              draft.objects[regionId][childrenGridIdsKey][newIndex] = bead.id;\n              isBeadFoundRegion = true;\n              if (region.snapBeadsToCell === true) {\n                const position = this.getRegionCellCenter(region, row, column);\n                draft.objects[bead.id].position.x = position.x;\n                draft.objects[bead.id].position.y = position.y;\n              }\n            }\n          }\n        }\n      }\n\n      if (isBeadFoundRegion === false) {\n        Object.keys(draft.objects).forEach((regionId) => {\n          if (draft.objects[regionId].objectType !== ObjectTypes.Region) {\n            return;\n          }\n          const region = draft.objects[regionId] as Region;\n\n          if (this.isRegionContainBead(region, bead) === false) {\n            return;\n          }\n          const { column, row, index: newIndex } = this.getRegionCellIndex(\n            bead.position.x,\n            bead.position.y,\n            region\n          );\n\n          // if (column < 0) {\n          //   console.warn(\"whenBead :: column < 0\", column, row, bead.id);\n          // }\n          const isActiveCell = isActiveRegionCell(region, newIndex);\n          if (isActiveCell === true) {\n            if (region.childrenGridIds[newIndex] === undefined) {\n              const currentIndex = region.childrenGridIds.indexOf(bead.id);\n              if (currentIndex !== -1 && currentIndex !== newIndex) {\n                draft.objects[regionId][childrenGridIdsKey][\n                  currentIndex\n                ] = undefined;\n              }\n              draft.objects[regionId][childrenGridIdsKey][newIndex] = bead.id;\n\n              updated[regionId] = cloneDeep(draft.objects[regionId]);\n\n              if (draft.objects[bead.id][regionIdKey] !== undefined) {\n                const oldRegionId = draft.objects[bead.id][regionIdKey];\n                const oldRegion = draft.objects[oldRegionId] as Region;\n                const currentIndex = oldRegion.childrenGridIds.indexOf(bead.id);\n                if (currentIndex !== -1) {\n                  draft.objects[oldRegionId][childrenGridIdsKey][\n                    currentIndex\n                  ] = undefined;\n                  updated[oldRegionId] = cloneDeep(draft.objects[oldRegionId]);\n                }\n              }\n\n              draft.objects[bead.id][regionIdKey] = region.id;\n              isBeadFoundRegion = true;\n\n              if (region.snapBeadsToCell === true) {\n                const position = this.getRegionCellCenter(region, row, column);\n                draft.objects[bead.id].position.x = position.x;\n                draft.objects[bead.id].position.y = position.y;\n              }\n            } else if (region.childrenGridIds[newIndex] === bead.id) {\n              if (region.snapBeadsToCell === true) {\n                const position = this.getRegionCellCenter(region, row, column);\n                draft.objects[bead.id].position.x = position.x;\n                draft.objects[bead.id].position.y = position.y;\n                isBeadFoundRegion = true;\n              }\n            }\n          }\n        });\n      }\n\n      if (isBeadFoundRegion === false) {\n        if (regionId !== undefined) {\n          const region = draft.objects[regionId] as Region;\n          const currentIndex = region.childrenGridIds.indexOf(bead.id);\n          if (currentIndex !== -1) {\n            draft.objects[regionId][childrenGridIdsKey][\n              currentIndex\n            ] = undefined;\n\n            updated[regionId] = cloneDeep(draft.objects[regionId]);\n          }\n\n          (draft.objects[_singleChange.id] as Bead).regionId = undefined;\n        }\n      }\n    }\n  }\n\n  whenRegion(\n    _singleChange: ChangeObject,\n    draft: WritableDraft<Store>,\n    singleHistoryChange: ChangeObject,\n    added: AppObject[],\n    updated: ObjectsMap,\n    removed: AppObject[]\n  ) {\n    const keyNames = Object.keys(_singleChange.properties);\n    const shapeKey: keyof Region = \"shape\";\n    const gridTypeKey: keyof Region = \"gridType\";\n    const autoFillBeadsKey: keyof Region = \"autoFillBeads\";\n    const snapBeadsToCellKey: keyof Region = \"snapBeadsToCell\";\n    const rowsKey: keyof Region = \"rows\";\n    const columnsKey: keyof Region = \"columns\";\n    const positionKey: keyof Region = \"position\";\n\n    const { shouldBeDeleted } = _singleChange;\n\n    if (shouldBeDeleted !== undefined && shouldBeDeleted.length > 0) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const tempIds: string[] = [];\n\n      shouldBeDeleted.forEach((bead) => {\n        if (draft.objects[bead.id] === undefined) {\n          logger.warn(\"whenRegion:: bead not found\", bead.id);\n          return;\n        }\n\n        tempIds.push(bead.id);\n        removed.push(cloneDeep(bead));\n        delete draft.objects[bead.id];\n      });\n\n      region.childrenGridIds.forEach((id, index) => {\n        if (id !== undefined && tempIds.includes(id)) {\n          (draft.objects[region.id] as Region).childrenGridIds[\n            index\n          ] = undefined;\n        }\n      });\n    }\n\n    if (\n      keyNames.includes(rowsKey) ||\n      keyNames.includes(columnsKey) ||\n      keyNames.includes(shapeKey) ||\n      keyNames.includes(gridTypeKey)\n    ) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const oldRows = singleHistoryChange.properties[rowsKey];\n      const oldColumns = singleHistoryChange.properties[columnsKey];\n      const oldShape = singleHistoryChange.properties[shapeKey];\n      const oldGridType = singleHistoryChange.properties[gridTypeKey];\n      const autoFillBeadsEnabled = region[autoFillBeadsKey] === true;\n      if (oldRows === undefined || oldColumns === undefined) {\n        logger.warn(\"missing keys: rowsKey && columnsKey\");\n        (draft.objects[region.id] as Region).childrenGridIds.forEach(\n          (beadId) => {\n            if (beadId === undefined) {\n              return;\n            }\n            const bead = draft.objects[beadId] as Bead;\n            if (bead === undefined) {\n              logger.warn(\"toDeleteBeadIds:: bead not found\", beadId);\n              return;\n            }\n\n            singleHistoryChange.shouldBeCreated!.push(cloneDeep(bead));\n            removed.push(cloneDeep(bead));\n            delete draft.objects[beadId];\n          }\n        );\n        const newSize = region.rows * region.columns;\n        (draft.objects[region.id] as Region).childrenGridIds = Array(\n          newSize\n        ).fill(undefined);\n      } else if (\n        oldShape !== region.shape ||\n        oldRows !== region.rows ||\n        oldColumns !== region.columns ||\n        oldGridType !== region.gridType\n      ) {\n        const {\n          toDeleteBeadIds,\n          newChildrenGridIds,\n        } = this.getRegionChildrenGridIdsAfterResize(\n          region,\n          autoFillBeadsEnabled,\n          oldRows,\n          oldColumns\n        );\n\n        toDeleteBeadIds.forEach((beadId) => {\n          const bead = draft.objects[beadId] as Bead;\n          if (bead === undefined) {\n            logger.warn(\"toDeleteBeadIds:: bead not found\", beadId);\n            return;\n          }\n\n          singleHistoryChange.shouldBeCreated!.push(cloneDeep(bead));\n          removed.push(cloneDeep(bead));\n          delete draft.objects[beadId];\n        });\n\n        (draft.objects[region.id] as Region).childrenGridIds = cloneDeep(\n          newChildrenGridIds\n        );\n      }\n    }\n\n    if (\n      keyNames.includes(positionKey) ||\n      keyNames.includes(snapBeadsToCellKey)\n    ) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const snapBeadsToCellEnabled = region[snapBeadsToCellKey] === true;\n\n      if (snapBeadsToCellEnabled) {\n        region.childrenGridIds.forEach((id, index) => {\n          if (id !== undefined) {\n            const bead = draft.objects[id] as Bead;\n            if (bead !== undefined) {\n              const oldPosition = cloneDeep(bead.position);\n              const { row, column } = this.getRegionCellIndex(\n                bead.position.x,\n                bead.position.y,\n                region\n              );\n              const { x, y } = this.getRegionCellCenter(region, row, column);\n              draft.objects[id].position.x = x;\n              draft.objects[id].position.y = y;\n              updated[id] = cloneDeep(draft.objects[id]);\n              singleHistoryChange.relatedChanges?.push({\n                id,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                },\n              });\n            }\n          } else {\n            const region = draft.objects[_singleChange.id] as Region;\n            let foundObject = false;\n            Object.keys(draft.objects).forEach((id) => {\n              if (foundObject === true) {\n                return;\n              }\n              if (draft.objects[id].objectType !== ObjectTypes.Bead) {\n                return;\n              }\n\n              const bead = draft.objects[id] as Bead;\n\n              if (bead.groupId !== undefined) {\n                return;\n              }\n\n              if (bead.regionId !== undefined) {\n                return;\n              }\n\n              const isActiveCell = isActiveRegionCell(region, index);\n              if (isActiveCell === false) {\n                return;\n              }\n\n              if (this.isRegionCellContainBead(region, bead, index) === false) {\n                return;\n              }\n\n              const oldPosition = cloneDeep(bead.position);\n              const { row, column } = this.getRegionCellIndex(\n                bead.position.x,\n                bead.position.y,\n                region\n              );\n              const { x, y } = this.getRegionCellCenter(region, row, column);\n\n              (draft.objects[_singleChange.id] as Region).childrenGridIds[\n                index\n              ] = bead.id;\n\n              (draft.objects[bead.id] as Bead).regionId = region.id;\n\n              draft.objects[bead.id].position.x = x;\n              draft.objects[bead.id].position.y = y;\n\n              singleHistoryChange.relatedChanges?.push({\n                id: bead.id,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                  regionId: undefined,\n                },\n              });\n\n              updated[bead.id] = cloneDeep(draft.objects[bead.id]);\n              foundObject = true;\n            });\n          }\n        });\n      } else {\n        const region = draft.objects[_singleChange.id] as Region;\n        const size = region.rows * region.columns;\n        const newChildrenGridIds = Array(size).fill(undefined);\n\n        let emptyCellsCount = size;\n        const keys = Object.keys(draft.objects);\n        for (let i = 0; i < keys.length; i++) {\n          if (emptyCellsCount <= 0) {\n            break;\n          }\n\n          const id = keys[i];\n\n          if (draft.objects[id].objectType !== ObjectTypes.Bead) {\n            continue;\n          }\n\n          const bead = draft.objects[id] as Bead;\n\n          if (bead.groupId !== undefined) {\n            continue;\n          }\n\n          if (this.isRegionContainBead(region, bead) === false) {\n            continue;\n          }\n\n          const { index } = this.getRegionCellIndex(\n            bead.position.x,\n            bead.position.y,\n            region\n          );\n\n          if (index >= 0 && newChildrenGridIds[index] === undefined) {\n            newChildrenGridIds[index] = bead.id;\n            emptyCellsCount = emptyCellsCount - 1;\n          }\n        }\n\n        // obecne beadsy na regionie... ktory bead wypad z regionu?\n        (draft.objects[_singleChange.id] as Region).childrenGridIds.forEach(\n          (beadId) => {\n            if (beadId !== undefined && draft.objects[beadId] !== undefined) {\n              if (newChildrenGridIds.includes(beadId) === false) {\n                singleHistoryChange.relatedChanges?.push({\n                  id: beadId,\n                  properties: {\n                    regionId: (draft.objects[beadId] as Bead).regionId,\n                  },\n                });\n              }\n\n              (draft.objects[beadId] as Bead).regionId = undefined;\n\n              updated[beadId] = cloneDeep(draft.objects[beadId]);\n            }\n          }\n        );\n\n        // tworzymy relacje bead->region dla nowo wybranych beads\n        newChildrenGridIds.forEach((beadId) => {\n          if (beadId !== undefined) {\n            if ((draft.objects[beadId] as Bead).regionId === undefined) {\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  regionId: undefined,\n                },\n              });\n            } else {\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  regionId: (draft.objects[beadId] as Bead).regionId,\n                },\n              });\n            }\n            (draft.objects[beadId] as Bead).regionId = region.id;\n\n            updated[beadId] = cloneDeep(draft.objects[beadId]);\n          }\n        });\n\n        (draft.objects[_singleChange.id] as Region).childrenGridIds = cloneDeep(\n          newChildrenGridIds\n        );\n      }\n    }\n\n    if (\n      keyNames.includes(autoFillBeadsKey) ||\n      keyNames.includes(rowsKey) ||\n      keyNames.includes(columnsKey) ||\n      keyNames.includes(positionKey) ||\n      keyNames.includes(gridTypeKey)\n    ) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const autoFillBeadsEnabled = region[autoFillBeadsKey] === true;\n      const snapBeadsToCellEnabled = region[snapBeadsToCellKey] === true;\n      const size = region.rows * region.columns;\n      if (region.childrenGridIds.length !== size) {\n        logger.warn(\n          \"region childrenIds size have not correct value\",\n          size,\n          region.childrenGridIds.length,\n          region.childrenGridIds\n        );\n        return;\n      }\n\n      if (autoFillBeadsEnabled) {\n        let nextIdIndexFromCreated = { value: 0 };\n        let nextIdIndexFromDeleted = 0;\n        region.childrenGridIds.forEach((beadId, index) => {\n          // @TODO: obecnie nie jest uwzgledniony rotate dla regionu.\n\n          const isActiveCell = isActiveRegionCell(region, index);\n\n          if (isActiveCell === false) {\n            return;\n          }\n\n          if (beadId === undefined) {\n            const { x, y } = this.getRegionCellCenterFromCellIndex(\n              region,\n              index\n            );\n            const id = this.getIdFromUndoOrRedo(\n              _singleChange,\n              nextIdIndexFromCreated,\n              nextIdIndexFromDeleted\n            );\n            const bead = buildBead({\n              id: id,\n              color: \"red\",\n              regionId: region.id,\n            });\n            bead.position.x = x;\n            bead.position.y = y;\n            draft.objects[bead.id] = bead;\n            (draft.objects[region.id] as Region).childrenGridIds[index] =\n              bead.id;\n            added.push(cloneDeep(bead));\n            singleHistoryChange.shouldBeDeleted!.push(cloneDeep(bead));\n          } else {\n            const bead = draft.objects[beadId] as Bead;\n            if (bead !== undefined) {\n              const oldPosition = cloneDeep(bead.position);\n              const { x, y } = this.getRegionCellCenterFromCellIndex(\n                region,\n                index\n              );\n              draft.objects[beadId].position.x = x;\n              draft.objects[beadId].position.y = y;\n              updated[beadId] = cloneDeep(draft.objects[beadId]);\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                },\n              });\n            }\n          }\n        });\n      } else {\n        if (snapBeadsToCellEnabled) {\n          region.childrenGridIds.forEach((beadId, index) => {\n            const isActiveCell = isActiveRegionCell(region, index);\n\n            if (isActiveCell === false) {\n              return;\n            }\n\n            if (beadId !== undefined) {\n              const bead = draft.objects[beadId] as Bead;\n              const oldPosition = cloneDeep(bead.position);\n              const { x, y } = this.getRegionCellCenterFromCellIndex(\n                region,\n                index\n              );\n\n              draft.objects[beadId].position.x = x;\n              draft.objects[beadId].position.y = y;\n\n              updated[beadId] = cloneDeep(draft.objects[beadId]);\n\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                },\n              });\n            } else {\n              const region = draft.objects[_singleChange.id] as Region;\n\n              let foundObject = false;\n              Object.keys(draft.objects).forEach((id) => {\n                if (foundObject === true) {\n                  return;\n                }\n                if (draft.objects[id].objectType !== ObjectTypes.Bead) {\n                  return;\n                }\n\n                const bead = draft.objects[id] as Bead;\n\n                if (bead.groupId !== undefined) {\n                  return;\n                }\n\n                if (bead.regionId !== undefined) {\n                  return;\n                }\n\n                if (\n                  this.isRegionCellContainBead(region, bead, index) === false\n                ) {\n                  return;\n                }\n                const { x, y } = this.getRegionCellCenterFromCellIndex(\n                  region,\n                  index\n                );\n\n                (draft.objects[_singleChange.id] as Region).childrenGridIds[\n                  index\n                ] = bead.id;\n\n                (draft.objects[bead.id] as Bead).regionId = region.id;\n\n                const oldPosition = cloneDeep(bead.position);\n\n                draft.objects[bead.id].position.x = x;\n                draft.objects[bead.id].position.y = y;\n\n                singleHistoryChange.relatedChanges?.push({\n                  id: bead.id,\n                  properties: {\n                    position: {\n                      x: oldPosition.x,\n                      y: oldPosition.y,\n                      z: oldPosition.z,\n                    },\n                    regionId: undefined,\n                  },\n                });\n\n                updated[bead.id] = cloneDeep(draft.objects[bead.id]);\n                foundObject = true;\n              });\n            }\n          });\n        }\n      }\n    }\n  }\n\n  getIdFromUndoOrRedo(\n    _singleChange: ChangeObject,\n    nextIdIndexFromCreated: { value: number },\n    nextIdIndexFromDeleted: number\n  ) {\n    let id: string | undefined = undefined;\n\n    const { shouldBeCreated } = _singleChange;\n\n    if (\n      shouldBeCreated !== undefined &&\n      shouldBeCreated[nextIdIndexFromCreated.value]?.id !== undefined\n    ) {\n      id = shouldBeCreated[nextIdIndexFromCreated.value]?.id ?? undefined;\n      nextIdIndexFromCreated.value = nextIdIndexFromCreated.value + 1;\n    }\n    return id;\n  }\n\n  getRegionChildrenGridIdsAfterResize(\n    region: Region,\n    autoFillBeadsEnabled: boolean,\n    oldRows: number,\n    oldColumns: number\n  ): { toDeleteBeadIds: any; newChildrenGridIds: any } {\n    let newChildrenGridIds: (string | undefined)[] = [];\n    let toDeleteBeadIds: string[] = [];\n\n    if (region.shape === RegionShape.Rectangle) {\n      const newRows = region.rows;\n      const newColumns = region.columns;\n      const newSize = region.rows * region.columns;\n\n      newChildrenGridIds = Array(newSize).fill(undefined);\n      toDeleteBeadIds = [];\n\n      for (let i = 0; i < region.childrenGridIds.length; i++) {\n        const oldIndex = i;\n        const oldCurrentRow = Math.floor(i / oldColumns);\n        const oldCurrentCol = Math.floor(i % oldColumns);\n\n        let newIndex: number = oldCurrentCol + oldCurrentRow * newColumns;\n        const newIndexIsActive = isActiveRegionCell(region, newIndex);\n\n        if (\n          newIndexIsActive === false ||\n          oldCurrentCol >= newColumns ||\n          oldCurrentRow >= newRows\n        ) {\n          newIndex = newSize;\n\n          if (autoFillBeadsEnabled) {\n            const beadId = region.childrenGridIds[oldIndex];\n            if (beadId !== undefined) {\n              if (toDeleteBeadIds.includes(beadId) === false) {\n                toDeleteBeadIds.push(beadId);\n              }\n            }\n          }\n        }\n\n        if (newIndex < newSize && newIndexIsActive === true) {\n          newChildrenGridIds[newIndex] = region.childrenGridIds[oldIndex];\n        }\n      }\n    } else if (region.shape === RegionShape.Triangle) {\n      const newColumns = region.columns;\n      const newSize = region.rows * region.columns;\n\n      newChildrenGridIds = Array(newSize).fill(undefined);\n      toDeleteBeadIds = [];\n\n      for (let i = 0; i < region.childrenGridIds.length; i++) {\n        const oldCurrentRow = Math.floor(i / oldColumns);\n        const oldCurrentCol = Math.floor(i % oldColumns);\n        const oldMiddle = oldColumns / 2;\n        const newMiddle = newColumns / 2;\n        const diffMiddle =\n          newMiddle - oldMiddle < 0\n            ? Math.ceil(newMiddle - oldMiddle)\n            : Math.floor(newMiddle - oldMiddle);\n\n        const newColumn = oldCurrentCol + diffMiddle;\n        const newRow = oldCurrentRow;\n        const newIndex = newRow * newColumns + newColumn;\n        const oldIndex = i;\n\n        const newIndexInTriangle =\n          isActiveRegionCell(region, newIndex) &&\n          newColumn >= 0 &&\n          newColumn < newColumns &&\n          newRow < region.rows;\n\n        if (newIndexInTriangle === false) {\n          if (autoFillBeadsEnabled) {\n            const beadId = region.childrenGridIds[oldIndex];\n            if (beadId !== undefined) {\n              if (toDeleteBeadIds.includes(beadId) === false) {\n                toDeleteBeadIds.push(beadId);\n              }\n            }\n          }\n        } else {\n          if (newChildrenGridIds[newIndex] === undefined) {\n            newChildrenGridIds[newIndex] = region.childrenGridIds[oldIndex];\n          } else {\n            if (autoFillBeadsEnabled) {\n              if (\n                toDeleteBeadIds.includes(region.childrenGridIds[oldIndex]!) ===\n                false\n              ) {\n                toDeleteBeadIds.push(region.childrenGridIds[oldIndex]!);\n              }\n            }\n          }\n        }\n      }\n    } else {\n      logger.error(\"region shape not handled\", region.shape);\n    }\n\n    return {\n      toDeleteBeadIds,\n      newChildrenGridIds,\n    };\n  }\n\n  isRegionContainBead(region: Region, bead: Bead) {\n    const regionTopLeftX = region.position.x - region.width / 2;\n    const regionTopLeftY = region.position.y - region.height / 2;\n\n    const containBead = contain(\n      {\n        x: regionTopLeftX,\n        y: regionTopLeftY,\n        z: 0,\n      },\n      {\n        x: region.position.x + region.width / 2,\n        y: region.position.y + region.height / 2,\n        z: 0,\n      },\n      {\n        x: bead.position.x,\n        y: bead.position.y,\n        z: 0,\n      }\n    );\n\n    return containBead;\n  }\n\n  isRegionCellContainBead(region: Region, bead: Bead, cellIndex: number) {\n    const currentRow = Math.floor(cellIndex / region.columns);\n    const currentCol = Math.floor(cellIndex % region.columns);\n    const cellW = region.width / region.columns;\n    const cellH = region.height / region.rows;\n    const regionTopLeftX = region.position.x - region.width / 2;\n    const regionTopLeftY = region.position.y - region.height / 2;\n\n    const offsetEnabled = region.gridType === RegionGridType.Bricks;\n    const _offsetX = offsetEnabled ? (currentRow % 2 === 0 ? 0 : cellW / 2) : 0;\n\n    const containBead = contain(\n      {\n        x: regionTopLeftX + currentCol * cellW + _offsetX,\n        y: regionTopLeftY + currentRow * cellH,\n        z: 0,\n      },\n      {\n        x: regionTopLeftX + currentCol * cellW + cellW + _offsetX,\n        y: regionTopLeftY + currentRow * cellH + cellH,\n        z: 0,\n      },\n      {\n        x: bead.position.x,\n        y: bead.position.y,\n        z: 0,\n      }\n    );\n\n    return containBead;\n  }\n\n  getRegionCellCenterFromCellIndex(region: Region, cellIndex: number) {\n    const currentRow = Math.floor(cellIndex / region.columns);\n    const currentCol = Math.floor(cellIndex % region.columns);\n    return this.getRegionCellCenter(region, currentRow, currentCol);\n  }\n\n  getRegionCellCenter(region: Region, rowIndex: number, columnIndex: number) {\n    const cellW = region.width / region.columns;\n    const cellH = region.height / region.rows;\n    const offsetEnabled = region.gridType === RegionGridType.Bricks;\n    const _offsetX = offsetEnabled ? (rowIndex % 2 === 0 ? 0 : cellW / 2) : 0;\n    const offsetX = columnIndex * cellW + _offsetX;\n    const offsetY = rowIndex * cellH;\n    const startX = region.position.x - region.width / 2;\n    const startY = region.position.y - region.height / 2;\n    const posX = startX + offsetX + cellW / 2;\n    const posY = startY + offsetY + cellH / 2;\n    const position: Point = {\n      x: posX,\n      y: posY,\n      z: 0,\n    };\n    return position;\n  }\n\n  getRegionCellIndex(x: number, y: number, region: Region) {\n    const regionTopLeftX = region.position.x - region.width / 2;\n    const regionTopLeftY = region.position.y - region.height / 2;\n    const cellW = region.width / region.columns;\n    const cellH = region.height / region.rows;\n    const row = Math.floor((y - regionTopLeftY) / cellH);\n    const offsetEnabled = region.gridType === RegionGridType.Bricks;\n    const _offsetX = offsetEnabled ? (row % 2 === 0 ? 0 : cellW / 2) : 0;\n    const distX = x - regionTopLeftX - _offsetX;\n    const column = Math.floor(distX / cellW);\n    const index = column < 0 ? -1 : row * region.columns + column;\n    return { index, row, column };\n  }\n}\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport { ChangeUiSettings } from \"../AppEventType\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\n\nexport class ChangeUiSettingsHandler extends BaseEventHandler<ChangeUiSettings> {\n  run() {\n    const { uiSettings } = this.event.payload;\n    let newStore = produce(this.store, (draft) => {\n      Object.keys(uiSettings).forEach((keyName) => {\n        draft.ui[keyName] = cloneDeep(uiSettings[keyName]);\n      });\n    });\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import { ClipboardCopy } from \"../AppEventType\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { setClipboardBoardContent } from \"../../threejs/clipboard\";\nimport { cloneDeep } from \"lodash\";\n\nexport class ClipboardCopyHandler extends BaseEventHandler<ClipboardCopy> {\n  run() {\n\n    const objects = this.store.selectedIds.map((id) => {\n      return cloneDeep(this.store.objects[id]);\n    });\n    setClipboardBoardContent({\n      objects,\n    });\n  }\n}\n\n\n","import { AppEventType, ClipboardCut } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { ClipboardCutHistory } from \"../AppHistory\";\nimport { triggerDeleteObjectIds } from \"../../threejs/eventEmitterHandlers\";\nimport { AppObject } from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setClipboardBoardContent } from \"../../threejs/clipboard\";\nimport { cloneDeep } from \"lodash\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { formatISO } from \"date-fns\";\n\nexport class ClipboardCutHandler extends StoreObjectHandler<ClipboardCut> {\n  run() {\n    const ids: string[] = [];\n    const objects: AppObject[] = [];\n    const clonedObjects = this.store.selectedIds.map((id) => {\n      ids.push(id);\n      return cloneDeep(this.store.objects[id]);\n    });\n    setClipboardBoardContent({\n      objects: clonedObjects,\n    });\n    let newStore = this.deleteSelectedObjectsFromStore(ids, objects);\n\n    if (this.saveToHistory) {\n      const historyEvent: ClipboardCutHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.ClipboardPaste,\n          payload: {\n            objects: clonedObjects,\n          },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    setStore(newStore);\n\n    triggerDeleteObjectIds(\n      objects.map((obj) => {\n        return { id: obj.id, objectType: obj.objectType };\n      })\n    );\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { AppEventType, ClipboardPaste } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { ClipboardPasteHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  AppObject,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n} from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { cloneDeep } from \"lodash\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { formatISO } from \"date-fns\";\n\n/**\n * SUPER POWER!!!\n */\nexport class ClipboardPasteHandler extends StoreObjectHandler<ClipboardPaste> {\n  run() {\n    const mapIds = {};\n    const objects: AppObject[] = [];\n    this.event.payload.objects.forEach((obj) => {\n      if (!obj.id) {\n        return;\n      }\n      const oldId = obj.id;\n      const clone = cloneDeep(obj);\n      delete (clone as any).id;\n      let newObject = this.getAppObjectFromCloneAppObject(clone);\n      if (newObject === undefined) {\n        return;\n      }\n      mapIds[oldId] = newObject.id;\n      objects.push(newObject);\n    });\n    const { diffX, diffY } = this.getPositionDiffFromMousePosition(objects);\n    this.moveObjectsByDiff(objects, diffX, diffY);\n    objects.forEach((object) => {\n      if (object.objectType === ObjectTypes.Group) {\n        const newChildrenIds: string[] = [];\n        (object as Group).childrenIds.forEach((id) => {\n          newChildrenIds.push(mapIds[id]);\n        });\n        (object as Group).childrenIds = newChildrenIds;\n      }\n      if (object[groupIdKey] !== undefined) {\n        object[groupIdKey] = mapIds[object[groupIdKey]];\n      }\n    });\n    this.store.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(this.store.objects[id], false);\n    });\n    let newStore = produce(this.store, (draft) => {\n      draft.selectedIds = [];\n      objects.forEach((object) => {\n        draft.objects[object.id] = object;\n        draft.selectedIds.push(object.id);\n      });\n    });\n    objects.forEach((object) => {\n      addObjectByObjectType(object);\n      this.selectObjectOnThreeScene(object, true);\n    });\n    if (this.saveToHistory) {\n      const historyEvent: ClipboardPasteHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: {\n            ids: objects.map((object) => {\n              return object.id;\n            }),\n          },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: formatISO(new Date()),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { AddMultipleBeads, AppEventType } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { AddMultipleBeadsHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport { AppObject } from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { cloneDeep, times } from \"lodash\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { formatISO } from \"date-fns\";\n\nexport class AddMultipleBeadsHandler extends StoreObjectHandler<AddMultipleBeads> {\n  run() {\n    const objects: AppObject[] = [];\n    if (this.event.payload.figure === \"rectangle\") {\n      const defaultBead = buildBead({});\n      const beadMargin = 2;\n      times(this.event.payload.rows).forEach((row) => {\n        times(this.event.payload.columns).forEach((col) => {\n          const x = ((defaultBead.width ?? 1) + beadMargin) * row;\n          const y = ((defaultBead.height ?? 1) + beadMargin) * col * -1;\n          const bead = buildBead({\n            position: {\n              x,\n              y,\n            },\n          });\n          objects.push(bead);\n        });\n      });\n    } else {\n      console.warn(\"figure not found in event payload\");\n    }\n\n    const { diffX, diffY } = this.getPositionDiffFromMousePosition(objects);\n    this.moveObjectsByDiff(objects, diffX, diffY);\n\n    let newStore = produce(this.store, (draft) => {\n      objects.forEach((object) => {\n        draft.objects[object.id] = object;\n        draft.selectedIds.push(object.id);\n      });\n    });\n\n    this.store.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(this.store.objects[id], false);\n    });\n    objects.forEach((object) => {\n      addObjectByObjectType(object);\n      this.selectObjectOnThreeScene(object, true);\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: AddMultipleBeadsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.AddObjects,\n          payload: {\n            objects: cloneDeep(objects),\n          },\n        },\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: { ids: objects.map((object) => object.id) },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { ChangeUiSettingsZoom } from \"../AppEventType\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { getRect10x10FromScreenToWorld } from \"../../threejs/mouseListeners/getRect10x10FromScreenToWorld\";\nimport { appThree } from \"../../threejs/renderThreejs\";\n\nexport class ChangeUiSettingsZoomHandler extends BaseEventHandler<ChangeUiSettingsZoom> {\n  run() {\n    const { zoomType } = this.event.payload;\n    const screenCenter = this.getCenterPosition();\n\n    if (zoomType === \"zoomByScroll\") {\n      let { scrollDelta, clientX, clientY } = this.event.payload;\n      if (!clientX) {\n        clientX = screenCenter.posX;\n      }\n      if (!clientY) {\n        clientY = screenCenter.posY;\n      }\n      if (!scrollDelta) {\n        scrollDelta = 1;\n      }\n      const { top, left } = appThree.el.getBoundingClientRect();\n      const screenX = clientX - left;\n      const screenY = clientY - top;\n      const scrollSign = Math.sign(scrollDelta);\n      this.updateByScroll(screenX, screenY, scrollSign);\n    } else if (zoomType === \"zoomInScreenCenter\") {\n      this.updateByScroll(screenCenter.posX, screenCenter.posY, -1);\n    } else if (zoomType === \"zoomOutScreenCenter\") {\n      this.updateByScroll(screenCenter.posX, screenCenter.posY, 1);\n    }\n  }\n\n  updateByScroll(screenX: number, screenY: number, scrollSign: number) {\n    const { width, height } = appThree.el.getBoundingClientRect();\n    const cameraX = appThree.camera.position.x;\n    const cameraY = appThree.camera.position.y;\n\n    const mouseXInWorldBefore = (screenX - width / 2) * this.store.ui.zoomScale;\n    const mouseYInWorldBefore =\n      -1 * (screenY - height / 2) * this.store.ui.zoomScale;\n\n    const zoomChange = this.store.ui.zoomScale >= 0.35 ? 0.02 * 5 : 0.01;\n    const zoomMax = 100;\n    const zoomMin = 0.0125;\n    let sceneScale = 1;\n    sceneScale = this.store.ui.zoomScale + scrollSign * zoomChange;\n    sceneScale = Math.min(Math.max(zoomMin, sceneScale), zoomMax);\n\n    const mouseXInWorldAfter = (screenX - width / 2) * sceneScale;\n    const mouseYInWorldAfter = -1 * (screenY - height / 2) * sceneScale;\n\n    appThree.camera.left = (width * sceneScale) / -2;\n    appThree.camera.right = (width * sceneScale) / 2;\n    appThree.camera.top = (height * sceneScale) / 2;\n    appThree.camera.bottom = (height * sceneScale) / -2;\n    appThree.camera.updateProjectionMatrix();\n\n    const diffX = mouseXInWorldBefore - mouseXInWorldAfter;\n    const diffY = mouseYInWorldBefore - mouseYInWorldAfter;\n\n    appThree.camera.position.x = cameraX + diffX;\n    appThree.camera.position.y = cameraY + diffY;\n    appThree.camera.lookAt(\n      appThree.camera.position.x,\n      appThree.camera.position.y,\n      0\n    );\n\n    const rect10x10FromScreenToWorld = getRect10x10FromScreenToWorld();\n    appThree.camera.userData = { sceneScale, rect10x10FromScreenToWorld };\n\n    let newStore = produce(this.store, (draft) => {\n      draft.ui.zoomScale = sceneScale;\n    });\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    appThree.scene.traverse((child) => {\n      if (child.layers.mask === 4) {\n        child.scale.x = sceneScale;\n        child.scale.y = sceneScale;\n        child.scale.z = sceneScale;\n      }\n    });\n  }\n}\n","import produce from \"immer\";\nimport { ChangeUiSettingsSidebar } from \"../AppEventType\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\n\nexport class ChangeUiSettingsSidebarHandler extends BaseEventHandler<ChangeUiSettingsSidebar> {\n  run() {\n    const { panel, open, toggle } = this.event.payload;\n    let newStore = produce(this.store, (draft) => {\n      let newOpen = open;\n\n      if (panel === \"objects\") {\n        if (\n          toggle !== undefined &&\n          toggle === true &&\n          draft.ui.rightSidebar.panel === \"objects\"\n        ) {\n          newOpen = !draft.ui.rightSidebar.isOpen;\n        }\n        draft.ui.rightSidebar.isOpen = newOpen;\n        draft.ui.rightSidebar.panel = newOpen === false ? undefined : \"objects\";\n      }\n      if (panel === \"history\") {\n        if (\n          toggle !== undefined &&\n          toggle === true &&\n          draft.ui.rightSidebar.panel === \"history\"\n        ) {\n          newOpen = !draft.ui.rightSidebar.isOpen;\n        }\n        draft.ui.rightSidebar.isOpen = newOpen;\n        draft.ui.rightSidebar.panel = newOpen === false ? undefined : \"history\";\n      }\n\n      if (panel === \"comments\") {\n        if (\n          toggle !== undefined &&\n          toggle === true &&\n          draft.ui.leftSidebar.panel === \"comments\"\n        ) {\n          newOpen = !draft.ui.leftSidebar.isOpen;\n        }\n        draft.ui.leftSidebar.isOpen = newOpen;\n        draft.ui.leftSidebar.panel = newOpen === false ? undefined : \"comments\";\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport { updateObjectPosition } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  ChangeObjectsProperty,\n  AppEventType,\n  ChangeObject,\n  ChangeSelectedObjectsAlignment,\n  SnapToLineType,\n} from \"../AppEventType\";\nimport { ChangeSelectedObjectsAlignmentHistory } from \"../AppHistory\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { getSelectBBox } from \"../../threejs/SelectBBox\";\nimport { formatISO } from \"date-fns\";\n\nexport class ChangeObjectsAlignmentHandler extends StoreObjectHandler<ChangeSelectedObjectsAlignment> {\n  run() {\n    const { snapType, selectedIds } = this.event.payload;\n    const updates: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n    const historyChanges: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n\n    let newStore = produce(this.store, (draft) => {\n      let maxX: number | undefined = undefined;\n      let minX: number | undefined = undefined;\n      let maxY: number | undefined = undefined;\n      let minY: number | undefined = undefined;\n\n      selectedIds.forEach((_id) => {\n        if (draft.objects[_id] === undefined) {\n          console.warn(\"no object found in store\", _id);\n          return;\n        }\n        const pos = draft.objects[_id].position;\n        // const w = draft.objects[_id].width;\n        // const h = draft.objects[_id].height;\n\n        if (minX === undefined) {\n          minX = pos.x;\n        } else if (pos.x < minX) {\n          minX = pos.x;\n        }\n\n        if (maxX === undefined) {\n          maxX = pos.x;\n        } else if (pos.x > maxX) {\n          maxX = pos.x;\n        }\n\n        if (minY === undefined) {\n          minY = pos.y;\n        } else if (pos.y < minY) {\n          minY = pos.y;\n        }\n\n        if (maxY === undefined) {\n          maxY = pos.y;\n        } else if (pos.y > maxY) {\n          maxY = pos.y;\n        }\n      });\n\n      if (snapType === SnapToLineType.X_MIN) {\n        if (minX !== undefined) {\n          const newPos = minX;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.x = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.X_MIDDLE) {\n        if (minX !== undefined && maxX !== undefined) {\n          const newPos = minX + (maxX - minX) / 2;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.x = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.X_MAX) {\n        if (maxX !== undefined) {\n          const newPos = maxX;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.x = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.Y_MIN) {\n        if (minY !== undefined) {\n          const newPos = minY;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.y = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.Y_MIDDLE) {\n        if (minY !== undefined && maxY !== undefined) {\n          const newPos = minY + (maxY - minY) / 2;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.y = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.Y_MAX) {\n        if (maxY !== undefined) {\n          const newPos = maxY;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.y = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else {\n        console.error(\"unknow SnapToLineType\", snapType);\n      }\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: ChangeSelectedObjectsAlignmentHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.ChangeObjectsProperty,\n          payload: { changes: historyChanges },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n\n    newStore = this.getStoreWithHistory(newStore);\n\n    // @INFO: CHANGES IN THREEJS\n    updates.forEach((_singleChange) => {\n      if (newStore.objects[_singleChange.id] === undefined) {\n        console.warn(\"no object found in store\", _singleChange.id);\n        return;\n      }\n      const object = newStore.objects[_singleChange.id];\n      updateObjectPosition(\n        _singleChange.id,\n        object.objectType,\n        object.position.x,\n        object.position.y\n      );\n    });\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    const selectBBox = getSelectBBox();\n    selectBBox.syncRectsWithStore();\n\n    notifyBackend(\n      updates.map((_singleChange) => {\n        return {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: newStore.objects[_singleChange.id],\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { AppEventType, DuplicateObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { DuplicateObjectsHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  AppObject,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n} from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { cloneDeep } from \"lodash\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { formatISO } from \"date-fns\";\n\nexport class DuplicateObjectsHandler extends StoreObjectHandler<DuplicateObjects> {\n  run() {\n    const mapIds = {};\n    const objects: AppObject[] = [];\n    this.event.payload.objects.forEach((obj) => {\n      if (!obj.id) {\n        return;\n      }\n      const oldId = obj.id;\n      const clone = cloneDeep(obj);\n      delete (clone as any).id;\n      let newObject = this.getAppObjectFromCloneAppObject(clone);\n      if (newObject === undefined) {\n        return;\n      }\n      mapIds[oldId] = newObject.id;\n      objects.push(newObject);\n    });\n    // const offsetY = Math.random() * 3 * (Math.random() < 0.5 ? -1 : 1);\n    // const offsetX = Math.random() * 3 * (Math.random() < 0.5 ? -1 : 1);\n    const { diffX, diffY } = this.getPositionDiffFromMousePosition(objects);\n    this.moveObjectsByDiff(objects, diffX, diffY);\n    // this.moveObjectsByDiff(objects, diffX + offsetX, diffY + offsetY);\n    objects.forEach((object) => {\n      if (object.objectType === ObjectTypes.Group) {\n        const newChildrenIds: string[] = [];\n        (object as Group).childrenIds.forEach((id) => {\n          newChildrenIds.push(mapIds[id]);\n        });\n        (object as Group).childrenIds = newChildrenIds;\n      }\n      if (object[groupIdKey] !== undefined) {\n        object[groupIdKey] = mapIds[object[groupIdKey]];\n      }\n    });\n    this.store.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(this.store.objects[id], false);\n    });\n    let newStore = produce(this.store, (draft) => {\n      draft.selectedIds = [];\n      objects.forEach((object) => {\n        draft.objects[object.id] = object;\n        draft.selectedIds.push(object.id);\n      });\n    });\n    objects.forEach((object) => {\n      addObjectByObjectType(object);\n      this.selectObjectOnThreeScene(object, true);\n    });\n    if (this.saveToHistory) {\n      const historyEvent: DuplicateObjectsHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: {\n            ids: objects.map((object) => {\n              return object.id;\n            }),\n          },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { AppEventType, GroupObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { GroupObjectsHistory } from \"../AppHistory\";\nimport {\n  addObjectByObjectType,\n  triggerDeleteObjectIds,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { Group, groupIdKey, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport * as THREE from \"three\";\nimport { appThree } from \"../../threejs/renderThreejs\";\nimport { cloneDeep } from \"lodash\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { formatISO } from \"date-fns\";\n\nexport class GroupObjectsHandler extends StoreObjectHandler<GroupObjects> {\n  run() {\n    const idsGroups: string[] = [];\n    const idsObjectsWithoutGroups: string[] = [];\n    const idsInGroup: string[] = [];\n    const removed: GroupObjects[\"payload\"][\"removed\"] = [];\n    const added: Group[] = [];\n\n    let newStore = produce(this.store, (draft) => {\n      let groupCount: any = 0;\n      let inGroupCount: any = 0;\n      let noGroupCount: any = 0;\n      this.event.payload.objects.forEach((objId) => {\n        if (draft.objects[objId.id] === undefined) {\n          console.warn(\"object not found in store\", objId.id);\n          return;\n        }\n        const object = draft.objects[objId.id];\n        const isGroup = object.objectType === ObjectTypes.Group;\n        const isInGroup =\n          object[groupIdKey] !== undefined && object[groupIdKey].length > 0;\n        if (isGroup) {\n          if (idsGroups.includes(object.id) === false) {\n            groupCount = groupCount + 1;\n            idsGroups.push(object.id);\n          }\n        } else if (isInGroup) {\n          inGroupCount = inGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n          idsInGroup.push(object.id);\n          if (\n            object[groupIdKey] &&\n            draft.objects[object[groupIdKey]] !== undefined\n          ) {\n            if (idsGroups.includes(object[groupIdKey]) === false) {\n              groupCount = groupCount + 1;\n              idsGroups.push(object[groupIdKey]);\n            }\n          }\n        } else {\n          noGroupCount = noGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n        }\n      });\n\n      if (\n        this.event.payload.removed !== undefined &&\n        this.event.payload.removed.length > 0\n      ) {\n        draft.selectedIds = [];\n        this.event.payload.removed.forEach((group) => {\n          if (group === undefined) {\n            return;\n          }\n          if (group.id === undefined) {\n            return;\n          }\n\n          const bbox = new THREE.Box3();\n\n          group.childrenIds.forEach((id) => {\n            const object = appThree.objects.get(id);\n            if (object !== undefined) {\n              bbox.expandByObject(object);\n            }\n          });\n\n          const w = bbox.max.x - bbox.min.x;\n          const h = bbox.max.y - bbox.min.y;\n          const newGroup = buildGroup({\n            id: group.id,\n            childrenIds: group.childrenIds,\n            position: {\n              x: bbox.min.x + w / 2,\n              y: bbox.min.y + h / 2,\n            },\n            width: w,\n            height: h,\n          });\n\n          draft.objects[group.id] = newGroup;\n\n          added.push(newGroup);\n          draft.selectedIds.push(newGroup.id);\n\n          if (group.childrenIds !== undefined && group.childrenIds.length > 0) {\n            group.childrenIds.forEach((id) => {\n              if (draft.objects[id] === undefined) {\n                console.warn(\"object not found after group.childrenIds...\");\n                return;\n              }\n              draft.objects[id][groupIdKey] = newGroup.id;\n              draft.selectedIds.push(id);\n            });\n          }\n        });\n      } else {\n        idsGroups.forEach((id) => {\n          if (draft.objects[id] === undefined) {\n            return;\n          }\n          this.selectObjectOnThreeScene(draft.objects[id], false);\n          removed.push(cloneDeep(draft.objects[id] as Group));\n          delete draft.objects[id];\n        });\n\n        const bbox = new THREE.Box3();\n\n        idsObjectsWithoutGroups.forEach((id) => {\n          const object = appThree.objects.get(id);\n          if (object !== undefined) {\n            bbox.expandByObject(object);\n          }\n        });\n\n        let newGroupId: string | undefined = undefined;\n\n        if (this.event.payload.added !== undefined) {\n          newGroupId = this.event.payload.added.id;\n        }\n\n        const w = bbox.max.x - bbox.min.x;\n        const h = bbox.max.y - bbox.min.y;\n        const newGroup = buildGroup({\n          id: newGroupId,\n          position: {\n            x: bbox.min.x + w / 2,\n            y: bbox.min.y + h / 2,\n          },\n          width: w,\n          height: h,\n          childrenIds: idsObjectsWithoutGroups,\n        });\n        draft.objects[newGroup.id] = newGroup;\n        added.push(newGroup);\n\n        idsObjectsWithoutGroups.forEach((id) => {\n          draft.objects[id][groupIdKey] = newGroup.id;\n        });\n\n        draft.selectedIds = [newGroup.id, ...idsObjectsWithoutGroups];\n      }\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: GroupObjectsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.GroupObjects,\n          payload: {\n            objects: this.event.payload.objects.map(({ id }) => {\n              return cloneDeep({ id });\n            }),\n            removed: this.event.payload.removed?.map(({ id, childrenIds }) => {\n              return cloneDeep({ id, childrenIds });\n            }),\n            added: added[0]\n              ? {\n                  id: added[0].id,\n                  childrenIds: added[0].childrenIds,\n                }\n              : undefined,\n          },\n        },\n        undo: {\n          name: AppEventType.UngroupObjects,\n          payload: {\n            objects: newStore.selectedIds.map((id) => {\n              return cloneDeep({ id });\n            }),\n            removed: removed.map(({ id, childrenIds }) => {\n              return cloneDeep({ id, childrenIds });\n            }),\n          },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    this.event.payload.objects.forEach((object) => {\n      this.selectObjectOnThreeScene(object as any, false);\n    });\n\n    triggerDeleteObjectIds(\n      this.event.payload.objects.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    triggerDeleteObjectIds(\n      removed.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    idsObjectsWithoutGroups.forEach((id) => {\n      addObjectByObjectType(newStore.objects[id]);\n    });\n\n    added.forEach((obj) => {\n      addObjectByObjectType(newStore.objects[obj.id]);\n    });\n\n    newStore.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(newStore.objects[id], true);\n    });\n\n    notifyBackend(\n      added.map(({ id }) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      idsObjectsWithoutGroups.map((id) => {\n        return {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      removed.map(({ id }) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(this.store.objects[id]),\n        };\n      })\n    );\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import produce from \"immer\";\nimport { Group, groupIdKey, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { AppEventType, UngroupObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { UngroupObjectsHistory } from \"../AppHistory\";\nimport {\n  addObjectByObjectType,\n  triggerDeleteObjectIds,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { cloneDeep } from \"lodash\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport * as THREE from \"three\";\nimport { appThree } from \"../../threejs/renderThreejs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { formatISO } from \"date-fns\";\n\nexport class UngroupObjectsHandler extends StoreObjectHandler<UngroupObjects> {\n  run() {\n    const idsGroups: string[] = [];\n    const idsInGroup: string[] = [];\n    const idsObjectsWithoutGroups: string[] = [];\n    const removed: UngroupObjects[\"payload\"][\"removed\"] = [];\n    const added: Group[] = [];\n\n    let newStore = produce(this.store, (draft) => {\n      let groupCount: any = 0;\n      let inGroupCount: any = 0;\n      let noGroupCount: any = 0;\n\n      this.event.payload.objects.forEach((objId) => {\n        if (draft.objects[objId.id] === undefined) {\n          console.warn(\"object not found in store\", objId.id);\n          return;\n        }\n        const object = draft.objects[objId.id];\n        const isGroup = object.objectType === ObjectTypes.Group;\n        const isInGroup =\n          object[groupIdKey] !== undefined && object[groupIdKey].length > 0;\n        if (isGroup) {\n          if (idsGroups.includes(object.id) === false) {\n            groupCount = groupCount + 1;\n            idsGroups.push(object.id);\n          }\n        } else if (isInGroup) {\n          inGroupCount = inGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n          idsInGroup.push(object.id);\n          if (\n            object[groupIdKey] !== undefined &&\n            draft.objects[object[groupIdKey]]\n          ) {\n            if (idsGroups.includes(object[groupIdKey]) === false) {\n              groupCount = groupCount + 1;\n              idsGroups.push(object[groupIdKey]);\n            }\n          }\n        } else {\n          noGroupCount = noGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n        }\n      });\n\n      if (\n        this.event.payload.removed !== undefined &&\n        this.event.payload.removed.length > 0\n      ) {\n        draft.selectedIds = [];\n        this.event.payload.objects.forEach(({ id }) => {\n          if (draft.objects[id] === undefined) {\n            return;\n          }\n          if (draft.objects[id].objectType === ObjectTypes.Group) {\n            this.selectObjectOnThreeScene(draft.objects[id], false);\n            const childrenIds = (draft.objects[id] as Group).childrenIds;\n            childrenIds.forEach((id) => {\n              draft.objects[id][groupIdKey] = undefined;\n            });\n            removed.push(cloneDeep({ childrenIds, id }));\n            delete draft.objects[id];\n            return;\n          }\n          draft.objects[id][groupIdKey] = undefined;\n        });\n        this.event.payload.removed.forEach((group) => {\n          if (group === undefined) {\n            return;\n          }\n          if (group.id === undefined) {\n            return;\n          }\n\n          const bbox = new THREE.Box3();\n\n          group.childrenIds.forEach((id) => {\n            const object = appThree.objects.get(id);\n            if (object !== undefined) {\n              bbox.expandByObject(object);\n            }\n          });\n\n          const w = bbox.max.x - bbox.min.x;\n          const h = bbox.max.y - bbox.min.y;\n          const newGroup = buildGroup({\n            id: group.id,\n            childrenIds: group.childrenIds,\n            position: {\n              x: bbox.min.x + w / 2,\n              y: bbox.min.y + h / 2,\n            },\n            width: w,\n            height: h,\n          });\n\n          draft.objects[group.id] = newGroup;\n          added.push(newGroup);\n          draft.selectedIds.push(newGroup.id);\n\n          if (group.childrenIds) {\n            group.childrenIds.forEach((id) => {\n              if (draft.objects[id] === undefined) {\n                return;\n              }\n              draft.objects[id][groupIdKey] = newGroup.id;\n              draft.selectedIds.push(id);\n            });\n          }\n        });\n      } else {\n        idsGroups.forEach((id) => {\n          if (draft.objects[id] === undefined) {\n            return;\n          }\n          this.selectObjectOnThreeScene(draft.objects[id], false);\n          const childrenIds = (draft.objects[id] as Group).childrenIds;\n          childrenIds.forEach((id) => {\n            draft.objects[id][groupIdKey] = undefined;\n          });\n          removed.push(cloneDeep({ id, childrenIds }));\n          delete draft.objects[id];\n        });\n      }\n\n      draft.selectedIds = [...idsObjectsWithoutGroups];\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: UngroupObjectsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.UngroupObjects,\n          payload: {\n            objects: newStore.selectedIds.map((id) => {\n              return cloneDeep({ id });\n            }),\n            removed: this.event.payload.removed?.map(({ id, childrenIds }) => {\n              return cloneDeep({ id, childrenIds });\n            }),\n          },\n        },\n        undo: {\n          name: AppEventType.GroupObjects,\n          payload: {\n            objects: this.event.payload.objects,\n            removed: removed.map(({ id, childrenIds }) => {\n              return { id, childrenIds };\n            }),\n          },\n        },\n        createdAt: formatISO(new Date()),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    this.event.payload.objects.forEach((object) => {\n      this.selectObjectOnThreeScene(object as any, false);\n    });\n\n    triggerDeleteObjectIds(\n      removed.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    // @TODO: po ungroup nie powinno by usuwania i dodawania wszystkich obiektow zaleznych\n    triggerDeleteObjectIds(\n      this.event.payload.objects.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    added.forEach((obj) => {\n      addObjectByObjectType(newStore.objects[obj.id]);\n    });\n\n    idsObjectsWithoutGroups.forEach((id) => {\n      addObjectByObjectType(newStore.objects[id]);\n    });\n\n    newStore.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(newStore.objects[id], true);\n    });\n\n    notifyBackend(\n      added.map(({ id }) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      idsObjectsWithoutGroups.map((id) => {\n        return {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      removed.map(({ id }) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(this.store.objects[id]),\n        };\n      })\n    );\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import { AddObjectHandler } from \"./EventHandlers/AddObjectHandler\";\nimport { AppEvents, AppEventType } from \"./AppEventType\";\nimport { getStore, shouldRefreshReact, shouldRefreshThree } from \"./store\";\nimport { RemoveObjectHandler } from \"./EventHandlers/RemoveObjectHandler\";\nimport { ChangeSelectObjectsHandler } from \"./EventHandlers/ChangeSelectObjectsHandler\";\nimport { ChangeObjectsPropertyHandler } from \"./EventHandlers/ChangeObjectsPropertyHandler\";\nimport { getHistory } from \"./AppHistory\";\nimport { ChangeUiSettingsHandler } from \"./EventHandlers/ChangeUiSettingsHandler\";\nimport { ClipboardCopyHandler } from \"./EventHandlers/ClipboardCopyHandler\";\nimport { ClipboardCutHandler } from \"./EventHandlers/ClipboardCutHandler\";\nimport { ClipboardPasteHandler } from \"./EventHandlers/ClipboardPasteHandler\";\nimport { AddMultipleBeadsHandler } from \"./EventHandlers/AddMultipleBeadsHandler\";\nimport { ChangeUiSettingsZoomHandler } from \"./EventHandlers/ChangeUiSettingsZoomHandler\";\nimport { ChangeUiSettingsSidebarHandler } from \"./EventHandlers/ChangeUiSettingsSidebarHandler\";\nimport { ChangeObjectsAlignmentHandler } from \"./EventHandlers/ChangeObjectsAlignmentHandler\";\nimport { DuplicateObjectsHandler } from \"./EventHandlers/DuplicateObjectsHandler\";\nimport { GroupObjectsHandler } from \"./EventHandlers/GroupObjectsHandler\";\nimport { UngroupObjectsHandler } from \"./EventHandlers/UngroupObjectsHandler\";\nimport { IBaseEventHandler } from \"./BaseHandlers/StoreObjectHandler\";\nimport { logger } from \"../logger\";\n\nexport const sendEvent = (event: AppEvents, saveToHistory: boolean = true) => {\n  logger.log(\n    \"dispatchEvent\",\n    event.name,\n    event.payload,\n    \"saveToHistory\",\n    saveToHistory\n  );\n\n  const classNames: { [key in AppEventType]: any } = {\n    [AppEventType.AddObjects]: AddObjectHandler,\n    [AppEventType.RemoveObjects]: RemoveObjectHandler,\n    [AppEventType.ChangeSelectObjects]: ChangeSelectObjectsHandler,\n    [AppEventType.ChangeObjectsProperty]: ChangeObjectsPropertyHandler,\n    [AppEventType.ChangeUiSettings]: ChangeUiSettingsHandler,\n    [AppEventType.ChangeObjectsProperty]: ChangeObjectsPropertyHandler,\n    [AppEventType.ClipboardCopy]: ClipboardCopyHandler,\n    [AppEventType.ClipboardCut]: ClipboardCutHandler,\n    [AppEventType.ClipboardPaste]: ClipboardPasteHandler,\n    [AppEventType.AddMultipleBeads]: AddMultipleBeadsHandler,\n    [AppEventType.ChangeUiSettingsZoom]: ChangeUiSettingsZoomHandler,\n    [AppEventType.ChangeUiSettingsSidebar]: ChangeUiSettingsSidebarHandler,\n    [AppEventType.ChangeObjectsAlignment]: ChangeObjectsAlignmentHandler,\n    [AppEventType.DuplicateObjects]: DuplicateObjectsHandler,\n    [AppEventType.GroupObjects]: GroupObjectsHandler,\n    [AppEventType.UngroupObjects]: UngroupObjectsHandler,\n  };\n\n  if (classNames[event.name] !== undefined) {\n    const history = getHistory();\n    const store = getStore();\n    const className = classNames[event.name];\n    const handler = new className(\n      event as any,\n      store,\n      history,\n      saveToHistory\n    ) as IBaseEventHandler;\n    handler.run(shouldRefreshThree(), shouldRefreshReact());\n  } else {\n    console.warn(\"event handler not found to name\", event);\n  }\n\n  // const history = getHistory();\n  // const store = getStore();\n  // if (event.name === AppEventType.AddObjects) {\n  //   new AddObjectHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.RemoveObjects) {\n  //   new RemoveObjectHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ChangeSelectObjects) {\n  //   new ChangeSelectObjectsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ChangeObjectsProperty) {\n  //   new ChangeObjectsPropertyHandler(\n  //     event,\n  //     store,\n  //     history,\n  //     saveToHistory\n  //   ).run();\n  // } else if (event.name === AppEventType.ChangeUiSettings) {\n  //   new ChangeUiSettingsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ClipboardCopy) {\n  //   new ClipboardCopyHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ClipboardCut) {\n  //   new ClipboardCutHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ClipboardPaste) {\n  //   new ClipboardPasteHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.AddMultipleBeads) {\n  //   new AddMultipleBeadsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ChangeUiSettingsZoom) {\n  //   new ChangeUiSettingsZoomHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ChangeUiSettingsSidebar) {\n  //   new ChangeUiSettingsSidebarHandler(\n  //     event,\n  //     store,\n  //     history,\n  //     saveToHistory\n  //   ).run();\n  // } else if (event.name === AppEventType.ChangeObjectsAlignment) {\n  //   new ChangeObjectsAlignmentHandler(\n  //     event,\n  //     store,\n  //     history,\n  //     saveToHistory\n  //   ).run();\n  // } else if (event.name === AppEventType.DuplicateObjects) {\n  //   new DuplicateObjectsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.GroupObjects) {\n  //   new GroupObjectsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.UngroupObjects) {\n  //   new UngroupObjectsHandler(event, store, history, saveToHistory).run();\n  // } else {\n  //   console.warn(\"event handler not found to name\", event);\n  // }\n\n  return event;\n};\n","import React from \"react\";\nimport {\n  faAlignLeft,\n  faArrowsAlt,\n  faBorderNone,\n  faBurn,\n  faChevronDown,\n  faCrosshairs,\n  faLock,\n  faObjectGroup,\n  faObjectUngroup,\n  faSearch,\n  faShapes,\n  faSync,\n  faTimes,\n  faUnlock,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faEllipsisH } from \"@fortawesome/free-solid-svg-icons\";\nimport { ActionsTypes } from \"./ActionsTypes\";\nimport { useSelector } from \"react-redux\";\nimport { Bead, Editor } from \"../../editorObjects/Editor\";\nimport styled from \"styled-components\";\nimport {\n  AppEventType,\n  ChangeObject,\n  ChangeObjectsProperty,\n  ChangeSelectObject,\n  ChangeSelectObjects,\n  GroupObjects,\n  UngroupObjects,\n} from \"../../controllers/AppEventType\";\nimport { getStore } from \"../../controllers/store\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport { cloneDeep } from \"lodash\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const ActionsIconsWrapper: React.FC<{\n  actions: ActionsTypes[];\n  selectedAction?: ActionsTypes;\n  onClick: any;\n}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const texts = [\n    t(\"board:action_type.EditBeadProduct\"),\n    t(\"board:action_type.EditBeadType\"),\n    t(\"board:action_type.EditBeadMaterial\"),\n    t(\"board:action_type.EditBeadColor\"),\n    t(\"board:action_type.EditRegionShape\"),\n    t(\"board:action_type.EditRegionGridType\"),\n    t(\"board:action_type.EditRegionGridSettings\"),\n    t(\"board:action_type.EditPosition\"),\n    t(\"board:action_type.EditRotate\"),\n    t(\"board:action_type.EditWidthHeight\"),\n    t(\"board:action_type.EditWidthHeightDepth\"),\n    t(\"board:action_type.Alignment\"),\n    t(\"board:action_type.Lock\"),\n    t(\"board:action_type.Unlock\"),\n    t(\"board:action_type.Group\"),\n    t(\"board:action_type.Ungroup\"),\n    t(\"board:action_type.More\"),\n  ];\n  return (\n    <GroupActionsStyles>\n      <div className={\"actions-group\"}>\n        {props.actions.map((action, index) => {\n          if (action === ActionsTypes.More) {\n            return (\n              <IconActionsTypeMore\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.EditBeadColor) {\n            return (\n              <IconActionsTypeEditBeadColor\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.EditRegionGridType) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faShapes} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditRegionGridSettings) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faBorderNone} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditPosition) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faCrosshairs} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditRotate) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faSync} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditWidthHeight) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faArrowsAlt} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditWidthHeightDepth) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faArrowsAlt} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.Alignment) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faAlignLeft} />\n\n                      <FontAwesomeIcon icon={faChevronDown} size={\"sm\"} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditBeadType) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faShapes} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditBeadProduct) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faSearch} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.Lock) {\n            return (\n              <IconActionsLock\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.Unlock) {\n            return (\n              <IconActionsUnlock\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.EditBeadMaterial) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faBurn} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.Group) {\n            return (\n              <IconActionsGroup\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.Ungroup) {\n            return (\n              <IconActionsUngroup\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else {\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    data-tip={t(`board:action_type.${action}`)}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faTimes} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          }\n        })}\n      </div>\n    </GroupActionsStyles>\n  );\n};\n\nexport const GroupActionsStyles = styled.div`\n  height: 100%;\n\n  .more-icon-action-type {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 40px;\n    svg path {\n      fill: var(--gray);\n    }\n    div {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n  }\n  .icon-action-type-color {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 50px;\n  }\n  .icon-action-type {\n    width: 50px;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: var(--standardPadding);\n    padding-right: var(--standardPadding);\n  }\n  .icon-action-type-color {\n    .value {\n      height: 30px;\n      width: 30px;\n      background: transparent;\n      border-radius: 30px;\n      border: 1px solid #000;\n    }\n  }\n  .action-item-wrapper {\n    height: 100%;\n    transition: all 0.4s ease-in-out;\n  }\n  .action-item-wrapper.active {\n    background: rgba(0, 0, 0, 0.2);\n  }\n  .actions-group {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    position: relative;\n    height: 100%;\n    &:before {\n      content: \"\";\n      position: absolute;\n      top: 50%;\n      left: calc(var(--standardPadding) * -1);\n      height: 70%;\n      transform: translate(0, -50%);\n      width: 1px;\n      background: var(--gray);\n    }\n  }\n  .align-icons-wrapper {\n    column-gap: var(--standardPadding);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  .long-press-wrapper {\n    height: 100%;\n    position: relative;\n    &.active {\n      .long-press-ghost {\n        max-width: 100%;\n      }\n    }\n    .long-press-ghost {\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 2;\n      overflow: hidden;\n      background: #eee;\n      max-width: 0%;\n      height: 100%;\n      transition-property: all;\n      animation-timing-function: cubic-bezier(0.25, 0.1, 1, 1);\n      animation-fill-mode: forwards;\n      width: 100%;\n    }\n    .long-press-icon {\n      position: relative;\n      z-index: 3;\n      height: 100%;\n      width: 110px;\n      display: flex;\n      column-gap: var(--standardPadding);\n      padding-left: 30px;\n      .icon-wrapper {\n        position: absolute;\n        top: 50%;\n        left: 5px;\n        transform: translate(0, -50%);\n        font-size: 18px;\n      }\n\n      .label-wrapper {\n        font-size: 13px;\n        display: flex;\n        justify-content: center;\n        text-align: center;\n        align-content: center;\n        position: absolute;\n        top: 50%;\n        left: 30px;\n        transform: translate(0, -50%);\n      }\n    }\n  }\n`;\n\nexport const ItemActionWrapper: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const elRef = React.useRef<HTMLDivElement | null>(null);\n  const onClick = () => {\n    if (elRef.current) {\n      const { offsetLeft, offsetParent, offsetWidth } = elRef.current;\n      let groupOffsetLeft = 0;\n      if (offsetParent) {\n        groupOffsetLeft = (offsetParent as HTMLDivElement).offsetLeft;\n      } else {\n        console.warn(\"ref parent element not found\");\n      }\n      const halfWidth = offsetWidth / 2;\n      const finalOffsetLeft = groupOffsetLeft + offsetLeft + halfWidth;\n      props.onClick(props.type, finalOffsetLeft);\n    } else {\n      console.warn(\"ref element not found\");\n    }\n  };\n  return (\n    <div\n      className={`action-item-wrapper ${\n        props.selectedAction !== undefined &&\n        props.selectedAction === props.type\n          ? \"active\"\n          : \"\"\n      }`}\n      ref={(e) => (elRef.current = e)}\n      onClick={onClick}\n    >\n      {props.children}\n    </div>\n  );\n};\n\nexport const IconActionsTypeMore: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  return (\n    <ItemActionWrapper\n      onClick={props.onClick}\n      type={props.type}\n      selectedAction={props.selectedAction}\n    >\n      <div className={`more-icon-action-type `}>\n        <div\n          data-tip={t(`board:action_type.${props.selectedAction}`)}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <FontAwesomeIcon icon={faEllipsisH} />\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nexport const IconActionsTypeEditBeadColor: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const backgroundColors = useSelector((state: Editor) => {\n    const colors: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const color = (state.objects[id] as Bead).color;\n      if (colors.includes(color) === false) {\n        colors.push(color);\n      }\n    });\n    return colors;\n  });\n\n  if (backgroundColors.length === 0) {\n    return <React.Fragment />;\n  }\n\n  return (\n    <ItemActionWrapper\n      onClick={props.onClick}\n      type={props.type}\n      selectedAction={props.selectedAction}\n    >\n      <div className={\"icon-action-type-color\"}>\n        <div\n          data-tip={t(`board:action_type.${props.selectedAction}`)}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div\n            className={\"value\"}\n            style={{\n              background: `linear-gradient(to right, ${\n                backgroundColors.length === 1\n                  ? [backgroundColors[0], backgroundColors[0]].join()\n                  : backgroundColors.slice(0, 10).join()\n              })`,\n            }}\n          >\n            &nbsp;\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nconst IconActionsUnlock: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const [startLongPress, setStartLongPress] = React.useState(false);\n  const ms = 600;\n  const onSuccess = () => {\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              isLocked: false,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n    props.onClick(undefined, undefined);\n  };\n\n  React.useEffect(() => {\n    let timerId;\n    if (startLongPress) {\n      timerId = setTimeout(onSuccess, ms);\n    } else {\n      clearTimeout(timerId);\n    }\n\n    return () => {\n      clearTimeout(timerId);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [startLongPress]);\n\n  const start = React.useCallback(() => {\n    setStartLongPress(true);\n  }, []);\n\n  const stop = React.useCallback(() => {\n    setStartLongPress(false);\n  }, []);\n\n  return (\n    <div\n      onMouseDown={start}\n      onMouseUp={stop}\n      onMouseLeave={stop}\n      onTouchStart={start}\n      onTouchEnd={stop}\n      className={`long-press-wrapper ${startLongPress ? \"active\" : \"\"}`}\n    >\n      <div\n        className={`long-press-ghost`}\n        style={{ transitionDuration: `${ms}ms` }}\n      >\n        &nbsp;\n      </div>\n      <div className={\"long-press-icon\"}>\n        <div className={\"icon-wrapper\"}>\n          <FontAwesomeIcon icon={faLock} />\n        </div>\n\n        <div className={\"label-wrapper\"}>\n          <span>{t(\"board:edit_bead_popup.long_press_to_unlock\")}</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst IconActionsLock: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const onClick = () => {\n    const store = getStore();\n    const _event: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change: store.selectedIds.map((id) => {\n          const _change: ChangeSelectObject = {\n            id,\n            isSelected: false,\n          };\n          return _change;\n        }),\n      },\n    };\n    sendEvent(_event);\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              isLocked: true,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <ItemActionWrapper onClick={onClick} type={ActionsTypes.Lock}>\n      <div className={\"icon-action-type\"}>\n        <div\n          data-tip={t(`board:action_type.${ActionsTypes.Lock}`)}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div className={\"align-icons-wrapper\"}>\n            <FontAwesomeIcon icon={faUnlock} />\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nconst IconActionsGroup: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const onClick = () => {\n    const store = getStore();\n    const _event: GroupObjects = {\n      name: AppEventType.GroupObjects,\n      payload: {\n        objects: store.selectedIds.map((id) => {\n          return cloneDeep(store.objects[id]);\n        }),\n      },\n    };\n    sendEvent(_event);\n  };\n  return (\n    <ItemActionWrapper onClick={onClick} type={props.type}>\n      <div className={\"icon-action-type\"}>\n        <div\n          data-tip={t(`board:action_type.${props.type}`)}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div className={\"align-icons-wrapper\"}>\n            <FontAwesomeIcon icon={faObjectGroup} />\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nconst IconActionsUngroup: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const onClick = () => {\n    const store = getStore();\n    const _event: UngroupObjects = {\n      name: AppEventType.UngroupObjects,\n      payload: {\n        objects: store.selectedIds.map((id) => {\n          return cloneDeep(store.objects[id]);\n        }),\n      },\n    };\n    sendEvent(_event);\n  };\n  return (\n    <ItemActionWrapper onClick={onClick} type={props.type}>\n      <div className={\"icon-action-type\"}>\n        <div\n          data-tip={t(`board:action_type.${props.type}`)}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div className={\"align-icons-wrapper\"}>\n            <FontAwesomeIcon icon={faObjectUngroup} />\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n","import React, { Component } from \"react\";\n\nconst KEYCODE_UP = 38;\nconst KEYCODE_DOWN = 40;\nconst IS_BROWSER = typeof document != \"undefined\";\nconst RE_NUMBER = /^[+-]?((\\.\\d+)|(\\d+(\\.\\d+)?))$/;\nconst RE_INCOMPLETE_NUMBER = /^([+-]0?|[0-9]*\\.0*|[+-]\\.0*|[+-]?\\d+\\.)?$/;\n\n/**\n * Just a simple helper to provide support for older IEs. This is not exactly a\n * polyfill for classList.add but it does what we need with minimal effort.\n * Works with single className only!\n */\nfunction addClass(element, className) {\n  if (element.classList) {\n    return element.classList.add(className);\n  }\n  if (!element.className.search(new RegExp(\"\\\\b\" + className + \"\\\\b\"))) {\n    element.className = \" \" + className;\n  }\n}\n\n/**\n * Just a simple helper to provide support for older IEs. This is not exactly a\n * polyfill for classList.remove but it does what we need with minimal effort.\n * Works with single className only!\n */\nfunction removeClass(element, className) {\n  if (element.className) {\n    if (element.classList) {\n      return element.classList.remove(className);\n    }\n\n    element.className = element.className.replace(\n      new RegExp(\"\\\\b\" + className + \"\\\\b\", \"g\"),\n      \"\"\n    );\n  }\n}\n\n/**\n * Lookup the object.prop and returns it. If it happens to be a function,\n * executes it with args and returns it's return value. It the prop does not\n * exist on the object, or if it equals undefined, or if it is a function that\n * returns undefined the defaultValue will be returned instead.\n * @param  {Object} object       The object to look into\n * @param  {String} prop         The property name\n * @param  {*}      defaultValue The default value\n * @param  {*[]}    args         Any additional arguments to pass to the\n *                               function (if the prop is a function).\n * @return {*}                   Whatever happens to be the return value\n */\nfunction access(object, prop, defaultValue, ...args) {\n  let result = object[prop];\n  if (typeof result == \"function\") {\n    result = result(...args);\n  }\n  return result === undefined ? defaultValue : result;\n}\n\n/* eslint-disable */\ntype NumericInputState = {\n  selectionStart?: number | null;\n  selectionEnd?: number | null;\n  btnDownHover?: boolean;\n  btnDownActive?: boolean;\n  btnUpHover?: boolean;\n  btnUpActive?: boolean;\n  value?: number | null;\n  stringValue?: string;\n};\n/*eslint-enable*/\n\ninterface NumericInputProps {\n  step?: any;\n  min?: any;\n  max?: any;\n  precision?: any;\n  maxLength?: any;\n  parse?: any;\n  format?: any;\n  className?: any;\n  disabled?: any;\n  readOnly?: any;\n  required?: any;\n  snap?: any;\n  noValidate?: any;\n  style?: any;\n  noStyle?: any;\n  type?: any;\n  pattern?: any;\n  onFocus?: any;\n  onBlur?: any;\n  onKeyDown?: any;\n  onChange?: any;\n  onInvalid?: any;\n  onValid?: any;\n  onInput?: any;\n  onSelect?: any;\n  size?: any;\n  value?: any;\n  defaultValue?: any;\n  strict?: any;\n  componentClass?: any;\n  mobile?: any;\n}\n\nexport class NumericInput extends Component<\n  NumericInputProps,\n  NumericInputState\n> {\n  // static propTypes = {\n  //   step: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   min: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   max: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   precision: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   maxLength: PropTypes.number,\n  //   parse: PropTypes.func,\n  //   format: PropTypes.func,\n  //   className: PropTypes.string,\n  //   disabled: PropTypes.bool,\n  //   readOnly: PropTypes.bool,\n  //   required: PropTypes.bool,\n  //   snap: PropTypes.bool,\n  //   noValidate: PropTypes.oneOfType([PropTypes.bool, PropTypes.string]),\n  //   style: PropTypes.oneOfType([PropTypes.object, PropTypes.bool]),\n  //   noStyle: PropTypes.bool,\n  //   type: PropTypes.string,\n  //   pattern: PropTypes.string,\n  //   onFocus: PropTypes.func,\n  //   onBlur: PropTypes.func,\n  //   onKeyDown: PropTypes.func,\n  //   onChange: PropTypes.func,\n  //   onInvalid: PropTypes.func,\n  //   onValid: PropTypes.func,\n  //   onInput: PropTypes.func,\n  //   onSelect: PropTypes.func,\n  //   size: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  //   value: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  //   defaultValue: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  //   strict: PropTypes.bool,\n  //   componentClass: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n  //   mobile(props, propName) {\n  //     let prop = props[propName];\n  //     if (\n  //       prop !== true &&\n  //       prop !== false &&\n  //       prop !== \"auto\" &&\n  //       typeof prop != \"function\"\n  //     ) {\n  //       return new Error(\n  //         'The \"mobile\" prop must be true, false, \"auto\" or a function'\n  //       );\n  //     }\n  //   },\n  // };\n\n  /**\n   * The default behavior is to start from 0, use step of 1 and display\n   * integers\n   */\n  static defaultProps = {\n    step: 1,\n    min: Number.MIN_SAFE_INTEGER || -9007199254740991,\n    max: Number.MAX_SAFE_INTEGER || 9007199254740991,\n    precision: null,\n    parse: null,\n    format: null,\n    mobile: \"auto\",\n    strict: false,\n    componentClass: \"input\",\n    style: {},\n  };\n\n  /**\n   * This are the default styles that act as base for all the component\n   * instances. One can modify this object to change the default styles\n   * of all the widgets on the page.\n   */\n  static style = {\n    // The wrapper (span)\n    wrap: {\n      position: \"relative\",\n      display: \"inline-block\",\n    },\n\n    \"wrap.hasFormControl\": {\n      display: \"block\",\n    },\n\n    // The increase button arrow (i)\n    arrowUp: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 0,\n      height: 0,\n      borderWidth: \"0 0.6ex 0.6ex 0.6ex\",\n      borderColor: \"transparent transparent rgba(0, 0, 0, 0.7)\",\n      borderStyle: \"solid\",\n      margin: \"-0.3ex 0 0 -0.56ex\",\n    },\n\n    // The decrease button arrow (i)\n    arrowDown: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 0,\n      height: 0,\n      borderWidth: \"0.6ex 0.6ex 0 0.6ex\",\n      borderColor: \"rgba(0, 0, 0, 0.7) transparent transparent\",\n      borderStyle: \"solid\",\n      margin: \"-0.3ex 0 0 -0.56ex\",\n    },\n\n    // The vertical segment of the plus sign (for mobile only)\n    plus: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 2,\n      height: 10,\n      background: \"rgba(0,0,0,.7)\",\n      margin: \"-5px 0 0 -1px\",\n    },\n\n    // The horizontal segment of the plus/minus signs (for mobile only)\n    minus: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 10,\n      height: 2,\n      background: \"rgba(0,0,0,.7)\",\n      margin: \"-1px 0 0 -5px\",\n    },\n\n    // Common styles for the up/down buttons (b)\n    btn: {\n      position: \"absolute\",\n      right: 2,\n      width: \"2.26ex\",\n      borderColor: \"rgba(0,0,0,.1)\",\n      borderStyle: \"solid\",\n      textAlign: \"center\",\n      cursor: \"default\",\n      transition: \"all 0.1s\",\n      background: \"rgba(0,0,0,.1)\",\n      boxShadow:\n        \"-1px -1px 3px rgba(0,0,0,.1) inset,\" +\n        \"1px 1px 3px rgba(255,255,255,.7) inset\",\n    },\n\n    btnUp: {\n      top: 2,\n      bottom: \"50%\",\n      borderRadius: \"2px 2px 0 0\",\n      borderWidth: \"1px 1px 0 1px\",\n    },\n\n    \"btnUp.mobile\": {\n      width: \"3.3ex\",\n      bottom: 2,\n      boxShadow: \"none\",\n      borderRadius: 2,\n      borderWidth: 1,\n    },\n\n    btnDown: {\n      top: \"50%\",\n      bottom: 2,\n      borderRadius: \"0 0 2px 2px\",\n      borderWidth: \"0 1px 1px 1px\",\n    },\n\n    \"btnDown.mobile\": {\n      width: \"3.3ex\",\n      bottom: 2,\n      left: 2,\n      top: 2,\n      right: \"auto\",\n      boxShadow: \"none\",\n      borderRadius: 2,\n      borderWidth: 1,\n    },\n\n    \"btn:hover\": {\n      background: \"rgba(0,0,0,.2)\",\n    },\n\n    \"btn:active\": {\n      background: \"rgba(0,0,0,.3)\",\n      boxShadow:\n        \"0 1px 3px rgba(0,0,0,.2) inset,\" +\n        \"-1px -1px 4px rgba(255,255,255,.5) inset\",\n    },\n\n    \"btn:disabled\": {\n      opacity: 0.5,\n      boxShadow: \"none\",\n      cursor: \"not-allowed\",\n    },\n\n    // The input (input[type=\"text\"])\n    input: {\n      paddingRight: \"3ex\",\n      boxSizing: \"border-box\",\n      fontSize: \"inherit\",\n    },\n\n    // The input with bootstrap class\n    \"input:not(.form-control)\": {\n      border: \"1px solid #ccc\",\n      borderRadius: 2,\n      paddingLeft: 4,\n      display: \"block\",\n      WebkitAppearance: \"none\",\n      lineHeight: \"normal\",\n    },\n\n    \"input.mobile\": {\n      paddingLeft: \" 3.4ex\",\n      paddingRight: \"3.4ex\",\n      textAlign: \"center\",\n    },\n\n    \"input:focus\": {},\n\n    \"input:disabled\": {\n      color: \"rgba(0, 0, 0, 0.3)\",\n      textShadow: \"0 1px 0 rgba(255, 255, 255, 0.8)\",\n    },\n  };\n\n  /**\n   * When click and hold on a button - the speed of auto changing the value.\n   * This is a static property and can be modified if needed.\n   */\n  static SPEED = 50;\n\n  /**\n   * When click and hold on a button - the delay before auto changing the value.\n   * This is a static property and can be modified if needed.\n   */\n  static DELAY = 500;\n\n  /**\n   * The constant indicating up direction (or increasing in general)\n   */\n  static DIRECTION_UP = \"up\";\n\n  /**\n   * The constant indicating down direction (or decreasing in general)\n   */\n  static DIRECTION_DOWN = \"down\";\n\n  /**\n   * The step timer\n   * @type {Number}\n   */\n  /**\n   * The step timer\n   * @type {Number}\n   */\n  _timer!: any;\n\n  /**\n   * This holds the last known validation error. We need to compare that with\n   * new errors and detect validation changes...\n   * @type {[type]}\n   */\n  /**\n   * This holds the last known validation error. We need to compare that with\n   * new errors and detect validation changes...\n   * @type {[type]}\n   */\n  _valid!: string;\n\n  _isStrict: boolean;\n  _ignoreValueChange!: boolean;\n  _isMounted!: boolean;\n  _inputFocus!: boolean;\n  // onTouchEnd: any;\n  refsWrapper: any;\n  refsInput: any;\n\n  /**\n   * The state of the component\n   * @type {Object}\n   */\n  state: NumericInputState;\n\n  /**\n   * The stop method (need to declare it here to use it in the constructor)\n   * @type {Function}\n   */\n  // stop: any;\n\n  /**\n   * Set the initial state and bind this.stop to the instance.\n   */\n  constructor(args: any) {\n    super(args);\n\n    this._isStrict = !!this.props.strict;\n\n    this.state = {\n      btnDownHover: false,\n      btnDownActive: false,\n      btnUpHover: false,\n      btnUpActive: false,\n      stringValue: \"\",\n      ...this._propsToState(this.props),\n    };\n    this.stop = this.stop.bind(this);\n    this.onTouchEnd = this.onTouchEnd.bind(this);\n    this.refsInput = null;\n    this.refsWrapper = null;\n  }\n\n  _propsToState(props) {\n    let out: NumericInputState = {};\n\n    if (props.hasOwnProperty(\"value\")) {\n      out.stringValue = String(\n        props.value || props.value === 0 ? props.value : \"\"\n      ).trim();\n\n      out.value = out.stringValue !== \"\" ? this._parse(props.value) : null;\n    } else if (!this._isMounted && props.hasOwnProperty(\"defaultValue\")) {\n      out.stringValue = String(\n        props.defaultValue || props.defaultValue === 0 ? props.defaultValue : \"\"\n      ).trim();\n\n      out.value =\n        props.defaultValue !== \"\" ? this._parse(props.defaultValue) : null;\n    }\n\n    return out;\n  }\n\n  /**\n   * Special care is taken for the \"value\" prop:\n   * - If not provided - set it to null\n   * - If the prop is a number - use it as is\n   * - Otherwise:\n   *     1. Convert it to string (falsy values become \"\")\n   *     2. Then trim it.\n   *     3. Then parse it to number (delegating to this.props.parse if any)\n   */\n  componentWillReceiveProps(props: NumericInputProps): void {\n    this._isStrict = !!props.strict;\n    let nextState = this._propsToState(props);\n    if (Object.keys(nextState).length) {\n      this._ignoreValueChange = true;\n      this.setState(nextState, () => {\n        this._ignoreValueChange = false;\n      });\n    }\n  }\n\n  /**\n   * Save the input selection right before rendering\n   */\n  componentWillUpdate(): void {\n    this.saveSelection();\n  }\n\n  /**\n   * After the component has been rendered into the DOM, do whatever is\n   * needed to \"reconnect\" it to the outer world, i.e. restore selection,\n   * call some of the callbacks, validate etc.\n   */\n  componentDidUpdate(\n    prevProps: NumericInputProps,\n    prevState: NumericInputProps\n  ): void {\n    // Call the onChange if needed. This is placed here because there are\n    // many reasons for changing the value and this is the common place\n    // that can capture them all\n\n    if (\n      !this._ignoreValueChange && // no onChange if re-rendered with different value prop\n      prevState.value !== this.state.value && // no onChange if the value remains the same\n      (!isNaN(this.state.value ?? Number.NaN) || this.state.value === null) // only if changing to number or null\n    ) {\n      this._invokeEventCallback(\n        \"onChange\",\n        this.state.value,\n        this.refsInput.value,\n        this.refsInput\n      );\n    }\n\n    // focus the input is needed (for example up/down buttons set\n    // this._inputFocus to true)\n    if (this._inputFocus) {\n      this.refsInput.focus();\n\n      // Restore selectionStart (if any)\n      if (this.state.selectionStart || this.state.selectionStart === 0) {\n        this.refsInput.selectionStart = this.state.selectionStart;\n      }\n\n      // Restore selectionEnd (if any)\n      if (this.state.selectionEnd || this.state.selectionEnd === 0) {\n        this.refsInput.selectionEnd = this.state.selectionEnd;\n      }\n    }\n\n    this.checkValidity();\n  }\n\n  /**\n   * This is used to clear the timer if any\n   */\n  componentWillUnmount(): void {\n    this._isMounted = false;\n    this.stop();\n  }\n\n  /**\n   * Adds getValueAsNumber and setValue methods to the input DOM element.\n   */\n  componentDidMount(): void {\n    this._isMounted = true;\n    this.refsInput.getValueAsNumber = () => this.state.value || 0;\n\n    this.refsInput.setValue = (value) => {\n      this.setState({\n        value: this._parse(value),\n        stringValue: value,\n      });\n    };\n\n    // This is a special case! If the component has the \"autoFocus\" prop\n    // and the browser did focus it we have to pass that to the onFocus\n    if (\n      !this._inputFocus &&\n      IS_BROWSER &&\n      document.activeElement === this.refsInput\n    ) {\n      this._inputFocus = true;\n      this.refsInput.focus();\n      this._invokeEventCallback(\"onFocus\", {\n        target: this.refsInput,\n        type: \"focus\",\n      });\n    }\n\n    this.checkValidity();\n  }\n\n  /**\n   * Saves the input selection in the state so that it can be restored after\n   * updates\n   */\n  saveSelection(): void {\n    // eslint-disable-next-line react/no-direct-mutation-state\n    this.state.selectionStart = this.refsInput.selectionStart;\n    // eslint-disable-next-line react/no-direct-mutation-state\n    this.state.selectionEnd = this.refsInput.selectionEnd;\n  }\n\n  /**\n   * Unless noValidate is set to true, the component will check the\n   * existing validation state (if any) and will toggle the \"has-error\"\n   * CSS class on the wrapper\n   */\n  checkValidity(): void {\n    let valid,\n      validationError = \"\";\n\n    let supportsValidation = !!this.refsInput.checkValidity;\n\n    // noValidate\n    let noValidate = !!(\n      this.props.noValidate && this.props.noValidate !== \"false\"\n    );\n\n    this.refsInput.noValidate = noValidate;\n\n    // If \"noValidate\" is set or \"checkValidity\" is not supported then\n    // consider the element valid. Otherwise consider it invalid and\n    // make some additional checks below\n    valid = noValidate || !supportsValidation;\n\n    if (valid) {\n      validationError = \"\";\n    } else {\n      // In some browsers once a pattern is set it cannot be removed. The\n      // browser sets it to \"\" instead which results in validation\n      // failures...\n      if (this.refsInput.pattern === \"\") {\n        this.refsInput.pattern = this.props.required ? \".+\" : \".*\";\n      }\n\n      // Now check validity\n      if (supportsValidation) {\n        this.refsInput.checkValidity();\n        valid = this.refsInput.validity.valid;\n\n        if (!valid) {\n          validationError = this.refsInput.validationMessage;\n        }\n      }\n\n      // Some browsers might fail to validate maxLength\n      if (valid && supportsValidation && this.props.maxLength) {\n        if (this.refsInput.value.length > this.props.maxLength) {\n          validationError = \"This value is too long\";\n        }\n      }\n    }\n\n    validationError =\n      validationError ||\n      (valid ? \"\" : this.refsInput.validationMessage || \"Unknown Error\");\n\n    let validStateChanged = this._valid !== validationError;\n    this._valid = validationError;\n    if (validationError) {\n      addClass(this.refsWrapper, \"has-error\");\n      if (validStateChanged) {\n        this._invokeEventCallback(\n          \"onInvalid\",\n          validationError,\n          this.state.value,\n          this.refsInput.value\n        );\n      }\n    } else {\n      removeClass(this.refsWrapper, \"has-error\");\n      if (validStateChanged) {\n        this._invokeEventCallback(\n          \"onValid\",\n          this.state.value,\n          this.refsInput.value\n        );\n      }\n    }\n  }\n\n  /**\n   * Used internally to parse the argument x to it's numeric representation.\n   * If the argument cannot be converted to finite number returns 0; If a\n   * \"precision\" prop is specified uses it round the number with that\n   * precision (no fixed precision here because the return value is float, not\n   * string).\n   */\n  _toNumber(x: any): number {\n    let n = parseFloat(x);\n    if (isNaN(n) || !isFinite(n)) {\n      n = 0;\n    }\n\n    if (this._isStrict) {\n      let precision = access(this.props, \"precision\", null, this);\n      let q = Math.pow(10, precision === null ? 10 : precision);\n      let _min = +access(\n        this.props,\n        \"min\",\n        NumericInput.defaultProps.min,\n        this\n      );\n      let _max = +access(\n        this.props,\n        \"max\",\n        NumericInput.defaultProps.max,\n        this\n      );\n      n = Math.min(Math.max(n, _min), _max);\n      n = Math.round(n * q) / q;\n    }\n\n    return n;\n  }\n\n  /**\n   * This is used internally to parse any string into a number. It will\n   * delegate to this.props.parse function if one is provided. Otherwise it\n   * will just use parseFloat.\n   * @private\n   */\n  _parse(x: string): number {\n    x = String(x);\n    if (typeof this.props.parse == \"function\") {\n      return parseFloat(this.props.parse(x));\n    }\n    return parseFloat(x);\n  }\n\n  /**\n   * This is used internally to format a number to it's display representation.\n   * It will invoke the this.props.format function if one is provided.\n   * @private\n   */\n  _format(n: number): string {\n    let _n: string = this._toNumber(n).toString();\n    let precision = access(this.props, \"precision\", null, this);\n    if (precision !== null) {\n      _n = n.toFixed(precision);\n    }\n\n    _n += \"\";\n\n    if (this.props.format) {\n      return this.props.format(_n);\n    }\n\n    return _n;\n  }\n\n  /**\n   * The internal method that actually sets the new value on the input\n   * @private\n   */\n  _step(n: number, callback?: any): boolean {\n    let _isStrict = this._isStrict;\n    this._isStrict = true;\n\n    let _step = +access(\n      this.props,\n      \"step\",\n      NumericInput.defaultProps.step,\n      this,\n      n > 0 ? NumericInput.DIRECTION_UP : NumericInput.DIRECTION_DOWN\n    );\n\n    let _n = this._toNumber((this.state.value || 0) + _step * n);\n\n    if (this.props.snap) {\n      _n = Math.round(_n / _step) * _step;\n    }\n\n    this._isStrict = _isStrict;\n\n    if (_n !== this.state.value) {\n      this.setState({ value: _n, stringValue: _n + \"\" }, callback);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * This binds the Up/Down arrow key listeners\n   */\n  _onKeyDown(...args: Array<any>): void {\n    args[0].persist();\n    this._invokeEventCallback(\"onKeyDown\", ...args);\n    let e = args[0];\n    if (!e.isDefaultPrevented()) {\n      if (e.keyCode === KEYCODE_UP) {\n        e.preventDefault();\n        this._step(e.ctrlKey || e.metaKey ? 0.1 : e.shiftKey ? 10 : 1);\n      } else if (e.keyCode === KEYCODE_DOWN) {\n        e.preventDefault();\n        this._step(e.ctrlKey || e.metaKey ? -0.1 : e.shiftKey ? -10 : -1);\n      } else {\n        let value = this.refsInput.value,\n          length = value.length;\n        if (e.keyCode === 8) {\n          // backspace\n          if (\n            this.refsInput.selectionStart === this.refsInput.selectionEnd &&\n            this.refsInput.selectionEnd > 0 &&\n            value.length &&\n            value.charAt(this.refsInput.selectionEnd - 1) === \".\"\n          ) {\n            e.preventDefault();\n            this.refsInput.selectionStart = this.refsInput.selectionEnd =\n              this.refsInput.selectionEnd - 1;\n          }\n        } else if (e.keyCode === 46) {\n          // delete\n          if (\n            this.refsInput.selectionStart === this.refsInput.selectionEnd &&\n            this.refsInput.selectionEnd < length + 1 &&\n            value.length &&\n            value.charAt(this.refsInput.selectionEnd) === \".\"\n          ) {\n            e.preventDefault();\n            this.refsInput.selectionStart = this.refsInput.selectionEnd =\n              this.refsInput.selectionEnd + 1;\n          }\n        } else if (e.keyCode === 46) {\n          // @TODO: doda obsuge klikniecia enter\n        }\n      }\n    }\n  }\n\n  /**\n   * Stops the widget from auto-changing by clearing the timer (if any)\n   */\n  stop(): void {\n    if (this._timer) {\n      clearTimeout(this._timer);\n    }\n  }\n\n  /**\n   * Increments the value with one step and the enters a recursive calls\n   * after DELAY. This is bound to the mousedown event on the \"up\" button\n   * and will be stopped on mouseout/mouseup.\n   * @param {Boolean} _recursive The method is passing this to itself while\n   *  it is in recursive mode.\n   * @return void\n   */\n  increase(_recursive: boolean = false, callback?: Function): void {\n    this.stop();\n    this._step(1, callback);\n    let _max = +access(this.props, \"max\", NumericInput.defaultProps.max, this);\n    if (\n      isNaN(this.state.value ?? Number.NaN) ||\n      +(this.state.value ?? Number.NaN) < _max\n    ) {\n      this._timer = setTimeout(\n        () => {\n          this.increase(true);\n        },\n        _recursive ? NumericInput.SPEED : NumericInput.DELAY\n      );\n    }\n  }\n\n  /**\n   * Decrements the value with one step and the enters a recursive calls\n   * after DELAY. This is bound to the mousedown event on the \"down\" button\n   * and will be stopped on mouseout/mouseup.\n   * @param {Boolean} _recursive The method is passing this to itself while\n   *  it is in recursive mode.\n   * @return void\n   */\n  decrease(_recursive: boolean = false, callback?: Function): void {\n    this.stop();\n    this._step(-1, callback);\n    let _min = +access(this.props, \"min\", NumericInput.defaultProps.min, this);\n    if (\n      isNaN(this.state.value ?? Number.NaN) ||\n      +(this.state.value ?? Number.NaN) > _min\n    ) {\n      this._timer = setTimeout(\n        () => {\n          this.decrease(true);\n        },\n        _recursive ? NumericInput.SPEED : NumericInput.DELAY\n      );\n    }\n  }\n\n  /**\n   * Handles the mousedown event on the up/down buttons. Changes The\n   * internal value and sets up a delay for auto increment/decrement\n   * (until mouseup or mouseleave)\n   */\n  onMouseDown(dir: \"up\" | \"down\", callback?: Function): void {\n    if (dir === \"down\") {\n      this.decrease(false, callback);\n    } else if (dir === \"up\") {\n      this.increase(false, callback);\n    }\n  }\n\n  /**\n   * Handles the touchstart event on the up/down buttons. Changes The\n   * internal value and DOES NOT sets up a delay for auto increment/decrement.\n   * Note that this calls e.preventDefault() so the event is not used for\n   * creating a virtual mousedown after it\n   */\n  onTouchStart(dir: \"up\" | \"down\", e: Event): void {\n    e.preventDefault();\n    if (dir === \"down\") {\n      this.decrease();\n    } else if (dir === \"up\") {\n      this.increase();\n    }\n  }\n\n  onTouchEnd(e: Event): void {\n    e.preventDefault();\n    this.stop();\n  }\n\n  /**\n   * Helper method to invoke event callback functions if they are provided\n   * in the props.\n   * @param {String} callbackName The name of the function prop\n   * @param {*[]} args Any additional argument are passed thru\n   */\n  _invokeEventCallback(callbackName: string, ...args: Array<any>): void {\n    if (typeof this.props[callbackName] == \"function\") {\n      this.props[callbackName].call(null, ...args);\n    }\n  }\n\n  /**\n   * Renders an input wrapped in relative span and up/down buttons\n   * @return {Component}\n   */\n  render() {\n    let props = this.props;\n    let state = this.state;\n    let css: any = {};\n\n    let {\n      // These are ignored in rendering\n      step,\n      min,\n      max,\n      precision,\n      parse,\n      format,\n      mobile,\n      snap,\n      componentClass,\n      value,\n      type,\n      style,\n      defaultValue,\n      onInvalid,\n      onValid,\n      strict,\n      noStyle,\n\n      // The rest are passed to the input\n      ...rest\n    } = this.props;\n\n    noStyle = noStyle || style === false;\n\n    // Build the styles\n    for (let x in NumericInput.style) {\n      css[x] = Object.assign(\n        {},\n        NumericInput.style[x],\n        style ? style[x] || {} : {}\n      );\n    }\n\n    let hasFormControl =\n      props.className && /\\bform-control\\b/.test(props.className);\n\n    if (mobile === \"auto\") {\n      mobile = IS_BROWSER && \"ontouchstart\" in document;\n    }\n\n    if (typeof mobile == \"function\") {\n      mobile = mobile.call(this);\n    }\n    mobile = !!mobile;\n\n    let attrs = {\n      wrap: {\n        style: noStyle ? null : css.wrap,\n        className: \"react-numeric-input\",\n        ref: (e) => {\n          if (e !== null && e !== undefined) {\n            this.refsWrapper = e;\n          }\n        },\n        onMouseUp: undefined,\n        onMouseLeave: undefined,\n      },\n      input: {\n        ref: (e) => {\n          if (e !== null && e !== undefined) {\n            this.refsInput = e;\n          }\n        },\n        type: \"text\",\n        style: noStyle\n          ? null\n          : Object.assign(\n              {},\n              css.input,\n              !hasFormControl ? css[\"input:not(.form-control)\"] : {},\n              this._inputFocus ? css[\"input:focus\"] : {}\n            ),\n        ...rest,\n      },\n      btnUp: {\n        onMouseEnter: undefined,\n        onMouseDown: undefined,\n        onMouseUp: undefined,\n        onMouseLeave: undefined,\n        onTouchStart: undefined,\n        onTouchEnd: undefined,\n        style: noStyle\n          ? null\n          : Object.assign(\n              {},\n              css.btn,\n              css.btnUp,\n              props.disabled || props.readOnly\n                ? css[\"btn:disabled\"]\n                : state.btnUpActive\n                ? css[\"btn:active\"]\n                : state.btnUpHover\n                ? css[\"btn:hover\"]\n                : {}\n            ),\n      },\n      btnDown: {\n        onMouseEnter: undefined,\n        onMouseDown: undefined,\n        onMouseUp: undefined,\n        onMouseLeave: undefined,\n        onTouchStart: undefined,\n        onTouchEnd: undefined,\n        style: noStyle\n          ? null\n          : Object.assign(\n              {},\n              css.btn,\n              css.btnDown,\n              props.disabled || props.readOnly\n                ? css[\"btn:disabled\"]\n                : state.btnDownActive\n                ? css[\"btn:active\"]\n                : state.btnDownHover\n                ? css[\"btn:hover\"]\n                : {}\n            ),\n      },\n    };\n\n    let stringValue = String(\n      // if state.stringValue is set and not empty\n      state.stringValue ||\n        // else if state.value is set and not null|undefined\n        (state.value || state.value === 0 ? state.value : \"\") ||\n        // or finally use \"\"\n        \"\"\n    );\n\n    let loose = !this._isStrict && (this._inputFocus || !this._isMounted);\n\n    // incomplete number\n    if (loose && RE_INCOMPLETE_NUMBER.test(stringValue)) {\n      (attrs.input as any).value = stringValue;\n    }\n\n    // Not a number and not empty (loose mode only)\n    else if (loose && stringValue && !RE_NUMBER.test(stringValue)) {\n      (attrs.input as any).value = stringValue;\n    }\n\n    // number\n    else if (state.value || state.value === 0) {\n      (attrs.input as any).value = this._format(state.value);\n    }\n\n    // empty\n    else {\n      (attrs.input as any).value = \"\";\n    }\n\n    if (hasFormControl && !noStyle) {\n      Object.assign(attrs.wrap.style, css[\"wrap.hasFormControl\"]);\n    }\n\n    // mobile\n    if (mobile && !noStyle) {\n      Object.assign(attrs.input.style, css[\"input.mobile\"]);\n      Object.assign(attrs.btnUp.style, css[\"btnUp.mobile\"]);\n      Object.assign(attrs.btnDown.style, css[\"btnDown.mobile\"]);\n    }\n\n    // Attach event listeners if the widget is not disabled\n    if (!props.disabled && !props.readOnly) {\n      Object.assign(attrs.wrap, {\n        onMouseUp: this.stop,\n        onMouseLeave: this.stop,\n      });\n\n      Object.assign(attrs.btnUp, {\n        onTouchStart: this.onTouchStart.bind(this, \"up\"),\n        onTouchEnd: this.onTouchEnd,\n        onMouseEnter: () => {\n          this.setState({\n            btnUpHover: true,\n          });\n        },\n        onMouseLeave: () => {\n          this.stop();\n          this.setState({\n            btnUpHover: false,\n            btnUpActive: false,\n          });\n        },\n        onMouseUp: () => {\n          this.setState({\n            btnUpHover: true,\n            btnUpActive: false,\n          });\n        },\n        onMouseDown: (...args) => {\n          args[0].preventDefault();\n          args[0].persist();\n          this._inputFocus = true;\n          this.setState(\n            {\n              btnUpHover: true,\n              btnUpActive: true,\n            },\n            () => {\n              this._invokeEventCallback(\"onFocus\", ...args);\n              this.onMouseDown(\"up\");\n            }\n          );\n        },\n      });\n\n      Object.assign(attrs.btnDown, {\n        onTouchStart: this.onTouchStart.bind(this, \"down\"),\n        onTouchEnd: this.onTouchEnd,\n        onMouseEnter: () => {\n          this.setState({\n            btnDownHover: true,\n          });\n        },\n        onMouseLeave: () => {\n          this.stop();\n          this.setState({\n            btnDownHover: false,\n            btnDownActive: false,\n          });\n        },\n        onMouseUp: () => {\n          this.setState({\n            btnDownHover: true,\n            btnDownActive: false,\n          });\n        },\n        onMouseDown: (...args) => {\n          args[0].preventDefault();\n          args[0].persist();\n          this._inputFocus = true;\n          this.setState(\n            {\n              btnDownHover: true,\n              btnDownActive: true,\n            },\n            () => {\n              this._invokeEventCallback(\"onFocus\", ...args);\n              this.onMouseDown(\"down\");\n            }\n          );\n        },\n      });\n\n      Object.assign(attrs.input, {\n        onChange: (e) => {\n          const original = e.target.value;\n          let val: number | null = this._parse(original);\n          if (isNaN(val)) {\n            val = null;\n          }\n          this.setState({\n            value: this._isStrict ? this._toNumber(val) : val,\n            stringValue: original,\n          });\n        },\n        onKeyDown: this._onKeyDown.bind(this),\n        onInput: (...args) => {\n          this.saveSelection();\n          this._invokeEventCallback(\"onInput\", ...args);\n        },\n        onSelect: (...args) => {\n          this.saveSelection();\n          this._invokeEventCallback(\"onSelect\", ...args);\n        },\n        onFocus: (...args) => {\n          args[0].persist();\n          this._inputFocus = true;\n          const val = this._parse(args[0].target.value);\n          this.setState(\n            {\n              value: val,\n              stringValue: val || val === 0 ? val + \"\" : \"\",\n            },\n            () => {\n              this._invokeEventCallback(\"onFocus\", ...args);\n            }\n          );\n        },\n        onBlur: (...args) => {\n          let _isStrict = this._isStrict;\n          this._isStrict = true;\n          args[0].persist();\n          this._inputFocus = false;\n          const val = this._parse(args[0].target.value);\n          this.setState(\n            {\n              value: val,\n            },\n            () => {\n              this._invokeEventCallback(\"onBlur\", ...args);\n              this._isStrict = _isStrict;\n            }\n          );\n        },\n      });\n    } else {\n      if (!noStyle && props.disabled) {\n        Object.assign(attrs.input.style, css[\"input:disabled\"]);\n      }\n    }\n\n    const InputTag = componentClass || \"input\";\n\n    if (mobile) {\n      return (\n        <span {...attrs.wrap}>\n          <InputTag {...attrs.input} />\n          <b {...attrs.btnUp}>\n            <i style={noStyle ? null : css.minus} />\n            <i style={noStyle ? null : css.plus} />\n          </b>\n          <b {...attrs.btnDown}>\n            <i style={noStyle ? null : css.minus} />\n          </b>\n        </span>\n      );\n    }\n\n    return (\n      <span {...attrs.wrap}>\n        <InputTag {...attrs.input} />\n        <b {...attrs.btnUp}>\n          <i style={noStyle ? null : css.arrowUp} />\n        </b>\n        <b {...attrs.btnDown}>\n          <i style={noStyle ? null : css.arrowDown} />\n        </b>\n      </span>\n    );\n  }\n}\n","import {\n  faAlignCenter,\n  faAlignLeft,\n  faAlignRight,\n  faCheck,\n  faCircle,\n  faExclamationCircle,\n  faGripHorizontal,\n  faPlay,\n  faSquare,\n  faSquareFull,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React from \"react\";\nimport { ColorResult, SwatchesPicker } from \"react-color\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport {\n  AppEventType,\n  ChangeObject,\n  ChangeObjectsProperty,\n  ChangeSelectedObjectsAlignment,\n  ChangeUiSettings,\n  DuplicateObjects,\n  RemoveObjects,\n  SnapToLineType,\n} from \"../../controllers/AppEventType\";\nimport { getStore } from \"../../controllers/store\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport {\n  Editor,\n  Bead,\n  RegionShape,\n  Region,\n  BeadTypes,\n  BeadMaterialTypes,\n  ObjectTypes,\n  RegionGridType,\n} from \"../../editorObjects/Editor\";\nimport { ActionsTypes } from \"./ActionsTypes\";\nimport { NumericInput } from \"./NumericInput\";\nimport Slider from \"rc-slider\";\nimport \"rc-slider/assets/index.css\";\nimport { cloneDeep } from \"lodash\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { thumbnailsGenerator } from \"../../threejs/thumbnailsGenerator\";\nimport { getBricksColumnsAndRowsCount } from \"../../editorObjects/Region\";\nimport { useTranslation } from \"react-i18next\";\n\nconst createSliderWithTooltip = Slider.createSliderWithTooltip;\nconst SliderPlus = createSliderWithTooltip(Slider);\n\nexport const PopupWrapper: React.FC<{\n  offsetLeft: number;\n  type: ActionsTypes;\n}> = (props) => {\n  let leftOffset = props.offsetLeft;\n  if (\n    props.type === ActionsTypes.EditRotate ||\n    props.type === ActionsTypes.EditPosition\n  ) {\n    leftOffset = props.offsetLeft - 150;\n  }\n  if (\n    props.type === ActionsTypes.EditWidthHeight ||\n    props.type === ActionsTypes.EditWidthHeightDepth\n  ) {\n    leftOffset = props.offsetLeft - 250;\n  }\n  return (\n    <PopupWrapperStyles>\n      <div\n        className={\"popup-wrapper\"}\n        style={{\n          left: leftOffset,\n        }}\n      >\n        {props.type === ActionsTypes.EditBeadColor ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadColorPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.More ? (\n          <div className={\"popup-wrapper-content\"}>\n            <MorePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRegionShape ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRegionShapePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRegionGridType ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRegionGridTypePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRegionGridSettings ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRegionGridSettingsPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditPosition ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditPositionPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRotate ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRotatePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditWidthHeight ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditWidthHeightPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditWidthHeightDepth ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditWidthHeightDepthPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.Alignment ? (\n          <div className={\"popup-wrapper-content\"}>\n            <AlignmentPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditBeadType ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadTypePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditBeadProduct ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadProductPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditBeadMaterial ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadMaterialPopup />\n          </div>\n        ) : null}\n\n        {/* @TODO: REFACTOR THAT */}\n        {!(\n          props.type === ActionsTypes.More ||\n          props.type === ActionsTypes.EditRegionGridType ||\n          props.type === ActionsTypes.EditPosition ||\n          props.type === ActionsTypes.EditRotate ||\n          props.type === ActionsTypes.EditWidthHeight ||\n          props.type === ActionsTypes.EditWidthHeightDepth ||\n          props.type === ActionsTypes.Alignment ||\n          props.type === ActionsTypes.EditRegionGridSettings ||\n          props.type === ActionsTypes.EditRegionShape ||\n          props.type === ActionsTypes.EditBeadType ||\n          props.type === ActionsTypes.EditBeadProduct ||\n          props.type === ActionsTypes.EditBeadMaterial ||\n          props.type === ActionsTypes.EditBeadColor\n        ) ? (\n          <div className={\"popup-wrapper-content\"}>\n            <div>popup of type: {props.type}</div>\n          </div>\n        ) : null}\n      </div>\n    </PopupWrapperStyles>\n  );\n};\n\nexport const PopupWrapperStyles = styled.div`\n  .popup-wrapper {\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    background: #fff;\n    transform: translate(-50%, 0);\n    margin-top: 8px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    padding: var(--standardPadding);\n  }\n  .region-type-selection {\n    display: flex;\n    column-gap: var(--standardPadding);\n  }\n  .region-type-item {\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n    &.active {\n      background: rgba(0, 0, 0, 0.1);\n    }\n    svg path {\n      transition: all 0.4s ease-in-out;\n    }\n    &:hover {\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .columns-input {\n    width: 120px;\n  }\n  .fieldset-wrapper fieldset {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    column-gap: var(--standardPadding);\n  }\n  .region-grid-settings {\n    display: flex;\n    flex-direction: column;\n    row-gap: var(--standardPadding);\n  }\n`;\n\nconst EditBeadColorPopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const backgroundColors = useSelector((state: Editor) => {\n    const colors: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const color = (state.objects[id] as Bead).color;\n      if (colors.includes(color) === false) {\n        colors.push(color);\n      }\n    });\n    return colors;\n  });\n\n  const onSelectColor = (color: ColorResult) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              color: color.hex,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <div>\n      <SwatchesPickerStyles>\n        <SwatchesPicker\n          width={300}\n          height={300}\n          onChangeComplete={onSelectColor}\n          color={backgroundColors.length > 1 ? undefined : backgroundColors[0]}\n          className={\"SwatchesPicker-custom\"}\n        />\n      </SwatchesPickerStyles>\n    </div>\n  );\n};\n\nconst SwatchesPickerStyles = styled.div`\n  .SwatchesPicker-custom > div > div:first-child {\n    display: none !important;\n  }\n`;\n\nconst EditBeadTypePopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const types = useSelector((state: Editor) => {\n    const types: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const type = (state.objects[id] as Bead).type;\n      if (types.includes(type) === false) {\n        types.push(type);\n      }\n    });\n    return types;\n  });\n\n  const onSelect = (type: BeadTypes) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              type,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(BeadTypes.MODEL_CYLINDER);\n  };\n  const onSelectCircle = () => {\n    onSelect(BeadTypes.MODEL_SPHERE);\n  };\n  const onSelectTriangle = () => {\n    onSelect(BeadTypes.MODEL_TOHO_ROUND);\n  };\n  return (\n    <div style={{ display: \"flex\" }}>\n      <div\n        onClick={onSelectRectange}\n        className={`region-type-item ${\n          types.length === 1 && types[0] === BeadTypes.MODEL_CYLINDER\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        <FontAwesomeIcon icon={faSquareFull} />\n      </div>\n      <div\n        onClick={onSelectCircle}\n        className={`region-type-item ${\n          types.length === 1 && types[0] === BeadTypes.MODEL_SPHERE\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        <FontAwesomeIcon icon={faCircle} />\n      </div>\n      <div\n        onClick={onSelectTriangle}\n        className={`region-type-item ${\n          types.length === 1 && types[0] === BeadTypes.MODEL_TOHO_ROUND\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        <FontAwesomeIcon icon={faSquare} />\n      </div>\n    </div>\n  );\n};\n\nconst EditBeadProductPopup: React.FC<{}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const types = useSelector((state: Editor) => {\n    const types: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const type = (state.objects[id] as Bead).type;\n      if (types.includes(type) === false) {\n        types.push(type);\n      }\n    });\n    return types;\n  });\n  const onSelect = (type: BeadTypes) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              type,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(BeadTypes.MODEL_CYLINDER);\n  };\n  const onSelectCircle = () => {\n    onSelect(BeadTypes.MODEL_SPHERE);\n  };\n  const onSelectTriangle = () => {\n    onSelect(BeadTypes.MODEL_TOHO_ROUND);\n  };\n  const onSelectMore = () => {\n    const store = getStore();\n    const modalSearchProducts = cloneDeep(store.ui.modalSearchProducts);\n    modalSearchProducts.isOpen = true;\n    modalSearchProducts.successAction = \"updateBeadType\";\n    const event: ChangeUiSettings = {\n      name: AppEventType.ChangeUiSettings,\n      payload: {\n        uiSettings: {\n          modalSearchProducts,\n        },\n      },\n    };\n    sendEvent(event);\n  };\n  const bead1 = buildBead({ type: BeadTypes.MODEL_CYLINDER });\n  const bead2 = buildBead({ type: BeadTypes.MODEL_SPHERE });\n  const bead3 = buildBead({ type: BeadTypes.MODEL_TOHO_ROUND });\n  // @TODO: doda ostatnio wybrane produkty do popup\n  return (\n    <div style={{ display: \"flex\", flexDirection: \"column\" }}>\n      <div style={{ display: \"flex\" }}>\n        <div\n          onClick={onSelectRectange}\n          className={`region-type-item ${\n            types.length === 1 && types[0] === BeadTypes.MODEL_CYLINDER\n              ? \"active\"\n              : \"\"\n          }`}\n        >\n          <img\n            src={thumbnailsGenerator.getObjectThumbnail(bead1, 30, 30)}\n            alt={\"\"}\n          />\n        </div>\n        <div\n          onClick={onSelectCircle}\n          className={`region-type-item ${\n            types.length === 1 && types[0] === BeadTypes.MODEL_SPHERE\n              ? \"active\"\n              : \"\"\n          }`}\n        >\n          <img\n            src={thumbnailsGenerator.getObjectThumbnail(bead2, 30, 30)}\n            alt={\"\"}\n          />\n        </div>\n        <div\n          onClick={onSelectTriangle}\n          className={`region-type-item ${\n            types.length === 1 && types[0] === BeadTypes.MODEL_TOHO_ROUND\n              ? \"active\"\n              : \"\"\n          }`}\n        >\n          <img\n            src={thumbnailsGenerator.getObjectThumbnail(bead3, 30, 30)}\n            alt={\"\"}\n          />\n        </div>\n      </div>\n\n      <div onClick={onSelectMore} style={{ cursor: \"pointer\" }}>\n        {t(\"board:edit_bead_popup.search_beads\")}\n      </div>\n    </div>\n  );\n};\n\nconst EditBeadMaterialPopup: React.FC<{}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const materialTypes = useSelector((state: Editor) => {\n    const types: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const type = (state.objects[id] as Bead).material;\n      if (types.includes(type) === false) {\n        types.push(type);\n      }\n    });\n    return types;\n  });\n\n  const onSelect = (material: BeadMaterialTypes) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              material,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(BeadMaterialTypes.Mat);\n  };\n  const onSelectCircle = () => {\n    onSelect(BeadMaterialTypes.Shiny);\n  };\n  return (\n    <div\n      style={{\n        width: 100,\n        display: \"flex\",\n        flexDirection: \"column\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n      }}\n    >\n      <div\n        onClick={onSelectRectange}\n        className={`region-type-item ${\n          materialTypes.length === 1 &&\n          materialTypes[0] === BeadMaterialTypes.Mat\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        {t(\"board:edit_bead_popup.bead_material_mat\")}\n      </div>\n      <div\n        onClick={onSelectCircle}\n        className={`region-type-item ${\n          materialTypes.length === 1 &&\n          materialTypes[0] === BeadMaterialTypes.Shiny\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        {t(\"board:edit_bead_popup.bead_material_shine\")}\n      </div>\n    </div>\n  );\n};\n\nconst EditRegionGridTypePopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n\n  const onSelect = (gridType: RegionGridType) => {\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const region = store.objects[id] as Region;\n          const properties: ChangeObject[\"properties\"] = {\n            gridType,\n            shape: region.shape,\n            columns: region.columns,\n            rows: region.rows,\n          };\n          const columnsKey: keyof Region = \"columns\";\n          const rowsKey: keyof Region = \"rows\";\n          if (\n            gridType === RegionGridType.Bricks &&\n            region.shape === RegionShape.Triangle\n          ) {\n            const cols = (store.objects[id] as Region).columns;\n            const { columns, rows } = getBricksColumnsAndRowsCount(cols);\n            properties[columnsKey] = columns;\n            properties[rowsKey] = rows;\n          }\n          const change: ChangeObject = {\n            id,\n            properties,\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRect = () => {\n    onSelect(RegionGridType.Rectangles);\n  };\n  const onSelectBricks = () => {\n    onSelect(RegionGridType.Bricks);\n  };\n  return (\n    <div className={\"region-type-selection\"}>\n      <div onClick={onSelectRect} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faGripHorizontal} />\n      </div>\n      <div onClick={onSelectBricks} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faAlignCenter} />\n      </div>\n    </div>\n  );\n};\n\nconst EditRegionShapePopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n\n  const onSelect = (shape: RegionShape) => {\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const region = store.objects[id] as Region;\n          const columnsKey: keyof Region = \"columns\";\n          const rowsKey: keyof Region = \"rows\";\n          const properties: ChangeObject[\"properties\"] = {\n            shape: shape,\n            gridType: region.gridType,\n            columns: region.columns,\n            rows: region.rows,\n          };\n          if (\n            region.gridType === RegionGridType.Bricks &&\n            shape === RegionShape.Triangle\n          ) {\n            const cols = (store.objects[id] as Region).columns;\n            const { columns, rows } = getBricksColumnsAndRowsCount(cols);\n            properties[columnsKey] = columns;\n            properties[rowsKey] = rows;\n          }\n          const change: ChangeObject = {\n            id,\n            properties,\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(RegionShape.Rectangle);\n  };\n  // @TODO: doda kolejne ksztaty takie jak koo czy trojkt\n  //   const onSelectCircle = () => {\n  //     onSelect(RegionShape.Circle);\n  //   };\n  const onSelectTriangle = () => {\n    onSelect(RegionShape.Triangle);\n  };\n  return (\n    <div className={\"region-type-selection\"}>\n      <div onClick={onSelectRectange} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faSquare} />\n      </div>\n      {/* <div onClick={onSelectCircle} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faCircle} />\n      </div> */}\n      <div onClick={onSelectTriangle} className={\"region-type-item\"}>\n        <FontAwesomeIcon\n          icon={faPlay}\n          style={{ transform: \"rotate(-90deg)\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst EditRegionGridSettingsPopup: React.FC<{}> = () => {\n  const [t] = useTranslation([\"board\"]);\n  const { columns, rows, showRows } = useSelector((state: Editor) => {\n    const columns: number[] = [];\n    const rows: number[] = [];\n    let onlyBricks: boolean = true;\n    let onlyShapeTriange: boolean = true;\n    state.selectedIds.forEach((id) => {\n      if (state.objects[id] === undefined) {\n        return;\n      }\n      if (state.objects[id].objectType !== ObjectTypes.Region) {\n        onlyBricks = false;\n        onlyShapeTriange = false;\n        return;\n      }\n      if ((state.objects[id] as Region).gridType !== RegionGridType.Bricks) {\n        onlyBricks = false;\n      }\n\n      if ((state.objects[id] as Region).shape !== RegionShape.Triangle) {\n        onlyShapeTriange = false;\n      }\n\n      const _columns = (state.objects[id] as Region).columns;\n      const _rows = (state.objects[id] as Region).rows;\n      if (columns.includes(_columns) === false) {\n        columns.push(_columns);\n      }\n      if (rows.includes(_rows) === false) {\n        rows.push(_rows);\n      }\n    });\n    return {\n      columns,\n      rows,\n      showRows: !(\n        (onlyBricks as boolean) === true &&\n        (onlyShapeTriange as boolean) === true\n      ),\n    };\n  });\n\n  const onChangeRows = (values: number) => {\n    if (values === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const region = store.objects[id] as Region;\n          const change: ChangeObject = {\n            id,\n            properties: {\n              shape: region.shape,\n              gridType: region.gridType,\n              columns: region.columns,\n              rows: values,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeColumns = (values: number) => {\n    if (values === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const region = store.objects[id] as Region;\n          const properties: ChangeObject[\"properties\"] = {\n            columns: values,\n            rows: region.rows,\n            shape: region.shape,\n            gridType: region.gridType,\n          };\n          if (showRows === false) {\n            const columnsKey: keyof Region = \"columns\";\n            const rowsKey: keyof Region = \"rows\";\n            const { columns, rows } = getBricksColumnsAndRowsCount(values);\n            properties[columnsKey] = columns;\n            properties[rowsKey] = rows;\n          }\n          const change: ChangeObject = {\n            id,\n            properties,\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div className={\"region-grid-settings\"}>\n      <div className={\"region-grid-settings-columns\"}>\n        <InputTypeNumber\n          defaultValue={columns.length > 1 ? undefined : columns[0]}\n          max={20}\n          min={1}\n          step={1}\n          showDecimal={false}\n          label={t(\"board:edit_bead_popup.region_columns\")}\n          onChange={onChangeColumns}\n        />\n      </div>\n      {showRows ? (\n        <div className={\"region-grid-settings-rows\"}>\n          <InputTypeNumber\n            max={20}\n            min={1}\n            step={1}\n            defaultValue={rows.length > 1 ? undefined : rows[0]}\n            showDecimal={false}\n            label={t(\"board:edit_bead_popup.region_rows\")}\n            onChange={onChangeRows}\n          />\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nconst InputTypeNumber: React.FC<{\n  defaultValue: number | undefined;\n  label: string;\n  onChange: (values: number) => void;\n  min: number;\n  max: number;\n  step: number;\n  showDecimal: boolean;\n}> = (props) => {\n  function roundTo(n) {\n    var negative = false;\n    var digits = 2;\n    if (n < 0) {\n      negative = true;\n      n = n * -1;\n    }\n    var multiplicator = Math.pow(10, digits);\n    n = parseFloat((n * multiplicator).toFixed(11));\n    n = (Math.round(n) / multiplicator).toFixed(digits);\n    if (negative) {\n      n = (n * -1).toFixed(digits);\n    }\n    return n;\n  }\n\n  return (\n    <div>\n      <div className={\"fieldset-wrapper\"}>\n        <fieldset>\n          <label>{props.label}</label>\n          <NumericInput\n            min={props.min}\n            max={props.max}\n            step={props.step}\n            className={\"columns-input\"}\n            value={props.defaultValue}\n            strict={true}\n            onChange={props.onChange}\n            mobile={true}\n            format={props.showDecimal ? roundTo : undefined}\n            // parse={roundTo}\n          />\n        </fieldset>\n      </div>\n    </div>\n  );\n};\n\nconst EditPositionPopup: React.FC<{}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const { x, y } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    const result_z: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _x = state.objects[id].position.x;\n      const _y = state.objects[id].position.y;\n      const _z = state.objects[id].position.z;\n      if (result_x.includes(_x) === false) {\n        result_x.push(_x);\n      }\n      if (result_y.includes(_y) === false) {\n        result_y.push(_y);\n      }\n      if (result_z.includes(_z) === false) {\n        result_z.push(_z);\n      }\n    });\n    return {\n      x: result_x,\n      y: result_y,\n      z: result_z,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const object = store.objects[id];\n          const change: ChangeObject = {\n            id,\n            properties: {\n              position: {\n                x: newValue,\n                y: object.position.y,\n                z: object.position.z,\n              },\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const object = store.objects[id];\n          const change: ChangeObject = {\n            id,\n            properties: {\n              position: {\n                x: object.position.x,\n                y: newValue,\n                z: object.position.z,\n              },\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  // const onChangeZ = (newValue: number) => {\n  //   if (newValue === undefined) {\n  //     return;\n  //   }\n  //   const store = getStore();\n  //   const event: ChangeObjectsProperty = {\n  //     name: AppEventType.ChangeObjectsProperty,\n  //     payload: {\n  //       changes: store.selectedIds.map((id) => {\n  //         if (!store.objects[id]) {\n  //           return {\n  //             id,\n  //             properties: {},\n  //           };\n  //         }\n  //         const object = store.objects[id];\n  //         const change: ChangeObject = {\n  //           id,\n  //           properties: {\n  //             position: {\n  //               x: object.position.x,\n  //               y: object.position.y,\n  //               z: newValue,\n  //             },\n  //           },\n  //         };\n  //         return change;\n  //       }),\n  //     },\n  //   };\n  //   sendEvent(event);\n  // };\n  return (\n    <div>\n      <span>{t(\"board:edit_bead_popup.position\")}</span>\n      <br />\n      <InputTypeNumber\n        defaultValue={x.length > 1 ? undefined : x[0]}\n        min={-1000}\n        max={1000}\n        showDecimal={false}\n        step={0.1}\n        label={t(\"board:edit_bead_popup.position_x\")}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={x.length > 1 ? 0 : x[0]}\n        onChange={onChangeX}\n        min={-1000}\n        max={1000}\n      />\n      <InputTypeNumber\n        defaultValue={y.length > 1 ? undefined : y[0]}\n        min={-1000}\n        max={1000}\n        showDecimal={false}\n        step={0.1}\n        label={t(\"board:edit_bead_popup.position_y\")}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={y.length > 1 ? 0 : y[0]}\n        onChange={onChangeY}\n        min={-1000}\n        max={1000}\n      />\n      {/* @TODO: doda obsluge zmiany position z */}\n      {/* <InputTypeNumber\n        defaultValue={z.length > 1 ? undefined : z[0]}\n        min={-500}\n        max={500}\n        label={t(\"board:edit_bead_popup.position_z\")}\n        onChange={onChangeZ}\n      />\n      <SliderWrapper value={z.length > 1 ? 0 : z[0]} onChange={onChangeZ}\n        min={-1000}\n        max={1000} /> */}\n    </div>\n  );\n};\n\nconst SliderWrapper: React.FC<{\n  value: number;\n  onChange: any;\n  min: number;\n  max: number;\n}> = (props) => {\n  const [value, setValue] = React.useState<number>(props.value);\n  return (\n    <div style={{ marginBottom: 8, marginTop: 8 }}>\n      <SliderPlus\n        step={1}\n        min={props.min}\n        max={props.max}\n        value={value}\n        onChange={(value) => {\n          setValue(value);\n        }}\n        onAfterChange={(value) => {\n          props.onChange(value);\n        }}\n      />\n    </div>\n  );\n};\n\nconst EditRotatePopup: React.FC<{}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const { x, y, z } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    const result_z: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _x = state.objects[id].rotateX;\n      const _y = state.objects[id].rotateY;\n      const _z = state.objects[id].rotateZ;\n      if (result_x.includes(_x) === false) {\n        result_x.push(_x);\n      }\n      if (result_y.includes(_y) === false) {\n        result_y.push(_y);\n      }\n      if (result_z.includes(_z) === false) {\n        result_z.push(_z);\n      }\n    });\n    return {\n      x: result_x,\n      y: result_y,\n      z: result_z,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              rotateX: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              rotateY: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeZ = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              rotateZ: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div>\n      <span>{t(\"board:edit_bead_popup.rotate\")}</span>\n      <br />\n      <InputTypeNumber\n        defaultValue={x.length > 1 ? undefined : x[0]}\n        min={-360}\n        max={360}\n        showDecimal={false}\n        step={1}\n        label={t(\"board:edit_bead_popup.rotate_x\")}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={x.length > 1 ? 0 : x[0]}\n        onChange={onChangeX}\n        max={360}\n        min={-360}\n      />\n      <InputTypeNumber\n        defaultValue={y.length > 1 ? undefined : y[0]}\n        min={-360}\n        max={360}\n        showDecimal={false}\n        step={1}\n        label={t(\"board:edit_bead_popup.rotate_y\")}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={y.length > 1 ? 0 : y[0]}\n        onChange={onChangeY}\n        max={360}\n        min={-360}\n      />\n\n      <InputTypeNumber\n        defaultValue={z.length > 1 ? undefined : z[0]}\n        min={-360}\n        max={360}\n        step={1}\n        showDecimal={false}\n        label={t(\"board:edit_bead_popup.rotate_z\")}\n        onChange={onChangeZ}\n      />\n      <SliderWrapper\n        value={z.length > 1 ? 0 : z[0]}\n        onChange={onChangeZ}\n        max={360}\n        min={-360}\n      />\n    </div>\n  );\n};\n\nconst EditWidthHeightPopup: React.FC<{}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const { width, height } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _width = state.objects[id].width;\n      const _height = state.objects[id].height;\n      if (result_x.includes(_width) === false) {\n        result_x.push(_width);\n      }\n      if (result_y.includes(_height) === false) {\n        result_y.push(_height);\n      }\n    });\n    return {\n      width: result_x,\n      height: result_y,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              width: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              height: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div>\n      <span>{t(\"board:edit_bead_popup.size\")}</span>\n      <br />\n      <InputTypeNumber\n        defaultValue={width.length > 1 ? undefined : width[0]}\n        max={500}\n        min={1}\n        step={0.1}\n        showDecimal={true}\n        label={t(\"board:edit_bead_popup.width\")}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={width.length > 1 ? 0 : width[0]}\n        onChange={onChangeX}\n        max={500}\n        min={1}\n      />\n      <InputTypeNumber\n        defaultValue={height.length > 1 ? undefined : height[0]}\n        max={500}\n        min={1}\n        step={0.1}\n        showDecimal={true}\n        label={t(\"board:edit_bead_popup.height\")}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={height.length > 1 ? 0 : height[0]}\n        onChange={onChangeY}\n        max={500}\n        min={1}\n      />\n    </div>\n  );\n};\n\nconst EditWidthHeightDepthPopup: React.FC<{}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const { width, height, depth } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    const result_z: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _x = state.objects[id].width;\n      const _y = state.objects[id].height;\n      const _z = state.objects[id].depth;\n      if (result_x.includes(_x) === false) {\n        result_x.push(_x);\n      }\n      if (result_y.includes(_y) === false) {\n        result_y.push(_y);\n      }\n      if (result_z.includes(_z) === false) {\n        result_z.push(_z);\n      }\n    });\n    return {\n      width: result_x,\n      height: result_y,\n      depth: result_z,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              width: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              height: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeZ = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              depth: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div>\n      <span>{t(\"board:edit_bead_popup.size\")}</span>\n      <br />\n      <InputTypeNumber\n        defaultValue={width.length > 1 ? undefined : width[0]}\n        min={1}\n        max={500}\n        showDecimal={true}\n        step={0.1}\n        label={t(\"board:edit_bead_popup.height\")}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={width.length > 1 ? 0 : width[0]}\n        onChange={onChangeX}\n        min={1}\n        max={500}\n      />\n      <InputTypeNumber\n        defaultValue={height.length > 1 ? undefined : height[0]}\n        min={1}\n        max={500}\n        showDecimal={true}\n        step={0.1}\n        label={t(\"board:edit_bead_popup.height\")}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={height.length > 1 ? 0 : height[0]}\n        onChange={onChangeY}\n        min={1}\n        max={500}\n      />\n\n      <InputTypeNumber\n        defaultValue={depth.length > 1 ? undefined : depth[0]}\n        min={1}\n        max={500}\n        showDecimal={true}\n        step={0.1}\n        label={t(\"board:edit_bead_popup.depth\")}\n        onChange={onChangeZ}\n      />\n      <SliderWrapper\n        value={depth.length > 1 ? 0 : depth[0]}\n        onChange={onChangeZ}\n        min={1}\n        max={500}\n      />\n    </div>\n  );\n};\n\nconst AlignmentPopup: React.FC<{}> = (props) => {\n  const sendSnapTo = (snapType: SnapToLineType) => {\n    const store = getStore();\n\n    const event: ChangeSelectedObjectsAlignment = {\n      name: AppEventType.ChangeObjectsAlignment,\n      payload: {\n        selectedIds: store.selectedIds,\n        snapType,\n      },\n    };\n    sendEvent(event);\n  };\n\n  const onClickAlighXLeft = () => {\n    sendSnapTo(SnapToLineType.X_MIN);\n  };\n  const onClickAlighXMiddle = () => {\n    sendSnapTo(SnapToLineType.X_MIDDLE);\n  };\n  const onClickAlighXRight = () => {\n    sendSnapTo(SnapToLineType.X_MAX);\n  };\n  const onClickAlighYLeft = () => {\n    sendSnapTo(SnapToLineType.Y_MIN);\n  };\n  const onClickAlighYMiddle = () => {\n    sendSnapTo(SnapToLineType.Y_MIDDLE);\n  };\n  const onClickAlighYRight = () => {\n    sendSnapTo(SnapToLineType.Y_MAX);\n  };\n  const uiButton = getComputedStyle(document.body).getPropertyValue(\n    \"--uiButton\"\n  );\n  return (\n    <div>\n      X: <br />\n      <button onClick={onClickAlighXLeft}>\n        <FontAwesomeIcon icon={faAlignLeft} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighXMiddle}>\n        <FontAwesomeIcon icon={faAlignCenter} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighXRight}>\n        <FontAwesomeIcon icon={faAlignRight} color={uiButton} size={\"lg\"} />\n      </button>\n      <br />\n      <br />\n      Y: <br />\n      <button onClick={onClickAlighYLeft}>\n        <FontAwesomeIcon icon={faAlignLeft} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighYMiddle}>\n        <FontAwesomeIcon icon={faAlignCenter} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighYRight}>\n        <FontAwesomeIcon icon={faAlignRight} color={uiButton} size={\"lg\"} />\n      </button>\n    </div>\n  );\n};\n\nconst MorePopup: React.FC<{}> = (props) => {\n  const [t] = useTranslation([\"board\"]);\n  const onlyRegionsInfo = useSelector((state: Editor) => {\n    let snapToCellChecked: \"allFalse\" | \"mixed\" | \"allTrue\" | \"unknow\" =\n      \"unknow\";\n    let autoFillChecked: \"allFalse\" | \"mixed\" | \"allTrue\" | \"unknow\" = \"unknow\";\n    let regionIds: string[] = [];\n    let onlyRegions: boolean = state.selectedIds.length > 0 ? true : false;\n    for (let i = 0; i < state.selectedIds.length; i++) {\n      const id = state.selectedIds[i];\n      if (state.objects[id] === undefined) {\n        continue;\n      }\n      const objectType = state.objects[id].objectType;\n      if (objectType !== ObjectTypes.Region) {\n        onlyRegions = false;\n        break;\n      }\n\n      const _value1 = (state.objects[id] as Region).snapBeadsToCell;\n      if (snapToCellChecked === \"unknow\") {\n        snapToCellChecked = _value1 === true ? \"allTrue\" : \"allFalse\";\n      } else {\n        if (snapToCellChecked === \"allTrue\" && _value1 === false) {\n          snapToCellChecked = \"mixed\";\n        } else if (snapToCellChecked === \"allFalse\" && _value1 === true) {\n          snapToCellChecked = \"mixed\";\n        }\n      }\n\n      const _value2 = (state.objects[id] as Region).autoFillBeads;\n      if (autoFillChecked === \"unknow\") {\n        autoFillChecked = _value2 === true ? \"allTrue\" : \"allFalse\";\n      } else {\n        if (autoFillChecked === \"allTrue\" && _value2 === false) {\n          autoFillChecked = \"mixed\";\n        } else if (autoFillChecked === \"allFalse\" && _value2 === true) {\n          autoFillChecked = \"mixed\";\n        }\n      }\n\n      regionIds.push(id);\n    }\n    return { onlyRegions, snapToCellChecked, autoFillChecked, regionIds };\n  });\n\n  const onClickDuplicate = () => {\n    const store = getStore();\n    const event: DuplicateObjects = {\n      name: AppEventType.DuplicateObjects,\n      payload: {\n        objects: store.selectedIds.map((id) => store.objects[id]),\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickDelete = () => {\n    const store = getStore();\n    const event: RemoveObjects = {\n      name: AppEventType.RemoveObjects,\n      payload: {\n        ids: store.selectedIds,\n      },\n    };\n    sendEvent(event);\n  };\n  // const onClickCopy = () => {\n  //   const event: ClipboardCopy = {\n  //     name: AppEventType.ClipboardCopy,\n  //     payload: {},\n  //   };\n  //   sendEvent(event);\n  // };\n  const onClickAutofill = () => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: onlyRegionsInfo.regionIds.map((id) => {\n          let newValue: boolean = true;\n          if (onlyRegionsInfo.autoFillChecked === \"allTrue\") {\n            newValue = false;\n          } else if (onlyRegionsInfo.autoFillChecked === \"allFalse\") {\n            newValue = true;\n          } else {\n            newValue = true;\n          }\n          return {\n            id,\n            properties: {\n              autoFillBeads: newValue,\n            },\n          };\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickSnaptocell = () => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: onlyRegionsInfo.regionIds.map((id) => {\n          let newValue: boolean = true;\n          if (onlyRegionsInfo.snapToCellChecked === \"allTrue\") {\n            newValue = false;\n          } else if (onlyRegionsInfo.snapToCellChecked === \"allFalse\") {\n            newValue = true;\n          } else {\n            newValue = true;\n          }\n          return {\n            id,\n            properties: {\n              snapBeadsToCell: newValue,\n            },\n          };\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        minWidth: 220,\n      }}\n    >\n      {onlyRegionsInfo.onlyRegions === true ? (\n        <React.Fragment>\n          <div onClick={onClickAutofill}>\n            <span>{t(\"board:edit_bead_popup.region_autofill\")}</span>\n            {onlyRegionsInfo.autoFillChecked === \"allTrue\" ? (\n              <FontAwesomeIcon icon={faCheck} color={\"#000\"} />\n            ) : null}\n            {onlyRegionsInfo.autoFillChecked === \"mixed\" ? (\n              <FontAwesomeIcon icon={faExclamationCircle} color={\"#444\"} />\n            ) : null}\n          </div>\n\n          <div onClick={onClickSnaptocell}>\n            <span>{t(\"board:edit_bead_popup.region_snap_to_cell\")}</span>\n            {onlyRegionsInfo.snapToCellChecked === \"allTrue\" ? (\n              <FontAwesomeIcon icon={faCheck} color={\"#000\"} />\n            ) : null}\n\n            {onlyRegionsInfo.snapToCellChecked === \"mixed\" ? (\n              <FontAwesomeIcon icon={faExclamationCircle} color={\"#444\"} />\n            ) : null}\n          </div>\n        </React.Fragment>\n      ) : null}\n      {/* <div onClick={onClickCopy}>Copy</div> */}\n      <div onClick={onClickDuplicate}>\n        {t(\"board:edit_bead_popup.duplicate\")}\n      </div>\n      <div onClick={onClickDelete}>{t(\"board:edit_bead_popup.delete\")}</div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Bead, Editor,  ObjectTypes } from \"../../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { Actions, ActionsTypes, MapActionObjectType } from \"./ActionsTypes\";\nimport { ActionsIconsWrapper } from \"./ActionsIconsWrapper\";\nimport { PopupWrapper } from \"./PopupWrapper\";\n// import { getStore } from \"../../controllers/store\";\n\nexport const TopBarContent: React.FC<{ x: number; y: number }> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const actionsGrouped = useSelector((state: Editor) => {\n    const selectedActions: ActionsTypes[] = [];\n    state.selectedIds.forEach((id) => {\n      if (state.objects[id]) {\n        const objectType = state.objects[id].objectType;\n        const actionsForType = MapActionObjectType[objectType];\n        if (selectedActions.length === 0) {\n          actionsForType.forEach((action) => {\n            selectedActions.push(action);\n          });\n        } else {\n          for (let i = selectedActions.length - 1; i >= 0; i--) {\n            const action = selectedActions[i];\n            if (actionsForType.includes(action) === false) {\n              selectedActions.splice(selectedActions.indexOf(action), 1);\n            }\n          }\n        }\n      }\n    });\n    const result: ActionsTypes[][] = [];\n    let groupedResults: { [key: string]: ActionsTypes[] } = {};\n    selectedActions.forEach((action) => {\n      if (Actions[action]) {\n        if (action === ActionsTypes.Alignment) {\n          if (state.selectedIds.length === 1) {\n            return;\n          }\n        }\n        if (action === ActionsTypes.Lock || action === ActionsTypes.Unlock) {\n          if (state.selectedIds.length === 1) {\n            const id = state.selectedIds[0];\n            const obj = state.objects[id];\n            if (obj.isLocked === true) {\n              groupedResults = {};\n              groupedResults[Actions[ActionsTypes.Unlock].groupId] = [\n                ActionsTypes.Unlock,\n              ];\n              return false;\n            }\n            if (obj.isLocked === false && action === ActionsTypes.Unlock) {\n              return;\n            }\n          } else {\n            let containsLockedGroup: any = false;\n            state.selectedIds.forEach((objectId) => {\n              if (state.objects[objectId] === undefined) {\n                return;\n              }\n\n              const isGroup =\n                state.objects[objectId].objectType === ObjectTypes.Group;\n              const groupIdKey: keyof Bead = \"groupId\";\n              const isInGroup =\n                state.objects[objectId][groupIdKey] !== undefined &&\n                state.objects[objectId][groupIdKey]!.length > 0;\n              const groupId = state.objects[objectId][groupIdKey]!;\n              if (isGroup) {\n                const obj = state.objects[objectId];\n                if (obj.isLocked === true) {\n                  groupedResults = {};\n                  groupedResults[Actions[ActionsTypes.Unlock].groupId] = [\n                    ActionsTypes.Unlock,\n                  ];\n                  containsLockedGroup = true;\n                  return false;\n                }\n                if (obj.isLocked === false && action === ActionsTypes.Unlock) {\n                  containsLockedGroup = true;\n                  return;\n                }\n              } else if (isInGroup) {\n                const obj = state.objects[groupId];\n                if (obj.isLocked === true) {\n                  groupedResults = {};\n                  groupedResults[Actions[ActionsTypes.Unlock].groupId] = [\n                    ActionsTypes.Unlock,\n                  ];\n                  containsLockedGroup = true;\n                  return false;\n                }\n                if (obj.isLocked === false && action === ActionsTypes.Unlock) {\n                  containsLockedGroup = true;\n                  return;\n                }\n              }\n            });\n            if (containsLockedGroup === true) {\n              return;\n            } else {\n              if (action === ActionsTypes.Unlock) {\n                return;\n              }\n            }\n          }\n        }\n        if (action === ActionsTypes.Group || action === ActionsTypes.Ungroup) {\n          if (state.selectedIds.length === 1) {\n            return;\n          } else {\n            //@TODO: zmienic typ z any na boolean\n            let containsRegion: any = false;\n            let anySelectedBeadInRegion: any = false;\n\n            // let containsGroup: any = false;\n            // let allCount: any = state.selectedIds.length;\n            let groupCount: any = 0;\n            let inGroupCount: any = 0;\n            let noGroupCount: any = 0;\n\n            state.selectedIds.forEach((objectId) => {\n              if (containsRegion === true) {\n                return;\n              }\n              if (anySelectedBeadInRegion === true) {\n                return;\n              }\n              if (state.objects[objectId] === undefined) {\n                return;\n              }\n              if (state.objects[objectId].objectType === ObjectTypes.Region) {\n                containsRegion = true;\n                return;\n              }\n\n              if (state.objects[objectId].objectType === ObjectTypes.Bead) {\n                if ((state.objects[objectId] as Bead).regionId !== undefined) {\n                  anySelectedBeadInRegion = true;\n                  return;\n                }\n              }\n\n              const isGroup =\n                state.objects[objectId].objectType === ObjectTypes.Group;\n\n              const groupIdKey: keyof Bead = \"groupId\";\n              const isInGroup =\n                state.objects[objectId][groupIdKey] !== undefined &&\n                state.objects[objectId][groupIdKey]!.length > 0;\n              if (isGroup) {\n                groupCount = groupCount + 1;\n              } else if (isInGroup) {\n                inGroupCount = inGroupCount + 1;\n              } else {\n                noGroupCount = noGroupCount + 1;\n              }\n            });\n\n            if (containsRegion === true) {\n              return;\n            }\n\n            if (anySelectedBeadInRegion === true) {\n              return;\n            }\n\n            // console.log(\n            //   \"------------- jak jest?\",\n            //   allCount,\n            //   groupCount,\n            //   inGroupCount,\n            //   noGroupCount\n            // );\n            if (noGroupCount === 0 && groupCount > 0) {\n              if (action === ActionsTypes.Group) {\n                return;\n              }\n            } else if (groupCount > 0 || inGroupCount > 0) {\n              // do nothing\n            } else {\n              if (action === ActionsTypes.Ungroup) {\n                return;\n              }\n            }\n          }\n        }\n        if (!groupedResults[Actions[action].groupId]) {\n          groupedResults[Actions[action].groupId] = [action];\n        } else {\n          groupedResults[Actions[action].groupId].push(action);\n        }\n      }\n    });\n    Object.keys(groupedResults)\n      .sort((groupIdA, groupIdB) => {\n        const firstActionA = groupedResults[groupIdA][0];\n        const firstActionB = groupedResults[groupIdB][0];\n        const groupSortOrderA = Actions[firstActionA].groupSortOrder;\n        const groupSortOrderB = Actions[firstActionB].groupSortOrder;\n        return groupSortOrderA === groupSortOrderB\n          ? 0\n          : groupSortOrderA > groupSortOrderB\n          ? 1\n          : -1;\n      })\n      .forEach((groupId) => {\n        const actions = groupedResults[groupId].sort((actionA, actionB) => {\n          return Actions[actionA].sortOrder === Actions[actionB].sortOrder\n            ? 0\n            : Actions[actionA].sortOrder > Actions[actionB].sortOrder\n            ? 1\n            : -1;\n        });\n        result.push(actions);\n      });\n    return result;\n  });\n  const [popupInfo, setPopupInfo] = React.useState<{\n    isOpen: boolean;\n    type: ActionsTypes | undefined;\n    offsetLeft: number;\n  }>({\n    isOpen: false,\n    type: undefined,\n    offsetLeft: 0,\n  });\n  const onClickAnyIcon = (type: ActionsTypes, offsetLeft: number) => {\n    const newValue = type === popupInfo.type ? !popupInfo.isOpen : true;\n    setPopupInfo({\n      isOpen: newValue,\n      type,\n      offsetLeft,\n    });\n  };\n\n  React.useEffect(() => {\n    setPopupInfo({\n      isOpen: false,\n      type: undefined,\n      offsetLeft: 0,\n    });\n  }, [selectedIds]);\n\n  return (\n    <div\n      className={`selected-objects-top-bar`}\n      style={{\n        top: props.y,\n        left: props.x,\n      }}\n    >\n      <div className={\"content-wrapper\"}>\n        <div className={\"action-icons-wrapper\"}>\n          {actionsGrouped.map((actions, index) => {\n            return (\n              <ActionsIconsWrapper\n                key={index}\n                actions={actions}\n                onClick={onClickAnyIcon}\n                selectedAction={\n                  popupInfo.isOpen === true && popupInfo.type !== undefined\n                    ? popupInfo.type\n                    : undefined\n                }\n              />\n            );\n          })}\n        </div>\n\n        {popupInfo.isOpen === true && popupInfo.type !== undefined ? (\n          <PopupWrapper\n            offsetLeft={popupInfo.offsetLeft}\n            type={popupInfo.type}\n          />\n        ) : null}\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Editor } from \"../../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport { TopBarContent } from \"./TopBarContent\";\n\n\nexport const SelectedObjectsTopBar: React.FC<{}> = (props) => {\n  const selectedTopBarPosition = useSelector((state: Editor) => {\n    return state.ui.selectedTopBarPosition;\n  });\n\n  if (selectedTopBarPosition === undefined) {\n    return null;\n  }\n\n  return (\n    <SelectedObjectsTopBarStyles\n      style={{\n        zIndex:\n          selectedTopBarPosition === undefined\n            ? \"-5\"\n            : (\"var(--zIndexSelectedObjectsTopBar)\" as any),\n      }}\n    >\n      {selectedTopBarPosition !== undefined ? (\n        <TopBarContent\n          x={selectedTopBarPosition.x}\n          y={selectedTopBarPosition.y}\n        />\n      ) : null}\n    </SelectedObjectsTopBarStyles>\n  );\n};\n\nexport const SelectedObjectsTopBarStyles = styled.div`\n  .selected-objects-top-bar {\n    position: fixed;\n    top: 100px;\n    z-index: var(--zIndexSelectedObjectsTopBar);\n  }\n\n  .content-wrapper {\n    position: absolute;\n    left: 50%;\n    transform: translate(-50%, -65px);\n    height: 55px;\n    padding: 0 12px;\n    background: #fff;\n    border-radius: 4;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n  }\n  .action-icons-wrapper {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    column-gap: calc(var(--standardPadding) * 2);\n    width: 100%;\n    height: 100%;\n  }\n\n  .action-icons-wrapper > div:nth-last-child(1) .actions-group:before {\n    background: transparent;\n  }\n\n  .action-icons-wrapper > div:first-child .actions-group:before {\n    background: transparent;\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faTimes } from \"@fortawesome/free-solid-svg-icons\";\nimport { getStore, setStore } from \"../controllers/store\";\nimport produce from \"immer\";\nimport { refreshReactState } from \"../controllers/refreshReactState\";\nimport styled from \"styled-components\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const ModalEditBoard: React.FC<{}> = () => {\n  const [t] = useTranslation([\"board\", \"translation\"]);\n  const project = useSelector((state: Editor) => {\n    return state.board;\n  });\n  const [name, setName] = React.useState(project?.name ?? \"\");\n  if (!project) {\n    return <React.Fragment />;\n  }\n  if (project.editModalVisible === false) {\n    return <React.Fragment />;\n  }\n  const onClickCancel = () => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.editModalVisible = false;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const setNewProjectName = (newName: string) => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.name = newName;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n\n\n  return (\n    <ModalEditProjectStyles>\n      <div className={\"edit-modal-popup\"}>\n        <div className={\"edit-modal-popup-overlay\"} onClick={onClickCancel}>\n          &nbsp;\n        </div>\n        <div className={\"edit-modal-popup-content-wrapper\"}>\n          <div className={\"edit-modal-popup-content\"}>\n            <div className={\"btn-cancel\"} onClick={onClickCancel}>\n              <FontAwesomeIcon icon={faTimes} color={\"#000\"} />\n            </div>\n\n            <h2>{t(\"board:modal_edit_board.title\")}</h2>\n            <div>\n              <input\n                name={\"name\"}\n                className={\"input\"}\n                placeholder={t(\n                  \"board:modal_edit_board.name_input_placeholder\"\n                )}\n                value={name}\n                onChange={(event) => {\n                  setName(event.target.value);\n                }}\n                onBlur={(event) => {\n                  const newName = event.target.value;\n                  if (newName.length > 0) {\n                    setNewProjectName(newName);\n                  }\n                }}\n              />\n            </div>\n\n            <div className={\"actions\"}></div>\n          </div>\n        </div>\n      </div>\n    </ModalEditProjectStyles>\n  );\n};\n\nexport const ModalEditProjectStyles = styled.div`\n  .edit-modal-popup {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 100;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    overflow-x: hidden;\n    overflow-y: auto;\n  }\n  .edit-modal-popup-overlay {\n    background: rgba(0, 0, 0, 0.4);\n    transition: all 0.4s ease-in-out;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n  .edit-modal-popup-content-wrapper {\n    position: absolute;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100%;\n  }\n  .edit-modal-popup-content {\n    background: #fff;\n    padding: 32px;\n    width: 520px;\n    box-sizing: border-box;\n    transition: all 0.25s ease-out;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    transition: all 0.4s ease-in-out;\n    z-index: 2;\n    position: relative;\n  }\n  .actions {\n    display: flex;\n    justify-content: flex-end;\n  }\n  .btn-cancel {\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 5;\n    width: 45px;\n    height: 45px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    /* border: 1px solid #eee; */\n    /* color: #000; */\n    /* padding: 10px 15px; */\n    /* border-radius: 4px; */\n    /* width: 90px; */\n    cursor: pointer;\n  }\n  .input {\n    border: none;\n    border-bottom: 1px solid rgba(5, 0, 56, 0.2);\n    padding: 8px 0 4px;\n    font-size: 24px;\n    transition: all 0.4s ease-in-out;\n    border-radius: 0;\n    box-shadow: none;\n    margin-bottom: 10px;\n\n    &:hover {\n      border-bottom-color: rgba(5, 0, 56, 0.4);\n    }\n    &:focus {\n      border-bottom-color: var(--uiButtonActive);\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faReply,\n  faStar as faStarSolid,\n  faUpload,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { faStar as faStarRegular } from \"@fortawesome/free-regular-svg-icons\";\nimport { redoHistory, undoHistory } from \"../controllers/AppHistory\";\nimport { getStore, setStore } from \"../controllers/store\";\nimport produce from \"immer\";\nimport { refreshReactState } from \"../controllers/refreshReactState\";\nimport { appThree } from \"../threejs/renderThreejs\";\nimport styled from \"styled-components\";\nimport { Link } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const ProjectInfoWrapper: React.FC<{}> = (props) => {\n  const { canRedo, canUndo } = useSelector((state: Editor) => {\n    const { canRedo, canUndo } = state.history;\n    return {\n      canRedo,\n      canUndo,\n    };\n  });\n  const board = useSelector((state: Editor) => {\n    return state.board;\n  });\n  const onClickRedo = () => {\n    if (canRedo) {\n      redoHistory();\n    }\n  };\n  const onClickUndo = () => {\n    if (canUndo) {\n      undoHistory();\n    }\n  };\n  const onClickName = () => {\n    if (!board) {\n      return;\n    }\n    if (!board.canToggleToFavourite) {\n      return;\n    }\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.editModalVisible = true;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const onClickLogo = () => {\n    // window.alert(\"back to home\");\n  };\n  const onClickFavourite = () => {\n    if (!board) {\n      return;\n    }\n    if (!board.canToggleToFavourite) {\n      return;\n    }\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.isFavourite = !draft.board.isFavourite;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const onClickExportAsImage = () => {\n    try {\n      const content = appThree.renderer.domElement\n        .toDataURL(\"image/png\")\n        .replace(\"image/png\", \"image/octet-stream\");\n      const link = document.createElement(\"a\");\n      document.body.appendChild(link);\n      link.download = \"coralinio-preview.png\";\n      link.href = content;\n      link.click();\n      document.body.removeChild(link);\n    } catch (e) {\n      console.log(e);\n      return;\n    }\n  };\n  const [t] = useTranslation([\"board\"]);\n\n  return (\n    <ProjectInfoWrapperStyles>\n      <div className={\"project-info-wrapper\"}>\n        <div className={\"block-with-info\"}>\n          <div\n            className=\"coralinio-logo\"\n            onClick={onClickLogo}\n            data-tip={t(\"board:ui.back_to_home\")}\n            data-place={\"bottom\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <Link to=\"/\">coralinio</Link>\n            </div>\n          </div>\n\n          {board?.name ? (\n            <div\n              className={\"project-name\"}\n              onClick={onClickName}\n              data-tip={board?.name ?? \"\"}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <div className={\"value\"}>{board?.name ?? \"\"}</div>\n            </div>\n          ) : null}\n\n          {board?.canToggleToFavourite ? (\n            <div\n              className={\"add-to-fav\"}\n              onClick={onClickFavourite}\n              data-tip={\n                board.isFavourite === true\n                  ? t(\"board:ui.remove_from_fav\")\n                  : t(\"board:ui.add_to_fav\")\n              }\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <FontAwesomeIcon\n                icon={board.isFavourite ? faStarSolid : faStarRegular}\n              />\n            </div>\n          ) : null}\n\n          {board?.canExportAsImage ? (\n            <div\n              className={\"export-as-image\"}\n              onClick={onClickExportAsImage}\n              data-tip={t(\"board:ui.export_as_image\")}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <FontAwesomeIcon icon={faUpload} />\n            </div>\n          ) : null}\n        </div>\n\n        {canRedo || canUndo ? (\n          <div className={\"block-with-history\"}>\n            <div\n              className={`undo-button ${canUndo ? \"active\" : \"inactive\"}`}\n              onClick={onClickUndo}\n              data-tip={t(\"board:ui.undo\")}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <span className=\"icon\">\n                <FontAwesomeIcon icon={faReply} />\n              </span>\n            </div>\n\n            <div\n              className={`redo-button ${canRedo ? \"active\" : \"inactive\"} `}\n              onClick={onClickRedo}\n              data-tip={t(\"board:ui.redo\")}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <span className=\"icon\">\n                <FontAwesomeIcon\n                  icon={faReply}\n                  style={{ transform: \"scaleX(-1)\" }}\n                />\n              </span>\n            </div>\n          </div>\n        ) : null}\n      </div>\n    </ProjectInfoWrapperStyles>\n  );\n};\n\nexport const ProjectInfoWrapperStyles = styled.div`\n  .project-info-wrapper {\n    position: absolute;\n    top: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: 10;\n    display: flex;\n    column-gap: calc(var(--standardPadding) * 2);\n    transition: all 0.4s ease-in-out;\n  }\n  .block-with-info {\n    background: #fff;\n    height: 55px;\n    display: flex;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n    column-gap: calc(var(--standardPadding) * 2);\n\n    .coralinio-logo {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      .value {\n        width: 120px;\n        transition: all 0.4s ease-in-out;\n        a {\n          transition: all 0.4s ease-in-out;\n          font-size: 29px;\n          font-family: \"Fredoka One\", cursive;\n          font-weight: 400;\n          text-transform: lowercase;\n          color: var(--uiButton);\n        }\n        &:hover a {\n          color: var(--uiButtonActive);\n        }\n      }\n    }\n    .project-name {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: \"\";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      .value {\n        font-size: 20px;\n        max-width: 200px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        font-family: \"Open Sans\", sans-serif;\n        font-weight: 400;\n      }\n    }\n    .add-to-fav {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: \"\";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n    .export-as-image {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: \"\";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n  }\n\n  .block-with-history {\n    display: flex;\n    background: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 55px;\n\n    .redo-button,\n    .undo-button {\n      width: 45px;\n      height: 100%;\n      padding-left: calc(var(--standardPadding) * 2);\n      padding-right: calc(var(--standardPadding) * 2);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &.active:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n      &.inactive {\n        svg path {\n          fill: var(--uiButtonInActive);\n        }\n      }\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faMinus, faPlus } from \"@fortawesome/free-solid-svg-icons\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport {\n  AppEventType,\n  ChangeUiSettingsZoom,\n} from \"../controllers/AppEventType\";\nimport styled from \"styled-components\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const MinimapWrapper: React.FC<{}> = (props) => {\n  const { zoomScale } = useSelector((state: Editor) => {\n    const { zoomScale } = state.ui;\n    return {\n      zoomScale,\n    };\n  });\n  const onClickPlus = () => {\n    const updateUiEvent: ChangeUiSettingsZoom = {\n      name: AppEventType.ChangeUiSettingsZoom,\n      payload: {\n        zoomType: \"zoomInScreenCenter\",\n        useAnimation: true,\n      },\n    };\n    sendEvent(updateUiEvent);\n  };\n  const onClickMinus = () => {\n    const updateUiEvent: ChangeUiSettingsZoom = {\n      name: AppEventType.ChangeUiSettingsZoom,\n      payload: {\n        zoomType: \"zoomOutScreenCenter\",\n        useAnimation: true,\n      },\n    };\n    sendEvent(updateUiEvent);\n  };\n  const [t] = useTranslation([\"board\", \"translation\"]);\n  return (\n    <MinimapWrapperStyles>\n      <div className={\"minimap-wrapper\"}>\n        <div className={\"minimap-wrapper-content\"}>\n          <div\n            className={\"item\"}\n            onClick={onClickMinus}\n            data-tip={t(\"board:ui.zoom_out\")}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon icon={faMinus} />\n            </div>\n          </div>\n          <div\n            className={\"item\"}\n            onClick={onClickPlus}\n            data-tip={t(\"board:ui.zoom_in\")}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon icon={faPlus} />\n            </div>\n          </div>\n          <div\n            className={\"item-text\"}\n            data-tip={t(\"board:ui.zoom_percentage\")}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>{Math.round((1 / zoomScale) * 100)}%</div>\n          </div>\n        </div>\n      </div>\n    </MinimapWrapperStyles>\n  );\n};\n\nexport const MinimapWrapperStyles = styled.div`\n  .minimap-wrapper {\n    position: absolute;\n    z-index: var(--zIndexMinimap);\n    bottom: var(--standardPadding);\n    right: var(--standardPadding);\n    transition: all 0.4s ease-in-out;\n    width: var(--minimapWidth);\n  }\n  .minimap-wrapper-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding) / 2;\n  }\n  .item {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 45px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    cursor: pointer;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .item-text {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 70px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    font-size: 18px;\n    font-weight: 600;\n  }\n`;\n","import React from \"react\";\nimport { Bead, Editor, ObjectTypes } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { thumbnailsGenerator } from \"../threejs/thumbnailsGenerator\";\nimport { cloneDeep } from \"lodash\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const BeadsSummary: React.FC<{}> = () => {\n  const [t] = useTranslation([\"board\"]);\n  const { groupedCount } = useSelector((state: Editor) => {\n    const groups: {\n      [key: string]: {\n        count: number;\n        example: Bead;\n        textName: string;\n        textTooltip: string;\n      };\n    } = {};\n    Object.keys(state.objects).forEach((id) => {\n      if (state.objects[id].objectType === ObjectTypes.Bead) {\n        const bead = state.objects[id] as Bead;\n        const groupData: any = {\n          width: bead.width,\n          height: bead.height,\n          depth: bead.depth,\n          // rotateX: bead.rotateX,\n          // rotateY: bead.rotateY,\n          // rotateZ: bead.rotateZ,\n          type: bead.type,\n          color: bead.color,\n        };\n        const groupId = JSON.stringify(groupData);\n\n        if (groups[groupId] === undefined) {\n          const item = cloneDeep(bead) as Bead;\n          groups[groupId] = {\n            count: 1,\n            example: item,\n            textName: `${item.color}`,\n            textTooltip: t(`board:bead.summary_colors_with_count`, {\n              color: item.color,\n              count: 1,\n            }),\n          };\n          // `${item.color} - 1x`\n        } else {\n          const newCount = groups[groupId].count + 1;\n          groups[groupId].count = newCount;\n          groups[groupId].textTooltip = t(\n            `board:bead.summary_colors_with_count`,\n            {\n              color: bead.color,\n              count: newCount,\n            }\n          );\n          // `${bead.color} - ${newCount}x`\n          // {{color}}-{{count}}\n        }\n      }\n    });\n    const groupedCount: {\n      count: number;\n      example: Bead;\n      textName: string;\n      textTooltip: string;\n      textCount: string;\n    }[] = [];\n    const maxGroups = 10;\n    Object.keys(groups).forEach((id, index) => {\n      if (index > maxGroups) {\n        return;\n      }\n      const group = groups[id];\n      const textCount = `${group.count}x`;\n      groupedCount.push({\n        count: group.count,\n        example: group.example,\n        textName: group.textName,\n        textTooltip: group.textName,\n        textCount,\n      });\n    });\n    return {\n      groupedCount,\n    };\n  });\n  const onClickOpenObjectsPanel = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        panel: \"objects\",\n        open: true,\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <BeadsSummaryStyles>\n      <div className={\"beads-summary\"}>\n        <div\n          className={\"beads-summary-content\"}\n          onClick={onClickOpenObjectsPanel}\n        >\n          {groupedCount.map((group, index) => {\n            if (!group) {\n              return null;\n            }\n            if (!group.example) {\n              return null;\n            }\n            if (!thumbnailsGenerator) {\n              return null;\n            }\n            const imgSrc = thumbnailsGenerator.getObjectThumbnail(\n              group.example,\n              30,\n              30\n            );\n            return (\n              <div\n                className={\"bead-count\"}\n                key={index}\n                data-tip={group.textTooltip}\n                data-place={\"top\"}\n                data-type={\"dark\"}\n                data-effect={\"solid\"}\n              >\n                <span className={\"preview\"}>\n                  <img src={imgSrc} alt={\"\"} />\n                </span>\n                <span className={\"value\"}>{group.textCount}</span>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </BeadsSummaryStyles>\n  );\n};\n\nexport const BeadsSummaryStyles = styled.div`\n  .beads-summary {\n    position: absolute;\n    bottom: var(--standardPadding);\n    right: calc(var(--standardPadding) + 170px + var(--standardPadding));\n    z-index: var(--zIndexBeadsSummary);\n    transition: all 0.4s ease-in-out;\n  }\n  .beads-summary-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding);\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n  }\n  .bead-count {\n    display: flex;\n    flex-direction: column;\n    cursor: pointer;\n\n    .value {\n      font-size: 15px;\n      font-weight: 600;\n    }\n\n    .preview {\n      width: 30px;\n      height: 30px;\n      /* border: 1px solid #eee; */\n      /* border-radius: 30px; */\n      /* font-size: 8px; */\n      /* line-height: 27px; */\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      white-space: nowrap;\n      overflow: hidden;\n    }\n  }\n`;\n","import React from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faPaintBrush,\n  faTh,\n  faTrashAlt,\n  faTable,\n  faMousePointer,\n  faCircle,\n  faExpand,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { EditorMode } from \"../../editorObjects/Editor\";\n// import { useDispatch } from \"react-redux\";\nimport { times } from \"lodash\";\nimport styled from \"styled-components\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport {\n  AddMultipleBeads,\n  AppEventType,\n  ChangeUiSettings,\n} from \"../../controllers/AppEventType\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const EditorModes = ({ editorMode }) => {\n  const onChangeEditorMode = (newEditorMode: EditorMode) => {\n    const action: ChangeUiSettings = {\n      name: AppEventType.ChangeUiSettings,\n      payload: {\n        uiSettings: {\n          mode: newEditorMode,\n        },\n      },\n    };\n    sendEvent(action);\n  };\n\n  const [t] = useTranslation([\"board\"]);\n  \n  return (\n    <div>\n      {/* <StateButton\n        label={\"Przegldanie\"}\n        icon={<FontAwesomeIcon icon={faMousePointer} />}\n        onClick={() => onChangeEditorMode(EditorMode.Idle)}\n        isSelected={editorMode === EditorMode.Idle}\n      /> */}\n      <StateButton\n        label={t(\"board:mode.select_or_move\")}\n        icon={<FontAwesomeIcon icon={faMousePointer} />}\n        onClick={() => onChangeEditorMode(EditorMode.SelectOrMove)}\n        isSelected={editorMode === EditorMode.SelectOrMove}\n      />\n      <StateButton\n        label={t(\"board:mode.select_multiple_beads\")}\n        icon={<FontAwesomeIcon icon={faExpand} />}\n        onClick={() => onChangeEditorMode(EditorMode.SelectMultiple)}\n        isSelected={editorMode === EditorMode.SelectMultiple}\n      />\n      {/* <StateButton\n        label={\"Edit Lines\"}\n        icon={<FontAwesomeIcon icon={faEdit} />}\n        onClick={() => onChangeEditorMode(EditorMode.EditLines)}\n        isSelected={editorMode === EditorMode.EditLines}\n      /> */}\n      {/* <StateButton\n        label={\"AddLine\"}\n        icon={<FontAwesomeIcon icon={faPlus} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddLine)}\n        isSelected={editorMode === EditorMode.AddLine}\n      /> */}\n      <StateButton\n        label={t(\"board:mode.add_beads\")}\n        icon={<FontAwesomeIcon icon={faCircle} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddBeads)}\n        isSelected={editorMode === EditorMode.AddBeads}\n      />\n      <StateButton\n        label={t(\"board:mode.paint_beads\")}\n        icon={<FontAwesomeIcon icon={faPaintBrush} />}\n        onClick={() => onChangeEditorMode(EditorMode.PaintBeads)}\n        isSelected={editorMode === EditorMode.PaintBeads}\n      />\n      <StateButton\n        label={t(\"board:mode.delete_beads\")}\n        icon={<FontAwesomeIcon icon={faTrashAlt} />}\n        onClick={() => onChangeEditorMode(EditorMode.DeleteBeads)}\n        isSelected={editorMode === EditorMode.DeleteBeads}\n      />\n      <StateButton\n        label={t(\"board:mode.add_region\")}\n        testId={\"btnAddRegion\"}\n        icon={<FontAwesomeIcon icon={faTable} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddRegion)}\n        isSelected={editorMode === EditorMode.AddRegion}\n      />\n      <FastAddBeadsButton\n        label={t(\"board:mode.fast_add_multiple_beads\")}\n        icon={<FontAwesomeIcon icon={faTh} />}\n      />\n    </div>\n  );\n};\n\nconst StateButton: React.FC<{\n  label: string;\n  isSelected: boolean;\n  onClick: any;\n  icon: React.ReactChild;\n  testId?: string;\n}> = (props) => {\n  return (\n    <ButtonStyles>\n      <div\n        className={`action-button ${props.isSelected ? \"is-active\" : \"\"}`}\n        onClick={props.onClick}\n        data-tip={props.label}\n        data-place={\"right\"}\n        data-type={\"dark\"}\n        data-effect={\"solid\"}\n        data-test={props.testId}\n      >\n        <span className=\"icon\">{props.icon}</span>\n      </div>\n    </ButtonStyles>\n  );\n};\n\nconst ButtonStyles = styled.div`\n  .action-button {\n    border: none;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: var(--uiButton);\n    animation: all 0.5s ease-in-out;\n    min-height: 40px;\n    .icon svg,\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      animation: all 0.5s ease-in-out;\n    }\n  }\n  .action-button:hover,\n  .action-button.is-active {\n    color: var(--uiButtonActive);\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      fill: var(--uiButtonActive);\n    }\n  }\n`;\n\nconst FastAddBeadsButton: React.FC<{ label: string; icon: any }> = (props) => {\n  const defaultDimesions = [20, 20];\n  const defaultSelected = [1, 1];\n  const [dimensions, setDimensions] = React.useState<number[]>(\n    defaultDimesions\n  );\n  const [selected, setSelected] = React.useState<number[]>(defaultSelected);\n  const [selectionVisible, setVisible] = React.useState<boolean>(false);\n\n  const toggleSelection = () => {\n    setVisible(!selectionVisible);\n  };\n  const onSelect = (rowIndex: number, colIndex: number) => {\n    const action: AddMultipleBeads = {\n      name: AppEventType.AddMultipleBeads,\n      payload: {\n        rows: rowIndex,\n        columns: colIndex,\n        figure: \"rectangle\",\n      },\n    };\n    sendEvent(action);\n\n    toggleSelection();\n    setDimensions(defaultDimesions);\n    setSelected(defaultSelected);\n  };\n  const onCancel = () => {\n    setDimensions(defaultDimesions);\n    setVisible(false);\n  };\n  return (\n    <div style={{ position: \"relative\" }}>\n      <ButtonStyles>\n        <div\n          className={`action-button ${selectionVisible ? \"is-active\" : \"\"}`}\n          onClick={toggleSelection}\n          data-tip={selectionVisible === true ? undefined : props.label}\n          data-place={\"right\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n          data-tip-disable={selectionVisible === true}\n        >\n          <span className={`icon`}>{props.icon}</span>\n        </div>\n      </ButtonStyles>\n\n      {selectionVisible === true ? (\n        <SelectionStyles>\n          <SelectionFrame\n            selected={selected}\n            dimensions={dimensions}\n            setSelected={setSelected}\n            setDimensions={setDimensions}\n            onSelect={onSelect}\n            onCancel={onCancel}\n          />\n        </SelectionStyles>\n      ) : null}\n    </div>\n  );\n};\n\nconst SelectionFrame: React.FC<{\n  selected: number[];\n  dimensions: number[];\n  setSelected: any;\n  setDimensions: any;\n  onSelect: (a: number, b: number) => void;\n  onCancel: any;\n}> = (props) => {\n  const divRef = React.useRef<any | null>(null);\n  useOutsideClick(divRef, () => {\n    props.onCancel();\n  });\n  return (\n    <div className=\"selection\">\n      <div\n        className={\"rect-wrapper\"}\n        style={{ width: props.dimensions[0] * 15 }}\n        ref={(e) => {\n          divRef.current = e;\n        }}\n      >\n        {times(props.dimensions[0]).map((rowIndex) => (\n          <div className={\"row-wrapper\"} key={rowIndex}>\n            {times(props.dimensions[1]).map((colIndex) => {\n              const onMouseEnter = () => {\n                props.setSelected([rowIndex + 1, colIndex + 1]);\n\n                // @TODO:\n                // const max = 20;\n                // const min = 5;\n\n                // // const isLastCol = dimensions[1] - 1 === colIndex;\n                // // const isLastRow = dimensions[0] - 1 === rowIndex;\n                // // if (isLastCol || isLastRow) {\n                //   let nextRow = rowIndex;\n                //   if (rowIndex < min - 1) {\n                //     nextRow = min;\n                //   } else if (rowIndex > max) {\n                //     nextRow = max;\n                //   } else {\n                //     const isLast = dimensions[0] - 1 === rowIndex;\n                //     if (isLast) {\n                //       nextRow = Math.min(max, dimensions[0] + 1);\n                //     } else {\n                //       nextRow = rowIndex;\n                //     }\n                //   }\n                //   const nextCol = 5;\n                //   // let nextCol = colIndex;\n                //   // if (colIndex < min - 1) {\n                //   //   nextCol = min;\n                //   // } else if (colIndex > max) {\n                //   //   nextCol = max;\n                //   // } else {\n                //   //   const isLast = dimensions[1] - 1 === colIndex;\n                //   //   if (isLast) {\n                //   //     nextCol = Math.min(max, dimensions[1] + 1);\n                //   //   } else {\n                //   //     nextCol = colIndex;\n                //   //   }\n                //   // }\n\n                //   console.log(\"zmianiam wielkosc:\", nextRow, nextCol);\n                //   props.setDimensions([nextRow, nextCol]);\n                // }\n              };\n              const onClick = () => {\n                props.onSelect(rowIndex + 1, colIndex + 1);\n              };\n              return (\n                <div\n                  key={colIndex}\n                  className={`rect ${\n                    colIndex < props.selected[1] && rowIndex < props.selected[0]\n                      ? \"selected\"\n                      : \"\"\n                  }`}\n                  onMouseEnter={onMouseEnter}\n                  onClick={onClick}\n                >\n                  &nbsp;\n                </div>\n              );\n            })}\n          </div>\n        ))}\n      </div>\n      <div className={\"label-wrapper\"}>\n        {props.selected[0]}x{props.selected[1]}\n      </div>\n    </div>\n  );\n};\n\nconst useOutsideClick = (ref, callback) => {\n  const handleClick = (e) => {\n    if (ref.current && !ref.current.contains(e.target)) {\n      callback();\n    }\n  };\n\n  React.useEffect(() => {\n    document.addEventListener(\"click\", handleClick);\n\n    return () => {\n      document.removeEventListener(\"click\", handleClick);\n    };\n  });\n};\n\nconst SelectionStyles = styled.div`\n  .selection {\n    position: absolute;\n    top: 0px;\n    left: 65px;\n    min-width: calc(5 * 10px + 20px);\n    min-height: 100px;\n    background: #fff;\n    z-index: 10;\n    border: 1px solid #dbdbdb;\n    padding: 10px 10px 0px 10px;\n    box-sizing: border-box;\n  }\n  .selection .rect-wrapper {\n    display: flex;\n  }\n  .selection .label-wrapper {\n    font-size: 12px;\n    color: #000;\n    text-align: center;\n    width: 100%;\n  }\n  .selection .rect {\n    width: 15px;\n    height: 15px;\n    border: 1px solid #fff;\n    background: transparent;\n    padding: 1px;\n    box-shadow: inset 0px 0px 0px 1px #e3e1e1;\n  }\n  .selection .rect.selected {\n    background: var(--btns_bg);\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { EditorModes } from \"./Toolbar/EditorModes\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\n\nexport const ActionsWrapper: React.FC<{}> = () => {\n  const editorMode = useSelector((state: Editor) => {\n    return state.ui.mode;\n  });\n\n  return (\n    <ActionsWrapperStyles>\n      <div className=\"actions-wrapper\">\n        <div className={\"actions-content\"}>\n          <EditorModes editorMode={editorMode} />\n        </div>\n      </div>\n    </ActionsWrapperStyles>\n  );\n};\n\nexport const ActionsWrapperStyles = styled.div`\n  .actions-wrapper {\n    position: absolute;\n    z-index: var(--zIndexActions);\n    left: var(--standardPadding);\n    top: 50%;\n    transform: translate(0, -50%);\n    width: 56px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 0;\n    transition: all 0.4s ease-in-out;\n  }\n  .actions-content {\n    padding: 0;\n    background-color: rgba(255, 255, 255, 1);\n    padding: 12px 0;\n    transition: height 0.2s linear, top 0.2s linear;\n    border-radius: 4px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    width: 100%;\n  }\n`;\n","import { faTimes } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React from \"react\";\nimport styled from \"styled-components\";\n\nexport const PanelContentStyles = styled.div`\n  .content-wrapper {\n    padding: calc(var(--standardPadding) * 2);\n    position: relative;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: flex-start;\n    flex-direction: column;\n    overflow: auto;\n    max-height: 100%;\n  }\n  .close-wrapper {\n    position: absolute;\n    top: calc(var(--standardPadding) * 1);\n    right: calc(var(--standardPadding) * 1);\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n  }\n  .title {\n    font-size: 30px;\n    font-weight: 600;\n    margin-bottom: var(--standardPadding);\n  }\n`;\n\nexport const CloseButton: React.FC<{ onClick: any }> = (props) => {\n  return (\n    <div className={\"close-wrapper\"} onClick={props.onClick}>\n      <FontAwesomeIcon icon={faTimes} color={\"#000\"} size={\"2x\"} />\n    </div>\n  );\n};\n","import React from \"react\";\nimport { AppObject, Editor, ObjectTypes } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport styled from \"styled-components\";\nimport { CloseButton, PanelContentStyles } from \"./PanelContentStyles\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faHistory } from \"@fortawesome/free-solid-svg-icons\";\nimport { jumpToIndexHistory } from \"../controllers/AppHistory\";\nimport { thumbnailsGenerator } from \"../threejs/thumbnailsGenerator\";\nimport { useTranslation } from \"react-i18next\";\nimport { toDate } from \"date-fns\";\n\nexport const RightSidebar: React.FC<{}> = () => {\n  const rightSidebar = useSelector((state: Editor) => {\n    return state.ui.rightSidebar;\n  });\n\n  return (\n    <RightSidebarStyles>\n      <div className={\"right-sidebar-wrapper\"}>\n        {rightSidebar.isOpen === true ? (\n          <>\n            {rightSidebar.panel === \"history\" ? <HistoryPanel /> : null}\n\n            {rightSidebar.panel === \"objects\" ? <ObjectsPanel /> : null}\n          </>\n        ) : null}\n      </div>\n    </RightSidebarStyles>\n  );\n};\n\nexport const RightSidebarStyles = styled.div`\n  .right-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    right: calc(var(--leftSidebarWidth) * -1);\n    width: var(--leftSidebarWidth);\n    z-index: var(--zIndexRightSidebar);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n`;\n\nconst HistoryPanel: React.FC<{}> = () => {\n  const [t] = useTranslation([\"board\"]);\n  const onClickCloseHistory = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: false,\n        panel: \"history\",\n      },\n    };\n    sendEvent(event);\n  };\n  const events = useSelector((state: Editor) => {\n    return state.history.events;\n  });\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const texts = [\n    t(\"board:history_events.AddObjects\"),\n    t(\"board:history_events.DuplicateObjects\"),\n    t(\"board:history_events.RemoveObjects\"),\n    t(\"board:history_events.ChangeSelectObjects\"),\n    t(\"board:history_events.ChangeObjectsProperty\"),\n    t(\"board:history_events.ChangeObjectsAlignment\"),\n    t(\"board:history_events.ClipboardCut\"),\n    t(\"board:history_events.ClipboardCopy\"),\n    t(\"board:history_events.ClipboardPaste\"),\n    t(\"board:history_events.AddMultipleBeads\"),\n    t(\"board:history_events.ChangeUiSettings\"),\n    t(\"board:history_events.ChangeUiSettingsZoom\"),\n    t(\"board:history_events.ChangeUiSettingsSidebar\"),\n    t(\"board:history_events.GroupObjects\"),\n    t(\"board:history_events.UngroupObjects\"),\n  ];\n  return (\n    <PanelContentStyles>\n      <div className={\"content-wrapper\"}>\n        <div className={\"title\"}>{t(\"board:tab.history_events_title\")}</div>\n        <CloseButton onClick={onClickCloseHistory} />\n        <HistoryPanelStyles>\n          <div className={\"events\"}>\n            {events.map((_, i, events) => {\n              const index = events.length - 1 - i;\n              const event = events[index];\n              if (!event) {\n                return <React.Fragment />;\n              }\n              const onClickHistoryItem = () => {\n                jumpToIndexHistory(index);\n              };\n              \n              return (\n                <div\n                  key={i}\n                  className={`event ${event.isActive ? \"active\" : \"inactive\"}`}\n                  onClick={onClickHistoryItem}\n                >\n                  <div className={\"icon\"}>\n                    <FontAwesomeIcon icon={faHistory} />\n                  </div>\n                  <div className={\"name\"}>\n                    {t(`board:history_events.${event.name}`)}\n                  </div>\n                  <div\n                    className={\"time\"}\n                    data-tip={`${t(\n                      \"board:tab.history_events_event_created_at\"\n                    )} ${t(\"dates:long\", {\n                      date: toDate(Date.parse(event.createdAt)),\n                    })}`}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    {t(\"dates:hh_mm_ss\", {\n                      date: toDate(Date.parse(event.createdAt)),\n                    })}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </HistoryPanelStyles>\n      </div>\n    </PanelContentStyles>\n  );\n};\n\nconst HistoryPanelStyles = styled.div`\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .events {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow: scroll;\n  }\n  .event {\n    display: grid;\n    grid-template-columns: 45px 1fr 100px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    cursor: pointer;\n    &.active {\n      background: #fff;\n      .icon {\n        svg path {\n          fill: #000;\n        }\n      }\n      .name {\n        color: #000;\n      }\n    }\n    &.inactive {\n      .icon {\n        svg path {\n          fill: #e9e9e9;\n        }\n      }\n      .name {\n        color: #e9e9e9;\n      }\n    }\n    &:hover {\n      background: #ccc;\n    }\n\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .time {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      white-space: nowrap;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      color: #c9c9c9;\n    }\n  }\n`;\n\nconst ObjectsPanel: React.FC<{}> = () => {\n  const [t] = useTranslation([\"board\", \"dates\"]);\n  const onClickCloseObjects = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: false,\n        panel: \"objects\",\n      },\n    };\n    sendEvent(event);\n  };\n\n  const objects = useSelector((state: Editor) => {\n    return state.objects;\n  });\n  type Filters = \"all\" | \"beads\" | \"groups\" | \"other\";\n  const [filterSelected, setFilterSelected] = React.useState<Filters>(\"all\");\n  const [selectedObjects, setSelectedObjects] = React.useState<AppObject[]>([]);\n  const onClickFilter = (filter: Filters) => {\n    setFilterSelected(filter);\n    if (filter === \"all\") {\n      setSelectedObjects(\n        Object.keys(objects).map((id) => {\n          return objects[id];\n        })\n      );\n    } else if (filter === \"beads\") {\n      setSelectedObjects(\n        Object.keys(objects)\n          .map((id) => {\n            return objects[id];\n          })\n          .filter((e) => e.objectType === ObjectTypes.Bead)\n      );\n    } else if (filter === \"groups\") {\n      setSelectedObjects(\n        Object.keys(objects)\n          .map((id) => {\n            return objects[id];\n          })\n          .filter((e) => e.objectType === ObjectTypes.Group)\n      );\n    } else if (filter === \"other\") {\n      setSelectedObjects(\n        Object.keys(objects)\n          .map((id) => {\n            return objects[id];\n          })\n          .filter(\n            (e) =>\n              !(\n                e.objectType === ObjectTypes.Bead ||\n                e.objectType === ObjectTypes.Group\n              )\n          )\n      );\n    }\n  };\n  const onClickFilterAll = () => {\n    onClickFilter(\"all\");\n  };\n  const onClickFilterBeads = () => {\n    onClickFilter(\"beads\");\n  };\n  const onClickFilterGroups = () => {\n    onClickFilter(\"groups\");\n  };\n  const onClickFilterOther = () => {\n    onClickFilter(\"other\");\n  };\n\n  React.useEffect(() => {\n    onClickFilter(filterSelected);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [objects]);\n  return (\n    <PanelContentStyles>\n      <div className={\"content-wrapper\"}>\n        <div className={\"title\"}>{t(\"board:tab.objects_title\")}</div>\n        <CloseButton onClick={onClickCloseObjects} />\n        <ObjectsPanelStyles>\n          <div className={\"filters\"}>\n            <div\n              className={`filter ${filterSelected === \"all\" ? \"active\" : \"\"}`}\n              onClick={onClickFilterAll}\n            >\n              {t(\"board:tab.objects_filter_all\")}\n            </div>\n            <div\n              className={`filter ${filterSelected === \"beads\" ? \"active\" : \"\"}`}\n              onClick={onClickFilterBeads}\n            >\n              {t(\"board:tab.objects_filter_only_beads\")}\n            </div>\n            <div\n              className={`filter ${\n                filterSelected === \"groups\" ? \"active\" : \"\"\n              }`}\n              onClick={onClickFilterGroups}\n            >\n              {t(\"board:tab.objects_filter_only_groups\")}\n            </div>\n            <div\n              className={`filter ${filterSelected === \"other\" ? \"active\" : \"\"}`}\n              onClick={onClickFilterOther}\n            >\n              {t(\"board:tab.objects_filter_only_others\")}\n            </div>\n          </div>\n          <div className={\"objects\"}>\n            {selectedObjects.map((object, index) => {\n              if (!object) {\n                return <React.Fragment />;\n              }\n\n              const isBead = object.objectType === ObjectTypes.Bead;\n              const onClickObject = () => {\n                if (isBead) {\n                  thumbnailsGenerator.getObjectThumbnail(object, 500, 500);\n                }\n              };\n              return (\n                <div key={index} className={\"object\"} onClick={onClickObject}>\n                  <div className={\"icon\"}>\n                    {isBead ? (\n                      <img\n                        src={thumbnailsGenerator.getObjectThumbnail(\n                          object,\n                          30,\n                          30\n                        )}\n                        alt={\"\"}\n                      />\n                    ) : (\n                      <FontAwesomeIcon icon={faHistory} />\n                    )}\n                  </div>\n                  <div className={\"name\"}>{object.objectType}</div>\n                  <div className={\"id\"}>ID:{object.id}</div>\n                </div>\n              );\n            })}\n          </div>\n        </ObjectsPanelStyles>\n      </div>\n    </PanelContentStyles>\n  );\n};\n\nconst ObjectsPanelStyles = styled.div`\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .filters {\n    background: #ebebef;\n    border-radius: 4px;\n    padding: 2px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    .filter {\n      border-radius: 4px;\n      padding: 10px 15px;\n    }\n    .filter.active {\n      background: #fff;\n    }\n  }\n\n  .objects {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n  }\n  .object {\n    display: grid;\n    grid-template-columns: 45px 1fr 200px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    width: 100%;\n    &:hover {\n      background: #e9e9e9;\n    }\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .id {\n      font-size: 10px;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      width: 100%;\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { CloseButton, PanelContentStyles } from \"./PanelContentStyles\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const LeftSidebar: React.FC<{}> = () => {\n  const leftSidebar = useSelector((state: Editor) => {\n    return state.ui.leftSidebar;\n  });\n  return (\n    <LeftSidebarStyles>\n      <div className={\"left-sidebar-wrapper\"}>\n        {leftSidebar.isOpen === true ? (\n          <>{leftSidebar.panel === \"comments\" ? <CommentsPanel /> : null}</>\n        ) : null}\n      </div>\n    </LeftSidebarStyles>\n  );\n};\n\nexport const LeftSidebarStyles = styled.div`\n  .left-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    left: calc(var(--leftSidebarWidth) * -1);\n    z-index: var(--zIndexLeftSidebar);\n    width: var(--leftSidebarWidth);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n`;\n\nconst CommentsPanel: React.FC<{}> = () => {\n  const onClickCloseComments = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: false,\n        panel: \"comments\",\n      },\n    };\n    sendEvent(event);\n  };\n  const [t] = useTranslation([\"board\", \"translation\"]);\n  return (\n    <PanelContentStyles>\n      <div className={\"content-wrapper\"}>\n        <div className={\"title\"}>{t(\"board:tab.comments_title\")}</div>\n        <div>{t(\"translation:list_is_empty\")}</div>\n        <CloseButton onClick={onClickCloseComments} />\n      </div>\n    </PanelContentStyles>\n  );\n};\n","import React from \"react\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faAngleDoubleLeft,\n  faAngleDoubleRight,\n  faComment,\n  faHistory,\n  faListAlt,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport styled from \"styled-components\";\nimport { useSelector } from \"react-redux\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const BottomBar: React.FC<{}> = (props) => {\n  const [isOpen, setIsOpen] = React.useState(true);\n  const leftSidebar = useSelector((state: Editor) => {\n    return state.ui.leftSidebar;\n  });\n  const rightSidebar = useSelector((state: Editor) => {\n    return state.ui.rightSidebar;\n  });\n  const toggleBar = () => {\n    setIsOpen(!isOpen);\n  };\n  const onClickOpenComments = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: true,\n        panel: \"comments\",\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickOpenHistory = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: true,\n        panel: \"history\",\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickOpenObjects = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: true,\n        panel: \"objects\",\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  const [t] = useTranslation([\"board\"]);\n  return (\n    <BottomBarStyles>\n      <div className={`bottom-bar-wrapper ${isOpen ? \"open\" : \"closed\"}`}>\n        <div className={\"buttons\"}>\n          <div\n            className={`item ${\n              leftSidebar.panel === \"comments\" ? \"active\" : \"inactive\"\n            }`}\n            onClick={onClickOpenComments}\n            data-tip={t(\"board:tab.comments\")}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon icon={faComment} />\n            </div>\n          </div>\n          <div\n            className={`item ${\n              rightSidebar.panel === \"history\" ? \"active\" : \"inactive\"\n            }`}\n            onClick={onClickOpenHistory}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon\n                icon={faHistory}\n                data-tip={t(\"board:tab.history_events\")}\n                data-place={\"top\"}\n                data-type={\"dark\"}\n                data-effect={\"solid\"}\n              />\n            </div>\n          </div>\n          <div\n            className={`item ${\n              rightSidebar.panel === \"objects\" ? \"active\" : \"inactive\"\n            }`}\n            onClick={onClickOpenObjects}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon\n                icon={faListAlt}\n                data-tip={t(\"board:tab.objects\")}\n                data-place={\"top\"}\n                data-type={\"dark\"}\n                data-effect={\"solid\"}\n              />\n            </div>\n          </div>\n        </div>\n        <div className={\"toggle-item\"} onClick={toggleBar}>\n          <div className={\"value\"}>\n            <FontAwesomeIcon\n              icon={isOpen ? faAngleDoubleLeft : faAngleDoubleRight}\n            />\n          </div>\n        </div>\n      </div>\n    </BottomBarStyles>\n  );\n};\n\nexport const BottomBarStyles = styled.div`\n  .bottom-bar-wrapper {\n    position: absolute;\n    bottom: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: var(--zIndexBottomBar);\n    width: auto;\n    display: flex;\n    /* transition: all 0.4s ease-in-out; */\n    background: #fff;\n    height: 55px;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1),\n      left 0.4s ease-in-out;\n    &.open {\n    }\n    &.closed {\n      .buttons {\n        width: 0;\n      }\n    }\n  }\n  .buttons {\n    overflow: hidden;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1);\n    width: 100%;\n    white-space: nowrap;\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &.active,\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .toggle-item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      fill: #e9e9e9;\n    }\n  }\n`;\n","import React from \"react\";\nimport { Bead, Editor, ObjectTypes } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faChevronDown,\n  faChevronUp,\n  faSearch,\n  faTimes,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { getStore, setStore, StoreUiSettings } from \"../controllers/store\";\nimport produce from \"immer\";\nimport { refreshReactState } from \"../controllers/refreshReactState\";\nimport styled from \"styled-components\";\nimport { BeadResponse, fetchBeadProducts } from \"../ApiService\";\nimport { thumbnailsGenerator } from \"../threejs/thumbnailsGenerator\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { AppEventType } from \"../controllers/AppEventType\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const ModalSearchProducts: React.FC<{}> = () => {\n  const modalSearchProducts = useSelector((state: Editor) => {\n    return state.ui.modalSearchProducts;\n  });\n\n  if (!modalSearchProducts) {\n    return <React.Fragment />;\n  }\n  if (modalSearchProducts.isOpen === false) {\n    return <React.Fragment />;\n  }\n  return <Content modalSearchProducts={modalSearchProducts} />;\n};\n\nconst Content: React.FC<{\n  modalSearchProducts: StoreUiSettings[\"modalSearchProducts\"];\n}> = (props) => {\n  const productsRef = React.useRef<null | HTMLDivElement>(null);\n  const [q, setQ] = React.useState(props.modalSearchProducts?.q ?? \"\");\n  const [producer, setProducer] = React.useState(\n    props.modalSearchProducts?.producer ?? \"\"\n  );\n  const [color, setColor] = React.useState(\n    props.modalSearchProducts?.color ?? \"\"\n  );\n\n  type DataType = { bead: Bead; item: BeadResponse };\n  const [advBlockVisible, setAdvBlockVisible] = React.useState<boolean>(\n    props.modalSearchProducts?.advBlockVisible ?? false\n  );\n  const [loading, setLoading] = React.useState<undefined | boolean>(undefined);\n  const [error, setError] = React.useState<undefined | string>(undefined);\n  const [data, setData] = React.useState<undefined | DataType[]>(\n    props.modalSearchProducts.cachedResponse ?? []\n  );\n\n  const onClickCancel = () => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.ui.modalSearchProducts) {\n        draft.ui.modalSearchProducts.isOpen = false;\n        draft.ui.modalSearchProducts.q = q;\n        draft.ui.modalSearchProducts.producer = producer;\n        draft.ui.modalSearchProducts.color = color;\n        draft.ui.modalSearchProducts.advBlockVisible = advBlockVisible;\n      }\n      if (productsRef && productsRef.current) {\n        draft.ui.modalSearchProducts.scrollPosition =\n          productsRef.current.scrollTop;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const onStartSearch = (_q?: string, _producer?: string, _color?: string) => {\n    if (loading === true) {\n      return;\n    }\n    setLoading(true);\n    fetchBeadProducts(_q ?? q, _producer ?? producer, _color ?? color)\n      .then(({ response }) => {\n        setData(response);\n        setLoading(undefined);\n        setError(undefined);\n      })\n      .catch((err) => {\n        setLoading(undefined);\n        setError(err);\n      });\n  };\n  const toggleAdvBlock = () => {\n    setAdvBlockVisible(!advBlockVisible);\n  };\n  const onSelectProduct = (item: DataType) => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.ui.modalSearchProducts) {\n        draft.ui.modalSearchProducts.isOpen = false;\n        draft.ui.modalSearchProducts.q = q;\n        draft.ui.modalSearchProducts.producer = producer;\n        draft.ui.modalSearchProducts.color = color;\n        draft.ui.modalSearchProducts.advBlockVisible = advBlockVisible;\n        if (data) {\n          draft.ui.modalSearchProducts.cachedResponse = data;\n        }\n        if (productsRef && productsRef.current) {\n          draft.ui.modalSearchProducts.scrollPosition =\n            productsRef.current.scrollTop;\n        }\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n    sendEvent({\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: newStore.selectedIds\n          .filter((id) => {\n            if (!newStore.objects[id]) {\n              return false;\n            }\n            if (newStore.objects[id].objectType !== ObjectTypes.Bead) {\n              return false;\n            }\n            return true;\n          })\n          .map((id) => {\n            const { height, width, depth, type, color, material } = item.bead;\n            return {\n              id,\n              properties: {\n                height,\n                width,\n                depth,\n                type,\n                color,\n                material,\n              },\n            };\n          }),\n      },\n    });\n  };\n  const onClickClearQ = () => {\n    setQ(\"\");\n    triggerSearch(\"\");\n  };\n\n  const onClickClearProducer = () => {\n    setProducer(\"\");\n    triggerSearch(undefined, \"\");\n  };\n\n  const onClickClearColor = () => {\n    setColor(\"\");\n    triggerSearch(undefined, undefined, \"\");\n  };\n\n  const onClickSearch = () => {\n    triggerSearch();\n  };\n\n  const triggerSearch = (_q?: string, _producer?: string, _color?: string) => {\n    onStartSearch(_q, _producer, _color);\n  };\n\n  //   React.useEffect(() => {\n  //     verify();\n  //   }, [q]);\n\n  //   const verify = React.useCallback(\n  //     debounce(() => {\n  //       onStartSearch();\n  //     }, 500),\n  //     []\n  //   );\n\n  const onClickBeadProducer = (search: string) => {\n    if (producer === search) {\n      setProducer(\"\");\n      triggerSearch(q, search, color);\n    } else {\n      setProducer(search);\n      triggerSearch(q, search, color);\n    }\n  };\n\n  const onClickBeadColorCategory = (search: string) => {\n    if (color === search) {\n      setColor(\"\");\n      triggerSearch(q, producer, search);\n    } else {\n      setColor(search);\n      triggerSearch(q, producer, search);\n    }\n  };\n  const [t] = useTranslation([\"board\", \"translation\"]);\n\n  const bead_colors_categories = [\n    { search: \"czarny\", hex: \"black\" },\n    { search: \"niebieski\", hex: \"blue\" },\n    { search: \"zielony\", hex: \"green\" },\n    { search: \"czerwony\", hex: \"red\" },\n    { search: \"pomaraczowy\", hex: \"orange\" },\n    { search: \"brazowy\", hex: \"brown\" },\n    { search: \"fioletowy\", hex: \"purple\" },\n    { search: \"zoty\", hex: \"gold\" },\n    { search: \"rowy\", hex: \"pink\" },\n    { search: \"ty\", hex: \"yellow\" },\n    { search: \"srebrny\", hex: \"#eee\" },\n  ];\n\n  return (\n    <ModalSearchProductsStyles>\n      <div className={\"modal-search-products-popup\"}>\n        <div\n          className={\"modal-search-products-popup-overlay\"}\n          onClick={onClickCancel}\n        >\n          &nbsp;\n        </div>\n        <div className={\"modal-search-products-popup-content-wrapper\"}>\n          <div className={\"modal-search-products-popup-content\"}>\n            <div className={\"btn-cancel\"} onClick={onClickCancel}>\n              <FontAwesomeIcon icon={faTimes} color={\"#000\"} />\n            </div>\n\n            <div className=\"inputs-wrapper\">\n              <div className=\"simple-inputs-wrapper\">\n                <div className={\"one-input-wrapper\"}>\n                  <input\n                    name={\"q\"}\n                    className={\"input\"}\n                    placeholder={t(\n                      \"board:modal_search_bead.search_input_placeholder\"\n                    )}\n                    autoComplete={\"off\"}\n                    onKeyPress={(event: any) => {\n                      if (event.key === \"Enter\") {\n                        triggerSearch();\n                      }\n                    }}\n                    value={q}\n                    onChange={(event) => {\n                      setQ(event.target.value);\n                    }}\n                  />\n\n                  {q.length > 0 ? (\n                    <div className={\"clear-input\"} onClick={onClickClearQ}>\n                      <FontAwesomeIcon icon={faTimes} />\n                    </div>\n                  ) : null}\n                </div>\n                <button onClick={onClickSearch}>\n                  <FontAwesomeIcon icon={faSearch} />\n                </button>\n                <button onClick={toggleAdvBlock}>\n                  {advBlockVisible === true\n                    ? t(\"board:modal_search_bead.close_advanced_filters\")\n                    : t(\"board:modal_search_bead.open_advanced_filters\")}{\" \"}\n                  <FontAwesomeIcon\n                    icon={\n                      advBlockVisible === true ? faChevronUp : faChevronDown\n                    }\n                  />\n                </button>\n              </div>\n\n              {advBlockVisible === true ? (\n                <div className=\"adv-wrapper\">\n                  <div>\n                    <div className={\"bead-colors-category-wrapper\"}>\n                      {bead_colors_categories.map((category) => {\n                        return (\n                          <BeadColorCategory\n                            key={category.search}\n                            search={category.search}\n                            hex={category.hex}\n                            onClick={onClickBeadColorCategory}\n                            isSelected={color === category.search}\n                          />\n                        );\n                      })}\n                      {color.length > 0 ? (\n                        <div\n                          className={\"clear-input\"}\n                          onClick={onClickClearColor}\n                        >\n                          <FontAwesomeIcon icon={faTimes} />\n                        </div>\n                      ) : null}\n                    </div>\n                  </div>\n\n                  <div className={\"bead-producers-wrapper\"}>\n                    <ProducerItem\n                      label={\"TOHO\"}\n                      value={\"toho\"}\n                      isSelected={producer === \"toho\"}\n                      onClick={onClickBeadProducer}\n                    />\n                    <ProducerItem\n                      label={\"MIYUKI\"}\n                      value={\"miyuki\"}\n                      isSelected={producer === \"miyuki\"}\n                      onClick={onClickBeadProducer}\n                    />\n                    <ProducerItem\n                      label={\"FirePolish\"}\n                      value={\"firepolish\"}\n                      onClick={onClickBeadProducer}\n                      isSelected={producer === \"firepolish\"}\n                    />\n\n                    {producer.length > 0 ? (\n                      <div\n                        className={\"clear-input\"}\n                        onClick={onClickClearProducer}\n                      >\n                        <FontAwesomeIcon icon={faTimes} />\n                      </div>\n                    ) : null}\n                  </div>\n                </div>\n              ) : null}\n            </div>\n            <div className={\"content-wrapper\"}>\n              {loading ? (\n                <div>{t(\"translation:query_loading\")}loading...</div>\n              ) : null}\n              {error ? (\n                <div>\n                  {t(\"translation:query_error\")}error: {error}\n                </div>\n              ) : null}\n              {data ? (\n                <div className={\"products\"} ref={productsRef}>\n                  {data.map((item) => {\n                    const onClick = () => {\n                      onSelectProduct(item);\n                    };\n                    return (\n                      <div\n                        key={item.item.bead_product_uuid}\n                        className={\"item\"}\n                        onClick={onClick}\n                      >\n                        <div className={\"img\"}>\n                          <img\n                            src={thumbnailsGenerator.getObjectThumbnail(\n                              item.bead,\n                              100,\n                              100\n                            )}\n                            alt={\"\"}\n                          />\n                        </div>\n                        <h2>{item.item.display_name}</h2>\n                      </div>\n                    );\n                  })}\n                </div>\n              ) : null}\n            </div>\n          </div>\n        </div>\n      </div>\n    </ModalSearchProductsStyles>\n  );\n};\n\nconst ProducerItem: React.FC<{\n  value: string;\n  label: string;\n  onClick: any;\n  isSelected: boolean;\n}> = (props) => {\n  const onClick = () => {\n    props.onClick(props.value);\n  };\n  return (\n    <div\n      className={`bead-producer-item ${props.isSelected ? \"selected\" : \"\"}`}\n      onClick={onClick}\n    >\n      {props.label}\n    </div>\n  );\n};\n\nconst BeadColorCategory: React.FC<{\n  search: string;\n  hex: string;\n  onClick: any;\n  isSelected: boolean;\n}> = (props) => {\n  const onClick = () => {\n    props.onClick(props.search);\n  };\n  return (\n    <div\n      className={`bead-color-category-item ${\n        props.isSelected ? \"selected\" : \"\"\n      }`}\n      onClick={onClick}\n      style={{ backgroundColor: props.hex }}\n    >\n      &nbsp;\n    </div>\n  );\n};\n\nexport const ModalSearchProductsStyles = styled.div`\n  .modal-search-products-popup {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 9999;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    overflow-x: hidden;\n    overflow-y: auto;\n    max-height: 100vh;\n  }\n  .modal-search-products-popup-overlay {\n    background: rgba(0, 0, 0, 0.4);\n    transition: all 0.4s ease-in-out;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n  .modal-search-products-popup-content-wrapper {\n    position: absolute;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100%;\n  }\n  .modal-search-products-popup-content {\n    background: #fff;\n    padding: 32px;\n    width: 650px;\n    box-sizing: border-box;\n    transition: all 0.25s ease-out;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    transition: all 0.4s ease-in-out;\n    z-index: 2;\n    position: relative;\n  }\n  .bead-color-category-item {\n    width: 30px;\n    height: 30px;\n    border-radius: 30px;\n    display: flex;\n    border: 1px solid #dedede;\n    margin-right: var(--standardPadding);\n    margin-bottom: var(--standardPadding);\n    background: #eee;\n    cursor: pointer;\n    &.selected {\n      border: 2px solid #000;\n    }\n  }\n  .bead-colors-category-wrapper {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n    position: relative;\n\n    .clear-input {\n      position: relative;\n      top: -4px;\n      right: 0;\n      height: 30px;\n      width: 40px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n    }\n  }\n  .bead-producer-item {\n    font-size: 12px;\n    display: flex;\n    height: 35px;\n    border-radius: 8px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    border: 1px solid #dedede;\n    padding: var(--standardPadding);\n    margin-right: var(--standardPadding);\n    margin-bottom: var(--standardPadding);\n    background: #fff;\n    cursor: pointer;\n    &.selected {\n      background: #eee;\n    }\n  }\n  .bead-producers-wrapper {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n    position: relative;\n\n    .clear-input {\n      position: relative;\n      top: -5px;\n      right: 0;\n      height: 35px;\n      width: 40px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n    }\n  }\n  .actions {\n    display: flex;\n    justify-content: flex-end;\n  }\n  .modal-title {\n    font-size: 20px;\n    text-align: left;\n  }\n  .btn-cancel {\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 5;\n    width: 45px;\n    height: 45px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    /* border: 1px solid #eee; */\n    /* color: #000; */\n    /* padding: 10px 15px; */\n    /* border-radius: 4px; */\n    /* width: 90px; */\n    cursor: pointer;\n  }\n  .input {\n    border: none;\n    border-bottom: 1px solid rgba(5, 0, 56, 0.2);\n    padding: 8px 0 4px;\n    font-size: 24px;\n    transition: all 0.4s ease-in-out;\n    border-radius: 0;\n    box-shadow: none;\n    margin-bottom: 10px;\n\n    &:hover {\n      border-bottom-color: rgba(5, 0, 56, 0.4);\n    }\n    &:focus {\n      border-bottom-color: var(--uiButtonActive);\n    }\n  }\n  .inputs-wrapper {\n  }\n  .simple-inputs-wrapper {\n    display: flex;\n    column-gap: var(--standardPadding);\n    margin-bottom: var(--standardPadding);\n    width: 450px;\n\n    .one-input-wrapper {\n      position: relative;\n      input {\n        width: 100%;\n      }\n      .clear-input {\n        position: absolute;\n        top: 0;\n        right: 0;\n        height: calc(100% - 11px);\n        width: 50px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n      }\n    }\n    button {\n      background: none;\n      border: 1px solid #eee;\n      border-radius: var(--standardPadding);\n      padding: var(--standardPadding);\n      height: 42px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      column-gap: var(--standardPadding);\n    }\n  }\n  .content-wrapper {\n    .products {\n      display: grid;\n      column-gap: var(--standardPadding);\n      grid-template-columns: 1fr 1fr 1fr;\n      overflow-y: scroll;\n      max-height: 500px;\n      padding-right: var(--standardPadding);\n      &::-webkit-scrollbar-thumb {\n        background: var(--uiButtonActive);\n        border: 1px solid #cfcfcf;\n        border-radius: 60px;\n      }\n      &::-webkit-scrollbar-track {\n        background: #fff;\n        border: 1px solid #e4e4e4;\n      }\n      &::-webkit-scrollbar {\n        width: var(--standardPadding);\n      }\n    }\n    .item {\n      border: 1px solid #eee;\n      border-radius: 6px;\n      padding: var(--standardPadding);\n      margin-bottom: var(--standardPadding);\n      cursor: pointer;\n      transition: all 0.3s ease-in-out;\n      &:hover {\n        border: 1px solid var(--uiButtonActive);\n      }\n      .img {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n      h2 {\n        font-size: 12px;\n      }\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { SelectedObjectsTopBar } from \"./SelectedObjectsTopBar/SelectedObjectsTopBar\";\nimport ReactTooltip from \"react-tooltip\";\nimport { ModalEditBoard } from \"./ModalEditBoard\";\nimport { ProjectInfoWrapper } from \"./ProjectInfoWrapper\";\nimport { MinimapWrapper } from \"./MinimapWrapper\";\nimport { BeadsSummary } from \"./BeadsSummary\";\nimport { ActionsWrapper } from \"./ActionsWrapper\";\nimport { RightSidebar } from \"./RightSidebar\";\nimport { LeftSidebar } from \"./LeftSidebar\";\nimport { BottomBar } from \"./BottomBar\";\nimport styled from \"styled-components\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faSyncAlt } from \"@fortawesome/free-solid-svg-icons\";\nimport { ModalSearchProducts } from \"./ModalSearchProducts\";\n\nexport const EditorScene = () => {\n  const leftSidebarOpen = useSelector((state: Editor) => {\n    return state.ui.leftSidebar.isOpen;\n  });\n  const rightSidebarOpen = useSelector((state: Editor) => {\n    return state.ui.rightSidebar.isOpen;\n  });\n\n  return (\n    <div>\n      <ReactTooltip />\n      <ModalEditBoard />\n      <ModalSearchProducts />\n      <EditorMainStyles>\n        <div\n          className={`scene \n          ${leftSidebarOpen ? \"left-sidebar-open\" : \"\"} \n          ${rightSidebarOpen ? \"right-sidebar-open\" : \"\"}`}\n        >\n          <LoadingInfo />\n          <ProjectInfoWrapper />\n          <MinimapWrapper />\n          <BeadsSummary />\n          <ActionsWrapper />\n          <BottomBar />\n          <LeftSidebar />\n          <RightSidebar />\n\n          <SelectedObjectsTopBar />\n        </div>\n      </EditorMainStyles>\n    </div>\n  );\n};\n\nconst EditorMainStyles = styled.div`\n  .scene {\n    border: 1px solid #e0e0e0;\n    position: relative;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: flex-start;\n    box-sizing: border-box;\n    height: 100vh;\n\n    .block-loading {\n      position: absolute;\n      top: 0;\n      left: 0;\n      background: rgba(255, 255, 255, 0.9);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      height: 100%;\n      z-index: var(--zIndexBlockLoading);\n      svg {\n        animation: rotating 2s linear infinite;\n      }\n    }\n\n    &.right-sidebar-open {\n      .right-sidebar-wrapper {\n        right: 0;\n      }\n\n      .minimap-wrapper {\n        right: calc(var(--standardPadding) + var(--leftSidebarWidth));\n      }\n      .beads-summary {\n        right: calc(\n          var(--standardPadding) + var(--leftSidebarWidth) +\n            var(--standardPadding) + var(--minimapWidth)\n        );\n      }\n    }\n\n    &.left-sidebar-open {\n      .left-sidebar-wrapper {\n        left: 0;\n      }\n      .project-info-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .actions-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .bottom-bar-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n    }\n  }\n\n  @keyframes rotating {\n    from {\n      -ms-transform: rotate(0deg);\n      -moz-transform: rotate(0deg);\n      -webkit-transform: rotate(0deg);\n      -o-transform: rotate(0deg);\n      transform: rotate(0deg);\n    }\n    to {\n      -ms-transform: rotate(360deg);\n      -moz-transform: rotate(360deg);\n      -webkit-transform: rotate(360deg);\n      -o-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n`;\n\nconst LoadingInfo: React.FC<{}> = () => {\n  const loading = useSelector((state: Editor) => {\n    return state.ui.blockThreejs.loading;\n  });\n\n  if (loading === false) {\n    return <div data-test={\"blockLoadingLoaded\"}></div>;\n  }\n\n  return (\n    <div className={\"block-loading\"} data-test={\"blockLoading\"}>\n      <FontAwesomeIcon icon={faSyncAlt} />\n    </div>\n  );\n};\n\n/* .scene-wrapper {\n    position: relative;\n    outline: none;\n    user-select: none;\n    width: calc(100% - 100px - 300px);\n    height: calc(100vh - 71px);\n    background: #e4e4e4;\n    box-sizing: border-box;\n    overflow: hidden;\n  } */\n// const ToolBarStyles = styled.div`\n//   .fieldset {\n//     padding-bottom: 5px;\n//     padding-top: 5px;\n//     display: flex;\n//     justify-content: flex-start;\n//     align-items: center;\n//   }\n\n//   .fieldset .label {\n//     font-family: \"Open Sans\", sans-serif;\n//     font-size: 16px;\n//     line-height: 30px;\n//     font-weight: 300;\n//     padding: 0;\n//     margin: 0;\n//     padding-left: 10px;\n//     padding-right: 10px;\n//     display: flex;\n//     flex-direction: row;\n//     flex-wrap: nowrap;\n//     align-items: center;\n//   }\n\n//   .fieldset .input {\n//     border: none;\n//     background: none;\n//     border-bottom: 1px solid #dfdfdf;\n//     color: #6e6e6e;\n//     font-size: 14px;\n//     line-height: 30px;\n//     font-family: \"Open Sans\", sans-serif;\n//     box-shadow: none;\n//     max-width: 200px;\n//     padding: 0;\n//     margin: 0;\n//   }\n\n//   .fieldset .input[type=\"number\"] {\n//     max-width: 50px;\n//   }\n// `;\n\n// class PanZoomWrapper extends React.Component<{ children, updatePosition }> {\n//   htmlDivInstance: HTMLDivElement | null = null;\n//   componentDidMount() {\n//     if (this.htmlDivInstance !== null) {\n//       const boundingClientRect = this.htmlDivInstance.getBoundingClientRect();\n//       this.props.updatePosition(boundingClientRect);\n//     }\n//   }\n//   render() {\n//     return (\n//       <div ref={refInstance => this.htmlDivInstance = refInstance}>\n//         {this.props.children}\n//       </div>\n//     )\n//   }\n// }\n\n// const Lights: React.FC<{}> = (props) => {\n//   const dispatch = useDispatch();\n//   const lights = useSelector((state: Editor) => {\n//     return state.ui.lights;\n//   });\n//   return (\n//     <LightsStyles>\n//       <div className={\"toolbar-lights\"}>\n//         {lights.map((l, index) => {\n//           const onChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n//             const newValue = Number(event.target.value) / 100;\n//             // console.log(\"co mam?\", newValue);\n//             // dispatch(\n//             //   Actions.Toolbar.action_updateLight(index, \"intensity\", newValue)\n//             // );\n//           };\n//           return (\n//             <div key={l.name} className={\"light\"}>\n//               <div className={\"info\"}>{JSON.stringify(l)}</div>\n//               <div className={\"fields\"}>\n//                 <fieldset>\n//                   <label>intensity: </label>\n//                   <input\n//                     type=\"range\"\n//                     name={`${l.name}_${l.intensity}`}\n//                     value={(l.intensity ?? 0) * 100}\n//                     onChange={onChange}\n//                     min=\"1\"\n//                     max=\"99\"\n//                     step=\"1\"\n//                   />\n//                 </fieldset>\n//               </div>\n//             </div>\n//           );\n//         })}\n//       </div>\n//     </LightsStyles>\n//   );\n// };\n// const LightsStyles = styled.div`\n//   .toolbar-lights {\n//     background: #ddd;\n//     width: 100%;\n//     border: none;\n//     box-sizing: border-box;\n//     position: absolute;\n//     bottom: 0;\n//     left: 0;\n//   }\n//   .light {\n//     border: 1px solid #000;\n//     border-radius: 3px;\n//     margin-bottom: 10px;\n//     padding: 10px;\n//   }\n//   .light .info {\n//     font-size: 11px;\n//     line-height: 13px;\n//     display: block;\n//     margin-bottom: 5px;\n//     width: 100%;\n//     overflow: hidden;\n//     word-break: break-all;\n//     white-space: pre-line;\n//   }\n//   .light .fields {\n//     display: flex;\n//     justify-content: center;\n//     align-items: center;\n//   }\n//   .light .fields fieldset {\n//     display: flex;\n//     justify-content: center;\n//     align-items: center;\n//     column-gap: 10px;\n//   }\n// `;\n\n// const state = useSelector((state: Editor) => {\n//   return state;\n// });\n// const store = useStore();\n// const state = store.getState();\n// console.log(\"EditorRerender: \", state);\n\n// @TODO: Dodac funkcje ktora zostaje uruchomiona po rozpoczeciu aplikajci\n// const dispatch = useDispatch();\n// const [firstPass, setFirstPass] = useState(false);\n// useEffect(() => {\n//   if (process.env.NODE_ENV && process.env.NODE_ENV === \"development\") {\n//     if (firstPass === false) {\n//       dispatch(Actions.Persist.action_readSavedCanvas());\n//       // dispatch(\n//       //   Actions.ChangeEditorMode.action_onChangeEditorMode(\n//       //     EditorMode.EditLines\n//       //   )\n//       // );\n//       // dispatch(Actions.Draggable.action_onClickLastestLine());\n//       setFirstPass(true);\n//     }\n//   }\n// });\n\n// const panZoomRef = useRef<any>(null);\n\n// if (!state) {\n//   return <div>Error in app</div>;\n// }\n\n// const preventPan = (event, x, y) => {\n//   console.log('??', event, x, y)\n//   return true;\n// }\n\n// const onStateChange = (event) => {\n//   if (panZoomRef && panZoomRef.current !== null) {\n//     const boundingClientRect = panZoomRef.current.getContainerBoundingRect();\n//     dispatch(\n//       Actions.Draggable.action_updateSceneZoom({\n//         ...event,\n//         top: boundingClientRect.top,\n//         left: boundingClientRect.left,\n//       })\n//     );\n//   } else {\n//     dispatch(\n//       Actions.Draggable.action_updateSceneZoom({\n//         ...event,\n//         top: 0,\n//         left: 0,\n//       })\n//     );\n//   }\n// };\n// const onResizeSceneWrapper = (width, height) => {\n//   dispatch(\n//     Actions.Draggable.action_updateSceneWrapperSize({\n//       width,\n//       height,\n//     })\n//   );\n// };\n\n// const updatePosition = (event) => {\n//   dispatch(Actions.Draggable.action_updatePanZoomWrapperRect(event));\n// }\n\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <div className={\"scene-wrapper\"}> */\n}\n\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <div className=\"topbar-wrapper\">\n          <TopbarMain />\n          <TopbarSecoundary />\n        </div> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <ReactResizeDetector\n            handleWidth\n            handleHeight\n            skipOnMount={false}\n            onResize={onResizeSceneWrapper}\n          /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <PanZoom\n          style={{ width: \"100%\", height: \"100%\", position: \"absolute\" }}\n          disabled={editorMode !== EditorMode.Idle}\n          ref={panZoomRef}\n          onStateChange={onStateChange}\n          keyMapping={{\n            \"87\": { x: 0, y: -1, z: 0 },\n            \"83\": { x: 0, y: 1, z: 0 },\n            \"65\": { x: -1, y: 0, z: 0 },\n            \"68\": { x: 1, y: 0, z: 0 }\n          }}\n        >\n          <div>{`This content can be panned and zoomed.`}</div>\n          <BackgroundImage />\n\n          <AddBeadsMode isActive={editorMode === EditorMode.AddBeads} />\n\n          <MouseSelectionBeads\n            isVisible={editorMode === EditorMode.EditBeads}\n          />\n\n          <DisplayBeads mode={editorMode} />\n\n         \n\n          <DisplayGridLines isVisible={editorMode === EditorMode.EditLines} />\n\n          <GroupSelectionPlaceholder mode={editorMode} />\n\n          <Brush isVisible={editorMode === EditorMode.PaintBeads} />\n        </PanZoom> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <DisplayLines mode={editorMode} /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <AddLineMode isActive={editorMode === EditorMode.AddLine} /> */\n}\n\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <MouseSelectionLines isVisible={editorMode === EditorMode.EditLines} /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* </div> */\n}\n\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <div className={\"toolbar-wrapper\"}>\n            <div className={\"toolbar-content\"}> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <ToolBarStyles> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <ToolbarEditLines isVisible={editorMode === EditorMode.EditLines} /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <ToolbarEditBeads\n                isVisible={editorMode === EditorMode.SelectOrMove}\n              /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <ToolbarAddLine isVisible={editorMode === EditorMode.AddLine} /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <ToolbarIdle isVisible={editorMode === EditorMode.Idle} /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <ToolbarPaint isVisible={editorMode === EditorMode.PaintBeads} /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <ToolbarAddBeads isVisible={editorMode === EditorMode.AddBeads} /> */\n}\n\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <Lights /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* <ChangeLinePosition mode={editorMode} />\n\n        <PickBeadType mode={editorMode} />\n        <ChangeBeadRotate mode={editorMode} />\n        <PickBeadColor mode={editorMode} />\n        <LineInspector mode={editorMode} />\n\n        <EditToolbar mode={editorMode} /> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* </ToolBarStyles> */\n}\n// eslint-disable-next-line no-lone-blocks\n{\n  /* </div>\n          </div> */\n}","import { fetchBoard } from \"../ApiService\";\nimport { AppObject } from \"../editorObjects/Editor\";\n// import { getModelBBoxFromBeadType } from \"./loadModels\";\n\nexport const getProjectData = (\n  id: string\n): Promise<{ board: { uuid: string; name: string }; objects: AppObject[] }> => {\n  if (id === \"\") {\n    return new Promise((resolve, reject) => {\n      resolve({\n        board: { name: \"---\", uuid: \"\" },\n        objects: [],\n      });\n    });\n  }\n\n  if (id === \"demo\") {\n    return new Promise((resolve, reject) => {\n      getDemoProjectData().then((response) => {\n        resolve(response);\n      });\n    });\n  }\n\n  return new Promise((resolve, reject) => {\n    fetchBoard(id)\n      .then((response) => {\n        resolve(response);\n      })\n      .catch((err) => reject(err));\n  });\n};\n\nexport const getDemoProjectData = (): Promise<{\n  board: { uuid: string; name: string };\n  objects: AppObject[];\n}> => {\n  return new Promise((resolve, reject) => {\n    const objects = {};\n    // const bbox = getModelBBoxFromBeadType(BeadTypes.MODEL_TOHO_ROUND);\n    // let width = 1;\n    // let height = 1;\n    // let depth = 1;\n    // if (bbox) {\n    //   width = Math.abs(bbox.max.x - bbox.min.x);\n    //   height = Math.abs(bbox.max.y - bbox.min.y);\n    //   depth = Math.abs(bbox.max.z - bbox.min.z);\n    // }\n    // for (let i = 0; i < 10 * 10; i = i + 10) {\n    //   for (let j = 0; j < 10 * 50; j = j + 10) {\n    //     const b1 = buildBead({\n    //       width,\n    //       height,\n    //       depth,\n    //       type: BeadTypes.TOHO_SPHERE,\n    //       color: Math.random() > 0.5 ? \"red\" : \"blue\",\n    //       position: {\n    //         x: i,\n    //         y: j,\n    //       },\n    //     });\n    //     objects[b1.id] = b1;\n    //   }\n    // }\n\n    // const region = buildRegion({\n    //   height: 100,\n    //   width: 100,\n    //   shape: RegionShape.Rectangle,\n    //   settings: {\n    //     columns: 3,\n    //     rows: 3,\n    //   },\n    //   position: buildPoint(-100, -110),\n    // });\n\n    // objects[region.id] = region;\n\n    // const region2 = buildRegion({\n    //   height: 200,\n    //   width: 200,\n    //   shape: RegionShape.Triangle,\n    //   settings: {\n    //     columns: 4,\n    //     rows: 2,\n    //   },\n    //   position: buildPoint(-300, -10),\n    // });\n\n    // objects[region2.id] = region2;\n\n    // const group = buildGroup({\n    //   height: 250,\n    //   width: 250,\n    //   position: buildPoint(250, 250),\n    // });\n    // const subRegion = buildRegion({\n    //   height: 50,\n    //   width: 50,\n    //   position: buildPoint(200, 200),\n    //   groupId: group.id,\n    // });\n    // const subBead = buildBead({\n    //   width,\n    //   height,\n    //   depth,\n    //   type: BeadTypes.TOHO_SPHERE,\n    //   position: buildPoint(300, 300),\n    //   groupId: group.id,\n    // });\n    // group.childrenIds = [subBead.id, subRegion.id];\n    // objects[subBead.id] = subBead;\n    // objects[subRegion.id] = subRegion;\n    // objects[group.id] = group;\n\n    // const previewProject3D = buildPreviewProject3D({\n    //   height: 50,\n    //   width: 50,\n    //   position: buildPoint(500, 500),\n    //   color: \"red\",\n    // });\n    // objects[previewProject3D.id] = previewProject3D;\n\n    resolve({\n      board: {\n        uuid: \"123\",\n        name: \"Projekt testowy\",\n      },\n      objects: Object.keys(objects).map((id) => {\n        return objects[id];\n      }),\n    });\n  });\n};\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport { AppEventType } from \"./controllers/AppEventType\";\nimport { redoHistory, undoHistory } from \"./controllers/AppHistory\";\nimport { refreshReactState } from \"./controllers/refreshReactState\";\nimport {\n  emptyStore,\n  getStore,\n  setStore,\n  shouldRefreshReact,\n  shouldRefreshThree,\n} from \"./controllers/store\";\nimport { sendEvent } from \"./controllers/storeController\";\nimport { buildBead } from \"./editorObjects/Bead\";\nimport {\n  ObjectTypes,\n  RegionGridType,\n  RegionShape,\n} from \"./editorObjects/Editor\";\nimport { buildRegion } from \"./editorObjects/Region\";\nimport { logger } from \"./logger\";\nimport { getProjectData } from \"./threejs/apiControler\";\nimport {\n  addLightFromUI,\n  addGridFromUi,\n  addObjectByObjectType,\n} from \"./threejs/eventEmitterHandlers\";\nimport { appThree } from \"./threejs/renderThreejs\";\n\nexport const prepareBoard = (id: string) => {\n  return getProjectData(id).then((data) => {\n    return new Promise((resolve, reject) => {\n      const refreshThreejs = shouldRefreshThree();\n      const refreshReact = shouldRefreshReact();\n\n      const store = getStore();\n\n      const newStore = produce(store, (draft) => {\n        draft.board = cloneDeep(emptyStore.board);\n        draft.history = cloneDeep(emptyStore.history);\n        draft.objects = cloneDeep(emptyStore.objects);\n        draft.selectedIds = cloneDeep(emptyStore.selectedIds);\n        draft.ui = cloneDeep(emptyStore.ui);\n\n        if (data.objects !== undefined && data.objects.length > 0) {\n          data.objects.forEach((object) => {\n            draft.objects[object.id] = object;\n          });\n        }\n\n        draft.board.name = data.board?.name ?? \"\";\n        draft.board.uuid = data.board?.uuid ?? \"\";\n        draft.board.canEdit = true;\n        draft.ui.blockThreejs.loading = false;\n      });\n\n      setStore(newStore);\n\n      if (refreshThreejs) {\n        store.ui.lights.forEach((light) => {\n          addLightFromUI(light, appThree.scene);\n        });\n      }\n\n      if (refreshThreejs) {\n        if (store.ui.grid) {\n          addGridFromUi(store.ui.grid);\n        }\n      }\n\n      if (refreshThreejs) {\n        Object.keys(newStore.objects).forEach((id) => {\n          addObjectByObjectType(newStore.objects[id]);\n        });\n      }\n\n      if (refreshReact) {\n        refreshReactState(newStore);\n      }\n\n      // testPaintBeads();\n      // testRegionsWithMoveAndNoSnap()\n      // testRegionsWithBricks();\n      testRegions();\n      // sendEvent({\n      //   name: AppEventType.ChangeUiSettingsZoom,\n      //   payload: {\n      //     useAnimation: false,\n      //     zoomType: \"zoomByScroll\",\n      //     scrollDelta: 20\n      //   },\n      // });\n      resolve(undefined);\n    });\n  });\n};\n\nexport const clearBoard = (id: string) => {\n  return new Promise<void>((resolve) => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      draft = cloneDeep(emptyStore);\n    });\n\n    refreshReactState(newStore);\n    resolve();\n  });\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst testPaintBeads = () => {\n  const size = 20;\n  for (let i = 0; i < 10; i++) {\n    const beadr = buildBead({\n      color: \"red\",\n      position: {\n        x: size * 1 + 10,\n        y: size * i + 10,\n      },\n      width: size,\n      height: size,\n    });\n    const beadg = buildBead({\n      color: \"green\",\n      position: {\n        x: size * 2 + 10,\n        y: size * i + 10,\n      },\n      width: size,\n      height: size,\n    });\n    const beadb = buildBead({\n      color: \"blue\",\n      position: {\n        x: size * 3 + 10,\n        y: size * i + 10,\n      },\n      width: size,\n      height: size,\n    });\n    sendEvent({\n      name: AppEventType.AddObjects,\n      payload: {\n        objects: [beadr, beadg, beadb],\n      },\n    });\n  }\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst testRegionsWithBricks = () => {\n\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [\n        {\n          id: \"regionA\",\n          objectType: ObjectTypes.Region,\n          width: 100,\n          height: 100,\n          position: {\n            x: 0,\n            y: 0,\n            z: 0,\n          },\n          columns: 7,\n          rows: 7,\n          gridType: RegionGridType.Bricks,\n          shape: RegionShape.Triangle,\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            autoFillBeads: true,\n            snapBeadsToCell: true,\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            position: {\n              x: -50,\n              y: 0,\n              z: 0,\n            },\n          },\n        },\n      ],\n    },\n  });\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst testRegionsWithMoveAndNoSnap = () => {\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [\n        {\n          id: \"regionA\",\n          objectType: ObjectTypes.Region,\n          width: 100,\n          height: 100,\n          position: {\n            x: 0,\n            y: 0,\n            z: 0,\n          },\n          columns: 5,\n          rows: 2,\n          shape: RegionShape.Triangle,\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            autoFillBeads: true,\n            snapBeadsToCell: true,\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            columns: 5,\n            rows: 2,\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            snapBeadsToCell: false,\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            position: {\n              x: -50,\n              y: 0,\n              z: 0,\n            },\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            position: {\n              x: -150,\n              y: 0,\n              z: 0,\n            },\n          },\n        },\n      ],\n    },\n  });\n\n  // undoHistory();\n  // undoHistory();\n  // undoHistory();\n  // redoHistory();\n  // redoHistory();\n  // redoHistory();\n  // testRegions();\n};\n\nexport const testRegions = () => {\n  const beadr = buildBead({\n    id: \"beadr\",\n    color: \"red\",\n    position: {\n      x: 0,\n      y: 0,\n    },\n\n    // width: 10,\n    // height: 10,\n    // depth: 10,\n  });\n  const beadg = buildBead({\n    id: \"beadg\",\n    color: \"green\",\n    position: {\n      x: 50,\n      y: 0,\n    },\n  });\n  const beadb = buildBead({\n    id: \"beadb\",\n    color: \"blue\",\n    position: {\n      x: 100,\n      y: 0,\n    },\n  });\n\n  const regionA = buildRegion({\n    id: \"regionA\",\n    position: {\n      x: 100,\n      y: 100,\n    },\n    width: 100,\n    height: 200,\n    columns: 6,\n    rows: 6,\n  });\n\n  const regionB = buildRegion({\n    id: \"regionB\",\n    position: {\n      x: 250,\n      y: 100,\n    },\n    width: 100,\n    height: 100,\n    columns: 6,\n    rows: 6,\n  });\n  const regionC = buildRegion({\n    id: \"regionC\",\n    position: {\n      x: 450,\n      y: 300,\n    },\n    width: 300,\n    height: 100,\n    columns: 6,\n    rows: 6,\n  });\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [beadr, beadg, beadb, regionA, regionB, regionC],\n    },\n  });\n  // sendEvent({\n  //   name: AppEventType.ChangeSelectObjects,\n  //   payload: {\n  //     change: [{ id: \"regionA\", isSelected: true }],\n  //   },\n  // });\n  // sendEvent({\n  //   name: AppEventType.ChangeUiSettingsZoom,\n  //   payload: {\n  //     zoomType: \"zoomInScreenCenter\",\n  //     useAnimation: false,\n  //   },\n  // });\n  // sendEvent({\n  //   name: AppEventType.ChangeUiSettingsZoom,\n  //   payload: {\n  //     zoomType: \"zoomOutScreenCenter\",\n  //     useAnimation: false,\n  //   },\n  // });\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst testGroup = () => {\n  const beadr = buildBead({\n    id: \"beadr\",\n    color: \"red\",\n    position: {\n      x: 0,\n      y: 0,\n    },\n  });\n  const beadg = buildBead({\n    id: \"beadg\",\n    color: \"green\",\n    position: {\n      x: 50,\n      y: 0,\n    },\n  });\n  const beadb = buildBead({\n    id: \"beadb\",\n    color: \"blue\",\n    position: {\n      x: 100,\n      y: 0,\n    },\n  });\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [beadr, beadg, beadb],\n    },\n  });\n  const __s1 = getStore();\n  logger.log(\"__s1\", Object.keys(__s1.objects));\n  sendEvent({\n    name: AppEventType.GroupObjects,\n    payload: {\n      objects: [__s1.objects[\"beadr\"], __s1.objects[\"beadg\"]],\n    },\n  });\n  const __s2 = getStore();\n  logger.log(\"__s2\", Object.keys(__s2.objects));\n  sendEvent({\n    name: AppEventType.GroupObjects,\n    payload: {\n      objects: [\n        __s2.objects[\"beadr\"],\n        __s2.objects[\"beadg\"],\n        __s2.objects[\"beadb\"],\n      ],\n    },\n  });\n  const __s2a = getStore();\n  logger.log(\"__s2a\", Object.keys(__s2a.objects));\n  undoHistory();\n  const __s3 = getStore();\n  logger.log(\"__s3\", Object.keys(__s3.objects));\n  undoHistory();\n  const __s3a = getStore();\n  logger.log(\"__s3a\", Object.keys(__s3a.objects));\n  redoHistory();\n  const __s4 = getStore();\n  logger.log(\"__s4\", Object.keys(__s4.objects));\n  redoHistory();\n  const __s4a = getStore();\n  logger.log(\"__s4a\", Object.keys(__s4a.objects));\n};\n","import React from \"react\";\nimport { EditorScene } from \"./components/Editor\";\nimport { Provider } from \"react-redux\";\nimport { appStore } from \"./immerReducers/appStore\";\nimport { useParams } from \"react-router-dom\";\nimport { renderThreejs, unmountThreejs } from \"./threejs/renderThreejs\";\nimport { clearBoard, prepareBoard } from \"./prepareBoard\";\nimport { AppData } from \"./AppData\";\nimport { startBatchQueue, stopBatchQueue } from \"./ApiService\";\n\nexport const onStart = (\n  uuid: string,\n  data: AppData,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  renderThreejs(\n    canvas === undefined ? document.getElementById(\"threejs\") : (canvas as any),\n    canvas,\n    context\n  ).then(() => {\n    prepareBoard(uuid);\n\n    if (uuid !== \"demo\" && data.save_events === true) {\n      startBatchQueue(uuid);\n    }\n  });\n};\n\nexport const onEnd = (\n  uuid: string,\n  data: AppData,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  stopBatchQueue(uuid);\n  clearBoard(uuid);\n  unmountThreejs(\n    canvas === undefined ? document.getElementById(\"threejs\") : (canvas as any)\n  );\n};\n\nexport const PageBoard: React.FC<{\n  data: AppData;\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined;\n  context: WebGLRenderingContext | undefined;\n}> = (props) => {\n  let { uuid } = useParams<{ uuid: string }>();\n\n  React.useEffect(() => {\n    onStart(uuid, props.data, props.canvas, props.context);\n    return () => {\n      onEnd(uuid, props.data, props.canvas, props.context);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div className=\"App\">\n      <Provider store={appStore}>\n        <EditorScene />\n      </Provider>\n    </div>\n  );\n};\n","import { AppData } from \"./AppData\";\nimport React from \"react\";\nimport { createContext } from \"use-context-selector\";\n\nconst initialState: State = {\n  isAuthorized: false,\n  data: undefined,\n};\n\nexport const AuthContext = createContext<{ state: State; dispatch: Dispatch }>({\n  state: initialState,\n  dispatch: () => null,\n});\n\ntype State =\n  | {\n      isAuthorized: true;\n      data: AppData;\n    }\n  | {\n      isAuthorized: false;\n      data: undefined;\n    };\n\ntype Action = { type: \"logout\" };\ntype Dispatch = (action: Action) => void;\n\nconst reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"logout\":\n      return {\n        isAuthorized: false,\n        data: undefined,\n      };\n    default:\n      return state;\n  }\n};\n\nexport const useValue = (startState: State) => {\n  return React.useReducer(reducer, startState);\n};\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useHistory } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { useContextSelector } from \"use-context-selector\";\nimport { AppData } from \"./AppData\";\nimport { AuthContext } from \"./AuthContext\";\n\nexport const PageHome: React.FC<{\n  data: AppData;\n}> = () => {\n  const [t] = useTranslation([\"board\", \"translation\"]);\n  const dispatch = useContextSelector(AuthContext, (ctx) => ctx.dispatch);\n  const history = useHistory();\n  const onClickLogout = () => {\n    window.localStorage.removeItem(\"coralinio_jwt\");\n    setTimeout(() => {\n      window.location.href = \"/\";\n      dispatch({\n        type: \"logout\",\n      });\n    }, 50);\n  };\n  const onClickBoards = () => {\n    history.push(\"/boards\");\n  };\n  return (\n    <PageStyles>\n      <div>\n        <h2>{t(\"translation:welcome\")}</h2>\n        <button\n          onClick={onClickBoards}\n          className={\"btn-light\"}\n          data-test={\"boards\"}\n        >\n          {t(\"translation:links.boards\")}\n        </button>\n        <button\n          onClick={onClickLogout}\n          className={\"btn-light\"}\n          data-test={\"logout\"}\n        >\n          {t(\"translation:links.logout\")}\n        </button>\n      </div>\n    </PageStyles>\n  );\n};\n\nconst PageStyles = styled.div`\n  padding: 1em;\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #000;\n    margin-bottom: 10px;\n    margin-right: 10px;\n    cursor: pointer;\n  }\n  h2 {\n    margin-bottom: 0.5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n`;\n","import React from \"react\";\n\nexport const PageNoMatch: React.FC<{ data: any }> = (props) => {\n  return <div>page NO MATCH</div>;\n};\n","import React from \"react\";\nexport const PageNotAutorized: React.FC<{ data: any }> = (props) => {\n  return <div>Not autorized</div>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport React from \"react\";\nimport { createGlobalStyle, css } from \"styled-components\";\n\nconst BulmaReset = css`\n  /* Bulma Base */\n  /*! minireset.css v0.0.6 | MIT License | github.com/jgthms/minireset.css */\n  html,\n  body,\n  p,\n  ol,\n  ul,\n  li,\n  dl,\n  dt,\n  dd,\n  blockquote,\n  figure,\n  fieldset,\n  legend,\n  textarea,\n  pre,\n  iframe,\n  hr,\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    margin: 0;\n    padding: 0;\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    font-size: 100%;\n    font-weight: normal;\n  }\n\n  ul {\n    list-style: none;\n  }\n\n  button,\n  input,\n  select,\n  textarea {\n    margin: 0;\n  }\n\n  html {\n    box-sizing: border-box;\n  }\n\n  *,\n  *::before,\n  *::after {\n    box-sizing: inherit;\n  }\n\n  img,\n  video {\n    height: auto;\n    max-width: 100%;\n  }\n\n  iframe {\n    border: 0;\n  }\n\n  table {\n    border-collapse: collapse;\n    border-spacing: 0;\n  }\n\n  td,\n  th {\n    padding: 0;\n  }\n\n  td:not([align]),\n  th:not([align]) {\n    text-align: inherit;\n  }\n\n  html {\n    background-color: white;\n    font-size: 16px;\n    -moz-osx-font-smoothing: grayscale;\n    -webkit-font-smoothing: antialiased;\n    min-width: 300px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n    text-rendering: optimizeLegibility;\n    -webkit-text-size-adjust: 100%;\n    -moz-text-size-adjust: 100%;\n    -ms-text-size-adjust: 100%;\n    text-size-adjust: 100%;\n  }\n\n  article,\n  aside,\n  figure,\n  footer,\n  header,\n  hgroup,\n  section {\n    display: block;\n  }\n\n  body,\n  button,\n  input,\n  optgroup,\n  select,\n  textarea {\n    font-family: BlinkMacSystemFont, -apple-system, \"Segoe UI\", \"Roboto\",\n      \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\",\n      \"Helvetica Neue\", \"Helvetica\", \"Arial\", sans-serif;\n  }\n\n  code,\n  pre {\n    -moz-osx-font-smoothing: auto;\n    -webkit-font-smoothing: auto;\n    font-family: monospace;\n  }\n\n  body {\n    color: #4a4a4a;\n    font-size: 1em;\n    font-weight: 400;\n    line-height: 1.5;\n  }\n\n  a {\n    color: #3273dc;\n    cursor: pointer;\n    text-decoration: none;\n  }\n\n  a strong {\n    color: currentColor;\n  }\n\n  a:hover {\n    color: #363636;\n  }\n\n  code {\n    background-color: whitesmoke;\n    color: #da1039;\n    font-size: 0.875em;\n    font-weight: normal;\n    padding: 0.25em 0.5em 0.25em;\n  }\n\n  hr {\n    background-color: whitesmoke;\n    border: none;\n    display: block;\n    height: 2px;\n    margin: 1.5rem 0;\n  }\n\n  img {\n    height: auto;\n    max-width: 100%;\n  }\n\n  input[type=\"checkbox\"],\n  input[type=\"radio\"] {\n    vertical-align: baseline;\n  }\n\n  small {\n    font-size: 0.875em;\n  }\n\n  span {\n    font-style: inherit;\n    font-weight: inherit;\n  }\n\n  strong {\n    color: #363636;\n    font-weight: 700;\n  }\n\n  fieldset {\n    border: none;\n  }\n\n  pre {\n    -webkit-overflow-scrolling: touch;\n    background-color: whitesmoke;\n    color: #4a4a4a;\n    font-size: 0.875em;\n    overflow-x: auto;\n    padding: 1.25rem 1.5rem;\n    white-space: pre;\n    word-wrap: normal;\n  }\n\n  pre code {\n    background-color: transparent;\n    color: currentColor;\n    font-size: 1em;\n    padding: 0;\n  }\n\n  table td,\n  table th {\n    vertical-align: top;\n  }\n\n  table td:not([align]),\n  table th:not([align]) {\n    text-align: inherit;\n  }\n\n  table th {\n    color: #363636;\n  }\n`;\n\nconst AppReactStyles = css`\n  body {\n    font-family: \"Open Sans\", sans-serif;\n  }\n\n  .App {\n    text-align: center;\n    background: #f6f6f6;\n  }\n\n  .topbar-wrapper {\n    height: 70px;\n    background: #f6f6f6;\n    padding-left: 0px;\n    padding-top: 0px;\n    width: 100%;\n    border-bottom: 2px solid #e0e0e0;\n    box-sizing: border-box;\n  }\n\n  #threejs {\n  }\n  #threejs.active {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    z-index: 2;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n\n  /*\n\n\n\n\n\n\n\n\n\n\n\n\n*/\n\n  .line {\n    position: absolute;\n    background: #5a5a5a;\n    width: 0;\n    height: 0;\n  }\n\n  .line-start {\n    position: absolute;\n    background: #5a5a5a;\n  }\n\n  .line-end {\n    position: absolute;\n    background: #5a5a5a;\n  }\n\n  .add-line-wrapper {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0);\n    z-index: 100;\n  }\n\n  .bead-item {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 5;\n    height: 20px;\n    width: 20px;\n    background: #bbb;\n  }\n\n  .button {\n    font-family: \"Open Sans\", sans-serif;\n    font-weight: 300;\n    font-size: 13px;\n    color: #000;\n  }\n\n  .mouse-selection {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0);\n    z-index: 9;\n  }\n\n  .toolbar-wrapper {\n    position: relative;\n    background: #f6f6f6;\n    width: 300px;\n    border-left: 2px solid #e0e0e0;\n    box-sizing: border-box;\n    right: -100px;\n  }\n\n  .topbar-wrapper .fieldset {\n    /* border-top: 1px solid #dfdfdf;\n  border-bottom: 1px solid #dfdfdf; */\n    padding-bottom: 5px;\n    padding-top: 5px;\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .topbar-wrapper .fieldset .label {\n    font-family: \"Open Sans\", sans-serif;\n    font-size: 13px;\n    line-height: 30px;\n    font-weight: 300;\n    padding: 0;\n    margin: 0;\n    padding-left: 10px;\n    padding-right: 10px;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    align-items: center;\n  }\n\n  .topbar-wrapper .fieldset .input {\n    border: none;\n    background: none;\n    border-bottom: 1px solid #dfdfdf;\n    color: #6e6e6e;\n    font-size: 14px;\n    line-height: 30px;\n    font-family: \"Open Sans\", sans-serif;\n    box-shadow: none;\n    max-width: 200px;\n    padding: 0;\n    margin: 0;\n  }\n`;\n\nconst AppVariables = css`\n  :root {\n    --text: #000;\n    --uiButton: rgba(5, 0, 56, 1);\n    --uiButtonActive: #c96ca3;\n    --uiButtonInActive: rgba(5, 0, 56, 0.2);\n    --bg: #f7dcec;\n    --btns_bg: #c96ca3;\n    --btns_text: #fff;\n    --title: #7c72a9;\n    --color_secoundary: #7c72a9;\n    --gray: rgba(0, 0, 0, 0.15);\n\n    --zIndexModal: 1000;\n    --zIndexMinimap: 500;\n    --zIndexProjectInfo: 500;\n    --zIndexBeadsSummary: 500;\n    --zIndexActions: 500;\n    --zIndexActions: 500;\n    --zIndexLeftSidebar: 510;\n    --zIndexRightSidebar: 510;\n    --zIndexBottomBar: 510;\n    --zIndexSelectedObjectsTopBar: 100;\n    --zIndexBlockLoading: 10;\n\n    --standardPadding: 8px;\n    --minimapWidth: 170px;\n    --leftSidebarWidth: 480px;\n    --rightSidebarWidth: 480px;\n  }\n`;\n\nexport const AppFonts = css`\n  @import url(\"https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i&display=swap\");\n  @import url(\"https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap\");\n`;\n\nexport const GlobalAppStyles = createGlobalStyle`\n    ${AppVariables}\n    ${BulmaReset}\n    ${AppReactStyles}\n`;\n","import i18next from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\n// import LocalStorageBackend from \"i18next-localstorage-backend\";\nimport HttpApi from \"i18next-http-backend\";\nimport sprintf from \"i18next-sprintf-postprocessor\";\nimport { enUS, pl } from \"date-fns/locale\";\nimport {\n  isDate,\n  format as formatDate,\n  formatRelative,\n  formatDistance,\n} from \"date-fns\";\nconst locales = { enUS, pl }; // used to look up the required locale\n\nconst isDev = !process.env.NODE_ENV || process.env.NODE_ENV === \"development\";\nconst translationHost = isDev\n  ? \"./locales/\"\n  : \"https://rpcal.github.io/coralinio-preview/build/locales/\";\n\ni18next\n  .use(HttpApi)\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .use(sprintf)\n  .init({\n    // debug: isDev ? true : false,\n    debug: false,\n    preload: [\"pl\"],\n    whitelist: [\"en\", \"pl\"],\n    ns: [\"board\", \"translation\", \"boards\", \"dates\"],\n    fallbackLng: \"pl\",\n    fallbackNS: \"translation\",\n    defaultNS: \"translation\",\n    saveMissing: false,\n    initImmediate: false,\n    interpolation: {\n      escapeValue: false,\n      format: (value, format, lng) => {\n        if (isDate(value)) {\n          let localesKey: string = lng ?? \"pl\";\n          if (lng === \"en\") {\n            localesKey = \"enUS\";\n          }\n\n          const locale = locales[localesKey];\n          \n          if (format === undefined) {\n            format = \"short\";\n          }\n\n          if (format === \"short\") return formatDate(value, \"P\", { locale });\n          if (format === \"long\") return formatDate(value, \"PPPP\", { locale });\n          if (format === \"relative\")\n            return formatRelative(value, new Date(), { locale });\n          if (format === \"ago\")\n            return formatDistance(value, new Date(), {\n              locale,\n              addSuffix: true,\n            });\n\n          return formatDate(value, format, { locale });\n        }\n        return value;\n      },\n    },\n    returnEmptyString: false,\n    overloadTranslationOptionHandler: sprintf.overloadTranslationOptionHandler,\n    backend: {\n      loadPath: translationHost + \"./{{lng}}__{{ns}}.json\",\n    },\n    detection: {\n      order: [\n        \"querystring\",\n        \"cookie\",\n        \"localStorage\",\n        \"sessionStorage\",\n        \"navigator\",\n      ],\n      lookupQuerystring: \"lang\",\n      lookupCookie: \"i18next\",\n      lookupLocalStorage: \"i18nextLang\",\n      lookupSessionStorage: \"i18nextLang\",\n      caches: [\"localStorage\", \"cookie\"],\n    },\n    react: {\n      //   bindI18n: \"languageChanged\",\n      //   bindI18nStore: \"\",\n      //   transEmptyNodeValue: \"\",\n      //   transSupportBasicHtmlNodes: true,\n      //   transKeepBasicHtmlNodesFor: [\"br\", \"strong\", \"i\"],\n      useSuspense: false,\n    },\n  });\n\nexport const getI18n = () => i18next;\n","import React, { Suspense } from \"react\";\n// import \"bulma/css/bulma.css\";\n// import \"./App.css\";\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\nimport { AppData } from \"./AppData\";\nimport { PageBoards } from \"./PageBoards\";\nimport { PageBoard } from \"./PageBoard\";\nimport { PageHome } from \"./PageHome\";\nimport { PageNoMatch } from \"./PageNoMatch\";\nimport { PageNotAutorized } from \"./PageNotAutorized\";\nimport { useContextSelector } from \"use-context-selector\";\nimport { AuthContext, useValue } from \"./AuthContext\";\nimport { logger } from \"./logger\";\nimport { AppFonts, GlobalAppStyles } from \"./GlobalAppStyles\";\nimport { I18nextProvider } from \"react-i18next\";\nimport { getI18n } from \"./i18n\";\n\n\nconst App: React.FC<{\n  data: AppData;\n}> = (props) => {\n  logger.log(\"render App.tsx\");\n  const isAuthorized = (props.data?.token ?? \"\").length > 0;\n  const [state, dispatch] = useValue(\n    isAuthorized === true\n      ? {\n          isAuthorized: true,\n          data: props.data,\n        }\n      : {\n          isAuthorized: false,\n          data: undefined,\n        }\n  );\n  return (\n    <Suspense fallback={<div>Loading... </div>}>\n      <I18nextProvider i18n={getI18n()}>\n        <AuthContext.Provider value={{ state, dispatch }}>\n          <GlobalAppStyles></GlobalAppStyles>\n          <style>{AppFonts}</style>\n          <Routes data={props.data} />\n        </AuthContext.Provider>\n      </I18nextProvider>\n    </Suspense>\n  );\n};\n\nconst Routes: React.FC<{\n  data: AppData;\n}> = (props) => {\n  const isAuthorized = useContextSelector(\n    AuthContext,\n    (ctx) => ctx.state.isAuthorized\n  );\n  return (\n    <Router hashType={\"slash\"}>\n      {isAuthorized ? (\n        <Switch>\n          <Route exact path=\"/\">\n            <PageHome data={props.data} />\n          </Route>\n          <Route exact path=\"/boards\">\n            <PageBoards data={props.data} />\n          </Route>\n          <Route exact path=\"/board/:uuid\">\n            <PageBoard\n              data={props.data}\n              canvas={undefined}\n              context={undefined}\n            />\n          </Route>\n          <Route path=\"*\">\n            <PageNoMatch data={props.data} />\n          </Route>\n        </Switch>\n      ) : (\n        <Switch>\n          <Route exact path=\"/\">\n            <PageNotAutorized data={props.data} />\n          </Route>\n          <Route path=\"*\">\n            <PageNoMatch data={props.data} />\n          </Route>\n        </Switch>\n      )}\n    </Router>\n  );\n};\n\nexport default App;\n\n// \"homepage\": \"https://rpcal.github.io/coralinio-preview/build/\",\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport { AppData } from \"./AppData\";\nimport packageJson from \"./../package.json\";\nimport { setApiFromAppData } from \"./ApiService\";\nimport { merge } from \"lodash\";\n// import { getI18n } from \"./i18n\";\n\nconst isDev = !process.env.NODE_ENV || process.env.NODE_ENV === \"development\";\nconsole.log(\"start app with version: \", packageJson.version, \"isDev\", isDev);\nconst root = document.getElementById(\"root\");\nif (root !== null) {\n  const threejs = document.createElement(\"div\");\n  threejs.setAttribute(\"id\", \"threejs\");\n  if (root.parentNode) {\n    root.parentNode.insertBefore(threejs, root.nextSibling);\n  }\n\n  try {\n    let data: AppData = isDev\n      ? {\n          apiHost: \"http://localhost:9000/\",\n          token:\n            \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1dWlkIjoiYzY2Nzg4Y2QtZjM2OS1mNWU5LWFmOTEtYjhlNWI3NmIyNDZhIiwidXNlcm5hbWUiOiJyb2JlZWUiLCJpYXQiOjE2MTcyNTc3NjJ9.LgUWUiFdkarrIfR5FORUI6cnEBHyPgCDmJJXAQlEuBQ\",\n          // token: \"\",\n          user: {\n            username: \"robeee\",\n            uuid: \"dc073641-01a4-107e-ae84-d3ec995bfc80\",\n          },\n          save_events: false,\n        }\n      : {\n          apiHost: \"\",\n          save_events: true,\n          token: \"\",\n          user: {\n            username: \"\",\n            uuid: \"\",\n          },\n        };\n    const hash = root.getAttribute(\"data-hash\");\n    if (hash) {\n      const hashData = JSON.parse(hash);\n      data = merge({}, data, hashData);\n    }\n    setApiFromAppData(data);\n    ReactDOM.render(<App data={data} />, root);\n  } catch (err) {}\n}\n"],"sourceRoot":""}