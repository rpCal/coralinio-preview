{"version":3,"sources":["editorObjects/Editor.tsx","editorObjects/Point.ts","editorObjects/Bead.ts","ApiService.ts","components/colors.ts","components/SelectedObjectsTopBar/ActionsTypes.tsx","PageBoards.tsx","controllers/AppEventType.ts","logger.ts","controllers/store.ts","editorObjects/EditBBox.ts","editorObjects/Group.ts","editorObjects/PreviewProject3D.ts","editorObjects/Region.ts","EventEmitter.tsx","editorObjects/editorGetters.ts","threejs/OBJLoader.js","threejs/loadModels.ts","immerReducers/MainImmerReducer.tsx","immerReducers/store.tsx","immerReducers/appStore.tsx","threejs/mouseListeners/mouseEventEditorMode/MouseEventsBase.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeAddBead.ts","threejs/mouseListeners/MouseDragHelper.ts","threejs/mouseListeners/MouseSelectionHelper.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeAddRegion.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeDelete.ts","controllers/refreshReactState.ts","threejs/keyboard/keyMap.ts","threejs/mouseListeners/SelectionFilter.ts","threejs/mouseListeners/mouseListeners.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsIdle.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeSelectOrMove.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeIdle.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModePaint.ts","threejs/mouseListeners/mouseEventEditorMode/MouseEventsEditorModeSelectMultiple.ts","threejs/mouseListeners/mouseScreenPosition.ts","threejs/mouseListeners/getRect10x10FromScreenToWorld.ts","controllers/AppHistory.ts","threejs/thumbnailsGenerator.ts","threejs/renderThreejs.ts","threejs/mouseListeners/screenToWorld.ts","threejs/eventEmitterHandlers.ts","controllers/BaseHandlers/BaseEventHandler.ts","controllers/BaseHandlers/StoreObjectHandler.ts","controllers/EventHandlers/AddObjectHandler.ts","controllers/EventHandlers/RemoveObjectHandler.ts","controllers/EventHandlers/ChangeSelectObjectsHandler.ts","controllers/EventHandlers/ChangeObjectsPropertyHandler.ts","controllers/EventHandlers/ChangeUiSettingsHandler.ts","threejs/clipboard.ts","controllers/EventHandlers/ClipboardCopyHandler.ts","controllers/EventHandlers/ClipboardCutHandler.ts","controllers/EventHandlers/ClipboardPasteHandler.ts","controllers/EventHandlers/AddMultipleBeadsHandler.ts","controllers/EventHandlers/ChangeUiSettingsZoomHandler.ts","controllers/EventHandlers/ChangeUiSettingsSidebarHandler.ts","controllers/EventHandlers/ChangeObjectsAlignmentHandler.ts","controllers/EventHandlers/DuplicateObjectsHandler.ts","controllers/EventHandlers/GroupObjectsHandler.ts","controllers/EventHandlers/UngroupObjectsHandler.ts","controllers/storeController.ts","components/SelectedObjectsTopBar/ActionsIconsWrapper.tsx","components/SelectedObjectsTopBar/NumericInput.tsx","components/SelectedObjectsTopBar/PopupWrapper.tsx","components/SelectedObjectsTopBar/TopBarContent.tsx","components/SelectedObjectsTopBar/SelectedObjectsTopBar.tsx","components/ModalEditProject.tsx","components/ProjectInfoWrapper.tsx","components/MinimapWrapper.tsx","components/BeadsSummary.tsx","components/Toolbar/EditorModes.tsx","components/ActionsWrapper.tsx","components/PanelContentStyles.tsx","components/RightSidebar.tsx","components/LeftSidebar.tsx","components/BottomBar.tsx","components/ModalSearchProducts.tsx","components/Editor.tsx","threejs/apiControler.ts","prepareBoard.tsx","PageBoard.tsx","AuthContext.tsx","PageHome.tsx","PageNoMatch.tsx","PageNotAutorized.tsx","GlobalAppStyles.tsx","App.tsx","index.tsx"],"names":["BeadTypes","BeadMaterialTypes","RegionGridType","RegionShape","ObjectTypes","EditorMode","EditorMenuMain","EditorGridType","BrushType","NAME_SEPARATOR","BeadChildSuffix","buildPoint","x","y","z","contain","p1","p2","p","apiHost","tempBoardId","SaveEventType","getThreeNameFromBeadId","id","childSuffix","MAIN","Bead","getThreeUserDataFromBead","bead","merge","name","buildBead","props","defaults","THREE","generateUUID","position","type","MODEL_CYLINDER","material","Mat","rotateX","rotateY","rotateZ","lineRotate","color","height","width","depth","keepAspectRatio","canLockOrUnlock","isLocked","objectType","groupId","undefined","regionId","headers","handleError","err","reject","console","error","sendingEnabled","lastSendTimestamp","Date","getTime","toSendEventsQueue","notifyBackend","events","length","forEach","event","push","debouncedSend","debounce","triggerSendBatchEvents","trailing","now","log","body","JSON","stringify","changes","Promise","resolve","fetch","method","then","res","json","response","statusCode","message","status","catch","sendBoardBatchEvents","prototype","toISOString","pad","number","this","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","toFixed","slice","ActionsTypes","ActionsGroupTypes","PageBoards","history","useHistory","React","useState","boards","state","setBoards","useEffect","data","save_events","PageStyles","onClick","board","uuid","className","to","data-test","map","styled","div","AppEventType","SnapToLineType","MapActionObjectType","EditBeadProduct","EditBeadType","EditBeadMaterial","EditBeadColor","Alignment","EditWidthHeightDepth","EditPosition","EditRotate","Group","Ungroup","Lock","Unlock","More","Region","EditRegionShape","EditRegionGridType","EditRegionGridSettings","EditWidthHeight","PreviewProject3D","Actions","sortOrder","EditBeadsProperies","groupSortOrder","EditRegionProperies","Transform","LockOrUnlock","GroupOrUngroup","store","EditBBoxChildSuffix","enabled","logger","warn","defaultStore","objects","selectedIds","canRedo","canUndo","canEdit","canToggleToFavourite","isFavourite","canExportAsImage","editModalVisible","ui","modalSearchProducts","isOpen","successAction","advBlockVisible","producer","q","cachedResponse","scrollPosition","leftSidebar","panel","rightSidebar","zoomScale","mode","SelectOrMove","lights","intensity","grid","Hex","hexSize","snapEnabled","isVisible","selectedTopBarPosition","blockThreejs","loading","emptyStore","cloneDeep","getStore","setStore","newStore","refreshThreejs","refreshReact","shouldRefreshThree","shouldRefreshReact","GroupChildSuffix","getThreeNameFromEditBBoxId","SceneEditBBox","PreviewProject3DChildSuffix","getThreeNameFromGroupId","getThreeUserDataFromGroup","group","buildGroup","childrenIds","RegionChildSuffix","getThreeNameFromPreviewProject3DId","getThreeUserDataFromPreviewProject3D","obj","internalEventEmiter","EventNames","getThreeNameFromRegionId","getThreeUserDataFromRegion","region","getBricksColumnsAndRowsCount","currentColumns","columns","rows","isActiveRegionCell","index","shape","Rectangle","newSize","gridType","Bricks","rowOdd","Math","floor","isNotLastColumn","Triangle","_row","column","row","isInside","lastColumnIndex","min","ratio","max","beadsCountInRow","emptyCells","offsetFromStart","offsetFromEnd","insideRegionTriange","buildRegion","Rectangles","beadIds","opacity","autoFillBeads","snapBeadsToCell","childrenGridIds","newRegion","size","newChildrenGridIds","Array","fill","getStateObjectFromObjectId","objectId","EventEmitter","_events","listener","listenerToRemove","filter","callback","BufferGeometry","FileLoader","Float32BufferAttribute","LineBasicMaterial","LineSegments","Loader","Material","Mesh","MeshPhongMaterial","Points","PointsMaterial","Vector3","OBJLoader","object_pattern","material_library_pattern","material_use_pattern","map_use_pattern","vA","vB","vC","ab","cb","ParserState","object","vertices","normals","colors","uvs","materials","materialLibraries","startObject","fromDeclaration","previousMaterial","currentMaterial","_finalize","geometry","hasUVIndices","smooth","startMaterial","libraries","previous","inherited","groupCount","splice","mtllib","isArray","groupStart","groupEnd","clone","cloned","bind","end","lastMultiMaterial","mi","declared","finalize","parseVertexIndex","value","len","parseInt","parseNormalIndex","parseUVIndex","addVertex","a","b","c","src","dst","addVertexPoint","addVertexLine","addNormal","addFaceNormal","fromArray","subVectors","cross","normalize","addColor","addUV","addDefaultUV","addUVLine","addFace","ua","ub","uc","na","nb","nc","vLen","ia","ib","ic","nLen","uvLen","addPointGeometry","vi","l","addLineGeometry","uvi","manager","call","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","loader","setPath","path","setRequestHeader","requestHeader","setWithCredentials","withCredentials","text","parse","e","itemError","setMaterials","indexOf","replace","lines","split","line","lineFirstChar","result","trimLeft","i","trim","charAt","parseFloat","vertexData","substr","faceVertices","j","jl","vertex","vertexParts","v1","v2","v3","lineParts","substring","lineVertices","lineUVs","li","llen","parts","pointData","exec","test","toLowerCase","container","concat","isLine","isPoints","hasVertexColors","buffergeometry","setAttribute","mesh","createdMaterials","miLen","materialHash","sourceMaterial","materialPoints","sizeAttenuation","copy","materialLine","flatShading","vertexColors","addGroup","add","points","base3dModels","toho_sphere","model","bbox","toho_miyuki","toho_15","model_cylinder","model_fire_polish","model_toho_round","modelsHost","loadAppModels","appThree","objLoader","loadAsync","setFromObject","getModelBBoxFromBeadType","TOHO_MIYUKI","TOHO_15","TOHO_SPHERE","MODEL_FIRE_POLISH","MODEL_TOHO_ROUND","MainImmerReducer","newState","draftState","ImmerReducer","Main","createActionCreators","composeReducers","createReducerFunction","appStore","createStore","MouseEventsBase","boundingClientRect","mouse","raycaster","intersects","clientX","clientY","el","getBoundingClientRect","top","left","setFromCamera","camera","intersectObjects","scene","children","getObjectsFromIntersect","getIntersect","userData","isGroup","isInGroup","maxItems","selected","MouseEventsEditorModeAddBead","abs","screenToWorld","action1","AddObjects","payload","sendEvent","MouseDragHelper","isDragged","isDragStarted","start","shouldBehaveLikeMove","deltaX","deltaY","MouseSelectionHelper","element","renderer","startPoint","pointTopLeft","pointBottomRight","isDown","document","createElement","style","pointerEvents","background","border","zIndex","Vector2","screenX","screenY","domElement","parentElement","appendChild","removeChild","MouseEventsEditorModeAddRegion","isCameraGrabed","startDragMousePosition","startDragCamera","mouseDragHelper","mouseSelectionHelper","setRenderer","onDown","onMove","minX","minY","action2","ChangeUiSettings","uiSettings","onUp","MouseEventsEditorModeDelete","Error","getActiveObjectsFromIntersect","firstClickedActiveObject","getIdsFromGroupOrInGroup","action","RemoveObjects","ids","refreshReactState","dispatch","updateEditorState","isInputElement","tagName","__pressed","__element","initKeybinding","hidden","visibilityChange","window","handleVisibilityChange","msHidden","webkitHidden","addEventListener","isPressedKey","eventName","moudeEditorModeIdle","moudeEditorModeSelectOrMove","moudeEditorModePaint","moudeEditorModeDelete","moudeEditorModeAddRegion","moudeEditorModeAddBead","moudeEditorModeSelectMultiple","SelectionFilter","frustum","Frustum","center","tmpPoint","vecNear","vecTopLeft","vecTopRight","vecDownRight","vecDownLeft","vecFarTopLeft","vecFarTopRight","vecFarDownRight","vecFarDownLeft","vectemp1","vectemp2","vectemp3","endPoint","collection","deep","Number","MAX_VALUE","updateFrustum","searchChildInFrustum","_startPoint","_endPoint","EPSILON","updateProjectionMatrix","updateMatrixWorld","isOrthographicCamera","right","down","set","unproject","planes","setFromCoplanarPoints","normal","multiplyScalar","isMesh","intersectsBox","includes","MouseEventsIdle","sceneScale","mouseDiffXInWorldSpace","mouseDiffYInWorldSpace","cameraX","cameraY","lookAt","MouseEventsEditorModeSelectOrMove","actionType","selectionBox","prevEditBBox","mouseEventsIdle","setCamera","setScene","keys","altKey","shiftKey","clicked","clickedId","clickedItemInSelectedObjects","selectedIsLocked","getSelectionForSingleObjectIdAction","isGroupChild","isClickedOnGroup","updateUIAtMove","moveAllSelectedObjects","moveSingleObject","moveObjectGroup","moveEditBBox","selectMultipleObjects","ChangeSelectObjects","change","isSelected","produce","draft","getTopBarPosition","diffX","diffY","getMoveObjectsAction","clickedObjectIsLocked","getSelectionAppendAction","additionalData","selectedBBox","topLeft","topRight","bottomLeft","bottomRight","allSelectedIds","selectIds","objectIds","properties","ChangeObjectsProperty","_id","__id","_newIsSelected","_addWithIsLock","addWithIsLock","newSelected","shouldBeSelected","getObjectByUserDataProperty","child_object","child","layers","mask","visible","hideTopBar","showTopBar","topBar","querySelector","display","MouseEventsEditorModeIdle","getState","MouseEventsEditorModePaint","MouseEventsEditorModeSelectMultiple","mousePosition","setMousePositionAtWindow","newPos","onWheel","preventDefault","updateUiEvent","ChangeUiSettingsZoom","zoomType","useAnimation","scrollDelta","Idle","DeleteBeads","PaintBeads","AddRegion","AddBeads","SelectMultiple","onWindowResize","bottom","setSize","onResize","onPointerDown","onPointerUp","onPointerOut","onPointerMove","thumbnailsGenerator","getRect10x10FromScreenToWorld","viewportOffset","x1","x2","y1","y2","pos1","pos2","maxX","maxY","w","h","AppHistory","maxHistoryRecords","arg","diff","do","isActive","createdAt","undoHistory","lastEvent","getHistory","back","undo","redoHistory","front","redo","initThumbnailsGenerator","rootEl","ThumbnailsGenerator","toString","cache","antialias","preserveDrawingBuffer","imgWidth","imgHeight","forceCache","cacheData","cacheId","content","createObjectThumbnail","clear","object3d","triggerAddBeadToScene","expandByObject","ratioImage","baseWidth","baseHeight","halfWidth","halfHeight","lightConfig","addLightFromUI","render","toDataURL","initCanvasApp","canvas","context","classList","contains","AppThree","initEventEmitterHandlers","requestAnimationFrame","threeRender","rect10x10FromScreenToWorld","Map","enable","clientWidth","clientHeight","needResize","needToResizeRendererToDisplaySize","worldToScreen","pos","vector","widthHalf","heightHalf","project","SelectBBox","rotation","rectangles","internalId","dotBrName","dotBlName","dotTrName","dotTlName","selectBboxGroupName","selectBBoxBgName","boxGeometry","BG","DOT_RESIZE_BOTTOM_RIGHT","DOT_RESIZE_BOTTOM_LEFT","DOT_RESIZE_TOP_RIGHT","DOT_RESIZE_TOP_LEFT","rectangle","toDelete","toCreate","rectIndex","findIndex","isRectExists","rect","scale","DEG2RAD","getCenter","get","parent","remove","delete","selectBBoxGoup","side","transparent","selectBBoxBg","rectShape","moveTo","lineTo","autoClose","_rectLinesPoints","getPoints","_rectLinesGeometryPoints","setFromPoints","_rectLinesMaterial","selectBBoxLines","getResizeDots","dot","attach","_bg","_dotTl","setFromVector3","makeRotationFromEuler","_dotTr","_dotBl","_dotBr","selectBBoxInstance","eventEmitter","on","action_changeSelectedBeads_color","traverse","action_changeSelectedBeads_height","beads","triggerUpdateEditBBox","editBBox","action_unselectAll","diffStateSelectedIds","triggerSelectBead","triggerSelectRegion","action_changeSelectedBeads_width","action_changeSelectedBeads_depth","action_changeSelectedBeads_type","action_changeSelectedBeads_rotate","action_selectBeads","diffStates","values","action_selectIntersectObject","action_selectIntersectObjects","selectedBeads","selectedRegions","action_updateZoomSCale","action_updateEditBBox","action_selectRegions","action_deleteBeads","triggerDeleteBeadIds","action_deleteSelectedBeads","action_deleteObjects","triggerDeleteObjectIds","toDeleteObjectIds","action_addBeadOnClick","action_updateLight","field","light","action_addRegion","triggerRegionToScene","action_moveClickedObject","movedObjects","action_moveAllSelectedObjects","action_movedSelected","regions","action_changeBeadColorToBeadTemplate","reflectivity","action_fastAddBeads","prevSelectedBeadIds","beadId","action_snapToLineSelectedBeads","action_onChangeEditorMode","action_readSavedCanvas","triggerGroupToScene","triggerPreviewProject3DToScene","startAppEvent","SceneLight","SceneBackgroundGrid","clearThreeScene","config","addObjectByObjectType","isFinite","getTopBarPositionInScreenFromObject","updateObjectPosition","positionX","positionY","shouldSelect","emissive","rectWidth","rectHeight","_rectPoints","_rectGeometryPoints","_lineMaterial","SELECTION_CHILD","rectangleFrame","SELECTION","_object","regionBgThree","regionGridCellsThree","GRID_CELLS","isCellActive","cellWidth","cellHeight","_cell","GRID_CELL","offsetX","regionThree","beadType","beadModel","getModelFromBeadType","ANY","Shiny","computeBoundingBox","groupBgThree","groupThree","previewProject3D","dotSize","__material","__boxGeometry","_whiteDot","renderOrder","___material","___boxGeometry","_grayDot","_baseDot","_dotTL","_dotTR","_dotBL","_dotBR","BaseEventHandler","saveToHistory","posX","posY","getCenterPosition","_store","getSimpleHistoryEvents","StoreObjectHandler","buildPreviewProject3D","updateRect","selectObjectOnThreeScene","_beadId","getMousePosition","worldPos","expandByPoint","bboxCenter","AddObjectHandler","newObject","getAppObjectFromCloneAppObject","historyEvent","dayjs","getStoreWithHistory","CREATE","RemoveObjectHandler","deleteSelectedObjectsFromStore","DELETE","ChangeSelectObjectsHandler","historyChange","getNewStoreWithTopBarPosition","ChangeObjectsPropertyHandler","added","updated","removed","historyChanges","_singleChange","singleHistoryChange","relatedChanges","shouldBeCreated","shouldBeDeleted","keyNames","key","_singeRelatedChange","whenBead","whenRegion","exists","applyChangesToThree","UPDATE","updatedKeys","inGroup","isBeadFoundRegion","isRegionContainBead","getRegionCellIndex","newIndex","oldIndex","getRegionCellCenter","currentIndex","oldRegionId","shapeKey","gridTypeKey","autoFillBeadsKey","snapBeadsToCellKey","rowsKey","columnsKey","positionKey","tempIds","oldRows","oldColumns","oldShape","oldGridType","autoFillBeadsEnabled","getRegionChildrenGridIdsAfterResize","toDeleteBeadIds","oldPosition","foundObject","isRegionCellContainBead","emptyCellsCount","snapBeadsToCellEnabled","nextIdIndexFromCreated","getRegionCellCenterFromCellIndex","getIdFromUndoOrRedo","nextIdIndexFromDeleted","newRows","newColumns","oldCurrentRow","oldCurrentCol","newIndexIsActive","oldMiddle","newMiddle","newColumn","ceil","newRow","regionTopLeftX","regionTopLeftY","cellIndex","currentRow","currentCol","cellW","cellH","_offsetX","rowIndex","columnIndex","offsetY","distX","ChangeUiSettingsHandler","keyName","setClipboardBoardContent","ClipboardCopyHandler","ClipboardCutHandler","clonedObjects","ClipboardPaste","ClipboardPasteHandler","mapIds","oldId","getPositionDiffFromMousePosition","moveObjectsByDiff","newChildrenIds","AddMultipleBeadsHandler","figure","defaultBead","times","col","ChangeUiSettingsZoomHandler","screenCenter","scrollSign","sign","updateByScroll","mouseXInWorldBefore","mouseYInWorldBefore","zoomChange","mouseXInWorldAfter","mouseYInWorldAfter","ChangeUiSettingsSidebarHandler","open","toggle","newOpen","ChangeObjectsAlignmentHandler","snapType","updates","X_MIN","X_MIDDLE","X_MAX","Y_MIN","Y_MIDDLE","Y_MAX","DuplicateObjectsHandler","GroupObjectsHandler","idsGroups","idsObjectsWithoutGroups","idsInGroup","objId","newGroup","newGroupId","GroupObjects","UngroupObjects","UngroupObjectsHandler","classNames","ClipboardCopy","ClipboardCut","AddMultipleBeads","ChangeUiSettingsSidebar","ChangeObjectsAlignment","DuplicateObjects","handler","run","ActionsIconsWrapper","GroupActionsStyles","actions","selectedAction","data-tip","data-place","data-type","data-effect","icon","faShapes","faBorderNone","faCrosshairs","faSync","faArrowsAlt","faAlignLeft","faChevronDown","faSearch","faBurn","faTimes","ItemActionWrapper","elRef","useRef","ref","current","offsetLeft","offsetParent","offsetWidth","groupOffsetLeft","finalOffsetLeft","IconActionsTypeMore","faEllipsisH","IconActionsTypeEditBeadColor","backgroundColors","useSelector","Fragment","join","IconActionsUnlock","startLongPress","setStartLongPress","onSuccess","timerId","setTimeout","clearTimeout","useCallback","stop","onMouseDown","onMouseUp","onMouseLeave","onTouchStart","onTouchEnd","transitionDuration","faLock","IconActionsLock","_event","faUnlock","IconActionsGroup","faObjectGroup","IconActionsUngroup","faObjectUngroup","IS_BROWSER","RE_NUMBER","RE_INCOMPLETE_NUMBER","access","prop","defaultValue","args","NumericInput","_timer","_valid","_isStrict","_ignoreValueChange","_isMounted","_inputFocus","refsWrapper","refsInput","strict","btnDownHover","btnDownActive","btnUpHover","btnUpActive","stringValue","_propsToState","out","hasOwnProperty","String","_parse","nextState","setState","saveSelection","prevProps","prevState","isNaN","NaN","_invokeEventCallback","focus","selectionStart","selectionEnd","checkValidity","getValueAsNumber","setValue","activeElement","target","valid","validationError","supportsValidation","noValidate","pattern","required","validity","validationMessage","maxLength","validStateChanged","search","RegExp","addClass","removeClass","n","precision","pow","_min","defaultProps","_max","round","_n","_toNumber","format","_step","step","DIRECTION_UP","DIRECTION_DOWN","snap","persist","isDefaultPrevented","keyCode","ctrlKey","metaKey","_recursive","increase","SPEED","DELAY","decrease","dir","callbackName","css","mobile","componentClass","noStyle","onInvalid","onValid","rest","hasFormControl","attrs","wrap","input","btnUp","onMouseEnter","btn","disabled","readOnly","btnDown","loose","_format","onChange","original","val","onKeyDown","_onKeyDown","onInput","onSelect","onFocus","onBlur","InputTag","minus","plus","arrowUp","arrowDown","Component","MIN_SAFE_INTEGER","MAX_SAFE_INTEGER","borderWidth","borderColor","borderStyle","margin","textAlign","cursor","transition","boxShadow","borderRadius","paddingRight","boxSizing","fontSize","paddingLeft","WebkitAppearance","lineHeight","textShadow","SliderPlus","createSliderWithTooltip","Slider","PopupWrapper","leftOffset","PopupWrapperStyles","EditBeadColorPopup","onChangeComplete","hex","EditBeadTypePopup","types","faSquareFull","faCircle","faSquare","EditBeadProductPopup","bead1","bead2","bead3","flexDirection","getObjectThumbnail","EditBeadMaterialPopup","materialTypes","justifyContent","alignItems","EditRegionGridTypePopup","cols","faGripHorizontal","faAlignCenter","EditRegionShapePopup","faPlay","transform","EditRegionGridSettingsPopup","onlyBricks","onlyShapeTriange","_columns","_rows","showRows","showDecimal","label","InputTypeNumber","negative","multiplicator","EditPositionPopup","result_x","result_y","result_z","_x","_y","_z","onChangeX","newValue","onChangeY","SliderWrapper","marginBottom","marginTop","onAfterChange","EditRotatePopup","onChangeZ","EditWidthHeightPopup","_width","_height","EditWidthHeightDepthPopup","AlignmentPopup","sendSnapTo","uiButton","getComputedStyle","getPropertyValue","faAlignRight","MorePopup","onlyRegionsInfo","snapToCellChecked","autoFillChecked","regionIds","onlyRegions","_value1","_value2","minWidth","faCheck","faExclamationCircle","TopBarContent","actionsGrouped","selectedActions","actionsForType","groupedResults","containsLockedGroup","containsRegion","anySelectedBeadInRegion","inGroupCount","noGroupCount","sort","groupIdA","groupIdB","firstActionA","firstActionB","groupSortOrderA","groupSortOrderB","actionA","actionB","popupInfo","setPopupInfo","onClickAnyIcon","SelectedObjectsTopBar","SelectedObjectsTopBarStyles","ModalEditProject","setName","onClickCancel","ModalEditProjectStyles","newName","setNewProjectName","ProjectInfoWrapper","ProjectInfoWrapperStyles","faStarSolid","faStarRegular","link","download","href","click","faUpload","faReply","MinimapWrapper","MinimapWrapperStyles","faMinus","faPlus","BeadsSummary","groupedCount","groups","groupData","item","count","example","textName","textTooltip","newCount","textCount","BeadsSummaryStyles","imgSrc","EditorModes","editorMode","onChangeEditorMode","newEditorMode","faMousePointer","faExpand","faPaintBrush","faTrashAlt","testId","faTable","faTh","StateButton","ButtonStyles","FastAddBeadsButton","useDispatch","defaultDimesions","defaultSelected","dimensions","setDimensions","setSelected","selectionVisible","setVisible","toggleSelection","data-tip-disable","SelectionStyles","colIndex","onCancel","SelectionFrame","divRef","useOutsideClick","handleClick","removeEventListener","ActionsWrapper","ActionsWrapperStyles","PanelContentStyles","CloseButton","RightSidebar","RightSidebarStyles","HistoryPanel","HistoryPanelStyles","_","fullCreatedAt","lastIndex","jumpToIndexHistory","faHistory","ObjectsPanel","filterSelected","setFilterSelected","selectedObjects","setSelectedObjects","onClickFilter","ObjectsPanelStyles","isBead","LeftSidebar","LeftSidebarStyles","CommentsPanel","BottomBar","setIsOpen","BottomBarStyles","faComment","faListAlt","faAngleDoubleLeft","faAngleDoubleRight","ModalSearchProducts","Content","productsRef","setQ","setProducer","setColor","setAdvBlockVisible","setLoading","setError","setData","scrollTop","onStartSearch","_q","_producer","_color","queryString","URLSearchParams","append","bead_products","bead_geometry","file_name","getNum","replaceAll","bead_color","fetchBeadProducts","triggerSearch","onClickBeadProducer","onClickBeadColorCategory","ModalSearchProductsStyles","placeholder","autoComplete","onKeyPress","faChevronUp","onSelectProduct","display_name","bead_product_uuid","ProducerItem","BeadColorCategory","backgroundColor","EditorScene","leftSidebarOpen","rightSidebarOpen","EditorMainStyles","LoadingInfo","faSyncAlt","getProjectData","getDemoProjectData","fetchBoard","prepareBoard","addGridFromUi","testRegions","beadr","beadg","beadb","regionA","regionB","onStart","renderThreejs","getElementById","onEnd","innerHTML","PageBoard","useParams","initialState","isAuthorized","AuthContext","createContext","reducer","PageHome","useContextSelector","ctx","localStorage","removeItem","location","PageNoMatch","PageNotAutorized","BulmaReset","AppReactStyles","AppVariables","AppFonts","GlobalAppStyles","createGlobalStyle","Routes","hashType","exact","App","startState","token","useReducer","Provider","packageJson","version","process","root","threejs","parentNode","insertBefore","nextSibling","user","username","hash","getAttribute","hashData","ReactDOM"],"mappings":"o1FAWYA,EA4BAC,E,0FA5BAD,K,0BAAAA,E,kBAAAA,E,0BAAAA,E,gCAAAA,E,sCAAAA,E,qCAAAA,M,cA4BAC,K,cAAAA,E,WAAAA,M,KAeL,IAuCKC,EAKAC,EAmDAC,G,SAxDAF,K,wBAAAA,E,iBAAAA,M,cAKAC,K,sBAAAA,E,oBAAAA,E,iBAAAA,M,cAmDAC,K,YAAAA,E,gBAAAA,E,cAAAA,E,oCAAAA,E,8BAAAA,E,0CAAAA,E,yBAAAA,M,KASL,IAEKC,EAWAC,EAMAC,EAIAC,EAvBCC,EAAiB,M,SAElBJ,K,YAAAA,E,sBAAAA,E,kBAAAA,E,4BAAAA,E,gCAAAA,E,oBAAAA,E,0BAAAA,E,wBAAAA,E,uBAAAA,M,cAWAC,K,YAAAA,E,YAAAA,E,YAAAA,E,yBAAAA,M,cAMAC,K,UAAAA,E,WAAAA,M,cAIAC,K,eAAAA,M,KClLL,ICWKE,EDXCC,EAAa,WAIb,IAHXC,EAGU,uDAHE,EACZC,EAEU,uDAFE,EACZC,EACU,uDADE,EAEZ,MAAO,CACLF,IACAC,IACAC,MA4CSC,EAAU,SAACC,EAAWC,EAAWC,GAC5C,OAAOA,EAAEN,EAAII,EAAGJ,GAAKM,EAAEN,EAAIK,EAAGL,GAAKM,EAAEL,EAAIG,EAAGH,GAAKK,EAAEL,EAAII,EAAGJ,G,iBC1ChDH,K,YAAAA,E,kBAAAA,E,sBAAAA,E,mCAAAA,M,KAOL,ICfHS,EAyOAC,EAOQC,EDjOCC,EAAyB,SACpCC,GAEI,IADJC,EACG,uDAD4Bd,EAAgBe,KAE/C,MAAM,GAAN,OAAUrB,EAAYsB,MAAtB,OAA6BjB,GAA7B,OAA8Cc,GAA9C,OAAmDd,GAAnD,OAAoEe,IAazDG,EAA2B,SACtCC,EACAJ,GAEA,OAAOK,gBAAM,GAAID,EAAM,CACrBE,KAAMR,EAAuBM,EAAKL,GAAIC,MAO7BO,EAAY,SAACC,GAKxB,IAAMC,EAAiB,CACrBV,GAAIW,IAAgBC,eACpBC,SAAUzB,EAAW,EAAG,GACxB0B,KAAMrC,EAAUsC,eAChBC,SAAUtC,EAAkBuC,IAC5BC,QAAS,EACTC,QAAS,EACTC,QAAS,EACTC,WAAY,EACZC,ME/D2B,UFgE3BC,OAAQ,GACRC,MAAO,GACPC,MAAO,GACPC,iBAAiB,EACjBC,iBAAiB,EACjBC,UAAU,EACVC,WAAYhD,EAAYsB,KAExB2B,aAASC,EACTC,cAAUD,GAGZ,OAAOzB,gBAAMI,EAAUD,ICtErBwB,EAAkC,CACpC,eAAgB,oBAQZC,EAAc,SAACC,EAAUC,GAC7BC,QAAQC,MAAM,gBAAiBH,GAC/BC,EAAO,QA8NLG,GAA0B,EAG1BC,GAAyB,IAAIC,MAAOC,UACpCC,EAAiC,I,SAEzB7C,K,gBAAAA,E,gBAAAA,E,iBAAAA,M,KAWL,IAAM8C,EAAgB,SAACC,IACL,IAAnBN,GACEM,EAAOC,OAAS,IAClBD,EAAOE,SAAQ,SAACC,GACdL,EAAkBM,KAAKD,MAEzBE,MAIAA,EAAgBC,oBACpB,kBAAMC,MA3BwB,IA6B9B,CAAEC,UAAU,IAURD,EAAyB,WAC7B,IAAME,GAAM,IAAIb,MAAOC,UAMvB,GALAL,QAAQkB,IACN,iCACAD,EAAMd,EACNG,EAAkBG,OAAS,GAEzBH,EAAkBG,OAAS,QAAqBf,IAAhBlC,EAA2B,CAC7D,IAAM2D,EAAOC,KAAKC,UAAU,CAAEC,QAAShB,IACvCA,EAAoB,GAzEY,SAClC3C,EACAwD,GAEO,IAAII,SAAQ,SAACC,EAASzB,GAC3B,OAAO0B,MAAMlE,EAAU,qBAAuBI,EAAI,CAChD+D,OAAQ,OACR9B,UACAuB,SAECQ,MAAK,SAACC,GAAD,OAASA,EAAIC,UAClBF,MAAK,SAACG,GACDA,EAASC,YAAsC,MAAxBD,EAASC,YAClChC,EAAO+B,EAASE,SAElBR,EAAQ,CACNS,OAAQH,EAASC,gBAGpBG,OAAM,SAACpC,GAAD,OAASD,EAAYC,EAAKC,SAuDnCoC,CAAqB3E,EAAa2D,GAEpChB,EAAoBc,GAgBjBb,KAAKgC,UAAUC,aAClB,WACE,SAASC,EAAIC,GACX,OAAIA,EAAS,GACJ,IAAMA,EAERA,EAGTnC,KAAKgC,UAAUC,YAAc,WAC3B,OACEG,KAAKC,iBACL,IACAH,EAAIE,KAAKE,cAAgB,GACzB,IACAJ,EAAIE,KAAKG,cACT,IACAL,EAAIE,KAAKI,eACT,IACAN,EAAIE,KAAKK,iBACT,IACAP,EAAIE,KAAKM,iBACT,KACCN,KAAKO,qBAAuB,KAAMC,QAAQ,GAAGC,MAAM,EAAG,GACvD,KAvBN,G,UEnTUC,EAwBAC,E,OCpBCC,EAER,SAAChF,GACJ,IAAIiF,EAAUC,cADA,EAEaC,IAAMC,SAE9B,CAAEC,OAAQ,KAJC,mBAEPC,EAFO,KAEAC,EAFA,KAsBd,OAVAJ,IAAMK,WAAU,YACiB,IAA3BxF,EAAMyF,KAAKC,aHMV,IAAIvC,SAAQ,SAACC,EAASzB,GAC3B,OAAO0B,MAAMlE,EAAU,kBAAmB,CACxCmE,OAAQ,MACR9B,YAEC+B,MAAK,SAACC,GAAD,OAASA,EAAIC,UAClBF,MAAK,SAACG,GACDA,EAASC,YAAsC,MAAxBD,EAASC,YAClChC,EAAO+B,EAASE,SAElBR,EAAQ,CACNiC,OAAQ3B,EAAS2B,YAGpBvB,OAAM,SAACpC,GAAD,OAASD,EAAYC,EAAKC,SGnBb4B,MAAK,SAACG,GACxB6B,EAAU,CACRF,OAAQ3B,EAAS2B,cAItB,IAGD,cAACM,EAAD,UACE,gCACE,wCACA,wBAAQC,QApBQ,WHqLG,IACzB9F,EAEO,IAAIqD,SAAQ,SAACC,EAASzB,GAC3B,OAAO0B,MAAMlE,EAAU,oBAAqB,CAC1CmE,OAAQ,OACR9B,UACAuB,KAAMC,KAAKC,UAAU,CAAEnD,KAAI,OAAEA,QAAF,IAAEA,IAAQ,OAEpCyD,MAAK,SAACC,GAAD,OAASA,EAAIC,UAClBF,MAAK,SAACG,GACDA,EAASC,YAAsC,MAAxBD,EAASC,YAClChC,EAAO+B,EAASE,SAElBR,EAAQ,CACNyC,MAAOnC,EAASmC,WAGnB/B,OAAM,SAACpC,GAAD,OAASD,EAAYC,EAAKC,SGtMrB4B,MAAK,SAACG,GAClBuB,EAAQzC,KAAR,iBAAuBkB,EAASmC,MAAMC,WAkBJC,UAAW,cAA3C,0BAIA,kCACE,gCACE,+BACE,sCACA,8CAIJ,kCACE,+BACE,wCACA,6BACE,cAAC,IAAD,CAAMC,GAAG,cAAcC,YAAU,YAAjC,6BAMHX,EAAMD,OAAOa,KAAI,SAACL,GACjB,OACE,+BACE,6BAAKA,EAAM/F,OACX,6BACE,cAAC,IAAD,CAAMkG,GAAE,iBAAYH,EAAMC,MAA1B,sBAHKD,EAAMC,eAWvB,cAAC,IAAD,CAAMC,UAAW,YAAaC,GAAG,IAAjC,6BAQFL,EAAaQ,IAAOC,IAAV,s/D,0BD3EJtB,K,kCAAAA,E,4BAAAA,E,oCAAAA,E,8BAAAA,E,kCAAAA,E,wCAAAA,E,gDAAAA,E,4BAAAA,E,wBAAAA,E,kCAAAA,E,4CAAAA,E,sBAAAA,E,YAAAA,E,gBAAAA,E,cAAAA,E,kBAAAA,E,aAAAA,M,cAwBAC,K,wCAAAA,E,0CAAAA,E,sBAAAA,E,4BAAAA,E,gCAAAA,E,aAAAA,M,KASL,IE/BKsB,EAwCAC,EFTCC,GAAsD,mBAChEnI,EAAYsB,KAAO,CAClBoF,EAAa0B,gBACb1B,EAAa2B,aACb3B,EAAa4B,iBACb5B,EAAa6B,cACb7B,EAAa8B,UACb9B,EAAa+B,qBACb/B,EAAagC,aACbhC,EAAaiC,WACbjC,EAAakC,MACblC,EAAamC,QACbnC,EAAaoC,KACbpC,EAAaqC,OACbrC,EAAasC,OAdkD,cAgBhEhJ,EAAYiJ,OAAS,CACpBvC,EAAawC,gBACbxC,EAAayC,mBACbzC,EAAa0C,uBACb1C,EAAa2C,gBACb3C,EAAagC,aACbhC,EAAakC,MACblC,EAAamC,QACbnC,EAAaoC,KACbpC,EAAaqC,OACbrC,EAAasC,OA1BkD,cA4BhEhJ,EAAY4I,MAAQ,CACnBlC,EAAagC,aACbhC,EAAakC,MACblC,EAAamC,QACbnC,EAAaoC,KACbpC,EAAaqC,OACbrC,EAAasC,OAlCkD,cAoChEhJ,EAAYsJ,iBAAmB,CAC9B5C,EAAagC,aACbhC,EAAakC,MACblC,EAAamC,QACbnC,EAAaoC,KACbpC,EAAaqC,OACbrC,EAAasC,OA1CkD,GAuDtDO,IAAiB,mBAC3B7C,EAAa0B,gBAAkB,CAC9B1G,KAAMgF,EAAa0B,gBACnBoB,UAAW,GACXvG,QAAS0D,EAAkB8C,mBAC3BC,eAAgB,KALU,cAO3BhD,EAAa2B,aAAe,CAC3B3G,KAAMgF,EAAa2B,aACnBmB,UAAW,GACXvG,QAAS0D,EAAkB8C,mBAC3BC,eAAgB,KAXU,cAa3BhD,EAAa4B,iBAAmB,CAC/B5G,KAAMgF,EAAa4B,iBACnBkB,UAAW,GACXvG,QAAS0D,EAAkB8C,mBAC3BC,eAAgB,KAjBU,cAmB3BhD,EAAa6B,cAAgB,CAC5B7G,KAAMgF,EAAa6B,cACnBiB,UAAW,GACXvG,QAAS0D,EAAkB8C,mBAC3BC,eAAgB,KAvBU,cAyB3BhD,EAAawC,gBAAkB,CAC9BxH,KAAMgF,EAAawC,gBACnBM,UAAW,GACXvG,QAAS0D,EAAkBgD,oBAC3BD,eAAgB,KA7BU,cA+B3BhD,EAAayC,mBAAqB,CACjCzH,KAAMgF,EAAayC,mBACnBK,UAAW,GACXvG,QAAS0D,EAAkBgD,oBAC3BD,eAAgB,KAnCU,cAqC3BhD,EAAa0C,uBAAyB,CACrC1H,KAAMgF,EAAa0C,uBACnBI,UAAW,GACXvG,QAAS0D,EAAkBgD,oBAC3BD,eAAgB,KAzCU,cA2C3BhD,EAAagC,aAAe,CAC3BhH,KAAMgF,EAAagC,aACnBc,UAAW,GACXvG,QAAS0D,EAAkBiD,UAC3BF,eAAgB,KA/CU,cAiD3BhD,EAAaiC,WAAa,CACzBjH,KAAMgF,EAAaiC,WACnBa,UAAW,GACXvG,QAAS0D,EAAkBiD,UAC3BF,eAAgB,KArDU,cAuD3BhD,EAAa2C,gBAAkB,CAC9B3H,KAAMgF,EAAa2C,gBACnBG,UAAW,GACXvG,QAAS0D,EAAkBiD,UAC3BF,eAAgB,KA3DU,cA6D3BhD,EAAa+B,qBAAuB,CACnC/G,KAAMgF,EAAa+B,qBACnBe,UAAW,GACXvG,QAAS0D,EAAkBiD,UAC3BF,eAAgB,KAjEU,cAmE3BhD,EAAa8B,UAAY,CACxB9G,KAAMgF,EAAa8B,UACnBgB,UAAW,GACXvG,QAAS0D,EAAkB8C,mBAC3BC,eAAgB,KAvEU,cAyE3BhD,EAAaoC,KAAO,CACnBpH,KAAMgF,EAAaoC,KACnBU,UAAW,GACXvG,QAAS0D,EAAkBkD,aAC3BH,eAAgB,KA7EU,cA+E3BhD,EAAaqC,OAAS,CACrBrH,KAAMgF,EAAaqC,OACnBS,UAAW,GACXvG,QAAS0D,EAAkBkD,aAC3BH,eAAgB,KAnFU,cAqF3BhD,EAAakC,MAAQ,CACpBlH,KAAMgF,EAAakC,MACnBY,UAAW,GACXvG,QAAS0D,EAAkBmD,eAC3BJ,eAAgB,KAzFU,cA2F3BhD,EAAamC,QAAU,CACtBnH,KAAMgF,EAAamC,QACnBW,UAAW,GACXvG,QAAS0D,EAAkBmD,eAC3BJ,eAAgB,KA/FU,cAiG3BhD,EAAasC,KAAO,CACnBtH,KAAMgF,EAAasC,KACnBQ,UAAW,EACXvG,QAAS0D,EAAkBqC,KAC3BU,eAAgB,MArGU,G,4BEtFlBzB,K,wBAAAA,E,oCAAAA,E,8BAAAA,E,0CAAAA,E,8CAAAA,E,gDAAAA,E,4BAAAA,E,8BAAAA,E,gCAAAA,E,oCAAAA,E,oCAAAA,E,4CAAAA,E,kDAAAA,E,4BAAAA,E,iCAAAA,M,cAwCAC,K,cAAAA,E,cAAAA,E,oBAAAA,E,cAAAA,E,cAAAA,E,qBAAAA,M,KC3CZ,ICmEI6B,GC7DQC,GFNRC,IAAU,EACDC,GACN,WACW,IAAD,EAATD,KACF,EAAAzG,SAAQkB,IAAR,oBAHOwF,GAMJ,WACS,IAAD,EAATD,KACF,EAAAzG,SAAQC,MAAR,oBAROyG,GAWL,WACU,IAAD,EAATD,KACF,EAAAzG,SAAQ2G,KAAR,oBAbOD,GAgBJ,WACS,IAAD,EAATD,KACF,EAAAzG,SAAQkB,IAAR,oBCkDO0F,GAAsB,CACjCC,QAAS,GACTC,YAAa,GACbzD,QAAS,CACP0D,SAAS,EACTC,SAAS,EACTxG,OAAQ,IAEVyD,MAAO,CACLC,KAAM,GACNhG,KAAM,GACN+I,SAAS,EACTC,sBAAsB,EACtBC,aAAa,EACbC,kBAAkB,EAClBC,kBAAkB,GAEpBC,GAAI,CACFC,oBAAqB,CACnBC,QAAQ,EACRC,mBAAe/H,EACfgI,iBAAiB,EACjBzI,MAAO,GACP0I,SAAU,GACVC,EAAG,GACHC,eAAgB,GAChBC,eAAgB,GAElBC,YAAa,CACXP,QAAQ,EACRQ,WAAOtI,GAETuI,aAAc,CACZT,QAAQ,EACRQ,WAAOtI,GAETwI,UAAW,EACXC,KAAM1L,EAAW2L,aACjBC,OAAQ,CACN,CACE1K,GAAIW,IAAgBC,eACpBE,KAAM,yBACNP,KAAM,eACNe,MAAO,OACPqJ,UAAW,GACX9J,SAAU,CACRxB,EAAG,EACHC,EAAG,EACHC,EAAG,KAGP,CACES,GAAIW,IAAgBC,eACpBE,KAAM,yBACNP,KAAM,eACNe,MAAO,OACPqJ,UAAW,GACX9J,SAAU,CACRxB,EAAG,EACHC,EAAG,EACHC,EAAG,MAITqL,KAAM,CACJ5K,GAAIW,IAAgBC,eACpBE,KAAM9B,EAAe6L,IACrBC,QAAS,GACTC,aAAa,EACbC,WAAW,EACXxJ,MAAO,GACPD,OAAQ,IAEV0J,4BAAwBlJ,EACxBmJ,aAAc,CACZC,SAAS,EACT7I,WAAOP,KAKAqJ,GAAoB,CAC/BlC,QAAS,GACTC,YAAa,GACbzD,QAAS,CACP0D,SAAS,EACTC,SAAS,EACTxG,OAAQ,IAEVyD,MAAO,CACLgD,SAAS,EACTC,sBAAsB,EACtBhD,KAAM,GACNiD,aAAa,EACbjJ,KAAM,MACNkJ,kBAAkB,EAClBC,kBAAkB,GAEpBC,GAAI0B,oBAAUpC,GAAaU,KAOhB2B,GAAW,WACtB,OAAO1C,IAGI2C,GAAW,SAACC,GACvBzC,GAAW,qBAAsByC,EAAUA,EAASrC,aACpDP,GAAQ4C,GAGNC,IAA0B,EAC1BC,IAAwB,EAEfC,GAAqB,WAChC,OAAOF,IAGIG,GAAqB,WAChC,OAAOF,I,mDCzLG7C,K,YAAAA,E,QAAAA,E,gCAAAA,E,cAAAA,E,4BAAAA,E,0BAAAA,E,oCAAAA,E,0CAAAA,E,4CAAAA,E,gDAAAA,E,mDAAAA,Q,KAcL,ICdKgD,GDcCC,GAA6B,SACxC9L,GAEI,IADJC,EACG,uDADgC4I,GAAoB3I,KAEvD,MAAM,GAAN,OAAUrB,EAAYkN,eAAtB,OAAsC7M,GAAtC,OAAuDc,GAAvD,OAA4Dd,GAA5D,OAA6Ee,K,SClBnE4L,K,YAAAA,E,QAAAA,E,oBAAAA,Q,KAML,ICNKG,GDMCC,GAA0B,SACrCjM,GAEI,IADJC,EACG,uDAD6B4L,GAAiB3L,KAEjD,MAAM,GAAN,OAAUrB,EAAY4I,OAAtB,OAA8BvI,GAA9B,OAA+Cc,GAA/C,OAAoDd,GAApD,OAAqEe,IAa1DiM,GAA4B,SACvCC,EACAlM,GAEA,OAAOK,gBAAM,GAAI6L,EAAO,CACtB5L,KAAM0L,GAAwBE,EAAMnM,GAAIC,MAI/BmM,GAAa,SAAC3L,GACzB,IAAMC,EAAkB,CACtBV,GAAIW,IAAgBC,eACpBC,SAAUzB,EAAW,EAAG,GACxB8B,QAAS,GACTC,QAAS,EACTC,QAAS,EACTG,OAAQ,GACRC,MAAO,GACPC,MAAO,GACPE,iBAAiB,EACjBC,UAAU,EACVC,WAAYhD,EAAY4I,MACxB4E,YAAa,IAGf,OAAO/L,gBAAMI,EAAUD,K,SChDbuL,K,YAAAA,E,QAAAA,E,+BAAAA,Q,KAML,ICAKM,GDACC,GAAqC,SAChDvM,GAEI,IADJC,EACG,uDADwC+L,GAA4B9L,KAEvE,MAAM,GAAN,OAAUrB,EAAYsJ,kBAAtB,OAAyCjJ,GAAzC,OAA0Dc,GAA1D,OAA+Dd,GAA/D,OAAgFe,IAarEuM,GAAuC,SAClDC,EACAxM,GAEA,OAAOK,gBAAM,GAAImM,EAAK,CACpBlM,KAAMgM,GAAmCE,EAAIzM,GAAIC,O,SCtBzCqM,K,YAAAA,E,QAAAA,E,wBAAAA,E,qBAAAA,E,mBAAAA,Q,KAQL,IC2BHI,GASQC,GDpCCC,GAA2B,SACtC5M,GAEI,IADJC,EACG,uDAD8BqM,GAAkBpM,KAEnD,MAAM,GAAN,OAAUrB,EAAYiJ,QAAtB,OAA+B5I,GAA/B,OAAgDc,GAAhD,OAAqDd,GAArD,OAAsEe,IAa3D4M,GAA6B,SACxCC,EACA7M,GAEA,OAAOK,gBAAM,GAAIwM,EAAQ,CACvBvM,KAAMqM,GAAyBE,EAAO9M,GAAIC,MAIjC8M,GAA+B,SAACC,GAC3C,MAAO,CACLC,QAASD,EACTE,KAAMF,IAsCGG,GAAqB,SAACL,EAAgBM,GACjD,GAAIN,EAAOO,QAAUzO,EAAY0O,UAAW,CAC1C,IAAMC,EAAUT,EAAOI,KAAOJ,EAAOG,QACrC,GAAIG,GAAS,GAAKA,EAAQG,EAAS,CAEjC,GADsBT,EAAOU,WAAa7O,EAAe8O,OACtC,CACjB,IAEMC,EAFMC,KAAKC,MAAMR,EAAQN,EAAOG,SAEjB,IAAM,EACrBY,EAFSF,KAAKC,MAAMR,EAAQN,EAAOG,WAENH,EAAOG,QAAU,EACpD,UAAgB,IAAXS,GAAmBG,IAA+B,IAAXH,GAM5C,OAAO,EAGT,OAAO,EAEJ,GAAIZ,EAAOO,QAAUzO,EAAYkP,SAAU,CAChD,IADgD,EAvDjB,SACjChB,EACAiB,EACAC,GAKA,IAAMC,EAAMnB,EAAOI,KAAOa,EAAO,EACjC,GAAIE,GAAOnB,EAAOI,MAAQc,EAAS,GAAKA,GAAUlB,EAAOG,QACvD,MAAO,CAAEiB,UAAU,EAAOC,gBAAiB,GAE7C,IAAMC,EAAMtB,EAAOG,QAAU,IAAM,EAAI,EAAI,EACrCoB,EAAQV,KAAKW,IAAI,EAAGL,IAAQnB,EAAOI,KAAO,GAC5CqB,EACFH,EACAT,KAAKS,IAAIT,KAAKC,OAAOd,EAAOG,QAAUmB,GAAOC,GAAQvB,EAAOG,QAAUmB,GACpEtB,EAAOG,QAAU,GAAKsB,EAAkB,GAC1CA,IAEF,IAAMC,EAAa1B,EAAOG,QAAUsB,EAC9BE,EAAkBd,KAAKC,MAAMY,EAAa,GAC1CE,EAAgBH,EAAkBE,EAGpCP,GAAoB,EAMxB,OALIF,EAASS,GAEFT,GAAUU,KADnBR,GAAW,GAIN,CAAEA,WAAUC,gBARKO,GAmCgBC,CACpC7B,EAHUa,KAAKC,MAAMR,EAAQN,EAAOG,SACvBU,KAAKC,MAAMR,EAAQN,EAAOG,UACjCiB,EAHwC,EAGxCA,SAAUC,EAH8B,EAG9BA,gBAKlB,IAAiB,IAAbD,EAAmB,CAErB,GADsBpB,EAAOU,WAAa7O,EAAe8O,OACtC,CACjB,IAAMQ,EAAMN,KAAKC,MAAMR,EAAQN,EAAOG,SAChCe,EAASL,KAAKC,MAAMR,EAAQN,EAAOG,SACnCS,EAASO,EAAM,IAAM,EAE3B,UAAgB,IAAXP,GADmBM,IAAWG,EAAkB,IACE,IAAXT,GAM5C,OAAO,EAGT,OAAO,EAIT,OADArL,QAAQC,MAAM,2BAA4BwK,EAAOO,QAC1C,GAIEuB,GAAc,SAACnO,GAC1B,IAAMC,EAAmB,CACvBV,GAAIW,IAAgBC,eACpBC,SAAUzB,EAAW,EAAG,GACxBoO,SAAU7O,EAAekQ,WACzBxB,MAAOzO,EAAY0O,UACnB/L,OAAQ,GACRC,MAAO,GACPsN,QAAS,GACTC,QAAS,GACT9B,QAAS,EACTC,KAAM,EACN8B,eAAe,EACfC,iBAAiB,EACjBtN,iBAAiB,EACjBC,UAAU,EACVC,WAAYhD,EAAYiJ,OACxBoH,gBAAiB,GACjBzN,MAAO,EACPP,QAAS,EACTC,QAAS,EACTC,QAAS,GAEL+N,EAAY7O,gBAAMI,EAAUD,GAC5B2O,EAAOD,EAAUjC,KAAOiC,EAAUlC,QAClCoC,EAAqBC,MAAMF,GAAMG,UAAKxN,GAG5C,OAFAoN,EAAUD,gBAAkB5O,gBAAM+O,EAAoB5O,EAAMyO,iBAErDC,GElKIK,GAA6B,SACxCC,EACA5N,GAEA,IAAItB,OAA2BwB,EAc/B,GAZIF,IAAehD,EAAYsB,KAC7BI,EAAOR,EAAuB0P,GACrB5N,IAAehD,EAAYiJ,OACpCvH,EAAOqM,GAAyB6C,GACvB5N,IAAehD,EAAY4I,MACpClH,EAAO0L,GAAwBwD,GACtB5N,IAAehD,EAAYsJ,iBACpC5H,EAAOgM,GAAmCkD,GACjC5N,IAAehD,EAAYkN,gBACpCxL,EAAOuL,GAA2B2D,SAGvB1N,IAATxB,EAIJ,OAAOA,EAHL8B,QAAQ2G,KAAK,uBAAwByG,I,GDzBZpN,QAArBkB,G,GAAAA,IAAKyF,G,GAAAA,KAAM1G,G,GAAAA,MAMNoN,GAAb,WAEE,aAAe,0BADfC,aACc,EACZ9K,KAAK8K,QAAU,GAHnB,uCAME,SAAGpP,EAAcqP,GACV/K,KAAK8K,QAAQpP,KAChBsE,KAAK8K,QAAQpP,GAAQ,IAGvBsE,KAAK8K,QAAQpP,GAAM0C,KAAK2M,KAX5B,4BAcE,SAAerP,EAAcsP,GAC3B,GAAKhL,KAAK8K,QAAQpP,GAAlB,CAOAsE,KAAK8K,QAAQpP,GAAQsE,KAAK8K,QAAQpP,GAAMuP,QAFhB,SAACF,GAAD,OAAcA,IAAaC,UAJjDvN,GAAM,oCAAD,OAAoC/B,EAApC,wBAhBX,kBAyBE,SAAKA,EAAc2F,EAAWH,GAG5B,GAFAxC,GAAI,qBAAsBhD,EAAM2F,GAE3BrB,KAAK8K,QAAQpP,GAAlB,CASAsE,KAAK8K,QAAQpP,GAAMwC,SAJG,SAACgN,GACrBA,EAAS7J,EAAMH,WALfiD,GAAK,gCAAD,OAAgCzI,EAAhC,0BA7BV,M,SAkDYoM,K,sCAAAA,E,oEAAAA,E,sEAAAA,E,oEAAAA,E,oEAAAA,E,kEAAAA,E,sEAAAA,E,wCAAAA,E,wCAAAA,E,8CAAAA,E,wCAAAA,E,gDAAAA,E,8BAAAA,E,4CAAAA,E,4EAAAA,E,0CAAAA,E,gEAAAA,E,sDAAAA,E,wDAAAA,E,oCAAAA,E,4CAAAA,E,8DAAAA,E,gDAAAA,E,8CAAAA,E,wCAAAA,E,4DAAAA,E,oDAAAA,E,8DAAAA,E,6CAAAA,Q,sCExCXqD,GAaGrP,IAZHsP,GAYGtP,IAXHuP,GAWGvP,IAVH8G,GAUG9G,IATHwP,GASGxP,IARHyP,GAQGzP,IAPH0P,GAOG1P,IANH2P,GAMG3P,IALH4P,GAKG5P,IAJH6P,GAIG7P,IAHH8P,GAGG9P,IAFH+P,GAEG/P,IADHgQ,GACGhQ,IAEAiQ,GAAc,WAGjB,IAAIC,EAAiB,gBAEjBC,EAA2B,WAE3BC,EAAuB,WAEvBC,EAAkB,WAElBC,EAAK,IAAIN,GACTO,EAAK,IAAIP,GACTQ,EAAK,IAAIR,GAETS,EAAK,IAAIT,GACTU,EAAK,IAAIV,GAEb,SAASW,IAER,IAAIvL,EAAQ,CACXmD,QAAS,GACTqI,OAAQ,GAERC,SAAU,GACVC,QAAS,GACTC,OAAQ,GACRC,IAAK,GAELC,UAAW,GACXC,kBAAmB,GAEnBC,YAAa,SAAWvR,EAAMwR,GAI7B,GAAKlN,KAAK0M,SAA0C,IAAhC1M,KAAK0M,OAAOQ,gBAI/B,OAFAlN,KAAK0M,OAAOhR,KAAOA,OACnBsE,KAAK0M,OAAOQ,iBAAwC,IAApBA,GAKjC,IAAIC,EAAqBnN,KAAK0M,QAAiD,oBAAhC1M,KAAK0M,OAAOU,gBAAiCpN,KAAK0M,OAAOU,uBAAoBlQ,EA+H5H,GA7HK8C,KAAK0M,QAA2C,oBAA1B1M,KAAK0M,OAAOW,WAEtCrN,KAAK0M,OAAOW,WAAW,GAIxBrN,KAAK0M,OAAS,CACbhR,KAAMA,GAAQ,GACdwR,iBAAuC,IAApBA,EAEnBI,SAAU,CACTX,SAAU,GACVC,QAAS,GACTC,OAAQ,GACRC,IAAK,GACLS,cAAc,GAEfR,UAAW,GACXS,QAAQ,EAERC,cAAe,SAAW/R,EAAMgS,GAE/B,IAAIC,EAAW3N,KAAKqN,WAAW,GAI1BM,IAAcA,EAASC,WAAaD,EAASE,YAAc,IAE/D7N,KAAK+M,UAAUe,OAAQH,EAASpF,MAAO,GAIxC,IAAIpM,EAAW,CACdoM,MAAOvI,KAAK+M,UAAU9O,OACtBvC,KAAMA,GAAQ,GACdqS,OAAUtD,MAAMuD,QAASN,IAAeA,EAAUzP,OAAS,EAAIyP,EAAWA,EAAUzP,OAAS,GAAM,GACnGuP,YAAuBtQ,IAAbyQ,EAAyBA,EAASH,OAASxN,KAAKwN,OAC1DS,gBAA2B/Q,IAAbyQ,EAAyBA,EAASO,SAAW,EAC3DA,UAAY,EACZL,YAAc,EACdD,WAAW,EAEXO,MAAO,SAAW5F,GAEjB,IAAI6F,EAAS,CACZ7F,MAA0B,kBAAVA,EAAqBA,EAAQvI,KAAKuI,MAClD7M,KAAMsE,KAAKtE,KACXqS,OAAQ/N,KAAK+N,OACbP,OAAQxN,KAAKwN,OACbS,WAAY,EACZC,UAAY,EACZL,YAAc,EACdD,WAAW,GAGZ,OADAQ,EAAOD,MAAQnO,KAAKmO,MAAME,KAAMD,GACzBA,IAOT,OAFApO,KAAK+M,UAAU3O,KAAMjC,GAEdA,GAIRiR,gBAAiB,WAEhB,GAAKpN,KAAK+M,UAAU9O,OAAS,EAE5B,OAAO+B,KAAK+M,UAAW/M,KAAK+M,UAAU9O,OAAS,IAQjDoP,UAAW,SAAWiB,GAErB,IAAIC,EAAoBvO,KAAKoN,kBAU7B,GATKmB,IAAsD,IAAjCA,EAAkBL,WAE3CK,EAAkBL,SAAWlO,KAAKsN,SAASX,SAAS1O,OAAS,EAC7DsQ,EAAkBV,WAAaU,EAAkBL,SAAWK,EAAkBN,WAC9EM,EAAkBX,WAAY,GAK1BU,GAAOtO,KAAK+M,UAAU9O,OAAS,EAEnC,IAAM,IAAIuQ,EAAKxO,KAAK+M,UAAU9O,OAAS,EAAGuQ,GAAM,EAAGA,IAE7CxO,KAAK+M,UAAWyB,GAAKX,YAAc,GAEvC7N,KAAK+M,UAAUe,OAAQU,EAAI,GAkB9B,OATKF,GAAiC,IAA1BtO,KAAK+M,UAAU9O,QAE1B+B,KAAK+M,UAAU3O,KAAM,CACpB1C,KAAM,GACN8R,OAAQxN,KAAKwN,SAKRe,IAWJpB,GAAoBA,EAAiBzR,MAA0C,oBAA3ByR,EAAiBgB,MAAuB,CAEhG,IAAIM,EAAWtB,EAAiBgB,MAAO,GACvCM,EAASb,WAAY,EACrB5N,KAAK0M,OAAOK,UAAU3O,KAAMqQ,GAI7BzO,KAAKqE,QAAQjG,KAAM4B,KAAK0M,SAIzBgC,SAAU,WAEJ1O,KAAK0M,QAA2C,oBAA1B1M,KAAK0M,OAAOW,WAEtCrN,KAAK0M,OAAOW,WAAW,IAMzBsB,iBAAkB,SAAWC,EAAOC,GAEnC,IAAItG,EAAQuG,SAAUF,EAAO,IAC7B,OAAsD,GAA7CrG,GAAS,EAAIA,EAAQ,EAAIA,EAAQsG,EAAM,IAIjDE,iBAAkB,SAAWH,EAAOC,GAEnC,IAAItG,EAAQuG,SAAUF,EAAO,IAC7B,OAAsD,GAA7CrG,GAAS,EAAIA,EAAQ,EAAIA,EAAQsG,EAAM,IAIjDG,aAAc,SAAWJ,EAAOC,GAE/B,IAAItG,EAAQuG,SAAUF,EAAO,IAC7B,OAAsD,GAA7CrG,GAAS,EAAIA,EAAQ,EAAIA,EAAQsG,EAAM,IAIjDI,UAAW,SAAWC,EAAGC,EAAGC,GAE3B,IAAIC,EAAMrP,KAAK2M,SACX2C,EAAMtP,KAAK0M,OAAOY,SAASX,SAE/B2C,EAAIlR,KAAMiR,EAAKH,EAAI,GAAKG,EAAKH,EAAI,GAAKG,EAAKH,EAAI,IAC/CI,EAAIlR,KAAMiR,EAAKF,EAAI,GAAKE,EAAKF,EAAI,GAAKE,EAAKF,EAAI,IAC/CG,EAAIlR,KAAMiR,EAAKD,EAAI,GAAKC,EAAKD,EAAI,GAAKC,EAAKD,EAAI,KAIhDG,eAAgB,SAAWL,GAE1B,IAAIG,EAAMrP,KAAK2M,SACL3M,KAAK0M,OAAOY,SAASX,SAE3BvO,KAAMiR,EAAKH,EAAI,GAAKG,EAAKH,EAAI,GAAKG,EAAKH,EAAI,KAIhDM,cAAe,SAAWN,GAEzB,IAAIG,EAAMrP,KAAK2M,SACL3M,KAAK0M,OAAOY,SAASX,SAE3BvO,KAAMiR,EAAKH,EAAI,GAAKG,EAAKH,EAAI,GAAKG,EAAKH,EAAI,KAIhDO,UAAW,SAAWP,EAAGC,EAAGC,GAE3B,IAAIC,EAAMrP,KAAK4M,QACX0C,EAAMtP,KAAK0M,OAAOY,SAASV,QAE/B0C,EAAIlR,KAAMiR,EAAKH,EAAI,GAAKG,EAAKH,EAAI,GAAKG,EAAKH,EAAI,IAC/CI,EAAIlR,KAAMiR,EAAKF,EAAI,GAAKE,EAAKF,EAAI,GAAKE,EAAKF,EAAI,IAC/CG,EAAIlR,KAAMiR,EAAKD,EAAI,GAAKC,EAAKD,EAAI,GAAKC,EAAKD,EAAI,KAIhDM,cAAe,SAAWR,EAAGC,EAAGC,GAE/B,IAAIC,EAAMrP,KAAK2M,SACX2C,EAAMtP,KAAK0M,OAAOY,SAASV,QAE/BR,EAAGuD,UAAWN,EAAKH,GACnB7C,EAAGsD,UAAWN,EAAKF,GACnB7C,EAAGqD,UAAWN,EAAKD,GAEnB5C,EAAGoD,WAAYtD,EAAID,GACnBE,EAAGqD,WAAYxD,EAAIC,GACnBG,EAAGqD,MAAOtD,GAEVC,EAAGsD,YAEHR,EAAIlR,KAAMoO,EAAGhS,EAAGgS,EAAG/R,EAAG+R,EAAG9R,GACzB4U,EAAIlR,KAAMoO,EAAGhS,EAAGgS,EAAG/R,EAAG+R,EAAG9R,GACzB4U,EAAIlR,KAAMoO,EAAGhS,EAAGgS,EAAG/R,EAAG+R,EAAG9R,IAI1BqV,SAAU,SAAWb,EAAGC,EAAGC,GAE1B,IAAIC,EAAMrP,KAAK6M,OACXyC,EAAMtP,KAAK0M,OAAOY,SAAST,YAEb3P,IAAbmS,EAAKH,IAAoBI,EAAIlR,KAAMiR,EAAKH,EAAI,GAAKG,EAAKH,EAAI,GAAKG,EAAKH,EAAI,SAC3DhS,IAAbmS,EAAKF,IAAoBG,EAAIlR,KAAMiR,EAAKF,EAAI,GAAKE,EAAKF,EAAI,GAAKE,EAAKF,EAAI,SAC3DjS,IAAbmS,EAAKD,IAAoBE,EAAIlR,KAAMiR,EAAKD,EAAI,GAAKC,EAAKD,EAAI,GAAKC,EAAKD,EAAI,KAI9EY,MAAO,SAAWd,EAAGC,EAAGC,GAEvB,IAAIC,EAAMrP,KAAK8M,IACXwC,EAAMtP,KAAK0M,OAAOY,SAASR,IAE/BwC,EAAIlR,KAAMiR,EAAKH,EAAI,GAAKG,EAAKH,EAAI,IACjCI,EAAIlR,KAAMiR,EAAKF,EAAI,GAAKE,EAAKF,EAAI,IACjCG,EAAIlR,KAAMiR,EAAKD,EAAI,GAAKC,EAAKD,EAAI,KAIlCa,aAAc,WAEb,IAAIX,EAAMtP,KAAK0M,OAAOY,SAASR,IAE/BwC,EAAIlR,KAAM,EAAG,GACbkR,EAAIlR,KAAM,EAAG,GACbkR,EAAIlR,KAAM,EAAG,IAId8R,UAAW,SAAWhB,GAErB,IAAIG,EAAMrP,KAAK8M,IACL9M,KAAK0M,OAAOY,SAASR,IAE3B1O,KAAMiR,EAAKH,EAAI,GAAKG,EAAKH,EAAI,KAIlCiB,QAAS,SAAWjB,EAAGC,EAAGC,EAAGgB,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GAEhD,IAAIC,EAAO1Q,KAAK2M,SAAS1O,OAErB0S,EAAK3Q,KAAK2O,iBAAkBO,EAAGwB,GAC/BE,EAAK5Q,KAAK2O,iBAAkBQ,EAAGuB,GAC/BG,EAAK7Q,KAAK2O,iBAAkBS,EAAGsB,GAOnC,GALA1Q,KAAKiP,UAAW0B,EAAIC,EAAIC,GACxB7Q,KAAK+P,SAAUY,EAAIC,EAAIC,QAIX3T,IAAPqT,GAA2B,KAAPA,EAAY,CAEpC,IAAIO,EAAO9Q,KAAK4M,QAAQ3O,OAExB0S,EAAK3Q,KAAK+O,iBAAkBwB,EAAIO,GAChCF,EAAK5Q,KAAK+O,iBAAkByB,EAAIM,GAChCD,EAAK7Q,KAAK+O,iBAAkB0B,EAAIK,GAEhC9Q,KAAKyP,UAAWkB,EAAIC,EAAIC,QAIxB7Q,KAAK0P,cAAeiB,EAAIC,EAAIC,GAM7B,QAAY3T,IAAPkT,GAA2B,KAAPA,EAAY,CAEpC,IAAIW,EAAQ/Q,KAAK8M,IAAI7O,OAErB0S,EAAK3Q,KAAKgP,aAAcoB,EAAIW,GAC5BH,EAAK5Q,KAAKgP,aAAcqB,EAAIU,GAC5BF,EAAK7Q,KAAKgP,aAAcsB,EAAIS,GAE5B/Q,KAAKgQ,MAAOW,EAAIC,EAAIC,GAEpB7Q,KAAK0M,OAAOY,SAASC,cAAe,OAMpCvN,KAAKiQ,gBAMPe,iBAAkB,SAAWrE,GAE5B3M,KAAK0M,OAAOY,SAASrR,KAAO,SAI5B,IAFA,IAAIyU,EAAO1Q,KAAK2M,SAAS1O,OAEfgT,EAAK,EAAGC,EAAIvE,EAAS1O,OAAQgT,EAAKC,EAAGD,IAAQ,CAEtD,IAAI1I,EAAQvI,KAAK2O,iBAAkBhC,EAAUsE,GAAMP,GAEnD1Q,KAAKuP,eAAgBhH,GACrBvI,KAAK+P,SAAUxH,KAMjB4I,gBAAiB,SAAWxE,EAAUG,GAErC9M,KAAK0M,OAAOY,SAASrR,KAAO,OAK5B,IAHA,IAAIyU,EAAO1Q,KAAK2M,SAAS1O,OACrB8S,EAAQ/Q,KAAK8M,IAAI7O,OAEXgT,EAAK,EAAGC,EAAIvE,EAAS1O,OAAQgT,EAAKC,EAAGD,IAE9CjR,KAAKwP,cAAexP,KAAK2O,iBAAkBhC,EAAUsE,GAAMP,IAItD,IAAIU,EAAM,EAAhB,IAAmBF,EAAIpE,EAAI7O,OAAQmT,EAAMF,EAAGE,IAE3CpR,KAAKkQ,UAAWlQ,KAAKgP,aAAclC,EAAKsE,GAAOL,MAUlD,OAFA7P,EAAM+L,YAAa,IAAI,GAEhB/L,EAMR,SAAS6K,EAAWsF,GAEnB7F,GAAO8F,KAAMtR,KAAMqR,GAEnBrR,KAAK+M,UAAY,KA4dlB,OAxdAhB,EAAUnM,UAAY2R,OAAOC,OAAQD,OAAOE,OAAQjG,GAAO5L,WAAa,CAEvE8R,YAAa3F,EAEb4F,KAAM,SAAWC,EAAKC,EAAQC,EAAYC,GAEzC,IAAIC,EAAQhS,KAERiS,EAAS,IAAI7G,GAAYpL,KAAKqR,SAClCY,EAAOC,QAASlS,KAAKmS,MACrBF,EAAOG,iBAAkBpS,KAAKqS,eAC9BJ,EAAOK,mBAAoBtS,KAAKuS,iBAChCN,EAAON,KAAMC,GAAK,SAAWY,GAE5B,IAECX,EAAQG,EAAMS,MAAOD,IAEpB,MAAQE,GAEJX,EAEJA,EAASW,GAITlV,QAAQC,MAAOiV,GAIhBV,EAAMX,QAAQsB,UAAWf,MAIxBE,EAAYC,IAIhBa,aAAc,SAAW7F,GAIxB,OAFA/M,KAAK+M,UAAYA,EAEV/M,MAIRyS,MAAO,SAAWD,GAEjB,IAAItR,EAAQ,IAAIuL,GAEkB,IAA7B+F,EAAKK,QAAS,UAGlBL,EAAOA,EAAKM,QAAS,QAAS,QAIG,IAA7BN,EAAKK,QAAS,UAGlBL,EAAOA,EAAKM,QAAS,QAAS,KAY/B,IARA,IAAIC,EAAQP,EAAKQ,MAAO,MACpBC,EAAO,GAAIC,EAAgB,GAE3BC,EAAS,GAGTC,EAAoC,mBAAhB,GAAGA,SAEjBC,EAAI,EAAGnC,EAAI6B,EAAM9U,OAAQoV,EAAInC,EAAGmC,IAQzC,GANAJ,EAAOF,EAAOM,GAMM,KAJpBJ,EAAOG,EAAWH,EAAKG,WAAaH,EAAKK,QAEvBrV,QAOK,OAHvBiV,EAAgBD,EAAKM,OAAQ,IAK7B,GAAuB,MAAlBL,EAAwB,CAE5B,IAAI7R,EAAO4R,EAAKD,MAAO,OAEvB,OAAS3R,EAAM,IAEd,IAAK,IACJH,EAAMyL,SAASvO,KACdoV,WAAYnS,EAAM,IAClBmS,WAAYnS,EAAM,IAClBmS,WAAYnS,EAAM,KAEdA,EAAKpD,QAAU,EAEnBiD,EAAM2L,OAAOzO,KACZoV,WAAYnS,EAAM,IAClBmS,WAAYnS,EAAM,IAClBmS,WAAYnS,EAAM,KAQnBH,EAAM2L,OAAOzO,UAAMlB,OAAWA,OAAWA,GAI1C,MACD,IAAK,KACJgE,EAAM0L,QAAQxO,KACboV,WAAYnS,EAAM,IAClBmS,WAAYnS,EAAM,IAClBmS,WAAYnS,EAAM,KAEnB,MACD,IAAK,KACJH,EAAM4L,IAAI1O,KACToV,WAAYnS,EAAM,IAClBmS,WAAYnS,EAAM,WAMf,GAAuB,MAAlB6R,EAAwB,CAQnC,IANA,IACIO,EADWR,EAAKS,OAAQ,GAAIJ,OACNN,MAAO,OAC7BW,EAAe,GAITC,EAAI,EAAGC,EAAKJ,EAAWxV,OAAQ2V,EAAIC,EAAID,IAAO,CAEvD,IAAIE,EAASL,EAAYG,GAEzB,GAAKE,EAAO7V,OAAS,EAAI,CAExB,IAAI8V,EAAcD,EAAOd,MAAO,KAChCW,EAAavV,KAAM2V,IAQrB,IAAIC,EAAKL,EAAc,GAEvB,IAAUC,EAAI,EAAGC,EAAKF,EAAa1V,OAAS,EAAG2V,EAAIC,EAAID,IAAO,CAE7D,IAAIK,EAAKN,EAAcC,GACnBM,EAAKP,EAAcC,EAAI,GAE3B1S,EAAMiP,QACL6D,EAAI,GAAKC,EAAI,GAAKC,EAAI,GACtBF,EAAI,GAAKC,EAAI,GAAKC,EAAI,GACtBF,EAAI,GAAKC,EAAI,GAAKC,EAAI,UAKlB,GAAuB,MAAlBhB,EAAwB,CAEnC,IAAIiB,EAAYlB,EAAKmB,UAAW,GAAId,OAAON,MAAO,KAC9CqB,EAAe,GAAIC,EAAU,GAEjC,IAA+B,IAA1BrB,EAAKJ,QAAS,KAElBwB,EAAeF,OAIf,IAAM,IAAII,EAAK,EAAGC,EAAOL,EAAUlW,OAAQsW,EAAKC,EAAMD,IAAQ,CAE7D,IAAIE,EAAQN,EAAWI,GAAKvB,MAAO,KAEf,KAAfyB,EAAO,IAAaJ,EAAajW,KAAMqW,EAAO,IAC/B,KAAfA,EAAO,IAAaH,EAAQlW,KAAMqW,EAAO,IAMhDvT,EAAMiQ,gBAAiBkD,EAAcC,QAE/B,GAAuB,MAAlBpB,EAAwB,CAEnC,IACIwB,EADWzB,EAAKS,OAAQ,GAAIJ,OACPN,MAAO,KAEhC9R,EAAM8P,iBAAkB0D,QAElB,GAAkD,QAA3CvB,EAASnH,EAAe2I,KAAM1B,IAAoB,CAQ/D,IAAIvX,GAAS,IAAMyX,EAAQ,GAAIO,OAAQ,GAAIJ,QAASI,OAAQ,GAE5DxS,EAAM+L,YAAavR,QAEb,GAAKwQ,EAAqB0I,KAAM3B,GAItC/R,EAAMwL,OAAOe,cAAewF,EAAKmB,UAAW,GAAId,OAAQpS,EAAM8L,wBAExD,GAAKf,EAAyB2I,KAAM3B,GAI1C/R,EAAM8L,kBAAkB5O,KAAM6U,EAAKmB,UAAW,GAAId,aAE5C,GAAKnH,EAAgByI,KAAM3B,GAKjCzV,QAAQ2G,KAAM,6GAER,GAAuB,MAAlB+O,EAAwB,CAwBnC,IAtBAC,EAASF,EAAKD,MAAO,MAsBT/U,OAAS,EAAI,CAExB,IAAI2Q,EAAQuE,EAAQ,GAAIG,OAAOuB,cAC/B3T,EAAMwL,OAAOc,OAAqB,MAAVoB,GAA2B,QAAVA,OAKzC1N,EAAMwL,OAAOc,QAAS,GAInBrR,EAAW+E,EAAMwL,OAAOU,qBACZjR,EAASqR,OAAStM,EAAMwL,OAAOc,YAEzC,CAGN,GAAc,OAATyF,EAAgB,SAErBzV,QAAQ2G,KAAM,sCAAwC8O,EAAO,KAM/D/R,EAAMwN,WAEN,IAAIoG,EAAY,IAAIlS,GAKpB,GAJAkS,EAAU9H,kBAAoB,GAAG+H,OAAQ7T,EAAM8L,oBAIxB,MAF0B,IAAzB9L,EAAMmD,QAAQpG,QAAgE,IAAhDiD,EAAMmD,QAAS,GAAIiJ,SAASX,SAAS1O,QAI1F,IAAUoV,EAAI,EAAGnC,EAAIhQ,EAAMmD,QAAQpG,OAAQoV,EAAInC,EAAGmC,IAAO,CAExD,IAAI3G,EAASxL,EAAMmD,QAASgP,GACxB/F,EAAWZ,EAAOY,SAClBP,EAAYL,EAAOK,UACnBiI,EAA6B,SAAlB1H,EAASrR,KACpBgZ,EAA+B,WAAlB3H,EAASrR,KACtBiZ,GAAkB,EAGtB,GAAkC,IAA7B5H,EAASX,SAAS1O,OAAvB,EAEIkX,EAAiB,IAAIhK,IAEViK,aAAc,WAAY,IAAI/J,GAAwBiC,EAASX,SAAU,IAEnFW,EAASV,QAAQ3O,OAAS,GAE9BkX,EAAeC,aAAc,SAAU,IAAI/J,GAAwBiC,EAASV,QAAS,IAIjFU,EAAST,OAAO5O,OAAS,IAE7BiX,GAAkB,EAClBC,EAAeC,aAAc,QAAS,IAAI/J,GAAwBiC,EAAST,OAAQ,MAIrD,IAA1BS,EAASC,cAEb4H,EAAeC,aAAc,KAAM,IAAI/J,GAAwBiC,EAASR,IAAK,IAQ9E,IAFA,IA8DIuI,EA9DAC,EAAmB,GAEb9G,EAAK,EAAG+G,EAAQxI,EAAU9O,OAAQuQ,EAAK+G,EAAO/G,IAAQ,CAE/D,IACIgH,GADAC,EAAiB1I,EAAWyB,IACE9S,KAAO,IAAM+Z,EAAejI,OAAS,IAAM0H,EACzE/Y,EAAW+E,EAAM6L,UAAWyI,GAEhC,GAAwB,OAAnBxV,KAAK+M,UAKT,GAHA5Q,EAAW6D,KAAK+M,UAAU0E,OAAQgE,EAAe/Z,OAG5CsZ,IAAU7Y,GAAgBA,aAAoBmP,IAO5C,GAAK2J,GAAY9Y,KAAgBA,aAAoB0P,IAAmB,CAE9E,IAAI6J,EAAiB,IAAI7J,GAAgB,CAAEtB,KAAM,GAAIoL,iBAAiB,IACtElK,GAAS7L,UAAUgW,KAAKtE,KAAMoE,EAAgBvZ,GAC9CuZ,EAAejZ,MAAMmZ,KAAMzZ,EAASM,OACpCiZ,EAAe5T,IAAM3F,EAAS2F,IAC9B3F,EAAWuZ,OAb6D,CAExE,IAAIG,EAAe,IAAIvK,GACvBG,GAAS7L,UAAUgW,KAAKtE,KAAMuE,EAAc1Z,GAC5C0Z,EAAapZ,MAAMmZ,KAAMzZ,EAASM,OAClCN,EAAW0Z,OAcK3Y,IAAbf,KAIHA,EAFI6Y,EAEO,IAAI1J,GAEJ2J,EAEA,IAAIpJ,GAAgB,CAAEtB,KAAM,EAAGoL,iBAAiB,IAIhD,IAAIhK,IAIPjQ,KAAO+Z,EAAe/Z,KAC/BS,EAAS2Z,aAAcL,EAAejI,OACtCrR,EAAS4Z,aAAeb,EAExBhU,EAAM6L,UAAWyI,GAAiBrZ,GAInCmZ,EAAiBlX,KAAMjC,GAQxB,GAAKmZ,EAAiBrX,OAAS,EAAI,CAElC,IAAUuQ,EAAK,EAAG+G,EAAQxI,EAAU9O,OAAQuQ,EAAK+G,EAAO/G,IAAQ,CAE/D,IAAIiH,EAAiB1I,EAAWyB,GAChC2G,EAAea,SAAUP,EAAexH,WAAYwH,EAAe5H,WAAYW,GAM/E6G,EAFIL,EAEG,IAAIzJ,GAAc4J,EAAgBG,GAE9BL,EAEJ,IAAIrJ,GAAQuJ,EAAgBG,GAI5B,IAAI5J,GAAMyJ,EAAgBG,QAQjCD,EAFIL,EAEG,IAAIzJ,GAAc4J,EAAgBG,EAAkB,IAEhDL,EAEJ,IAAIrJ,GAAQuJ,EAAgBG,EAAkB,IAI9C,IAAI5J,GAAMyJ,EAAgBG,EAAkB,IAMrDD,EAAK3Z,KAAOgR,EAAOhR,KAEnBoZ,EAAUmB,IAAKZ,SAQhB,GAAKnU,EAAMyL,SAAS1O,OAAS,EAAI,CAEhC,IAEIkX,EAFAhZ,EAAW,IAAI0P,GAAgB,CAAEtB,KAAM,EAAGoL,iBAAiB,KAE3DR,EAAiB,IAAIhK,IAEViK,aAAc,WAAY,IAAI/J,GAAwBnK,EAAMyL,SAAU,IAEhFzL,EAAM2L,OAAO5O,OAAS,QAA2Bf,IAAtBgE,EAAM2L,OAAQ,KAE7CsI,EAAeC,aAAc,QAAS,IAAI/J,GAAwBnK,EAAM2L,OAAQ,IAChF1Q,EAAS4Z,cAAe,GAIzB,IAAIG,EAAS,IAAItK,GAAQuJ,EAAgBhZ,GACzC2Y,EAAUmB,IAAKC,GAMjB,OAAOpB,KAMF/I,EAj4BU,GCjBZoK,GAA6B,CACjCC,YAAa,CAAEC,MAAO,KAAMC,KAAM,MAClCC,YAAa,CAAEF,MAAO,KAAMC,KAAM,MAClCE,QAAS,CAAEH,MAAO,KAAMC,KAAM,MAC9BG,eAAgB,CAAEJ,MAAO,KAAMC,KAAM,MACrCI,kBAAmB,CAAEL,MAAO,KAAMC,KAAM,MACxCK,iBAAkB,CAAEN,MAAO,KAAMC,KAAM,OAmBnCM,GAEF,4DAESC,GAAa,yCAAG,WAAOC,GAAP,4BAAA5H,EAAA,6DACrB6H,EAAY,IAAIhL,GADK,kBAUFgL,EAAUC,UAC7BJ,GAAa,iCAXQ,OAUjBlK,EAViB,OAavBlP,QAAQkB,IAAI,cAAe,6CAC3ByX,GAAY,YAAgBE,MAAQ3J,EAAOyB,QAC3CgI,GAAY,YAAgBG,MAAO,IAAIxa,KAAamb,cAAcvK,GAf3C,kDAiBvBlP,QAAQC,MACN,cACA,gDAnBqB,mCA6BFsZ,EAAUC,UAC7BJ,GAAa,iCA9BQ,QA6BjBlK,EA7BiB,OAgCvBlP,QAAQkB,IAAI,cAAe,oCAC3ByX,GAAY,YAAgBE,MAAQ3J,EAAOyB,QAC3CgI,GAAY,YAAgBG,MAAO,IAAIxa,KAAamb,cAAcvK,GAlC3C,mDAoCvBlP,QAAQC,MAAM,cAAe,uCApCN,mCA6CFsZ,EAAUC,UAC7BJ,GAAa,iCA9CQ,QA6CjBlK,EA7CiB,OAgDvBlP,QAAQkB,IAAI,cAAe,kCAC3ByX,GAAY,QAAYE,MAAQ3J,EAAOyB,QACvCgI,GAAY,QAAYG,MAAO,IAAIxa,KAAamb,cAAcvK,GAlDvC,mDAoDvBlP,QAAQC,MAAM,cAAe,qCApDN,mCA0DFsZ,EAAUC,UAC7BJ,GAAa,sBA3DQ,QA0DjBlK,EA1DiB,OA6DvBlP,QAAQkB,IAAI,cAAe,kCAC3ByX,GAAY,eAAmBE,MAAQ3J,EAAOyB,QAC9CgI,GAAY,eAAmBG,MAAO,IAAIxa,KAAamb,cACrDvK,GAhEqB,mDAmEvBlP,QAAQC,MAAM,cAAe,qCAnEN,mCAyEFsZ,EAAUC,UAC7BJ,GAAa,yBA1EQ,QAyEjBlK,EAzEiB,OA4EvBlP,QAAQkB,IAAI,cAAe,qCAC3ByX,GAAY,kBAAsBE,MAAQ3J,EAAOyB,QACjDgI,GAAY,kBAAsBG,MAAO,IAAIxa,KAAamb,cACxDvK,GA/EqB,mDAkFvBlP,QAAQC,MAAM,cAAe,wCAlFN,mCAwFFsZ,EAAUC,UAC7BJ,GAAa,wBAzFQ,QAwFjBlK,EAxFiB,OA2FvBlP,QAAQkB,IAAI,cAAe,oCAC3ByX,GAAY,iBAAqBE,MAAQ3J,EAAOyB,QAChDgI,GAAY,iBAAqBG,MAAO,IAAIxa,KAAamb,cACvDvK,GA9FqB,mDAiGvBlP,QAAQC,MAAM,cAAe,uCAjGN,kGAAH,sDA2MbyZ,GAA2B,SAACjb,GACvC,OAAIA,IAASrC,EAAUud,YACdhB,GAAaI,YAAYD,KAG9Bra,IAASrC,EAAUwd,QACdjB,GAAaK,QAAQF,KAG1Bra,IAASrC,EAAUyd,YACdlB,GAAaC,YAAYE,KAG9Bra,IAASrC,EAAUsC,eACdia,GAAaM,eAAeH,KAGjCra,IAASrC,EAAU0d,kBACdnB,GAAaO,kBAAkBJ,KAGpCra,IAASrC,EAAU2d,iBACdpB,GAAaQ,iBAAiBL,MAGvC9Y,QAAQ2G,KAAK,iCAAkClI,GAExC,O,kBC9QIub,GAAb,2KAKE,SAAkBC,GAChBzX,KAAK0X,WAAWrT,QAAUoT,EAASpT,QACnCrE,KAAK0X,WAAWpT,YAAcmT,EAASnT,YACvCtE,KAAK0X,WAAW5S,GAAK2S,EAAS3S,GAC9B9E,KAAK0X,WAAWjW,MAAQgW,EAAShW,MACjCzB,KAAK0X,WAAW7W,QAAU4W,EAAS5W,YAVvC,GAAsC8W,iBC4JzBpU,GAAU,CACrBqU,KAAMC,gCAAqBL,KAiBhBzT,GAAQ+T,2BACnBC,iCAAsBP,GAAkBpT,KC/K7B4T,GAAWC,aACtBlU,I,SCGWmU,GAAb,WAME,aAAe,0BALfC,wBAKc,OAJdC,WAIc,OAHdC,eAGc,OAFdC,gBAEc,EACZtY,KAAKmY,wBAAqBjb,EAC1B8C,KAAKoY,MAAQ,IAAItc,IACjBkE,KAAKqY,UAAY,IAAIvc,IACrBkE,KAAKsY,WAAa,GAVtB,4CAaE,SAAQna,MAbV,sBAeE,SAASA,MAfX,oBAiBE,SAAOA,MAjBT,oBAmBE,SAAOA,MAnBT,kBAqBE,SAAKA,MArBP,0BAuBE,SAAaoa,EAAiBC,GAK5B,GAJoB,OAAhB1B,GAAS2B,KACXzY,KAAKmY,mBAAqBrB,GAAS2B,GAAGC,8BAGRxb,IAA5B8C,KAAKmY,mBACP,MAAO,GANoC,MASRnY,KAAKmY,mBAAlCxb,EATqC,EASrCA,MAAOD,EAT8B,EAS9BA,OAAQic,EATsB,EAStBA,IAAKC,EATiB,EASjBA,KAM5B,OALA5Y,KAAKoY,MAAM5d,GAAM+d,EAAUK,GAAQjc,EAAS,EAAI,EAChDqD,KAAKoY,MAAM3d,IAAO+d,EAAUG,GAAOjc,EAAU,EAAI,EACjDsD,KAAKqY,UAAUQ,cAAc7Y,KAAKoY,MAAOtB,GAASgC,QAG3C9Y,KAAKqY,UAAUU,iBAAiBjC,GAASkC,MAAMC,UAAU,KAtCpE,iCAyCE,SAAoBV,EAAiBC,GACnC,OAAOxY,KAAKkZ,wBAAwBlZ,KAAKmZ,aAAaZ,EAASC,MA1CnE,2CA6CE,SAA8BD,EAAiBC,GAE7C,OADmBxY,KAAKmZ,aAAaZ,EAASC,GAC5BvN,QAAO,SAACrD,GAAS,IAAD,IAC1BvG,EAAOuG,EAAI8E,OAAO0M,SAElBpc,GADQ,SAAGqE,QAAH,IAAGA,OAAH,EAAGA,EAAMtE,SACP,iBAAGsE,QAAH,IAAGA,OAAH,EAAGA,EAAMrE,kBAAT,aAAuBE,GACvC,OAEEF,IAAehD,EAAYsB,MAC3B0B,IAAehD,EAAYiJ,QAC3BjG,IAAehD,EAAY4I,OAC3B5F,IAAehD,EAAYsJ,sBAxDnC,qCA8DE,SAAwBgV,GAAmC,IACjDhd,EAAgCtB,EAAhCsB,KAAM2H,EAA0BjJ,EAA1BiJ,OAAQiE,EAAkBlN,EAAlBkN,cACtB,OAAOoR,EAAWrN,QAAO,SAACrD,GAAS,IAAD,MAC1B5K,EAAU,iBAAG4K,QAAH,IAAGA,GAAH,UAAGA,EAAK8E,cAAR,iBAAG,EAAa0M,gBAAhB,aAAG,EAAuBpc,kBAA1B,aAAwCE,EACxD,OACEF,IAAe1B,GACf0B,IAAeiG,GACfjG,IAAekK,OArEvB,sCA0EE,SAAyB0D,GACvB,IAAM7G,EAAQ0C,KACd,QAAgCvJ,IAA5B6G,EAAMM,QAAQuG,GAChB,MAAO,GAGT,IAAMyO,EAAUtV,EAAMM,QAAQuG,GAAU5N,aAAehD,EAAY4I,MAC7D0W,OACoCpc,IAAxC6G,EAAMM,QAAQuG,GAAd,SACA7G,EAAMM,QAAQuG,GAAd,QAAoC3M,OAAS,EACzChB,EAAU8G,EAAMM,QAAQuG,GAAd,QAChB,OAAIyO,EACMtV,EAAMM,QAAQuG,GAAoBpD,YACjC8R,EACH,CAAErc,GAAR,oBAAqB8G,EAAMM,QAAQpH,GAAmBuK,cAE/C,KA1Fb,6CA8FE,SACE8Q,EACAiB,GAEwCvf,EAAhCsB,KAAgCtB,EAA1BiJ,OAA0BjJ,EAAlBkN,cADrB,IAEKiM,EAIF,CACF7X,KAAM,GACN2H,OAAQ,GACRiE,cAAe,IAEXsS,EAAqB,GAkB3B,OAjBAlB,EAAWpa,SAAQ,SAAC0J,EAAKW,GAAW,IAAD,kBACjC,UAAiBrL,IAAbqc,GACEC,EAASvb,QAAUsb,GADzB,CAKA,IAAMpe,EAAE,iBAAGyM,QAAH,IAAGA,GAAH,UAAGA,EAAK8E,cAAR,iBAAG,EAAa0M,gBAAhB,aAAG,EAAuBje,UAA1B,aAAgC+B,EAClCF,EAAU,iBAAG4K,QAAH,IAAGA,GAAH,UAAGA,EAAK8E,cAAR,iBAAG,EAAa0M,gBAAhB,aAAG,EAAuBpc,kBAA1B,aAAwCE,EAC1C,SAAG0K,QAAH,IAAGA,GAAH,UAAGA,EAAK8E,cAAR,iBAAG,EAAa0M,gBAAhB,aAAG,EAAuBrc,cAE7BG,IAAP/B,QACiB+B,IAAfF,IACFmW,EAAOnW,GAAYoB,KAAKwJ,GACxB4R,EAASpb,KAAKmK,QAIb4K,MA9HX,KCOasG,GAAb,oDACE,aAAe,yCADjB,4CAKE,SAAQtb,MALV,sBAOE,SAASA,MAPX,oBASE,SAAOA,GACL,IAAMmY,EAAOY,GAAyBtd,EAAUwd,SAC5Cza,EAAQ,EACRD,EAAS,EAET4Z,IACF3Z,EAAQmM,KAAK4Q,IAAIpD,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,GACvCkC,EAASoM,KAAK4Q,IAAIpD,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,GAChCqO,KAAK4Q,IAAIpD,EAAK7M,IAAI/O,EAAI4b,EAAK/M,IAAI7O,IARf,MAUTif,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAVkB,EAUlBA,EAAGC,EAVe,EAUfA,EACLmf,EAAsB,CAC1Ble,KAAMuG,EAAa4X,WACnBC,QAAS,CACPzV,QAAS,CACP,CACErI,SAAU,CAAExB,EAAGA,EAAGC,EAAGA,EAAGC,EAAG,GAC3BiC,QACAD,SACAM,WAAYhD,EAAYsB,SAKhCye,GAAUH,KAjCd,oBAoCE,SAAOzb,MApCT,kBAsCE,SAAKA,QAtCP,GAAkD+Z,ICfrC8B,GAAb,kDACEC,WAAqB,EADvB,KAEEC,eAAyB,EAF3B,KAGE5L,IAAgC,CAAE9T,EAAG,EAAGC,EAAG,GAH7C,KAIE0f,MAAkC,CAAE3f,EAAG,EAAGC,EAAG,GAJ/C,KAKE2f,sBAAgC,EALlC,2CAOE,SAAO5f,EAAWC,GAChBuF,KAAKka,eAAgB,EACrBla,KAAKma,MAAM3f,EAAIA,EACfwF,KAAKma,MAAM1f,EAAIA,EACfuF,KAAKsO,IAAI9T,EAAIA,EACbwF,KAAKsO,IAAI7T,EAAIA,IAZjB,kBAeE,WACEuF,KAAKka,eAAgB,EACrBla,KAAKia,WAAY,EACjBja,KAAKma,MAAM3f,EAAI,EACfwF,KAAKma,MAAM1f,EAAI,EACfuF,KAAKsO,IAAI9T,EAAI,EACbwF,KAAKsO,IAAI7T,EAAI,EACbuF,KAAKoa,sBAAuB,IAtBhC,oBAyBE,SAAO5f,EAAWC,GAChB,GAA0B,GAAtBuF,KAAKka,gBACPla,KAAKsO,IAAI9T,EAAIA,EACbwF,KAAKsO,IAAI7T,EAAIA,GACU,IAAnBuF,KAAKia,WAAqB,CAAC,IACrBE,EAAena,KAAfma,MAAO7L,EAAQtO,KAARsO,IACT+L,EAAS/L,EAAI9T,EAAI2f,EAAM3f,EACvB8f,EAAShM,EAAI7T,EAAI0f,EAAM1f,GAEzBqO,KAAK4Q,IAAIW,GAAU,GAAKvR,KAAK4Q,IAAIY,GAAU,KAC7Cta,KAAKia,WAAY,QAnC3B,KCEaM,GAAb,WAQE,aAAe,0BAPfC,aAOc,OANdC,cAMc,OALdC,gBAKc,OAJdC,kBAIc,OAHdC,sBAGc,OAFdC,YAEc,EACZ7a,KAAKwa,QAAUM,SAASC,cAAc,OACtC/a,KAAKwa,QAAQQ,MAAMC,cAAgB,OACnCjb,KAAKwa,QAAQQ,MAAME,WAAa,0BAChClb,KAAKwa,QAAQQ,MAAMG,OAAS,oBAC5Bnb,KAAKwa,QAAQQ,MAAMhf,SAAW,WAC9BgE,KAAKwa,QAAQQ,MAAMI,OAAS,IAC5Bpb,KAAK0a,WAAa,IAAIW,IACtBrb,KAAK2a,aAAe,IAAIU,IACxBrb,KAAK4a,iBAAmB,IAAIS,IAC5Brb,KAAK6a,QAAS,EAlBlB,gDAqBE,SAAYJ,GACVza,KAAKya,SAAWA,IAtBpB,oBAyBE,SAAOa,EAAiBC,GACtBvb,KAAK6a,QAAS,EAEV7a,KAAKya,SAASe,YAAcxb,KAAKya,SAASe,WAAWC,eACvDzb,KAAKya,SAASe,WAAWC,cAAcC,YAAY1b,KAAKwa,SAWtDxa,KAAKwa,UACPxa,KAAKwa,QAAQQ,MAAMpC,KAAO0C,EAAU,KACpCtb,KAAKwa,QAAQQ,MAAMrC,IAAM4C,EAAU,KACnCvb,KAAKwa,QAAQQ,MAAMre,MAAQ,MAC3BqD,KAAKwa,QAAQQ,MAAMte,OAAS,OAG9BsD,KAAK0a,WAAWlgB,EAAI8gB,EACpBtb,KAAK0a,WAAWjgB,EAAI8gB,IAhDxB,oBAmDE,SAAOD,EAAiBC,GAClBvb,KAAK6a,SACP7a,KAAK4a,iBAAiBpgB,EAAIsO,KAAKW,IAAIzJ,KAAK0a,WAAWlgB,EAAG8gB,GACtDtb,KAAK4a,iBAAiBngB,EAAIqO,KAAKW,IAAIzJ,KAAK0a,WAAWjgB,EAAG8gB,GACtDvb,KAAK2a,aAAangB,EAAIsO,KAAKS,IAAIvJ,KAAK0a,WAAWlgB,EAAG8gB,GAClDtb,KAAK2a,aAAalgB,EAAIqO,KAAKS,IAAIvJ,KAAK0a,WAAWjgB,EAAG8gB,GAE9Cvb,KAAKwa,UACPxa,KAAKwa,QAAQQ,MAAMpC,KAAO5Y,KAAK2a,aAAangB,EAAI,KAChDwF,KAAKwa,QAAQQ,MAAMrC,IAAM3Y,KAAK2a,aAAalgB,EAAI,KAC/CuF,KAAKwa,QAAQQ,MAAMre,MACjBqD,KAAK4a,iBAAiBpgB,EAAIwF,KAAK2a,aAAangB,EAAI,KAClDwF,KAAKwa,QAAQQ,MAAMte,OACjBsD,KAAK4a,iBAAiBngB,EAAIuF,KAAK2a,aAAalgB,EAAI,SAhE1D,kBAqEE,WAEMuF,KAAKwa,SAA0C,OAA/Bxa,KAAKwa,QAAQiB,eAC/Bzb,KAAKwa,QAAQiB,cAAcE,YAAY3b,KAAKwa,aAxElD,KCsBaoB,GAAb,oDAUE,aAAe,IAAD,+BACZ,gBAVFC,oBASc,IARdC,4BAQc,IAPdC,qBAOc,IANd5D,wBAMc,IALd6D,qBAKc,IAJd5D,WAIc,IAHdC,eAGc,IAFd4D,0BAEc,EAEZ,EAAK9D,wBAAqBjb,EAC1B,EAAK2e,gBAAiB,EACtB,EAAKC,uBAAyB,IAAIhgB,IAClC,EAAKigB,gBAAkB,IAAIjgB,IAC3B,EAAKkgB,gBAAkB,IAAIhC,GAC3B,EAAK5B,MAAQ,IAAItc,IACjB,EAAKuc,UAAY,IAAIvc,IAErB,EAAKmgB,qBAAuB,IAAI1B,GAChC,EAAK0B,qBAAqBC,YAAYpF,GAAS2D,UAXnC,EAVhB,4CAwBE,SAAQtc,MAxBV,sBA0BE,SAASA,MA1BX,oBA4BE,SAAOA,GAIL,GAHoB,OAAhB2Y,GAAS2B,KACXzY,KAAKmY,mBAAqBrB,GAAS2B,GAAGC,8BAERxb,IAA5B8C,KAAKmY,mBAAT,CAJ0B,MAOJnY,KAAKmY,mBAAnBQ,EAPkB,EAOlBA,IAAKC,EAPa,EAObA,KACP0C,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAChC3Y,KAAKic,qBAAqBE,OAAOb,EAASC,GAVhB,MAWT5B,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAXkB,EAWlBA,EAAGC,EAXe,EAWfA,EACXuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,MAxCnC,oBA2CE,SAAO0D,GACL,QAAgCjB,IAA5B8C,KAAKmY,mBAAT,CAD0B,MAIWnY,KAAKmY,mBAAnBQ,GAJG,EAIlBhc,MAJkB,EAIXD,OAJW,EAIHic,KAAKC,EAJF,EAIEA,KACtB0C,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAChC3Y,KAAKic,qBAAqBG,OAAOd,EAASC,GAPhB,MAQT5B,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EARkB,EAQlBA,EAAGC,EARe,EAQfA,EACXuF,KAAKgc,gBAAgBI,OAAO5hB,EAAGC,MApDnC,kBAuDE,SAAK0D,GAIH,IAAMke,EAAOvT,KAAKS,IAChBvJ,KAAKgc,gBAAgB7B,MAAM3f,EAC3BwF,KAAKgc,gBAAgB1N,IAAI9T,GAErB8hB,EAAOxT,KAAKS,IAChBvJ,KAAKgc,gBAAgB7B,MAAM1f,EAC3BuF,KAAKgc,gBAAgB1N,IAAI7T,GAErBkC,EAAQmM,KAAK4Q,IACjB1Z,KAAKgc,gBAAgB1N,IAAI9T,EAAIwF,KAAKgc,gBAAgB7B,MAAM3f,GAEpDkC,EAASoM,KAAK4Q,IAClB1Z,KAAKgc,gBAAgB1N,IAAI7T,EAAIuF,KAAKgc,gBAAgB7B,MAAM1f,GAUpDmf,EAAsB,CAC1Ble,KAAMuG,EAAa4X,WACnBC,QAAS,CACPzV,QAAS,CACP,CACErH,WAAYhD,EAAYiJ,OACxBvG,SACAC,QACAX,SAAU,CACRxB,EAAG6hB,EAAO1f,EAAQ,EAClBlC,EAAG6hB,EAAO5f,EAAS,EACnBhC,EAAG,OAMbqf,GAAUH,GACV,IAAM2C,EAA4B,CAChC7gB,KAAMuG,EAAaua,iBACnB1C,QAAS,CACP2C,WAAY,CACV9W,KAAM1L,EAAW2L,gBAIvBmU,GAAUwC,GAYVvc,KAAKgc,gBAAgBU,OACrB1c,KAAKic,qBAAqBS,WAxH9B,GAAoDxE,ICZvCyE,GAAb,oDAUE,aAAe,IAAD,+BACZ,gBAVFd,oBASc,IARdC,4BAQc,IAPdC,qBAOc,IANd5D,wBAMc,IALd6D,qBAKc,IAJd5D,WAIc,IAHdC,eAGc,IAFd4D,0BAEc,EAEZ,EAAK9D,wBAAqBjb,EAC1B,EAAK2e,gBAAiB,EACtB,EAAKC,uBAAyB,IAAIhgB,IAClC,EAAKigB,gBAAkB,IAAIjgB,IAC3B,EAAKkgB,gBAAkB,IAAIhC,GAC3B,EAAK5B,MAAQ,IAAItc,IACjB,EAAKuc,UAAY,IAAIvc,IAErB,EAAKmgB,qBAAuB,IAAI1B,GAChC,EAAK0B,qBAAqBC,YAAYpF,GAAS2D,UAXnC,EAVhB,4CAwBE,SAAQtc,MAxBV,sBA0BE,SAASA,MA1BX,oBA4BE,SAAOA,GACe,OAAhB2Y,GAAS2B,KACXzY,KAAKmY,mBAAqBrB,GAAS2B,GAAGC,yBAFd,MAITiB,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAJkB,EAIlBA,EAAGC,EAJe,EAIfA,EAEX,GADAuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,GACX,OAAhBqc,GAAS2B,GACX,MAAM,IAAImE,MAAM,gBAPQ,MASJ9F,GAAS2B,GAAGC,wBAA1BC,EATkB,EASlBA,IAAKC,EATa,EASbA,KACP0C,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAChC3Y,KAAKic,qBAAqBE,OAAOb,EAASC,KAxC9C,oBA2CE,SAAOpd,MA3CT,kBA6CE,SAAKA,GAGH,IAAuC,IAAnC6B,KAAKgc,gBAAgB/B,gBAElB,IAC8B,IAAnCja,KAAKgc,gBAAgB/B,YACkB,IAAvCja,KAAKgc,gBAAgB9B,eAED,OAAhBpD,GAAS2B,GAAa,CAAC,IAAD,EAMpB3B,GAAS2B,GAAGC,wBAJd/b,EAFsB,EAEtBA,MACAD,EAHsB,EAGtBA,OACAic,EAJsB,EAItBA,IACAC,EALsB,EAKtBA,KAEF5Y,KAAKoY,MAAM5d,GAAM2D,EAAMoa,QAAUK,GAAQjc,EAAS,EAAI,EACtDqD,KAAKoY,MAAM3d,IAAO0D,EAAMqa,QAAUG,GAAOjc,EAAU,EAAI,EAEvDsD,KAAKsY,WAAatY,KAAK6c,8BACrB1e,EAAMoa,QACNpa,EAAMqa,SAER,IAAMsE,EAA2B9c,KAAKsY,WAAWra,OAAS,EAE1D,GAAI6e,EAA0B,CAC5Btf,QAAQkB,IACN,kCACAoe,EACA9c,KAAKsY,WAAW,GAAG5L,OAAO0M,SAASje,IAErC,IAAMyP,EAAW5K,KAAKsY,WAAW,GAAG5L,OAAO0M,SAASje,GAC9CqM,EAAcxH,KAAK+c,yBAAyBnS,GAC5CoS,EAAwB,CAC5BthB,KAAMuG,EAAagb,cACnBnD,QAAS,CACPoD,IAAI,CAAEtS,GAAH,oBAAgBpD,MAGvBuS,GAAUiD,IA4BhBhd,KAAKgc,gBAAgBU,OACrB1c,KAAKic,qBAAqBS,WAjH9B,GAAiDxE,ICRpCiF,GAAoB,SAAC1F,IAElC2F,EADqBpF,GAAboF,UACC7Z,GAAQqU,KAAKyF,kBAAkB5F,KC0G3B6F,GAAiB,SAAC9C,GAC7B,SAAKA,IAAYA,EAAQ+C,WAKH,WAApB/C,EAAQ+C,SACY,UAApB/C,EAAQ+C,SACY,WAApB/C,EAAQ+C,SACY,aAApB/C,EAAQ+C,UAcRC,GAAY,GACZC,QAA4CvgB,EAQzC,SAASwgB,KAA2D,IAcrEC,EAAQC,EAdiBpD,EAA2C,uDAAN,KAClE,GAAsB,qBAAXqD,OAET,OAAO,EAuBT,SAASC,IAEHhD,SAAS6C,KACXH,GAAY,IAtBA,OAAZhD,IACFiD,GAAYI,OAAO/C,WAIEwC,GAAeG,IAGP,qBAApB3C,SAAS6C,QAElBA,EAAS,SACTC,EAAmB,oBAC4B,qBAA9B9C,SAAiBiD,UAClCJ,EAAS,WACTC,EAAmB,sBACgC,qBAAlC9C,SAAiBkD,eAClCL,EAAS,eACTC,EAAmB,0BASkB,qBAA9B9C,SAASmD,uBACL/gB,IAAXygB,EAEAngB,QAAQ2G,KACN,0GAGF2W,SAASmD,iBAAiBL,EAAkBE,GAAwB,GA+DjE,SAASI,GAAaC,GAC3B,OAAgC,IAAzBX,GAAUW,GCpPZ,ICaHC,GACFC,GACAC,GACAC,GACAC,GACAC,GACAC,GDnBWC,GAAb,WA2BE,aAAe,0BA1BfC,QAAyB,IAAIC,IA0Bf,KAzBdC,OAAwB,IAAIhT,IAyBd,KAvBdiT,SAA0B,IAAIjT,IAuBhB,KArBdkT,QAAyB,IAAIlT,IAqBf,KApBdmT,WAA4B,IAAInT,IAoBlB,KAnBdoT,YAA6B,IAAIpT,IAmBnB,KAlBdqT,aAA8B,IAAIrT,IAkBpB,KAjBdsT,YAA6B,IAAItT,IAiBnB,KAhBduT,cAA+B,IAAIvT,IAgBrB,KAfdwT,eAAgC,IAAIxT,IAetB,KAddyT,gBAAiC,IAAIzT,IAcvB,KAbd0T,eAAgC,IAAI1T,IAatB,KAXd2T,SAA0B,IAAI3T,IAWhB,KAVd4T,SAA0B,IAAI5T,IAUhB,KATd6T,SAA0B,IAAI7T,IAShB,KARd4O,gBAQc,OAPdkF,cAOc,OANdC,gBAMc,OALdC,KAAeC,OAAOC,UAKR,KAJdlH,YAIc,OAHdE,WAGc,OAFd1U,iBAEc,EACZtE,KAAK0a,WAAa,IAAI5O,IACtB9L,KAAK4f,SAAW,IAAI9T,IACpB9L,KAAK6f,WAAa,GAClB7f,KAAKsE,YAAc,GA/BvB,8CAkCE,SAAUwU,GACR9Y,KAAK8Y,OAASA,IAnClB,sBAsCE,SAASE,GACPhZ,KAAKgZ,MAAQA,IAvCjB,oBA0CE,SAAO0B,EAA4BkF,GAKjC,OAJA5f,KAAK0a,WAAL,OAAkBA,QAAlB,IAAkBA,IAAc1a,KAAK0a,WACrC1a,KAAK4f,SAAL,OAAgBA,QAAhB,IAAgBA,IAAY5f,KAAK4f,SACjC5f,KAAK6f,WAAa,GAEb7f,KAAKgZ,OAIVhZ,KAAKsE,YAAc,GACnBtE,KAAKigB,cAAcjgB,KAAK0a,WAAY1a,KAAK4f,UAGzC5f,KAAKkgB,qBAAqBlgB,KAAK4e,QAAS5e,KAAKgZ,OAC7ChZ,KAAKsE,YAAc,GAeZtE,KAAK6f,YAvBH7f,KAAK6f,aAhDlB,uBA0EE,SAAUnF,EAA4BkF,GAKpC,OAJA5f,KAAK0a,WAAL,OAAkBA,QAAlB,IAAkBA,IAAc1a,KAAK0a,WACrC1a,KAAK4f,SAAL,OAAgBA,QAAhB,IAAgBA,IAAY5f,KAAK4f,SACjC5f,KAAK6f,WAAa,GAEb7f,KAAKgZ,OAIVhZ,KAAKsE,YAAc,GACnBtE,KAAKigB,cAAcjgB,KAAK0a,WAAY1a,KAAK4f,UACzC5f,KAAKkgB,qBAAqBlgB,KAAK4e,QAAS5e,KAAKgZ,OACtChZ,KAAKsE,aANHtE,KAAK6f,aAhFlB,2BA0FE,SAAcM,EAA6BC,GACzC,GAAKpgB,KAAK8Y,OAAV,CAGA,IAAM4B,EAAU,OAAGyF,QAAH,IAAGA,IAAengB,KAAK0a,WACjCkF,EAAQ,OAAGQ,QAAH,IAAGA,IAAapgB,KAAK4f,SAcnC,GAXIlF,EAAWlgB,IAAMolB,EAASplB,IAC5BolB,EAASplB,GAAKulB,OAAOM,SAGnB3F,EAAWjgB,IAAMmlB,EAASnlB,IAC5BmlB,EAASnlB,GAAKslB,OAAOM,SAGvBrgB,KAAK8Y,OAAOwH,yBACZtgB,KAAK8Y,OAAOyH,oBAERvgB,KAAK8Y,OAAO0H,qBAAsB,CACpC,IAAI5H,EAAO9P,KAAKS,IAAImR,EAAWlgB,EAAGolB,EAASplB,GACvCme,EAAM7P,KAAKW,IAAIiR,EAAWjgB,EAAGmlB,EAASnlB,GACtCgmB,EAAQ3X,KAAKW,IAAIiR,EAAWlgB,EAAGolB,EAASplB,GACxCkmB,EAAO5X,KAAKS,IAAImR,EAAWjgB,EAAGmlB,EAASnlB,GAE3CuF,KAAKif,WAAW0B,IAAI/H,EAAMD,GAAM,GAChC3Y,KAAKkf,YAAYyB,IAAIF,EAAO9H,GAAM,GAClC3Y,KAAKmf,aAAawB,IAAIF,EAAOC,GAAO,GACpC1gB,KAAKof,YAAYuB,IAAI/H,EAAM8H,GAAO,GAElC1gB,KAAKqf,cAAcsB,IAAI/H,EAAMD,EAAK,GAClC3Y,KAAKsf,eAAeqB,IAAIF,EAAO9H,EAAK,GACpC3Y,KAAKuf,gBAAgBoB,IAAIF,EAAOC,EAAM,GACtC1gB,KAAKwf,eAAemB,IAAI/H,EAAM8H,EAAM,GAEpC1gB,KAAKif,WAAW2B,UAAU5gB,KAAK8Y,QAC/B9Y,KAAKkf,YAAY0B,UAAU5gB,KAAK8Y,QAChC9Y,KAAKmf,aAAayB,UAAU5gB,KAAK8Y,QACjC9Y,KAAKof,YAAYwB,UAAU5gB,KAAK8Y,QAEhC9Y,KAAKqf,cAAcuB,UAAU5gB,KAAK8Y,QAClC9Y,KAAKsf,eAAesB,UAAU5gB,KAAK8Y,QACnC9Y,KAAKuf,gBAAgBqB,UAAU5gB,KAAK8Y,QACpC9Y,KAAKwf,eAAeoB,UAAU5gB,KAAK8Y,QAEnC,IAAI+H,EAAS7gB,KAAK4e,QAAQiC,OAE1BA,EAAO,GAAGC,sBACR9gB,KAAKif,WACLjf,KAAKqf,cACLrf,KAAKsf,gBAEPuB,EAAO,GAAGC,sBACR9gB,KAAKkf,YACLlf,KAAKsf,eACLtf,KAAKuf,iBAEPsB,EAAO,GAAGC,sBACR9gB,KAAKuf,gBACLvf,KAAKwf,eACLxf,KAAKof,aAEPyB,EAAO,GAAGC,sBACR9gB,KAAKwf,eACLxf,KAAKqf,cACLrf,KAAKif,YAEP4B,EAAO,GAAGC,sBACR9gB,KAAKkf,YACLlf,KAAKmf,aACLnf,KAAKof,aAEPyB,EAAO,GAAGC,sBACR9gB,KAAKuf,gBACLvf,KAAKsf,eACLtf,KAAKqf,eAEPwB,EAAO,GAAGE,OAAOC,gBAAgB,QAEjCxjB,QAAQC,MAAM,mDAzKpB,kCA8KE,SAAqBmhB,EAAwBlS,GAC3C,IAAIA,EAAOuU,QAAUvU,EAAOsI,QAAUtI,EAAOuI,gBACnB/X,IAApBwP,EAAOvQ,SAAwB,CAAC,IAAD,EAI3BkF,EAAOqL,EAAO0M,SACdje,EAAE,iBAAGkG,QAAH,IAAGA,OAAH,EAAGA,EAAMlG,UAAT,aAAe+B,EACvB,QAAWA,IAAP/B,EAAkB,CAAC,IAAD,EAEd6B,EAAU,iBAAGqE,QAAH,IAAGA,OAAH,EAAGA,EAAMrE,kBAAT,aAAuBE,EAOvC,IAAoB,KALlBF,IAAehD,EAAYsB,MAC3B0B,IAAehD,EAAYiJ,QAC3BjG,IAAehD,EAAY4I,OAC3B5F,IAAehD,EAAYsJ,kBAEH,CACxB,IAAMgT,GAAO,IAAIxa,KAAamb,cAAcvK,GACxCkS,EAAQsC,cAAc5K,KACc,IAAlCtW,KAAKsE,YAAY6c,SAAShmB,KAC5B6E,KAAK6f,WAAWzhB,KAAKsO,GACrB1M,KAAKsE,YAAYlG,KAAKjD,MAgBlC,GAAIuR,EAAOuM,UAAYvM,EAAOuM,SAAShb,OAAS,EAC9C,IAAK,IAAIzD,EAAI,EAAGA,EAAIkS,EAAOuM,SAAShb,OAAQzD,IAC1CwF,KAAKkgB,qBAAqBtB,EAASlS,EAAOuM,SAASze,QAtN3D,KEAa4mB,GAAb,WAME,aAAe,0BALfvF,oBAKc,OAJdC,4BAIc,OAHdC,qBAGc,OAFd5D,wBAEc,EACZnY,KAAK6b,gBAAiB,EACtB7b,KAAK8b,uBAAyB,IAAIhgB,IAClCkE,KAAK+b,gBAAkB,IAAIjgB,IAT/B,4CAYE,SAAQqC,MAZV,sBAcE,SAASA,MAdX,oBAgBE,SAAOA,GAKL,GAJoB,OAAhB2Y,GAAS2B,KACXzY,KAAKmY,mBAAqBrB,GAAS2B,GAAGC,8BAGRxb,IAA5B8C,KAAKmY,mBACP,MAAO,GAGTnY,KAAK6b,gBAAiB,EAEtB7b,KAAKmY,mBAAqBrB,GAAS2B,GAAGC,wBAXZ,MAYJ1Y,KAAKmY,mBAAnBQ,EAZkB,EAYlBA,IAAKC,EAZa,EAYbA,KAEP0C,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAEhC3Y,KAAK8b,uBAAuBthB,EAAI8gB,EAChCtb,KAAK8b,uBAAuBrhB,EAAI8gB,EAEhCvb,KAAK+b,gBAAgBvhB,EAAIsc,GAASgC,OAAO9c,SAASxB,EAClDwF,KAAK+b,gBAAgBthB,EAAIqc,GAASgC,OAAO9c,SAASvB,IArCtD,oBAwCE,SAAO0D,GACL,QAAgCjB,IAA5B8C,KAAKmY,qBAImB,IAAxBnY,KAAK6b,eAAyB,CAChC,IAAM9X,EAAQ0C,KADkB,EAGVzG,KAAKmY,mBAAnBQ,EAHwB,EAGxBA,IAAKC,EAHmB,EAGnBA,KACP0C,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAC1B0I,EAAatd,EAAMe,GAAGY,UAKtB4b,GAHmBthB,KAAK8b,uBAAuBthB,EAAI8gB,GAGP+F,EAC5CE,GAHmBvhB,KAAK8b,uBAAuBrhB,EAAI8gB,GAGP8F,EAE5CG,EAAUxhB,KAAK+b,gBAAgBvhB,EAAI8mB,EACnCG,EAAUzhB,KAAK+b,gBAAgBthB,EAAI8mB,EAEzCzK,GAASgC,OAAO9c,SAASxB,EAAIgnB,EAC7B1K,GAASgC,OAAO9c,SAASvB,EAAIgnB,EAC7B3K,GAASgC,OAAO4I,OAAOF,EAASC,EAAS,MAhE/C,kBAoEE,SAAKtjB,GACH6B,KAAKmY,wBAAqBjb,GACE,IAAxB8C,KAAK6b,iBACP7b,KAAK6b,gBAAiB,OAvE5B,KCyBa8F,GAAb,oDAsBE,aAAe,IAAD,+BACZ,gBAtBFC,gBAqBc,IARd5F,qBAQc,IALd6F,kBAKc,IAJd5F,0BAIc,IAHd6F,kBAGc,IAFdC,qBAEc,EAMZ,EAAK/F,gBAAkB,IAAIhC,GAI3B,EAAKiC,qBAAuB,IAAI1B,GAChC,EAAK0B,qBAAqBC,YAAYpF,GAAS2D,UAE/C,EAAKoH,aAAe,IAAIlD,GACxB,EAAKkD,aAAaG,UAAUlL,GAASgC,QACrC,EAAK+I,aAAaI,SAASnL,GAASkC,OAEpC,EAAK+I,gBAAkB,IAAIX,GAC3B,EAAKQ,gBAAa1kB,EAlBN,EAtBhB,4CA2CE,SAAQiB,MA3CV,sBA6CE,SAASA,MA7CX,oBA+CE,SAAOA,GAOL,GANA+F,GACE,0DJiLGqN,OAAO2Q,KAAK1E,II/KfU,GAAa,UAGXA,GAAa,SAAU,CACzBle,KAAK4hB,WAAa,aADO,MAERjI,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAFiB,EAEjBA,EAAGC,EAFc,EAEdA,EAOX,OANAuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,GAC/BuF,KAAK+hB,gBAAgB5F,OAAOhe,QAC5B+F,GACE,wDACAlE,KAAK4hB,YAUT,GAAIzjB,EAAMgkB,OAAQ,CAIhBniB,KAAK4hB,WAAa,0BAJF,MAKCjI,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EALQ,EAKRA,EAAGC,EALK,EAKLA,EAKX,GAJAuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,GACX,OAAhBqc,GAAS2B,KACXzY,KAAKmY,mBAAqBrB,GAAS2B,GAAGC,8BAERxb,IAA5B8C,KAAKmY,mBACP,OAXc,MAaqBnY,KAAKmY,mBAAlCQ,EAbQ,EAaRA,IAAKC,EAbG,EAaHA,KAAMjc,EAbH,EAaGA,MAAOD,EAbV,EAaUA,OACpB4e,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAahC,OAXA3Y,KAAKic,qBAAqBE,OAAOb,EAASC,GAE1Cvb,KAAK6hB,aAAanH,WAAWiG,KACzBxiB,EAAMoa,QAAUK,GAAQjc,EAAS,EAAI,IACpCwB,EAAMqa,QAAUG,GAAOjc,EAAU,EAAI,EACxC,QAEFwH,GACE,wDACAlE,KAAK4hB,YAKT,GAAIzjB,EAAMikB,SAAU,CAKlBpiB,KAAK4hB,WAAa,wBALA,MAMDjI,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EANU,EAMVA,EAAGC,EANO,EAMPA,EAKX,GAJAuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,GACX,OAAhBqc,GAAS2B,KACXzY,KAAKmY,mBAAqBrB,GAAS2B,GAAGC,8BAERxb,IAA5B8C,KAAKmY,mBACP,OAZgB,MAcmBnY,KAAKmY,mBAAlCQ,EAdU,EAcVA,IAAKC,EAdK,EAcLA,KAAMjc,EAdD,EAcCA,MAAOD,EAdR,EAcQA,OACpB4e,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAahC,OAXA3Y,KAAKic,qBAAqBE,OAAOb,EAASC,GAE1Cvb,KAAK6hB,aAAanH,WAAWiG,KACzBxiB,EAAMoa,QAAUK,GAAQjc,EAAS,EAAI,IACpCwB,EAAMqa,QAAUG,GAAOjc,EAAU,EAAI,EACxC,QAEFwH,GACE,wDACAlE,KAAK4hB,YAYT,GAPA5hB,KAAK4hB,gBAAa1kB,EAClB8C,KAAKsY,WAAatY,KAAK6c,8BACrB1e,EAAMoa,QACNpa,EAAMqa,SAEyBxY,KAAKsY,WAAWra,OAAS,EAE5B,CAAC,IAAD,EAgBtB8F,EAAQ0C,KAGR4b,GAFE,EAAGriB,KAAKsY,WAAW,GAAG5L,OAAO0M,SAASje,GAE9B6E,KAAKsY,WAAW,GAAG5L,OAAO0M,UACpCkJ,EAAYD,EAAQlnB,GAEpBonB,EAA+Bxe,EAAMO,YAAY6c,SACrDmB,GAGEE,GAAwB,EAO5B,GANAze,EAAMO,YAAYpG,SAAQ,SAAC/C,IACU,IAA/B4I,EAAMM,QAAQlJ,GAAI4B,WACpBylB,GAAmB,OAIE,IAArBH,EAAQtlB,SACVgd,GAAU/Z,KAAKyiB,oCAAoCH,SAU9C,IAAyB,IAArBE,EACTzI,GAAU/Z,KAAKyiB,oCAAoCH,SAE9C,GAAIC,EAA8B,CACvCviB,KAAK4hB,WAAa,yBADqB,MAEtBjI,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAF+B,EAE/BA,EAAGC,EAF4B,EAE5BA,EAEXuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,OAC1B,CAKL,QAHyByC,IAAvBmlB,EAAQrlB,YACRqlB,EAAQrlB,aAAehD,EAAYkN,cAErB,CACdlH,KAAK4hB,WAAa,eADJ,MAEGjI,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAFM,EAENA,EAAGC,EAFG,EAEHA,EACXuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,OAC1B,CACL,IAAM4e,OACmBnc,IAAvBmlB,EAAQrlB,YACRqlB,EAAQrlB,aAAehD,EAAY4I,MAE/B8f,OACoBxlB,IAAxBmlB,EAAO,SAA8BA,EAAO,QAAapkB,OAAS,EAE9D0kB,EAAmBtJ,GAAWqJ,EAGlC1iB,KAAK4hB,WADHe,EACgB,kBAEA,mBAbf,MAeYhJ,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAfH,EAeGA,EAAGC,EAfN,EAeMA,EACXuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,SAG9B,CACLuF,KAAK4hB,WAAa,aADb,MAEYjI,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAFH,EAEGA,EAAGC,EAFN,EAEMA,EACXuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,GAC/BuF,KAAK+hB,gBAAgB5F,OAAOhe,GAG9B+F,GACE,wDACAlE,KAAK4hB,cAtOX,oBA2VE,SAAOzjB,GACL,QAAwBjB,IAApB8C,KAAK4hB,WAAT,CAMA,GAAwB,eAApB5hB,KAAK4hB,WAA6B,CAAC,IAAD,EACnBjI,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAD4B,EAC5BA,EAAGC,EADyB,EACzBA,EACXuF,KAAKgc,gBAAgBI,OAAO5hB,EAAGC,GAC/BuF,KAAK+hB,gBAAgB3F,OAAOje,GAC5B6B,KAAK4iB,gBAAe,GAGE,2BAApB5iB,KAAK4hB,YACP5hB,KAAK6iB,uBAAuB1kB,EAAMoa,QAASpa,EAAMqa,SAG3B,qBAApBxY,KAAK4hB,YACP5hB,KAAK8iB,iBAAiB3kB,EAAMoa,QAASpa,EAAMqa,SAGrB,oBAApBxY,KAAK4hB,YACP5hB,KAAK+iB,gBAAgB5kB,EAAMoa,QAASpa,EAAMqa,SAGpB,iBAApBxY,KAAK4hB,YACP5hB,KAAKgjB,aAAa7kB,EAAMoa,QAASpa,EAAMqa,SAGjB,0BAApBxY,KAAK4hB,YACP5hB,KAAKijB,sBAAsB9kB,EAAMoa,QAASpa,EAAMqa,SAAS,GAGnC,4BAApBxY,KAAK4hB,YACP5hB,KAAKijB,sBAAsB9kB,EAAMoa,QAASpa,EAAMqa,SAAS,MA9X/D,kBAqeE,SAAKra,GAEH,QAAwBjB,IAApB8C,KAAK4hB,WAAT,CAMA,GAAwB,eAApB5hB,KAAK4hB,WAA6B,CAEpC,GADA5hB,KAAK+hB,gBAAgBrF,KAAKve,IACa,IAAnC6B,KAAKgc,gBAAgB/B,UAAqB,CAC5C,IAAMlW,EAAQ0C,KACRuW,EAA8B,CAClCthB,KAAMuG,EAAaihB,oBACnBpJ,QAAS,CACPqJ,OAAQpf,EAAMO,YAAYxC,KAAI,SAAC3G,GAC7B,MAAO,CACLA,KACAioB,YAAY,QAKpBrJ,GAAUiD,OAEL,CACLhd,KAAK4iB,gBAAe,GACpB,IAAM7e,EAAQ0C,KACRE,EAAW0c,mBAAQtf,GAAO,SAACuf,GAC/B,IAAMtnB,EAAWunB,GACfxf,EAAMO,YAAYxC,KAAI,SAAC3G,GACrB,MAAO,CAAEA,KAAI6B,WAAY+G,EAAMM,QAAQlJ,GAAI6B,gBAG/CsmB,EAAMxe,GAAGsB,uBAAyBpK,KAEpC0K,GAASC,GACTwW,GAAkBxW,GAEpB3G,KAAKgc,gBAAgBU,OAGvB,GAAwB,oBAApB1c,KAAK4hB,WAEP,GADA5hB,KAAK4iB,gBAAe,IACmB,IAAnC5iB,KAAKgc,gBAAgB/B,UAAoB,CAAC,IAAD,UAC3C/V,GACE,yEAEF,IAAMsf,EAAQxjB,KAAKgc,gBAAgB1N,IAAI9T,EAAIwF,KAAKgc,gBAAgB7B,MAAM3f,EAChEipB,EAAQzjB,KAAKgc,gBAAgB1N,IAAI7T,EAAIuF,KAAKgc,gBAAgB7B,MAAM1f,EAChEmQ,EAAQ,oBACZ5K,KAAKsY,kBADO,iBACZ,EAAkB,UADN,iBACZ,EAAsB5L,cADV,iBACZ,EAA8B0M,gBADlB,aACZ,EAAwCje,UAD5B,aACkC+B,EAChD,QAAiBA,IAAb0N,EAAwB,CAC1B,IAAMsS,EAAMld,KAAK+c,yBAAyBnS,GAE1CmP,GACE/Z,KAAK0jB,qBAAL,CAA2B9Y,GAA3B,oBAAwCsS,IAAMsG,EAAOC,IA6BzDzjB,KAAKgc,gBAAgBU,WAChB,CAAC,IAAD,UACC9R,EAAQ,oBACZ5K,KAAKsY,kBADO,iBACZ,EAAkB,UADN,iBACZ,EAAsB5L,cADV,iBACZ,EAA8B0M,gBADlB,aACZ,EAAwCje,UAD5B,aACkC+B,EAChD,QAAiBA,IAAb0N,EACF,GACEsT,GAAa,gBACbA,GAAa,iBACbA,GAAa,cACbA,GAAa,cACb,CACA,IAAMna,EAAQ0C,KACRkd,OACwBzmB,IAA5B6G,EAAMM,QAAQuG,KAC2B,IAArC7G,EAAMM,QAAQuG,GAAU7N,SAE1BylB,GAAwB,EAC5Bze,EAAMO,YAAYpG,SAAQ,SAAC/C,IACU,IAA/B4I,EAAMM,QAAQlJ,GAAI4B,WACpBylB,GAAmB,OAGE,IAArBA,IAEiC,IAA1BmB,GACT5J,GACE/Z,KAAK4jB,yBAAyB,CAAChZ,QAAW1N,GAAW,QAQpD,CACL,IAAM6G,EAAQ0C,KACd,GAAiC,IAA7B1C,EAAMO,YAAYrG,OACpB8b,GAAU/Z,KAAKyiB,oCAAoC7X,QAC9C,CACL,IAAM+Y,OACwBzmB,IAA5B6G,EAAMM,QAAQuG,KAC2B,IAArC7G,EAAMM,QAAQuG,GAAU7N,SAE1BylB,GAAwB,EAC5Bze,EAAMO,YAAYpG,SAAQ,SAAC/C,IACU,IAA/B4I,EAAMM,QAAQlJ,GAAI4B,WACpBylB,GAAmB,OAGE,IAArBA,IAEiC,IAA1BmB,GACT5J,GAAU/Z,KAAKyiB,oCAAoC7X,KAS3D1G,GAAa,sDACblE,KAAKgc,gBAAgBU,OAIzB,GAAwB,qBAApB1c,KAAK4hB,WAEP,GADA5hB,KAAK4iB,gBAAe,IACmB,IAAnC5iB,KAAKgc,gBAAgB/B,UAAoB,CAAC,IAAD,UAE3C/V,GACE,wEAEF,IAAMsf,EAAQxjB,KAAKgc,gBAAgB1N,IAAI9T,EAAIwF,KAAKgc,gBAAgB7B,MAAM3f,EAChEipB,EAAQzjB,KAAKgc,gBAAgB1N,IAAI7T,EAAIuF,KAAKgc,gBAAgB7B,MAAM1f,EAChEmQ,EAAQ,oBACZ5K,KAAKsY,kBADO,iBACZ,EAAkB,UADN,iBACZ,EAAsB5L,cADV,iBACZ,EAA8B0M,gBADlB,aACZ,EAAwCje,UAD5B,aACkC+B,OAC/BA,IAAb0N,GACFmP,GAAU/Z,KAAK0jB,qBAAqB,CAAC9Y,GAAW4Y,EAAOC,IAUzDzjB,KAAKgc,gBAAgBU,WAChB,CAAC,IAAD,UACC9R,EAAQ,oBACZ5K,KAAKsY,kBADO,iBACZ,EAAkB,UADN,iBACZ,EAAsB5L,cADV,iBACZ,EAA8B0M,gBADlB,aACZ,EAAwCje,UAD5B,aACkC+B,EAChD,QAAiBA,IAAb0N,EACF,GACEsT,GAAa,gBACbA,GAAa,iBACbA,GAAa,cACbA,GAAa,cACb,CACA,IAAMna,EAAQ0C,KACRkd,OACwBzmB,IAA5B6G,EAAMM,QAAQuG,KAC2B,IAArC7G,EAAMM,QAAQuG,GAAU7N,SAG1BylB,GAAwB,EAC5Bze,EAAMO,YAAYpG,SAAQ,SAAC/C,IACU,IAA/B4I,EAAMM,QAAQlJ,GAAI4B,WACpBylB,GAAmB,OAGE,IAArBA,IAEiC,IAA1BmB,GACT5J,GACE/Z,KAAK4jB,yBAAyB,CAAChZ,QAAW1N,GAAW,QAQpD,CACL,IAAM6G,EAAQ0C,KACd,GAAiC,IAA7B1C,EAAMO,YAAYrG,OACpB8b,GAAU/Z,KAAKyiB,oCAAoC7X,QAC9C,CACL,IAAM+Y,OACwBzmB,IAA5B6G,EAAMM,QAAQuG,KAC2B,IAArC7G,EAAMM,QAAQuG,GAAU7N,SAE1BylB,GAAwB,EAC5Bze,EAAMO,YAAYpG,SAAQ,SAAC/C,IACU,IAA/B4I,EAAMM,QAAQlJ,GAAI4B,WACpBylB,GAAmB,OAGE,IAArBA,IAEiC,IAA1BmB,GACT5J,GAAU/Z,KAAKyiB,oCAAoC7X,KAS3D1G,GACE,8DAEFlE,KAAKgc,gBAAgBU,OAIzB,GAAwB,2BAApB1c,KAAK4hB,WAGP,GAFA5hB,KAAK4iB,gBAAe,IAEmB,IAAnC5iB,KAAKgc,gBAAgB/B,UAAoB,CAC3C/V,GACE,kFAEF,IAAMsf,EAAQxjB,KAAKgc,gBAAgB1N,IAAI9T,EAAIwF,KAAKgc,gBAAgB7B,MAAM3f,EAChEipB,EAAQzjB,KAAKgc,gBAAgB1N,IAAI7T,EAAIuF,KAAKgc,gBAAgB7B,MAAM1f,EAChEsJ,EAAQ0C,KACdsT,GAAU/Z,KAAK0jB,qBAAqB3f,EAAMO,YAAakf,EAAOC,SACjBvmB,IAAzC4Z,GAAS+M,eAAeC,eAC1BhN,GAAS+M,eAAeC,aAAaC,QAAQvpB,GAAKgpB,EAClD1M,GAAS+M,eAAeC,aAAaC,QAAQtpB,GAAKgpB,EAClD3M,GAAS+M,eAAeC,aAAaE,SAASxpB,GAAKgpB,EACnD1M,GAAS+M,eAAeC,aAAaE,SAASvpB,GAAKgpB,EACnD3M,GAAS+M,eAAeC,aAAaG,WAAWzpB,GAAKgpB,EACrD1M,GAAS+M,eAAeC,aAAaG,WAAWxpB,GAAKgpB,EACrD3M,GAAS+M,eAAeC,aAAaI,YAAY1pB,GAAKgpB,EACtD1M,GAAS+M,eAAeC,aAAaI,YAAYzpB,GAAKgpB,GAKxDzjB,KAAKgc,gBAAgBU,WAChB,CAAC,IAAD,WACC9R,GAAQ,oBACZ5K,KAAKsY,kBADO,iBACZ,EAAkB,UADN,iBACZ,EAAsB5L,cADV,kBACZ,EAA8B0M,gBADlB,cACZ,GAAwCje,UAD5B,aACkC+B,GAE9CghB,GAAa,gBACbA,GAAa,iBACbA,GAAa,cACbA,GAAa,gBAEbnE,GACE/Z,KAAK4jB,yBAAyB,CAAChZ,SAAW1N,GAAW,IAQzD8C,KAAKgc,gBAAgBU,OAyBzB,GAAwB,iBAApB1c,KAAK4hB,WACP,IAAuC,IAAnC5hB,KAAKgc,gBAAgB/B,UAAoB,CAC3C/V,GACE,8FAEF,IAAMsf,GAAQxjB,KAAKgc,gBAAgB1N,IAAI9T,EAAIwF,KAAKgc,gBAAgB7B,MAAM3f,EAChEipB,GAAQzjB,KAAKgc,gBAAgB1N,IAAI7T,EAAIuF,KAAKgc,gBAAgB7B,MAAM1f,EAChEsJ,GAAQ0C,KACdsT,GAAU/Z,KAAK0jB,qBAAqB3f,GAAMO,YAAakf,GAAOC,KAI9DzjB,KAAKgc,gBAAgBU,WAChB,CACL,IAAM3Y,GAAQ0C,KACRuW,GAA8B,CAClCthB,KAAMuG,EAAaihB,oBACnBpJ,QAAS,CACPqJ,OAAQpf,GAAMO,YAAYxC,KAAI,SAAC3G,GAC7B,MAAO,CACLA,KACAioB,YAAY,QAKpBrJ,GAAUiD,IAEVhd,KAAKgc,gBAAgBU,OAyBzB,GAAwB,0BAApB1c,KAAK4hB,WAAwC,CAC/C,GAAI1D,GAAa,cAAgBA,GAAa,cAC5C,IAAuC,IAAnCle,KAAKgc,gBAAgB/B,UAAqB,CAO5C,GANAja,KAAKsY,WAAatY,KAAK6c,8BACrB1e,EAAMoa,QACNpa,EAAMqa,SAERhb,QAAQkB,IAAI,KAAMsB,KAAKsY,YACUtY,KAAKsY,WAAWra,OAAS,EAC5B,CAC5B,IACMqkB,GADUtiB,KAAKsY,WAAW,GAAG5L,OAAO0M,SAChBje,GAC1B,QAAkB+B,IAAdolB,GAAyB,CAC3B,IAAMve,GAAQ0C,KACRkd,QACyBzmB,IAA7B6G,GAAMM,QAAQie,MAC4B,IAAtCve,GAAMM,QAAQie,IAAWvlB,SAE3BylB,IAAwB,EAC5Bze,GAAMO,YAAYpG,SAAQ,SAAC/C,IACU,IAA/B4I,GAAMM,QAAQlJ,GAAI4B,WACpBylB,IAAmB,OAGE,IAArBA,KAEiC,IAA1BmB,IACT5J,GACE/Z,KAAK4jB,yBAAyB,CAACtB,SAAYplB,GAAW,KAW9D8C,KAAKsY,WAAa,QAElB,QAAgCpb,IAA5B8C,KAAKmY,mBAAkC,CAAC,IAAD,GACJnY,KAAKmY,mBAAlCQ,GADiC,GACjCA,IAAKC,GAD4B,GAC5BA,KAAMjc,GADsB,GACtBA,MAAOD,GADe,GACfA,OAC1BsD,KAAK6hB,aAAajC,SAASe,KACvBxiB,EAAMoa,QAAUK,IAAQjc,GAAS,EAAI,IACpCwB,EAAMqa,QAAUG,IAAOjc,GAAU,EAAI,EACxC,GAEF,IAAMqH,GAAQ0C,KACV+b,IAAwB,EAM5B,GALAze,GAAMO,YAAYpG,SAAQ,SAAC/C,IACU,IAA/B4I,GAAMM,QAAQlJ,GAAI4B,WACpBylB,IAAmB,OAGE,IAArBA,QAEG,CAEL,IAAM2B,GAAiBnkB,KAAK6hB,aAAauC,YAEzCrK,GACE/Z,KAAK4jB,yBAAyBO,IAAgB,GAAM,KAa9DnkB,KAAKgc,gBAAgBU,OACrB1c,KAAKic,qBAAqBS,OAG5B,GAAwB,4BAApB1c,KAAK4hB,WAA0C,CACjD,GAAI1D,GAAa,YAAcA,GAAa,YAC1C,IAAuC,IAAnCle,KAAKgc,gBAAgB/B,UAAqB,CAM5C,GALAja,KAAKsY,WAAatY,KAAK6c,8BACrB1e,EAAMoa,QACNpa,EAAMqa,SAEyBxY,KAAKsY,WAAWra,OAAS,EAC5B,CAC5B,IACMqkB,GADUtiB,KAAKsY,WAAW,GAAG5L,OAAO0M,SAChBje,QACR+B,IAAdolB,IACFvI,GACE/Z,KAAK4jB,yBAAyB,CAACtB,KAAY,GAAO,IAaxDtiB,KAAKsY,WAAa,QAElB,QAAgCpb,IAA5B8C,KAAKmY,mBAAkC,CAAC,IAAD,GACJnY,KAAKmY,mBAAlCQ,GADiC,GACjCA,IAAKC,GAD4B,GAC5BA,KAAMjc,GADsB,GACtBA,MAAOD,GADe,GACfA,OAC1BsD,KAAK6hB,aAAajC,SAASe,KACvBxiB,EAAMoa,QAAUK,IAAQjc,GAAS,EAAI,IACpCwB,EAAMqa,QAAUG,IAAOjc,GAAU,EAAI,EACxC,GAGF,IAAMynB,GAAiBnkB,KAAK6hB,aAAauC,YAEzCrK,GACE/Z,KAAK4jB,yBAAyBO,IAAgB,GAAO,IAa7DnkB,KAAKgc,gBAAgBU,OACrB1c,KAAKic,qBAAqBS,OAuB5B1c,KAAK4hB,gBAAa1kB,KA3+BtB,kCAmjCE,SAAqBmnB,EAAqBb,EAAeC,GAAgB,IAAD,OAChE1f,EAAQ0C,KAERyW,EAAgB,GAChBiG,EAAsD,GA4C5D,OA3CAkB,EAAUnmB,SAAQ,SAAC0M,GACjB,IAAMpD,EAAc,EAAKuV,yBAAyBnS,QAClB1N,IAA5B6G,EAAMM,QAAQuG,KACe,IAA3BsS,EAAIiE,SAASvW,KACfsS,EAAI9e,KAAKwM,GACTuY,EAAO/kB,KAAK,CACVjD,GAAIyP,EACJ0Z,WAAY,CACVtoB,SAAU,CACRxB,EAAGuJ,EAAMM,QAAQuG,GAAU5O,SAASxB,EAAIgpB,EACxC/oB,EAAGsJ,EAAMM,QAAQuG,GAAU5O,SAASvB,EAAIgpB,EACxC/oB,EAAGqJ,EAAMM,QAAQuG,GAAU5O,SAAStB,OAM9C8M,EAAYtJ,SAAQ,SAAC/C,QACO+B,IAAtB6G,EAAMM,QAAQlJ,KACe,IAA3B+hB,EAAIiE,SAASvW,KACfsS,EAAI9e,KAAKwM,GACTuY,EAAO/kB,KAAK,CACVjD,GAAIA,EACJmpB,WAAY,CACVtoB,SAAU,CACRxB,EAAGuJ,EAAMM,QAAQlJ,GAAIa,SAASxB,EAAIgpB,EAClC/oB,EAAGsJ,EAAMM,QAAQlJ,GAAIa,SAASvB,EAAIgpB,EAClC/oB,EAAGqJ,EAAMM,QAAQuG,GAAU5O,SAAStB,aASZ,CACpCgB,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASqkB,MA/lCjB,iDAsmCE,SAAoChoB,GAAa,IAAD,OACxC4I,EAAQ0C,KACR0c,EAAmD,GAmCzD,OAjCApf,EAAMO,YAAYpG,SAAQ,SAACsmB,GACzB,IAAMhd,EAAc,EAAKuV,yBAAyByH,GAClDrB,EAAO/kB,KAAK,CACVjD,GAAIqpB,EACJpB,YAAY,IAEd5b,EAAYtJ,SAAQ,SAACumB,GACnBtB,EAAO/kB,KAAK,CACVjD,GAAIspB,EACJrB,YAAY,UAKlBD,EAAO/kB,KAAK,CACVjD,KACAioB,YAAY,IAEMpjB,KAAK+c,yBAAyB5hB,GACtC+C,SAAQ,SAACsmB,GACnBrB,EAAO/kB,KAAK,CACVjD,GAAIqpB,EACJpB,YAAY,OAIoB,CAClC1nB,KAAMuG,EAAaihB,oBACnBpJ,QAAS,CACPqJ,aAvoCR,sCA8oCE,SACEkB,EACAK,EACAC,GACC,IAAD,OACM5gB,EAAQ0C,KACR0c,EAAmD,GACnDyB,EAAa,OAAGD,QAAH,IAAGA,KA+CtB,OA3CAN,EAAUnmB,SAAQ,SAAC0M,GACjB,IAAM7N,OACwBG,IAA5B6G,EAAMM,QAAQuG,KACuB,IAArC7G,EAAMM,QAAQuG,GAAU7N,SAY1B,IACoB,IAAlB6nB,IACmB,IAAlBA,IAAwC,IAAb7nB,EAC5B,CACA,IAAMqmB,GAAsD,IAAzCrf,EAAMO,YAAY6c,SAASvW,GACxCia,OACe3nB,IAAnBwnB,GAAgCtB,EAAasB,EACzCld,EAAc,EAAKuV,yBAAyBnS,GAClDuY,EAAO/kB,KAAK,CACVjD,GAAIyP,EACJwY,WAAYyB,IAEdrd,EAAYtJ,SAAQ,SAAC/C,GACnBgoB,EAAO/kB,KAAK,CACVjD,GAAIA,EACJioB,WAAYyB,WAMgB,CAClCnpB,KAAMuG,EAAaihB,oBACnBpJ,QAAS,CACPqJ,aAhsCR,mCAusCE,SACE5K,EACAC,EACAsM,GACC,IAAD,EACiBnL,GAAcpB,EAASC,GAAhChe,EADR,EACQA,EAAGC,EADX,EACWA,EAEX,GADAuF,KAAKgc,gBAAgBI,OAAO5hB,EAAGC,QACCyC,IAA5B8C,KAAKmY,mBAAT,CAHA,MAMqCnY,KAAKmY,mBAAlCQ,EANR,EAMQA,IAAKC,EANb,EAMaA,KACP0C,GAPN,EAMmB3e,MANnB,EAM0BD,OACV6b,EAAUK,GACpB2C,EAAU/C,EAAUG,EAC1B3Y,KAAKic,qBAAqBG,OAAOd,EAASC,MAptC9C,8BAyuCE,SAAiBhD,EAAiBC,GAGhC,IAAMzU,EAAQ0C,KAHmC,EAKhCkT,GAAcpB,EAASC,GAAhChe,EALyC,EAKzCA,EAAGC,EALsC,EAKtCA,EACXuF,KAAKgc,gBAAgBI,OAAO5hB,EAAGC,GAE/B,IAAM+oB,EAAQxjB,KAAKgc,gBAAgB1N,IAAI9T,EAAIwF,KAAKgc,gBAAgB7B,MAAM3f,EAChEipB,EAAQzjB,KAAKgc,gBAAgB1N,IAAI7T,EAAIuF,KAAKgc,gBAAgB7B,MAAM1f,EAEhE4nB,EAAUriB,KAAKsY,WAAW,GAAG5L,OAAO0M,SACpCxO,EAAWyX,EAAQlnB,GACzB,QAAiB+B,IAAb0N,EAAJ,CAIA,IAAMhD,EAAM7D,EAAMM,QAAQuG,GAC1B,QAAY1N,IAAR0K,EAAJ,CAIA,IAAMlM,EAAOiP,GAA2BC,EAAUhD,EAAI5K,YACtD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GAClE,QAAewB,IAAXwP,EAAJ,CAKA,GAAI3I,EAAMM,QAAQuG,GAAU5N,aAAehD,EAAYiJ,OAAQ,CAC7D,IAAMgF,EAASlE,EAAMM,QAAQuG,IACE,IAA3B3C,EAAOmC,iBACLnC,EAAOoC,gBAAgBpM,OAAS,GAClCgK,EAAOoC,gBAAgBnM,SAAQ,SAAC/C,GAC9B,QAAW+B,IAAP/B,QAA0C+B,IAAtB6G,EAAMM,QAAQlJ,GAAmB,CACvD,IAAMK,EAAOuI,EAAMM,QAAQlJ,GAC3B,QAAa+B,IAAT1B,EAEF,YADAgC,QAAQ2G,KAAK,2BAA4ByG,GAG3C,IAAMlP,EAAOiP,GAA2BnP,EAAKL,GAAIK,EAAKwB,YACtD,QAAaE,IAATxB,EACF,OAEF,IAAMspB,EAAelO,GAASkC,MAAM+L,4BAClC,OACArpB,GAEF,QAAqBwB,IAAjB8nB,EAMF,YALAxnB,QAAQ2G,KACN,uCACAyG,EACAlP,GAIJspB,EAAahpB,SAASxB,EAAIuJ,EAAMM,QAAQlJ,GAAIa,SAASxB,EAAIgpB,EACzDwB,EAAahpB,SAASvB,EAAIsJ,EAAMM,QAAQlJ,GAAIa,SAASvB,EAAIgpB,MAQnE/W,EAAO1Q,SAASxB,EAAIuJ,EAAMM,QAAQuG,GAAU5O,SAASxB,EAAIgpB,EACzD9W,EAAO1Q,SAASvB,EAAIsJ,EAAMM,QAAQuG,GAAU5O,SAASvB,EAAIgpB,EAEzDzjB,KAAK4iB,gBAAe,QA3ClBplB,QAAQ2G,KAAK,uCAAwCyG,EAAUyX,SAT/D7kB,QAAQ2G,KAAK,kCAAmCyG,EAAUyX,QAL1D7kB,QAAQ2G,KAAK,qCAAsCke,KAvvCzD,6BAmzCE,SAAgB9J,EAAiBC,GAG/B,IAAMzU,EAAQ0C,KAHkC,EAK/BkT,GAAcpB,EAASC,GAAhChe,EALwC,EAKxCA,EAAGC,EALqC,EAKrCA,EAEXuF,KAAKgc,gBAAgBI,OAAO5hB,EAAGC,GAE/B,IAAM+oB,EAAQxjB,KAAKgc,gBAAgB1N,IAAI9T,EAAIwF,KAAKgc,gBAAgB7B,MAAM3f,EAChEipB,EAAQzjB,KAAKgc,gBAAgB1N,IAAI7T,EAAIuF,KAAKgc,gBAAgB7B,MAAM1f,EAEhE4nB,EAAUriB,KAAKsY,WAAW,GAAG5L,OAAO0M,SACtCxO,EAAWyX,EAAQlnB,GACvB,QAAiB+B,IAAb0N,EAAJ,CAIA,IAAItD,EAAQvD,EAAMM,QAAQuG,GAC1B,QAAc1N,IAAVoK,EAAJ,MASwBpK,IAAtBoK,EAAK,SAA8BA,EAAK,QAAarJ,OAAS,IAG9D2M,EAAWtD,EAAK,QAChBA,EAAQvD,EAAMM,QAAQuG,IAGxB,IAAMlP,EAAOiP,GAA2BC,EAAUtD,EAAMtK,YACxD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,GAIJA,EAAO1Q,SAASxB,EAAIuJ,EAAMM,QAAQuG,GAAU5O,SAASxB,EAAIgpB,EACzD9W,EAAO1Q,SAASvB,EAAIsJ,EAAMM,QAAQuG,GAAU5O,SAASvB,EAAIgpB,EAExDnc,EAAgBE,YAAYtJ,SAAQ,SAAC/C,GACpC,IAAM8d,EAAkClV,EAAMM,QAAQlJ,GACtD,QAAiB+B,IAAb+b,EAAJ,CAIA,IAAMvd,EAAOiP,GAA2BsO,EAAS9d,GAAI8d,EAASjc,YAC9D,QAAaE,IAATxB,EAAJ,CAGA,IAAMupB,EAAQnO,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAV+nB,GAIJA,EAAMjpB,SAASxB,EAAIuJ,EAAMM,QAAQlJ,GAAIa,SAASxB,EAAIgpB,EAClDyB,EAAMjpB,SAASvB,EAAIsJ,EAAMM,QAAQlJ,GAAIa,SAASvB,EAAIgpB,GAJhDjmB,QAAQ2G,KAAK,uCAAwChJ,EAAIO,SATzD8B,QAAQ2G,KAAK,2BAA4BhJ,MAgB7C6E,KAAK4iB,gBAAe,IAzBlBplB,QAAQ2G,KAAK,uCAAwCyG,SArBrDpN,QAAQ2G,KAAK,kCAAmCyG,QALhDpN,QAAQ2G,KAAK,qCAAsCke,KAl0CzD,0BAw3CE,SAAa9J,EAAiBC,GAC5BxY,KAAK6iB,uBAAuBtK,EAASC,GAIvB/R,OA73ClB,oCAq5CE,SAAuB8R,EAAiBC,GAAiB,MAItCmB,GAAcpB,EAASC,GAAhChe,EAJ+C,EAI/CA,EAAGC,EAJ4C,EAI5CA,EACXuF,KAAKgc,gBAAgBI,OAAO5hB,EAAGC,GAE/B,IAAM+oB,EAAQxjB,KAAKgc,gBAAgB1N,IAAI9T,EAAIwF,KAAKgc,gBAAgB7B,MAAM3f,EAChEipB,EAAQzjB,KAAKgc,gBAAgB1N,IAAI7T,EAAIuF,KAAKgc,gBAAgB7B,MAAM1f,EAGhEsJ,EAAQ0C,KAEd1C,EAAMO,YAAYpG,SAAQ,SAAC0M,GACzB,IAAMhD,EAA6B7D,EAAMM,QAAQuG,GACjD,QAAY1N,IAAR0K,EAAJ,CAIA,IAAMlM,EAAOiP,GAA2B/C,EAAIzM,GAAIyM,EAAI5K,YACpD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GAClE,QAAewB,IAAXwP,EAAJ,CAKA,GAAI3I,EAAMM,QAAQuG,GAAU5N,aAAehD,EAAYiJ,OAAQ,CAC7D,QAA6C/F,IAAzC4Z,GAAS+M,eAAeC,aAC1B,IAAK,IAAIzQ,EAAIyD,GAASkC,MAAMC,SAAShb,OAAS,EAAGoV,GAAK,EAAGA,IACvD,GAA+C,IAA3CyD,GAASkC,MAAMC,SAAS5F,GAAG6R,OAAOC,KAAY,CAChD,IAAMzpB,EAAOob,GAASkC,MAAMC,SAAS5F,GAAG+F,SAA3B,KAEbtC,GAASkC,MAAMC,SAAS5F,GAAGrX,SAASxB,EAClCsc,GAAS+M,eAAeC,aAAapoB,GAAMlB,EAAIgpB,EAEjD1M,GAASkC,MAAMC,SAAS5F,GAAGrX,SAASvB,EAClCqc,GAAS+M,eAAeC,aAAapoB,GAAMjB,EAAIgpB,EAIvD,IAAMxb,EAASlE,EAAMM,QAAQuG,IACE,IAA3B3C,EAAOmC,iBACLnC,EAAOoC,gBAAgBpM,OAAS,GAClCgK,EAAOoC,gBAAgBnM,SAAQ,SAAC/C,GAC9B,QAAW+B,IAAP/B,QAA0C+B,IAAtB6G,EAAMM,QAAQlJ,GAAmB,CACvD,IAAMK,EAAOuI,EAAMM,QAAQlJ,GAC3B,QAAa+B,IAAT1B,EAEF,YADAgC,QAAQ2G,KAAK,2BAA4ByG,GAG3C,IAAMlP,EAAOiP,GACXnP,EAAKL,GACLK,EAAKwB,YAEP,QAAaE,IAATxB,EACF,OAEF,IAAMspB,EAAelO,GAASkC,MAAM+L,4BAClC,OACArpB,GAEF,QAAqBwB,IAAjB8nB,EAMF,YALAxnB,QAAQ2G,KACN,uCACAyG,EACAlP,GAIJspB,EAAahpB,SAASxB,EAAIuJ,EAAMM,QAAQlJ,GAAIa,SAASxB,EAAIgpB,EACzDwB,EAAahpB,SAASvB,EAAIsJ,EAAMM,QAAQlJ,GAAIa,SAASvB,EAAIgpB,MAOnE/W,EAAO1Q,SAASxB,EAAIuJ,EAAMM,QAAQuG,GAAU5O,SAASxB,EAAIgpB,EACzD9W,EAAO1Q,SAASvB,EAAIsJ,EAAMM,QAAQuG,GAAU5O,SAASvB,EAAIgpB,OAxDvDjmB,QAAQ2G,KAAK,uCAAwCyG,EAAUlP,SAT/D8B,QAAQ2G,KAAK,2BAA4ByG,MAoE7C5K,KAAK4iB,gBAAe,KAz+CxB,4BA8/CE,SAAewC,IACG,IAAZA,EACFplB,KAAKqlB,aAELrlB,KAAKslB,eAlgDX,wBAsgDE,WACE,IACMC,EAASzK,SAAS0K,cADP,6BAEF,OAAXD,IAGJA,EAAOvK,MAAMyK,QAAU,UA5gD3B,wBA+gDE,WACE,IACMF,EAASzK,SAAS0K,cADP,6BAEF,OAAXD,IAGJA,EAAOvK,MAAMyK,QAAU,aArhD3B,GAAuDvN,ICxB1CwN,GAAb,oDAME,aAAe,IAAD,+BACZ,gBANF7J,oBAKc,IAJdC,4BAIc,IAHdC,qBAGc,IAFd5D,wBAEc,EAEZ,EAAKA,wBAAqBjb,EAC1B,EAAK2e,gBAAiB,EACtB,EAAKC,uBAAyB,IAAIhgB,IAClC,EAAKigB,gBAAkB,IAAIjgB,IALf,EANhB,4CAcE,SAAQqC,MAdV,sBAgBE,SAASA,MAhBX,oBAkBE,SAAOA,GAGL,GAFA6B,KAAK6b,gBAAiB,EAEF,OAAhB/E,GAAS2B,GAAb,CAIAzY,KAAKmY,mBAAqBrB,GAAS2B,GAAGC,wBAPZ,MAQJ1Y,KAAKmY,mBAAnBQ,EARkB,EAQlBA,IAAKC,EARa,EAQbA,KAEP0C,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAEhC3Y,KAAK8b,uBAAuBthB,EAAI8gB,EAChCtb,KAAK8b,uBAAuBrhB,EAAI8gB,EAEhCvb,KAAK+b,gBAAgBvhB,EAAIsc,GAASgC,OAAO9c,SAASxB,EAClDwF,KAAK+b,gBAAgBthB,EAAIqc,GAASgC,OAAO9c,SAASvB,KAnCtD,oBAsCE,SAAO0D,GACL,QAAgCjB,IAA5B8C,KAAKmY,qBAImB,IAAxBnY,KAAK6b,eAAyB,CAAC,IAE3B3a,GAAQykB,EADO3N,GAAb2N,YADwB,EAIV3lB,KAAKmY,mBAAnBQ,EAJwB,EAIxBA,IAAKC,EAJmB,EAInBA,KACP0C,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAC1B0I,EAAangB,EAAM4D,GAAGY,UAKtB4b,GAHmBthB,KAAK8b,uBAAuBthB,EAAI8gB,GAGP+F,EAC5CE,GAHmBvhB,KAAK8b,uBAAuBrhB,EAAI8gB,GAGP8F,EAE5CG,EAAUxhB,KAAK+b,gBAAgBvhB,EAAI8mB,EACnCG,EAAUzhB,KAAK+b,gBAAgBthB,EAAI8mB,EAEzCzK,GAASgC,OAAO9c,SAASxB,EAAIgnB,EAC7B1K,GAASgC,OAAO9c,SAASvB,EAAIgnB,EAC7B3K,GAASgC,OAAO4I,OAAOF,EAASC,EAAS,MA/D/C,kBAmEE,SAAKtjB,GACH6B,KAAKmY,wBAAqBjb,GACE,IAAxB8C,KAAK6b,iBACP7b,KAAK6b,gBAAiB,OAtE5B,GAA+C3D,ICKlC0N,GAAb,oDAWE,aAAe,IAAD,+BACZ,gBAXF/J,oBAUc,IATdC,4BASc,IARdC,qBAQc,IAPd5D,wBAOc,IANd6D,qBAMc,IALd5D,WAKc,IAJdC,eAIc,IAHd4D,0BAGc,EAEZ,EAAK9D,wBAAqBjb,EAC1B,EAAK2e,gBAAiB,EACtB,EAAKC,uBAAyB,IAAIhgB,IAClC,EAAKigB,gBAAkB,IAAIjgB,IAC3B,EAAKkgB,gBAAkB,IAAIhC,GAC3B,EAAK5B,MAAQ,IAAItc,IACjB,EAAKuc,UAAY,IAAIvc,IAErB,EAAKmgB,qBAAuB,IAAI1B,GAChC,EAAK0B,qBAAqBC,YAAYpF,GAAS2D,UAXnC,EAXhB,4CAyBE,SAAQtc,MAzBV,sBA2BE,SAASA,MA3BX,oBA6BE,SAAOA,GACe,OAAhB2Y,GAAS2B,KACXzY,KAAKmY,mBAAqBrB,GAAS2B,GAAGC,yBAFd,MAITiB,GAAcxb,EAAMoa,QAASpa,EAAMqa,SAA5Che,EAJkB,EAIlBA,EAAGC,EAJe,EAIfA,EACXuF,KAAKgc,gBAAgBG,OAAO3hB,EAAGC,KAlCnC,oBAqCE,SAAO0D,GAAsB,IACnBwnB,EAAuB3N,GAAvB2N,SAAuB3N,GAAboF,SACJuI,IAEd,QAAgCzoB,IAA5B8C,KAAKmY,qBAIkC,IAAvCnY,KAAKgc,gBAAgB9B,cAAwB,CAAC,IAAD,EACVla,KAAKmY,mBAAlCxb,EADuC,EACvCA,MAAOD,EADgC,EAChCA,OAAQic,EADwB,EACxBA,IAAKC,EADmB,EACnBA,KAE5B5Y,KAAKoY,MAAM5d,GAAM2D,EAAMoa,QAAUK,GAAQjc,EAAS,EAAI,EACtDqD,KAAKoY,MAAM3d,IAAO0D,EAAMqa,QAAUG,GAAOjc,EAAU,EAAI,EAEvDsD,KAAKqY,UAAUQ,cAAc7Y,KAAKoY,MAAOtB,GAASgC,QAC/B9Y,KAAKqY,UAAUU,iBAChCjC,GAASkC,MAAMC,UACf,GAFF,IAkCMqC,EAAUnd,EAAMoa,QAAUK,EAC1B2C,EAAUpd,EAAMqa,QAAUG,EAChC3Y,KAAKic,qBAAqBG,OAAOd,EAASC,MAxFhD,kBA4FE,SAAKpd,GAAsB,IACjBwnB,EAAuB3N,GAAvB2N,SAAuB3N,GAAboF,SACJuI,IACd,IAAuC,IAAnC3lB,KAAKgc,gBAAgB/B,gBAElB,IAC8B,IAAnCja,KAAKgc,gBAAgB/B,YACkB,IAAvCja,KAAKgc,gBAAgB9B,cACrB,CACA,QAAgChd,IAA5B8C,KAAKmY,mBACP,OAFF,MAIqCnY,KAAKmY,mBAAlCxb,EAJR,EAIQA,MAAOD,EAJf,EAIeA,OAAQic,EAJvB,EAIuBA,IAAKC,EAJ5B,EAI4BA,KAE5B5Y,KAAKoY,MAAM5d,GAAM2D,EAAMoa,QAAUK,GAAQjc,EAAS,EAAI,EACtDqD,KAAKoY,MAAM3d,IAAO0D,EAAMqa,QAAUG,GAAOjc,EAAU,EAAI,EAEvDsD,KAAKqY,UAAUQ,cAAc7Y,KAAKoY,MAAOtB,GAASgC,QAC/B9Y,KAAKqY,UAAUU,iBAChCjC,GAASkC,MAAMC,UACf,GAuBJjZ,KAAKgc,gBAAgBU,OACrB1c,KAAKic,qBAAqBS,WAxI9B,GAAgDxE,ICiBnC2N,GAAb,oDAYE,aAAe,IAAD,+BACZ,gBAZFhK,oBAWc,IAVdC,4BAUc,IATdC,qBASc,IARd5D,wBAQc,IAPd6D,qBAOc,IANd5D,WAMc,IALdC,eAKc,IAJdwJ,kBAIc,IAHd5F,0BAGc,IAFd6F,kBAEc,EAEZ,EAAK3J,wBAAqBjb,EAC1B,EAAK2e,gBAAiB,EACtB,EAAKC,uBAAyB,IAAIhgB,IAClC,EAAKigB,gBAAkB,IAAIjgB,IAC3B,EAAKkgB,gBAAkB,IAAIhC,GAC3B,EAAK5B,MAAQ,IAAItc,IACjB,EAAKuc,UAAY,IAAIvc,IAErB,EAAKmgB,qBAAuB,IAAI1B,GAChC,EAAK0B,qBAAqBC,YAAYpF,GAAS2D,UAE/C,EAAKoH,aAAe,IAAIlD,GACxB,EAAKkD,aAAaG,UAAUlL,GAASgC,QACrC,EAAK+I,aAAaI,SAASnL,GAASkC,OAfxB,EAZhB,4CA8BE,SAAQ7a,MA9BV,sBAgCE,SAASA,MAhCX,oBAkCE,SAAOA,MAlCT,oBAoCE,SAAOA,MApCT,kBAsCE,SAAKA,QAtCP,GAAyD+Z,ICzBrD4N,QAA2C5oB,EAIlC6oB,GAA2B,SAACxN,EAAkBC,GACzD,GAAKD,GAAYC,EAEV,CACL,IAAMwN,EAAS,IAAIlqB,IACnBkqB,EAAOxrB,EAAI+d,EACXyN,EAAOvrB,EAAI+d,EACXsN,GAAgBE,OALhBF,QAAgB5oB,GNmCpB,SAAS+oB,GAAQ9nB,GAEf,GADAA,EAAM+nB,iBACc,OAAhBpP,GAAS2B,GAAb,CAIA,IAAM1U,EAAQ0C,KA0CR0f,EAAsC,CAC1CzqB,KAAMuG,EAAamkB,qBACnBtM,QAAS,CACPuM,SAAU,eACVC,cAAc,EACd/N,QAASpa,EAAMoa,QACfC,QAASra,EAAMqa,QACf+N,YAAapoB,EAAMmc,SAGvBP,GAAUoM,GAENpiB,EAAMe,GAAGa,OAAS1L,EAAWusB,KAC/BpI,GAAoB6H,QAAQ9nB,GACnB4F,EAAMe,GAAGa,OAAS1L,EAAW2L,aACtCyY,GAA4B4H,QAAQ9nB,GAC3B4F,EAAMe,GAAGa,OAAS1L,EAAWwsB,YACtClI,GAAsB0H,QAAQ9nB,GACrB4F,EAAMe,GAAGa,OAAS1L,EAAWysB,WACtCpI,GAAqB2H,QAAQ9nB,GACpB4F,EAAMe,GAAGa,OAAS1L,EAAW0sB,UACtCnI,GAAyByH,QAAQ9nB,GACxB4F,EAAMe,GAAGa,OAAS1L,EAAW2sB,SACtCnI,GAAuBwH,QAAQ9nB,GACtB4F,EAAMe,GAAGa,OAAS1L,EAAW4sB,gBACtCnI,GAA8BuH,QAAQ9nB,IAI1C,SAAS2oB,GAAe3oB,GACtB,GAAoB,OAAhB2Y,GAAS2B,GAAa,CAAC,IAAD,EACE3B,GAAS2B,GAAGC,wBAA9B/b,EADgB,EAChBA,MAAOD,EADS,EACTA,OACfoa,GAASgC,OAAOF,KAAOjc,GAAS,EAChCma,GAASgC,OAAO2H,MAAQ9jB,EAAQ,EAChCma,GAASgC,OAAOH,IAAMjc,EAAS,EAC/Boa,GAASgC,OAAOiO,OAASrqB,GAAU,EACnCoa,GAASgC,OAAOwH,yBAChBxJ,GAAS2D,SAASuM,QAAQrqB,EAAOD,GAGnC,IAAMqH,EAAQ0C,KACV1C,EAAMe,GAAGa,OAAS1L,EAAWusB,KAC/BpI,GAAoB6I,SAAS9oB,GACpB4F,EAAMe,GAAGa,OAAS1L,EAAW2L,aACtCyY,GAA4B4I,SAAS9oB,GAC5B4F,EAAMe,GAAGa,OAAS1L,EAAWwsB,YACtClI,GAAsB0I,SAAS9oB,GACtB4F,EAAMe,GAAGa,OAAS1L,EAAWysB,WACtCpI,GAAqB2I,SAAS9oB,GACrB4F,EAAMe,GAAGa,OAAS1L,EAAW0sB,UACtCnI,GAAyByI,SAAS9oB,GACzB4F,EAAMe,GAAGa,OAAS1L,EAAW2sB,SACtCnI,GAAuBwI,SAAS9oB,GACvB4F,EAAMe,GAAGa,OAAS1L,EAAW4sB,gBACtCnI,GAA8BuI,SAAS9oB,GAI3C,SAAS+oB,GAAc/oB,GACrB,IAAM4F,EAAQ0C,KAEV1C,EAAMe,GAAGa,OAAS1L,EAAWusB,KAC/BpI,GAAoBjC,OAAOhe,GAClB4F,EAAMe,GAAGa,OAAS1L,EAAW2L,aACtCyY,GAA4BlC,OAAOhe,GAC1B4F,EAAMe,GAAGa,OAAS1L,EAAWwsB,YACtClI,GAAsBpC,OAAOhe,GACpB4F,EAAMe,GAAGa,OAAS1L,EAAWysB,WACtCpI,GAAqBnC,OAAOhe,GACnB4F,EAAMe,GAAGa,OAAS1L,EAAW0sB,UACtCnI,GAAyBrC,OAAOhe,GACvB4F,EAAMe,GAAGa,OAAS1L,EAAW2sB,SACtCnI,GAAuBtC,OAAOhe,GACrB4F,EAAMe,GAAGa,OAAS1L,EAAW4sB,gBACtCnI,GAA8BvC,OAAOhe,GAIzC,SAASgpB,GAAYhpB,GACnB,IAAM4F,EAAQ0C,KACV1C,EAAMe,GAAGa,OAAS1L,EAAW2sB,SAC/BnI,GAAuB/B,KAAKve,GACnB4F,EAAMe,GAAGa,OAAS1L,EAAWusB,KACtCpI,GAAoB1B,KAAKve,GAChB4F,EAAMe,GAAGa,OAAS1L,EAAW2L,aACtCyY,GAA4B3B,KAAKve,GACxB4F,EAAMe,GAAGa,OAAS1L,EAAWwsB,YACtClI,GAAsB7B,KAAKve,GAClB4F,EAAMe,GAAGa,OAAS1L,EAAWysB,WACtCpI,GAAqB5B,KAAKve,GACjB4F,EAAMe,GAAGa,OAAS1L,EAAW0sB,UACtCnI,GAAyB9B,KAAKve,GACrB4F,EAAMe,GAAGa,OAAS1L,EAAW4sB,gBACtCnI,GAA8BhC,KAAKve,GAIvC,SAASipB,GAAajpB,GACpB4nB,QAAyB7oB,OAAWA,GACpCiqB,GAAYhpB,GAGd,SAASkpB,GAAclpB,GACrB4nB,GAAyB5nB,EAAMoa,QAASpa,EAAMqa,SAE9C,IAAMzU,EAAQ0C,KAEV1C,EAAMe,GAAGa,OAAS1L,EAAWusB,KAC/BpI,GAAoBhC,OAAOje,GAClB4F,EAAMe,GAAGa,OAAS1L,EAAW2L,aACtCyY,GAA4BjC,OAAOje,GAC1B4F,EAAMe,GAAGa,OAAS1L,EAAWysB,WACtCpI,GAAqBlC,OAAOje,GACnB4F,EAAMe,GAAGa,OAAS1L,EAAW0sB,UACtCnI,GAAyBpC,OAAOje,GACvB4F,EAAMe,GAAGa,OAAS1L,EAAWwsB,YACtClI,GAAsBnC,OAAOje,GACpB4F,EAAMe,GAAGa,OAAS1L,EAAW2sB,SACtCnI,GAAuBrC,OAAOje,GACrB4F,EAAMe,GAAGa,OAAS1L,EAAW4sB,gBACtCnI,GAA8BtC,OAAOje,GOhNlC,IC0JH0C,GCvJOymB,GCiBAxQ,GHpBEyQ,GAAgC,WAC3C,IAAMC,EAAiB1Q,GAAS2B,GAAGC,wBAG7B+O,EAAKD,EAAe5O,KACpB8O,EAAKF,EAAe5O,KAHhB,GAIJ+O,EAAKH,EAAe7O,IACpBiP,EAAKJ,EAAe7O,IAJhB,GAKJkP,EAAOlO,GAAc8N,EAAIE,GACzBG,EAAOnO,GAAc+N,EAAIE,GACzBG,EAAOjf,KAAKW,IAAIoe,EAAKrtB,EAAGstB,EAAKttB,GAC7B6hB,EAAOvT,KAAKS,IAAIse,EAAKrtB,EAAGstB,EAAKttB,GAC7B8hB,EAAOxT,KAAKS,IAAIse,EAAKptB,EAAGqtB,EAAKrtB,GAC7ButB,EAAOlf,KAAKW,IAAIoe,EAAKptB,EAAGqtB,EAAKrtB,GAanC,MAZmC,CACjC8O,IAAK,CACH/O,EAAG6hB,EACH5hB,EAAG6hB,GAEL7S,IAAK,CACHjP,EAAGutB,EACHttB,EAAGutB,GAELC,EAAGF,EAAO1L,EACV6L,EAAGF,EAAO1L,IC+CD6L,GAAb,kDACEnqB,OAA6B,GAD/B,KAEEuK,MAAgB,EAFlB,KAGE6f,kBAA4B,IAH9B,yCAIE,SAAKC,GACH,IAAMxZ,EAAM7O,KAAKhC,OAAOC,OAMxB,GALI4Q,IAAQ7O,KAAKuI,OACfvI,KAAKhC,OAAO8P,OAAO9N,KAAKuI,MAAOsG,EAAM7O,KAAKuI,OAE5CvI,KAAKhC,OAAOI,KAAKiqB,GACjBroB,KAAKuI,OAAS,EACVvI,KAAKhC,OAAOC,OAAS+B,KAAKooB,kBAAmB,CAC/C,IAAME,EAAOtoB,KAAKhC,OAAOC,OAAS+B,KAAKooB,kBACvCpoB,KAAKhC,OAAO8P,OAAO,EAAGwa,GACtBtoB,KAAKuI,MAAQvI,KAAKuI,MAAQ+f,KAdhC,mBAiBE,WACE,IAAMnqB,EAAQ6B,KAAKhC,OAAOgC,KAAKuI,OAK/B,OAJAvI,KAAKuI,OAAS,EACVvI,KAAKuI,MAAQvI,KAAKhC,OAAOC,SAC3B+B,KAAKuI,MAAQvI,KAAKhC,OAAOC,QAEpBE,IAvBX,kBAyBE,WACE,IAAMA,EAAQ6B,KAAKhC,OAAOgC,KAAKuI,MAAQ,GAKvC,OAJAvI,KAAKuI,OAAS,EACVvI,KAAKuI,OAAS,IAChBvI,KAAKuI,MAAQ,GAERpK,IA/BX,oCAiCE,WAA0B,IAAD,OACvB,OAAO6B,KAAKhC,OAAO8D,KAAI,SAAC4Q,EAAGW,GACzB,MAAO,CACL3X,KAAMgX,EAAE6V,GAAG7sB,KACX8sB,SAAUnV,EAAI,EAAK9K,MACnBkgB,UAAW/V,EAAE+V,gBAtCrB,qBA0CE,WACE,OAAOzoB,KAAKuI,QAAUvI,KAAKhC,OAAOC,SA3CtC,qBA6CE,WACE,OAAO+B,KAAKuI,MAAQ,MA9CxB,KAkDamgB,GAAc,WACzB,IACMC,EADUC,KACUC,YACR3rB,IAAdyrB,GACF5O,GAAU4O,EAAUG,MAAM,IAIjBC,GAAc,WACzB,IACMJ,EADUC,KACUI,aACR9rB,IAAdyrB,GACF5O,GAAU4O,EAAUM,MAAM,IA2BjBL,GAAa,WACxB,OAAO/nB,IC5JIqoB,GAA0B,WACrC,IACE,IAAMC,EAASrO,SAASC,cAAc,OACtCoO,EAAO/T,aAAa,KAAM,2BAC1BkS,GAAsB,IAAI8B,GAAoBD,GAC9CA,EAAOzN,YAAY4L,GAAoB7M,SAASe,YAChD2N,EAAOnO,MAAMyK,QAAU,OACvB3K,SAASnc,KAAK+c,YAAYyN,GAE1B,MAAO7rB,GACPE,QAAQC,MAAM,+BAAgCH,EAAI+rB,cAIhDD,G,WAMJ,WAAY3Q,GAAkB,0BAL9BA,QAK6B,OAH7BO,WAG6B,OAF7ByB,cAE6B,OAD7B6O,WAC6B,EAC3BtpB,KAAKyY,GAAKA,EACVzY,KAAKspB,MAAQ,GAebtpB,KAAKgZ,MAAQ,IAAIld,IACjBkE,KAAKgZ,MAAMkC,WAAa,IAAIpf,IAAY,QAExCkE,KAAKya,SAAW,IAAI3e,IAAoB,CACtCytB,WAAW,EACXC,uBAAuB,I,uDAK3B,SACE9c,EACA+c,EACAC,GAEC,IADDC,EACA,wDACMC,EAAiB,CACrBH,WACAC,YACA/sB,MAAO+P,EAAO/P,MACdD,OAAQgQ,EAAOhQ,OACfE,MAAO8P,EAAO9P,MACdP,QAASqQ,EAAOrQ,QAChBC,QAASoQ,EAAOpQ,QAChBC,QAASmQ,EAAOnQ,SAEdmQ,EAAO1P,aAAehD,EAAYsB,OACpCsuB,EAAU3tB,KAAQyQ,EAAgBzQ,KAClC2tB,EAAUntB,MAASiQ,EAAgBjQ,OAGrC,IAAMotB,EAAUjrB,KAAKC,UAAU+qB,GAC/B,IAAmB,IAAfD,QAA+CzsB,IAAxB8C,KAAKspB,MAAMO,GAAwB,CAC5D,IAAMC,EAAU9pB,KAAK+pB,sBAAsBrd,EAAQ+c,EAAUC,GAC7D,QAAgBxsB,IAAZ4sB,EACF,OAEA9pB,KAAKspB,MAAMO,GAAWC,EAG1B,OAAO9pB,KAAKspB,MAAMO,K,mCAGpB,SACEnd,EACA+c,EACAC,GACC,IAAD,OACA,IAKE,GAJA1pB,KAAKya,SAASuM,QAAQyC,EAAUC,GAEhC1pB,KAAKgZ,MAAMgR,QAEPtd,EAAO1P,aAAehD,EAAYsB,KAEpC,YADAkC,QAAQ2G,KAAK,uCAIf,IAAM8lB,EAAWC,GAAsBxd,EAAgB1M,KAAKgZ,OAE5D,QAAiB9b,IAAb+sB,EAEF,YADAzsB,QAAQ2G,KAAK,qDAIf8lB,EAASjuB,SAASxB,EAAI,EACtByvB,EAASjuB,SAASvB,EAAI,EAEtB,IAAM6b,EAAO,IAAIxa,IACjBwa,EAAK6T,eAAeF,GAEpB,IAAIttB,EAAQ,EACRD,EAAS,EAGT4Z,IACF3Z,EAAQmM,KAAK4Q,IAAIpD,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,GACvCkC,EAASoM,KAAK4Q,IAAIpD,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,IAI1C,IACM2vB,EAAaX,EAAWC,EAC1BW,EAAY,EACZC,EAAa,EACbF,EAJgBztB,EAAQD,EAM1B4tB,GADAD,EAAY1tB,GACaytB,EAGzBC,GADAC,EAAa5tB,GACY0tB,EAE3B,IAAMG,GAAaF,EAAwB,GAAZA,GAAmB,EAC5CG,GAAcF,EAA0B,GAAbA,GAAoB,EAE/CxR,EAAS,IAAIhd,KACJ,EAAbyuB,EACAA,EACAC,GACc,EAAdA,EACA,EACA,KAGF1R,EAAO9c,SAAS2kB,IAAI,EAAG,EAAG,KAC1B7H,EAAO4I,OAAO,EAAG,EAAG,GAENjb,KACR3B,GAAGe,OAAO3H,SAAQ,SAACusB,GACvBC,GAAeD,EAAa,EAAKzR,UAGnChZ,KAAKya,SAASkQ,OAAO3qB,KAAKgZ,MAAOF,GAEjC,IACMgR,EAAU9pB,KAAKya,SAASe,WAAWoP,UADvB,aAYlB,OAFA5qB,KAAKgZ,MAAMgR,QAEJF,EAMP,MAAOpX,GAEP,YADAlV,QAAQkB,IAAI,4BAA6BgU,Q,KCpIzCmY,GAAa,yCAAG,WACpBpS,EACAqS,EACAC,GAHoB,gBAAA7b,EAAA,yDAKT,OAAPuJ,EALgB,uBAMlBvU,GAAY,4BANM,iCAUoB,IAApCuU,EAAGuS,UAAUC,SAAS,WACxBxS,EAAGuS,UAAU/U,IAAI,UAXC,SAelB/R,GAAa,qB/B+GfH,GAAQyC,oBAAUpC,I6BZlBvD,GAAU,IAAIsnB,GEhGZzK,KACAxZ,GAAW,qBACX4S,GAAW,IAAIoU,GAASzS,EAAIqS,EAAQC,GACpCtS,EAAGiD,YAAY5E,GAAS2D,SAASe,YArBf,UAsBZ3E,GAAcC,IAtBF,QVpBpB+G,OAAOI,iBAAiB,SAAU6I,IAAgB,GAElDhQ,GAAS2B,GAAGwF,iBAAiB,cAAeiJ,IAAe,GAC3DpQ,GAAS2B,GAAGwF,iBAAiB,cAAeoJ,IAAe,GAC3DvQ,GAAS2B,GAAGwF,iBAAiB,YAAakJ,IAAa,GACvDrQ,GAAS2B,GAAGwF,iBAAiB,WAAYmJ,IAAc,GACvDtQ,GAAS2B,GAAGwF,iBAAiB,QAASgI,IAAS,GAE/C7H,GAAsB,IAAIsH,GAC1BrH,GAA8B,IAAIsD,GAClCrD,GAAuB,IAAIsH,GAC3BrH,GAAwB,IAAI5B,GAC5B6B,GAA2B,IAAI5C,GAC/B6C,GAAyB,IAAIhF,GAC7BiF,GAAgC,IAAImH,GU8BlCsF,KACAC,sBAAsBC,IAEtBnnB,GAAW,qBAELonB,EAA6B/D,KACnCzQ,GAASgC,OAAOM,SAAW,CAAEiI,WAAY,EAAGiK,8BA2D5CpC,KAzFkB,kDA2FlB1rB,QAAQC,MAAM,OAAQ,KAAI4rB,YA3FR,4FAAH,0DAuGb6B,GAgBJ,WACEzS,EACAqS,EACAC,GACC,0BAnBHtS,QAmBE,OAlBFK,YAkBE,OAjBFE,WAiBE,OAhBFyB,cAgBE,OAfFoJ,oBAeE,OALFxf,aAKE,EACArE,KAAKyY,GAAKA,EADV,MAE0BA,EAAGC,wBAArB/b,EAFR,EAEQA,MAAOD,EAFf,EAEeA,OAEfsD,KAAK6jB,eAAiB,CACpBC,kBAAc5mB,GAEhB8C,KAAKqE,QAAU,IAAIknB,IACnBvrB,KAAK8Y,OAAS,IAAIhd,IAChBa,GAAS,EACTA,EAAQ,EACRD,EAAS,EACTA,GAAU,EACV,EACA,KAGFsD,KAAK8Y,OAAO9c,SAAS2kB,IAAI,EAAG,EAAG,KAC/B3gB,KAAK8Y,OAAO4I,OAAO,EAAG,EAAG,GACzB1hB,KAAK8Y,OAAOoM,OAAOsG,OAAO,GAE1BxrB,KAAKgZ,MAAQ,IAAIld,IACjBkE,KAAKgZ,MAAMkC,WAAa,IAAIpf,IAAY,WAExCkE,KAAKya,SAAW,IAAI3e,IAAoB,CACtCgvB,OAAM,OAAEA,QAAF,IAAEA,SAAU5tB,EAClB6tB,QAAO,OAAEA,QAAF,IAAEA,SAAW7tB,EACpBqsB,WAAW,EACXC,uBAAuB,IAIzBxpB,KAAKya,SAASuM,QAAQrqB,EAAOD,IAIjC,SAAS2uB,MAST,SAA2C5Q,GACzC,IAAMqQ,EAASrQ,EAASe,WAClB7e,EAAQmuB,EAAOW,YACf/uB,EAASouB,EAAOY,aAChBC,EAAab,EAAOnuB,QAAUA,GAASmuB,EAAOpuB,SAAWA,EAC3DivB,GACFlR,EAASuM,QAAQrqB,EAAOD,GAAQ,GAElC,OAAOivB,GAhBHC,CAAkC9U,GAAS2D,WAC7C3D,GAASgC,OAAOwH,yBAGlBxJ,GAAS2D,SAASkQ,OAAO7T,GAASkC,MAAOlC,GAASgC,QAClDsS,sBAAsBC,IAyBvBvvB,IAAe8D,UAAkBmlB,4BAA8B,SAC9DrpB,EACAkT,GAEA,GAAI5O,KAAKoZ,SAAS1d,KAAUkT,EAAO,OAAO5O,KAE1C,IAAK,IAAIqT,EAAI,EAAGnC,EAAIlR,KAAKiZ,SAAShb,OAAQoV,EAAInC,EAAGmC,IAAK,CACpD,IACI3G,EADQ1M,KAAKiZ,SAAS5F,GACP0R,4BAA4BrpB,EAAMkT,GAErD,QAAe1R,IAAXwP,EACF,OAAOA,IClPN,I,GAAMiN,GAAgB,SAC3BpB,EACAC,GAEA,GAAoB,OAAhB1B,GAAS2B,GACX,MAAM,IAAImE,MAAM,gBAElB,IAAK5E,GACH,MAAM,IAAI4E,MAAM,gBAIlB,IACMyE,EADQ5a,KACW3B,GAAGY,UAVV,EAWmBoR,GAAS2B,GAAGC,wBAAzC/b,EAXU,EAWVA,MAAOD,EAXG,EAWHA,OAET6e,EAAU/C,EAbE,EAWKG,IAGjBne,GAFU+d,EAZE,EAWUK,KAGPjc,EAAQ,GAAK0kB,EAAavK,GAASgC,OAAO9c,SAASxB,EAClEC,GAAgBiC,EAAS,EAAnB6e,GAAwB8F,EAAavK,GAASgC,OAAO9c,SAASvB,EAC1E,OAAO,IAAIqB,IAActB,EAAGC,IAGjBoxB,GAAgB,SAACC,GAC5B,IAAK9T,GACH,MAAM,IAAI4E,MAAM,gBAFiC,MAQd9F,GAAS2B,GAAGC,wBAAzC/b,EAR2C,EAQ3CA,MAAOD,EARoC,EAQpCA,OAAQic,EAR4B,EAQ5BA,IAAKC,EARuB,EAQvBA,KACxBmT,EAASD,EAAI3d,QAEb6d,EAAYrvB,EAAQ,EACpBsvB,EAAavvB,EAAS,EAO1B,OALAqvB,EAAOG,QAAQpV,GAASgC,QAGxBiT,EAAOvxB,EAAIuxB,EAAOvxB,EAAIwxB,EAAYA,EAAYpT,EAC9CmT,EAAOtxB,GAAMsxB,EAAOtxB,EAAIwxB,EAAcA,EAAatT,EAC5CoT,GCaHI,G,WAiBJ,aAAe,0BAhBfC,cAgBc,OAfdpwB,cAec,OAddW,WAcc,OAbdD,YAac,OAZdE,WAYc,OAXdyvB,gBAWc,OAVdC,gBAUc,OATdC,eASc,OARdC,eAQc,OAPdC,eAOc,OANdC,eAMc,OALdC,yBAKc,OAJdC,sBAIc,OAHdC,iBAGc,OAFdjlB,SAEc,EACZ5H,KAAKosB,SAAW,IAAItwB,IAAc,EAAG,EAAG,GACxCkE,KAAKhE,SAAW,IAAIF,IAAc,EAAG,EAAG,GACxCkE,KAAKrD,MAAQ,EACbqD,KAAKtD,OAAS,EACdsD,KAAKpD,MAAQ,EACboD,KAAKqsB,WAAa,GAClBrsB,KAAKssB,WAAaxwB,IAAgBC,eAClCiE,KAAK2sB,oBAAsB1lB,GAA2BjH,KAAKssB,YAC3DtsB,KAAK4sB,iBAAmB3lB,GACtBjH,KAAKssB,WACLtoB,GAAoB8oB,IAEtB9sB,KAAKusB,UAAYtlB,GACfjH,KAAKssB,WACLtoB,GAAoB+oB,yBAEtB/sB,KAAKwsB,UAAYvlB,GACfjH,KAAKssB,WACLtoB,GAAoBgpB,wBAEtBhtB,KAAKysB,UAAYxlB,GACfjH,KAAKssB,WACLtoB,GAAoBipB,sBAEtBjtB,KAAK0sB,UAAYzlB,GACfjH,KAAKssB,WACLtoB,GAAoBkpB,qBAEtBltB,KAAK6sB,YAAc,IAAI/wB,IAAkB,EAAG,EAAG,GAC/CkE,KAAK4H,IAAM,IAAI9L,IAAWkE,KAAK6sB,a,+CAGjC,SAAWM,EAA2B/J,GAAsB,IAAD,OACrDgK,GAAW,EACXC,GAAW,EACTC,EAAYttB,KAAKqsB,WAAWkB,WAAU,SAAC7a,GAAD,OAAOA,EAAEvX,KAAOgyB,EAAUhyB,MAChEqyB,GAA8B,IAAfF,EAQrB,IANmB,IAAflK,IAAwC,IAAjBoK,EACzBH,GAAW,GACa,IAAfjK,IAAyC,IAAjBoK,IACjCJ,GAAW,IAGI,IAAbC,IAAmC,IAAbD,EAA1B,CAIIA,GACFptB,KAAKqsB,WAAWve,OAAOwf,EAAW,GAGhCD,GACFrtB,KAAKqsB,WAAWjuB,KAAKoI,oBAAU2mB,IAGF,IAA3BntB,KAAKqsB,WAAWpuB,OAClB+B,KAAKosB,SAAWpsB,KAAKqsB,WAAW,GAAGD,SAEnCpsB,KAAKosB,SAAW,IAAItwB,IAAc,EAAG,EAAG,GAG1C,IAAMwa,EAAO,IAAIxa,IAkBjB,GAjBAkE,KAAKqsB,WAAWnuB,SAAQ,SAACuvB,GAAU,IACzB9wB,EAA6C8wB,EAA7C9wB,MAAOD,EAAsC+wB,EAAtC/wB,OAAQE,EAA8B6wB,EAA9B7wB,MAAOZ,EAAuByxB,EAAvBzxB,SAAUowB,EAAaqB,EAAbrB,SACxC,EAAKxkB,IAAI8lB,MAAM/M,IAAIhkB,EAAOD,EAAQE,GAClC,EAAKgL,IAAI5L,SAAS2kB,IAAI3kB,EAASxB,EAAGwB,EAASvB,EAAGuB,EAAStB,GACvD,EAAKkN,IAAIwkB,SAASzL,IAChB7kB,IAAgB6xB,QAAUvB,EAAS5xB,EACnCsB,IAAgB6xB,QAAUvB,EAAS3xB,EACnCqB,IAAgB6xB,QAAUvB,EAAS1xB,GAErC4b,EAAK6T,eAAe,EAAKviB,QAE3B5H,KAAKhE,SAAW,IAAIF,IACpBwa,EAAKsX,UAAU5tB,KAAKhE,UACpBgE,KAAKrD,MAAQ2Z,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,EACnCwF,KAAKtD,OAAS4Z,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,EACpCuF,KAAKpD,MAAQ0Z,EAAK7M,IAAI/O,EAAI4b,EAAK/M,IAAI7O,EAEJ,IAA3BsF,KAAKqsB,WAAWpuB,OAAc,CAChC,IAAMyO,EAASoK,GAASzS,QAAQwpB,IAAI7tB,KAAK2sB,0BAC1BzvB,IAAXwP,QACoBxP,IAAlBwP,EAAOohB,QAA0C,OAAlBphB,EAAOohB,QACxCphB,EAAOohB,OAAOC,OAAOrhB,GAGzBoK,GAASzS,QAAQ2pB,OAAOhuB,KAAKwsB,WAC7B1V,GAASzS,QAAQ2pB,OAAOhuB,KAAKusB,WAC7BzV,GAASzS,QAAQ2pB,OAAOhuB,KAAK0sB,WAC7B5V,GAASzS,QAAQ2pB,OAAOhuB,KAAKysB,WAC7B3V,GAASzS,QAAQ2pB,OAAOhuB,KAAK4sB,kBAC7B9V,GAASzS,QAAQ2pB,OAAOhuB,KAAK2sB,yBACxB,CAGL,QAAezvB,IAFA4Z,GAASzS,QAAQwpB,IAAI7tB,KAAK2sB,qBAEf,CAExB,IAAMsB,EAAiB,IAAInyB,IAC3BmyB,EAAe7U,SAAS1d,KAAOsE,KAAK2sB,oBAEpC,IAAMrf,EAAW,IAAIxR,IAAoB,EAAG,EAAG,EAAG,GAC5CK,EAAW,IAAIL,IAAwB,CAC3CW,MAAO,aACPyxB,KAAMpyB,IACNoO,QAAS,GACTikB,aAAa,IAETC,EAAe,IAAItyB,IAAWwR,EAAUnR,GAC9CiyB,EAAahV,SAAS1d,KAAOsE,KAAK4sB,iBAElC,IAIMyB,GAAY,IAAIvyB,KACnBwyB,QALQ,IAEA,IAIRC,OALQ,IACA,IAKRA,OANQ,GAEA,IAKRA,QARQ,GAGA,IAOXF,EAAUG,WAAY,EAEtB,IAAMC,EAAmBJ,EAAUK,YAC7BC,GAA2B,IAAI7yB,KAAuB8yB,cAC1DH,GAEII,EAAqB,IAAI/yB,IAAwB,CACrDW,MAAO,MACPyN,QAAS,EACTikB,aAAa,IAETW,EAAkB,IAAIhzB,IAC1B6yB,EACAE,GAGiBE,GAAc/uB,KAAKssB,WAAYhW,GAEvCpY,SAAQ,SAAC8wB,GAClBlY,GAASzS,QAAQsc,IAAIqO,EAAI5V,SAAS1d,KAAMszB,GACxCf,EAAegB,OAAOD,MAGxBZ,EAAanY,IAAI6Y,GACjBb,EAAehY,IAAImY,GACnBtX,GAASkC,MAAM/C,IAAIgY,GAEnBnX,GAASzS,QAAQsc,IAAI3gB,KAAK2sB,oBAAqBsB,GAC/CnX,GAASzS,QAAQsc,IAAI3gB,KAAK4sB,iBAAkBwB,GAG9C,IAAMc,EAAMpY,GAASzS,QAAQwpB,IAAI7tB,KAAK4sB,uBAC1B1vB,IAARgyB,IACFA,EAAIlzB,SAAS2kB,IAAI3gB,KAAKhE,SAASxB,EAAGwF,KAAKhE,SAASvB,EAAGuF,KAAKhE,SAAStB,GACjEw0B,EAAIxB,MAAM/M,IAAI3gB,KAAKrD,MAAOqD,KAAKtD,OAAQsD,KAAKpD,QAK9C,IAAMuyB,EAASrY,GAASzS,QAAQwpB,IAAI7tB,KAAK0sB,WACzC,QAAexvB,IAAXiyB,EAAsB,CACxB,IAAMnb,EAAK,IAAIlY,IACbwa,EAAK/M,IAAI/O,EAAIwF,KAAKhE,SAASxB,EAC3B8b,EAAK/M,IAAI9O,EAAIuF,KAAKhE,SAASvB,EAC3B6b,EAAK/M,IAAI7O,EAAIsF,KAAKhE,SAAStB,GAEvBgY,EAAI,IAAI5W,IACd4W,EAAE0c,eACA,IAAItzB,IACFA,IAAgB6xB,QAAU3tB,KAAKosB,SAAS5xB,EACxCsB,IAAgB6xB,QAAU3tB,KAAKosB,SAAS3xB,EACxCqB,IAAgB6xB,QAAU3tB,KAAKosB,SAAS1xB,KAGjC,IAAIoB,KACZuzB,sBAAsB3c,GAEzByc,EAAOnzB,SAAS2kB,IACd3gB,KAAKhE,SAASxB,EAAIwZ,EAAGxZ,EACrBwF,KAAKhE,SAASvB,EAAIuZ,EAAGvZ,EACrBuF,KAAKhE,SAAStB,EAAIsZ,EAAGtZ,GAIzB,IAAM40B,EAASxY,GAASzS,QAAQwpB,IAAI7tB,KAAKysB,WACzC,QAAevvB,IAAXoyB,EAAsB,CACxB,IAAMtb,EAAK,IAAIlY,IACbwa,EAAK7M,IAAIjP,EAAIwF,KAAKhE,SAASxB,EAC3B8b,EAAK/M,IAAI9O,EAAIuF,KAAKhE,SAASvB,EAC3B6b,EAAK/M,IAAI7O,EAAIsF,KAAKhE,SAAStB,GAEvBgY,EAAI,IAAI5W,IACd4W,EAAE0c,eACA,IAAItzB,IACFA,IAAgB6xB,QAAU3tB,KAAKosB,SAAS5xB,EACxCsB,IAAgB6xB,QAAU3tB,KAAKosB,SAAS3xB,EACxCqB,IAAgB6xB,QAAU3tB,KAAKosB,SAAS1xB,KAGjC,IAAIoB,KACZuzB,sBAAsB3c,GAEzB4c,EAAOtzB,SAAS2kB,IACd3gB,KAAKhE,SAASxB,EAAIwZ,EAAGxZ,EACrBwF,KAAKhE,SAASvB,EAAIuZ,EAAGvZ,EACrBuF,KAAKhE,SAAStB,EAAIsZ,EAAGtZ,GAIzB,IAAM60B,EAASzY,GAASzS,QAAQwpB,IAAI7tB,KAAKwsB,WACzC,QAAetvB,IAAXqyB,EAAsB,CACxB,IAAMvb,EAAK,IAAIlY,IACbwa,EAAK/M,IAAI/O,EAAIwF,KAAKhE,SAASxB,EAC3B8b,EAAK7M,IAAIhP,EAAIuF,KAAKhE,SAASvB,EAC3B6b,EAAK/M,IAAI7O,EAAIsF,KAAKhE,SAAStB,GAEvBgY,EAAI,IAAI5W,IACd4W,EAAE0c,eACA,IAAItzB,IACFA,IAAgB6xB,QAAU3tB,KAAKosB,SAAS5xB,EACxCsB,IAAgB6xB,QAAU3tB,KAAKosB,SAAS3xB,EACxCqB,IAAgB6xB,QAAU3tB,KAAKosB,SAAS1xB,KAGjC,IAAIoB,KACZuzB,sBAAsB3c,GAEzB6c,EAAOvzB,SAAS2kB,IACd3gB,KAAKhE,SAASxB,EAAIwZ,EAAGxZ,EACrBwF,KAAKhE,SAASvB,EAAIuZ,EAAGvZ,EACrBuF,KAAKhE,SAAStB,EAAIsZ,EAAGtZ,GAIzB,IAAM80B,EAAS1Y,GAASzS,QAAQwpB,IAAI7tB,KAAKusB,WACzC,QAAervB,IAAXsyB,EAAsB,CACxB,IAAMxb,EAAK,IAAIlY,IACbwa,EAAK7M,IAAIjP,EAAIwF,KAAKhE,SAASxB,EAC3B8b,EAAK7M,IAAIhP,EAAIuF,KAAKhE,SAASvB,EAC3B6b,EAAK/M,IAAI7O,EAAIsF,KAAKhE,SAAStB,GAEvBgY,EAAI,IAAI5W,IACd4W,EAAE0c,eACA,IAAItzB,IACFA,IAAgB6xB,QAAU3tB,KAAKosB,SAAS5xB,EACxCsB,IAAgB6xB,QAAU3tB,KAAKosB,SAAS3xB,EACxCqB,IAAgB6xB,QAAU3tB,KAAKosB,SAAS1xB,KAGjC,IAAIoB,KACZuzB,sBAAsB3c,GAEzB8c,EAAOxzB,SAAS2kB,IACd3gB,KAAKhE,SAASxB,EAAIwZ,EAAGxZ,EACrBwF,KAAKhE,SAASvB,EAAIuZ,EAAGvZ,EACrBuF,KAAKhE,SAAStB,EAAIsZ,EAAGtZ,U,KAO3B+0B,GAAwC,KAY/BtE,GAA2B,WACtC,IAAMuE,Q5B9SsBxyB,IAAxB2K,KACFA,GAAsB,IAAIgD,IAErBhD,I4B6SP6nB,EAAaC,GAAG7nB,GAAW8nB,kCAAkC,SAACvuB,GAC5DA,EAAK4I,QAAQ/L,SAAQ,SAAC/C,GACpB,IAAMO,EAAOR,EAAuBC,GAC9BuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QAEnDwB,IAAXwP,GAIJA,EAAOmjB,UAAS,SAAC5K,GACXA,aAAiBnpB,KACfmpB,EAAM9oB,UACP8oB,EAAM9oB,SAAwCM,MAAMkkB,IACnDtf,EAAK5E,gBAQjBizB,EAAaC,GAAG7nB,GAAWgoB,mCAAmC,SAACzuB,GAC7DA,EAAK0uB,MAAM7xB,SAAQ,SAAC1C,GAClB,IAAME,EAAOR,EAAuBM,EAAKL,IACnCuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GAClE,QAAewB,IAAXwP,EAAJ,CAGA,IAAM4J,EAAOY,GAAyB1b,EAAKS,MACvCU,EAAQ,EACRD,EAAS,EACTE,EAAQ,EACR0Z,IACF3Z,EAAQmM,KAAK4Q,IAAIpD,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,GACvCkC,EAASoM,KAAK4Q,IAAIpD,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,GACxCmC,EAAQkM,KAAK4Q,IAAIpD,EAAK7M,IAAI/O,EAAI4b,EAAK/M,IAAI7O,IAEzCgS,EAAOghB,MAAMlzB,EAAIgB,EAAKmB,MAAQA,EAC9B+P,EAAOghB,MAAMjzB,EAAIe,EAAKkB,OAASA,EAC/BgQ,EAAOghB,MAAMhzB,EAAIc,EAAKoB,MAAQA,MAEhCozB,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAWooB,oBAAoB,SAAC7uB,GAC9CA,EAAK8uB,qBAAqBjyB,SAAQ,SAAC0J,GAC7BA,EAAI5K,aAAehD,EAAYsB,KACjC80B,GAAkBxoB,EAAIzM,GAAIyM,EAAIwb,YACrBxb,EAAI5K,aAAehD,EAAYiJ,QACxCotB,GAAoBzoB,EAAIzM,GAAIyM,EAAIwb,eAGpC4M,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAWwoB,kCAAkC,SAACjvB,GAC5DA,EAAK0uB,MAAM7xB,SAAQ,SAAC1C,GAClB,IAAME,EAAOR,EAAuBM,EAAKL,IACnCuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GAClE,QAAewB,IAAXwP,EAAJ,CAGA,IAAM4J,EAAOY,GAAyB1b,EAAKS,MACvCU,EAAQ,EACRD,EAAS,EACTE,EAAQ,EACR0Z,IACF3Z,EAAQmM,KAAK4Q,IAAIpD,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,GACvCkC,EAASoM,KAAK4Q,IAAIpD,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,GACxCmC,EAAQkM,KAAK4Q,IAAIpD,EAAK7M,IAAI/O,EAAI4b,EAAK/M,IAAI7O,IAEzCgS,EAAOghB,MAAMlzB,EAAIgB,EAAKmB,MAAQA,EAC9B+P,EAAOghB,MAAMjzB,EAAIe,EAAKkB,OAASA,EAC/BgQ,EAAOghB,MAAMhzB,EAAIc,EAAKoB,MAAQA,MAEhCozB,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAWyoB,kCAAkC,SAAClvB,GAC5DA,EAAK0uB,MAAM7xB,SAAQ,SAAC1C,GAClB,IAAME,EAAOR,EAAuBM,EAAKL,IACnCuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GAClE,QAAewB,IAAXwP,EAAJ,CAGA,IAAM4J,EAAOY,GAAyB1b,EAAKS,MACvCU,EAAQ,EACRD,EAAS,EACTE,EAAQ,EACR0Z,IACF3Z,EAAQmM,KAAK4Q,IAAIpD,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,GACvCkC,EAASoM,KAAK4Q,IAAIpD,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,GACxCmC,EAAQkM,KAAK4Q,IAAIpD,EAAK7M,IAAI/O,EAAI4b,EAAK/M,IAAI7O,IAEzCgS,EAAOghB,MAAMlzB,EAAIgB,EAAKmB,MAAQA,EAC9B+P,EAAOghB,MAAMjzB,EAAIe,EAAKkB,OAASA,EAC/BgQ,EAAOghB,MAAMhzB,EAAIc,EAAKoB,MAAQA,MAEhCozB,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAW0oB,iCAAiC,SAACnvB,GAC3DA,EAAK4I,QAAQ/L,SAAQ,SAAC/C,GACpB,IAAMO,EAAOR,EAAuBC,GAC9BuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,GAGJoK,GAASkC,MAAM+U,OAAOrhB,MAGxBrL,EAAK0uB,MAAM7xB,SAAQ,SAAC1C,GAClB0uB,GAAsB1uB,EAAMsb,GAASkC,OACrCoX,GAAkB50B,EAAKL,IAAI,MAG7B60B,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAW2oB,mCAAmC,SAACpvB,GAC7DA,EAAK4I,QAAQ/L,SAAQ,SAAC/C,GACpB,IAAMO,EAAOR,EAAuBC,GAC9BuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,IAIJA,EAAO0f,SAAS5xB,EAAIsB,IAAgB6xB,QAAUtsB,EAAKhF,QACnDqQ,EAAO0f,SAAS3xB,EAAIqB,IAAgB6xB,QAAUtsB,EAAK/E,QACnDoQ,EAAO0f,SAAS1xB,EAAIoB,IAAgB6xB,QAAUtsB,EAAK9E,YAGrDyzB,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAW4oB,oBAAoB,SAACrvB,GAC9CA,EAAKsvB,WAAWzyB,SAAQ,SAAC1C,GACvB,IAAML,EAAKoW,OAAO2Q,KAAK1mB,GAAM,GACvBoT,EAAQ2C,OAAOqf,OAAOp1B,GAAM,GAClC40B,GAAkBj1B,EAAIyT,SAI1B8gB,EAAaC,GAAG7nB,GAAW+oB,8BAA8B,SAACxvB,GACxDA,EAAK8uB,qBAAqBjyB,SAAQ,SAAC0J,GAC7BA,EAAI5K,aAAehD,EAAYsB,KACjC80B,GAAkBxoB,EAAIzM,GAAIyM,EAAIwb,YACrBxb,EAAI5K,aAAehD,EAAYiJ,QACxCotB,GAAoBzoB,EAAIzM,GAAIyM,EAAIwb,eAIpC4M,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAWgpB,+BAA+B,SAACzvB,GAAU,IAAD,IAC7B,IAOE,KAPvC,OAAIA,QAAJ,IAAIA,GAAJ,UAAIA,EAAM0vB,qBAAV,aAAI,EAAqBJ,cACvB,UAAAtvB,EAAK0vB,qBAAL,mBAAoBJ,kBAApB,SAAgCzyB,SAAQ,SAAC1C,GACvC,IAAML,EAAKoW,OAAO2Q,KAAK1mB,GAAM,GACvBoT,EAAQ2C,OAAOqf,OAAOp1B,GAAM,GAClC40B,GAAkBj1B,EAAIyT,QAG1B,OAAIvN,QAAJ,IAAIA,GAAJ,UAAIA,EAAM2vB,uBAAV,aAAI,EAAuBL,cACzB,UAAAtvB,EAAK2vB,uBAAL,mBAAsBL,kBAAtB,SAAkCzyB,SAAQ,SAAC+J,GACzC,IAAM9M,EAAKoW,OAAO2Q,KAAKja,GAAQ,GACzB2G,EAAQ2C,OAAOqf,OAAO3oB,GAAQ,GACpCooB,GAAoBl1B,EAAIyT,OAG5BohB,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAWmpB,wBAAwB,SAAC5vB,GAClD2uB,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAWopB,uBAAuB,SAAC7vB,GACjD2uB,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAWqpB,sBAAsB,SAAC9vB,GAChD,IAAMiD,EAAwB,GAC9BjD,EAAKsvB,WAAWzyB,SAAQ,SAAC1C,GACvB,IAAML,EAAKoW,OAAO2Q,KAAK1mB,GAAM,GACvBoT,EAAQ2C,OAAOqf,OAAOp1B,GAAM,GAClC60B,GAAoBl1B,EAAIyT,IACV,IAAVA,GACFtK,EAAYlG,KAAKjD,SAKvBu0B,EAAaC,GAAG7nB,GAAWspB,oBAAoB,SAAC/vB,GAC9CgwB,GAAqBhwB,EAAK4I,YAG5BylB,EAAaC,GAAG7nB,GAAWwpB,4BAA4B,SAACjwB,GACtDgwB,GAAqBhwB,EAAK4I,YAG5BylB,EAAaC,GAAG7nB,GAAWypB,sBAAsB,SAAClwB,GAChDmwB,GAAuBnwB,EAAKowB,sBAG9B/B,EAAaC,GAAG7nB,GAAW4pB,uBAAuB,SAACrwB,GACjD,IAAM7F,EAAO6F,EAAK7F,KAClB0uB,GAAsB1uB,EAAMsb,GAASkC,UAGvC0W,EAAaC,GAAG7nB,GAAW6pB,oBAAoB,SAACtwB,GAAU,IAChD3F,EAAuB2F,EAAvB3F,KACFgR,GADyBrL,EAAjBuwB,MAAiBvwB,EAAVuN,MACNkI,GAASkC,MAAM+L,4BAA4B,OAAQrpB,IAClE,QAAewB,IAAXwP,EAAsB,CACxB,IAAMmlB,EAAQnlB,EACK,UAAfrL,EAAKuwB,QACPC,EAAMp1B,MAAQ4E,EAAKuN,OAEF,cAAfvN,EAAKuwB,QACPC,EAAM/rB,UAAYzE,EAAKuN,WAK7B8gB,EAAaC,GAAG7nB,GAAWgqB,kBAAkB,SAACzwB,GAC5C,IAAM4G,EAAS5G,EAAK4G,OACpB8pB,GAAqB9pB,MAGvBynB,EAAaC,GAAG7nB,GAAWkqB,0BAA0B,SAAC3wB,GACpDA,EAAK4wB,aAAa/zB,SAAQ,SAAC0J,GACzB,IAAMlM,EAAOiP,GAA2B/C,EAAIzM,GAAIyM,EAAI5K,YACpD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,IAGJA,EAAO1Q,SAASxB,EAAIoN,EAAI5L,SAASxB,EACjCkS,EAAO1Q,SAASvB,EAAImN,EAAI5L,SAASvB,UAIrCi1B,EAAaC,GAAG7nB,GAAWoqB,+BAA+B,SAAC7wB,GACzDA,EAAK4wB,aAAa/zB,SAAQ,SAAC0J,GACzB,IAAMlM,EAAOiP,GAA2B/C,EAAIzM,GAAIyM,EAAI5K,YACpD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,IAGJA,EAAO1Q,SAASxB,EAAIoN,EAAI5L,SAASxB,EACjCkS,EAAO1Q,SAASvB,EAAImN,EAAI5L,SAASvB,OAEnCu1B,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAWqqB,sBAAsB,SAAC9wB,GAChDA,EAAK0uB,MAAM7xB,SAAQ,SAAC1C,GAClB,IAAME,EAAOR,EAAuBM,EAAKL,GAAIb,EAAgBe,MACvDqR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,IAGJA,EAAO1Q,SAASxB,EAAIgB,EAAKQ,SAASxB,EAClCkS,EAAO1Q,SAASvB,EAAIe,EAAKQ,SAASvB,MAEpC4G,EAAK+wB,QAAQl0B,SAAQ,SAAC+J,GACpB,IAAMvM,EAAOqM,GAAyBE,EAAO9M,IACvCuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,IAGJxI,GAAa,WAAYwI,EAAO1Q,SAASxB,EAAGyN,EAAOjM,SAASxB,GAC5DkS,EAAO1Q,SAASxB,EAAIyN,EAAOjM,SAASxB,EACpCkS,EAAO1Q,SAASvB,EAAIwN,EAAOjM,SAASvB,MAEtCu1B,GAAsB3uB,EAAK4uB,SAAU5uB,EAAKygB,iBAG5C4N,EAAaC,GAAG7nB,GAAWuV,mBAAmB,eAE9CqS,EAAaC,GAAG7nB,GAAWuqB,sCAAsC,SAAChxB,GAChEA,EAAK0uB,MAAM7xB,SAAQ,SAAC1C,GAClB,IAAME,EAAOR,EAAuBM,EAAKL,IACnCuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,GAGJA,EAAOmjB,UAAS,SAAC5K,GACXA,aAAiBnpB,MACnBmpB,EAAM9oB,SAAW,IAAIL,IAA2B,CAC9Cga,aAAa,EACbwc,aAAc,EACd71B,MAAO4E,EAAK5E,kBAOtBizB,EAAaC,GAAG7nB,GAAWyqB,qBAAqB,SAAClxB,GAC/CkQ,OAAO2Q,KAAK7gB,EAAK0uB,OAAO7xB,SAAQ,SAAC/C,GAC/B,IAAMK,EAAO6F,EAAK0uB,MAAM50B,GACxB+uB,GAAsB1uB,EAAMsb,GAASkC,UAGvC3X,EAAKmxB,oBAAoBt0B,SAAQ,SAACu0B,GAChCrC,GAAkBqC,GAAQ,SAI9B/C,EAAaC,GAAG7nB,GAAW4qB,gCAAgC,SAACrxB,GAC1DA,EAAK0uB,MAAM7xB,SAAQ,SAAC1C,GAClB,IAAME,EAAOR,EAAuBM,EAAKL,IACnCuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,IAGJA,EAAO1Q,SAASxB,EAAIgB,EAAKQ,SAASxB,EAClCkS,EAAO1Q,SAASvB,EAAIe,EAAKQ,SAASvB,SAItCi1B,EAAaC,GAAG7nB,GAAW6qB,2BAA2B,SAACtxB,GACrDA,EAAKmxB,oBAAoBt0B,SAAQ,SAACu0B,GAChCrC,GAAkBqC,GAAQ,SAI9B/C,EAAaC,GAAG7nB,GAAW8qB,wBAAwB,SAACvxB,GAClDkQ,OAAO2Q,KAAK7gB,EAAKgD,SAASnG,SAAQ,SAAC/C,GACjC,IAAMyM,EAAMvG,EAAKgD,QAAQlJ,GACrByM,EAAI5K,aAAehD,EAAYsB,KACjC4uB,GAAsBtiB,EAAakP,GAASkC,OACnCpR,EAAI5K,aAAehD,EAAYiJ,OACxC8uB,GAAqBnqB,GACZA,EAAI5K,aAAehD,EAAY4I,MACxCiwB,GAAoBjrB,GACXA,EAAI5K,aAAehD,EAAYsJ,kBACxCwvB,GAA+BlrB,SAarC8nB,EAAaC,GAAG7nB,GAAWirB,eAAe,SAAC1xB,GAqBzC,GApBA7D,QAAQkB,IAAI,qBAAsB2C,EAAKH,MAAM4D,GAAGe,QAE5CxE,EAAKH,MAAM4D,GAAGe,QAAUxE,EAAKH,MAAM4D,GAAGe,OAAO5H,OAAS,GACxDoD,EAAKH,MAAM4D,GAAGe,OAAO3H,SAAQ,SAACgT,GAC5B,GAAe,2BAAXA,EAAEjV,KAAmC,CAAC,IAAD,YACjC41B,EAAQ,IAAI/1B,IAAuBoV,EAAEzU,MAAOyU,EAAEpL,WACpD+rB,EAAM71B,SAAS2kB,IAAf,oBACEzP,EAAElV,gBADJ,aACE,EAAYxB,SADd,QACmB,EADnB,oBAEE0W,EAAElV,gBAFJ,aAEE,EAAYvB,SAFd,QAEmB,EAFnB,oBAGEyW,EAAElV,gBAHJ,aAGE,EAAYtB,SAHd,QAGmB,IAEnBm3B,EAAMn2B,KAAOwV,EAAExV,KACfm2B,EAAMzY,SAAW3d,gBAAM,GAAIo2B,EAAO,CAChC70B,WAAYhD,EAAYg5B,WACxBt3B,KAAK,GAAD,OAAK1B,EAAYg5B,YAAjB,OAA8B34B,GAA9B,OAA+Cw3B,EAAM12B,MAE3D2b,GAASkC,MAAM/C,IAAI4b,OAIrBxwB,EAAKH,MAAM4D,GAAGiB,KAAKI,UAAW,CAChC,IAAMoE,EAAO,IACPxE,EAAO,IAAIjK,IAAiB,EAAGyO,IAAW,UAAW,QAC3DxE,EAAK/J,SAASxB,EAAI,EAClBuL,EAAK/J,SAASvB,EAAI,EAClBsL,EAAK/J,SAAStB,GAAK,IACnBqL,EAAK2nB,MAAMlzB,EAAI+P,EACfxE,EAAK2nB,MAAMjzB,EAAI8P,EACfxE,EAAK2nB,MAAMhzB,EAAI6P,EAEfxE,EAAKqmB,SAAS5xB,EAA8B,GAA1BsB,IAAgB6xB,QAClC5nB,EAAKqmB,SAAS3xB,EAA8B,EAA1BqB,IAAgB6xB,QAClC5nB,EAAKqmB,SAAS1xB,EAA8B,EAA1BoB,IAAgB6xB,QAClC5nB,EAAKqT,SAAW3d,gBAAM,GAAI4F,EAAKH,MAAM4D,GAAGiB,KAAM,CAC5C/I,WAAYhD,EAAYi5B,oBACxBv3B,KAAK,GAAD,OAAK1B,EAAYi5B,qBAAjB,OAAuC54B,GAAvC,OAAwDgH,EAAKH,MAAM4D,GAAGiB,KAAK5K,MAGjF2b,GAASkC,MAAM/C,IAAIlQ,QAKZmtB,GAAkB,WAC7Bpc,GAASkC,MAAMgR,SAGJU,GAAiB,SAC5ByI,EACAna,GAEA,GAAoB,2BAAhBma,EAAOl3B,KAAmC,CAAC,IAAD,YACtC41B,EAAQ,IAAI/1B,IAAuBq3B,EAAO12B,MAAO02B,EAAOrtB,WAC9D+rB,EAAM71B,SAAS2kB,IAAf,oBACEwS,EAAOn3B,gBADT,aACE,EAAiBxB,SADnB,QACwB,EADxB,oBAEE24B,EAAOn3B,gBAFT,aAEE,EAAiBvB,SAFnB,QAEwB,EAFxB,oBAGE04B,EAAOn3B,gBAHT,aAGE,EAAiBtB,SAHnB,QAGwB,IAExBm3B,EAAMn2B,KAAOy3B,EAAOz3B,KACpBm2B,EAAMzY,SAAW3d,gBAAM,GAAIo2B,EAAO,CAChC70B,WAAYhD,EAAYg5B,WACxBt3B,KAAK,GAAD,OAAK1B,EAAYg5B,YAAjB,OAA8B34B,GAA9B,OAA+Cw3B,EAAM12B,MAE3D6d,EAAM/C,IAAI4b,KAwBDuB,GAAwB,SAAC1mB,GAAuB,IACnD1P,EAAe0P,EAAf1P,WACJA,IAAehD,EAAYsB,MAC7B4uB,GAAsBxd,EAAeoK,GAASkC,OAE5Chc,IAAehD,EAAYiJ,QAC7B8uB,GAAqBrlB,GAEnB1P,IAAehD,EAAY4I,OAC7BiwB,GAAoBnmB,GAElB1P,IAAehD,EAAYsJ,kBAC7BwvB,GAA+BpmB,IAWtB6W,GAAoB,SAC/Blf,GAEA,IAAMiS,EAAO,IAAIxa,IAcjB,OAZAuI,EAAQnG,SAAQ,SAAC0J,GACf,IAAMlM,EAAOiP,GAA2B/C,EAAIzM,GAAIyM,EAAI5K,YACpD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,GAGJ4J,EAAK6T,eAAezd,ODnxB2B,SAAC4J,GAKlD,IAA6B,IAAzB+c,SAAS/c,EAAK/M,IAAI/O,KAAyC,IAAzB64B,SAAS/c,EAAK7M,IAAIhP,GAAxD,CAeA,IAAIsxB,EAAS,IAAIjwB,IACjBiwB,EAAOvxB,EAAI8b,EAAK/M,IAAI/O,GAAK8b,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,GAAK,EACpDuxB,EAAOtxB,EAAI6b,EAAK7M,IAAIhP,EAIpB,IAAMqtB,EAAO+D,GAAcE,GAa3B,OAXGjE,EAAKttB,EAAI,IACVstB,EAAKttB,EAAI,GAERstB,EAAKrtB,EAAI,KACVqtB,EAAKrtB,EAAI,IAOJqtB,GC+uBAwL,CAAoChd,IAIhCid,GAAuB,SAClC3oB,EACA5N,EACAw2B,EACAC,GAEA,IAAM/3B,EAAOiP,GAA2BC,EAAU5N,GAClD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,IAGJA,EAAO1Q,SAASxB,EAAIg5B,EACpB9mB,EAAO1Q,SAASvB,EAAIg5B,KAGTrD,GAAoB,SAACj1B,EAAYu4B,GAC5C,IAAMh4B,EAAOR,EAAuBC,GAC9BuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GAElE,QAAewB,IAAXwP,EAeJ,GAXCA,EAAemjB,UAAS,SAAC5K,GACpBA,aAAiBnpB,KACfmpB,EAAM9oB,YACa,IAAjBu3B,EACDzO,EAAM9oB,SAAwCw3B,SAAShT,IAAI,SAE3DsE,EAAM9oB,SAAwCw3B,SAAShT,IAAI,QAK/C,IAAjB+S,EAAuB,CACzB,IAAMpd,EAAO,IAAIxa,IAEjBwa,EAAK6T,eAAezd,GAEpB,IAAMlS,EAAI8b,EAAK/M,IAAI/O,EACbC,EAAI6b,EAAK/M,IAAI9O,EACbwtB,EAAInf,KAAK4Q,IAAIpD,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,GACnC0tB,EAAIpf,KAAK4Q,IAAIpD,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,GAWnC4zB,GAAY,IAAIvyB,KACnBwyB,OAAOsF,GAAeC,IACtBtF,QAAQqF,GAAqBC,IAC7BtF,QAAQqF,IAAsBC,IAC9BtF,OAAOqF,IAAgBC,IAE1BxF,EAAUG,WAAY,EAEtB,IAAMsF,EAAczF,EAAUK,YACxBqF,GAAsB,IAAIj4B,KAAuB8yB,cACrDkF,GAEIE,EAAgB,IAAIl4B,IAAwB,CAAEW,MAAO,QACrDsW,EAAQ,IAAIjX,IAAWi4B,EAAqBC,GAclDjhB,EAAMqG,SAAW7d,EACdmR,EAAe0M,SAChB9e,EAAgB25B,iBAGlB,IAAMC,EAAiB,IAAIp4B,IAC3Bo4B,EAAe9a,SAAW7d,EACvBmR,EAAe0M,SAChB9e,EAAgB65B,WAKlBD,EAAe9a,SAASpd,SAASxB,EAAIA,EAAIytB,EAAI,EAC7CiM,EAAe9a,SAASpd,SAASvB,EAAIA,EAAIytB,EAAI,EAC7CgM,EAAel4B,SAASxB,EAAIA,EAAIytB,EAAI,EACpCiM,EAAel4B,SAASvB,EAAIA,EAAIytB,EAAI,EACpCgM,EAAel4B,SAAStB,GAAK,IAC7Bw5B,EAAexG,MAAMlzB,EAAIytB,EACzBiM,EAAexG,MAAMjzB,EAAIytB,EACzBgM,EAAexG,MAAMhzB,EAzDX,EA0DVw5B,EAAeje,IAAIlD,GACnBrG,EAAOuiB,OAAOiF,OACT,CACL,IAAMx4B,EAAOR,EAAuBC,EAAIb,EAAgB65B,WAClDC,EAAUtd,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GACnE,QAAgBwB,IAAZk3B,EACF,OAEF1nB,EAAOqhB,OAAOqG,KAILrC,GAAuB,SAAC9pB,GACnC,IAAMqF,EAAW,IAAIxR,IAAoB,EAAG,EAAG,EAAG,GAE5CK,EAAW,IAAIL,IAAwB,CAC3CW,MAAO,aACPyxB,KAAMpyB,IACNoO,QAAS,GACTikB,aAAa,IAETkG,EAAgB,IAAIv4B,IAAWwR,EAAUnR,GAC/Ck4B,EAAcjb,SAAWpR,GACvBC,EACAR,GAAkBqlB,IAGpB,IAAMwH,EAAuB,IAAIx4B,IACjCw4B,EAAqBlb,SAAWpR,GAC9BC,EACAR,GAAkB8sB,YAGpBtsB,EAAOoC,gBAAgBnM,SAAQ,SAACu0B,EAAQlqB,GACtC,IAAMa,EAAMN,KAAKC,MAAMR,EAAQN,EAAOG,SAChCe,EAASL,KAAKC,MAAMR,EAAQN,EAAOG,SACnCosB,EAAelsB,GAAmBL,EAAQM,GAC1CksB,EAAY,EAAIxsB,EAAOG,QACvBssB,EAAa,EAAIzsB,EAAOI,KACxBkiB,EAAYkK,EAAY,EACxBjK,EAAakK,EAAa,EAC1BjN,EAAK8C,EACL7C,GAAM6C,EACN5C,EAAK6C,EACL5C,GAAM4C,EACN6D,GAAY,IAAIvyB,KACnBwyB,OAAO7G,EAAIE,GACX4G,OAAO7G,EAAIC,GACX4G,OAAO7G,EAAIE,GACX2G,OAAO9G,EAAIG,GAEdyG,EAAUG,WAAY,EAEtB,IAAMsF,EAAczF,EAAUK,YACxBqF,GAAsB,IAAIj4B,KAAuB8yB,cACrDkF,GAEIE,EAAgB,IAAIl4B,IAAwB,CAChDW,MAAO+3B,EAAe,MAAW,MACjCtqB,QAASsqB,EAAe,EAAI,EAC5BrG,aAAaqG,IAETG,EAAQ,IAAI74B,IAAWi4B,EAAqBC,GAClDW,EAAMvb,SAAWpR,GACfC,EACAR,GAAkBmtB,WAEpB,IACMC,EADgB5sB,EAAOU,WAAa7O,EAAe8O,OACxBQ,EAAM,IAAM,EAAI,EAAImhB,EAAa,EAC5D/vB,EAAIi6B,EAAYtrB,EAASohB,EAC/BoK,EAAM34B,SAASxB,EAAIA,EAAIq6B,EAAU,GACjC,IAAMp6B,EAAIi6B,EAAatrB,EAAMohB,EAC7BmK,EAAM34B,SAASvB,EAAIA,EAAI,GACvB65B,EAAqBre,IAAI0e,MAG3B,IAAMG,EAAc,IAAIh5B,IACxBg5B,EAAY1b,SAAWpR,GACrBC,EACAR,GAAkBpM,MAEpBy5B,EAAY94B,SAASxB,EAAIyN,EAAOjM,SAASxB,EACzCs6B,EAAY94B,SAASvB,EAAIwN,EAAOjM,SAASvB,EACzCq6B,EAAY94B,SAAStB,GAAK,IAC1Bo6B,EAAYpH,MAAMlzB,EAAIyN,EAAOtL,MAC7Bm4B,EAAYpH,MAAMjzB,EAAIwN,EAAOvL,OAC7Bo4B,EAAYpH,MAAMhzB,EAAI,EAEtBo6B,EAAY1I,SAAS5xB,EAAIsB,IAAgB6xB,QAAU1lB,EAAO5L,QAC1Dy4B,EAAY1I,SAAS3xB,EAAIqB,IAAgB6xB,QAAU1lB,EAAO3L,QAC1Dw4B,EAAY1I,SAAS1xB,EAAIoB,IAAgB6xB,QAAU1lB,EAAO1L,QAE1Du4B,EAAY7e,IAAIoe,GAChBS,EAAY7e,IAAIqe,GAIhBxd,GAASkC,MAAM/C,IAAI6e,IAcR5K,GAAwB,SAAC1uB,EAAYwd,GAChD,IAAM+b,EAAWv5B,EAAKS,KAEhB+4B,EzBp2B4B,SAAC/4B,GACnC,IAAI+4B,EAEJ,GAAI/4B,IAASrC,EAAUud,YAAa,CAClC,GAAuC,OAAnChB,GAAaI,YAAYF,MAE3B,OADA7Y,QAAQC,MAAM,wDACPu3B,EAETA,EAAY7e,GAAaI,YAAYF,MAAMlI,QAG7C,GAAIlS,IAASrC,EAAUwd,QAAS,CAC9B,GAAmC,OAA/BjB,GAAaK,QAAQH,MAEvB,OADA7Y,QAAQC,MAAM,yDACPu3B,EAETA,EAAY7e,GAAaK,QAAQH,MAAMlI,QAGzC,GAAIlS,IAASrC,EAAUyd,YAAa,CAClC,GAAuC,OAAnClB,GAAaC,YAAYC,MAE3B,OADA7Y,QAAQC,MAAM,yDACPu3B,EAETA,EAAY7e,GAAaC,YAAYC,MAAMlI,QAG7C,GAAIlS,IAASrC,EAAUsC,eAAgB,CACrC,GAA0C,OAAtCia,GAAaM,eAAeJ,MAE9B,OADA7Y,QAAQC,MAAM,yDACPu3B,EAETA,EAAY7e,GAAaM,eAAeJ,MAAMlI,QAGhD,GAAIlS,IAASrC,EAAU0d,kBAAmB,CACxC,GAA6C,OAAzCnB,GAAaO,kBAAkBL,MAEjC,OADA7Y,QAAQC,MAAM,yDACPu3B,EAETA,EAAY7e,GAAaO,kBAAkBL,MAAMlI,QAGnD,GAAIlS,IAASrC,EAAU2d,iBAAkB,CACvC,GAA4C,OAAxCpB,GAAaQ,iBAAiBN,MAEhC,OADA7Y,QAAQC,MAAM,yDACPu3B,EAETA,EAAY7e,GAAaQ,iBAAiBN,MAAMlI,QAGlD,OAAO6mB,EyBizBWC,CAAqBF,GAEvC,QAAkB73B,IAAd83B,EAAJ,CAOA,QAAe93B,IAFA8b,EAAM+L,4BAA4B,KAAMvpB,EAAKL,IAE5D,CAKA65B,EAAUnF,UAAS,SAAC5K,GAClBA,EAAM7L,SAAW7d,EAAyBC,EAAMlB,EAAgB46B,KAC5DjQ,aAAiBnpB,MACfN,EAAKW,WAAatC,EAAkBuC,IACtC6oB,EAAM9oB,SAAW,IAAIL,IAA2B,CAC9Cw2B,aAAc,EACd71B,MAAOjB,EAAKiB,QAELjB,EAAKW,WAAatC,EAAkBs7B,MAC7ClQ,EAAM9oB,SAAW,IAAIL,IAAwB,CAC3CW,MAAOjB,EAAKiB,QAGde,QAAQ2G,KAAK,4BAA6B3I,EAAKW,WAsB9C8oB,EAAc3X,UAChB2X,EAAc3X,SAAS8nB,wBAI5B,IAAM9e,EAAOY,GAAyB6d,GAClCp4B,EAAgB,EAChBD,EAAiB,EACjBE,EAAgB,EAyBpB,OAxBI0Z,IACF3Z,EAAQmM,KAAK4Q,IAAIpD,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,GACvCkC,EAASoM,KAAK4Q,IAAIpD,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,GACxCmC,EAAQkM,KAAK4Q,IAAIpD,EAAK7M,IAAI/O,EAAI4b,EAAK/M,IAAI7O,IAGzCs6B,EAAUtH,MAAMlzB,EAAIgB,EAAKmB,MAAQA,EACjCq4B,EAAUtH,MAAMjzB,EAAIe,EAAKkB,OAASA,EAClCs4B,EAAUtH,MAAMhzB,EAAIc,EAAKoB,MAAQA,EAEjCo4B,EAAU5I,SAAS5xB,EAAIsB,IAAgB6xB,QAAUnyB,EAAKa,QACtD24B,EAAU5I,SAAS3xB,EAAIqB,IAAgB6xB,QAAUnyB,EAAKc,QACtD04B,EAAU5I,SAAS1xB,EAAIoB,IAAgB6xB,QAAUnyB,EAAKe,QAEtDy4B,EAAUh5B,SAASxB,EAAIgB,EAAKQ,SAASxB,EACrCw6B,EAAUh5B,SAASvB,EAAIe,EAAKQ,SAASvB,EACrCu6B,EAAUh5B,SAAStB,EAAIc,EAAKQ,SAAStB,EAErCs6B,EAAU5b,SAAW7d,EAAyBC,GAK9Cwd,EAAM/C,IAAI+e,GACHA,EAxELx3B,QAAQ2G,KAAK,wBAAyB3I,EAAKL,SAP3CqC,QAAQ2G,KAAK,iCAAkC4wB,EAAUv5B,EAAKL,KAkFrD03B,GAAsB,SAACvrB,GAClC,IAAMgG,EAAW,IAAIxR,IAAoB,EAAG,EAAG,EAAG,GAC5CK,EAAW,IAAIL,IAAwB,CAC3CW,MAAO,aACPyxB,KAAMpyB,IACNoO,QAAS,GACTikB,aAAa,IAETkH,EAAe,IAAIv5B,IAAWwR,EAAUnR,GAC9Ck5B,EAAajc,SAAW/R,GAA0BC,EAAON,GAAiB8lB,IAE1E,IAAMwI,EAAa,IAAIx5B,IACvBw5B,EAAWlc,SAAW/R,GAA0BC,EAAON,GAAiB3L,MACxEi6B,EAAWt5B,SAASxB,EAAI8M,EAAMtL,SAASxB,EACvC86B,EAAWt5B,SAASvB,EAAI6M,EAAMtL,SAASvB,EACvC66B,EAAWt5B,SAAStB,GAAK,IACzB46B,EAAW5H,MAAMlzB,EAAI8M,EAAM3K,MAC3B24B,EAAW5H,MAAMjzB,EAAI6M,EAAM5K,OAC3B44B,EAAW5H,MAAMhzB,EAAI,EAKrB46B,EAAWrf,IAAIof,GAEfve,GAASkC,MAAM/C,IAAIqf,IAGRxC,GAAiC,SAC5CyC,GAEA,IAAMjoB,EAAW,IAAIxR,IAAoB,EAAG,EAAG,EAAG,GAC5CK,EAAW,IAAIL,IAAwB,CAC3CW,MAAO,aACPyxB,KAAMpyB,IACNoO,QAAS,GACTikB,aAAa,IAETkH,EAAe,IAAIv5B,IAAWwR,EAAUnR,GAC9Ck5B,EAAajc,SAAWzR,GACtB4tB,EACApuB,GAA4B2lB,IAG9B,IAAMwI,EAAa,IAAIx5B,IACvBw5B,EAAWlc,SAAWzR,GACpB4tB,EACApuB,GAA4B9L,MAE9Bi6B,EAAWt5B,SAASxB,EAAI+6B,EAAiBv5B,SAASxB,EAClD86B,EAAWt5B,SAASvB,EAAI86B,EAAiBv5B,SAASvB,EAElD66B,EAAW5H,MAAMlzB,EAAI+6B,EAAiB54B,MACtC24B,EAAW5H,MAAMjzB,EAAI86B,EAAiB74B,OACtC44B,EAAW5H,MAAMhzB,EAAI,EAMrB46B,EAAWrf,IAAIof,GAEfve,GAASkC,MAAM/C,IAAIqf,IAGR9D,GAAyB,SACpCntB,GAEAA,EAAQnG,SAAQ,SAAC0J,GACf,IAAMlM,EAAOiP,GAA2B/C,EAAIzM,GAAIyM,EAAI5K,YACpD,QAAaE,IAATxB,EAAJ,CAQA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GAClE,QAAewB,IAAXwP,EAKJoK,GAASkC,MAAM+U,OAAOrhB,QAILxP,IAFA4Z,GAASkC,MAAM+L,4BAA4B,OAAQrpB,IAGlE8B,QAAQ2G,KACN,uEACAzI,QAXF8B,QAAQ2G,KAAK,oDAAqDzI,QATlE8B,QAAQ2G,KACN,gDACAyD,EAAIzM,GACJyM,EAAI5K,gBAuBCq0B,GAAuB,SAACpnB,GACnCA,EAAQ/L,SAAQ,SAACu0B,GACf,OAAa,CACX,IAAM/2B,EAAOR,EAAuBu3B,GAC9B/lB,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GAClE,QAAewB,IAAXwP,EACF,MAEFoK,GAASkC,MAAM+U,OAAOrhB,GAExB,OAAa,CACX,IAAMhR,EAAOR,EAAuBu3B,EAAQn4B,EAAgB46B,KACtDxoB,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,GAClE,QAAewB,IAAXwP,EACF,MAEFoK,GAASkC,MAAM+U,OAAOrhB,QAKfsjB,GAAwB,SACnCC,EACAnO,GACI,IAAD,EACH,QAAiB5kB,IAAb+yB,EAyBY,EADdnZ,GAASgC,OAAOM,SAAhB,2BAC0C6O,OAxB1C,QAAqB/qB,IAAjB4kB,EAA4B,CAC9B,IAAMpmB,EAAOuL,GAA2B6a,EAAa3mB,IAC/CuR,EAASoK,GAASkC,MAAM+L,4BAA4B,OAAQrpB,QACnDwB,IAAXwP,GACFoK,GAASkC,MAAM+U,OAAOrhB,KAkSjB2jB,GAAsB,SAACl1B,EAAYu4B,GAC9C,IAAMh4B,EAAOqM,GAAyB5M,QAGvB+B,IAFA4Z,GAASkC,MAAM+L,4BAA4B,OAAQrpB,IAGhE8B,QAAQ2G,KAAK,gDAAiDzI,IAsD5DqzB,GAAgB,SAAC5zB,EAAYmb,GACjC,IAAMjS,EAA4B,GAE5BmxB,EADa1e,GAASgC,OAAOM,SAAhB,WAIbqc,EAAa,IAAI35B,IAA0B,CAAEW,MAAO,YACpDi5B,EAAgB,IAAI55B,IAAqB,EAAG,IAC5C65B,EAAY,IAAI75B,IAAW45B,EAAeD,GAChDE,EAAUjI,MAAMlzB,EAAI,GACpBm7B,EAAUjI,MAAMjzB,EAAI,GACpBk7B,EAAUC,YAAc,EACxBD,EAAUzQ,OAAOvE,IARF,GAUf,IAAMkV,EAAc,IAAI/5B,IAA0B,CAAEW,MAAO,YACrDq5B,EAAiB,IAAIh6B,IAAqB,EAAG,IAC7Ci6B,EAAW,IAAIj6B,IAAWg6B,EAAgBD,GAChDE,EAASrI,MAAMlzB,EAAI,GACnBu7B,EAASrI,MAAMjzB,EAAI,GACnBs7B,EAASH,YAAc,EACvBG,EAAS7Q,OAAOvE,IAhBD,GAkBf,IAAMqV,EAAW,IAAIl6B,IACrBk6B,EAAS/G,OAAO8G,GAChBC,EAAS/G,OAAO0G,GAEhB,IAAMM,EAASD,EAAS7nB,QACxB8nB,EAAOj6B,SAASxB,EAAI8b,EAAK/M,IAAI/O,EAC7By7B,EAAOj6B,SAASvB,EAAI6b,EAAK7M,IAAIhP,EAC7Bw7B,EAAOvI,MAAMlzB,EAAIg7B,EACjBS,EAAOvI,MAAMjzB,EAAI+6B,EACjBS,EAAO/Q,OAAOvE,IA3BC,GA4BfsV,EAAO7c,SAAS1d,KAAOuL,GACrB9L,EACA6I,GAAoBkpB,qBAEtB7oB,EAAQjG,KAAK63B,GAEb,IAAMC,EAASF,EAAS7nB,QACxB+nB,EAAOl6B,SAASxB,EAAI8b,EAAK7M,IAAIjP,EAC7B07B,EAAOl6B,SAASvB,EAAI6b,EAAK7M,IAAIhP,EAC7By7B,EAAOxI,MAAMlzB,EAAIg7B,EACjBU,EAAOxI,MAAMjzB,EAAI+6B,EACjBU,EAAOhR,OAAOvE,IAvCC,GAwCfuV,EAAO9c,SAAS1d,KAAOuL,GACrB9L,EACA6I,GAAoBipB,sBAEtB5oB,EAAQjG,KAAK83B,GAEb,IAAMC,EAASH,EAAS7nB,QACxBgoB,EAAOn6B,SAASxB,EAAI8b,EAAK/M,IAAI/O,EAC7B27B,EAAOn6B,SAASvB,EAAI6b,EAAK/M,IAAI9O,EAC7B07B,EAAOzI,MAAMlzB,EAAIg7B,EACjBW,EAAOzI,MAAMjzB,EAAI+6B,EACjBW,EAAOjR,OAAOvE,IAnDC,GAoDfwV,EAAO/c,SAAS1d,KAAOuL,GACrB9L,EACA6I,GAAoBgpB,wBAEtB3oB,EAAQjG,KAAK+3B,GAEb,IAAMC,EAASJ,EAAS7nB,QAWxB,OAVAioB,EAAOp6B,SAASxB,EAAI8b,EAAK7M,IAAIjP,EAC7B47B,EAAOp6B,SAASvB,EAAI6b,EAAK/M,IAAI9O,EAC7B27B,EAAO1I,MAAMlzB,EAAIg7B,EACjBY,EAAO1I,MAAMjzB,EAAI+6B,EACjBY,EAAOlR,OAAOvE,IA/DC,GAgEfyV,EAAOhd,SAAS1d,KAAOuL,GACrB9L,EACA6I,GAAoB+oB,yBAEtB1oB,EAAQjG,KAAKg4B,GACN/xB,GCvpDIgyB,GAAb,WAKE,WACEl4B,EACA4F,EACAlD,EACAy1B,GACC,0BATHvyB,WASE,OARF5F,WAQE,OAPF0C,aAOE,OANFy1B,mBAME,EACAt2B,KAAK+D,MAAQA,EACb/D,KAAKa,QAAUA,EACfb,KAAK7B,MAAQA,EACb6B,KAAKs2B,cAAgBA,EAdzB,kEAiBE,SAA8BvyB,GAC5B,OAAOsf,mBAAQtf,GAAO,SAACuf,GACrB,IAAMtnB,EAAWunB,GACfxf,EAAMO,YAAYxC,KAAI,SAAC3G,GACrB,MAAO,CAAEA,KAAI6B,WAAY+G,EAAMM,QAAQlJ,GAAI6B,gBAG/CsmB,EAAMxe,GAAGsB,uBAAyBpK,OAxBxC,+BA4BE,WAAqB,IAAD,EACmB8a,GAAS2B,GAAGC,wBAAzC/b,EADU,EACVA,MAAOD,EADG,EACHA,OAAQic,EADL,EACKA,IAGvB,MAAO,CAAE4d,KAJS,EACU3d,KACRjc,EAAQ,EAEb65B,KADF7d,EAAMjc,EAAS,KA/BhC,8BAmCE,WACE,IAAI65B,EAAO,EACPC,EAAO,EACL1K,EP1CDhG,GO2CL,QAAY5oB,IAAR4uB,EAAmB,CACrB,IAAMhN,EAAS9e,KAAKy2B,oBACpBF,EAAOzX,EAAOyX,KACdC,EAAO1X,EAAO0X,UAEdD,EAAOzK,EAAItxB,EACXg8B,EAAO1K,EAAIrxB,EAEb,MAAO,CAAE87B,OAAMC,UA/CnB,iCAkDE,SAAoBE,GAAiB,IAAD,OAC5B3yB,OAAmB7G,IAAXw5B,EAAuB12B,KAAK+D,MAAQ2yB,EAClD,OAAOrT,mBAAQtf,GAAO,SAACuf,GACrBA,EAAMziB,QAAQ0D,QAAU,EAAK1D,QAAQ0D,UACrC+e,EAAMziB,QAAQ2D,QAAU,EAAK3D,QAAQ2D,UACrC8e,EAAMziB,QAAQ7C,OAAS,EAAK6C,QAAQ81B,gCAvD1C,KCmBaC,GAAb,6JAGE,cAHF,4CAKE,SAA+BlqB,GAC7B,QAA0BxP,IAAtBwP,EAAO1P,WAIX,OAAI0P,EAAO1P,aAAehD,EAAYsB,KAC7BK,EAAU+Q,GAEfA,EAAO1P,aAAehD,EAAYiJ,OAC7B8G,GAAY2C,GAEjBA,EAAO1P,aAAehD,EAAY4I,MAC7B2E,GAAWmF,GAEhBA,EAAO1P,aAAehD,EAAYsJ,iBhCPL,SACnC1H,GAEA,IAAMC,EAA6B,CACjCV,GAAIW,IAAgBC,eACpBC,SAAUzB,EAAW,EAAG,GACxB8B,QAAS,GACTC,QAAS,EACTC,QAAS,EACTG,OAAQ,GACRC,MAAO,GACPC,MAAO,GACPE,iBAAiB,EACjBC,UAAU,EACVC,WAAYhD,EAAYsJ,iBACxB7G,MAAO,OAGT,OAAOhB,gBAAMI,EAAUD,GgCVZi7B,CAAsBnqB,QAE/BlP,QAAQ2G,KAAK,oCAAqCuI,GAfhDlP,QAAQ2G,KAAK,qCAAsCuI,KAPzD,sCA0BE,SAAyBA,EAAmB0W,QAC3BlmB,IAAXwP,IFgSoB,MAAtB+iB,KACFA,GAAqB,IAAItD,IAEpBsD,IE9RMqH,WACT,CACEl6B,MAAO8P,EAAO9P,MACdF,OAAQgQ,EAAOhQ,OACfC,MAAO+P,EAAO/P,MACdxB,GAAIuR,EAAOvR,GACXa,SAAU,IAAIF,IACZ4Q,EAAO1Q,SAASxB,EAChBkS,EAAO1Q,SAASvB,EAChBiS,EAAO1Q,SAAStB,GAElB0xB,SAAU,IAAItwB,IACZ4Q,EAAOrQ,QACPqQ,EAAOpQ,QACPoQ,EAAOnQ,UAGX6mB,KAjDN,4CA4DE,SAA+BlG,EAAe7Y,GAAuB,IAAD,OAClE,OAAOgf,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAC1BpG,EAAIhf,SAAQ,SAAC/C,GACX,IAAMuR,EAAS,EAAK3I,MAAMM,QAAQlJ,GAClC,GAAImoB,EAAMhf,YAAY6c,SAAShmB,GAAK,CAClC,IAAMoN,EAAQ+a,EAAMhf,YAAYuO,QAAQ1X,GACxCmoB,EAAMhf,YAAYwJ,OAAOvF,EAAO,GAChC,EAAKwuB,yBAAyBrqB,GAAQ,QAGPxP,IAA7BomB,EAAMjf,QAAQqI,EAAOvR,MACvBkJ,EAAQjG,KAAKsO,GACTA,EAAO1P,aAAehD,EAAYiJ,QACnCyJ,EAAkBrC,gBAAgBnM,SAAQ,SAAC84B,QAC1B95B,IAAZ85B,IACD1T,EAAMjf,QAAQ2yB,GAAkB75B,cAAWD,aAI3ComB,EAAMjf,QAAQqI,EAAOvR,QAIhCmoB,EAAMxe,GAAGsB,uBAAyBmd,GAChCD,EAAMhf,YAAYxC,KAAI,SAAC3G,GACrB,MAAO,CAAEA,KAAI6B,WAAYsmB,EAAMjf,QAAQlJ,GAAI6B,qBArFrD,8CA2FE,SAAiCqH,GAAuB,IAAD,EAC9BrE,KAAKi3B,mBAApBV,EAD6C,EAC7CA,KAAMC,EADuC,EACvCA,KACRU,EAAWvd,GAAc4c,EAAMC,GAC/BlgB,EAAO,IAAIxa,IACjBuI,EAAQnG,SAAQ,SAACwO,GACf,IAAMub,EAAIvb,EAAO/P,MAAQ,EACnBurB,EAAIxb,EAAOhQ,OAAS,EACpBlC,EAAIkS,EAAO1Q,SAASxB,EACpBC,EAAIiS,EAAO1Q,SAASvB,EAC1B6b,EAAK6gB,eAAc,IAAIr7B,KAAgB6kB,IAAInmB,EAAIytB,EAAGxtB,EAAIytB,EAAG,KACzD5R,EAAK6gB,eAAc,IAAIr7B,KAAgB6kB,IAAInmB,EAAIytB,EAAGxtB,EAAIytB,EAAG,KACzD5R,EAAK6gB,eAAc,IAAIr7B,KAAgB6kB,IAAInmB,EAAIytB,EAAGxtB,EAAIytB,EAAG,KACzD5R,EAAK6gB,eAAc,IAAIr7B,KAAgB6kB,IAAInmB,EAAIytB,EAAGxtB,EAAIytB,EAAG,QAE3D,IAAMkP,EAAa,IAAIt7B,IAIvB,OAHAwa,EAAKsX,UAAUwJ,GAGR,CACL5T,MAHY0T,EAAS18B,EAAI48B,EAAW58B,EAIpCipB,MAHYyT,EAASz8B,EAAI28B,EAAW38B,KA5G1C,+BAmHE,SAAkB4J,EAAsBmf,EAAeC,GACrDpf,EAAQnG,SAAQ,SAACwO,GACXA,EAAO1P,aAAehD,EAAY4I,OACpC8J,EAAO1Q,SAASxB,EAAIkS,EAAO1Q,SAASxB,EAAIgpB,EACxC9W,EAAO1Q,SAASvB,EAAIiS,EAAO1Q,SAASvB,EAAIgpB,EACxCpf,EAAQnG,SAAQ,SAAC0J,GACV8E,EAAiBlF,YAAY2Z,SAASvZ,EAAIzM,MAC7CyM,EAAI5L,SAASxB,EAAIoN,EAAI5L,SAASxB,EAAIgpB,EAClC5b,EAAI5L,SAASvB,EAAImN,EAAI5L,SAASvB,EAAIgpB,YAIXvmB,IAAvBwP,EAAM,UACRA,EAAO1Q,SAASxB,EAAIkS,EAAO1Q,SAASxB,EAAIgpB,EACxC9W,EAAO1Q,SAASvB,EAAIiS,EAAO1Q,SAASvB,EAAIgpB,UAjIlD,GACU4S,I,oBCPGgB,GAAb,6JACE,WAAO,IAAD,OACEhzB,EAAuB,GACzBsC,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClC,EAAKnlB,MAAM2b,QAAQzV,QAAQnG,SAAQ,SAACwO,GAClC,IAAI4qB,EAAY,EAAKC,+BAA+B7qB,QACnCxP,GAAbo6B,IAGAA,EAAUt6B,aAAehD,EAAYiJ,QACtCq0B,EAAqBjtB,gBAAgBnM,SAAQ,SAAC84B,QAC7B95B,IAAZ85B,IACD1T,EAAMjf,QAAQ2yB,GAAkB75B,SAAWm6B,EAAWn8B,OAI7DmoB,EAAMjf,QAAQizB,EAAUn8B,IAAMm8B,EAC9BjzB,EAAQjG,KAAKk5B,UAIjB,GAAIt3B,KAAKs2B,cAAe,CACtB,IAAMkB,EAAkC,CACtCjP,GAAIvoB,KAAK7B,MACT8qB,KAAM,CACJvtB,KAAMuG,EAAa4X,WACnBC,QAAS,CAAEzV,QAASA,IAEtBykB,KAAM,CACJptB,KAAMuG,EAAagb,cACnBnD,QAAS,CAAEoD,IAAK7Y,EAAQvC,KAAI,SAACqN,GAAD,OAAOA,EAAEhU,QAEvCstB,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAEpB7wB,EAAW3G,KAAK03B,oBAAoB/wB,GAEpCD,GAASC,GAELG,MACFzC,EAAQnG,SAAQ,SAAC0J,GACfwrB,GAAsBxrB,MAItBb,MACFoW,GAAkBxW,GAGpB5I,EACEsG,EAAQvC,KAAI,SAAC4K,GACX,MAAO,CACLsQ,OAAQ/hB,EAAc08B,OACtBlP,WAAW,IAAI7qB,MAAOiC,cACtB6M,kBAvDV,GAAsCkqB,ICJzBgB,GAAb,6JACE,WAAO,IACG1a,EAAQld,KAAK7B,MAAM2b,QAAnBoD,IACF7Y,EAAuB,GACzBsC,EAAW3G,KAAK63B,+BAA+B3a,EAAK7Y,GAExD,GAAIrE,KAAKs2B,cAAe,CACtB,IAAMkB,EAAqC,CACzCjP,GAAIvoB,KAAK7B,MACT8qB,KAAMjpB,KAAK7B,MACX2qB,KAAM,CACJptB,KAAMuG,EAAa4X,WACnBC,QAAS,CAAEzV,YAEbokB,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAEpB7wB,EAAW3G,KAAK03B,oBAAoB/wB,GACpCD,GAASC,GAELG,MACF0qB,GACEntB,EAAQvC,KAAI,SAAC8F,GACX,MAAO,CAAEzM,GAAIyM,EAAIzM,GAAI6B,WAAY4K,EAAI5K,gBAKvC+J,MACFoW,GAAkBxW,GAGpB5I,EACEsG,EAAQvC,KAAI,SAAC4K,GACX,MAAO,CACLsQ,OAAQ/hB,EAAc68B,OACtBrP,WAAW,IAAI7qB,MAAOiC,cACtB6M,kBAtCV,GAAyCkqB,ICV5BmB,GAAb,6JACE,WAAO,IAAD,OACI5U,EAAWnjB,KAAK7B,MAAM2b,QAAtBqJ,OAEF6U,EAAuD,GACzDrxB,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClCH,EAAOjlB,SAAQ,SAAC0J,QACgB1K,IAA1BomB,EAAMjf,QAAQuD,EAAIzM,MAIqB,IAAvCmoB,EAAMhf,YAAY6c,SAASvZ,EAAIzM,KACV,IAAnByM,EAAIwb,YAGNE,EAAMhf,YAAYwJ,OAAOwV,EAAMhf,YAAYuO,QAAQjL,EAAIzM,IAAK,IAGvC,IAAnByM,EAAIwb,YACNE,EAAMhf,YAAYlG,KAAKwJ,EAAIzM,IAK/B68B,EAAc55B,KAAK,CACjBjD,GAAIyM,EAAIzM,GACRioB,WAAYxb,EAAIwb,cAlBhB5lB,QAAQ2G,KAAK,2BAA4ByD,EAAIzM,UAsCnD68B,EAAc95B,SAAQ,SAACilB,GACrB,IAAMzW,EAAS/F,EAAStC,QAAQ8e,EAAOhoB,SACxB+B,IAAXwP,GAGJ,EAAKqqB,yBAAyBrqB,EAAQyW,EAAOC,eAG/Czc,EAAW3G,KAAKi4B,8BAA8BtxB,GAC9CD,GAASC,GACTwW,GAAkBxW,OAxDtB,GAAgDiwB,ICmCnCsB,GAAb,6JACE,WAAO,IAAD,OACEC,EAAqB,GACrBC,EAAsB,GACtBC,EAAuB,GACrBv5B,EAAYkB,KAAK7B,MAAM2b,QAAvBhb,QACFw5B,EAA8D,GAChE3xB,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClCxkB,EAAQZ,SAAQ,SAACq6B,GACf,QAAwCr7B,IAApComB,EAAMjf,QAAQk0B,EAAcp9B,IAAhC,CAIA,IAAMq9B,EAAoC,CACxCr9B,GAAIo9B,EAAcp9B,GAClBmpB,WAAY,GACZmU,eAAgB,GAChBC,gBAAiB,GACjBC,gBAAiB,IAEbC,EAAWrnB,OAAO2Q,KAAKqW,EAAcjU,iBACfpnB,IAAxBs7B,GACFI,EAAS16B,SAAQ,SAAC26B,GAChBL,EAAoBlU,WAAWuU,GAAOryB,oBACpC8c,EAAMjf,QAAQk0B,EAAcp9B,IAAI09B,OAItCD,EAAS16B,SAAQ,SAAC26B,GAChBvV,EAAMjf,QAAQk0B,EAAcp9B,IAAI09B,GAAOryB,oBACrC+xB,EAAcjU,WAAWuU,OAIzBN,EAAcE,gBAChBF,EAAcE,eAAev6B,SAAQ,SAAC46B,QACU57B,IAA1ComB,EAAMjf,QAAQy0B,EAAoB39B,IAIrBoW,OAAO2Q,KAAK4W,EAAoBxU,YACxCpmB,SAAQ,SAAC26B,GAChBvV,EAAMjf,QAAQy0B,EAAoB39B,IAAI09B,GAAOryB,oBAC3CsyB,EAAoBxU,WAAWuU,OANjC30B,GAAY,2BAA4B40B,EAAoB39B,OAYlEm9B,EAAel6B,KAAKo6B,QAvClBt0B,GAAY,2BAA4Bq0B,EAAcp9B,OA0C1D2D,EAAQZ,SAAQ,SAACq6B,EAAehwB,GAC9B,QAAwCrL,IAApComB,EAAMjf,QAAQk0B,EAAcp9B,IAAhC,CAIA,IAAM6B,EAAasmB,EAAMjf,QAAQk0B,EAAcp9B,IAAI6B,WAC7Cw7B,EAAsBF,EAAe/vB,GAEvCvL,IAAehD,EAAYsB,MAC7B,EAAKy9B,SACHR,EACAjV,EACAkV,EACAL,EACAC,EACAC,GAIAr7B,IAAehD,EAAYiJ,QAC7B,EAAK+1B,WACHT,EACAjV,EACAkV,EACAL,EACAC,EACAC,QAxBFn0B,GAAY,2BAA4Bq0B,EAAcp9B,UA8B5D,GAAI6E,KAAKs2B,cAAe,CACtB,IAAMkB,EAA6C,CACjDjP,GAAIvoB,KAAK7B,MACT8qB,KAAM,CACJvtB,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASkB,KAAK7B,MAAM2b,QAAQhb,QAAQgD,KAClC,YAAyC,IAAtC3G,EAAqC,EAArCA,GAAImpB,EAAiC,EAAjCA,WAAYmU,EAAqB,EAArBA,eACXlwB,EAAQ+vB,EAAe/K,WAAU,SAAC7a,GAAD,OAAOA,EAAEvX,KAAOA,KACjD89B,GAAoB,IAAX1wB,EACTmwB,EAAkBO,EACpBX,EAAe/vB,GAAOowB,gBACtB,GACEA,EAAkBM,EACpBX,EAAe/vB,GAAOmwB,gBACtB,GAEJ,MAAO,CACLv9B,KACAmpB,aACAmU,iBACAC,kBACAC,wBAMV7P,KAAM,CACJptB,KAAMuG,EAAasiB,sBACnBzK,QAAS,CAAEhb,QAASw5B,IAEtB7P,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAgCpB,GA7BA7wB,EAAW3G,KAAK03B,oBAAoB/wB,GAEhCG,MAEFhI,EAAQZ,SAAQ,SAACq6B,GACf,EAAKW,oBAAoBX,EAAe5xB,GACxC5I,EAAc,CACZ,CACEif,OAAQ/hB,EAAck+B,OACtB1Q,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQ/F,EAAStC,QAAQk0B,EAAcp9B,OAIvCo9B,EAAcE,gBAChBF,EAAcE,eAAev6B,SAAQ,SAAC46B,GACpC,EAAKI,oBAAoBJ,EAAqBnyB,GAC9C5I,EAAc,CACZ,CACEif,OAAQ/hB,EAAck+B,OACtB1Q,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQ/F,EAAStC,QAAQy0B,EAAoB39B,aAQrD2L,KAAsB,CACpBqxB,EAAMl6B,OAAS,IACjBk6B,EAAMj6B,SAAQ,SAAC0J,GACbwrB,GAAsBxrB,MAGxB7J,EACEo6B,EAAMr2B,KAAI,SAAC4K,GACT,MAAO,CACLsQ,OAAQ/hB,EAAc08B,OACtBlP,WAAW,IAAI7qB,MAAOiC,cACtB6M,eAMR,IAAM0sB,EAAc7nB,OAAO2Q,KAAKkW,GAC5BgB,EAAYn7B,OAAS,IACvBuzB,GACE4H,EAAYt3B,KAAI,SAAC3G,GACf,MAAO,CACLA,KACA6B,WAAY2J,EAAStC,QAAQlJ,GAAI6B,gBAKvCo8B,EAAYt3B,KAAI,SAAC3G,GACfi4B,GAAsBzsB,EAAStC,QAAQlJ,OAGzC4C,EACEq7B,EAAYt3B,KAAI,SAAC3G,GACf,MAAO,CACL6hB,OAAQ/hB,EAAck+B,OACtB1Q,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQ/F,EAAStC,QAAQlJ,SAM7Bk9B,EAAQp6B,OAAS,IACnBuzB,GACE6G,EAAQv2B,KAAI,SAAC8F,GACX,MAAO,CAAEzM,GAAIyM,EAAIzM,GAAI6B,WAAY4K,EAAI5K,gBAGzCe,EACEs6B,EAAQv2B,KAAI,SAAC4K,GACX,MAAO,CACLsQ,OAAQ/hB,EAAc68B,OACtBrP,WAAW,IAAI7qB,MAAOiC,cACtB6M,eAON5F,OACFH,EAAW3G,KAAKi4B,8BAA8BtxB,IAGhDD,GAASC,GAELI,MACFoW,GAAkBxW,KA1NxB,iCA8NE,SAAoB4xB,EAA6B7B,GAC/C,QAAyCx5B,IAArCw5B,EAAOryB,QAAQk0B,EAAcp9B,IAAjC,CAIA,IAAMuR,EAASgqB,EAAOryB,QAAQk0B,EAAcp9B,IACtCk+B,OACmBn8B,IAAvBwP,EAAM,SAA8BA,EAAM,QAAazO,OAAS,EAI5D26B,EAAWrnB,OAAO2Q,KAAKqW,EAAcjU,YAErB,IAApBsU,EAAS36B,SAAmD,IAAnC26B,EAASzX,SAJC,cAKH,IAAZkY,EACpB9F,GACEgF,EAAcp9B,GACduR,EAAO1P,WACP0P,EAAO1Q,SAASxB,EAChBkS,EAAO1Q,SAASvB,IAQlB+2B,GAAuB,CACrB,CACEr2B,GAAIo9B,EAAcp9B,GAClB6B,WAAY0P,EAAO1P,cAIvBo2B,GAAsB1mB,GAElB2sB,QAEuBn8B,IAAvBwP,EAAM,SACNgqB,EAAOryB,QAAQqI,EAAM,UAEpBgqB,EAAOryB,QAAQqI,EAAM,SAAwBlF,YAAYtJ,SACxD,SAAC/C,GACC,IAAMyM,EAAM8uB,EAAOryB,QAAQlJ,GAC3Bq2B,GAAuB,CACrB,CACEr2B,GAAIA,EACJ6B,WAAY4K,EAAI5K,cAGpBo2B,GAAsBxrB,YAhD9B1D,GAAY,2BAA4Bq0B,EAAcp9B,MAhO5D,sBAwRE,SACEo9B,EACAjV,EACAkV,EACAL,EACAC,EACAC,GACC,IAAD,OAMA,GAFiB9mB,OAAO2Q,KAAKqW,EAAcjU,YAE9BnD,SALwB,YAKD,CAClC,IAAImY,GAAoB,EAClB99B,EAAO8nB,EAAMjf,QAAQk0B,EAAcp9B,IACnCgC,EAAYmmB,EAAMjf,QAAQk0B,EAAcp9B,IAAagC,SAE3D,QAAiBD,IAAbC,EAAwB,CAC1B,IAAM8K,EAASqb,EAAMjf,QAAQlH,GAC7B,IAA+C,IAA3C6C,KAAKu5B,oBAAoBtxB,EAAQzM,GAAgB,CAAC,IAAD,EACVwE,KAAKw5B,mBAC5Ch+B,EAAKQ,SAASxB,EACdgB,EAAKQ,SAASvB,EACdwN,GAHMkB,EAD2C,EAC3CA,OAAQC,EADmC,EACnCA,IAAYqwB,EADuB,EAC9BlxB,MASrB,IAAqB,IADAD,GAAmBL,EAAQwxB,GACrB,CACzB,IAAMC,EAAWzxB,EAAOoC,gBAAgBwI,QAAQrX,EAAKL,IAIrD,IAHkB,IAAdu+B,GAAmBA,IAAaD,IAClCnW,EAAMjf,QAAQlH,GAAd,gBAA4Cu8B,QAAYx8B,QAIxDA,IADAomB,EAAMjf,QAAQlH,GAAd,gBAA4Cs8B,KAG5CnW,EAAMjf,QAAQlH,GAAd,gBAA4Cs8B,GAAYj+B,EAAKL,GAC7Dm+B,GAAoB,GACW,IAA3BrxB,EAAOmC,iBAA0B,CACnC,IAAMpO,EAAWgE,KAAK25B,oBAAoB1xB,EAAQmB,EAAKD,GACvDma,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASxB,EAAIwB,EAASxB,EAC7C8oB,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASvB,EAAIuB,EAASvB,KAuEvD,IAhE0B,IAAtB6+B,GACF/nB,OAAO2Q,KAAKoB,EAAMjf,SAASnG,SAAQ,SAACf,GAClC,GAAImmB,EAAMjf,QAAQlH,GAAUH,aAAehD,EAAYiJ,OAAvD,CAGA,IAAMgF,EAASqb,EAAMjf,QAAQlH,GAE7B,IAA+C,IAA3C,EAAKo8B,oBAAoBtxB,EAAQzM,GAArC,CAN+C,MASN,EAAKg+B,mBAC5Ch+B,EAAKQ,SAASxB,EACdgB,EAAKQ,SAASvB,EACdwN,GAHMkB,EATuC,EASvCA,OAAQC,EAT+B,EAS/BA,IAAYqwB,EATmB,EAS1BlxB,MAUrB,IAAqB,IADAD,GAAmBL,EAAQwxB,GAE9C,QAAyCv8B,IAArC+K,EAAOoC,gBAAgBovB,GAAyB,CAClD,IAAMG,EAAe3xB,EAAOoC,gBAAgBwI,QAAQrX,EAAKL,IAUzD,IATsB,IAAlBy+B,GAAuBA,IAAiBH,IAC1CnW,EAAMjf,QAAQlH,GAAd,gBACEy8B,QACE18B,GAENomB,EAAMjf,QAAQlH,GAAd,gBAA4Cs8B,GAAYj+B,EAAKL,GAE7Di9B,EAAQj7B,GAAYqJ,oBAAU8c,EAAMjf,QAAQlH,SAEAD,IAAxComB,EAAMjf,QAAQ7I,EAAKL,IAAnB,SAAmD,CACrD,IAAM0+B,EAAcvW,EAAMjf,QAAQ7I,EAAKL,IAAnB,SAEdy+B,EADYtW,EAAMjf,QAAQw1B,GACDxvB,gBAAgBwI,QAAQrX,EAAKL,KACtC,IAAlBy+B,IACFtW,EAAMjf,QAAQw1B,GAAd,gBACED,QACE18B,EACJk7B,EAAQyB,GAAerzB,oBAAU8c,EAAMjf,QAAQw1B,KAOnD,GAHAvW,EAAMjf,QAAQ7I,EAAKL,IAAnB,SAAsC8M,EAAO9M,GAC7Cm+B,GAAoB,GAEW,IAA3BrxB,EAAOmC,gBAA0B,CACnC,IAAMpO,EAAW,EAAK29B,oBAAoB1xB,EAAQmB,EAAKD,GACvDma,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASxB,EAAIwB,EAASxB,EAC7C8oB,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASvB,EAAIuB,EAASvB,QAE1C,GAAIwN,EAAOoC,gBAAgBovB,KAAcj+B,EAAKL,KACpB,IAA3B8M,EAAOmC,gBAA0B,CACnC,IAAMpO,EAAW,EAAK29B,oBAAoB1xB,EAAQmB,EAAKD,GACvDma,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASxB,EAAIwB,EAASxB,EAC7C8oB,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASvB,EAAIuB,EAASvB,EAC7C6+B,GAAoB,SAOJ,IAAtBA,QACep8B,IAAbC,EAAwB,CAC1B,IACMy8B,EADStW,EAAMjf,QAAQlH,GACDkN,gBAAgBwI,QAAQrX,EAAKL,KACnC,IAAlBy+B,IACFtW,EAAMjf,QAAQlH,GAAd,gBACEy8B,QACE18B,EAEJk7B,EAAQj7B,GAAYqJ,oBAAU8c,EAAMjf,QAAQlH,KAG7CmmB,EAAMjf,QAAQk0B,EAAcp9B,IAAagC,cAAWD,MAvZ/D,wBA6ZE,SACEq7B,EACAjV,EACAkV,EACAL,EACAC,EACAC,GACC,IAAD,OACMO,EAAWrnB,OAAO2Q,KAAKqW,EAAcjU,YACrCwV,EAAyB,QACzBC,EAA4B,WAC5BC,EAAiC,gBACjCC,EAAmC,kBACnCC,EAAwB,OACxBC,EAA2B,UAC3BC,EAA4B,WAE1BzB,EAAoBJ,EAApBI,gBAER,QAAwBz7B,IAApBy7B,GAAiCA,EAAgB16B,OAAS,EAAG,CAC/D,IAAMgK,EAASqb,EAAMjf,QAAQk0B,EAAcp9B,IACrCk/B,EAAoB,GAE1B1B,EAAgBz6B,SAAQ,SAAC1C,QACQ0B,IAA3BomB,EAAMjf,QAAQ7I,EAAKL,KAKvBk/B,EAAQj8B,KAAK5C,EAAKL,IAClBk9B,EAAQj6B,KAAKoI,oBAAUhL,WAChB8nB,EAAMjf,QAAQ7I,EAAKL,KANxB+I,GAAY,8BAA+B1I,EAAKL,OASpD8M,EAAOoC,gBAAgBnM,SAAQ,SAAC/C,EAAIoN,QACvBrL,IAAP/B,GAAoBk/B,EAAQlZ,SAAShmB,KACtCmoB,EAAMjf,QAAQ4D,EAAO9M,IAAekP,gBACnC9B,QACErL,MAKV,GACE07B,EAASzX,SAAS+Y,IAClBtB,EAASzX,SAASgZ,IAClBvB,EAASzX,SAAS2Y,IAClBlB,EAASzX,SAAS4Y,GAClB,CACA,IAAM9xB,EAASqb,EAAMjf,QAAQk0B,EAAcp9B,IACrCm/B,EAAU9B,EAAoBlU,WAApB,KACViW,EAAa/B,EAAoBlU,WAApB,QACbkW,EAAWhC,EAAoBlU,WAApB,MACXmW,EAAcjC,EAAoBlU,WAApB,SACdoW,GAAoD,IAA7BzyB,EAAM,cACnC,QAAgB/K,IAAZo9B,QAAwCp9B,IAAfq9B,EAA0B,CACrDr2B,GAAY,uCACXof,EAAMjf,QAAQ4D,EAAO9M,IAAekP,gBAAgBnM,SACnD,SAACu0B,GACC,QAAev1B,IAAXu1B,EAAJ,CAGA,IAAMj3B,EAAO8nB,EAAMjf,QAAQouB,QACdv1B,IAAT1B,GAKJg9B,EAAoBE,gBAAiBt6B,KAAKoI,oBAAUhL,IACpD68B,EAAQj6B,KAAKoI,oBAAUhL,WAChB8nB,EAAMjf,QAAQouB,IANnBvuB,GAAY,mCAAoCuuB,OAStD,IAAM/pB,EAAUT,EAAOI,KAAOJ,EAAOG,QACpCkb,EAAMjf,QAAQ4D,EAAO9M,IAAekP,gBAAkBI,MACrD/B,GACAgC,UAAKxN,QACF,GACLs9B,IAAavyB,EAAOO,OACpB8xB,IAAYryB,EAAOI,MACnBkyB,IAAetyB,EAAOG,SACtBqyB,IAAgBxyB,EAAOU,SACvB,CAAC,IAAD,EAII3I,KAAK26B,oCACP1yB,EACAyyB,EACAJ,EACAC,GANAK,EAFF,EAEEA,gBACApwB,EAHF,EAGEA,mBAQFowB,EAAgB18B,SAAQ,SAACu0B,GACvB,IAAMj3B,EAAO8nB,EAAMjf,QAAQouB,QACdv1B,IAAT1B,GAKJg9B,EAAoBE,gBAAiBt6B,KAAKoI,oBAAUhL,IACpD68B,EAAQj6B,KAAKoI,oBAAUhL,WAChB8nB,EAAMjf,QAAQouB,IANnBvuB,GAAY,mCAAoCuuB,MASnDnP,EAAMjf,QAAQ4D,EAAO9M,IAAekP,gBAAkB7D,oBACrDgE,IAKN,GACEouB,EAASzX,SAASiZ,IAClBxB,EAASzX,SAAS8Y,GAClB,CACA,IAAMhyB,EAASqb,EAAMjf,QAAQk0B,EAAcp9B,IAE3C,IAD8D,IAA/B8M,EAAM,gBAEnCA,EAAOoC,gBAAgBnM,SAAQ,SAAC/C,EAAIoN,GAClC,QAAWrL,IAAP/B,EAAkB,CACpB,IAAMK,EAAO8nB,EAAMjf,QAAQlJ,GAC3B,QAAa+B,IAAT1B,EAAoB,CAAC,IAAD,EAChBq/B,EAAcr0B,oBAAUhL,EAAKQ,UADb,EAEE,EAAKw9B,mBAC3Bh+B,EAAKQ,SAASxB,EACdgB,EAAKQ,SAASvB,EACdwN,GAHMmB,EAFc,EAEdA,IAAKD,EAFS,EAETA,OAFS,EAOL,EAAKwwB,oBAAoB1xB,EAAQmB,EAAKD,GAA/C3O,EAPc,EAOdA,EAAGC,EAPW,EAOXA,EACX6oB,EAAMjf,QAAQlJ,GAAIa,SAASxB,EAAIA,EAC/B8oB,EAAMjf,QAAQlJ,GAAIa,SAASvB,EAAIA,EAC/B29B,EAAQj9B,GAAMqL,oBAAU8c,EAAMjf,QAAQlJ,IACtC,UAAAq9B,EAAoBC,sBAApB,SAAoCr6B,KAAK,CACvCjD,KACAmpB,WAAY,CACVtoB,SAAU,CACRxB,EAAGqgC,EAAYrgC,EACfC,EAAGogC,EAAYpgC,EACfC,EAAGmgC,EAAYngC,WAKlB,CACL,IAAMuN,EAASqb,EAAMjf,QAAQk0B,EAAcp9B,IACvC2/B,GAAc,EAClBvpB,OAAO2Q,KAAKoB,EAAMjf,SAASnG,SAAQ,SAAC/C,GAAQ,IAAD,EACzC,IAAoB,IAAhB2/B,GAGAxX,EAAMjf,QAAQlJ,GAAI6B,aAAehD,EAAYsB,KAAjD,CAIA,IAAME,EAAO8nB,EAAMjf,QAAQlJ,GAE3B,QAAqB+B,IAAjB1B,EAAKyB,QAIT,QAAsBC,IAAlB1B,EAAK2B,SAKT,IAAqB,IADAmL,GAAmBL,EAAQM,KAKU,IAAtD,EAAKwyB,wBAAwB9yB,EAAQzM,EAAM+M,GAA/C,CAIA,IAAMsyB,EAAcr0B,oBAAUhL,EAAKQ,UA3BM,EA4BjB,EAAKw9B,mBAC3Bh+B,EAAKQ,SAASxB,EACdgB,EAAKQ,SAASvB,EACdwN,GAHMmB,EA5BiC,EA4BjCA,IAAKD,EA5B4B,EA4B5BA,OA5B4B,EAiCxB,EAAKwwB,oBAAoB1xB,EAAQmB,EAAKD,GAA/C3O,EAjCiC,EAiCjCA,EAAGC,EAjC8B,EAiC9BA,EAEV6oB,EAAMjf,QAAQk0B,EAAcp9B,IAAekP,gBAC1C9B,GACE/M,EAAKL,GAERmoB,EAAMjf,QAAQ7I,EAAKL,IAAagC,SAAW8K,EAAO9M,GAEnDmoB,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASxB,EAAIA,EACpC8oB,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASvB,EAAIA,EAEpC,UAAA+9B,EAAoBC,sBAApB,SAAoCr6B,KAAK,CACvCjD,GAAIK,EAAKL,GACTmpB,WAAY,CACVtoB,SAAU,CACRxB,EAAGqgC,EAAYrgC,EACfC,EAAGogC,EAAYpgC,EACfC,EAAGmgC,EAAYngC,GAEjByC,cAAUD,KAIdk7B,EAAQ58B,EAAKL,IAAMqL,oBAAU8c,EAAMjf,QAAQ7I,EAAKL,KAChD2/B,GAAc,eAIf,CAOL,IANA,IAAM7yB,EAASqb,EAAMjf,QAAQk0B,EAAcp9B,IACrCoP,EAAOtC,EAAOI,KAAOJ,EAAOG,QAC5BoC,EAAqBC,MAAMF,GAAMG,UAAKxN,GAExC89B,EAAkBzwB,EAChB2X,EAAO3Q,OAAO2Q,KAAKoB,EAAMjf,SACtBgP,EAAI,EAAGA,EAAI6O,EAAKjkB,UACnB+8B,GAAmB,GADQ3nB,IAAK,CAKpC,IAAMlY,EAAK+mB,EAAK7O,GAEhB,GAAIiQ,EAAMjf,QAAQlJ,GAAI6B,aAAehD,EAAYsB,KAAjD,CAIA,IAAME,EAAO8nB,EAAMjf,QAAQlJ,GAE3B,QAAqB+B,IAAjB1B,EAAKyB,UAIsC,IAA3C+C,KAAKu5B,oBAAoBtxB,EAAQzM,GAArC,CAjBoC,IAqB5B+M,EAAUvI,KAAKw5B,mBACrBh+B,EAAKQ,SAASxB,EACdgB,EAAKQ,SAASvB,EACdwN,GAHMM,MAMJA,GAAS,QAAmCrL,IAA9BsN,EAAmBjC,KACnCiC,EAAmBjC,GAAS/M,EAAKL,GACjC6/B,GAAoC,KAKvC1X,EAAMjf,QAAQk0B,EAAcp9B,IAAekP,gBAAgBnM,SAC1D,SAACu0B,GACC,QAAev1B,IAAXu1B,QAAkDv1B,IAA1BomB,EAAMjf,QAAQouB,GAAuB,CACX,IAAD,EAAnD,IAA4C,IAAxCjoB,EAAmB2W,SAASsR,GAC9B,UAAA+F,EAAoBC,sBAApB,SAAoCr6B,KAAK,CACvCjD,GAAIs3B,EACJnO,WAAY,CACVnnB,SAAWmmB,EAAMjf,QAAQouB,GAAiBt1B,YAK/CmmB,EAAMjf,QAAQouB,GAAiBt1B,cAAWD,EAE3Ck7B,EAAQ3F,GAAUjsB,oBAAU8c,EAAMjf,QAAQouB,QAMhDjoB,EAAmBtM,SAAQ,SAACu0B,GAC1B,QAAev1B,IAAXu1B,EAAsB,CACqC,IAAD,EAOrD,EAPP,QAAiDv1B,IAA5ComB,EAAMjf,QAAQouB,GAAiBt1B,SAClC,UAAAq7B,EAAoBC,sBAApB,SAAoCr6B,KAAK,CACvCjD,GAAIs3B,EACJnO,WAAY,CACVnnB,cAAUD,UAId,UAAAs7B,EAAoBC,sBAApB,SAAoCr6B,KAAK,CACvCjD,GAAIs3B,EACJnO,WAAY,CACVnnB,SAAWmmB,EAAMjf,QAAQouB,GAAiBt1B,YAI/CmmB,EAAMjf,QAAQouB,GAAiBt1B,SAAW8K,EAAO9M,GAElDi9B,EAAQ3F,GAAUjsB,oBAAU8c,EAAMjf,QAAQouB,QAI7CnP,EAAMjf,QAAQk0B,EAAcp9B,IAAekP,gBAAkB7D,oBAC5DgE,IAKN,GACEouB,EAASzX,SAAS6Y,IAClBpB,EAASzX,SAAS+Y,IAClBtB,EAASzX,SAASgZ,IAClBvB,EAASzX,SAASiZ,IAClBxB,EAASzX,SAAS4Y,GAClB,CACA,IAAM9xB,EAASqb,EAAMjf,QAAQk0B,EAAcp9B,IACrCu/B,GAAoD,IAA7BzyB,EAAM,cAC7BgzB,GAAwD,IAA/BhzB,EAAM,gBAC/BsC,EAAOtC,EAAOI,KAAOJ,EAAOG,QAClC,GAAIH,EAAOoC,gBAAgBpM,SAAWsM,EAOpC,YANArG,GACE,iDACAqG,EACAtC,EAAOoC,gBAAgBpM,OACvBgK,EAAOoC,iBAKX,GAAIqwB,EAAsB,CACxB,IAAIQ,EAAyB,CAAEtsB,MAAO,GAEtC3G,EAAOoC,gBAAgBnM,SAAQ,SAACu0B,EAAQlqB,GAKtC,IAAqB,IAFAD,GAAmBL,EAAQM,GAMhD,QAAerL,IAAXu1B,EAAsB,CAAC,IAAD,EACP,EAAK0I,iCACpBlzB,EACAM,GAFM/N,EADgB,EAChBA,EAAGC,EADa,EACbA,EAILU,EAAK,EAAKigC,oBACd7C,EACA2C,EAjBuB,GAoBnB1/B,EAAOG,EAAU,CACrBR,GAAIA,EACJsB,MAAO,MACPU,SAAU8K,EAAO9M,KAEnBK,EAAKQ,SAASxB,EAAIA,EAClBgB,EAAKQ,SAASvB,EAAIA,EAClB6oB,EAAMjf,QAAQ7I,EAAKL,IAAMK,EACxB8nB,EAAMjf,QAAQ4D,EAAO9M,IAAekP,gBAAgB9B,GACnD/M,EAAKL,GACPg9B,EAAM/5B,KAAKoI,oBAAUhL,IACrBg9B,EAAoBG,gBAAiBv6B,KAAKoI,oBAAUhL,QAC/C,CACL,IAAMA,EAAO8nB,EAAMjf,QAAQouB,GAC3B,QAAav1B,IAAT1B,EAAoB,CAAC,IAAD,EAChBq/B,EAAcr0B,oBAAUhL,EAAKQ,UADb,EAEL,EAAKm/B,iCACpBlzB,EACAM,GAFM/N,EAFc,EAEdA,EAAGC,EAFW,EAEXA,EAIX6oB,EAAMjf,QAAQouB,GAAQz2B,SAASxB,EAAIA,EACnC8oB,EAAMjf,QAAQouB,GAAQz2B,SAASvB,EAAIA,EACnC29B,EAAQ3F,GAAUjsB,oBAAU8c,EAAMjf,QAAQouB,IAC1C,UAAA+F,EAAoBC,sBAApB,SAAoCr6B,KAAK,CACvCjD,GAAIs3B,EACJnO,WAAY,CACVtoB,SAAU,CACRxB,EAAGqgC,EAAYrgC,EACfC,EAAGogC,EAAYpgC,EACfC,EAAGmgC,EAAYngC,gBAQvBugC,GACFhzB,EAAOoC,gBAAgBnM,SAAQ,SAACu0B,EAAQlqB,GAGtC,IAAqB,IAFAD,GAAmBL,EAAQM,GAMhD,QAAerL,IAAXu1B,EAAsB,CAAC,IAAD,EAClBj3B,EAAO8nB,EAAMjf,QAAQouB,GACrBoI,EAAcr0B,oBAAUhL,EAAKQ,UAFX,EAGP,EAAKm/B,iCACpBlzB,EACAM,GAFM/N,EAHgB,EAGhBA,EAAGC,EAHa,EAGbA,EAKX6oB,EAAMjf,QAAQouB,GAAQz2B,SAASxB,EAAIA,EACnC8oB,EAAMjf,QAAQouB,GAAQz2B,SAASvB,EAAIA,EAEnC29B,EAAQ3F,GAAUjsB,oBAAU8c,EAAMjf,QAAQouB,IAE1C,UAAA+F,EAAoBC,sBAApB,SAAoCr6B,KAAK,CACvCjD,GAAIs3B,EACJnO,WAAY,CACVtoB,SAAU,CACRxB,EAAGqgC,EAAYrgC,EACfC,EAAGogC,EAAYpgC,EACfC,EAAGmgC,EAAYngC,UAIhB,CACL,IAAMuN,EAASqb,EAAMjf,QAAQk0B,EAAcp9B,IAEvC2/B,GAAc,EAClBvpB,OAAO2Q,KAAKoB,EAAMjf,SAASnG,SAAQ,SAAC/C,GAAQ,IAAD,EACzC,IAAoB,IAAhB2/B,GAGAxX,EAAMjf,QAAQlJ,GAAI6B,aAAehD,EAAYsB,KAAjD,CAIA,IAAME,EAAO8nB,EAAMjf,QAAQlJ,GAE3B,QAAqB+B,IAAjB1B,EAAKyB,cAIaC,IAAlB1B,EAAK2B,WAK+C,IAAtD,EAAK49B,wBAAwB9yB,EAAQzM,EAAM+M,GAD7C,CAlByC,MAuBxB,EAAK4yB,iCACpBlzB,EACAM,GAFM/N,EAvBiC,EAuBjCA,EAAGC,EAvB8B,EAuB9BA,EAKV6oB,EAAMjf,QAAQk0B,EAAcp9B,IAAekP,gBAC1C9B,GACE/M,EAAKL,GAERmoB,EAAMjf,QAAQ7I,EAAKL,IAAagC,SAAW8K,EAAO9M,GAEnD,IAAM0/B,EAAcr0B,oBAAUhL,EAAKQ,UAEnCsnB,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASxB,EAAIA,EACpC8oB,EAAMjf,QAAQ7I,EAAKL,IAAIa,SAASvB,EAAIA,EAEpC,UAAA+9B,EAAoBC,sBAApB,SAAoCr6B,KAAK,CACvCjD,GAAIK,EAAKL,GACTmpB,WAAY,CACVtoB,SAAU,CACRxB,EAAGqgC,EAAYrgC,EACfC,EAAGogC,EAAYpgC,EACfC,EAAGmgC,EAAYngC,GAEjByC,cAAUD,KAIdk7B,EAAQ58B,EAAKL,IAAMqL,oBAAU8c,EAAMjf,QAAQ7I,EAAKL,KAChD2/B,GAAc,cA72B9B,iCAs3BE,SACEvC,EACA2C,EACAG,GACC,IAAD,EAQE,IAPElgC,OAAyB+B,EAErBw7B,EAAoBH,EAApBG,qBAGcx7B,IAApBw7B,QACsDx7B,KAAtD,UAAAw7B,EAAgBwC,EAAuBtsB,cAAvC,eAA+CzT,MAE/CA,EAAE,oBAAGu9B,EAAgBwC,EAAuBtsB,cAA1C,aAAG,EAA+CzT,UAAlD,aAAwD+B,EAC1Dg+B,EAAuBtsB,MAAQssB,EAAuBtsB,MAAQ,GAEhE,OAAOzT,IAt4BX,iDAy4BE,SACE8M,EACAyyB,EACAJ,EACAC,GAEA,IAAI/vB,EAA6C,GAC7CowB,EAA4B,GAEhC,GAAI3yB,EAAOO,QAAUzO,EAAY0O,UAAW,CAC1C,IAAM6yB,EAAUrzB,EAAOI,KACjBkzB,EAAatzB,EAAOG,QACpBM,EAAUT,EAAOI,KAAOJ,EAAOG,QAErCoC,EAAqBC,MAAM/B,GAASgC,UAAKxN,GACzC09B,EAAkB,GAElB,IAAK,IAAIvnB,EAAI,EAAGA,EAAIpL,EAAOoC,gBAAgBpM,OAAQoV,IAAK,CACtD,IAAMqmB,EAAWrmB,EACXmoB,EAAgB1yB,KAAKC,MAAMsK,EAAIknB,GAC/BkB,EAAgB3yB,KAAKC,MAAMsK,EAAIknB,GAEjCd,EAAmBgC,EAAgBD,EAAgBD,EACjDG,EAAmBpzB,GAAmBL,EAAQwxB,GAEpD,KACuB,IAArBiC,GACAD,GAAiBF,GACjBC,GAAiBF,KAEjB7B,EAAW/wB,EAEPgyB,GAAsB,CACxB,IAAMjI,EAASxqB,EAAOoC,gBAAgBqvB,QACvBx8B,IAAXu1B,IACuC,IAArCmI,EAAgBzZ,SAASsR,IAC3BmI,EAAgBx8B,KAAKq0B,GAMzBgH,EAAW/wB,IAAgC,IAArBgzB,IACxBlxB,EAAmBivB,GAAYxxB,EAAOoC,gBAAgBqvB,UAGrD,GAAIzxB,EAAOO,QAAUzO,EAAYkP,SAAU,CAChD,IAAMsyB,EAAatzB,EAAOG,QACpBM,EAAUT,EAAOI,KAAOJ,EAAOG,QAErCoC,EAAqBC,MAAM/B,GAASgC,UAAKxN,GACzC09B,EAAkB,GAElB,IAAK,IAAIvnB,EAAI,EAAGA,EAAIpL,EAAOoC,gBAAgBpM,OAAQoV,IAAK,CACtD,IAAMmoB,EAAgB1yB,KAAKC,MAAMsK,EAAIknB,GAE/BoB,EAAYpB,EAAa,EACzBqB,EAAYL,EAAa,EAMzBM,EARgB/yB,KAAKC,MAAMsK,EAAIknB,IAInCqB,EAAYD,EAAY,EACpB7yB,KAAKgzB,KAAKF,EAAYD,GACtB7yB,KAAKC,MAAM6yB,EAAYD,IAGvBI,EAASP,EACT/B,EAAWsC,EAASR,EAAaM,EACjCnC,EAAWrmB,EAQjB,IAA2B,KALzB/K,GAAmBL,EAAQwxB,IAC3BoC,GAAa,GACbA,EAAYN,GACZQ,EAAS9zB,EAAOI,OAGhB,GAAIqyB,EAAsB,CACxB,IAAMjI,EAASxqB,EAAOoC,gBAAgBqvB,QACvBx8B,IAAXu1B,IACuC,IAArCmI,EAAgBzZ,SAASsR,IAC3BmI,EAAgBx8B,KAAKq0B,cAKUv1B,IAAjCsN,EAAmBivB,GACrBjvB,EAAmBivB,GAAYxxB,EAAOoC,gBAAgBqvB,GAElDgB,IAGA,IADAE,EAAgBzZ,SAASlZ,EAAOoC,gBAAgBqvB,KAGhDkB,EAAgBx8B,KAAK6J,EAAOoC,gBAAgBqvB,UAOtDx1B,GAAa,2BAA4B+D,EAAOO,OAGlD,MAAO,CACLoyB,kBACApwB,wBAj/BN,iCAq/BE,SAAoBvC,EAAgBzM,GAClC,IAAMwgC,EAAiB/zB,EAAOjM,SAASxB,EAAIyN,EAAOtL,MAAQ,EACpDs/B,EAAiBh0B,EAAOjM,SAASvB,EAAIwN,EAAOvL,OAAS,EAoB3D,OAlBoB/B,EAClB,CACEH,EAAGwhC,EACHvhC,EAAGwhC,EACHvhC,EAAG,GAEL,CACEF,EAAGyN,EAAOjM,SAASxB,EAAIyN,EAAOtL,MAAQ,EACtClC,EAAGwN,EAAOjM,SAASvB,EAAIwN,EAAOvL,OAAS,EACvChC,EAAG,GAEL,CACEF,EAAGgB,EAAKQ,SAASxB,EACjBC,EAAGe,EAAKQ,SAASvB,EACjBC,EAAG,MAvgCX,qCA8gCE,SAAwBuN,EAAgBzM,EAAY0gC,GAClD,IAAMC,EAAarzB,KAAKC,MAAMmzB,EAAYj0B,EAAOG,SAC3Cg0B,EAAatzB,KAAKC,MAAMmzB,EAAYj0B,EAAOG,SAC3Ci0B,EAAQp0B,EAAOtL,MAAQsL,EAAOG,QAC9Bk0B,EAAQr0B,EAAOvL,OAASuL,EAAOI,KAC/B2zB,EAAiB/zB,EAAOjM,SAASxB,EAAIyN,EAAOtL,MAAQ,EACpDs/B,EAAiBh0B,EAAOjM,SAASvB,EAAIwN,EAAOvL,OAAS,EAGrD6/B,EADgBt0B,EAAOU,WAAa7O,EAAe8O,OACvBuzB,EAAa,IAAM,EAAI,EAAIE,EAAQ,EAAK,EAoB1E,OAlBoB1hC,EAClB,CACEH,EAAGwhC,EAAiBI,EAAaC,EAAQE,EACzC9hC,EAAGwhC,EAAiBE,EAAaG,EACjC5hC,EAAG,GAEL,CACEF,EAAGwhC,EAAiBI,EAAaC,EAAQA,EAAQE,EACjD9hC,EAAGwhC,EAAiBE,EAAaG,EAAQA,EACzC5hC,EAAG,GAEL,CACEF,EAAGgB,EAAKQ,SAASxB,EACjBC,EAAGe,EAAKQ,SAASvB,EACjBC,EAAG,MAviCX,8CA8iCE,SAAiCuN,EAAgBi0B,GAC/C,IAAMC,EAAarzB,KAAKC,MAAMmzB,EAAYj0B,EAAOG,SAC3Cg0B,EAAatzB,KAAKC,MAAMmzB,EAAYj0B,EAAOG,SACjD,OAAOpI,KAAK25B,oBAAoB1xB,EAAQk0B,EAAYC,KAjjCxD,iCAojCE,SAAoBn0B,EAAgBu0B,EAAkBC,GACpD,IAAMJ,EAAQp0B,EAAOtL,MAAQsL,EAAOG,QAC9Bk0B,EAAQr0B,EAAOvL,OAASuL,EAAOI,KAG/BwsB,EAAU4H,EAAcJ,GAFRp0B,EAAOU,WAAa7O,EAAe8O,OACvB4zB,EAAW,IAAM,EAAI,EAAIH,EAAQ,EAAK,GAElEK,EAAUF,EAAWF,EAU3B,MALwB,CACtB9hC,EALayN,EAAOjM,SAASxB,EAAIyN,EAAOtL,MAAQ,EAE5Bk4B,EAAUwH,EAAQ,EAItC5hC,EALawN,EAAOjM,SAASvB,EAAIwN,EAAOvL,OAAS,EAE7BggC,EAAUJ,EAAQ,EAItC5hC,EAAG,KAlkCT,gCAukCE,SAAmBF,EAAWC,EAAWwN,GACvC,IAAM+zB,EAAiB/zB,EAAOjM,SAASxB,EAAIyN,EAAOtL,MAAQ,EACpDs/B,EAAiBh0B,EAAOjM,SAASvB,EAAIwN,EAAOvL,OAAS,EACrD2/B,EAAQp0B,EAAOtL,MAAQsL,EAAOG,QAC9Bk0B,EAAQr0B,EAAOvL,OAASuL,EAAOI,KAC/Be,EAAMN,KAAKC,OAAOtO,EAAIwhC,GAAkBK,GAGxCK,EAAQniC,EAAIwhC,GAFI/zB,EAAOU,WAAa7O,EAAe8O,OACvBQ,EAAM,IAAM,EAAI,EAAIizB,EAAQ,EAAK,GAE7DlzB,EAASL,KAAKC,MAAM4zB,EAAQN,GAElC,MAAO,CAAE9zB,MADKY,EAAS,GAAK,EAAIC,EAAMnB,EAAOG,QAAUe,EACvCC,MAAKD,cAllCzB,GAAkDytB,ICnCrCgG,GAAb,6JACE,WAAO,IACGngB,EAAezc,KAAK7B,MAAM2b,QAA1B2C,WACJ9V,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClC/R,OAAO2Q,KAAKzF,GAAYve,SAAQ,SAAC2+B,GAC/BvZ,EAAMxe,GAAG+3B,GAAWr2B,oBAAUiW,EAAWogB,UAG7Cl2B,EAAW3G,KAAKi4B,8BAA8BtxB,GAC9CD,GAASC,GACTwW,GAAkBxW,OAVtB,GAA6C0vB,ICahCyG,GAA2B,SACtChT,GAEmBA,GClBRiT,GAAb,6JACE,WAAO,IAAD,OAEE14B,EAAUrE,KAAK+D,MAAMO,YAAYxC,KAAI,SAAC3G,GAC1C,OAAOqL,oBAAU,EAAKzC,MAAMM,QAAQlJ,OAEtC2hC,GAAyB,CACvBz4B,gBAPN,GAA0CgyB,ICO7B2G,GAAb,6JACE,WAAO,IAAD,OACE9f,EAAgB,GAChB7Y,EAAuB,GACvB44B,EAAgBj9B,KAAK+D,MAAMO,YAAYxC,KAAI,SAAC3G,GAEhD,OADA+hB,EAAI9e,KAAKjD,GACFqL,oBAAU,EAAKzC,MAAMM,QAAQlJ,OAEtC2hC,GAAyB,CACvBz4B,QAAS44B,IAEX,IAAIt2B,EAAW3G,KAAK63B,+BAA+B3a,EAAK7Y,GAExD,GAAIrE,KAAKs2B,cAAe,CACtB,IAAMkB,EAAoC,CACxCjP,GAAIvoB,KAAK7B,MACT8qB,KAAMjpB,KAAK7B,MACX2qB,KAAM,CACJptB,KAAMuG,EAAai7B,eACnBpjB,QAAS,CACPzV,QAAS44B,IAGbxU,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAEpB7wB,EAAW3G,KAAK03B,oBAAoB/wB,GACpCD,GAASC,GAET6qB,GACEntB,EAAQvC,KAAI,SAAC8F,GACX,MAAO,CAAEzM,GAAIyM,EAAIzM,GAAI6B,WAAY4K,EAAI5K,gBAGzCmgB,GAAkBxW,GAElB5I,EACEsG,EAAQvC,KAAI,SAAC4K,GACX,MAAO,CACLsQ,OAAQ/hB,EAAc68B,OACtBrP,WAAW,IAAI7qB,MAAOiC,cACtB6M,kBA1CV,GAAyCkqB,ICQ5BuG,GAAb,6JACE,WAAO,IAAD,OACEC,EAAS,GACT/4B,EAAuB,GAC7BrE,KAAK7B,MAAM2b,QAAQzV,QAAQnG,SAAQ,SAAC0J,GAClC,GAAKA,EAAIzM,GAAT,CAGA,IAAMkiC,EAAQz1B,EAAIzM,GACZgT,EAAQ3H,oBAAUoB,UAChBuG,EAAchT,GACtB,IAAIm8B,EAAY,EAAKC,+BAA+BppB,QACnCjR,GAAbo6B,IAGJ8F,EAAOC,GAAS/F,EAAUn8B,GAC1BkJ,EAAQjG,KAAKk5B,QAfX,MAiBqBt3B,KAAKs9B,iCAAiCj5B,GAAvDmf,EAjBJ,EAiBIA,MAAOC,EAjBX,EAiBWA,MACfzjB,KAAKu9B,kBAAkBl5B,EAASmf,EAAOC,GACvCpf,EAAQnG,SAAQ,SAACwO,GACf,GAAIA,EAAO1P,aAAehD,EAAY4I,MAAO,CAC3C,IAAM46B,EAA2B,GAChC9wB,EAAiBlF,YAAYtJ,SAAQ,SAAC/C,GACrCqiC,EAAep/B,KAAKg/B,EAAOjiC,OAE5BuR,EAAiBlF,YAAcg2B,OAEPtgC,IAAvBwP,EAAM,UACRA,EAAM,QAAe0wB,EAAO1wB,EAAM,aAGtC1M,KAAK+D,MAAMO,YAAYpG,SAAQ,SAAC/C,GAC9B,EAAK47B,yBAAyB,EAAKhzB,MAAMM,QAAQlJ,IAAK,MAExD,IAAIwL,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClCA,EAAMhf,YAAc,GACpBD,EAAQnG,SAAQ,SAACwO,GACf4W,EAAMjf,QAAQqI,EAAOvR,IAAMuR,EAC3B4W,EAAMhf,YAAYlG,KAAKsO,EAAOvR,UAOlC,GAJAkJ,EAAQnG,SAAQ,SAACwO,GACf0mB,GAAsB1mB,GACtB,EAAKqqB,yBAAyBrqB,GAAQ,MAEpC1M,KAAKs2B,cAAe,CACtB,IAAMkB,EAAsC,CAC1CjP,GAAIvoB,KAAK7B,MACT8qB,KAAMjpB,KAAK7B,MACX2qB,KAAM,CACJptB,KAAMuG,EAAagb,cACnBnD,QAAS,CACPoD,IAAK7Y,EAAQvC,KAAI,SAAC4K,GAChB,OAAOA,EAAOvR,QAIpBstB,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAEpB7wB,EAAW3G,KAAK03B,oBAAoB/wB,GACpCA,EAAW3G,KAAKi4B,8BAA8BtxB,GAC9CD,GAASC,GACTwW,GAAkBxW,GAElB5I,EACEsG,EAAQvC,KAAI,SAAC4K,GACX,MAAO,CACLsQ,OAAQ/hB,EAAc08B,OACtBlP,WAAW,IAAI7qB,MAAOiC,cACtB6M,kBAxEV,GAA2CkqB,ICP9B6G,GAAb,6JACE,WAAO,IAAD,OACEp5B,EAAuB,GAC7B,GAAkC,cAA9BrE,KAAK7B,MAAM2b,QAAQ4jB,OAAwB,CAC7C,IAAMC,EAAchiC,EAAU,IAE9BiiC,gBAAM59B,KAAK7B,MAAM2b,QAAQzR,MAAMnK,SAAQ,SAACkL,GACtCw0B,gBAAM,EAAKz/B,MAAM2b,QAAQ1R,SAASlK,SAAQ,SAAC2/B,GAAS,IAAD,IAC3CrjC,IAAK,UAACmjC,EAAYhhC,aAAb,QAAsB,GAHlB,GAGqCyM,EAC9C3O,IAAK,UAACkjC,EAAYjhC,cAAb,QAAuB,GAJnB,GAIsCmhC,GAAO,EACtDriC,EAAOG,EAAU,CACrBK,SAAU,CACRxB,IACAC,OAGJ4J,EAAQjG,KAAK5C,cAIjBgC,QAAQ2G,KAAK,qCAnBX,MAsBqBnE,KAAKs9B,iCAAiCj5B,GAAvDmf,EAtBJ,EAsBIA,MAAOC,EAtBX,EAsBWA,MACfzjB,KAAKu9B,kBAAkBl5B,EAASmf,EAAOC,GAEvC,IAAI9c,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClCjf,EAAQnG,SAAQ,SAACwO,GACf4W,EAAMjf,QAAQqI,EAAOvR,IAAMuR,EAC3B4W,EAAMhf,YAAYlG,KAAKsO,EAAOvR,UAYlC,GARA6E,KAAK+D,MAAMO,YAAYpG,SAAQ,SAAC/C,GAC9B,EAAK47B,yBAAyB,EAAKhzB,MAAMM,QAAQlJ,IAAK,MAExDkJ,EAAQnG,SAAQ,SAACwO,GACf0mB,GAAsB1mB,GACtB,EAAKqqB,yBAAyBrqB,GAAQ,MAGpC1M,KAAKs2B,cAAe,CACtB,IAAMkB,EAAwC,CAC5CjP,GAAIvoB,KAAK7B,MACT8qB,KAAM,CACJvtB,KAAMuG,EAAa4X,WACnBC,QAAS,CACPzV,QAASmC,oBAAUnC,KAGvBykB,KAAM,CACJptB,KAAMuG,EAAagb,cACnBnD,QAAS,CAAEoD,IAAK7Y,EAAQvC,KAAI,SAAC4K,GAAD,OAAYA,EAAOvR,QAEjDstB,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAEpB7wB,EAAW3G,KAAK03B,oBAAoB/wB,GAEpCA,EAAW3G,KAAKi4B,8BAA8BtxB,GAC9CD,GAASC,GACTwW,GAAkBxW,GAElB5I,EACEsG,EAAQvC,KAAI,SAAC4K,GACX,MAAO,CACLsQ,OAAQ/hB,EAAc08B,OACtBlP,WAAW,IAAI7qB,MAAOiC,cACtB6M,kBArEV,GAA6CkqB,ICLhCkH,GAAb,6JACE,WAAO,IACGzX,EAAarmB,KAAK7B,MAAM2b,QAAxBuM,SACF0X,EAAe/9B,KAAKy2B,oBAE1B,GAAiB,iBAAbpQ,EAA6B,CAAC,IAAD,EACSrmB,KAAK7B,MAAM2b,QAA7CyM,EADyB,EACzBA,YAAahO,EADY,EACZA,QAASC,EADG,EACHA,QACvBD,IACHA,EAAUwlB,EAAaxH,MAEpB/d,IACHA,EAAUulB,EAAavH,MAEpBjQ,IACHA,EAAc,GATe,MAWTzP,GAAS2B,GAAGC,wBAA1BC,EAXuB,EAWvBA,IACF2C,EAAU/C,EAZe,EAWlBK,KAEP2C,EAAU/C,EAAUG,EACpBqlB,EAAal1B,KAAKm1B,KAAK1X,GAC7BvmB,KAAKk+B,eAAe5iB,EAASC,EAASyiB,OAChB,uBAAb3X,EACTrmB,KAAKk+B,eAAeH,EAAaxH,KAAMwH,EAAavH,MAAO,GACrC,wBAAbnQ,GACTrmB,KAAKk+B,eAAeH,EAAaxH,KAAMwH,EAAavH,KAAM,KAxBhE,4BA4BE,SAAelb,EAAiBC,EAAiByiB,GAAqB,IAAD,EACzClnB,GAAS2B,GAAGC,wBAA9B/b,EAD2D,EAC3DA,MAAOD,EADoD,EACpDA,OACT8kB,EAAU1K,GAASgC,OAAO9c,SAASxB,EACnCinB,EAAU3K,GAASgC,OAAO9c,SAASvB,EAEnC0jC,GAAuB7iB,EAAU3e,EAAQ,GAAKqD,KAAK+D,MAAMe,GAAGY,UAC5D04B,GACH,GAAK7iB,EAAU7e,EAAS,GAAKsD,KAAK+D,MAAMe,GAAGY,UAExC24B,EAAar+B,KAAK+D,MAAMe,GAAGY,WAAa,IAAO,GAAW,IAG5D2b,EAAa,EACjBA,EAAarhB,KAAK+D,MAAMe,GAAGY,UAAYs4B,EAAaK,EAGpD,IAAMC,GAAsBhjB,EAAU3e,EAAQ,IAF9C0kB,EAAavY,KAAKS,IAAIT,KAAKW,IAHX,MAGwB4X,GAJxB,MAOVkd,GAAsB,GAAKhjB,EAAU7e,EAAS,GAAK2kB,EAEzDvK,GAASgC,OAAOF,KAAQjc,EAAQ0kB,GAAe,EAC/CvK,GAASgC,OAAO2H,MAAS9jB,EAAQ0kB,EAAc,EAC/CvK,GAASgC,OAAOH,IAAOjc,EAAS2kB,EAAc,EAC9CvK,GAASgC,OAAOiO,OAAUrqB,EAAS2kB,GAAe,EAClDvK,GAASgC,OAAOwH,yBAEhB,IAAMkD,EAAQ2a,EAAsBG,EAC9B7a,EAAQ2a,EAAsBG,EAEpCznB,GAASgC,OAAO9c,SAASxB,EAAIgnB,EAAUgC,EACvC1M,GAASgC,OAAO9c,SAASvB,EAAIgnB,EAAUgC,EACvC3M,GAASgC,OAAO4I,OACd5K,GAASgC,OAAO9c,SAASxB,EACzBsc,GAASgC,OAAO9c,SAASvB,EACzB,GAGF,IAAM6wB,EAA6B/D,KACnCzQ,GAASgC,OAAOM,SAAW,CAAEiI,aAAYiK,8BAEzC,IAAI3kB,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClCA,EAAMxe,GAAGY,UAAY2b,KAEvB1a,EAAW3G,KAAKi4B,8BAA8BtxB,GAC9CD,GAASC,GACTwW,GAAkBxW,GAElBmQ,GAASkC,MAAMC,SAAS/a,SAAQ,SAAC+mB,GACL,IAAtBA,EAAMC,OAAOC,OACfF,EAAMyI,MAAMlzB,EAAI6mB,EAChB4D,EAAMyI,MAAMjzB,EAAI4mB,EAChB4D,EAAMyI,MAAMhzB,EAAI2mB,UA9ExB,GAAiDgV,ICFpCmI,GAAb,6JACE,WAAO,IAAD,EAC4Bx+B,KAAK7B,MAAM2b,QAAnCtU,EADJ,EACIA,MAAOi5B,EADX,EACWA,KAAMC,EADjB,EACiBA,OACjB/3B,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClC,IAAIqb,EAAUF,EAEA,YAAVj5B,SAEWtI,IAAXwhC,IACW,IAAXA,GACgC,YAAhCpb,EAAMxe,GAAGW,aAAaD,QAEtBm5B,GAAWrb,EAAMxe,GAAGW,aAAaT,QAEnCse,EAAMxe,GAAGW,aAAaT,OAAS25B,EAC/Brb,EAAMxe,GAAGW,aAAaD,OAAoB,IAAZm5B,OAAoBzhC,EAAY,WAElD,YAAVsI,SAEWtI,IAAXwhC,IACW,IAAXA,GACgC,YAAhCpb,EAAMxe,GAAGW,aAAaD,QAEtBm5B,GAAWrb,EAAMxe,GAAGW,aAAaT,QAEnCse,EAAMxe,GAAGW,aAAaT,OAAS25B,EAC/Brb,EAAMxe,GAAGW,aAAaD,OAAoB,IAAZm5B,OAAoBzhC,EAAY,WAGlD,aAAVsI,SAEWtI,IAAXwhC,IACW,IAAXA,GAC+B,aAA/Bpb,EAAMxe,GAAGS,YAAYC,QAErBm5B,GAAWrb,EAAMxe,GAAGS,YAAYP,QAElCse,EAAMxe,GAAGS,YAAYP,OAAS25B,EAC9Brb,EAAMxe,GAAGS,YAAYC,OAAoB,IAAZm5B,OAAoBzhC,EAAY,eAGjEwJ,GAASC,GACTwW,GAAkBxW,OA1CtB,GAAoD0vB,ICWvCuI,GAAb,6JACE,WAAO,IAAD,EAC8B5+B,KAAK7B,MAAM2b,QAArC+kB,EADJ,EACIA,SAAUv6B,EADd,EACcA,YACZw6B,EAAuD,GACvDxG,EAA8D,GAEhE3xB,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClC,IAAIyE,OAA2B7qB,EAC3Bmf,OAA2Bnf,EAC3B8qB,OAA2B9qB,EAC3Bof,OAA2Bpf,EAoC/B,GAlCAoH,EAAYpG,SAAQ,SAACsmB,GACnB,QAA2BtnB,IAAvBomB,EAAMjf,QAAQmgB,GAAlB,CAIA,IAAMsH,EAAMxI,EAAMjf,QAAQmgB,GAAKxoB,SACrBsnB,EAAMjf,QAAQmgB,GAAK7nB,MACnB2mB,EAAMjf,QAAQmgB,GAAK9nB,aAEhBQ,IAATmf,GAEOyP,EAAItxB,EAAI6hB,KADjBA,EAAOyP,EAAItxB,SAKA0C,IAAT6qB,GAEO+D,EAAItxB,EAAIutB,KADjBA,EAAO+D,EAAItxB,SAKA0C,IAATof,GAEOwP,EAAIrxB,EAAI6hB,KADjBA,EAAOwP,EAAIrxB,SAKAyC,IAAT8qB,GAEO8D,EAAIrxB,EAAIutB,KADjBA,EAAO8D,EAAIrxB,QA1BX+C,QAAQ2G,KAAK,2BAA4BqgB,MAgCzCqa,IAAa38B,EAAe68B,OAC9B,QAAa7hC,IAATmf,EAAoB,CACtB,IAAM2J,EAAS3J,EACf/X,EAAYpG,SAAQ,SAAC/C,GACnB,IAAMq9B,EAAoC,CACxCr9B,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,YAG1Cs8B,EAAel6B,KAAKo6B,GACpBlV,EAAMjf,QAAQlJ,GAAIa,SAASxB,EAAIwrB,EAC/B8Y,EAAQ1gC,KAAK,CACXjD,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,sBAKzC,GAAI6iC,IAAa38B,EAAe88B,UACrC,QAAa9hC,IAATmf,QAA+Bnf,IAAT6qB,EAAoB,CAC5C,IAAM/B,EAAS3J,GAAQ0L,EAAO1L,GAAQ,EACtC/X,EAAYpG,SAAQ,SAAC/C,GACnB,IAAMq9B,EAAoC,CACxCr9B,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,YAG1Cs8B,EAAel6B,KAAKo6B,GACpBlV,EAAMjf,QAAQlJ,GAAIa,SAASxB,EAAIwrB,EAC/B8Y,EAAQ1gC,KAAK,CACXjD,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,sBAKzC,GAAI6iC,IAAa38B,EAAe+8B,OACrC,QAAa/hC,IAAT6qB,EAAoB,CACtB,IAAM/B,EAAS+B,EACfzjB,EAAYpG,SAAQ,SAAC/C,GACnB,IAAMq9B,EAAoC,CACxCr9B,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,YAG1Cs8B,EAAel6B,KAAKo6B,GACpBlV,EAAMjf,QAAQlJ,GAAIa,SAASxB,EAAIwrB,EAC/B8Y,EAAQ1gC,KAAK,CACXjD,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,sBAKzC,GAAI6iC,IAAa38B,EAAeg9B,OACrC,QAAahiC,IAATof,EAAoB,CACtB,IAAM0J,EAAS1J,EACfhY,EAAYpG,SAAQ,SAAC/C,GACnB,IAAMq9B,EAAoC,CACxCr9B,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,YAG1Cs8B,EAAel6B,KAAKo6B,GACpBlV,EAAMjf,QAAQlJ,GAAIa,SAASvB,EAAIurB,EAC/B8Y,EAAQ1gC,KAAK,CACXjD,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,sBAKzC,GAAI6iC,IAAa38B,EAAei9B,UACrC,QAAajiC,IAATof,QAA+Bpf,IAAT8qB,EAAoB,CAC5C,IAAMhC,EAAS1J,GAAQ0L,EAAO1L,GAAQ,EACtChY,EAAYpG,SAAQ,SAAC/C,GACnB,IAAMq9B,EAAoC,CACxCr9B,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,YAG1Cs8B,EAAel6B,KAAKo6B,GACpBlV,EAAMjf,QAAQlJ,GAAIa,SAASvB,EAAIurB,EAC/B8Y,EAAQ1gC,KAAK,CACXjD,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,sBAKzC,GAAI6iC,IAAa38B,EAAek9B,OACrC,QAAaliC,IAAT8qB,EAAoB,CACtB,IAAMhC,EAASgC,EACf1jB,EAAYpG,SAAQ,SAAC/C,GACnB,IAAMq9B,EAAoC,CACxCr9B,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,YAG1Cs8B,EAAel6B,KAAKo6B,GACpBlV,EAAMjf,QAAQlJ,GAAIa,SAASvB,EAAIurB,EAC/B8Y,EAAQ1gC,KAAK,CACXjD,GAAIA,EACJmpB,WAAY,CACVtoB,SAAUwK,oBAAU8c,EAAMjf,QAAQlJ,GAAIa,sBAM9CwB,QAAQC,MAAM,wBAAyBohC,MAI3C,GAAI7+B,KAAKs2B,cAAe,CACtB,IAAMkB,EAAsD,CAC1DjP,GAAIvoB,KAAK7B,MACT8qB,KAAMjpB,KAAK7B,MACX2qB,KAAM,CACJptB,KAAMuG,EAAasiB,sBACnBzK,QAAS,CAAEhb,QAASw5B,IAEtB7P,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAGpB7wB,EAAW3G,KAAK03B,oBAAoB/wB,GAGpCm4B,EAAQ5gC,SAAQ,SAACq6B,GACf,QAA2Cr7B,IAAvCyJ,EAAStC,QAAQk0B,EAAcp9B,IAAnC,CAIA,IAAMuR,EAAS/F,EAAStC,QAAQk0B,EAAcp9B,IAC9Co4B,GACEgF,EAAcp9B,GACduR,EAAO1P,WACP0P,EAAO1Q,SAASxB,EAChBkS,EAAO1Q,SAASvB,QARhB+C,QAAQ2G,KAAK,2BAA4Bo0B,EAAcp9B,OAY3DwL,EAAW3G,KAAKi4B,8BAA8BtxB,GAC9CD,GAASC,GACTwW,GAAkBxW,GAElB5I,EACE+gC,EAAQh9B,KAAI,SAACy2B,GACX,MAAO,CACLvb,OAAQ/hB,EAAck+B,OACtB1Q,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQ/F,EAAStC,QAAQk0B,EAAcp9B,aAlNjD,GAAmDy7B,ICKtCyI,GAAb,6JACE,WAAO,IAAD,OACEjC,EAAS,GACT/4B,EAAuB,GAC7BrE,KAAK7B,MAAM2b,QAAQzV,QAAQnG,SAAQ,SAAC0J,GAClC,GAAKA,EAAIzM,GAAT,CAGA,IAAMkiC,EAAQz1B,EAAIzM,GACZgT,EAAQ3H,oBAAUoB,UAChBuG,EAAchT,GACtB,IAAIm8B,EAAY,EAAKC,+BAA+BppB,QACnCjR,GAAbo6B,IAGJ8F,EAAOC,GAAS/F,EAAUn8B,GAC1BkJ,EAAQjG,KAAKk5B,QAfX,MAmBqBt3B,KAAKs9B,iCAAiCj5B,GAAvDmf,EAnBJ,EAmBIA,MAAOC,EAnBX,EAmBWA,MACfzjB,KAAKu9B,kBAAkBl5B,EAASmf,EAAOC,GAEvCpf,EAAQnG,SAAQ,SAACwO,GACf,GAAIA,EAAO1P,aAAehD,EAAY4I,MAAO,CAC3C,IAAM46B,EAA2B,GAChC9wB,EAAiBlF,YAAYtJ,SAAQ,SAAC/C,GACrCqiC,EAAep/B,KAAKg/B,EAAOjiC,OAE5BuR,EAAiBlF,YAAcg2B,OAEPtgC,IAAvBwP,EAAM,UACRA,EAAM,QAAe0wB,EAAO1wB,EAAM,aAGtC1M,KAAK+D,MAAMO,YAAYpG,SAAQ,SAAC/C,GAC9B,EAAK47B,yBAAyB,EAAKhzB,MAAMM,QAAQlJ,IAAK,MAExD,IAAIwL,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAClCA,EAAMhf,YAAc,GACpBD,EAAQnG,SAAQ,SAACwO,GACf4W,EAAMjf,QAAQqI,EAAOvR,IAAMuR,EAC3B4W,EAAMhf,YAAYlG,KAAKsO,EAAOvR,UAOlC,GAJAkJ,EAAQnG,SAAQ,SAACwO,GACf0mB,GAAsB1mB,GACtB,EAAKqqB,yBAAyBrqB,GAAQ,MAEpC1M,KAAKs2B,cAAe,CACtB,IAAMkB,EAAwC,CAC5CjP,GAAIvoB,KAAK7B,MACT8qB,KAAMjpB,KAAK7B,MACX2qB,KAAM,CACJptB,KAAMuG,EAAagb,cACnBnD,QAAS,CACPoD,IAAK7Y,EAAQvC,KAAI,SAAC4K,GAChB,OAAOA,EAAOvR,QAIpBstB,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAEpB7wB,EAAW3G,KAAK03B,oBAAoB/wB,GACpCA,EAAW3G,KAAKi4B,8BAA8BtxB,GAC9CD,GAASC,GACTwW,GAAkBxW,GAElB5I,EACEsG,EAAQvC,KAAI,SAAC4K,GACX,MAAO,CACLsQ,OAAQ/hB,EAAc08B,OACtBlP,WAAW,IAAI7qB,MAAOiC,cACtB6M,kBA3EV,GAA6CkqB,ICHhC0I,GAAb,6JACE,WAAO,IAAD,OACEC,EAAsB,GACtBC,EAAoC,GACpCC,EAAuB,GACvBpH,EAA8C,GAC9CF,EAAiB,GAEnBxxB,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAqClC,GAjCA,EAAKnlB,MAAM2b,QAAQzV,QAAQnG,SAAQ,SAACwhC,GAClC,QAAgCxiC,IAA5BomB,EAAMjf,QAAQq7B,EAAMvkC,IAAxB,CAIA,IAAMuR,EAAS4W,EAAMjf,QAAQq7B,EAAMvkC,IAC7Bke,EAAU3M,EAAO1P,aAAehD,EAAY4I,MAC5C0W,OACmBpc,IAAvBwP,EAAM,SAA8BA,EAAM,QAAazO,OAAS,EAC9Dob,GACoC,IAAlCkmB,EAAUpe,SAASzU,EAAOvR,MACF,EAC1BokC,EAAUnhC,KAAKsO,EAAOvR,KAEfme,GACqB,EAC9BkmB,EAAwBphC,KAAKsO,EAAOvR,IACpCskC,EAAWrhC,KAAKsO,EAAOvR,IAErBuR,EAAM,cACgCxP,IAAtComB,EAAMjf,QAAQqI,EAAM,WAE2B,IAA3C6yB,EAAUpe,SAASzU,EAAM,WACD,EAC1B6yB,EAAUnhC,KAAKsO,EAAM,YAIK,EAC9B8yB,EAAwBphC,KAAKsO,EAAOvR,UA3BpCqC,QAAQ2G,KAAK,4BAA6Bu7B,EAAMvkC,YAgCnB+B,IAA/B,EAAKiB,MAAM2b,QAAQue,SACnB,EAAKl6B,MAAM2b,QAAQue,QAAQp6B,OAAS,EAEpCqlB,EAAMhf,YAAc,GACpB,EAAKnG,MAAM2b,QAAQue,QAAQn6B,SAAQ,SAACoJ,GAClC,QAAcpK,IAAVoK,QAGapK,IAAboK,EAAMnM,GAAV,CAIA,IAAMmb,EAAO,IAAIxa,IAEjBwL,EAAME,YAAYtJ,SAAQ,SAAC/C,GACzB,IAAMyM,EAAM0b,EAAMjf,QAAQlJ,GAC1B,QAAY+B,IAAR0K,EAAJ,CAGA,IAAMlM,EAAOiP,GAA2B/C,EAAIzM,GAAIyM,EAAI5K,YACpD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAC5B,OACArpB,QAEawB,IAAXwP,GAGJ4J,EAAK6T,eAAezd,QAGtB,IAAMub,EAAI3R,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,EAC1B0tB,EAAI5R,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,EAC1BklC,EAAWp4B,GAAW,CAC1BpM,GAAImM,EAAMnM,GACVqM,YAAaF,EAAME,YACnBxL,SAAU,CACRxB,EAAG8b,EAAK/M,IAAI/O,EAAIytB,EAAI,EACpBxtB,EAAG6b,EAAK/M,IAAI9O,EAAIytB,EAAI,GAEtBvrB,MAAOsrB,EACPvrB,OAAQwrB,IAGV5E,EAAMjf,QAAQiD,EAAMnM,IAAMwkC,EAE1BxH,EAAM/5B,KAAKuhC,GACXrc,EAAMhf,YAAYlG,KAAKuhC,EAASxkC,SAEN+B,IAAtBoK,EAAME,aAA6BF,EAAME,YAAYvJ,OAAS,GAChEqJ,EAAME,YAAYtJ,SAAQ,SAAC/C,QACC+B,IAAtBomB,EAAMjf,QAAQlJ,IAIlBmoB,EAAMjf,QAAQlJ,GAAd,QAAgCwkC,EAASxkC,GACzCmoB,EAAMhf,YAAYlG,KAAKjD,IAJrBqC,QAAQ2G,KAAK,0DAQhB,CACLo7B,EAAUrhC,SAAQ,SAAC/C,QACS+B,IAAtBomB,EAAMjf,QAAQlJ,KAGlB,EAAK47B,yBAAyBzT,EAAMjf,QAAQlJ,IAAK,GACjDk9B,EAAQj6B,KAAKoI,oBAAU8c,EAAMjf,QAAQlJ,YAC9BmoB,EAAMjf,QAAQlJ,OAGvB,IAAMmb,EAAO,IAAIxa,IAEjB0jC,EAAwBthC,SAAQ,SAAC/C,GAC/B,IAAMyM,EAAM0b,EAAMjf,QAAQlJ,GACpBO,EAAOiP,GAA2B/C,EAAIzM,GAAIyM,EAAI5K,YACpD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAC5B,OACArpB,QAEawB,IAAXwP,GAGJ4J,EAAK6T,eAAezd,OAGtB,IAAIkzB,OAAiC1iC,OAEJA,IAA7B,EAAKiB,MAAM2b,QAAQqe,QACrByH,EAAa,EAAKzhC,MAAM2b,QAAQqe,MAAMh9B,IAGxC,IAAM8sB,EAAI3R,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,EAC1B0tB,EAAI5R,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,EAC1BklC,EAAWp4B,GAAW,CAC1BpM,GAAIykC,EACJ5jC,SAAU,CACRxB,EAAG8b,EAAK/M,IAAI/O,EAAIytB,EAAI,EACpBxtB,EAAG6b,EAAK/M,IAAI9O,EAAIytB,EAAI,GAEtBvrB,MAAOsrB,EACPvrB,OAAQwrB,EACR1gB,YAAag4B,IAEflc,EAAMjf,QAAQs7B,EAASxkC,IAAMwkC,EAC7BxH,EAAM/5B,KAAKuhC,GAEXH,EAAwBthC,SAAQ,SAAC/C,GAC/BmoB,EAAMjf,QAAQlJ,GAAd,QAAgCwkC,EAASxkC,MAG3CmoB,EAAMhf,YAAN,CAAqBq7B,EAASxkC,IAA9B,OAAqCqkC,OAIzC,GAAIx/B,KAAKs2B,cAAe,CAAC,IAAD,EAChBkB,EAAoC,CACxCjP,GAAIvoB,KAAK7B,MACT8qB,KAAM,CACJvtB,KAAMuG,EAAa49B,aACnB/lB,QAAS,CACPzV,QAASrE,KAAK7B,MAAM2b,QAAQzV,QAAQvC,KAAI,YAAa,IAAV3G,EAAS,EAATA,GACzC,OAAOqL,oBAAU,CAAErL,UAErBk9B,QAAO,UAAEr4B,KAAK7B,MAAM2b,QAAQue,eAArB,aAAE,EAA4Bv2B,KAAI,YAA0B,IAAvB3G,EAAsB,EAAtBA,GAAIqM,EAAkB,EAAlBA,YAC9C,OAAOhB,oBAAU,CAAErL,KAAIqM,mBAEzB2wB,MAAOA,EAAM,GACT,CACEh9B,GAAIg9B,EAAM,GAAGh9B,GACbqM,YAAa2wB,EAAM,GAAG3wB,kBAExBtK,IAGR4rB,KAAM,CACJptB,KAAMuG,EAAa69B,eACnBhmB,QAAS,CACPzV,QAASsC,EAASrC,YAAYxC,KAAI,SAAC3G,GACjC,OAAOqL,oBAAU,CAAErL,UAErBk9B,QAASA,EAAQv2B,KAAI,YAA0B,IAAvB3G,EAAsB,EAAtBA,GAAIqM,EAAkB,EAAlBA,YAC1B,OAAOhB,oBAAU,CAAErL,KAAIqM,qBAI7BihB,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAEpB7wB,EAAW3G,KAAK03B,oBAAoB/wB,GAEpC3G,KAAK7B,MAAM2b,QAAQzV,QAAQnG,SAAQ,SAACwO,GAClC,EAAKqqB,yBAAyBrqB,GAAe,MAG/C8kB,GACExxB,KAAK7B,MAAM2b,QAAQzV,QAAQvC,KAAI,YAAa,IAAV3G,EAAS,EAATA,GAChC,YAA+B+B,IAA3B,EAAK6G,MAAMM,QAAQlJ,GACd,CAAEA,KAAI6B,WAAY,IAEpB,CAAE7B,KAAI6B,WAAY,EAAK+G,MAAMM,QAAQlJ,GAAI6B,gBAIpDw0B,GACE6G,EAAQv2B,KAAI,YAAa,IAAV3G,EAAS,EAATA,GACb,YAA+B+B,IAA3B,EAAK6G,MAAMM,QAAQlJ,GACd,CAAEA,KAAI6B,WAAY,IAEpB,CAAE7B,KAAI6B,WAAY,EAAK+G,MAAMM,QAAQlJ,GAAI6B,gBAIpDwiC,EAAwBthC,SAAQ,SAAC/C,GAC/Bi4B,GAAsBzsB,EAAStC,QAAQlJ,OAGzCg9B,EAAMj6B,SAAQ,SAAC0J,GACbwrB,GAAsBzsB,EAAStC,QAAQuD,EAAIzM,QAG7CwL,EAASrC,YAAYpG,SAAQ,SAAC/C,GAC5B,EAAK47B,yBAAyBpwB,EAAStC,QAAQlJ,IAAK,MAGtD4C,EACEo6B,EAAMr2B,KAAI,YAAa,IAAV3G,EAAS,EAATA,GACX,MAAO,CACL6hB,OAAQ/hB,EAAc08B,OACtBlP,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQlG,oBAAUG,EAAStC,QAAQlJ,SAKzC4C,EACEyhC,EAAwB19B,KAAI,SAAC3G,GAC3B,MAAO,CACL6hB,OAAQ/hB,EAAck+B,OACtB1Q,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQlG,oBAAUG,EAAStC,QAAQlJ,SAKzC4C,EACEs6B,EAAQv2B,KAAI,YAAa,IAAV3G,EAAS,EAATA,GACb,MAAO,CACL6hB,OAAQ/hB,EAAc68B,OACtBrP,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQlG,oBAAU,EAAKzC,MAAMM,QAAQlJ,SAK3CwL,EAAW3G,KAAKi4B,8BAA8BtxB,GAC9CD,GAASC,GACTwW,GAAkBxW,OA5QtB,GAAyCiwB,ICA5BmJ,GAAb,6JACE,WAAO,IAAD,OACER,EAAsB,GACtBE,EAAuB,GACvBD,EAAoC,GACpCnH,EAAgD,GAChDF,EAAiB,GAEnBxxB,EAAW0c,mBAAQrjB,KAAK+D,OAAO,SAACuf,GAKlC,EAAKnlB,MAAM2b,QAAQzV,QAAQnG,SAAQ,SAACwhC,GAClC,QAAgCxiC,IAA5BomB,EAAMjf,QAAQq7B,EAAMvkC,IAAxB,CAIA,IAAMuR,EAAS4W,EAAMjf,QAAQq7B,EAAMvkC,IAC7Bke,EAAU3M,EAAO1P,aAAehD,EAAY4I,MAC5C0W,OACmBpc,IAAvBwP,EAAM,SAA8BA,EAAM,QAAazO,OAAS,EAC9Dob,GACoC,IAAlCkmB,EAAUpe,SAASzU,EAAOvR,MACF,EAC1BokC,EAAUnhC,KAAKsO,EAAOvR,KAEfme,GACqB,EAC9BkmB,EAAwBphC,KAAKsO,EAAOvR,IACpCskC,EAAWrhC,KAAKsO,EAAOvR,SAEE+B,IAAvBwP,EAAM,SACN4W,EAAMjf,QAAQqI,EAAM,WAE2B,IAA3C6yB,EAAUpe,SAASzU,EAAM,WACD,EAC1B6yB,EAAUnhC,KAAKsO,EAAM,YAIK,EAC9B8yB,EAAwBphC,KAAKsO,EAAOvR,UA3BpCqC,QAAQ2G,KAAK,4BAA6Bu7B,EAAMvkC,YAgCnB+B,IAA/B,EAAKiB,MAAM2b,QAAQue,SACnB,EAAKl6B,MAAM2b,QAAQue,QAAQp6B,OAAS,GAEpCqlB,EAAMhf,YAAc,GACpB,EAAKnG,MAAM2b,QAAQzV,QAAQnG,SAAQ,YAAa,IAAV/C,EAAS,EAATA,GACpC,QAA0B+B,IAAtBomB,EAAMjf,QAAQlJ,GAAlB,CAGA,GAAImoB,EAAMjf,QAAQlJ,GAAI6B,aAAehD,EAAY4I,MAAO,CACtD,EAAKm0B,yBAAyBzT,EAAMjf,QAAQlJ,IAAK,GACjD,IAAMqM,EAAe8b,EAAMjf,QAAQlJ,GAAcqM,YAMjD,OALAA,EAAYtJ,SAAQ,SAAC/C,GACnBmoB,EAAMjf,QAAQlJ,GAAd,aAAgC+B,KAElCm7B,EAAQj6B,KAAKoI,oBAAU,CAAEgB,cAAarM,oBAC/BmoB,EAAMjf,QAAQlJ,GAGvBmoB,EAAMjf,QAAQlJ,GAAd,aAAgC+B,MAElC,EAAKiB,MAAM2b,QAAQue,QAAQn6B,SAAQ,SAACoJ,GAClC,QAAcpK,IAAVoK,QAGapK,IAAboK,EAAMnM,GAAV,CAIA,IAAMmb,EAAO,IAAIxa,IAEjBwL,EAAME,YAAYtJ,SAAQ,SAAC/C,GACzB,IAAMyM,EAAM0b,EAAMjf,QAAQlJ,GAC1B,QAAY+B,IAAR0K,EAAJ,CAGA,IAAMlM,EAAOiP,GAA2B/C,EAAIzM,GAAIyM,EAAI5K,YACpD,QAAaE,IAATxB,EAAJ,CAGA,IAAMgR,EAASoK,GAASkC,MAAM+L,4BAC5B,OACArpB,QAEawB,IAAXwP,GAGJ4J,EAAK6T,eAAezd,QAGtB,IAAMub,EAAI3R,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,EAC1B0tB,EAAI5R,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,EAC1BklC,EAAWp4B,GAAW,CAC1BpM,GAAImM,EAAMnM,GACVqM,YAAaF,EAAME,YACnBxL,SAAU,CACRxB,EAAG8b,EAAK/M,IAAI/O,EAAIytB,EAAI,EACpBxtB,EAAG6b,EAAK/M,IAAI9O,EAAIytB,EAAI,GAEtBvrB,MAAOsrB,EACPvrB,OAAQwrB,IAGV5E,EAAMjf,QAAQiD,EAAMnM,IAAMwkC,EAC1BxH,EAAM/5B,KAAKuhC,GACXrc,EAAMhf,YAAYlG,KAAKuhC,EAASxkC,IAE5BmM,EAAME,aACRF,EAAME,YAAYtJ,SAAQ,SAAC/C,QACC+B,IAAtBomB,EAAMjf,QAAQlJ,KAGlBmoB,EAAMjf,QAAQlJ,GAAd,QAAgCwkC,EAASxkC,GACzCmoB,EAAMhf,YAAYlG,KAAKjD,YAK7BokC,EAAUrhC,SAAQ,SAAC/C,GACjB,QAA0B+B,IAAtBomB,EAAMjf,QAAQlJ,GAAlB,CAGA,EAAK47B,yBAAyBzT,EAAMjf,QAAQlJ,IAAK,GACjD,IAAMqM,EAAe8b,EAAMjf,QAAQlJ,GAAcqM,YACjDA,EAAYtJ,SAAQ,SAAC/C,GACnBmoB,EAAMjf,QAAQlJ,GAAd,aAAgC+B,KAElCm7B,EAAQj6B,KAAKoI,oBAAU,CAAErL,KAAIqM,wBACtB8b,EAAMjf,QAAQlJ,OAIzBmoB,EAAMhf,YAAN,UAAwBk7B,MAG1B,GAAIx/B,KAAKs2B,cAAe,CAAC,IAAD,EAChBkB,EAAsC,CAC1CjP,GAAIvoB,KAAK7B,MACT8qB,KAAM,CACJvtB,KAAMuG,EAAa69B,eACnBhmB,QAAS,CACPzV,QAASsC,EAASrC,YAAYxC,KAAI,SAAC3G,GACjC,OAAOqL,oBAAU,CAAErL,UAErBk9B,QAAO,UAAEr4B,KAAK7B,MAAM2b,QAAQue,eAArB,aAAE,EAA4Bv2B,KAAI,YAA0B,IAAvB3G,EAAsB,EAAtBA,GAAIqM,EAAkB,EAAlBA,YAC9C,OAAOhB,oBAAU,CAAErL,KAAIqM,qBAI7BshB,KAAM,CACJptB,KAAMuG,EAAa49B,aACnB/lB,QAAS,CACPzV,QAASrE,KAAK7B,MAAM2b,QAAQzV,QAC5Bg0B,QAASA,EAAQv2B,KAAI,YACnB,MAAO,CAAE3G,GADmC,EAAtBA,GACTqM,YAD+B,EAAlBA,kBAKhCihB,UAAWgP,OAAQ53B,eAErBG,KAAKa,QAAQzC,KAAKo5B,GAEpB7wB,EAAW3G,KAAK03B,oBAAoB/wB,GAEpC3G,KAAK7B,MAAM2b,QAAQzV,QAAQnG,SAAQ,SAACwO,GAClC,EAAKqqB,yBAAyBrqB,GAAe,MAG/C8kB,GACE6G,EAAQv2B,KAAI,YAAa,IAAV3G,EAAS,EAATA,GACb,YAA+B+B,IAA3B,EAAK6G,MAAMM,QAAQlJ,GACd,CAAEA,KAAI6B,WAAY,IAEpB,CAAE7B,KAAI6B,WAAY,EAAK+G,MAAMM,QAAQlJ,GAAI6B,gBAKpDw0B,GACExxB,KAAK7B,MAAM2b,QAAQzV,QAAQvC,KAAI,YAAa,IAAV3G,EAAS,EAATA,GAChC,YAA+B+B,IAA3B,EAAK6G,MAAMM,QAAQlJ,GACd,CAAEA,KAAI6B,WAAY,IAEpB,CAAE7B,KAAI6B,WAAY,EAAK+G,MAAMM,QAAQlJ,GAAI6B,gBAIpDm7B,EAAMj6B,SAAQ,SAAC0J,GACbwrB,GAAsBzsB,EAAStC,QAAQuD,EAAIzM,QAG7CqkC,EAAwBthC,SAAQ,SAAC/C,GAC/Bi4B,GAAsBzsB,EAAStC,QAAQlJ,OAGzCwL,EAASrC,YAAYpG,SAAQ,SAAC/C,GAC5B,EAAK47B,yBAAyBpwB,EAAStC,QAAQlJ,IAAK,MAGtD4C,EACEo6B,EAAMr2B,KAAI,YAAa,IAAV3G,EAAS,EAATA,GACX,MAAO,CACL6hB,OAAQ/hB,EAAc08B,OACtBlP,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQlG,oBAAUG,EAAStC,QAAQlJ,SAKzC4C,EACEyhC,EAAwB19B,KAAI,SAAC3G,GAC3B,MAAO,CACL6hB,OAAQ/hB,EAAck+B,OACtB1Q,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQlG,oBAAUG,EAAStC,QAAQlJ,SAKzC4C,EACEs6B,EAAQv2B,KAAI,YAAa,IAAV3G,EAAS,EAATA,GACb,MAAO,CACL6hB,OAAQ/hB,EAAc68B,OACtBrP,WAAW,IAAI7qB,MAAOiC,cACtB6M,OAAQlG,oBAAU,EAAKzC,MAAMM,QAAQlJ,SAK3CwL,EAAW3G,KAAKi4B,8BAA8BtxB,GAC9CD,GAASC,GACTwW,GAAkBxW,OA7OtB,GAA2CiwB,ICE9B7c,GAAY,SAAC5b,GAAqD,IAAD,EAAlCm4B,IAAkC,yDAC5EpyB,GACE,gBACA/F,EAAMzC,KACNyC,EAAM2b,QACN,gBACAwc,GAGF,IAAM0J,GAA0C,mBAC7C/9B,EAAa4X,WAAawd,IADmB,cAE7Cp1B,EAAagb,cAAgB2a,IAFgB,cAG7C31B,EAAaihB,oBAAsB6U,IAHU,cAI7C91B,EAAasiB,sBAAwB2T,IAJQ,cAK7Cj2B,EAAaua,iBAAmBogB,IALa,cAM7C36B,EAAasiB,sBAAwB2T,IANQ,cAO7Cj2B,EAAag+B,cAAgBlD,IAPgB,cAQ7C96B,EAAai+B,aAAelD,IARiB,cAS7C/6B,EAAai7B,eAAiBC,IATe,cAU7Cl7B,EAAak+B,iBAAmB1C,IAVa,cAW7Cx7B,EAAamkB,qBAAuB0X,IAXS,cAY7C77B,EAAam+B,wBAA0B5B,IAZM,cAa7Cv8B,EAAao+B,uBAAyBzB,IAbO,cAc7C38B,EAAaq+B,iBAAmBjB,IAda,cAe7Cp9B,EAAa49B,aAAeP,IAfiB,cAgB7Cr9B,EAAa69B,eAAiBC,IAhBe,GAmBhD,QAA+B7iC,IAA3B8iC,EAAW7hC,EAAMzC,MAAqB,CACxC,IAAMmF,EAAU+nB,KACV7kB,EAAQ0C,KACR9E,EAAYq+B,EAAW7hC,EAAMzC,MAC7B6kC,EAAU,IAAI5+B,EAClBxD,EACA4F,EACAlD,EACAy1B,GAEFiK,EAAQC,IAAI15B,KAAsBC,WAElCvJ,QAAQ2G,KAAK,kCAAmChG,GAsDlD,OAAOA,GC9EIsiC,GAIR,SAAC7kC,GACJ,OACE,cAAC8kC,GAAD,UACE,qBAAK/+B,UAAW,gBAAhB,SACG/F,EAAM+kC,QAAQ7+B,KAAI,SAACkb,EAAQzU,GAC1B,OAAIyU,IAAWtc,EAAasC,KAExB,cAAC,GAAD,CACExB,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,gBADjBr4B,GAIAyU,IAAWtc,EAAa6B,cAE/B,cAAC,GAAD,CACEf,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,gBADjBr4B,GAIAyU,IAAWtc,EAAayC,mBAG/B,cAAC,GAAD,CACE3B,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,cAAC,KAAD,CAAiBC,KAAMC,YAXtB34B,GAgBAyU,IAAWtc,EAAa0C,uBAG/B,cAAC,GAAD,CACE5B,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,cAAC,KAAD,CAAiBC,KAAME,YAXtB54B,GAgBAyU,IAAWtc,EAAagC,aAG/B,cAAC,GAAD,CACElB,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,cAAC,KAAD,CAAiBC,KAAMG,YAXtB74B,GAgBAyU,IAAWtc,EAAaiC,WAG/B,cAAC,GAAD,CACEnB,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,cAAC,KAAD,CAAiBC,KAAMI,YAXtB94B,GAgBAyU,IAAWtc,EAAa2C,iBAsBxB2Z,IAAWtc,EAAa+B,qBAnB/B,cAAC,GAAD,CACEjB,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,cAAC,KAAD,CAAiBC,KAAMK,YAXtB/4B,GAsCAyU,IAAWtc,EAAa8B,UAG/B,cAAC,GAAD,CACEhB,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,sBAAKr/B,UAAW,sBAAhB,UACE,cAAC,KAAD,CAAiBs/B,KAAMM,OAEvB,cAAC,KAAD,CAAiBN,KAAMO,KAAej3B,KAAM,eAd7ChC,GAoBAyU,IAAWtc,EAAa2B,aAG/B,cAAC,GAAD,CACEb,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,qBAAKr/B,UAAW,sBAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAMC,cAZxB34B,GAkBAyU,IAAWtc,EAAa0B,gBAG/B,cAAC,GAAD,CACEZ,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,qBAAKr/B,UAAW,sBAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAMQ,cAZxBl5B,GAkBAyU,IAAWtc,EAAaoC,KAE/B,cAAC,GAAD,CACEtB,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,gBADjBr4B,GAIAyU,IAAWtc,EAAaqC,OAE/B,cAAC,GAAD,CACEvB,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,gBADjBr4B,GAIAyU,IAAWtc,EAAa4B,iBAG/B,cAAC,GAAD,CACEd,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,qBAAKr/B,UAAW,sBAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAMS,cAZxBn5B,GAkBAyU,IAAWtc,EAAakC,MAE/B,cAAC,GAAD,CACEpB,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,gBADjBr4B,GAIAyU,IAAWtc,EAAamC,QAE/B,cAAC,GAAD,CACErB,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,gBADjBr4B,GAMP,cAAC,GAAD,CACE/G,QAAS5F,EAAM4F,QACfvF,KAAM+gB,EAEN4jB,eAAgBhlC,EAAMglC,eAJxB,SAME,qBAAKj/B,UAAW,mBAAhB,SACE,qBAEEk/B,WAAU7jB,EACV8jB,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,cAAC,KAAD,CAAiBC,KAAMU,YAXtBp5B,WAuBRm4B,GAAqB3+B,IAAOC,IAAV,ivFA8HlB4/B,GAIR,SAAChmC,GACJ,IAAMimC,EAAQ9gC,IAAM+gC,OAA8B,MAiBlD,OACE,qBACEngC,UAAS,mCACkBzE,IAAzBtB,EAAMglC,gBACNhlC,EAAMglC,iBAAmBhlC,EAAMK,KAC3B,SACA,IAEN8lC,IAAK,SAACrvB,GAAD,OAAQmvB,EAAMG,QAAUtvB,GAC7BlR,QAzBY,WACd,GAAIqgC,EAAMG,QAAS,CAAC,IAAD,EACiCH,EAAMG,QAAhDC,EADS,EACTA,WAAYC,EADH,EACGA,aAAcC,EADjB,EACiBA,YAC9BC,EAAkB,EAClBF,EACFE,EAAmBF,EAAgCD,WAEnDzkC,QAAQ2G,KAAK,gCAEf,IACMk+B,EAAkBD,EAAkBH,EADxBE,EAAc,EAEhCvmC,EAAM4F,QAAQ5F,EAAMK,KAAMomC,QAE1B7kC,QAAQ2G,KAAK,0BAIf,SAUGvI,EAAMqd,YAKAqpB,GAIR,SAAC1mC,GACJ,OACE,cAAC,GAAD,CACE4F,QAAS5F,EAAM4F,QACfvF,KAAML,EAAMK,KACZ2kC,eAAgBhlC,EAAMglC,eAHxB,SAKE,qBAAKj/B,UAAS,yBAAd,SACE,qBAEEk/B,WAAU,QACVC,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,cAAC,KAAD,CAAiBC,KAAMsB,cAOpBC,GAIR,SAAC5mC,GACJ,IAAM6mC,EAAmBC,aAAY,SAACxhC,GACpC,IAAM2L,EAAmB,GAUzB,OATA3L,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAK+F,EAAMmD,QAAQlJ,GAAnB,CAGA,IAAMsB,EAASyE,EAAMmD,QAAQlJ,GAAasB,OACX,IAA3BoQ,EAAOsU,SAAS1kB,IAClBoQ,EAAOzO,KAAK3B,OAGToQ,KAGT,OAAgC,IAA5B41B,EAAiBxkC,OACZ,cAAC,IAAM0kC,SAAP,IAIP,cAAC,GAAD,CACEnhC,QAAS5F,EAAM4F,QACfvF,KAAML,EAAMK,KACZ2kC,eAAgBhlC,EAAMglC,eAHxB,SAKE,qBAAKj/B,UAAW,yBAAhB,SACE,qBAEEk/B,WAAU,OACVC,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,qBACEr/B,UAAW,QACXqZ,MAAO,CACLE,WAAW,6BAAD,OACoB,IAA5BunB,EAAiBxkC,OACb,CAACwkC,EAAiB,GAAIA,EAAiB,IAAIG,OAC3CH,EAAiBhiC,MAAM,EAAG,IAAImiC,OAH1B,MAHd,yBAkBJC,GAID,SAACjnC,GAAW,IAAD,EAC8BmF,IAAMC,UAAS,GAD7C,mBACP8hC,EADO,KACSC,EADT,KAGRC,EAAY,WAChB,IAAMj/B,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAO9B,MAN6B,CAC3BA,KACAmpB,WAAY,CACVvnB,UAAU,SAOpBgd,GAAU5b,GACVvC,EAAM4F,aAAQtE,OAAWA,IAG3B6D,IAAMK,WAAU,WACd,IAAI6hC,EAOJ,OANIH,EACFG,EAAUC,WAAWF,EAxBd,KA0BPG,aAAaF,GAGR,WACLE,aAAaF,MAEd,CAACH,IAEJ,IAAM3oB,EAAQpZ,IAAMqiC,aAAY,WAC9BL,GAAkB,KACjB,IAEGM,EAAOtiC,IAAMqiC,aAAY,WAC7BL,GAAkB,KACjB,IAEH,OACE,sBACEO,YAAanpB,EACbopB,UAAWF,EACXG,aAAcH,EACdI,aAActpB,EACdupB,WAAYL,EACZ1hC,UAAS,6BAAwBmhC,EAAiB,SAAW,IAN/D,UAQE,qBACEnhC,UAAS,mBACTqZ,MAAO,CAAE2oB,mBAAmB,GAAD,OArDtB,IAqDsB,OAF7B,kBAMA,sBAAKhiC,UAAW,kBAAhB,UACE,qBAAKA,UAAW,eAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAM2C,SAEzB,qBAAKjiC,UAAW,gBAAhB,SACE,iEAOJkiC,GAID,SAACjoC,GAgCJ,OACE,cAAC,GAAD,CAAmB4F,QAhCL,WACd,IAAMuC,EAAQ0C,KACRq9B,EAA8B,CAClCpoC,KAAMuG,EAAaihB,oBACnBpJ,QAAS,CACPqJ,OAAQpf,EAAMO,YAAYxC,KAAI,SAAC3G,GAK7B,MAJoC,CAClCA,KACAioB,YAAY,QAMpBrJ,GAAU+pB,GACV,IAAM3lC,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAO9B,MAN6B,CAC3BA,KACAmpB,WAAY,CACVvnB,UAAU,SAOpBgd,GAAU5b,IAG2BlC,KAAMyE,EAAaoC,KAAxD,SACE,qBAAKnB,UAAW,mBAAhB,SACE,qBAEEk/B,WAAUngC,EAAaoC,KACvBg+B,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,qBAAKr/B,UAAW,sBAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAM8C,gBAQ7BC,GAID,SAACpoC,GAaJ,OACE,cAAC,GAAD,CAAmB4F,QAbL,WACd,IAAMuC,EAAQ0C,KACRq9B,EAAuB,CAC3BpoC,KAAMuG,EAAa49B,aACnB/lB,QAAS,CACPzV,QAASN,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAOqL,oBAAUzC,EAAMM,QAAQlJ,SAIrC4e,GAAU+pB,IAG2B7nC,KAAML,EAAMK,KAAjD,SACE,qBAAK0F,UAAW,mBAAhB,SACE,qBAEEk/B,WAAUjlC,EAAMK,KAChB6kC,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,qBAAKr/B,UAAW,sBAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAMgD,gBAQ7BC,GAID,SAACtoC,GAaJ,OACE,cAAC,GAAD,CAAmB4F,QAbL,WACd,IAAMuC,EAAQ0C,KACRq9B,EAAyB,CAC7BpoC,KAAMuG,EAAa69B,eACnBhmB,QAAS,CACPzV,QAASN,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAOqL,oBAAUzC,EAAMM,QAAQlJ,SAIrC4e,GAAU+pB,IAG2B7nC,KAAML,EAAMK,KAAjD,SACE,qBAAK0F,UAAW,mBAAhB,SACE,qBAEEk/B,WAAUjlC,EAAMK,KAChB6kC,aAAY,SACZC,YAAW,OACXC,cAAa,QALf,SAOE,qBAAKr/B,UAAW,sBAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAMkD,gB,sCCtxB7BC,GAAgC,oBAAZtpB,SACpBupB,GAAY,iCACZC,GAAuB,6CA8C7B,SAASC,GAAO73B,EAAQ83B,EAAMC,GAC5B,IAAItxB,EAASzG,EAAO83B,GACpB,GAAqB,mBAAVrxB,EAAsB,CAAC,IAAD,uBAFYuxB,EAEZ,iCAFYA,EAEZ,kBAC/BvxB,EAASA,EAAM,WAAN,EAAUuxB,GAErB,YAAkBxnC,IAAXiW,EAAuBsxB,EAAetxB,EAkDxC,IAAMwxB,GAAb,oDAuSE,WAAYD,GAAY,IAAD,+BACrB,cAAMA,IAtCRE,YAqCuB,IAzBvBC,YAyBuB,IAvBvBC,eAuBuB,IAtBvBC,wBAsBuB,IArBvBC,gBAqBuB,IApBvBC,iBAoBuB,IAlBvBC,iBAkBuB,IAjBvBC,eAiBuB,IAXvBjkC,WAWuB,EAGrB,EAAK4jC,YAAc,EAAKlpC,MAAMwpC,OAE9B,EAAKlkC,MAAL,cACEmkC,cAAc,EACdC,eAAe,EACfC,YAAY,EACZC,aAAa,EACbC,YAAa,IACV,EAAKC,cAAc,EAAK9pC,QAE7B,EAAKynC,KAAO,EAAKA,KAAKh1B,KAAV,iBACZ,EAAKq1B,WAAa,EAAKA,WAAWr1B,KAAhB,iBAClB,EAAK82B,UAAY,KACjB,EAAKD,YAAc,KAhBE,EAvSzB,kDA0TE,SAActpC,GACZ,IAAI+pC,EAAyB,GAiB7B,OAfI/pC,EAAMgqC,eAAe,UACvBD,EAAIF,YAAcI,OAChBjqC,EAAMgT,OAAyB,IAAhBhT,EAAMgT,MAAchT,EAAMgT,MAAQ,IACjD0E,OAEFqyB,EAAI/2B,MAA4B,KAApB+2B,EAAIF,YAAqBzlC,KAAK8lC,OAAOlqC,EAAMgT,OAAS,OACtD5O,KAAKglC,YAAcppC,EAAMgqC,eAAe,kBAClDD,EAAIF,YAAcI,OAChBjqC,EAAM6oC,cAAuC,IAAvB7oC,EAAM6oC,aAAqB7oC,EAAM6oC,aAAe,IACtEnxB,OAEFqyB,EAAI/2B,MACqB,KAAvBhT,EAAM6oC,aAAsBzkC,KAAK8lC,OAAOlqC,EAAM6oC,cAAgB,MAG3DkB,IA5UX,uCAwVE,SAA0B/pC,GAAiC,IAAD,OACxDoE,KAAK8kC,YAAclpC,EAAMwpC,OACzB,IAAIW,EAAY/lC,KAAK0lC,cAAc9pC,GAC/B2V,OAAO2Q,KAAK6jB,GAAW9nC,SACzB+B,KAAK+kC,oBAAqB,EAC1B/kC,KAAKgmC,SAASD,GAAW,WACvB,EAAKhB,oBAAqB,QA9VlC,iCAsWE,WACE/kC,KAAKimC,kBAvWT,gCA+WE,SACEC,EACAC,GACO,IAAD,EAMHnmC,KAAK+kC,oBACNoB,EAAUv3B,QAAU5O,KAAKkB,MAAM0N,OAC7Bw3B,MAAK,UAACpmC,KAAKkB,MAAM0N,aAAZ,QAAqBmR,OAAOsmB,MAA6B,OAArBrmC,KAAKkB,MAAM0N,OAEtD5O,KAAKsmC,qBACH,WACAtmC,KAAKkB,MAAM0N,MACX5O,KAAKmlC,UAAUv2B,MACf5O,KAAKmlC,WAMLnlC,KAAKilC,cACPjlC,KAAKmlC,UAAUoB,SAGXvmC,KAAKkB,MAAMslC,gBAAgD,IAA9BxmC,KAAKkB,MAAMslC,kBAC1CxmC,KAAKmlC,UAAUqB,eAAiBxmC,KAAKkB,MAAMslC,iBAIzCxmC,KAAKkB,MAAMulC,cAA4C,IAA5BzmC,KAAKkB,MAAMulC,gBACxCzmC,KAAKmlC,UAAUsB,aAAezmC,KAAKkB,MAAMulC,eAI7CzmC,KAAK0mC,kBApZT,kCA0ZE,WACE1mC,KAAKglC,YAAa,EAClBhlC,KAAKqjC,SA5ZT,+BAkaE,WAA2B,IAAD,OACxBrjC,KAAKglC,YAAa,EAClBhlC,KAAKmlC,UAAUwB,iBAAmB,kBAAM,EAAKzlC,MAAM0N,OAAS,GAE5D5O,KAAKmlC,UAAUyB,SAAW,SAACh4B,GACzB,EAAKo3B,SAAS,CACZp3B,MAAO,EAAKk3B,OAAOl3B,GACnB62B,YAAa72B,MAOd5O,KAAKilC,aACNb,IACAtpB,SAAS+rB,gBAAkB7mC,KAAKmlC,YAEhCnlC,KAAKilC,aAAc,EACnBjlC,KAAKmlC,UAAUoB,QACfvmC,KAAKsmC,qBAAqB,UAAW,CACnCQ,OAAQ9mC,KAAKmlC,UACblpC,KAAM,WAIV+D,KAAK0mC,kBA5bT,2BAmcE,WACE1mC,KAAKkB,MAAMslC,eAAiBxmC,KAAKmlC,UAAUqB,eAC3CxmC,KAAKkB,MAAMulC,aAAezmC,KAAKmlC,UAAUsB,eArc7C,2BA6cE,WACE,IAAIM,EACFC,EAAkB,GAEhBC,IAAuBjnC,KAAKmlC,UAAUuB,cAGtCQ,KACFlnC,KAAKpE,MAAMsrC,YAAuC,SAAzBlnC,KAAKpE,MAAMsrC,YAGtClnC,KAAKmlC,UAAU+B,WAAaA,GAK5BH,EAAQG,IAAeD,GAGrBD,EAAkB,IAKa,KAA3BhnC,KAAKmlC,UAAUgC,UACjBnnC,KAAKmlC,UAAUgC,QAAUnnC,KAAKpE,MAAMwrC,SAAW,KAAO,MAIpDH,IACFjnC,KAAKmlC,UAAUuB,iBACfK,EAAQ/mC,KAAKmlC,UAAUkC,SAASN,SAG9BC,EAAkBhnC,KAAKmlC,UAAUmC,oBAKjCP,GAASE,GAAsBjnC,KAAKpE,MAAM2rC,WACxCvnC,KAAKmlC,UAAUv2B,MAAM3Q,OAAS+B,KAAKpE,MAAM2rC,YAC3CP,EAAkB,2BAKxBA,EACEA,IACCD,EAAQ,GAAK/mC,KAAKmlC,UAAUmC,mBAAqB,iBAEpD,IAAIE,EAAoBxnC,KAAK6kC,SAAWmC,EACxChnC,KAAK6kC,OAASmC,EACVA,IA/lBR,SAAkBxsB,EAAS7Y,GACzB,GAAI6Y,EAAQwQ,UACV,OAAOxQ,EAAQwQ,UAAU/U,IAAItU,GAE1B6Y,EAAQ7Y,UAAU8lC,OAAO,IAAIC,OAAO,MAAQ/lC,EAAY,UAC3D6Y,EAAQ7Y,UAAY,IAAMA,GA2lBxBgmC,CAAS3nC,KAAKklC,YAAa,aACvBsC,GACFxnC,KAAKsmC,qBACH,YACAU,EACAhnC,KAAKkB,MAAM0N,MACX5O,KAAKmlC,UAAUv2B,UAxlBzB,SAAqB4L,EAAS7Y,GAC5B,GAAI6Y,EAAQ7Y,UAAW,CACrB,GAAI6Y,EAAQwQ,UACV,OAAOxQ,EAAQwQ,UAAU+C,OAAOpsB,GAGlC6Y,EAAQ7Y,UAAY6Y,EAAQ7Y,UAAUmR,QACpC,IAAI40B,OAAO,MAAQ/lC,EAAY,MAAO,KACtC,KAolBAimC,CAAY5nC,KAAKklC,YAAa,aAC1BsC,GACFxnC,KAAKsmC,qBACH,UACAtmC,KAAKkB,MAAM0N,MACX5O,KAAKmlC,UAAUv2B,UAjhBzB,uBA8hBE,SAAUpU,GACR,IAAIqtC,EAAIr0B,WAAWhZ,GAKnB,IAJI4rC,MAAMyB,IAAOxU,SAASwU,KACxBA,EAAI,GAGF7nC,KAAK8kC,UAAW,CAClB,IAAIgD,EAAYvD,GAAOvkC,KAAKpE,MAAO,YAAa,KAAMoE,MAClDoF,EAAI0D,KAAKi/B,IAAI,GAAkB,OAAdD,EAAqB,GAAKA,GAC3CE,GAAQzD,GACVvkC,KAAKpE,MACL,MACA+oC,EAAasD,aAAa1+B,IAC1BvJ,MAEEkoC,GAAQ3D,GACVvkC,KAAKpE,MACL,MACA+oC,EAAasD,aAAax+B,IAC1BzJ,MAEF6nC,EAAI/+B,KAAKS,IAAIT,KAAKW,IAAIo+B,EAAGG,GAAOE,GAChCL,EAAI/+B,KAAKq/B,MAAMN,EAAIziC,GAAKA,EAG1B,OAAOyiC,IAvjBX,oBAgkBE,SAAOrtC,GAEL,OADAA,EAAIqrC,OAAOrrC,GACoB,mBAApBwF,KAAKpE,MAAM6W,MACbe,WAAWxT,KAAKpE,MAAM6W,MAAMjY,IAE9BgZ,WAAWhZ,KArkBtB,qBA6kBE,SAAQqtC,GACN,IAAIO,EAAapoC,KAAKqoC,UAAUR,GAAGxe,WAC/Bye,EAAYvD,GAAOvkC,KAAKpE,MAAO,YAAa,KAAMoE,MAOtD,OANkB,OAAd8nC,IACFM,EAAKP,EAAErnC,QAAQsnC,IAGjBM,GAAM,GAEFpoC,KAAKpE,MAAM0sC,OACNtoC,KAAKpE,MAAM0sC,OAAOF,GAGpBA,IA1lBX,mBAimBE,SAAMP,EAAW38B,GACf,IAAI45B,EAAY9kC,KAAK8kC,UACrB9kC,KAAK8kC,WAAY,EAEjB,IAAIyD,GAAShE,GACXvkC,KAAKpE,MACL,OACA+oC,EAAasD,aAAaO,KAC1BxoC,KACA6nC,EAAI,EAAIlD,EAAa8D,aAAe9D,EAAa+D,gBAG/CN,EAAKpoC,KAAKqoC,WAAWroC,KAAKkB,MAAM0N,OAAS,GAAK25B,EAAQV,GAQ1D,OANI7nC,KAAKpE,MAAM+sC,OACbP,EAAKt/B,KAAKq/B,MAAMC,EAAKG,GAASA,GAGhCvoC,KAAK8kC,UAAYA,EAEbsD,IAAOpoC,KAAKkB,MAAM0N,QACpB5O,KAAKgmC,SAAS,CAAEp3B,MAAOw5B,EAAI3C,YAAa2C,EAAK,IAAMl9B,IAC5C,KAvnBb,wBAgoBE,WAAuC,IAAD,uBAAxBw5B,EAAwB,yBAAxBA,EAAwB,gBACpCA,EAAK,GAAGkE,UACR5oC,KAAKsmC,qBAAL,MAAAtmC,KAAA,CAA0B,aAA1B,OAA0C0kC,IAC1C,IAAIhyB,EAAIgyB,EAAK,GACb,IAAKhyB,EAAEm2B,qBACL,GA9uBa,KA8uBTn2B,EAAEo2B,QACJp2B,EAAEwT,iBACFlmB,KAAKuoC,MAAM71B,EAAEq2B,SAAWr2B,EAAEs2B,QAAU,GAAMt2B,EAAE0P,SAAW,GAAK,QACvD,GAhvBQ,KAgvBJ1P,EAAEo2B,QACXp2B,EAAEwT,iBACFlmB,KAAKuoC,MAAM71B,EAAEq2B,SAAWr2B,EAAEs2B,SAAW,GAAMt2B,EAAE0P,UAAY,IAAM,OAC1D,CACL,IAAIxT,EAAQ5O,KAAKmlC,UAAUv2B,MACzB3Q,EAAS2Q,EAAM3Q,OACC,IAAdyU,EAAEo2B,QAGF9oC,KAAKmlC,UAAUqB,gBAAkBxmC,KAAKmlC,UAAUsB,cAChDzmC,KAAKmlC,UAAUsB,aAAe,GAC9B73B,EAAM3Q,QAC4C,MAAlD2Q,EAAM2E,OAAOvT,KAAKmlC,UAAUsB,aAAe,KAE3C/zB,EAAEwT,iBACFlmB,KAAKmlC,UAAUqB,eAAiBxmC,KAAKmlC,UAAUsB,aAC7CzmC,KAAKmlC,UAAUsB,aAAe,GAEX,KAAd/zB,EAAEo2B,QAGT9oC,KAAKmlC,UAAUqB,gBAAkBxmC,KAAKmlC,UAAUsB,cAChDzmC,KAAKmlC,UAAUsB,aAAexoC,EAAS,GACvC2Q,EAAM3Q,QACwC,MAA9C2Q,EAAM2E,OAAOvT,KAAKmlC,UAAUsB,gBAE5B/zB,EAAEwT,iBACFlmB,KAAKmlC,UAAUqB,eAAiBxmC,KAAKmlC,UAAUsB,aAC7CzmC,KAAKmlC,UAAUsB,aAAe,GAEzB/zB,EAAEo2B,WAtqBrB,kBAgrBE,WACM9oC,KAAK4kC,QACPzB,aAAanjC,KAAK4kC,UAlrBxB,sBA8rBE,WAAkE,IAAD,WAAxDqE,EAAwD,wDAA3B/9B,EAA2B,uCAC/DlL,KAAKqjC,OACLrjC,KAAKuoC,MAAM,EAAGr9B,GACd,IAAIg9B,GAAQ3D,GAAOvkC,KAAKpE,MAAO,MAAO+oC,EAAasD,aAAax+B,IAAKzJ,OAEnEomC,MAAK,UAACpmC,KAAKkB,MAAM0N,aAAZ,QAAqBmR,OAAOsmB,QACjC,UAAErmC,KAAKkB,MAAM0N,aAAb,QAAsBmR,OAAOsmB,KAAO6B,KAEpCloC,KAAK4kC,OAAS1B,YACZ,WACE,EAAKgG,UAAS,KAEhBD,EAAatE,EAAawE,MAAQxE,EAAayE,UA1sBvD,sBAutBE,WAAkE,IAAD,WAAxDH,EAAwD,wDAA3B/9B,EAA2B,uCAC/DlL,KAAKqjC,OACLrjC,KAAKuoC,OAAO,EAAGr9B,GACf,IAAI88B,GAAQzD,GAAOvkC,KAAKpE,MAAO,MAAO+oC,EAAasD,aAAa1+B,IAAKvJ,OAEnEomC,MAAK,UAACpmC,KAAKkB,MAAM0N,aAAZ,QAAqBmR,OAAOsmB,QACjC,UAAErmC,KAAKkB,MAAM0N,aAAb,QAAsBmR,OAAOsmB,KAAO2B,KAEpChoC,KAAK4kC,OAAS1B,YACZ,WACE,EAAKmG,UAAS,KAEhBJ,EAAatE,EAAawE,MAAQxE,EAAayE,UAnuBvD,yBA6uBE,SAAYE,EAAoBp+B,GACnB,QAAPo+B,EACFtpC,KAAKqpC,UAAS,EAAOn+B,GACL,MAAPo+B,GACTtpC,KAAKkpC,UAAS,EAAOh+B,KAjvB3B,0BA2vBE,SAAao+B,EAAoB52B,GAC/BA,EAAEwT,iBACS,QAAPojB,EACFtpC,KAAKqpC,WACW,MAAPC,GACTtpC,KAAKkpC,aAhwBX,wBAowBE,SAAWx2B,GACTA,EAAEwT,iBACFlmB,KAAKqjC,SAtwBT,kCA+wBE,SAAqBkG,GACnB,GAAuC,mBAA5BvpC,KAAKpE,MAAM2tC,GAA6B,KAAC,IAAD,qBADP7E,EACO,iCADPA,EACO,mBACjD,EAAA1kC,KAAKpE,MAAM2tC,IAAcj4B,KAAzB,SAA8B,MAA9B,OAAuCozB,OAjxB7C,oBAyxBE,WAAU,IAAD,OACH9oC,EAAQoE,KAAKpE,MACbsF,EAAQlB,KAAKkB,MACbsoC,EAAW,GAHR,EA2BHxpC,KAAKpE,MAdP6tC,GAbK,EAOLjB,KAPK,EAQLj/B,IARK,EASLE,IATK,EAULq+B,UAVK,EAWLr1B,MAXK,EAYL61B,OAZK,EAaLmB,QAEAC,GAfK,EAcLf,KAdK,EAeLe,gBAGA1uB,GAlBK,EAgBLpM,MAhBK,EAiBL3S,KAjBK,EAkBL+e,OAKA2uB,GAvBK,EAmBLlF,aAnBK,EAoBLmF,UApBK,EAqBLC,QArBK,EAsBLzE,OAtBK,EAuBLuE,SAGGG,EA1BE,kLAgCP,IAAK,IAAItvC,KAHTmvC,EAAUA,IAAqB,IAAV3uB,EAGP2pB,EAAa3pB,MACzBwuB,EAAIhvC,GAAK+W,OAAOC,OACd,GACAmzB,EAAa3pB,MAAMxgB,GACnBwgB,GAAQA,EAAMxgB,IAAW,IAI7B,IAAIuvC,EACFnuC,EAAM+F,WAAa,mBAAmBiT,KAAKhZ,EAAM+F,WAErC,QAAV8nC,IACFA,EAASrF,IAAc,iBAAkBtpB,UAGtB,mBAAV2uB,IACTA,EAASA,EAAOn4B,KAAKtR,OAEvBypC,IAAWA,EAEX,IAAIO,EAAQ,CACVC,KAAM,CACJjvB,MAAO2uB,EAAU,KAAOH,EAAIS,KAC5BtoC,UAAW,sBACXogC,IAAK,SAACrvB,GACK,MAALA,QAAkBxV,GAALwV,IACf,EAAKwyB,YAAcxyB,IAGvB6wB,eAAWrmC,EACXsmC,kBAActmC,GAEhBgtC,MAAM,cACJnI,IAAK,SAACrvB,GACK,MAALA,QAAkBxV,GAALwV,IACf,EAAKyyB,UAAYzyB,IAGrBzW,KAAM,OACN+e,MAAO2uB,EACH,KACAp4B,OAAOC,OACL,GACAg4B,EAAIU,MACHH,EAAmD,GAAlCP,EAAI,4BACtBxpC,KAAKilC,YAAcuE,EAAI,eAAiB,KAE3CM,GAELK,MAAO,CACLC,kBAAcltC,EACdomC,iBAAapmC,EACbqmC,eAAWrmC,EACXsmC,kBAActmC,EACdumC,kBAAcvmC,EACdwmC,gBAAYxmC,EACZ8d,MAAO2uB,EACH,KACAp4B,OAAOC,OACL,GACAg4B,EAAIa,IACJb,EAAIW,MACJvuC,EAAM0uC,UAAY1uC,EAAM2uC,SACpBf,EAAI,gBACJtoC,EAAMskC,YACNgE,EAAI,cACJtoC,EAAMqkC,WACNiE,EAAI,aACJ,KAGZgB,QAAS,CACPJ,kBAAcltC,EACdomC,iBAAapmC,EACbqmC,eAAWrmC,EACXsmC,kBAActmC,EACdumC,kBAAcvmC,EACdwmC,gBAAYxmC,EACZ8d,MAAO2uB,EACH,KACAp4B,OAAOC,OACL,GACAg4B,EAAIa,IACJb,EAAIgB,QACJ5uC,EAAM0uC,UAAY1uC,EAAM2uC,SACpBf,EAAI,gBACJtoC,EAAMokC,cACNkE,EAAI,cACJtoC,EAAMmkC,aACNmE,EAAI,aACJ,MAKV/D,EAAcI,OAEhB3kC,EAAMukC,cAEHvkC,EAAM0N,OAAyB,IAAhB1N,EAAM0N,MAAc1N,EAAM0N,MAAQ,KAElD,IAGA67B,GAASzqC,KAAK8kC,YAAc9kC,KAAKilC,cAAgBjlC,KAAKglC,YAGtDyF,GAASnG,GAAqB1vB,KAAK6wB,IAK9BgF,GAAShF,IAAgBpB,GAAUzvB,KAAK6wB,GAJ9CuE,EAAME,MAAct7B,MAAQ62B,EAStBvkC,EAAM0N,OAAyB,IAAhB1N,EAAM0N,MAC3Bo7B,EAAME,MAAct7B,MAAQ5O,KAAK0qC,QAAQxpC,EAAM0N,OAK/Co7B,EAAME,MAAct7B,MAAQ,GAG3Bm7B,IAAmBJ,GACrBp4B,OAAOC,OAAOw4B,EAAMC,KAAKjvB,MAAOwuB,EAAI,wBAIlCC,IAAWE,IACbp4B,OAAOC,OAAOw4B,EAAME,MAAMlvB,MAAOwuB,EAAI,iBACrCj4B,OAAOC,OAAOw4B,EAAMG,MAAMnvB,MAAOwuB,EAAI,iBACrCj4B,OAAOC,OAAOw4B,EAAMQ,QAAQxvB,MAAOwuB,EAAI,oBAIpC5tC,EAAM0uC,UAAa1uC,EAAM2uC,UAuIvBZ,GAAW/tC,EAAM0uC,UACpB/4B,OAAOC,OAAOw4B,EAAME,MAAMlvB,MAAOwuB,EAAI,oBAvIvCj4B,OAAOC,OAAOw4B,EAAMC,KAAM,CACxB1G,UAAWvjC,KAAKqjC,KAChBG,aAAcxjC,KAAKqjC,OAGrB9xB,OAAOC,OAAOw4B,EAAMG,MAAO,CACzB1G,aAAczjC,KAAKyjC,aAAap1B,KAAKrO,KAAM,MAC3C0jC,WAAY1jC,KAAK0jC,WACjB0G,aAAc,WACZ,EAAKpE,SAAS,CACZT,YAAY,KAGhB/B,aAAc,WACZ,EAAKH,OACL,EAAK2C,SAAS,CACZT,YAAY,EACZC,aAAa,KAGjBjC,UAAW,WACT,EAAKyC,SAAS,CACZT,YAAY,EACZC,aAAa,KAGjBlC,YAAa,WAAc,IAAD,uBAAToB,EAAS,yBAATA,EAAS,gBACxBA,EAAK,GAAGxe,iBACRwe,EAAK,GAAGkE,UACR,EAAK3D,aAAc,EACnB,EAAKe,SACH,CACET,YAAY,EACZC,aAAa,IAEf,WACE,EAAKc,qBAAL,QAAI,CAAsB,WAAtB,OAAoC5B,IACxC,EAAKpB,YAAY,YAMzB/xB,OAAOC,OAAOw4B,EAAMQ,QAAS,CAC3B/G,aAAczjC,KAAKyjC,aAAap1B,KAAKrO,KAAM,QAC3C0jC,WAAY1jC,KAAK0jC,WACjB0G,aAAc,WACZ,EAAKpE,SAAS,CACZX,cAAc,KAGlB7B,aAAc,WACZ,EAAKH,OACL,EAAK2C,SAAS,CACZX,cAAc,EACdC,eAAe,KAGnB/B,UAAW,WACT,EAAKyC,SAAS,CACZX,cAAc,EACdC,eAAe,KAGnBhC,YAAa,WAAc,IAAD,uBAAToB,EAAS,yBAATA,EAAS,gBACxBA,EAAK,GAAGxe,iBACRwe,EAAK,GAAGkE,UACR,EAAK3D,aAAc,EACnB,EAAKe,SACH,CACEX,cAAc,EACdC,eAAe,IAEjB,WACE,EAAKgB,qBAAL,QAAI,CAAsB,WAAtB,OAAoC5B,IACxC,EAAKpB,YAAY,cAMzB/xB,OAAOC,OAAOw4B,EAAME,MAAO,CACzBS,SAAU,SAACj4B,GACT,IAAMk4B,EAAWl4B,EAAEo0B,OAAOl4B,MACtBi8B,EAAqB,EAAK/E,OAAO8E,GACjCxE,MAAMyE,KACRA,EAAM,MAER,EAAK7E,SAAS,CACZp3B,MAAO,EAAKk2B,UAAY,EAAKuD,UAAUwC,GAAOA,EAC9CpF,YAAamF,KAGjBE,UAAW9qC,KAAK+qC,WAAW18B,KAAKrO,MAChCgrC,QAAS,WACP,EAAK/E,gBADe,2BAATvB,EAAS,yBAATA,EAAS,gBAEpB,EAAK4B,qBAAL,QAAI,CAAsB,WAAtB,OAAoC5B,KAE1CuG,SAAU,WACR,EAAKhF,gBADgB,2BAATvB,EAAS,yBAATA,EAAS,gBAErB,EAAK4B,qBAAL,QAAI,CAAsB,YAAtB,OAAqC5B,KAE3CwG,QAAS,WAAc,IAAD,uBAATxG,EAAS,yBAATA,EAAS,gBACpBA,EAAK,GAAGkE,UACR,EAAK3D,aAAc,EACnB,IAAM4F,EAAM,EAAK/E,OAAOpB,EAAK,GAAGoC,OAAOl4B,OACvC,EAAKo3B,SACH,CACEp3B,MAAOi8B,EACPpF,YAAaoF,GAAe,IAARA,EAAYA,EAAM,GAAK,KAE7C,WACE,EAAKvE,qBAAL,QAAI,CAAsB,WAAtB,OAAoC5B,QAI9CyG,OAAQ,WAAc,IAAD,uBAATzG,EAAS,yBAATA,EAAS,gBACnB,IAAII,EAAY,EAAKA,UACrB,EAAKA,WAAY,EACjBJ,EAAK,GAAGkE,UACR,EAAK3D,aAAc,EACnB,IAAM4F,EAAM,EAAK/E,OAAOpB,EAAK,GAAGoC,OAAOl4B,OACvC,EAAKo3B,SACH,CACEp3B,MAAOi8B,IAET,WACE,EAAKvE,qBAAL,QAAI,CAAsB,UAAtB,OAAmC5B,IACvC,EAAKI,UAAYA,SAW3B,IAAMsG,EAAW1B,GAAkB,QAEnC,OAAID,EAEA,mDAAUO,EAAMC,MAAhB,cACE,cAACmB,EAAD,gBAAcpB,EAAME,QACpB,gDAAOF,EAAMG,OAAb,cACE,mBAAGnvB,MAAO2uB,EAAU,KAAOH,EAAI6B,QAC/B,mBAAGrwB,MAAO2uB,EAAU,KAAOH,EAAI8B,WAEjC,+CAAOtB,EAAMQ,SAAb,aACE,mBAAGxvB,MAAO2uB,EAAU,KAAOH,EAAI6B,eAOrC,mDAAUrB,EAAMC,MAAhB,cACE,cAACmB,EAAD,gBAAcpB,EAAME,QACpB,+CAAOF,EAAMG,OAAb,aACE,mBAAGnvB,MAAO2uB,EAAU,KAAOH,EAAI+B,aAEjC,+CAAOvB,EAAMQ,SAAb,aACE,mBAAGxvB,MAAO2uB,EAAU,KAAOH,EAAIgC,uBAvmCzC,GAAkCC,aAArB9G,GAsDJsD,aAAe,CACpBO,KAAM,EACNj/B,IAAKwW,OAAO2rB,mBAAqB,iBACjCjiC,IAAKsW,OAAO4rB,kBAAoB,iBAChC7D,UAAW,KACXr1B,MAAO,KACP61B,OAAQ,KACRmB,OAAQ,OACRrE,QAAQ,EACRsE,eAAgB,QAChB1uB,MAAO,IAhEE2pB,GAwEJ3pB,MAAQ,CAEbivB,KAAM,CACJjuC,SAAU,WACVypB,QAAS,gBAGX,sBAAuB,CACrBA,QAAS,SAIX8lB,QAAS,CACPvvC,SAAU,WACV2c,IAAK,MACLC,KAAM,MACNjc,MAAO,EACPD,OAAQ,EACRkvC,YAAa,sBACbC,YAAa,6CACbC,YAAa,QACbC,OAAQ,sBAIVP,UAAW,CACTxvC,SAAU,WACV2c,IAAK,MACLC,KAAM,MACNjc,MAAO,EACPD,OAAQ,EACRkvC,YAAa,sBACbC,YAAa,6CACbC,YAAa,QACbC,OAAQ,sBAIVT,KAAM,CACJtvC,SAAU,WACV2c,IAAK,MACLC,KAAM,MACNjc,MAAO,EACPD,OAAQ,GACRwe,WAAY,iBACZ6wB,OAAQ,iBAIVV,MAAO,CACLrvC,SAAU,WACV2c,IAAK,MACLC,KAAM,MACNjc,MAAO,GACPD,OAAQ,EACRwe,WAAY,iBACZ6wB,OAAQ,iBAIV1B,IAAK,CACHruC,SAAU,WACVykB,MAAO,EACP9jB,MAAO,SACPkvC,YAAa,iBACbC,YAAa,QACbE,UAAW,SACXC,OAAQ,UACRC,WAAY,WACZhxB,WAAY,iBACZixB,UACE,6EAIJhC,MAAO,CACLxxB,IAAK,EACLoO,OAAQ,MACRqlB,aAAc,cACdR,YAAa,iBAGf,eAAgB,CACdjvC,MAAO,QACPoqB,OAAQ,EACRolB,UAAW,OACXC,aAAc,EACdR,YAAa,GAGfpB,QAAS,CACP7xB,IAAK,MACLoO,OAAQ,EACRqlB,aAAc,cACdR,YAAa,iBAGf,iBAAkB,CAChBjvC,MAAO,QACPoqB,OAAQ,EACRnO,KAAM,EACND,IAAK,EACL8H,MAAO,OACP0rB,UAAW,OACXC,aAAc,EACdR,YAAa,GAGf,YAAa,CACX1wB,WAAY,kBAGd,aAAc,CACZA,WAAY,iBACZixB,UACE,2EAIJ,eAAgB,CACdjiC,QAAS,GACTiiC,UAAW,OACXF,OAAQ,eAIV/B,MAAO,CACLmC,aAAc,MACdC,UAAW,aACXC,SAAU,WAIZ,2BAA4B,CAC1BpxB,OAAQ,iBACRixB,aAAc,EACdI,YAAa,EACb/mB,QAAS,QACTgnB,iBAAkB,OAClBC,WAAY,UAGd,eAAgB,CACdF,YAAa,SACbH,aAAc,QACdL,UAAW,UAGb,cAAe,GAEf,iBAAkB,CAChBvvC,MAAO,qBACPkwC,WAAY,qCAhOLhI,GAwOJwE,MAAQ,GAxOJxE,GA8OJyE,MAAQ,IA9OJzE,GAmPJ8D,aAAe,KAnPX9D,GAwPJ+D,eAAiB,O,kFC/SpBkE,I,QAAaC,EADaC,KAAOD,yBACIC,OAE9BC,GAGR,SAACnxC,GACJ,IAAIoxC,EAAapxC,EAAMqmC,WAavB,OAXErmC,EAAMK,OAASyE,EAAaiC,YAC5B/G,EAAMK,OAASyE,EAAagC,eAE5BsqC,EAAapxC,EAAMqmC,WAAa,KAGhCrmC,EAAMK,OAASyE,EAAa2C,iBAC5BzH,EAAMK,OAASyE,EAAa+B,uBAE5BuqC,EAAapxC,EAAMqmC,WAAa,KAGhC,cAACgL,GAAD,UACE,sBACEtrC,UAAW,gBACXqZ,MAAO,CACLpC,KAAMo0B,GAHV,UAMGpxC,EAAMK,OAASyE,EAAa6B,cAC3B,qBAAKZ,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAasC,KAC3B,qBAAKrB,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAawC,gBAC3B,qBAAKvB,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAayC,mBAC3B,qBAAKxB,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAa0C,uBAC3B,qBAAKzB,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAagC,aAC3B,qBAAKf,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAaiC,WAC3B,qBAAKhB,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAa2C,gBAC3B,qBAAK1B,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAa+B,qBAC3B,qBAAKd,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAa8B,UAC3B,qBAAKb,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAa2B,aAC3B,qBAAKV,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAa0B,gBAC3B,qBAAKT,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAEH/F,EAAMK,OAASyE,EAAa4B,iBAC3B,qBAAKX,UAAW,wBAAhB,SACE,cAAC,GAAD,MAEA,KAIF/F,EAAMK,OAASyE,EAAasC,MAC5BpH,EAAMK,OAASyE,EAAayC,oBAC5BvH,EAAMK,OAASyE,EAAagC,cAC5B9G,EAAMK,OAASyE,EAAaiC,YAC5B/G,EAAMK,OAASyE,EAAa2C,iBAC5BzH,EAAMK,OAASyE,EAAa+B,sBAC5B7G,EAAMK,OAASyE,EAAa8B,WAC5B5G,EAAMK,OAASyE,EAAa0C,wBAC5BxH,EAAMK,OAASyE,EAAawC,iBAC5BtH,EAAMK,OAASyE,EAAa2B,cAC5BzG,EAAMK,OAASyE,EAAa0B,iBAC5BxG,EAAMK,OAASyE,EAAa4B,kBAC5B1G,EAAMK,OAASyE,EAAa6B,cAE5B,qBAAKZ,UAAW,wBAAhB,SACE,kDAAqB/F,EAAMK,UAE3B,WAMCgxC,GAAqBlrC,IAAOC,IAAV,0kCAmDzBkrC,GAAmC,SAACtxC,GACxC,IAAM0I,EAAco+B,aAAY,SAACxhC,GAC/B,OAAOA,EAAMoD,eAETm+B,EAAmBC,aAAY,SAACxhC,GACpC,IAAM2L,EAAmB,GAUzB,OATA3L,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAK+F,EAAMmD,QAAQlJ,GAAnB,CAGA,IAAMsB,EAASyE,EAAMmD,QAAQlJ,GAAasB,OACX,IAA3BoQ,EAAOsU,SAAS1kB,IAClBoQ,EAAOzO,KAAK3B,OAGToQ,KAoBT,OACE,8BACE,cAAC,KAAD,CACElQ,MAAO,IACPD,OAAQ,IACRywC,iBAtBgB,SAAC1wC,GACrB,IAAM0B,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASwF,EAAYxC,KAAI,SAAC3G,GAOxB,MAN6B,CAC3BA,KACAmpB,WAAY,CACV7nB,MAAOA,EAAM2wC,WAOvBrzB,GAAU5b,IAQN1B,MAAOgmC,EAAiBxkC,OAAS,OAAIf,EAAYulC,EAAiB,QAMpE4K,GAAkC,SAACzxC,GACvC,IAAM0I,EAAco+B,aAAY,SAACxhC,GAC/B,OAAOA,EAAMoD,eAETgpC,EAAQ5K,aAAY,SAACxhC,GACzB,IAAMosC,EAAkB,GAUxB,OATApsC,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAK+F,EAAMmD,QAAQlJ,GAAnB,CAGA,IAAMc,EAAQiF,EAAMmD,QAAQlJ,GAAac,MACZ,IAAzBqxC,EAAMnsB,SAASllB,IACjBqxC,EAAMlvC,KAAKnC,OAGRqxC,KAGHrC,EAAW,SAAChvC,GAChB,IAAMkC,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASwF,EAAYxC,KAAI,SAAC3G,GAOxB,MAN6B,CAC3BA,KACAmpB,WAAY,CACVroB,cAOV8d,GAAU5b,IAWZ,OACE,sBAAK6c,MAAO,CAAEyK,QAAS,QAAvB,UACE,qBACEjkB,QAZmB,WACvBypC,EAASrxC,EAAUud,cAYfxV,UAAS,2BACU,IAAjB2rC,EAAMrvC,QAAgBqvC,EAAM,KAAO1zC,EAAUud,YACzC,SACA,IALR,SAQE,cAAC,KAAD,CAAiB8pB,KAAMsM,SAEzB,qBACE/rC,QAnBiB,WACrBypC,EAASrxC,EAAUyd,cAmBf1V,UAAS,2BACU,IAAjB2rC,EAAMrvC,QAAgBqvC,EAAM,KAAO1zC,EAAUyd,YACzC,SACA,IALR,SAQE,cAAC,KAAD,CAAiB4pB,KAAMuM,SAEzB,qBACEhsC,QA1BmB,WACvBypC,EAASrxC,EAAUwd,UA0BfzV,UAAS,2BACU,IAAjB2rC,EAAMrvC,QAAgBqvC,EAAM,KAAO1zC,EAAUwd,QAAU,SAAW,IAHtE,SAME,cAAC,KAAD,CAAiB6pB,KAAMwM,aAMzBC,GAAqC,SAAC9xC,GAC1C,IAAM0I,EAAco+B,aAAY,SAACxhC,GAC/B,OAAOA,EAAMoD,eAETgpC,EAAQ5K,aAAY,SAACxhC,GACzB,IAAMosC,EAAkB,GAUxB,OATApsC,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAK+F,EAAMmD,QAAQlJ,GAAnB,CAGA,IAAMc,EAAQiF,EAAMmD,QAAQlJ,GAAac,MACZ,IAAzBqxC,EAAMnsB,SAASllB,IACjBqxC,EAAMlvC,KAAKnC,OAGRqxC,KAEHrC,EAAW,SAAChvC,GAChB,IAAMkC,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASwF,EAAYxC,KAAI,SAAC3G,GAOxB,MAN6B,CAC3BA,KACAmpB,WAAY,CACVroB,cAOV8d,GAAU5b,IA0BNwvC,EAAQhyC,EAAU,CAAEM,KAAMrC,EAAUud,cACpCy2B,EAAQjyC,EAAU,CAAEM,KAAMrC,EAAUyd,cACpCw2B,EAAQlyC,EAAU,CAAEM,KAAMrC,EAAUwd,UAE1C,OACE,sBAAK4D,MAAO,CAAEyK,QAAS,OAAQqoB,cAAe,UAA9C,UACE,sBAAK9yB,MAAO,CAAEyK,QAAS,QAAvB,UACE,qBACEjkB,QAhCiB,WACvBypC,EAASrxC,EAAUud,cAgCbxV,UAAS,2BACU,IAAjB2rC,EAAMrvC,QAAgBqvC,EAAM,KAAO1zC,EAAUud,YACzC,SACA,IALR,SAQE,qBAAK9H,IAAKiY,GAAoBymB,mBAAmBJ,EAAO,GAAI,QAE9D,qBACEnsC,QAvCe,WACrBypC,EAASrxC,EAAUyd,cAuCb1V,UAAS,2BACU,IAAjB2rC,EAAMrvC,QAAgBqvC,EAAM,KAAO1zC,EAAUyd,YACzC,SACA,IALR,SAQE,qBAAKhI,IAAKiY,GAAoBymB,mBAAmBH,EAAO,GAAI,QAE9D,qBACEpsC,QA9CiB,WACvBypC,EAASrxC,EAAUwd,UA8CbzV,UAAS,2BACU,IAAjB2rC,EAAMrvC,QAAgBqvC,EAAM,KAAO1zC,EAAUwd,QAAU,SAAW,IAHtE,SAME,qBAAK/H,IAAKiY,GAAoBymB,mBAAmBF,EAAO,GAAI,WAIhE,qBAAKrsC,QApDY,WACnB,IAAMuC,EAAQ0C,KACR1B,EAAsByB,oBAAUzC,EAAMe,GAAGC,qBAC/CA,EAAoBC,QAAS,EAC7BD,EAAoBE,cAAgB,iBACpC,IAAM9G,EAA0B,CAC9BzC,KAAMuG,EAAaua,iBACnB1C,QAAS,CACP2C,WAAY,CACV1X,yBAINgV,GAAU5b,IAuCoB6c,MAAO,CAAEixB,OAAQ,WAA7C,mCAQA+B,GAAsC,SAACpyC,GAC3C,IAAM0I,EAAco+B,aAAY,SAACxhC,GAC/B,OAAOA,EAAMoD,eAET2pC,EAAgBvL,aAAY,SAACxhC,GACjC,IAAMosC,EAAkB,GAUxB,OATApsC,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAK+F,EAAMmD,QAAQlJ,GAAnB,CAGA,IAAMc,EAAQiF,EAAMmD,QAAQlJ,GAAagB,UACZ,IAAzBmxC,EAAMnsB,SAASllB,IACjBqxC,EAAMlvC,KAAKnC,OAGRqxC,KAGHrC,EAAW,SAAC9uC,GAChB,IAAMgC,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASwF,EAAYxC,KAAI,SAAC3G,GAOxB,MAN6B,CAC3BA,KACAmpB,WAAY,CACVnoB,kBAOV4d,GAAU5b,IAQZ,OACE,sBACE6c,MAAO,CACLre,MAAO,IACP8oB,QAAS,OACTqoB,cAAe,SACfI,eAAgB,SAChBC,WAAY,UANhB,UASE,qBACE3sC,QAjBmB,WACvBypC,EAASpxC,EAAkBuC,MAiBvBuF,UAAS,2BACkB,IAAzBssC,EAAchwC,QACdgwC,EAAc,KAAOp0C,EAAkBuC,IACnC,SACA,IANR,iBAYA,qBACEoF,QA1BiB,WACrBypC,EAASpxC,EAAkBs7B,QA0BvBxzB,UAAS,2BACkB,IAAzBssC,EAAchwC,QACdgwC,EAAc,KAAOp0C,EAAkBs7B,MACnC,SACA,IANR,uBAgBAiZ,GAAwC,SAACxyC,GAC7C,IAAM0I,EAAco+B,aAAY,SAACxhC,GAC/B,OAAOA,EAAMoD,eAGT2mC,EAAW,SAACtiC,GAChB,IAAM5E,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASwF,EAAYxC,KAAI,SAAC3G,GACxB,IAAM8M,EAASlE,EAAMM,QAAQlJ,GACvBmpB,EAAyC,CAC7C3b,WACAH,MAAOP,EAAOO,MACdJ,QAASH,EAAOG,QAChBC,KAAMJ,EAAOI,MAIf,GACEM,IAAa7O,EAAe8O,QAC5BX,EAAOO,QAAUzO,EAAYkP,SAC7B,CACA,IAAMolC,EAAQtqC,EAAMM,QAAQlJ,GAAeiN,QAD3C,EAE0BF,GAA6BmmC,GAA/CjmC,EAFR,EAEQA,QAASC,EAFjB,EAEiBA,KACjBic,EAAU,QAAelc,EACzBkc,EAAU,KAAYjc,EAMxB,MAJ6B,CAC3BlN,KACAmpB,mBAMRvK,GAAU5b,IAQZ,OACE,sBAAKwD,UAAW,wBAAhB,UACE,qBAAKH,QARY,WACnBypC,EAASnxC,EAAekQ,aAOMrI,UAAW,mBAAvC,SACE,cAAC,KAAD,CAAiBs/B,KAAMqN,SAEzB,qBAAK9sC,QARc,WACrBypC,EAASnxC,EAAe8O,SAOQjH,UAAW,mBAAzC,SACE,cAAC,KAAD,CAAiBs/B,KAAMsN,aAMzBC,GAAqC,SAAC5yC,GAC1C,IAAM0I,EAAco+B,aAAY,SAACxhC,GAC/B,OAAOA,EAAMoD,eAGT2mC,EAAW,SAACziC,GAChB,IAAMzE,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASwF,EAAYxC,KAAI,SAAC3G,GACxB,IAAM8M,EAASlE,EAAMM,QAAQlJ,GAGvBmpB,EAAyC,CAC7C9b,MAAOA,EACPG,SAAUV,EAAOU,SACjBP,QAASH,EAAOG,QAChBC,KAAMJ,EAAOI,MAEf,GACEJ,EAAOU,WAAa7O,EAAe8O,QACnCJ,IAAUzO,EAAYkP,SACtB,CACA,IAAMolC,EAAQtqC,EAAMM,QAAQlJ,GAAeiN,QAD3C,EAE0BF,GAA6BmmC,GAA/CjmC,EAFR,EAEQA,QAASC,EAFjB,EAEiBA,KACjBic,EAAU,QAAelc,EACzBkc,EAAU,KAAYjc,EAMxB,MAJ6B,CAC3BlN,KACAmpB,mBAMRvK,GAAU5b,IAYZ,OACE,sBAAKwD,UAAW,wBAAhB,UACE,qBAAKH,QAZgB,WACvBypC,EAASlxC,EAAY0O,YAWa9G,UAAW,mBAA3C,SACE,cAAC,KAAD,CAAiBs/B,KAAMwM,SAKzB,qBAAKjsC,QAXgB,WACvBypC,EAASlxC,EAAYkP,WAUatH,UAAW,mBAA3C,SACE,cAAC,KAAD,CACEs/B,KAAMwN,KACNzzB,MAAO,CAAE0zB,UAAW,0BAOxBC,GAA4C,WAAO,IAAD,EAClBjM,aAAY,SAACxhC,GAC/C,IAAMkH,EAAoB,GACpBC,EAAiB,GACnBumC,GAAsB,EACtBC,GAA4B,EA2BhC,OA1BA3tC,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,QAA0B+B,IAAtBgE,EAAMmD,QAAQlJ,GAAlB,CAGA,GAAI+F,EAAMmD,QAAQlJ,GAAI6B,aAAehD,EAAYiJ,OAG/C,OAFA2rC,GAAa,OACbC,GAAmB,GAGhB3tC,EAAMmD,QAAQlJ,GAAewN,WAAa7O,EAAe8O,SAC5DgmC,GAAa,GAGV1tC,EAAMmD,QAAQlJ,GAAeqN,QAAUzO,EAAYkP,WACtD4lC,GAAmB,GAGrB,IAAMC,EAAY5tC,EAAMmD,QAAQlJ,GAAeiN,QACzC2mC,EAAS7tC,EAAMmD,QAAQlJ,GAAekN,MACT,IAA/BD,EAAQ+Y,SAAS2tB,IACnB1mC,EAAQhK,KAAK0wC,IAEc,IAAzBzmC,EAAK8Y,SAAS4tB,IAChB1mC,EAAKjK,KAAK2wC,OAGP,CACL3mC,UACAC,OACA2mC,YAC8B,IAA3BJ,IACiC,IAAjCC,OApCCzmC,EAD8C,EAC9CA,QAASC,EADqC,EACrCA,KAAM2mC,EAD+B,EAC/BA,SAgHvB,OACE,sBAAKrtC,UAAW,uBAAhB,UACE,qBAAKA,UAAW,+BAAhB,SACE,cAAC,GAAD,CACE8iC,aAAcr8B,EAAQnK,OAAS,OAAIf,EAAYkL,EAAQ,GACvDqB,IAAK,GACLF,IAAK,EACLi/B,KAAM,EACNyG,aAAa,EAEbC,MAAO,YACPvE,SAnDgB,SAAC/Z,GACvB,QAAe1zB,IAAX0zB,EAAJ,CAGA,IAAM7sB,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,IAAK4I,EAAMM,QAAQlJ,GACjB,MAAO,CACLA,KACAmpB,WAAY,IAGhB,IAAMrc,EAASlE,EAAMM,QAAQlJ,GACvBmpB,EAAyC,CAC7Clc,QAASwoB,EACTvoB,KAAMJ,EAAOI,KACbG,MAAOP,EAAOO,MACdG,SAAUV,EAAOU,UAEnB,IAAiB,IAAbqmC,EAAoB,CACtB,IADsB,EAGI9mC,GAA6B0oB,GAA/CxoB,EAHc,EAGdA,QAASC,EAHK,EAGLA,KACjBic,EAAU,QAAelc,EACzBkc,EAAU,KAAYjc,EAMxB,MAJ6B,CAC3BlN,KACAmpB,mBAMRvK,GAAU5b,SAiBP6wC,EACC,qBAAKrtC,UAAW,4BAAhB,SACE,cAAC,GAAD,CACE8H,IAAK,GACLF,IAAK,EACLi/B,KAAM,EACN/D,aAAcp8B,EAAKpK,OAAS,OAAIf,EAAYmL,EAAK,GACjD4mC,aAAa,EAEbC,MAAO,SACPvE,SA/FW,SAAC/Z,GACpB,QAAe1zB,IAAX0zB,EAAJ,CAGA,IAAM7sB,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,IAAK4I,EAAMM,QAAQlJ,GACjB,MAAO,CACLA,KACAmpB,WAAY,IAGhB,IAAMrc,EAASlE,EAAMM,QAAQlJ,GAU7B,MAT6B,CAC3BA,KACAmpB,WAAY,CACV9b,MAAOP,EAAOO,MACdG,SAAUV,EAAOU,SACjBP,QAASH,EAAOG,QAChBC,KAAMuoB,SAOhB7W,GAAU5b,SAqEJ,SAKJgxC,GAQD,SAACvzC,GAiBJ,OACE,8BACE,qBAAK+F,UAAW,mBAAhB,SACE,qCACE,gCAAQ/F,EAAMszC,QACd,cAAC,GAAD,CACE3lC,IAAK3N,EAAM2N,IACXE,IAAK7N,EAAM6N,IACX++B,KAAM5sC,EAAM4sC,KACZ7mC,UAAW,gBACXiN,MAAOhT,EAAM6oC,aACbW,QAAQ,EACRuF,SAAU/uC,EAAM+uC,SAChBlB,QAAQ,EACRnB,OAAQ1sC,EAAMqzC,YA9BxB,SAAiBpH,GACf,IAAIuH,GAAW,EAEXvH,EAAI,IACNuH,GAAW,EACXvH,IAAS,GAEX,IAAIwH,EAAgBvmC,KAAKi/B,IAAI,GALhB,GAWb,OALAF,EAAIr0B,YAAYq0B,EAAIwH,GAAe7uC,QAAQ,KAC3CqnC,GAAK/+B,KAAKq/B,MAAMN,GAAKwH,GAAe7uC,QAPvB,GAQT4uC,IACFvH,IAAU,EAALA,GAAQrnC,QATF,IAWNqnC,QAiBuC3qC,YAS5CoyC,GAAkC,SAAC1zC,GAAW,IAAD,EAC7B8mC,aAAY,SAACxhC,GAC/B,IAAMquC,EAAqB,GACrBC,EAAqB,GACrBC,EAAqB,GAkB3B,OAjBAvuC,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAK+F,EAAMmD,QAAQlJ,GAAnB,CAGA,IAAMu0C,EAAKxuC,EAAMmD,QAAQlJ,GAAIa,SAASxB,EAChCm1C,EAAKzuC,EAAMmD,QAAQlJ,GAAIa,SAASvB,EAChCm1C,EAAK1uC,EAAMmD,QAAQlJ,GAAIa,SAAStB,GACR,IAA1B60C,EAASpuB,SAASuuB,IACpBH,EAASnxC,KAAKsxC,IAEc,IAA1BF,EAASruB,SAASwuB,IACpBH,EAASpxC,KAAKuxC,IAEc,IAA1BF,EAAStuB,SAASyuB,IACpBH,EAASrxC,KAAKwxC,OAGX,CACLp1C,EAAG+0C,EACH90C,EAAG+0C,EACH90C,EAAG+0C,MAxBCj1C,EADyC,EACzCA,EAAGC,EADsC,EACtCA,EA4BLo1C,GA7B2C,EACnCn1C,EA4BI,SAACo1C,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,IAAK4I,EAAMM,QAAQlJ,GACjB,MAAO,CACLA,KACAmpB,WAAY,IAGhB,IAAM5X,EAAS3I,EAAMM,QAAQlJ,GAW7B,MAV6B,CAC3BA,KACAmpB,WAAY,CACVtoB,SAAU,CACRxB,EAAGs1C,EACHr1C,EAAGiS,EAAO1Q,SAASvB,EACnBC,EAAGgS,EAAO1Q,SAAStB,UAQ/Bqf,GAAU5b,MAEN4xC,EAAY,SAACD,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,IAAK4I,EAAMM,QAAQlJ,GACjB,MAAO,CACLA,KACAmpB,WAAY,IAGhB,IAAM5X,EAAS3I,EAAMM,QAAQlJ,GAW7B,MAV6B,CAC3BA,KACAmpB,WAAY,CACVtoB,SAAU,CACRxB,EAAGkS,EAAO1Q,SAASxB,EACnBC,EAAGq1C,EACHp1C,EAAGgS,EAAO1Q,SAAStB,UAQ/Bqf,GAAU5b,KAkCZ,OACE,gCACE,8CACA,uBACA,cAAC,GAAD,CACEsmC,aAAcjqC,EAAEyD,OAAS,OAAIf,EAAY1C,EAAE,GAC3C+O,KAAM,IACNE,IAAK,IACLwlC,aAAa,EACbzG,KAAM,GAEN0G,MAAO,MACPvE,SAAUkF,IAEZ,cAAC,GAAD,CACEjhC,MAAOpU,EAAEyD,OAAS,EAAI,EAAIzD,EAAE,GAC5BmwC,SAAUkF,EACVtmC,KAAM,IACNE,IAAK,MAEP,cAAC,GAAD,CACEg7B,aAAchqC,EAAEwD,OAAS,OAAIf,EAAYzC,EAAE,GAC3C8O,KAAM,IACNE,IAAK,IACLwlC,aAAa,EACbzG,KAAM,GAEN0G,MAAO,MACPvE,SAAUoF,IAEZ,cAAC,GAAD,CACEnhC,MAAOnU,EAAEwD,OAAS,EAAI,EAAIxD,EAAE,GAC5BkwC,SAAUoF,EACVxmC,KAAM,IACNE,IAAK,UAkBPumC,GAKD,SAACp0C,GAAW,IAAD,EACYmF,IAAMC,SAAiBpF,EAAMgT,OADzC,mBACPA,EADO,KACAg4B,EADA,KAEd,OACE,qBAAK5rB,MAAO,CAAEi1B,aAAc,EAAGC,UAAW,GAA1C,SACE,cAACtD,GAAD,CACEpE,KAAM,EACNj/B,IAAK3N,EAAM2N,IACXE,IAAK7N,EAAM6N,IACXmF,MAAOA,EACP+7B,SAAU,SAAC/7B,GACTg4B,EAASh4B,IAEXuhC,cAAe,SAACvhC,GACdhT,EAAM+uC,SAAS/7B,SAOnBwhC,GAAgC,SAACx0C,GAAW,IAAD,EAC3B8mC,aAAY,SAACxhC,GAC/B,IAAMquC,EAAqB,GACrBC,EAAqB,GACrBC,EAAqB,GAkB3B,OAjBAvuC,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAK+F,EAAMmD,QAAQlJ,GAAnB,CAGA,IAAMu0C,EAAKxuC,EAAMmD,QAAQlJ,GAAIkB,QACvBszC,EAAKzuC,EAAMmD,QAAQlJ,GAAImB,QACvBszC,EAAK1uC,EAAMmD,QAAQlJ,GAAIoB,SACC,IAA1BgzC,EAASpuB,SAASuuB,IACpBH,EAASnxC,KAAKsxC,IAEc,IAA1BF,EAASruB,SAASwuB,IACpBH,EAASpxC,KAAKuxC,IAEc,IAA1BF,EAAStuB,SAASyuB,IACpBH,EAASrxC,KAAKwxC,OAGX,CACLp1C,EAAG+0C,EACH90C,EAAG+0C,EACH90C,EAAG+0C,MAxBCj1C,EADuC,EACvCA,EAAGC,EADoC,EACpCA,EAAGC,EADiC,EACjCA,EA4BRm1C,EAAY,SAACC,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAK4I,EAAMM,QAAQlJ,GAMU,CAC3BA,KACAmpB,WAAY,CACVjoB,QAASyzC,IARJ,CACL30C,KACAmpB,WAAY,SAatBvK,GAAU5b,KAEN4xC,EAAY,SAACD,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAK4I,EAAMM,QAAQlJ,GAMU,CAC3BA,KACAmpB,WAAY,CACVhoB,QAASwzC,IARJ,CACL30C,KACAmpB,WAAY,SAatBvK,GAAU5b,KAENkyC,EAAY,SAACP,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAK4I,EAAMM,QAAQlJ,GAMU,CAC3BA,KACAmpB,WAAY,CACV/nB,QAASuzC,IARJ,CACL30C,KACAmpB,WAAY,SAatBvK,GAAU5b,KAGZ,OACE,gCACE,4CACA,uBACA,cAAC,GAAD,CACEsmC,aAAcjqC,EAAEyD,OAAS,OAAIf,EAAY1C,EAAE,GAC3C+O,KAAM,IACNE,IAAK,IACLwlC,aAAa,EACbzG,KAAM,EAEN0G,MAAO,MACPvE,SAAUkF,IAEZ,cAAC,GAAD,CACEjhC,MAAOpU,EAAEyD,OAAS,EAAI,EAAIzD,EAAE,GAC5BmwC,SAAUkF,EACVpmC,IAAK,IACLF,KAAM,MAER,cAAC,GAAD,CACEk7B,aAAchqC,EAAEwD,OAAS,OAAIf,EAAYzC,EAAE,GAC3C8O,KAAM,IACNE,IAAK,IACLwlC,aAAa,EACbzG,KAAM,EAEN0G,MAAO,MACPvE,SAAUoF,IAEZ,cAAC,GAAD,CACEnhC,MAAOnU,EAAEwD,OAAS,EAAI,EAAIxD,EAAE,GAC5BkwC,SAAUoF,EACVtmC,IAAK,IACLF,KAAM,MAGR,cAAC,GAAD,CACEk7B,aAAc/pC,EAAEuD,OAAS,OAAIf,EAAYxC,EAAE,GAC3C6O,KAAM,IACNE,IAAK,IACL++B,KAAM,EACNyG,aAAa,EAEbC,MAAO,MACPvE,SAAU0F,IAEZ,cAAC,GAAD,CACEzhC,MAAOlU,EAAEuD,OAAS,EAAI,EAAIvD,EAAE,GAC5BiwC,SAAU0F,EACV5mC,IAAK,IACLF,KAAM,UAMR+mC,GAAqC,SAAC10C,GAAW,IAAD,EAC1B8mC,aAAY,SAACxhC,GACrC,IAAMquC,EAAqB,GACrBC,EAAqB,GAc3B,OAbAtuC,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAK+F,EAAMmD,QAAQlJ,GAAnB,CAGA,IAAMo1C,EAASrvC,EAAMmD,QAAQlJ,GAAIwB,MAC3B6zC,EAAUtvC,EAAMmD,QAAQlJ,GAAIuB,QACA,IAA9B6yC,EAASpuB,SAASovB,IACpBhB,EAASnxC,KAAKmyC,IAEmB,IAA/Bf,EAASruB,SAASqvB,IACpBhB,EAASpxC,KAAKoyC,OAGX,CACL7zC,MAAO4yC,EACP7yC,OAAQ8yC,MAlBJ7yC,EAD4C,EAC5CA,MAAOD,EADqC,EACrCA,OAsBTmzC,EAAY,SAACC,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAK4I,EAAMM,QAAQlJ,GAMU,CAC3BA,KACAmpB,WAAY,CACV3nB,MAAOmzC,IARF,CACL30C,KACAmpB,WAAY,SAatBvK,GAAU5b,KAEN4xC,EAAY,SAACD,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAK4I,EAAMM,QAAQlJ,GAMU,CAC3BA,KACAmpB,WAAY,CACV5nB,OAAQozC,IARH,CACL30C,KACAmpB,WAAY,SAatBvK,GAAU5b,KAGZ,OACE,gCACE,uBACA,cAAC,GAAD,CACEsmC,aAAc9nC,EAAMsB,OAAS,OAAIf,EAAYP,EAAM,GACnD8M,IAAK,IACLF,IAAK,EACLi/B,KAAM,GACNyG,aAAa,EAEbC,MAAO,UACPvE,SAAUkF,IAEZ,cAAC,GAAD,CACEjhC,MAAOjS,EAAMsB,OAAS,EAAI,EAAItB,EAAM,GACpCguC,SAAUkF,EACVpmC,IAAK,IACLF,IAAK,IAEP,cAAC,GAAD,CACEk7B,aAAc/nC,EAAOuB,OAAS,OAAIf,EAAYR,EAAO,GACrD+M,IAAK,IACLF,IAAK,EACLi/B,KAAM,GACNyG,aAAa,EAEbC,MAAO,WACPvE,SAAUoF,IAEZ,cAAC,GAAD,CACEnhC,MAAOlS,EAAOuB,OAAS,EAAI,EAAIvB,EAAO,GACtCiuC,SAAUoF,EACVtmC,IAAK,IACLF,IAAK,QAMPknC,GAA0C,SAAC70C,GAAW,IAAD,EACxB8mC,aAAY,SAACxhC,GAC5C,IAAMquC,EAAqB,GACrBC,EAAqB,GACrBC,EAAqB,GAkB3B,OAjBAvuC,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAK+F,EAAMmD,QAAQlJ,GAAnB,CAGA,IAAMu0C,EAAKxuC,EAAMmD,QAAQlJ,GAAIwB,MACvBgzC,EAAKzuC,EAAMmD,QAAQlJ,GAAIuB,OACvBkzC,EAAK1uC,EAAMmD,QAAQlJ,GAAIyB,OACC,IAA1B2yC,EAASpuB,SAASuuB,IACpBH,EAASnxC,KAAKsxC,IAEc,IAA1BF,EAASruB,SAASwuB,IACpBH,EAASpxC,KAAKuxC,IAEc,IAA1BF,EAAStuB,SAASyuB,IACpBH,EAASrxC,KAAKwxC,OAGX,CACLjzC,MAAO4yC,EACP7yC,OAAQ8yC,EACR5yC,MAAO6yC,MAxBH9yC,EADiD,EACjDA,MAAOD,EAD0C,EAC1CA,OAAQE,EADkC,EAClCA,MA4BjBizC,EAAY,SAACC,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAK4I,EAAMM,QAAQlJ,GAMU,CAC3BA,KACAmpB,WAAY,CACV3nB,MAAOmzC,IARF,CACL30C,KACAmpB,WAAY,SAatBvK,GAAU5b,KAEN4xC,EAAY,SAACD,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAK4I,EAAMM,QAAQlJ,GAMU,CAC3BA,KACAmpB,WAAY,CACV5nB,OAAQozC,IARH,CACL30C,KACAmpB,WAAY,SAatBvK,GAAU5b,KAENkyC,EAAY,SAACP,GACjB,QAAiB5yC,IAAb4yC,EAAJ,CAGA,IAAM/rC,EAAQ0C,KACRtI,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASiF,EAAMO,YAAYxC,KAAI,SAAC3G,GAC9B,OAAK4I,EAAMM,QAAQlJ,GAMU,CAC3BA,KACAmpB,WAAY,CACV1nB,MAAOkzC,IARF,CACL30C,KACAmpB,WAAY,SAatBvK,GAAU5b,KAGZ,OACE,gCACE,0CACA,uBACA,cAAC,GAAD,CACEsmC,aAAc9nC,EAAMsB,OAAS,OAAIf,EAAYP,EAAM,GACnD4M,IAAK,EACLE,IAAK,IACLwlC,aAAa,EACbzG,KAAM,GAEN0G,MAAO,UACPvE,SAAUkF,IAEZ,cAAC,GAAD,CACEjhC,MAAOjS,EAAMsB,OAAS,EAAI,EAAItB,EAAM,GACpCguC,SAAUkF,EACVtmC,IAAK,EACLE,IAAK,MAEP,cAAC,GAAD,CACEg7B,aAAc/nC,EAAOuB,OAAS,OAAIf,EAAYR,EAAO,GACrD6M,IAAK,EACLE,IAAK,IACLwlC,aAAa,EACbzG,KAAM,GAEN0G,MAAO,WACPvE,SAAUoF,IAEZ,cAAC,GAAD,CACEnhC,MAAOlS,EAAOuB,OAAS,EAAI,EAAIvB,EAAO,GACtCiuC,SAAUoF,EACVxmC,IAAK,EACLE,IAAK,MAGP,cAAC,GAAD,CACEg7B,aAAc7nC,EAAMqB,OAAS,OAAIf,EAAYN,EAAM,GACnD2M,IAAK,EACLE,IAAK,IACLwlC,aAAa,EACbzG,KAAM,GAEN0G,MAAO,UACPvE,SAAU0F,IAEZ,cAAC,GAAD,CACEzhC,MAAOhS,EAAMqB,OAAS,EAAI,EAAIrB,EAAM,GACpC+tC,SAAU0F,EACV9mC,IAAK,EACLE,IAAK,UAMPinC,GAA+B,SAAC90C,GACpC,IAAM+0C,EAAa,SAAC9R,GAClB,IAAM96B,EAAQ0C,KAERtI,EAAwC,CAC5CzC,KAAMuG,EAAao+B,uBACnBvmB,QAAS,CACPxV,YAAaP,EAAMO,YACnBu6B,aAGJ9kB,GAAU5b,IAqBNyyC,EAAWC,iBAAiB/1B,SAASnc,MAAMmyC,iBAC/C,cAEF,OACE,sCACK,uBACH,wBAAQtvC,QAxBc,WACxBmvC,EAAWzuC,EAAe68B,QAuBxB,SACE,cAAC,KAAD,CAAiBkC,KAAMM,KAAa9kC,MAAOm0C,EAAUrmC,KAAM,SAE7D,wBAAQ/I,QAxBgB,WAC1BmvC,EAAWzuC,EAAe88B,WAuBxB,SACE,cAAC,KAAD,CAAiBiC,KAAMsN,KAAe9xC,MAAOm0C,EAAUrmC,KAAM,SAE/D,wBAAQ/I,QAxBe,WACzBmvC,EAAWzuC,EAAe+8B,QAuBxB,SACE,cAAC,KAAD,CAAiBgC,KAAM8P,KAAct0C,MAAOm0C,EAAUrmC,KAAM,SAE9D,uBACA,uBAZF,MAaK,uBACH,wBAAQ/I,QA3Bc,WACxBmvC,EAAWzuC,EAAeg9B,QA0BxB,SACE,cAAC,KAAD,CAAiB+B,KAAMM,KAAa9kC,MAAOm0C,EAAUrmC,KAAM,SAE7D,wBAAQ/I,QA3BgB,WAC1BmvC,EAAWzuC,EAAei9B,WA0BxB,SACE,cAAC,KAAD,CAAiB8B,KAAMsN,KAAe9xC,MAAOm0C,EAAUrmC,KAAM,SAE/D,wBAAQ/I,QA3Be,WACzBmvC,EAAWzuC,EAAek9B,QA0BxB,SACE,cAAC,KAAD,CAAiB6B,KAAM8P,KAAct0C,MAAOm0C,EAAUrmC,KAAM,aAM9DymC,GAA0B,SAACp1C,GAC/B,IAAMq1C,EAAkBvO,aAAY,SAACxhC,GAMnC,IALA,IAAIgwC,EACF,SACEC,EAA+D,SAC/DC,EAAsB,GACtBC,EAAuBnwC,EAAMoD,YAAYrG,OAAS,EAC7CoV,EAAI,EAAGA,EAAInS,EAAMoD,YAAYrG,OAAQoV,IAAK,CACjD,IAAMlY,EAAK+F,EAAMoD,YAAY+O,GAC7B,QAA0BnW,IAAtBgE,EAAMmD,QAAQlJ,GAAlB,CAIA,GADmB+F,EAAMmD,QAAQlJ,GAAI6B,aAClBhD,EAAYiJ,OAAQ,CACrCouC,GAAc,EACd,MAGF,IAAMC,EAAWpwC,EAAMmD,QAAQlJ,GAAeiP,gBACpB,WAAtB8mC,EACFA,GAAgC,IAAZI,EAAmB,UAAY,YAEzB,YAAtBJ,IAA+C,IAAZI,GAEN,aAAtBJ,IAAgD,IAAZI,KAD7CJ,EAAoB,SAMxB,IAAMK,EAAWrwC,EAAMmD,QAAQlJ,GAAegP,cACtB,WAApBgnC,EACFA,GAA8B,IAAZI,EAAmB,UAAY,YAEzB,YAApBJ,IAA6C,IAAZI,GAEN,aAApBJ,IAA8C,IAAZI,KAD3CJ,EAAkB,SAMtBC,EAAUhzC,KAAKjD,IAEjB,MAAO,CAAEk2C,cAAaH,oBAAmBC,kBAAiBC,gBA8E5D,OACE,sBACEp2B,MAAO,CACLyK,QAAS,OACTqoB,cAAe,SACfK,WAAY,SACZqD,SAAU,KALd,WAQmC,IAAhCP,EAAgBI,YACf,eAAC,IAAM1O,SAAP,WAEE,sBAAKnhC,QA5DW,WACtB,IAAMrD,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASmyC,EAAgBG,UAAUtvC,KAAI,SAAC3G,GAStC,MAAO,CACLA,KACAmpB,WAAY,CACVna,cAVoC,YAApC8mC,EAAgBE,kBAETF,EAAgBE,iBACd,UAanBp3B,GAAU5b,IAsCJ,UACE,4CACqC,YAApC8yC,EAAgBE,gBACf,cAAC,KAAD,CAAiBlQ,KAAMwQ,KAASh1C,MAAO,SACrC,KACiC,UAApCw0C,EAAgBE,gBACf,cAAC,KAAD,CAAiBlQ,KAAMyQ,KAAqBj1C,MAAO,SACjD,QAIN,sBAAK+E,QA/Ca,WACxB,IAAMrD,EAA+B,CACnCzC,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAASmyC,EAAgBG,UAAUtvC,KAAI,SAAC3G,GAStC,MAAO,CACLA,KACAmpB,WAAY,CACVla,gBAVsC,YAAtC6mC,EAAgBC,oBAETD,EAAgBC,mBACd,UAanBn3B,GAAU5b,IAyBJ,UACE,gDACuC,YAAtC8yC,EAAgBC,kBACf,cAAC,KAAD,CAAiBjQ,KAAMwQ,KAASh1C,MAAO,SACrC,KAEmC,UAAtCw0C,EAAgBC,kBACf,cAAC,KAAD,CAAiBjQ,KAAMyQ,KAAqBj1C,MAAO,SACjD,WAGN,KAGJ,qBAAK+E,QAhHgB,WACvB,IAAMuC,EAAQ0C,KACRtI,EAA0B,CAC9BzC,KAAMuG,EAAaq+B,iBACnBxmB,QAAS,CACPzV,QAASN,EAAMO,YAAYxC,KAAI,SAAC3G,GAAD,OAAQ4I,EAAMM,QAAQlJ,QAGzD4e,GAAU5b,IAwGR,uBAEA,qBAAKqD,QAxGa,WACpB,IAAMuC,EAAQ0C,KACRtI,EAAuB,CAC3BzC,KAAMuG,EAAagb,cACnBnD,QAAS,CACPoD,IAAKnZ,EAAMO,cAGfyV,GAAU5b,IAgGR,wBCjsDOwzC,GAAoD,SAAC/1C,GAChE,IAAM0I,EAAco+B,aAAY,SAACxhC,GAC/B,OAAOA,EAAMoD,eAETstC,EAAiBlP,aAAY,SAACxhC,GAClC,IAAM2wC,EAAkC,GACxC3wC,EAAMoD,YAAYpG,SAAQ,SAAC/C,GACzB,GAAI+F,EAAMmD,QAAQlJ,GAAK,CACrB,IAAM6B,EAAakE,EAAMmD,QAAQlJ,GAAI6B,WAC/B80C,EAAiB3vC,EAAoBnF,GAC3C,GAA+B,IAA3B60C,EAAgB5zC,OAClB6zC,EAAe5zC,SAAQ,SAAC8e,GACtB60B,EAAgBzzC,KAAK4e,WAGvB,IAAK,IAAI3J,EAAIw+B,EAAgB5zC,OAAS,EAAGoV,GAAK,EAAGA,IAAK,CACpD,IAAM2J,EAAS60B,EAAgBx+B,IACS,IAApCy+B,EAAe3wB,SAASnE,IAC1B60B,EAAgB/jC,OAAO+jC,EAAgBh/B,QAAQmK,GAAS,QAMlE,IAAM7J,EAA2B,GAC7B4+B,EAAoD,GAwLxD,OAvLAF,EAAgB3zC,SAAQ,SAAC8e,GACvB,GAAIzZ,GAAQyZ,GAAS,CACnB,GAAIA,IAAWtc,EAAa8B,WACO,IAA7BtB,EAAMoD,YAAYrG,OACpB,OAGJ,GAAI+e,IAAWtc,EAAaoC,MAAQka,IAAWtc,EAAaqC,OAC1D,GAAiC,IAA7B7B,EAAMoD,YAAYrG,OAAc,CAClC,IAAM9C,EAAK+F,EAAMoD,YAAY,GACvBsD,EAAM1G,EAAMmD,QAAQlJ,GAC1B,IAAqB,IAAjByM,EAAI7K,SAKN,OAJAg1C,EAAiB,IACFxuC,GAAQ7C,EAAaqC,QAAQ9F,SAAW,CACrDyD,EAAaqC,SAER,EAET,IAAqB,IAAjB6E,EAAI7K,UAAsBigB,IAAWtc,EAAaqC,OACpD,WAEG,CACL,IAAIivC,GAA2B,EA2C/B,GA1CA9wC,EAAMoD,YAAYpG,SAAQ,SAAC0M,GACzB,QAAgC1N,IAA5BgE,EAAMmD,QAAQuG,GAAlB,CAIA,IAAMyO,EACJnY,EAAMmD,QAAQuG,GAAU5N,aAAehD,EAAY4I,MAE/C0W,OACoCpc,IAAxCgE,EAAMmD,QAAQuG,GAAd,SACA1J,EAAMmD,QAAQuG,GAAd,QAAqC3M,OAAS,EAC1ChB,EAAUiE,EAAMmD,QAAQuG,GAAd,QAChB,GAAIyO,EAAS,CACX,IAAMzR,EAAM1G,EAAMmD,QAAQuG,GAC1B,IAAqB,IAAjBhD,EAAI7K,SAMN,OALAg1C,EAAiB,IACFxuC,GAAQ7C,EAAaqC,QAAQ9F,SAAW,CACrDyD,EAAaqC,QAEfivC,GAAsB,GACf,EAET,IAAqB,IAAjBpqC,EAAI7K,UAAsBigB,IAAWtc,EAAaqC,OAEpD,YADAivC,GAAsB,QAGnB,GAAI14B,EAAW,CACpB,IAAM1R,EAAM1G,EAAMmD,QAAQpH,GAC1B,IAAqB,IAAjB2K,EAAI7K,SAMN,OALAg1C,EAAiB,IACFxuC,GAAQ7C,EAAaqC,QAAQ9F,SAAW,CACrDyD,EAAaqC,QAEfivC,GAAsB,GACf,EAET,IAAqB,IAAjBpqC,EAAI7K,UAAsBigB,IAAWtc,EAAaqC,OAEpD,YADAivC,GAAsB,SAKA,IAAxBA,EACF,OAEA,GAAIh1B,IAAWtc,EAAaqC,OAC1B,OAKR,GAAIia,IAAWtc,EAAakC,OAASoa,IAAWtc,EAAamC,QAAS,CACpE,GAAiC,IAA7B3B,EAAMoD,YAAYrG,OACpB,OAGA,IAAIg0C,GAAsB,EACtBC,GAA+B,EAI/BrkC,EAAkB,EAClBskC,EAAoB,EACpBC,EAAoB,EAwCxB,GAtCAlxC,EAAMoD,YAAYpG,SAAQ,SAAC0M,GACzB,IAAuB,IAAnBqnC,IAG4B,IAA5BC,QAG4Bh1C,IAA5BgE,EAAMmD,QAAQuG,GAGlB,GAAI1J,EAAMmD,QAAQuG,GAAU5N,aAAehD,EAAYiJ,OAKvD,GAAI/B,EAAMmD,QAAQuG,GAAU5N,aAAehD,EAAYsB,WACF4B,IAA9CgE,EAAMmD,QAAQuG,GAAmBzN,SADxC,CAOA,IAAMkc,EACJnY,EAAMmD,QAAQuG,GAAU5N,aAAehD,EAAY4I,MAG/C0W,OACoCpc,IAAxCgE,EAAMmD,QAAQuG,GAAd,SACA1J,EAAMmD,QAAQuG,GAAd,QAAqC3M,OAAS,EAC5Cob,EACFxL,GAA0B,EACjByL,EACT64B,GAA8B,EAE9BC,GAA8B,OAjB5BF,GAA0B,OAN5BD,GAAiB,MA2BE,IAAnBA,EACF,OAGF,IAAgC,IAA5BC,EACF,OAUF,GAAqB,IAAjBE,GAAsBvkC,EAAa,GACrC,GAAImP,IAAWtc,EAAakC,MAC1B,YAEG,GAAIiL,EAAa,GAAKskC,EAAe,QAG1C,GAAIn1B,IAAWtc,EAAamC,QAC1B,OAKHkvC,EAAexuC,GAAQyZ,GAAQ/f,SAGlC80C,EAAexuC,GAAQyZ,GAAQ/f,SAASmB,KAAK4e,GAF7C+0B,EAAexuC,GAAQyZ,GAAQ/f,SAAW,CAAC+f,OAMjDzL,OAAO2Q,KAAK6vB,GACTM,MAAK,SAACC,EAAUC,GACf,IAAMC,EAAeT,EAAeO,GAAU,GACxCG,EAAeV,EAAeQ,GAAU,GACxCG,EAAkBnvC,GAAQivC,GAAc9uC,eACxCivC,EAAkBpvC,GAAQkvC,GAAc/uC,eAC9C,OAAOgvC,IAAoBC,EACvB,EACAD,EAAkBC,EAClB,GACC,KAENz0C,SAAQ,SAACjB,GACR,IAAM0jC,EAAUoR,EAAe90C,GAASo1C,MAAK,SAACO,EAASC,GACrD,OAAOtvC,GAAQqvC,GAASpvC,YAAcD,GAAQsvC,GAASrvC,UACnD,EACAD,GAAQqvC,GAASpvC,UAAYD,GAAQsvC,GAASrvC,UAC9C,GACC,KAEP2P,EAAO/U,KAAKuiC,MAETxtB,KAjNiE,EAmNxCpS,IAAMC,SAIrC,CACDgE,QAAQ,EACR/I,UAAMiB,EACN+kC,WAAY,IA1N4D,mBAmNnE6Q,EAnNmE,KAmNxDC,EAnNwD,KA4NpEC,EAAiB,SAAC/2C,EAAoBgmC,GAC1C,IAAM6N,EAAW7zC,IAAS62C,EAAU72C,OAAQ62C,EAAU9tC,OACtD+tC,EAAa,CACX/tC,OAAQ8qC,EACR7zC,OACAgmC,gBAYJ,OARAlhC,IAAMK,WAAU,WACd2xC,EAAa,CACX/tC,QAAQ,EACR/I,UAAMiB,EACN+kC,WAAY,MAEb,CAAC39B,IAGF,qBACE3C,UAAS,2BACTqZ,MAAO,CACLrC,IAAK/c,EAAMnB,EACXme,KAAMhd,EAAMpB,GAJhB,SAOE,sBAAKmH,UAAW,kBAAhB,UACE,qBAAKA,UAAW,uBAAhB,SACGiwC,EAAe9vC,KAAI,SAAC6+B,EAASp4B,GAC5B,OACE,cAAC,GAAD,CAEEo4B,QAASA,EACTn/B,QAASwxC,EACTpS,gBACuB,IAArBkS,EAAU9tC,aAAsC9H,IAAnB41C,EAAU72C,KACnC62C,EAAU72C,UACViB,GANDqL,SAaS,IAArBuqC,EAAU9tC,aAAsC9H,IAAnB41C,EAAU72C,KACtC,cAAC,GAAD,CACEgmC,WAAY6Q,EAAU7Q,WACtBhmC,KAAM62C,EAAU72C,OAEhB,WC9QCg3C,GAAsC,SAACr3C,GAClD,IAAMwK,EAAyBs8B,aAAY,SAACxhC,GAC1C,OAAOA,EAAM4D,GAAGsB,0BAIlB,YAA+BlJ,IAA3BkJ,EACK,KAIP,cAAC8sC,GAAD,CACEl4B,MAAO,CACLI,YAC6Ble,IAA3BkJ,EACI,KACC,sCALX,cAQ8BlJ,IAA3BkJ,EACC,cAAC,GAAD,CACE5L,EAAG4L,EAAuB5L,EAC1BC,EAAG2L,EAAuB3L,IAE1B,QAKGy4C,GAA8BnxC,IAAOC,IAAV,8yB,UCzB3BmxC,GAAiC,WAAO,IAAD,EAC5CjnB,EAAUwW,aAAY,SAACxhC,GAC3B,OAAOA,EAAMO,SAFmC,EAI1BV,IAAMC,SAAN,iBAAekrB,QAAf,IAAeA,OAAf,EAAeA,EAASxwB,YAAxB,QAAgC,IAJN,mBAI3CA,EAJ2C,KAIrC03C,EAJqC,KAKlD,IAAKlnB,EACH,OAAO,cAAC,IAAMyW,SAAP,IAET,IAAiC,IAA7BzW,EAAQrnB,iBACV,OAAO,cAAC,IAAM89B,SAAP,IAET,IAAM0Q,EAAgB,WACpB,IAAMtvC,EAAQ0C,KACRE,EAAW0c,mBAAQtf,GAAO,SAACuf,GAC3BA,EAAM7hB,QACR6hB,EAAM7hB,MAAMoD,kBAAmB,MAGnC6B,GAASC,GACTwW,GAAkBxW,IAapB,OACE,cAAC2sC,GAAD,UACE,sBAAK3xC,UAAW,mBAAhB,UACE,qBAAKA,UAAW,2BAA4BH,QAAS6xC,EAArD,kBAGA,qBAAK1xC,UAAW,mCAAhB,SACE,sBAAKA,UAAW,2BAAhB,UACE,qBAAKA,UAAW,aAAcH,QAAS6xC,EAAvC,SACE,cAAC,KAAD,CAAiBpS,KAAMU,KAASllC,MAAO,WAGzC,iDACA,8BACE,uBACEf,KAAM,OACNiG,UAAW,QACXiN,MAAOlT,EACPivC,SAAU,SAACxsC,GACTi1C,EAAQj1C,EAAM2oC,OAAOl4B,QAEvBu8B,OAAQ,SAAChtC,GACP,IAAMo1C,EAAUp1C,EAAM2oC,OAAOl4B,MACzB2kC,EAAQt1C,OAAS,GAlCX,SAACs1C,GACzB,IAAMxvC,EAAQ0C,KACRE,EAAW0c,mBAAQtf,GAAO,SAACuf,GAC3BA,EAAM7hB,QACR6hB,EAAM7hB,MAAM/F,KAAO63C,MAGvB7sC,GAASC,GACTwW,GAAkBxW,GA2BF6sC,CAAkBD,QAM1B,qBAAK5xC,UAAW,uBAQf2xC,GAAyBvxC,IAAOC,IAAV,ysD,UC9DtByxC,GAAmC,SAAC73C,GAAW,IAAD,MAC5B8mC,aAAY,SAACxhC,GAAmB,IAAD,EAC7BA,EAAML,QACnC,MAAO,CACL0D,QAHwD,EAClDA,QAGNC,QAJwD,EACzCA,YADXD,EADiD,EACjDA,QAASC,EADwC,EACxCA,QAOX/C,EAAQihC,aAAY,SAACxhC,GACzB,OAAOA,EAAMO,SAgEf,OACE,cAACiyC,GAAD,UACE,sBAAK/xC,UAAW,uBAAhB,UACE,sBAAKA,UAAW,kBAAhB,UACE,qBACEA,UAAU,iBACVH,QA1CU,aA4CVq/B,WAAU,eACVC,aAAY,SACZC,YAAW,OACXC,cAAa,QAPf,SASE,qBAAKr/B,UAAW,QAAhB,SACE,cAAC,IAAD,CAAMC,GAAG,IAAT,4BAIE,OAALH,QAAK,IAALA,OAAA,EAAAA,EAAO/F,MACN,qBACEiG,UAAW,eACXH,QAzEQ,WAClB,GAAKC,GAGAA,EAAMiD,qBAAX,CAGA,IAAMX,EAAQ0C,KACRE,EAAW0c,mBAAQtf,GAAO,SAACuf,GAC3BA,EAAM7hB,QACR6hB,EAAM7hB,MAAMoD,kBAAmB,MAGnC6B,GAASC,GACTwW,GAAkBxW,KA4DRk6B,WAAA,iBAAUp/B,QAAV,IAAUA,OAAV,EAAUA,EAAO/F,YAAjB,QAAyB,GACzBolC,aAAY,SACZC,YAAW,OACXC,cAAa,QANf,SAQE,qBAAKr/B,UAAW,QAAhB,0BAA0BF,QAA1B,IAA0BA,OAA1B,EAA0BA,EAAO/F,YAAjC,QAAyC,OAEzC,MAEE,OAAL+F,QAAK,IAALA,OAAA,EAAAA,EAAOiD,sBACN,qBACE/C,UAAW,aACXH,QAnEa,WACvB,GAAKC,GAGAA,EAAMiD,qBAAX,CAGA,IAAMX,EAAQ0C,KACRE,EAAW0c,mBAAQtf,GAAO,SAACuf,GAC3BA,EAAM7hB,QACR6hB,EAAM7hB,MAAMkD,aAAe2e,EAAM7hB,MAAMkD,gBAG3C+B,GAASC,GACTwW,GAAkBxW,KAuDRk6B,YACwB,IAAtBp/B,EAAMkD,YACF,wBACA,mBAENm8B,aAAY,SACZC,YAAW,OACXC,cAAa,QAXf,SAaE,cAAC,KAAD,CACEC,KAAMx/B,EAAMkD,YAAcgvC,KAAcC,SAG1C,MAEE,OAALnyC,QAAK,IAALA,OAAA,EAAAA,EAAOmD,kBACN,qBACEjD,UAAW,kBACXH,QAvEiB,WAC3B,IACE,IAAMsoB,EAAUhT,GAAS2D,SAASe,WAC/BoP,UAAU,aACV9X,QAAQ,YAAa,sBAClB+gC,EAAO/4B,SAASC,cAAc,KACpCD,SAASnc,KAAK+c,YAAYm4B,GAC1BA,EAAKC,SAAW,wBAChBD,EAAKE,KAAOjqB,EACZ+pB,EAAKG,QACLl5B,SAASnc,KAAKgd,YAAYk4B,GAC1B,MAAOnhC,GAEP,YADAlV,QAAQkB,IAAIgU,KA6DJmuB,WAAU,kBACVC,aAAY,SACZC,YAAW,OACXC,cAAa,QAPf,SASE,cAAC,KAAD,CAAiBC,KAAMgT,SAEvB,QAGL1vC,GAAWC,EACV,sBAAK7C,UAAW,qBAAhB,UACE,qBACEA,UAAS,sBAAiB6C,EAAU,SAAW,YAC/ChD,QA/HQ,WACdgD,GACFkkB,MA+HQmY,WAAU,OACVC,aAAY,SACZC,YAAW,OACXC,cAAa,QAPf,SASE,sBAAMr/B,UAAU,OAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAMiT,WAI3B,qBACEvyC,UAAS,sBAAiB4C,EAAU,SAAW,WAAtC,KACT/C,QAlJQ,WACd+C,GACFwkB,MAkJQ8X,WAAU,OACVC,aAAY,SACZC,YAAW,OACXC,cAAa,QAPf,SASE,sBAAMr/B,UAAU,OAAhB,SACE,cAAC,KAAD,CACEs/B,KAAMiT,KACNl5B,MAAO,CAAE0zB,UAAW,uBAK1B,WAMCgF,GAA2B3xC,IAAOC,IAAV,6+GCxLxBmyC,GAA+B,SAACv4C,GAAW,IAC9C8J,EAAcg9B,aAAY,SAACxhC,GAEjC,MAAO,CACLwE,UAFoBxE,EAAM4D,GAApBY,cADFA,UA0BR,OACE,cAAC0uC,GAAD,UACE,qBAAKzyC,UAAW,kBAAhB,SACE,sBAAKA,UAAW,0BAAhB,UACE,qBACEA,UAAW,OACXH,QAhBW,WACnB,IAAM2kB,EAAsC,CAC1CzqB,KAAMuG,EAAamkB,qBACnBtM,QAAS,CACPuM,SAAU,sBACVC,cAAc,IAGlBvM,GAAUoM,IAUF0a,WAAU,WACVC,aAAY,MACZC,YAAW,OACXC,cAAa,QAPf,SASE,qBAAKr/B,UAAW,QAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAMoT,WAG3B,qBACE1yC,UAAW,OACXH,QAvCU,WAClB,IAAM2kB,EAAsC,CAC1CzqB,KAAMuG,EAAamkB,qBACnBtM,QAAS,CACPuM,SAAU,qBACVC,cAAc,IAGlBvM,GAAUoM,IAiCF0a,WAAA,UACAC,aAAY,MACZC,YAAW,OACXC,cAAa,QAPf,SASE,qBAAKr/B,UAAW,QAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAMqT,WAG3B,qBACE3yC,UAAW,YAEXk/B,WAAA,kBACAC,aAAY,MACZC,YAAW,OACXC,cAAa,QANf,SAQE,sBAAKr/B,UAAW,QAAhB,UAA0BmH,KAAKq/B,MAAO,EAAIziC,EAAa,KAAvD,iBAQC0uC,GAAuBryC,IAAOC,IAAV,8iCCzEpBuyC,GAA6B,WAAO,IACvCC,EAAiB9R,aAAY,SAACxhC,GACpC,IAAMuzC,EAOF,GACJljC,OAAO2Q,KAAKhhB,EAAMmD,SAASnG,SAAQ,SAAC/C,GAClC,GAAI+F,EAAMmD,QAAQlJ,GAAI6B,aAAehD,EAAYsB,KAAM,CACrD,IAAME,EAAO0F,EAAMmD,QAAQlJ,GACrBu5C,EAAiB,CACrB/3C,MAAOnB,EAAKmB,MACZD,OAAQlB,EAAKkB,OACbE,MAAOpB,EAAKoB,MAIZX,KAAMT,EAAKS,KACXQ,MAAOjB,EAAKiB,OAERQ,EAAU2B,KAAKC,UAAU61C,GAE/B,QAAwBx3C,IAApBu3C,EAAOx3C,GAAwB,CACjC,IAAM03C,EAAOnuC,oBAAUhL,GACvBm5C,EAAKt4C,QAAU,GACfs4C,EAAKr4C,QAAU,EACfq4C,EAAKp4C,QAAU,EACfk4C,EAAOx3C,GAAW,CAChB23C,MAAO,EACPC,QAASF,EACTG,SAAS,GAAD,OAAKH,EAAKl4C,OAClBs4C,YAAY,GAAD,OAAKJ,EAAKl4C,MAAV,cAER,CACL,IAAMu4C,EAAWP,EAAOx3C,GAAS23C,MAAQ,EACzCH,EAAOx3C,GAAS23C,MAAQI,EACxBP,EAAOx3C,GAAS83C,YAAhB,UAAiCv5C,EAAKiB,MAAtC,cAAiDu4C,EAAjD,UAIN,IAAMR,EAMA,GAgBN,OAdAjjC,OAAO2Q,KAAKuyB,GAAQv2C,SAAQ,SAAC/C,EAAIoN,GAC/B,KAAIA,EAFY,IAEhB,CAGA,IAAMjB,EAAQmtC,EAAOt5C,GACf85C,EAAS,UAAM3tC,EAAMstC,MAAZ,KACfJ,EAAap2C,KAAK,CAChBw2C,MAAOttC,EAAMstC,MACbC,QAASvtC,EAAMutC,QACfC,SAAUxtC,EAAMwtC,SAChBC,YAAaztC,EAAMwtC,SACnBG,kBAGG,CACLT,mBAjEIA,aA+ER,OACE,cAACU,GAAD,UACE,qBAAKvzC,UAAW,gBAAhB,SACE,qBACEA,UAAW,wBACXH,QAhBwB,WAC9B,IAAMrD,EAAiC,CACrCzC,KAAMuG,EAAam+B,wBACnBtmB,QAAS,CACPtU,MAAO,UACPi5B,MAAM,EACNC,QAAQ,IAGZ3kB,GAAU5b,IAKN,SAIGq2C,EAAa1yC,KAAI,SAACwF,EAAOiB,GACxB,IAAKjB,EACH,OAAO,KAET,IAAKA,EAAMutC,QACT,OAAO,KAET,IAAKvtB,GACH,OAAO,KAET,IAAM6tB,EAAS7tB,GAAoBymB,mBACjCzmC,EAAMutC,QACN,GACA,IAEF,OACE,sBACElzC,UAAW,aAGXk/B,WAAUv5B,EAAMytC,YAChBjU,aAAY,MACZC,YAAW,OACXC,cAAa,QAPf,UASE,sBAAMr/B,UAAW,UAAjB,SACE,qBAAK0N,IAAK8lC,MAEZ,sBAAMxzC,UAAW,QAAjB,SAA2B2F,EAAM2tC,cAV5B1sC,aAoBR2sC,GAAqBnzC,IAAOC,IAAV,ikCCtGlBozC,GAAc,SAAC,GAAoB,IAAlBC,EAAiB,EAAjBA,WAGtBC,EAAqB,SAACC,GAC1B,IAAMv4B,EAA2B,CAC/BthB,KAAMuG,EAAaua,iBACnB1C,QAAS,CACP2C,WAAY,CACV9W,KAAM4vC,KAIZx7B,GAAUiD,IAIZ,OACE,sBAAKrb,UAAU,GAAf,UAQE,cAAC,GAAD,CACEutC,MAAO,2BACPjO,KAAM,cAAC,KAAD,CAAiBA,KAAMuU,OAC7Bh0C,QAAS,kBAAM8zC,EAAmBr7C,EAAW2L,eAC7Cwd,WAAYiyB,IAAep7C,EAAW2L,eAGxC,cAAC,GAAD,CACEspC,MAAO,6BACPjO,KAAM,cAAC,KAAD,CAAiBA,KAAMwU,OAC7Bj0C,QAAS,kBAAM8zC,EAAmBr7C,EAAW4sB,iBAC7CzD,WAAYiyB,IAAep7C,EAAW4sB,iBAgBxC,cAAC,GAAD,CACEqoB,MAAO,iBACPjO,KAAM,cAAC,KAAD,CAAiBA,KAAMuM,OAC7BhsC,QAAS,kBAAM8zC,EAAmBr7C,EAAW2sB,WAC7CxD,WAAYiyB,IAAep7C,EAAW2sB,WAGxC,cAAC,GAAD,CACEsoB,MAAO,mBACPjO,KAAM,cAAC,KAAD,CAAiBA,KAAMyU,OAC7Bl0C,QAAS,kBAAM8zC,EAAmBr7C,EAAWysB,aAC7CtD,WAAYiyB,IAAep7C,EAAWysB,aAGxC,cAAC,GAAD,CACEwoB,MAAO,qBACPjO,KAAM,cAAC,KAAD,CAAiBA,KAAM0U,OAC7Bn0C,QAAS,kBAAM8zC,EAAmBr7C,EAAWwsB,cAC7CrD,WAAYiyB,IAAep7C,EAAWwsB,cAGxC,cAAC,GAAD,CACEyoB,MAAO,6BACP0G,OAAQ,eACR3U,KAAM,cAAC,KAAD,CAAiBA,KAAM4U,OAC7Br0C,QAAS,kBAAM8zC,EAAmBr7C,EAAW0sB,YAC7CvD,WAAYiyB,IAAep7C,EAAW0sB,YAGxC,cAAC,GAAD,CACEuoB,MAAO,2BACPjO,KAAM,cAAC,KAAD,CAAiBA,KAAM6U,aAM/BC,GAMD,SAACn6C,GACJ,OACE,cAACo6C,GAAD,UACE,qBACEr0C,UAAS,wBAAmB/F,EAAMwnB,WAAa,YAAc,IAC7D5hB,QAAS5F,EAAM4F,QACfq/B,WAAUjlC,EAAMszC,MAChBpO,aAAY,QACZC,YAAW,OACXC,cAAa,QACbn/B,YAAWjG,EAAMg6C,OAPnB,SASE,sBAAMj0C,UAAU,OAAhB,SAAwB/F,EAAMqlC,YAMhC+U,GAAej0C,IAAOC,IAAV,+kBA4BZi0C,GAA6D,SAACr6C,GACjDs6C,cAAjB,IACMC,EAAmB,CAAC,GAAI,IACxBC,EAAkB,CAAC,EAAG,GAHgD,EAIxCr1C,IAAMC,SACxCm1C,GAL0E,mBAIrEE,EAJqE,KAIzDC,EAJyD,OAO5Cv1C,IAAMC,SAAmBo1C,GAPmB,mBAOrE58B,EAPqE,KAO3D+8B,EAP2D,OAQrCx1C,IAAMC,UAAkB,GARa,mBAQrEw1C,EARqE,KAQnDC,EARmD,KAUtEC,EAAkB,WACtBD,GAAYD,IAsBd,OACE,sBAAKx7B,MAAO,CAAEhf,SAAU,YAAxB,UACE,cAACg6C,GAAD,UACE,qBACEr0C,UAAS,wBAAmB60C,EAAmB,YAAc,IAC7Dh1C,QAASk1C,EACT7V,YAA+B,IAArB2V,OAA4Bt5C,EAAYtB,EAAMszC,MACxDpO,aAAY,QACZC,YAAW,OACXC,cAAa,QACb2V,oBAAuC,IAArBH,EAPpB,SASE,sBAAM70C,UAAS,OAAf,SAA0B/F,EAAMqlC,YAId,IAArBuV,EACC,cAACI,GAAD,UACE,cAAC,GAAD,CACEp9B,SAAUA,EACV68B,WAAYA,EACZE,YAAaA,EACbD,cAAeA,EACfrL,SA3CO,SAACzO,EAAkBqa,GAElC,IAAM75B,EAA2B,CAC/BthB,KAAMuG,EAAak+B,iBACnBrmB,QAAS,CACPzR,KAAMm0B,EACNp0B,QAASyuC,EACTnZ,OAAQ,cAGZ3jB,GAAUiD,GAEV05B,IACAJ,EAAcH,GACdI,EAAYH,IA8BJU,SA5BO,WACfR,EAAcH,GACdM,GAAW,QA6BL,SAKJM,GAOD,SAACn7C,GACJ,IAAMo7C,EAASj2C,IAAM+gC,OAAmB,MAIxC,OAHAmV,GAAgBD,GAAQ,WACtBp7C,EAAMk7C,cAGN,sBAAKn1C,UAAU,YAAf,UACE,qBACEA,UAAW,eACXqZ,MAAO,CAAEre,MAA6B,GAAtBf,EAAMy6C,WAAW,IACjCtU,IAAK,SAACrvB,GACJskC,EAAOhV,QAAUtvB,GAJrB,SAOGkrB,gBAAMhiC,EAAMy6C,WAAW,IAAIv0C,KAAI,SAAC06B,GAAD,OAC9B,qBAAK76B,UAAW,cAAhB,SACGi8B,gBAAMhiC,EAAMy6C,WAAW,IAAIv0C,KAAI,SAAC+0C,GA8C/B,OACE,qBAEEl1C,UAAS,eACPk1C,EAAWj7C,EAAM4d,SAAS,IAAMgjB,EAAW5gC,EAAM4d,SAAS,GACtD,WACA,IAEN4wB,aArDiB,WACnBxuC,EAAM26C,YAAY,CAAC/Z,EAAW,EAAGqa,EAAW,KAqD1Cr1C,QAZY,WACd5F,EAAMqvC,SAASzO,EAAW,EAAGqa,EAAW,IAGxC,iBACOA,OAjDuBra,QAiExC,sBAAK76B,UAAW,gBAAhB,UACG/F,EAAM4d,SAAS,GADlB,IACuB5d,EAAM4d,SAAS,UAMtCy9B,GAAkB,SAAClV,EAAK72B,GAC5B,IAAMgsC,EAAc,SAACxkC,GACfqvB,EAAIC,UAAYD,EAAIC,QAAQ/W,SAASvY,EAAEo0B,SACzC57B,KAIJnK,IAAMK,WAAU,WAGd,OAFA0Z,SAASmD,iBAAiB,QAASi5B,GAE5B,WACLp8B,SAASq8B,oBAAoB,QAASD,QAKtCN,GAAkB70C,IAAOC,IAAV,ouBCzVRo1C,GAA+B,WAC1C,IAAM/B,EAAa3S,aAAY,SAACxhC,GAC9B,OAAOA,EAAM4D,GAAGa,QAGlB,OACE,cAAC0xC,GAAD,UACE,qBAAK11C,UAAU,kBAAf,SACE,qBAAKA,UAAW,kBAAhB,SACE,cAAC,GAAD,CAAa0zC,WAAYA,WAOtBgC,GAAuBt1C,IAAOC,IAAV,omBCjBpBs1C,GAAqBv1C,IAAOC,IAAV,0qBA8BlBu1C,GAA0C,SAAC37C,GACtD,OACE,qBAAK+F,UAAW,gBAAiBH,QAAS5F,EAAM4F,QAAhD,SACE,cAAC,KAAD,CAAiBy/B,KAAMU,KAASllC,MAAO,OAAQ8N,KAAM,UCtB9CitC,GAA6B,WACxC,IAAM/xC,EAAei9B,aAAY,SAACxhC,GAChC,OAAOA,EAAM4D,GAAGW,gBAGlB,OACE,cAACgyC,GAAD,UACE,qBAAK91C,UAAW,wBAAhB,UAC2B,IAAxB8D,EAAaT,OACZ,qCAC0B,YAAvBS,EAAaD,MAAsB,cAAC,GAAD,IAAmB,KAE/B,YAAvBC,EAAaD,MAAsB,cAAC,GAAD,IAAmB,QAEvD,UAMCiyC,GAAqB11C,IAAOC,IAAV,uYAkBzB01C,GAA6B,WACjC,IAUM15C,EAAS0kC,aAAY,SAACxhC,GAC1B,OAAOA,EAAML,QAAQ7C,UAEvB,OACE,cAACs5C,GAAD,UACE,sBAAK31C,UAAW,kBAAhB,UACE,qBAAKA,UAAW,QAAhB,4BACA,cAAC,GAAD,CAAaH,QAjBS,WAC1B,IAAMrD,EAAiC,CACrCzC,KAAMuG,EAAam+B,wBACnBtmB,QAAS,CACP2kB,MAAM,EACNj5B,MAAO,YAGXuU,GAAU5b,MAUN,cAACw5C,GAAD,UACE,qBAAKh2C,UAAW,SAAhB,SACG3D,EAAO8D,KAAI,SAAC81C,EAAGvkC,EAAGrV,GACjB,IAAMuK,EAAQvK,EAAOC,OAAS,EAAIoV,EAC5BlV,EAAQH,EAAOuK,GACrB,IAAKpK,EACH,OAAO,cAAC,IAAMwkC,SAAP,IAET,IAGMkV,EAAgBpgB,KAAMt5B,EAAMsqB,WAAW6f,SAC7C,OACE,sBAEE3mC,UAAS,gBAAWxD,EAAMqqB,SAAW,SAAW,YAChDhnB,QARuB,YpC2DP,SAAC+G,GACjC,IAAM1H,EAAU+nB,KACVkvB,EAAYj3C,EAAQ0H,MAAQ,EAE9BA,IAAUuvC,IAEHvvC,GAAS,GAAKA,EAAQuvC,EAC/Bla,gBAAMka,EAAYvvC,GAAOrK,SAAQ,WAC/BwqB,QAEOngB,EAAQ1H,EAAQ7C,OAAOC,QAAUsK,EAAQuvC,GAClDla,gBAAMr1B,EAAQuvC,GAAW55C,SAAQ,WAC/B6qB,SoCtEUgvB,CAAmBxvC,IAInB,UAKE,qBAAK5G,UAAW,OAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAM+W,SAEzB,qBAAKr2C,UAAW,OAAhB,SAAyBxD,EAAMzC,OAC/B,qBACEiG,UAAW,OAEXk/B,WAAUgX,EACV/W,aAAY,SACZC,YAAW,OACXC,cAAa,QANf,SAQGvJ,KAAMt5B,EAAMsqB,WAAW6f,OAAO,gBAhB5Bj1B,gBA4BjBskC,GAAqB51C,IAAOC,IAAV,w7CA2ElBi2C,GAA6B,WACjC,IAWM5zC,EAAUq+B,aAAY,SAACxhC,GAC3B,OAAOA,EAAMmD,WAbwB,EAgBKtD,IAAMC,SAAkB,OAhB7B,mBAgBhCk3C,EAhBgC,KAgBhBC,EAhBgB,OAiBOp3C,IAAMC,SAAsB,IAjBnC,mBAiBhCo3C,EAjBgC,KAiBfC,EAjBe,KAkBjCC,EAAgB,SAACrtC,GACrBktC,EAAkBltC,GACH,QAAXA,EACFotC,EACE9mC,OAAO2Q,KAAK7d,GAASvC,KAAI,SAAC3G,GACxB,OAAOkJ,EAAQlJ,OAGC,UAAX8P,EACTotC,EACE9mC,OAAO2Q,KAAK7d,GACTvC,KAAI,SAAC3G,GACJ,OAAOkJ,EAAQlJ,MAEhB8P,QAAO,SAACyH,GAAD,OAAOA,EAAE1V,aAAehD,EAAYsB,SAE5B,WAAX2P,EACTotC,EACE9mC,OAAO2Q,KAAK7d,GACTvC,KAAI,SAAC3G,GACJ,OAAOkJ,EAAQlJ,MAEhB8P,QAAO,SAACyH,GAAD,OAAOA,EAAE1V,aAAehD,EAAY4I,UAE5B,UAAXqI,GACTotC,EACE9mC,OAAO2Q,KAAK7d,GACTvC,KAAI,SAAC3G,GACJ,OAAOkJ,EAAQlJ,MAEhB8P,QACC,SAACyH,GAAD,QAEIA,EAAE1V,aAAehD,EAAYsB,MAC7BoX,EAAE1V,aAAehD,EAAY4I,YAsB3C,OAHA7B,IAAMK,WAAU,WACdk3C,EAAcJ,KACb,CAAC7zC,IAEF,cAACizC,GAAD,UACE,sBAAK31C,UAAW,kBAAhB,UACE,qBAAKA,UAAW,QAAhB,qBACA,cAAC,GAAD,CAAaH,QA7ES,WAC1B,IAAMrD,EAAiC,CACrCzC,KAAMuG,EAAam+B,wBACnBtmB,QAAS,CACP2kB,MAAM,EACNj5B,MAAO,YAGXuU,GAAU5b,MAsEN,eAACo6C,GAAD,WACE,sBAAK52C,UAAW,UAAhB,UACE,qBACEA,UAAS,iBAA+B,QAAnBu2C,EAA2B,SAAW,IAC3D12C,QAzBa,WACvB82C,EAAc,QAsBN,iBAOA,qBACE32C,UAAS,iBAA+B,UAAnBu2C,EAA6B,SAAW,IAC7D12C,QA7Be,WACzB82C,EAAc,UA0BN,mBAOA,qBACE32C,UAAS,iBACY,WAAnBu2C,EAA8B,SAAW,IAE3C12C,QAnCgB,WAC1B82C,EAAc,WA8BN,oBASA,qBACE32C,UAAS,iBAA+B,UAAnBu2C,EAA6B,SAAW,IAC7D12C,QAvCe,WACzB82C,EAAc,UAoCN,uBAQF,qBAAK32C,UAAW,UAAhB,SACGy2C,EAAgBt2C,KAAI,SAAC4K,EAAQnE,GAC5B,IAAKmE,EACH,OAAO,cAAC,IAAMi2B,SAAP,IAGT,IAAM6V,EAAS9rC,EAAO1P,aAAehD,EAAYsB,KAMjD,OACE,sBAAiBqG,UAAW,SAAUH,QANlB,WAChBg3C,GACFlxB,GAAoBymB,mBAAmBrhC,EAAQ,IAAK,MAItD,UACE,qBAAK/K,UAAW,OAAhB,SACG62C,EACC,qBACEnpC,IAAKiY,GAAoBymB,mBACvBrhC,EACA,GACA,MAIJ,cAAC,KAAD,CAAiBu0B,KAAM+W,SAG3B,qBAAKr2C,UAAW,OAAhB,SAAyB+K,EAAO1P,aAChC,sBAAK2E,UAAW,KAAhB,gBAA0B+K,EAAOvR,QAfzBoN,iBA0BpBgwC,GAAqBx2C,IAAOC,IAAV,66CC1UXy2C,GAA4B,WACvC,IAAMlzC,EAAcm9B,aAAY,SAACxhC,GAC/B,OAAOA,EAAM4D,GAAGS,eAElB,OACE,cAACmzC,GAAD,UACE,qBAAK/2C,UAAW,uBAAhB,UAC0B,IAAvB4D,EAAYP,OACX,mCAAyB,aAAtBO,EAAYC,MAAuB,cAAC,GAAD,IAAoB,OACxD,UAMCkzC,GAAoB32C,IAAOC,IAAV,oYAkBxB22C,GAA8B,WAWlC,OACE,cAACrB,GAAD,UACE,sBAAK31C,UAAW,kBAAhB,UACE,qBAAKA,UAAW,QAAhB,sBACA,mDACA,cAAC,GAAD,CAAaH,QAfU,WAC3B,IAAMrD,EAAiC,CACrCzC,KAAMuG,EAAam+B,wBACnBtmB,QAAS,CACP2kB,MAAM,EACNj5B,MAAO,aAGXuU,GAAU5b,YCnCDy6C,GAA0B,SAACh9C,GAAW,IAAD,EACpBmF,IAAMC,UAAS,GADK,mBACzCgE,EADyC,KACjC6zC,EADiC,KAE1CtzC,EAAcm9B,aAAY,SAACxhC,GAC/B,OAAOA,EAAM4D,GAAGS,eAEZE,EAAei9B,aAAY,SAACxhC,GAChC,OAAOA,EAAM4D,GAAGW,gBAsClB,OACE,cAACqzC,GAAD,UACE,sBAAKn3C,UAAS,6BAAwBqD,EAAS,OAAS,UAAxD,UACE,sBAAKrD,UAAW,UAAhB,UACE,qBACEA,UAAS,eACe,aAAtB4D,EAAYC,MAAuB,SAAW,YAEhDhE,QAzCkB,WAC1B,IAAMrD,EAAiC,CACrCzC,KAAMuG,EAAam+B,wBACnBtmB,QAAS,CACP2kB,MAAM,EACNj5B,MAAO,WACPk5B,QAAQ,IAGZ3kB,GAAU5b,IAkCF0iC,WAAA,WACAC,aAAY,MACZC,YAAW,OACXC,cAAa,QATf,SAWE,qBAAKr/B,UAAW,QAAhB,SACE,cAAC,KAAD,CAAiBs/B,KAAM8X,WAG3B,qBACEp3C,UAAS,eACgB,YAAvB8D,EAAaD,MAAsB,SAAW,YAEhDhE,QA7CiB,WACzB,IAAMrD,EAAiC,CACrCzC,KAAMuG,EAAam+B,wBACnBtmB,QAAS,CACP2kB,MAAM,EACNj5B,MAAO,UACPk5B,QAAQ,IAGZ3kB,GAAU5b,IAgCJ,SAME,qBAAKwD,UAAW,QAAhB,SACE,cAAC,KAAD,CACEs/B,KAAM+W,KAENnX,WAAA,iBACAC,aAAY,MACZC,YAAW,OACXC,cAAa,cAInB,qBACEr/B,UAAS,eACgB,YAAvB8D,EAAaD,MAAsB,SAAW,YAEhDhE,QAnDiB,WACzB,IAAMrD,EAAiC,CACrCzC,KAAMuG,EAAam+B,wBACnBtmB,QAAS,CACP2kB,MAAM,EACNj5B,MAAO,UACPk5B,QAAQ,IAGZ3kB,GAAU5b,IAsCJ,SAME,qBAAKwD,UAAW,QAAhB,SACE,cAAC,KAAD,CACEs/B,KAAM+X,KAENnY,WAAA,UACAC,aAAY,MACZC,YAAW,OACXC,cAAa,iBAKrB,qBAAKr/B,UAAW,cAAeH,QA1FnB,WAChBq3C,GAAW7zC,IAyFP,SACE,qBAAKrD,UAAW,QAAhB,SACE,cAAC,KAAD,CACEs/B,KAAMj8B,EAASi0C,KAAoBC,iBASpCJ,GAAkB/2C,IAAOC,IAAV,yyCC1Gfm3C,GAAoC,WAC/C,IAAMp0C,EAAsB29B,aAAY,SAACxhC,GACvC,OAAOA,EAAM4D,GAAGC,uBAGlB,OAAKA,GAG8B,IAA/BA,EAAoBC,OACf,cAAC,IAAM29B,SAAP,IAEF,cAAC,GAAD,CAAS59B,oBAAqBA,IAL5B,cAAC,IAAM49B,SAAP,KAQLyW,GAED,SAACx9C,GAAW,IAAD,kBACRy9C,EAAct4C,IAAM+gC,OAA8B,MAD1C,EAEI/gC,IAAMC,SAAN,oBAAepF,EAAMmJ,2BAArB,aAAe,EAA2BK,SAA1C,QAA+C,IAFnD,mBAEPA,EAFO,KAEJk0C,EAFI,OAGkBv4C,IAAMC,SAAN,oBAC9BpF,EAAMmJ,2BADwB,aAC9B,EAA2BI,gBADG,QACS,IAJ3B,mBAGPA,EAHO,KAGGo0C,EAHH,OAMYx4C,IAAMC,SAAN,oBACxBpF,EAAMmJ,2BADkB,aACxB,EAA2BtI,aADH,QACY,IAPxB,mBAMPA,EANO,KAMA+8C,EANA,OAWgCz4C,IAAMC,SAAN,oBAC5CpF,EAAMmJ,2BADsC,aAC5C,EAA2BG,uBADiB,UAXhC,mBAWPA,EAXO,KAWUu0C,EAXV,OAcgB14C,IAAMC,cAA8B9D,GAdpD,mBAcPoJ,EAdO,KAcEozC,EAdF,OAeY34C,IAAMC,cAA6B9D,GAf/C,mBAePO,EAfO,KAeAk8C,EAfA,OAgBU54C,IAAMC,SAAN,UACtBpF,EAAMmJ,oBAAoBM,sBADJ,QACsB,IAjBhC,mBAgBPhE,EAhBO,KAgBDu4C,EAhBC,KAoBRvG,EAAgB,WACpB,IAAMtvC,EAAQ0C,KACRE,EAAW0c,mBAAQtf,GAAO,SAACuf,GAC3BA,EAAMxe,GAAGC,sBACXue,EAAMxe,GAAGC,oBAAoBC,QAAS,EACtCse,EAAMxe,GAAGC,oBAAoBK,EAAIA,EACjCke,EAAMxe,GAAGC,oBAAoBI,SAAWA,EACxCme,EAAMxe,GAAGC,oBAAoBtI,MAAQA,EACrC6mB,EAAMxe,GAAGC,oBAAoBG,gBAAkBA,GAE7Cm0C,GAAeA,EAAYrX,UAC7B1e,EAAMxe,GAAGC,oBAAoBO,eAC3B+zC,EAAYrX,QAAQ6X,cAG1BnzC,GAASC,GACTwW,GAAkBxW,IAEdmzC,EAAgB,SAACC,EAAaC,EAAoBC,IACtC,IAAZ3zC,IAGJozC,GAAW,G1E8BkB,SAC/Bt0C,EACAD,EACA1I,GAIA,OAAO,IAAIsC,SAAQ,SAACC,EAASzB,GAC3B,IAAM28C,EAAc,IAAIC,gBAUxB,YATUj9C,IAANkI,GAAmBA,EAAEnH,OAAS,GAChCi8C,EAAYE,OAAO,IAAKh1C,QAETlI,IAAbiI,GAA0BA,EAASlH,OAAS,GAC9Ci8C,EAAYE,OAAO,WAAYj1C,QAEnBjI,IAAVT,GAAuBA,EAAMwB,OAAS,GACxCi8C,EAAYE,OAAO,iBAAkB39C,GAEhCwC,MAAMlE,EAAU,0BAA4Bm/C,EAAY7wB,WAAY,CACzEnqB,OAAQ,MACR9B,YAEC+B,MAAK,SAACC,GAAD,OAASA,EAAIC,UAClBF,MAAK,SAACG,GACDA,EAASC,YAAsC,MAAxBD,EAASC,YAClChC,EAAO+B,EAASE,SAElB,IAAI2T,EAA+C,GAEjD7T,GACAA,EAAS+6C,eACT/6C,EAAS+6C,cAAcp8C,OAAS,IAEhCkV,GAAS,OAAC7T,QAAD,IAACA,OAAD,EAACA,EAAU+6C,eAAiCv4C,KAAI,SAAC6yC,GACxD,IAAI14C,OAA8BiB,EAEhCy3C,GACAA,EAAKtzC,MACLszC,EAAKtzC,KAAKi5C,eACV3F,EAAKtzC,KAAKi5C,cAAcC,YAGgB,yBAAtC5F,EAAKtzC,KAAKi5C,cAAcC,YAExBt+C,EAAOrC,EAAU2d,kBAEuB,uBAAtCo9B,EAAKtzC,KAAKi5C,cAAcC,YAC1Bt+C,EAAOrC,EAAUsC,gBAGqB,0BAAtCy4C,EAAKtzC,KAAKi5C,cAAcC,YAExBt+C,EAAOrC,EAAU0d,oBAnB4C,MAsBhCq9B,EAAKtzC,KAAKi5C,cAAnC59C,EAtByD,EAsBzDA,OAAQC,EAtBiD,EAsBjDA,MAAOC,EAtB0C,EAsB1CA,MACjB49C,EAAS,SAAC5rC,GACd,YAAc1R,IAAV0R,GAAiC,OAAVA,GAA2B,IAATA,EACpC,EAEFA,EAAMuS,SAAS,KAClBpB,OAAOnR,EAAM6rC,WAAW,IAAK,MAC7B16B,OAAOnR,IAEb,MAAO,CACLpT,KAAMG,EAAU,CACdR,GAAIw5C,EAAKtzC,KAAKlG,GACdsB,MAAOk4C,EAAKtzC,KAAKq5C,WAAWtN,IAC5BnxC,OACAS,OAAQ89C,EAAO99C,GACfC,MAAO69C,EAAO79C,GACdC,MAAO49C,EAAO59C,KAEhB+3C,YAIN31C,EAAQ,CACNM,SAAU6T,OAGbzT,OAAM,SAACpC,GAAD,OAASD,EAAYC,EAAKC,S0E9GnCo9C,CAAiB,OAACZ,QAAD,IAACA,IAAM30C,EAAP,OAAU40C,QAAV,IAAUA,IAAa70C,EAAvB,OAAiC80C,QAAjC,IAAiCA,IAAUx9C,GACzD0C,MAAK,YAAmB,IAAhBG,EAAe,EAAfA,SACPs6C,EAAQt6C,GACRo6C,OAAWx8C,GACXy8C,OAASz8C,MAEVwC,OAAM,SAACpC,GACNo8C,OAAWx8C,GACXy8C,EAASr8C,QA2ETs9C,EAAgB,SAACb,EAAaC,EAAoBC,GACtDH,EAAcC,EAAIC,EAAWC,IAczBY,EAAsB,SAACpT,GACvBtiC,IAAasiC,GACf8R,EAAY,IACZqB,EAAcx1C,EAAGqiC,EAAQhrC,KAEzB88C,EAAY9R,GACZmT,EAAcx1C,EAAGqiC,EAAQhrC,KAIvBq+C,EAA2B,SAACrT,GAC5BhrC,IAAUgrC,GACZ+R,EAAS,IACToB,EAAcx1C,EAAGD,EAAUsiC,KAE3B+R,EAAS/R,GACTmT,EAAcx1C,EAAGD,EAAUsiC,KAI/B,OACE,cAACsT,GAAD,UACE,sBAAKp5C,UAAW,8BAAhB,UACE,qBACEA,UAAW,sCACXH,QAAS6xC,EAFX,kBAMA,qBAAK1xC,UAAW,8CAAhB,SACE,sBAAKA,UAAW,sCAAhB,UACE,qBAAKA,UAAW,aAAcH,QAAS6xC,EAAvC,SACE,cAAC,KAAD,CAAiBpS,KAAMU,KAASllC,MAAO,WAIzC,sBAAKkF,UAAU,iBAAf,UACE,sBAAKA,UAAU,wBAAf,UACE,sBAAKA,UAAW,oBAAhB,UACE,uBACEjG,KAAM,IACNiG,UAAW,QACXq5C,YAAa,mBACbC,aAAc,MACdC,WAAY,SAAC/8C,GACO,UAAdA,EAAM06B,KACR+hB,KAGJhsC,MAAOxJ,EACPulC,SAAU,SAACxsC,GACTm7C,EAAKn7C,EAAM2oC,OAAOl4B,UAIrBxJ,EAAEnH,OAAS,EACV,qBAAK0D,UAAW,cAAeH,QA1F3B,WACpB83C,EAAK,IACLsB,EAAc,KAwFE,SACE,cAAC,KAAD,CAAiB3Z,KAAMU,SAEvB,QAEN,wBAAQngC,QAhFA,WACpBo5C,KA+EY,SACE,cAAC,KAAD,CAAiB3Z,KAAMQ,SAEzB,yBAAQjgC,QAvJC,WACrBi4C,GAAoBv0C,IAsJR,iBACO,IACL,cAAC,KAAD,CACE+7B,MACsB,IAApB/7B,EAA2Bi2C,KAAc3Z,cAM5B,IAApBt8B,EACC,sBAAKvD,UAAU,cAAf,UACE,8BACE,sBAAKA,UAAW,+BAAhB,UACE,cAAC,GAAD,CACE8lC,OAAQ,SACR2F,IAAK,QACL5rC,QAASs5C,EACT13B,WAAsB,WAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,YACR2F,IAAK,OACL5rC,QAASs5C,EACT13B,WAAsB,cAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,aACR2F,IAAK,QACL5rC,QAASs5C,EACT13B,WAAsB,eAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,UACR2F,IAAK,QACL5rC,QAASs5C,EACT13B,WAAsB,YAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,WACR2F,IAAK,MACL5rC,QAASs5C,EACT13B,WAAsB,aAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,oBACR2F,IAAK,SACL5rC,QAASs5C,EACT13B,WAAsB,sBAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,QACR2F,IAAK,OACL5rC,QAASs5C,EACT13B,WAAsB,UAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,UACR2F,IAAK,QACL5rC,QAASs5C,EACT13B,WAAsB,YAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,YACR2F,IAAK,SACL5rC,QAASs5C,EACT13B,WAAsB,cAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,aACR2F,IAAK,OACL5rC,QAASs5C,EACT13B,WAAsB,eAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,iBACR2F,IAAK,OACL5rC,QAASs5C,EACT13B,WAAsB,mBAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,qBACR2F,IAAK,SACL5rC,QAASs5C,EACT13B,WAAsB,uBAAV3mB,IAEd,cAAC,GAAD,CACEgrC,OAAQ,UACR2F,IAAK,OACL5rC,QAASs5C,EACT13B,WAAsB,YAAV3mB,IAGbA,EAAMwB,OAAS,EACd,qBACE0D,UAAW,cACXH,QAxLE,WACxBg4C,EAAS,IACToB,OAAc19C,OAAWA,EAAW,KAoLhB,SAIE,cAAC,KAAD,CAAiB+jC,KAAMU,SAEvB,UAIR,sBAAKhgC,UAAW,yBAAhB,UACE,cAAC,GAAD,CACEutC,MAAO,OACPtgC,MAAO,OACPwU,WAAyB,SAAbje,EACZ3D,QAASq5C,IAEX,cAAC,GAAD,CACE3L,MAAO,SACPtgC,MAAO,SACPwU,WAAyB,WAAbje,EACZ3D,QAASq5C,IAEX,cAAC,GAAD,CACE3L,MAAO,aACPtgC,MAAO,aACPpN,QAASq5C,EACTz3B,WAAyB,eAAbje,IAGbA,EAASlH,OAAS,EACjB,qBACE0D,UAAW,cACXH,QA5NO,WAC3B+3C,EAAY,IACZqB,OAAc19C,EAAW,KAwNP,SAIE,cAAC,KAAD,CAAiB+jC,KAAMU,SAEvB,WAGN,QAEN,sBAAKhgC,UAAW,kBAAhB,UACG2E,EAAU,6CAAwB,KAClC7I,EAAQ,0CAAaA,KAAe,KACpC4D,EACC,qBAAKM,UAAW,WAAYogC,IAAKsX,EAAjC,SACGh4C,EAAKS,KAAI,SAAC6yC,GAIT,OACE,sBAEEhzC,UAAW,OACXH,QAPY,YAlSV,SAACmzC,GACvB,IAAM5wC,EAAQ0C,KACRE,EAAW0c,mBAAQtf,GAAO,SAACuf,GAC3BA,EAAMxe,GAAGC,sBACXue,EAAMxe,GAAGC,oBAAoBC,QAAS,EACtCse,EAAMxe,GAAGC,oBAAoBK,EAAIA,EACjCke,EAAMxe,GAAGC,oBAAoBI,SAAWA,EACxCme,EAAMxe,GAAGC,oBAAoBtI,MAAQA,EACrC6mB,EAAMxe,GAAGC,oBAAoBG,gBAAkBA,EAC3C7D,IACFiiB,EAAMxe,GAAGC,oBAAoBM,eAAiBhE,GAE5Cg4C,GAAeA,EAAYrX,UAC7B1e,EAAMxe,GAAGC,oBAAoBO,eAC3B+zC,EAAYrX,QAAQ6X,eAI5BnzC,GAASC,GACTwW,GAAkBxW,GAClBoT,GAAU,CACRre,KAAMuG,EAAasiB,sBACnBzK,QAAS,CACPhb,QAAS6H,EAASrC,YACf2G,QAAO,SAAC9P,GACP,QAAKwL,EAAStC,QAAQlJ,IAGlBwL,EAAStC,QAAQlJ,GAAI6B,aAAehD,EAAYsB,QAKrDwG,KAAI,SAAC3G,GAAQ,IAAD,EAC6Cw5C,EAAKn5C,KAC7D,MAAO,CACLL,KACAmpB,WAAY,CACV5nB,OALO,EACHA,OAKJC,MANO,EACKA,MAMZC,MAPO,EACYA,MAOnBX,KARO,EACmBA,KAQ1BQ,MATO,EACyBA,MAShCN,SAVO,EACgCA,iBAiQjCi/C,CAAgBzG,IAGhB,UAKE,qBAAKhzC,UAAW,MAAhB,SACE,qBACE0N,IAAKiY,GAAoBymB,mBACvB4G,EAAKn5C,KACL,IACA,SAIN,6BAAKm5C,EAAKA,KAAK0G,iBAbV1G,EAAKA,KAAK2G,wBAkBrB,mBASZC,GAKD,SAAC3/C,GAIJ,OACE,qBACE+F,UAAS,6BAAwB/F,EAAMwnB,WAAa,WAAa,IACjE5hB,QANY,WACd5F,EAAM4F,QAAQ5F,EAAMgT,QAGpB,SAIGhT,EAAMszC,SAKPsM,GAKD,SAAC5/C,GAIJ,OACE,qBACE+F,UAAS,mCACP/F,EAAMwnB,WAAa,WAAa,IAElC5hB,QARY,WACd5F,EAAM4F,QAAQ5F,EAAM6rC,SAQlBzsB,MAAO,CAAEygC,gBAAiB7/C,EAAMwxC,KALlC,mBAYS2N,GAA4Bh5C,IAAOC,IAAV,wwKCxbzB05C,GAAc,WACzB,IAAMC,EAAkBjZ,aAAY,SAACxhC,GACnC,OAAOA,EAAM4D,GAAGS,YAAYP,UAExB42C,EAAmBlZ,aAAY,SAACxhC,GACpC,OAAOA,EAAM4D,GAAGW,aAAaT,UAG/B,OACE,gCACE,cAAC,KAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC62C,GAAD,UACE,sBACEl6C,UAAS,4BACPg6C,EAAkB,oBAAsB,GADjC,wBAEPC,EAAmB,qBAAuB,IAH9C,UAKE,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IAEA,cAAC,GAAD,aAOJC,GAAmB95C,IAAOC,IAAV,8zDA4EhB85C,GAA4B,WAKhC,OAAgB,IAJApZ,aAAY,SAACxhC,GAC3B,OAAOA,EAAM4D,GAAGuB,aAAaC,WAItB,qBAAKzE,YAAW,uBAIvB,qBAAKF,UAAW,gBAAiBE,YAAW,eAA5C,SACE,cAAC,KAAD,CAAiBo/B,KAAM8a,UClIhBC,GAAiB,SAC5B7gD,GAEA,OACS,IAAI4D,QADF,KAAP5D,EACiB,SAAC6D,EAASzB,GAC3ByB,EAAQ,CACNyC,MAAO,CAAE/F,KAAM,MAAOgG,KAAM,IAC5B2C,QAAS,MAKJ,SAAPlJ,EACiB,SAAC6D,EAASzB,GAC3B0+C,KAAqB98C,MAAK,SAACG,GACzBN,EAAQM,OAKK,SAACN,EAASzB,I5EeL,SACxBpC,GAEA,OAAO,IAAI4D,SAAQ,SAACC,EAASzB,GAC3B,OAAO0B,MAAMlE,EAAU,kBAAoBI,EAAI,CAC7C+D,OAAQ,MACR9B,YAEC+B,MAAK,SAACC,GAAD,OAASA,EAAIC,UAClBF,MAAK,SAACG,GACDA,EAASC,YAAsC,MAAxBD,EAASC,YAClChC,EAAO+B,EAASE,SAGlBR,EAAQ,CACNyC,MAAOnC,EAASmC,MAChB4C,QAASkN,OAAO2Q,KAAK5iB,EAAS+E,SAASvC,KACrC,SAAC+2B,GAAD,OAASv5B,EAAS+E,QAAQw0B,WAI/Bn5B,OAAM,SAACpC,GAAD,OAASD,EAAYC,EAAKC,U4EnCnC2+C,CAAW/gD,GACRgE,MAAK,SAACG,GACLN,EAAQM,MAETI,OAAM,SAACpC,GAAD,OAASC,EAAOD,SAIhB2+C,GAAqB,WAIhC,OAAO,IAAIl9C,SAAQ,SAACC,EAASzB,GAC3B,IAAM8G,EAAU,GACViS,EAAOY,GAAyBtd,EAAUyd,aAI5Cf,IACMxN,KAAK4Q,IAAIpD,EAAK7M,IAAIjP,EAAI8b,EAAK/M,IAAI/O,GAC9BsO,KAAK4Q,IAAIpD,EAAK7M,IAAIhP,EAAI6b,EAAK/M,IAAI9O,GAChCqO,KAAK4Q,IAAIpD,EAAK7M,IAAI/O,EAAI4b,EAAK/M,IAAI7O,IA6EzCsE,EAAQ,CACNyC,MAAO,CACLC,KAAM,MACNhG,KAAM,mBAER2I,QAASkN,OAAO2Q,KAAK7d,GAASvC,KAAI,SAAC3G,GACjC,OAAOkJ,EAAQlJ,YCzGVghD,GAAe,SAAChhD,GAC3B,OAAO6gD,GAAe7gD,GAAIgE,MAAK,SAACkC,GAC9B,OAAO,IAAItC,SAAQ,SAACC,EAASzB,GAC3B,IAAMqJ,EAAiBE,KACjBD,EAAeE,KAEjBH,GACFssB,KAGF,IAAMnvB,EAAQ0C,KAERE,EAAW0c,mBAAQtf,GAAO,SAACuf,GAAW,IAAD,QACzCA,EAAM7hB,MAAQ+E,oBAAUD,GAAW9E,OACnC6hB,EAAMziB,QAAU2F,oBAAUD,GAAW1F,SACrCyiB,EAAMjf,QAAUmC,oBAAUD,GAAWlC,SACrCif,EAAMhf,YAAckC,oBAAUD,GAAWjC,aACzCgf,EAAMxe,GAAK0B,oBAAUD,GAAWzB,SAEX5H,IAAjBmE,EAAKgD,SAAyBhD,EAAKgD,QAAQpG,OAAS,GACtDoD,EAAKgD,QAAQnG,SAAQ,SAACwO,GACpB4W,EAAMjf,QAAQqI,EAAOvR,IAAMuR,KAI/B4W,EAAM7hB,MAAM/F,KAAZ,oBAAmB2F,EAAKI,aAAxB,aAAmB,EAAY/F,YAA/B,QAAuC,GACvC4nB,EAAM7hB,MAAMC,KAAZ,oBAAmBL,EAAKI,aAAxB,aAAmB,EAAYC,YAA/B,QAAuC,GACvC4hB,EAAM7hB,MAAMgD,SAAU,EACtB6e,EAAMxe,GAAGuB,aAAaC,SAAU,KAGlCI,GAASC,GAELC,GACF7C,EAAMe,GAAGe,OAAO3H,SAAQ,SAAC2zB,GACvBnH,GAAemH,EAAO/a,GAASkC,UAI/BpS,GACE7C,EAAMe,GAAGiB,MtCqsBQ,SAACotB,GAC5B,IAAM5oB,EAAO,IACPxE,EAAO,IAAIjK,IAAiB,EAAGyO,IAAW,UAAW,QAC3DxE,EAAK/J,SAASxB,EAAI,EAClBuL,EAAK/J,SAASvB,EAAI,EAClBsL,EAAK/J,SAAStB,GAAK,IACnBqL,EAAK2nB,MAAMlzB,EAAI+P,EACfxE,EAAK2nB,MAAMjzB,EAAI8P,EACfxE,EAAK2nB,MAAMhzB,EAAI6P,EAEfxE,EAAKqmB,SAAS5xB,EAA8B,GAA1BsB,IAAgB6xB,QAClC5nB,EAAKqmB,SAAS3xB,EAA8B,EAA1BqB,IAAgB6xB,QAClC5nB,EAAKqmB,SAAS1xB,EAA8B,EAA1BoB,IAAgB6xB,QAClC5nB,EAAKqT,SAAW3d,gBAAM,GAAI03B,EAAQ,CAChCn2B,WAAYhD,EAAYi5B,oBACxBv3B,KAAK,GAAD,OAAK1B,EAAYi5B,qBAAjB,OAAuC54B,GAAvC,OAAwD84B,EAAOh4B,MAErE2b,GAASkC,MAAM/C,IAAIlQ,GsCrtBXq2C,CAAcr4C,EAAMe,GAAGiB,MAIvBa,GACF2K,OAAO2Q,KAAKvb,EAAStC,SAASnG,SAAQ,SAAC/C,GACrCi4B,GAAsBzsB,EAAStC,QAAQlJ,OAIvC0L,GACFsW,GAAkBxW,GAKpB01C,KACAr9C,OAAQ9B,UAqLDm/C,GAAc,WACzB,IAAMC,EAAQ3gD,EAAU,CACtBR,GAAI,QACJsB,MAAO,MACPT,SAAU,CACRxB,EAAG,EACHC,EAAG,KAOD8hD,EAAQ5gD,EAAU,CACtBR,GAAI,QACJsB,MAAO,QACPT,SAAU,CACRxB,EAAG,GACHC,EAAG,KAGD+hD,EAAQ7gD,EAAU,CACtBR,GAAI,QACJsB,MAAO,OACPT,SAAU,CACRxB,EAAG,IACHC,EAAG,KAIDgiD,EAAU1yC,GAAY,CAC1B5O,GAAI,UACJa,SAAU,CACRxB,EAAG,IACHC,EAAG,KAELkC,MAAO,IACPD,OAAQ,IACR0L,QAAS,EACTC,KAAM,IAGFq0C,EAAU3yC,GAAY,CAC1B5O,GAAI,UACJa,SAAU,CACRxB,EAAG,IACHC,EAAG,KAELkC,MAAO,IACPD,OAAQ,IACR0L,QAAS,EACTC,KAAM,IAER0R,GAAU,CACRre,KAAMuG,EAAa4X,WACnBC,QAAS,CACPzV,QAAS,CAACi4C,EAAOC,EAAOC,EAAOC,EAASC,OC3TjCC,GAAU,SACrBj7C,EACAL,EACAypB,EACAC,IzCW2B,SAC3BtS,EACAqS,EACAC,GAEA,OAAOF,GAAcpS,EAAIqS,EAAQC,IyCdjC6xB,MACa1/C,IAAX4tB,EAAuBhQ,SAAS+hC,eAAe,WAAc/xB,EAC7DA,EACAC,GACA5rB,MAAK,WACLg9C,GAAaz6C,GAEA,SAATA,IAAwC,IAArBL,EAAKC,c9E2P9B5D,GAAiB,EACjB1C,E8E3PoB0G,E9E4PpB/D,GAAoB,IAAIC,MAAOC,e8EvPpBi/C,GAAQ,SACnBp7C,EACAL,EACAypB,EACAC,GzCA4B,IAACtS,ErCuQ7B/a,GAAiB,OACGR,IAAhBlC,IACFA,OAAckC,GAKZY,EAAkBG,OAAS,IAC7BH,EAAoB,I6ElNf,IAAIiB,SAAc,SAACC,GACxBk0B,KACA,IAAMnvB,EAAQ0C,KACRE,EAAW0c,mBAAQtf,GAAO,SAACuf,GACvB9c,oBAAUD,OAGpB4W,GAAkBxW,GAClB3H,YxCpES9B,KADkBub,OyCKhBvb,IAAX4tB,EAAuBhQ,SAAS+hC,eAAe,WAAc/xB,IzCJhC,OAAPrS,IACtBA,EAAGskC,UAAY,GAEXtkC,EAAGuS,YAAiD,IAApCvS,EAAGuS,UAAUC,SAAS,WACxCxS,EAAGuS,UAAU+C,OAAO,WAGjB,IAAIhvB,SAAQ,SAACC,GAClBA,OAAQ9B,OyCAC8/C,GAIR,SAACphD,GAAW,IACT8F,EAASu7C,cAATv7C,KASN,OAPAX,IAAMK,WAAU,WAEd,OADAu7C,GAAQj7C,EAAM9F,EAAMyF,KAAMzF,EAAMkvB,OAAQlvB,EAAMmvB,SACvC,WACL+xB,GAAMp7C,EAAM9F,EAAMyF,KAAMzF,EAAMkvB,OAAQlvB,EAAMmvB,YAE7C,IAGD,qBAAKppB,UAAU,MAAf,SACE,cAAC,IAAD,CAAUoC,MAAOiU,GAAjB,SACE,cAAC,GAAD,S,SCvDFklC,GAAsB,CAC1BC,cAAc,EACd97C,UAAMnE,GAGKkgD,GAAcC,aAAoD,CAC7En8C,MAAOg8C,GACP9/B,SAAU,kBAAM,QAgBZkgC,GAAU,SAACp8C,EAAc8b,GAC7B,OAAQA,EAAO/gB,MACb,IAAK,SACH,MAAO,CACLkhD,cAAc,EACd97C,UAAMnE,GAEV,QACE,OAAOgE,IC5BAq8C,GAER,WACH,IAAMngC,EAAWogC,aAAmBJ,IAAa,SAACK,GAAD,OAASA,EAAIrgC,YACxDvc,EAAUC,cAchB,OACE,cAAC,GAAD,UACE,gCACE,yCACA,wBACEU,QARc,WACpBX,EAAQzC,KAAK,YAQPuD,UAAW,YACXE,YAAW,SAHb,oBAOA,wBACEL,QAzBc,WACpBqc,OAAO6/B,aAAaC,WAAW,iBAC/Bza,YAAW,WACTrlB,OAAO+/B,SAAS7J,KAAO,IACvB32B,EAAS,CACPnhB,KAAM,aAGP,KAkBG0F,UAAW,YACXE,YAAW,SAHb,0BAYFN,GAAaQ,IAAOC,IAAV,64BC9CH67C,GAAuC,SAACjiD,GACnD,OAAO,iDCFIkiD,GAA4C,SAACliD,GACxD,OAAO,iDCCHmiD,GAAavU,YAAH,4xGAmOVwU,GAAiBxU,YAAH,g+EAqJdyU,GAAezU,YAAH,+xBAgCL0U,GAAW1U,YAAH,yOAKR2U,GAAkBC,YAAH,wDACtBH,GACAF,GACAC,IC3XAK,GAED,SAACziD,GACJ,IAAMuhD,EAAeK,aACnBJ,IACA,SAACK,GAAD,OAASA,EAAIv8C,MAAMi8C,gBAErB,OACE,cAAC,IAAD,CAAQmB,SAAU,QAAlB,SACGnB,EACC,eAAC,IAAD,WACE,cAAC,IAAD,CAAOoB,OAAK,EAACpsC,KAAK,IAAlB,SACE,cAAC,GAAD,CAAU9Q,KAAMzF,EAAMyF,SAExB,cAAC,IAAD,CAAOk9C,OAAK,EAACpsC,KAAK,UAAlB,SACE,cAAC,EAAD,CAAY9Q,KAAMzF,EAAMyF,SAE1B,cAAC,IAAD,CAAOk9C,OAAK,EAACpsC,KAAK,eAAlB,SACE,cAAC,GAAD,CACE9Q,KAAMzF,EAAMyF,KACZypB,YAAQ5tB,EACR6tB,aAAS7tB,MAGb,cAAC,IAAD,CAAOiV,KAAK,IAAZ,SACE,cAAC,GAAD,CAAa9Q,KAAMzF,EAAMyF,YAI7B,eAAC,IAAD,WACE,cAAC,IAAD,CAAOk9C,OAAK,EAACpsC,KAAK,IAAlB,SACE,cAAC,GAAD,CAAkB9Q,KAAMzF,EAAMyF,SAEhC,cAAC,IAAD,CAAO8Q,KAAK,IAAZ,SACE,cAAC,GAAD,CAAa9Q,KAAMzF,EAAMyF,eAQtBm9C,GAjEV,SAAC5iD,GAAW,IAAD,IACdsI,GAAW,kBACX,ILoBuBu6C,EKpBjBtB,GAAe,oBAACvhD,EAAMyF,YAAP,aAAC,EAAYq9C,aAAb,QAAsB,IAAIzgD,OAAS,EAF1C,GLsBSwgD,GKlBJ,IAAjBtB,EACI,CACEA,cAAc,EACd97C,KAAMzF,EAAMyF,MAEd,CACE87C,cAAc,EACd97C,UAAMnE,GLYP6D,IAAM49C,WAAWrB,GAASmB,IKvBnB,mBAGPv9C,EAHO,KAGAkc,EAHA,KAcd,OACE,eAACggC,GAAYwB,SAAb,CAAsBhwC,MAAO,CAAE1N,QAAOkc,YAAtC,UACE,cAAC+gC,GAAD,IACA,gCAAQD,KACR,cAAC,GAAD,CAAQ78C,KAAMzF,EAAMyF,W,UC1B1B7D,QAAQkB,IAAI,2BAA4BmgD,GAAYC,QAAS,QADtBC,OAEvC,IrFCkC19C,GqFD5B29C,GAAOlkC,SAAS+hC,eAAe,QACrC,GAAa,OAATmC,GAAe,CACjB,IAAMC,GAAUnkC,SAASC,cAAc,OACvCkkC,GAAQ7pC,aAAa,KAAM,WACvB4pC,GAAKE,YACPF,GAAKE,WAAWC,aAAaF,GAASD,GAAKI,aAG7C,IACE,IAAI/9C,GAYA,CACEtG,QAAS,GACTuG,aAAa,EACbo9C,MAAO,GACPW,KAAM,CACJC,SAAU,GACV59C,KAAM,KAGR69C,GAAOP,GAAKQ,aAAa,aAC/B,GAAID,GAAM,CACR,IAAME,GAAW7gD,KAAK6T,MAAM8sC,IAC5Bl+C,GAAO5F,gBAAM,GAAI4F,GAAMo+C,IrF/B3B1kD,GADgCsG,GqFkCZA,IrFjCLtG,QACfqC,EAAO,cAAoB,UAAYiE,GAAKq9C,MqFiC1CgB,IAAS/0B,OAAO,cAAC,GAAD,CAAKtpB,KAAMA,KAAU29C,IACrC,MAAO1hD,S","file":"static/js/main.bd9b445f.chunk.js","sourcesContent":["import { immerable } from \"immer\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { Store, StoreUiSettings } from \"../controllers/store\";\n\nexport interface Point {\n  x: number;\n  y: number;\n  z: number;\n  // [immerable]: boolean;\n}\n\nexport enum BeadTypes {\n  TOHO_MIYUKI = \"TOHO_MIYUKI\",\n  TOHO_15 = \"TOHO_15\",\n  TOHO_SPHERE = \"TOHO_SPHERE\",\n\n  MODEL_CYLINDER = \"MODEL_CYLINDER\",\n  MODEL_FIRE_POLISH = \"MODEL_FIRE_POLISH\",\n  MODEL_TOHO_ROUND = \"MODEL_TOHO_ROUND\",\n}\n\nexport interface AppObjectProps {\n  id: string;\n  position: Point;\n  width: number;\n  height: number;\n  depth: number;\n  rotateX: number;\n  rotateY: number;\n  rotateZ: number;\n  objectType: ObjectTypes;\n  isLocked: boolean;\n  canLockOrUnlock: boolean;\n}\n\nexport interface PreviewProject3D extends AppObjectProps {\n  color: string;\n}\n\nexport enum BeadMaterialTypes {\n  \"Shiny\" = \"Shiny\",\n  \"Mat\" = \"Mat\",\n}\n\nexport interface Bead extends AppObjectProps {\n  type: BeadTypes;\n  color: string;\n  material: BeadMaterialTypes;\n  lineRotate: number;\n  keepAspectRatio: boolean;\n  regionId: string | undefined;\n  groupId: string | undefined;\n}\n\nexport const groupIdKey: keyof Bead = \"groupId\";\n\nexport interface EditBBox {\n  id: string;\n  position: Point;\n  // [immerable]: boolean;\n  width: number;\n  height: number;\n  depth: number;\n  rotateX: number;\n  rotateY: number;\n  rotateZ: number;\n  editable: boolean;\n  selectedIds: {\n    id: string;\n    objectType: ObjectTypes;\n    groupId: string | undefined;\n  }[];\n  canLockOrUnlock: true;\n  isLocked: false;\n  objectType: ObjectTypes;\n  bbox?: THREE.Box3;\n}\n\nexport interface Line {\n  id: string;\n  start: Point;\n  end: Point;\n  beadIds: string[];\n  // [immerable]: boolean;\n  settings: {\n    beadsCount: number;\n    beadsAutoCount: boolean;\n    beadsSpacing: number;\n    beadsAutoSpacing: boolean;\n    defaultBead: Partial<Bead>;\n  };\n}\n\nexport enum RegionGridType {\n  Rectangles = \"Rectangles\",\n  Bricks = \"Bricks\",\n}\n\nexport enum RegionShape {\n  Rectangle = \"Rectangle\",\n  Triangle = \"Triangle\",\n  Circle = \"Circle\",\n}\n\nexport interface Region extends AppObjectProps {\n  beadIds: string[];\n  gridType: RegionGridType;\n  shape: RegionShape;\n  opacity: number;\n  columns: number;\n  rows: number;\n  autoFillBeads: boolean;\n  snapBeadsToCell: boolean;\n  childrenGridIds: (string | undefined)[];\n  // settings: {\n  // beadsCount: number;\n  // beadsAutoCount: boolean;\n  // beadsSpacing: number;\n  // beadsAutoSpacing: boolean;\n  // defaultBead: Partial<Bead>;\n  // };\n}\n\nexport interface Group extends AppObjectProps {\n  objectType: ObjectTypes;\n  childrenIds: string[];\n}\n\nexport interface AppData {\n  objects: { [s: string]: AppObject };\n  /**@deprecated */\n  beads: { [s: string]: Bead };\n  /**@deprecated */\n  lines: { [s: string]: Line };\n  /**@deprecated */\n  regions: { [s: string]: Region };\n}\n\nexport type AppObject = Bead | Region | Group | PreviewProject3D;\nexport type AppObjectKeys =\n  | keyof Bead\n  | keyof Region\n  | keyof Group\n  | keyof PreviewProject3D;\n\n// const dupa: MappedTypeWithNewProperties<AppObject> = {\n//   beadIds:\n// }\n\nexport enum ObjectTypes {\n  Bead = \"Bead\",\n  Region = \"Region\",\n  Group = \"Group\",\n  PreviewProject3D = \"PreviewProject3D\",\n  SceneEditBBox = \"SceneEditBBox\",\n  SceneBackgroundGrid = \"SceneBackgroundGrid\",\n  SceneLight = \"SceneLight\",\n}\nexport const NAME_SEPARATOR = \"__\";\n\nexport enum EditorMode {\n  Idle = \"Idle\",\n  EditLines = \"EditLines\",\n  AddLine = \"AddLine\",\n  SelectOrMove = \"SelectOrMove\",\n  SelectMultiple = \"SelectMultiple\",\n  AddBeads = \"AddBeads\",\n  DeleteBeads = \"DeleteBeads\",\n  PaintBeads = \"ColorPaint\",\n  AddRegion = \"AddRegion\",\n}\nexport enum EditorMenuMain {\n  None = \"None\",\n  File = \"File\",\n  Grid = \"Grid\",\n  Background = \"Background\",\n}\nexport enum EditorGridType {\n  Hex = \"Hex\",\n  Box = \"Box\",\n}\nexport enum BrushType {\n  Color = \"Color\",\n}\nexport interface ThreeLightConfig {\n  id: string;\n  type: \"THREE.DirectionalLight\" | \"THREE.AmbientLight\";\n  name: string;\n  color?: string | number | THREE.Color | undefined;\n  intensity?: number | undefined;\n  position?: {\n    x: number;\n    y: number;\n    z: number;\n  };\n}\n\nexport interface ThreeGridHelperConfig {\n  id: string;\n  type: EditorGridType;\n  hexSize: number;\n  snapEnabled: boolean;\n  isVisible: boolean;\n  width: number;\n  height: number;\n}\n\n// export interface EditorUi {\n//   mode: EditorMode;\n//   lights: ThreeLightConfig[];\n//   zoomScale: number;\n//   lineSettings: DeepPartial<Line>;\n//   saveInfo: {\n//     saved: boolean;\n//     haveUnsavedChanges: boolean;\n//   };\n//   /**@deprecated */\n//   selectedLinesIds: { [s: string]: boolean };\n//   /**@deprecated */\n//   selectedLinesIdsCount: number;\n//   /**@deprecated */\n//   selectedBeadsIds: { [s: string]: boolean };\n//   /**@deprecated */\n//   selectedBeadsIdsCount: number;\n//   /**@deprecated */\n//   selectedRegionsIds: { [s: string]: boolean };\n//   /**@deprecated */\n//   selectedRegionsIdsCount: number;\n//   selectedIds: string[];\n//   selectedIdsAsKeys: { [s: string]: boolean };\n//   selectedIdsCount: number;\n//   selectedTopBarPosition: THREE.Vector3 | undefined;\n//   editBBox: EditBBox | undefined;\n//   mouseSelection: {\n//     start: Point;\n//     end: Point;\n//     isDragStarted: boolean;\n//     isDragged: boolean;\n//   };\n//   currentMenuMainOpen: EditorMenuMain;\n//   grid: ThreeGridHelperConfig;\n//   currentBeadChain: {\n//     isDragEnabled: boolean;\n//     beadIds: string[];\n//   };\n//   beadsTemplate: {\n//     width: number;\n//     height: number;\n//     depth: number;\n//     type: BeadTypes;\n//     color: string;\n//     rotateX: number;\n//     rotateY: number;\n//     rotateZ: number;\n//     keepAspectRatio: boolean;\n//   };\n//   regionTemplate: {\n//     gridType: RegionGridType;\n//   };\n//   brush: {\n//     type: BrushType;\n//     size: number;\n//     color: string;\n//   };\n//   background: {\n//     image: {\n//       url: string;\n//       scale: number;\n//       position: Point;\n//       opacity: number;\n//     };\n//   };\n//   sceneWrapperWidth: number;\n//   sceneWrapperHeight: number;\n//   sceneWrapperPosition: {\n//     x: number;\n//     y: number;\n//     angle: number;\n//     scale: number;\n//     top: number;\n//     left: number;\n//   };\n// }\n\nexport interface Editor extends Store {\n  // appData: AppData;\n  // ui: StoreUiSettings;\n}\n","import { Point } from \"./Editor\";\nimport { immerable } from \"immer\";\n\nexport const buildPoint = (\n  x: number = 0,\n  y: number = 0,\n  z: number = 0\n): Point => {\n  return {\n    x,\n    y,\n    z,\n    // [immerable]: true,\n  } as Point;\n};\n\nexport const getLength = (point: Point) => {\n  return Math.sqrt(point.x * point.x + point.y * point.y);\n};\n\nexport const normalize = (point: Point) => {\n  const length = getLength(point);\n  const useLen = length === 0;\n  const x = useLen ? 0 : point.x / length;\n  const y = useLen ? 0 : point.y / length;\n  return buildPoint(x, y);\n};\n\nexport const scale = (point: Point, scalar: number) => {\n  return buildPoint(point.x * scalar, point.y * scalar);\n};\n\nexport const add = (point: Point, x: number, y: number) => {\n  return buildPoint(point.x + x, point.y + y);\n};\n\nexport const sub = (point: Point, x: number, y: number) => {\n  return buildPoint(point.x - x, point.y - y);\n};\n\nexport const getDistance = (x1, y1, x2, y2): number => {\n  return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n};\n\nexport const getDistanceBetweenPoints = (start: Point, end: Point): number => {\n  return Math.sqrt(\n    (end.x - start.x) * (end.x - start.x) +\n      (end.y - start.y) * (end.y - start.y)\n  );\n};\n\nexport const getRotate = (y, x) => {\n  return Math.atan2(y, x);\n};\n\nexport const contain = (p1: Point, p2: Point, p: Point): boolean => {\n  return p.x > p1.x && p.x < p2.x && p.y > p1.y && p.y < p2.y;\n};\n\nexport const toRadian = (radians: number) => {\n  return (radians / 180) * Math.PI;\n};\n\nexport const toDeg = (radians: number) => {\n  return (radians * 180) / Math.PI;\n};\n","import { immerable } from \"immer\";\nimport {\n  Bead,\n  BeadMaterialTypes,\n  BeadTypes,\n  NAME_SEPARATOR,\n  ObjectTypes,\n} from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport { defaulBeadColor } from \"../components/colors\";\nimport * as THREE from \"three\";\n\nexport enum BeadChildSuffix {\n  MAIN = \"MAIN\",\n  ANY = \"beadChildOf\",\n  SELECTION = \"SELECTION\",\n  SELECTION_CHILD = \"SELECTION_CHILD\",\n}\n\nexport const getThreeNameFromBeadId = (\n  id: string,\n  childSuffix: BeadChildSuffix = BeadChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.Bead}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getBeadIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.Bead) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromBead = (\n  bead: Bead,\n  childSuffix?: BeadChildSuffix\n) => {\n  return merge({}, bead, {\n    name: getThreeNameFromBeadId(bead.id, childSuffix),\n  });\n};\n\nlet index = 0;\nconst names = \"ABCDEFGHIJKLMNOPRSTQWYZ\";\n\nexport const buildBead = (props: DeepPartial<Bead>): Bead => {\n  // if (props.id === undefined && names[index] !== undefined) {\n  //   props.id = names[index];\n  //   index = index + 1;\n  // }\n  const defaults: Bead = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    type: BeadTypes.MODEL_CYLINDER,\n    material: BeadMaterialTypes.Mat,\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n    lineRotate: 0,\n    color: defaulBeadColor,\n    height: 10,\n    width: 10,\n    depth: 10,\n    keepAspectRatio: false,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.Bead,\n    // [immerable]: true,\n    groupId: undefined,\n    regionId: undefined,\n  };\n\n  return merge(defaults, props);\n};\n","import { debounce } from \"lodash\";\nimport { AppData } from \"./AppData\";\nimport { AppEvents, AppEventType } from \"./controllers/AppEventType\";\nimport { buildBead } from \"./editorObjects/Bead\";\nimport { AppObject, Bead, BeadTypes } from \"./editorObjects/Editor\";\n\nlet apiHost: string;\nlet headers: { [key: string]: any } = {\n  \"Content-Type\": \"application/json\",\n};\n\nexport const setApiFromAppData = (data: AppData) => {\n  apiHost = data.apiHost;\n  headers[\"Authorization\"] = \"Bearer \" + data.token;\n};\n\nconst handleError = (err: any, reject: any) => {\n  console.error(\"request error\", err);\n  reject(\"err\");\n};\n\nexport const prepareBoardsList = (): Promise<{\n  boards: {\n    uuid: string;\n    name: string;\n  }[];\n}> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/list\", {\n      method: \"GET\",\n      headers,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        resolve({\n          boards: response.boards,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nexport const fetchBoard = (\n  id: string\n): Promise<{ board: { uuid: string; name: string }; objects: AppObject[] }> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/one/\" + id, {\n      method: \"GET\",\n      headers,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        // console.log(\"co tam jest??\", response.objects);\n        resolve({\n          board: response.board,\n          objects: Object.keys(response.objects).map(\n            (key) => response.objects[key]\n          ),\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nexport interface BeadResponse {\n  display_name: string;\n  bead_product_uuid: string;\n  data: {\n    id: string;\n    internal_id: string;\n    bead_producer: {\n      uuid: string;\n      internal_id: string;\n      name: string;\n    };\n    bead_material: {\n      uuid: string;\n      internal_id: string;\n      display_name: string;\n    };\n    bead_geometry: {\n      uuid: string;\n      internal_id: string;\n      width: string;\n      height: string;\n      depth: string;\n      whole: string;\n      file_name: string;\n    };\n    bead_color: {\n      uuid: string;\n      internal_id: string;\n      display_name: string;\n      hex: string;\n    };\n    bead_color_category: {\n      uuid: string;\n      internal_id: string;\n      display_name: string;\n      hex: string;\n    };\n  };\n}\n\nexport const fetchBeadProducts = (\n  q?: string,\n  producer?: string,\n  color?: string\n): Promise<{\n  response: { bead: Bead; item: BeadResponse }[];\n}> => {\n  return new Promise((resolve, reject) => {\n    const queryString = new URLSearchParams();\n    if (q !== undefined && q.length > 0) {\n      queryString.append(\"q\", q);\n    }\n    if (producer !== undefined && producer.length > 0) {\n      queryString.append(\"producer\", producer);\n    }\n    if (color !== undefined && color.length > 0) {\n      queryString.append(\"color_category\", color);\n    }\n    return fetch(apiHost + \"api/bead_products/list?\" + queryString.toString(), {\n      method: \"GET\",\n      headers,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        let result: { bead: Bead; item: BeadResponse }[] = [];\n        if (\n          response &&\n          response.bead_products &&\n          response.bead_products.length > 0\n        ) {\n          result = (response?.bead_products as BeadResponse[]).map((item) => {\n            let type: BeadTypes | undefined = undefined;\n            if (\n              item &&\n              item.data &&\n              item.data.bead_geometry &&\n              item.data.bead_geometry.file_name\n            ) {\n              if (\n                item.data.bead_geometry.file_name === \"model_toho_round.obj\"\n              ) {\n                type = BeadTypes.MODEL_TOHO_ROUND;\n              }\n              if (item.data.bead_geometry.file_name === \"model_cylinder.obj\") {\n                type = BeadTypes.MODEL_CYLINDER;\n              }\n              if (\n                item.data.bead_geometry.file_name === \"model_fire_polish.obj\"\n              ) {\n                type = BeadTypes.MODEL_FIRE_POLISH;\n              }\n            }\n            const { height, width, depth } = item.data.bead_geometry;\n            const getNum = (value) => {\n              if (value === undefined || value === null || value == \"\") {\n                return 1;\n              }\n              return value.includes(\",\")\n                ? Number(value.replaceAll(\",\", \".\"))\n                : Number(value);\n            };\n            return {\n              bead: buildBead({\n                id: item.data.id,\n                color: item.data.bead_color.hex,\n                type,\n                height: getNum(height),\n                width: getNum(width),\n                depth: getNum(depth),\n              }),\n              item,\n            };\n          });\n        }\n        resolve({\n          response: result,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nexport const createBoard = (\n  name?: string\n): Promise<{ board: { uuid: string; name: string } }> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/create\", {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({ name: name ?? \"\" }),\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        resolve({\n          board: response.board,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\nexport const sendBoardBatchEvents = (\n  id: string,\n  body: string\n): Promise<{ status: boolean }> => {\n  return new Promise((resolve, reject) => {\n    return fetch(apiHost + \"api/boards/events/\" + id, {\n      method: \"POST\",\n      headers,\n      body,\n    })\n      .then((res) => res.json())\n      .then((response) => {\n        if (response.statusCode && response.statusCode !== 200) {\n          reject(response.message);\n        }\n        resolve({\n          status: response.statusCode,\n        });\n      })\n      .catch((err) => handleError(err, reject));\n  });\n};\n\nlet tempBoardId: string | undefined;\nlet sendingEnabled: boolean = false;\nlet sendingIntervalMs: number = 500;\nlet sendingInterval: any = undefined;\nlet lastSendTimestamp: any = new Date().getTime();\nlet toSendEventsQueue: SaveEvent[] = [];\n\nexport enum SaveEventType {\n  CREATE = \"CREATE\",\n  UPDATE = \"UPDATE\",\n  DELETE = \"DELETE\",\n}\nexport interface SaveEvent {\n  action: SaveEventType;\n  object: AppObject;\n  createdAt: string;\n}\n\nexport const notifyBackend = (events: SaveEvent[]) => {\n  if (sendingEnabled === true) {\n    if (events.length > 0) {\n      events.forEach((event) => {\n        toSendEventsQueue.push(event);\n      });\n      debouncedSend();\n    }\n  }\n};\nconst debouncedSend = debounce(\n  () => triggerSendBatchEvents(),\n  sendingIntervalMs,\n  { trailing: true }\n);\n\nexport const startBatchQueue = (id: string) => {\n  sendingEnabled = true;\n  tempBoardId = id;\n  lastSendTimestamp = new Date().getTime();\n  // sendingInterval = setInterval(debouncedSend, 250);\n};\n\nconst triggerSendBatchEvents = () => {\n  const now = new Date().getTime();\n  console.log(\n    \"triggerSendBatchEvents: diff: \",\n    now - lastSendTimestamp,\n    toSendEventsQueue.length > 0\n  );\n  if (toSendEventsQueue.length > 0 && tempBoardId !== undefined) {\n    const body = JSON.stringify({ changes: toSendEventsQueue });\n    toSendEventsQueue = [];\n    sendBoardBatchEvents(tempBoardId, body);\n  }\n  lastSendTimestamp = now;\n};\n\nexport const stopBatchQueue = (id: string) => {\n  sendingEnabled = false;\n  if (tempBoardId !== undefined) {\n    tempBoardId = undefined;\n  }\n  if (sendingInterval !== undefined) {\n    clearInterval(sendingInterval);\n  }\n  if (toSendEventsQueue.length > 0) {\n    toSendEventsQueue = [];\n  }\n};\n\nif (!Date.prototype.toISOString) {\n  (function () {\n    function pad(number) {\n      if (number < 10) {\n        return \"0\" + number;\n      }\n      return number;\n    }\n\n    Date.prototype.toISOString = function () {\n      return (\n        this.getUTCFullYear() +\n        \"-\" +\n        pad(this.getUTCMonth() + 1) +\n        \"-\" +\n        pad(this.getUTCDate()) +\n        \"T\" +\n        pad(this.getUTCHours()) +\n        \":\" +\n        pad(this.getUTCMinutes()) +\n        \":\" +\n        pad(this.getUTCSeconds()) +\n        \".\" +\n        (this.getUTCMilliseconds() / 1000).toFixed(3).slice(2, 5) +\n        \"Z\"\n      );\n    };\n  })();\n}\n","export const uiButton = \"#aeaeae\"\nexport const defaulBeadColor = \"#4fc3f7\";","import { ObjectTypes } from \"../../editorObjects/Editor\";\n\nexport enum ActionsTypes {\n  EditBeadProduct = \"EditBeadProduct\",\n  EditBeadType = \"EditBeadType\",\n  EditBeadMaterial = \"EditBeadMaterial\",\n  EditBeadColor = \"EditBeadColor\",\n\n  EditRegionShape = \"EditRegionShape\",\n  EditRegionGridType = \"EditRegionGridType\",\n  EditRegionGridSettings = \"EditRegionGridSettings\",\n\n  EditPosition = \"EditPosition\",\n  EditRotate = \"EditRotate\",\n  EditWidthHeight = \"EditWidthHeight\",\n  EditWidthHeightDepth = \"EditWidthHeightDepth\",\n\n  Alignment = \"Alignment\",\n  Lock = \"Lock\",\n  Unlock = \"Unlock\",\n  Group = \"Group\",\n  Ungroup = \"Ungroup\",\n\n  More = \"More\",\n}\n\nexport enum ActionsGroupTypes {\n  EditBeadsProperies = \"EditBeadsProperies\",\n  EditRegionProperies = \"EditRegionProperies\",\n  Transform = \"Transform\",\n  LockOrUnlock = \"LockOrUnlock\",\n  GroupOrUngroup = \"GroupOrUngroup\",\n  More = \"More\",\n}\n\nexport const MapActionObjectType: { [key: string]: ActionsTypes[] } = {\n  [ObjectTypes.Bead]: [\n    ActionsTypes.EditBeadProduct,\n    ActionsTypes.EditBeadType,\n    ActionsTypes.EditBeadMaterial,\n    ActionsTypes.EditBeadColor,\n    ActionsTypes.Alignment,\n    ActionsTypes.EditWidthHeightDepth,\n    ActionsTypes.EditPosition,\n    ActionsTypes.EditRotate,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n  [ObjectTypes.Region]: [\n    ActionsTypes.EditRegionShape,\n    ActionsTypes.EditRegionGridType,\n    ActionsTypes.EditRegionGridSettings,\n    ActionsTypes.EditWidthHeight,\n    ActionsTypes.EditPosition,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n  [ObjectTypes.Group]: [\n    ActionsTypes.EditPosition,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n  [ObjectTypes.PreviewProject3D]: [\n    ActionsTypes.EditPosition,\n    ActionsTypes.Group,\n    ActionsTypes.Ungroup,\n    ActionsTypes.Lock,\n    ActionsTypes.Unlock,\n    ActionsTypes.More,\n  ],\n};\n\nexport interface IActions {\n  [key: string]: {\n    name: ActionsTypes;\n    sortOrder: number;\n    groupId: ActionsGroupTypes;\n    groupSortOrder: number;\n  };\n}\n\nexport const Actions: IActions = {\n  [ActionsTypes.EditBeadProduct]: {\n    name: ActionsTypes.EditBeadProduct,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditBeadType]: {\n    name: ActionsTypes.EditBeadType,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditBeadMaterial]: {\n    name: ActionsTypes.EditBeadMaterial,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditBeadColor]: {\n    name: ActionsTypes.EditBeadColor,\n    sortOrder: 40,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.EditRegionShape]: {\n    name: ActionsTypes.EditRegionShape,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.EditRegionProperies,\n    groupSortOrder: 40,\n  },\n  [ActionsTypes.EditRegionGridType]: {\n    name: ActionsTypes.EditRegionGridType,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.EditRegionProperies,\n    groupSortOrder: 40,\n  },\n  [ActionsTypes.EditRegionGridSettings]: {\n    name: ActionsTypes.EditRegionGridSettings,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.EditRegionProperies,\n    groupSortOrder: 40,\n  },\n  [ActionsTypes.EditPosition]: {\n    name: ActionsTypes.EditPosition,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.EditRotate]: {\n    name: ActionsTypes.EditRotate,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.EditWidthHeight]: {\n    name: ActionsTypes.EditWidthHeight,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.EditWidthHeightDepth]: {\n    name: ActionsTypes.EditWidthHeightDepth,\n    sortOrder: 30,\n    groupId: ActionsGroupTypes.Transform,\n    groupSortOrder: 60,\n  },\n  [ActionsTypes.Alignment]: {\n    name: ActionsTypes.Alignment,\n    sortOrder: 50,\n    groupId: ActionsGroupTypes.EditBeadsProperies,\n    groupSortOrder: 50,\n  },\n  [ActionsTypes.Lock]: {\n    name: ActionsTypes.Lock,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.LockOrUnlock,\n    groupSortOrder: 90,\n  },\n  [ActionsTypes.Unlock]: {\n    name: ActionsTypes.Unlock,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.LockOrUnlock,\n    groupSortOrder: 90,\n  },\n  [ActionsTypes.Group]: {\n    name: ActionsTypes.Group,\n    sortOrder: 10,\n    groupId: ActionsGroupTypes.GroupOrUngroup,\n    groupSortOrder: 80,\n  },\n  [ActionsTypes.Ungroup]: {\n    name: ActionsTypes.Ungroup,\n    sortOrder: 20,\n    groupId: ActionsGroupTypes.GroupOrUngroup,\n    groupSortOrder: 80,\n  },\n  [ActionsTypes.More]: {\n    name: ActionsTypes.More,\n    sortOrder: 1,\n    groupId: ActionsGroupTypes.More,\n    groupSortOrder: 100,\n  },\n};\n","import React from \"react\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { createBoard, prepareBoardsList } from \"./ApiService\";\nimport { AppData } from \"./AppData\";\n\nexport const PageBoards: React.FC<{\n  data: AppData;\n}> = (props) => {\n  let history = useHistory();\n  const [state, setBoards] = React.useState<{\n    boards: { uuid: string; name: string }[];\n  }>({ boards: [] });\n\n  const onClickCreate = () => {\n    createBoard().then((response) => {\n      history.push(`/board/${response.board.uuid}`);\n    });\n  };\n\n  React.useEffect(() => {\n    if (props.data.save_events === true) {\n      prepareBoardsList().then((response) => {\n        setBoards({\n          boards: response.boards,\n        });\n      });\n    }\n  }, []);\n\n  return (\n    <PageStyles>\n      <div>\n        <h2>Boards</h2>\n        <button onClick={onClickCreate} className={\"btn-primary\"}>\n          Create board\n        </button>\n\n        <table>\n          <thead>\n            <tr>\n              <th>name</th>\n              <th>actions</th>\n            </tr>\n          </thead>\n\n          <tbody>\n            <tr>\n              <td>Board1</td>\n              <td>\n                <Link to=\"/board/demo\" data-test=\"demoboard\">\n                  DemoBoards\n                </Link>\n              </td>\n            </tr>\n\n            {state.boards.map((board) => {\n              return (\n                <tr key={board.uuid}>\n                  <td>{board.name}</td>\n                  <td>\n                    <Link to={`/board/${board.uuid}`}>Edit</Link>\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n\n        <Link className={\"btn-light\"} to=\"/\">\n          Back Home\n        </Link>\n      </div>\n    </PageStyles>\n  );\n};\n\nconst PageStyles = styled.div`\n  padding: 1em;\n  table {\n    width: 100%;\n    max-width: 100%;\n    margin-bottom: 1rem;\n    background-color: transparent;\n  }\n  table td,\n  table th {\n    padding: 0.75rem;\n    vertical-align: top;\n    border-top: 1px solid #dee2e6;\n  }\n  table th {\n    color: #000;\n    background-color: #e9ecef;\n    border-color: #e9ecef;\n    vertical-align: bottom;\n    border-bottom: 2px solid #dee2e6;\n  }\n  table tbody tr:hover td {\n    color: #495057;\n    background-color: #e9ecef;\n    border-color: #dee2e6;\n  }\n  .btn-primary {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #fff;\n    background-color: #007bff;\n    border-color: #007bff;\n    margin-bottom: 10px;\n  }\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #f8f9fa;\n    margin-bottom: 10px;\n  }\n  h2 {\n    margin-bottom: 0.5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n`;\n","import { AppObject, Bead, Group } from \"../editorObjects/Editor\";\nimport { StoreUiSettings } from \"./store\";\n\n// PAMIETAJ o tym aby dodac rownie \"event do history w AppHistory.ts\nexport enum AppEventType {\n  AddObjects = \"AddObjects\",\n  DuplicateObjects = \"DuplicateObjects\",\n  RemoveObjects = \"RemoveObjects\",\n  ChangeSelectObjects = \"ChangeSelectObjects\",\n  ChangeObjectsProperty = \"ChangeObjectsProperty\",\n  ChangeObjectsAlignment = \"ChangeObjectsAlignment\",\n  ClipboardCut = \"ClipboardCut\",\n  ClipboardCopy = \"ClipboardCopy\",\n  ClipboardPaste = \"ClipboardPaste\",\n  AddMultipleBeads = \"AddMultipleBeads\",\n  ChangeUiSettings = \"ChangeUiSettings\",\n  ChangeUiSettingsZoom = \"ChangeUiSettingsZoom\",\n  ChangeUiSettingsSidebar = \"ChangeUiSettingsSidebar\",\n  GroupObjects = \"GroupObjects\",\n  UngroupObjects = \"UngroupObjects\",\n}\n\nexport type AddMultipleBeads = {\n  name: AppEventType.AddMultipleBeads;\n  payload: { rows: number; columns: number; figure: \"rectangle\" };\n};\n\nexport type ClipboardCut = {\n  name: AppEventType.ClipboardCut;\n  payload: {};\n};\n\nexport type ClipboardCopy = {\n  name: AppEventType.ClipboardCopy;\n  payload: {};\n};\n\nexport type ClipboardPaste = {\n  name: AppEventType.ClipboardPaste;\n  payload: {\n    objects: AppObject[];\n  };\n};\n\nexport enum SnapToLineType {\n  X_MIN = \"X_MIN\",\n  X_MAX = \"X_MAX\",\n  X_MIDDLE = \"X_MIDDLE\",\n  Y_MIN = \"Y_MIN\",\n  Y_MAX = \"Y_MAX\",\n  Y_MIDDLE = \"Y_MIDDLE\",\n}\n\nexport type ChangeSelectedObjectsAlignment = {\n  name: AppEventType.ChangeObjectsAlignment;\n  payload: {\n    selectedIds: string[];\n    snapType: SnapToLineType;\n  };\n};\n\nexport type ChangeUiSettings = {\n  name: AppEventType.ChangeUiSettings;\n  payload: { uiSettings: Partial<StoreUiSettings> };\n};\n\nexport type ChangeUiSettingsSidebar = {\n  name: AppEventType.ChangeUiSettingsSidebar;\n  payload: {\n    panel: \"objects\" | \"history\" | \"comments\";\n    open: boolean;\n    toggle?: boolean;\n  };\n};\n\nexport type ChangeUiSettingsZoom = {\n  name: AppEventType.ChangeUiSettingsZoom;\n  payload: {\n    zoomType: \"zoomByScroll\" | \"zoomInScreenCenter\" | \"zoomOutScreenCenter\";\n    useAnimation: boolean;\n    clientX?: number;\n    clientY?: number;\n    scrollDelta?: number;\n  };\n};\n\nexport type AddObjects = {\n  name: AppEventType.AddObjects;\n  payload: { objects: Partial<AppObject>[] };\n};\n\nexport type GroupObjects = {\n  name: AppEventType.GroupObjects;\n  payload: {\n    objects: Pick<AppObject, \"id\">[];\n    removed?: Pick<Group, \"id\" | \"childrenIds\">[];\n    added?: Pick<Group, \"id\" | \"childrenIds\">;\n  };\n};\n\nexport type UngroupObjects = {\n  name: AppEventType.UngroupObjects;\n  payload: {\n    objects: Pick<AppObject, \"id\">[];\n    removed?: Pick<Group, \"id\" | \"childrenIds\">[];\n  };\n};\n\nexport type DuplicateObjects = {\n  name: AppEventType.DuplicateObjects;\n  payload: { objects: Partial<AppObject>[] };\n};\n\nexport type RemoveObjects = {\n  name: AppEventType.RemoveObjects;\n  payload: { ids: string[] };\n};\n\nexport type ChangeSelectObject = {\n  id: string;\n  isSelected: boolean;\n};\nexport type ChangeSelectObjects = {\n  name: AppEventType.ChangeSelectObjects;\n  payload: { change: ChangeSelectObject[] };\n};\n\nexport type MappedTypeWithNewProperties<T> = {\n  [Properties in keyof T]: T[Properties];\n};\n\nexport type AppObjectKeys = MappedTypeWithNewProperties<Partial<AppObject>>;\nexport type ChangeObject = {\n  id: string;\n  properties: AppObjectKeys;\n  relatedChanges?: ChangeObject[];\n  shouldBeCreated?: Bead[];\n  shouldBeDeleted?: Bead[];\n};\nexport type ChangeObjectsProperty = {\n  name: AppEventType.ChangeObjectsProperty;\n  payload: {\n    changes: ChangeObject[];\n  };\n};\n\nexport type AppEvents =\n  | AddObjects\n  | RemoveObjects\n  | ChangeSelectObjects\n  | ChangeObjectsProperty\n  | ClipboardCut\n  | ClipboardCopy\n  | ClipboardPaste\n  | AddMultipleBeads\n  | ChangeUiSettings\n  | ChangeUiSettingsZoom\n  | ChangeUiSettingsSidebar\n  | ChangeSelectedObjectsAlignment\n  | DuplicateObjects\n  | GroupObjects\n  | UngroupObjects;\n","// @TODO: wybrac logger dla frontend\nlet enabled = true;\nexport const logger = {\n  log: (...arg) => {\n    if (enabled) {\n      console.log(...arg);\n    }\n  },\n  error: (...arg) => {\n    if (enabled) {\n      console.error(...arg);\n    }\n  },\n  warn: (...arg) => {\n    if (enabled) {\n      console.warn(...arg);\n    }\n  },\n  trace: (...arg) => {\n    if (enabled) {\n      console.log(...arg);\n    }\n  },\n  disableAll: () => {\n    enabled = false;\n  },\n  enableAll: () => {\n    enabled = true;\n  },\n};\n","import { cloneDeep } from \"lodash\";\nimport * as THREE from \"three\";\nimport {\n  AppObject,\n  EditorGridType,\n  EditorMode,\n  ThreeGridHelperConfig,\n  ThreeLightConfig,\n} from \"../editorObjects/Editor\";\nimport { logger } from \"../logger\";\n\nexport interface StoreUiSettings {\n  zoomScale: number;\n  mode: EditorMode;\n  lights: ThreeLightConfig[];\n  grid: ThreeGridHelperConfig;\n  selectedTopBarPosition: THREE.Vector3 | undefined;\n  modalSearchProducts: {\n    isOpen: boolean;\n    successAction: \"updateBeadType\" | undefined;\n    advBlockVisible: boolean;\n    q: string;\n    producer: string;\n    color: string;\n    cachedResponse: any[];\n    scrollPosition: number;\n  };\n  leftSidebar: {\n    isOpen: boolean;\n    panel: \"comments\" | undefined;\n  };\n  rightSidebar: {\n    isOpen: boolean;\n    panel: \"history\" | \"objects\" | undefined;\n  };\n  blockThreejs: {\n    loading: boolean;\n    error: string | undefined;\n  };\n}\nexport interface SimpleHistoryEvent {\n  name: string;\n  isActive: boolean;\n  createdAt: string;\n}\nexport interface StoreHistory {\n  events: SimpleHistoryEvent[];\n  canRedo: boolean;\n  canUndo: boolean;\n}\n\nexport interface StoreBoard {\n  uuid: string;\n  isFavourite: boolean;\n  canToggleToFavourite: boolean;\n  canEdit: boolean;\n  canExportAsImage: boolean;\n  name: string;\n  editModalVisible: boolean;\n}\nexport interface Store {\n  objects: { [s: string]: AppObject };\n  selectedIds: string[];\n  ui: StoreUiSettings;\n  history: StoreHistory;\n  board: StoreBoard;\n}\n\nlet store: Store;\n\nexport const defaultStore: Store = {\n  objects: {},\n  selectedIds: [],\n  history: {\n    canRedo: false,\n    canUndo: false,\n    events: [],\n  },\n  board: {\n    uuid: \"\",\n    name: \"\",\n    canEdit: true,\n    canToggleToFavourite: true,\n    isFavourite: false,\n    canExportAsImage: true,\n    editModalVisible: false,\n  },\n  ui: {\n    modalSearchProducts: {\n      isOpen: false,\n      successAction: undefined,\n      advBlockVisible: false,\n      color: \"\",\n      producer: \"\",\n      q: \"\",\n      cachedResponse: [],\n      scrollPosition: 0\n    },\n    leftSidebar: {\n      isOpen: false,\n      panel: undefined,\n    },\n    rightSidebar: {\n      isOpen: false,\n      panel: undefined,\n    },\n    zoomScale: 1,\n    mode: EditorMode.SelectOrMove,\n    lights: [\n      {\n        id: THREE.MathUtils.generateUUID(),\n        type: \"THREE.DirectionalLight\",\n        name: \"main_light_1\",\n        color: \"#FFF\",\n        intensity: 0.8,\n        position: {\n          x: 0,\n          y: 0,\n          z: 10,\n        },\n      },\n      {\n        id: THREE.MathUtils.generateUUID(),\n        type: \"THREE.DirectionalLight\",\n        name: \"main_light_2\",\n        color: \"#FFF\",\n        intensity: 0.4,\n        position: {\n          x: 0,\n          y: 0,\n          z: 10,\n        },\n      },\n    ],\n    grid: {\n      id: THREE.MathUtils.generateUUID(),\n      type: EditorGridType.Hex,\n      hexSize: 30,\n      snapEnabled: true,\n      isVisible: true,\n      width: 30,\n      height: 30,\n    },\n    selectedTopBarPosition: undefined,\n    blockThreejs: {\n      loading: true,\n      error: undefined,\n    },\n  },\n};\n\nexport const emptyStore: Store = {\n  objects: {},\n  selectedIds: [],\n  history: {\n    canRedo: false,\n    canUndo: false,\n    events: [],\n  },\n  board: {\n    canEdit: false,\n    canToggleToFavourite: false,\n    uuid: \"\",\n    isFavourite: false,\n    name: \"...\",\n    canExportAsImage: true,\n    editModalVisible: false,\n  },\n  ui: cloneDeep(defaultStore.ui),\n};\n\nexport const initStore = () => {\n  store = cloneDeep(defaultStore);\n};\n\nexport const getStore = () => {\n  return store;\n};\n\nexport const setStore = (newStore: Store) => {\n  logger.log(\"APPSTORE: setStore\", newStore, newStore.selectedIds);\n  store = newStore;\n};\n\nlet refreshThreejs: boolean = true;\nlet refreshReact: boolean = true;\n\nexport const shouldRefreshThree = () => {\n  return refreshThreejs;\n};\n\nexport const shouldRefreshReact = () => {\n  return refreshReact;\n};\n\nexport const setRefreshStates = (\n  _refreshThreejs: boolean = true,\n  _refreshReact: boolean = true\n) => {\n  refreshThreejs = _refreshThreejs;\n  refreshReact = _refreshReact;\n};\n","import { immerable } from \"immer\";\nimport { EditBBox, NAME_SEPARATOR, ObjectTypes } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum EditBBoxChildSuffix {\n  MAIN = \"MAIN\",\n  BG = \"BG\",\n  EDIT_CONTAINER = \"EDIT_CONTAINER\",\n  LINES = \"LINES\",\n  WHITE_DOT_BG = \"WHITE_DOT_BG\",\n  GRAY_DOT_BG = \"GRAY_DOT_BG\",\n  RESIZE_CONTAINER = \"RESIZE_CONTAINER\",\n  DOT_RESIZE_TOP_LEFT = \"DOT_RESIZE_TOP_LEFT\",\n  DOT_RESIZE_TOP_RIGHT = \"DOT_RESIZE_TOP_RIGHT\",\n  DOT_RESIZE_BOTTOM_LEFT = \"DOT_RESIZE_BOTTOM_LEFT\",\n  DOT_RESIZE_BOTTOM_RIGHT = \"DOT_RESIZE_BOTTOM_RIGHT\",\n}\n\nexport const getThreeNameFromEditBBoxId = (\n  id: string,\n  childSuffix: EditBBoxChildSuffix = EditBBoxChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.SceneEditBBox}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getEditBBoxIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.SceneEditBBox) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromEditBBox = (\n  id: string,\n  childSuffix?: EditBBoxChildSuffix\n) => {\n  return {\n    id,\n    name: getThreeNameFromEditBBoxId(id, childSuffix),\n  };\n};\n\nexport const buildEditBBox = (props: DeepPartial<EditBBox>): EditBBox => {\n  const defaults: EditBBox = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n    height: 0,\n    width: 0,\n    depth: 10,\n    editable: true,\n    // beadIds: [],\n    // regionsIds: [],\n    selectedIds: [],\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.SceneEditBBox,\n    // [immerable]: true,\n  };\n\n  return merge(defaults, props);\n};\n","import { immerable } from \"immer\";\nimport { Group, NAME_SEPARATOR, ObjectTypes } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum GroupChildSuffix {\n  MAIN = \"MAIN\",\n  BG = \"bg\",\n  ANY = \"GroupChildOf\",\n}\n\nexport const getThreeNameFromGroupId = (\n  id: string,\n  childSuffix: GroupChildSuffix = GroupChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.Group}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getGroupIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.Group) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromGroup = (\n  group: Group,\n  childSuffix?: GroupChildSuffix\n) => {\n  return merge({}, group, {\n    name: getThreeNameFromGroupId(group.id, childSuffix),\n  });\n};\n\nexport const buildGroup = (props: DeepPartial<Group>): Group => {\n  const defaults: Group = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    rotateX: 90,\n    rotateY: 0,\n    rotateZ: 0,\n    height: 10,\n    width: 10,\n    depth: 10,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.Group,\n    childrenIds: [],\n  };\n\n  return merge(defaults, props);\n};\n","import { immerable } from \"immer\";\nimport { NAME_SEPARATOR, ObjectTypes, PreviewProject3D } from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum PreviewProject3DChildSuffix {\n  MAIN = \"MAIN\",\n  BG = \"BG\",\n  ANY = \"PreviewProject3DChildOf\",\n}\n\nexport const getThreeNameFromPreviewProject3DId = (\n  id: string,\n  childSuffix: PreviewProject3DChildSuffix = PreviewProject3DChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.PreviewProject3D}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getPreviewProject3DIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.PreviewProject3D) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromPreviewProject3D = (\n  obj: PreviewProject3D,\n  childSuffix?: PreviewProject3DChildSuffix\n) => {\n  return merge({}, obj, {\n    name: getThreeNameFromPreviewProject3DId(obj.id, childSuffix),\n  });\n};\n\nexport const buildPreviewProject3D = (\n  props: DeepPartial<PreviewProject3D>\n): PreviewProject3D => {\n  const defaults: PreviewProject3D = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    rotateX: 90,\n    rotateY: 0,\n    rotateZ: 0,\n    height: 10,\n    width: 10,\n    depth: 10,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.PreviewProject3D,\n    color: \"red\",\n  };\n\n  return merge(defaults, props);\n};\n","import { immerable } from \"immer\";\nimport {\n  NAME_SEPARATOR,\n  ObjectTypes,\n  Region,\n  RegionGridType,\n  RegionShape,\n} from \"./Editor\";\nimport { DeepPartial } from \"ts-essentials\";\nimport { buildPoint } from \"./Point\";\nimport { merge } from \"lodash\";\nimport * as THREE from \"three\";\n\nexport enum RegionChildSuffix {\n  MAIN = \"main\",\n  BG = \"bg\",\n  GRID_CELLS = \"GRID_CELLS\",\n  GRID_CELL = \"gridCell\",\n  CONTENT = \"content\",\n}\n\nexport const getThreeNameFromRegionId = (\n  id: string,\n  childSuffix: RegionChildSuffix = RegionChildSuffix.MAIN\n) => {\n  return `${ObjectTypes.Region}${NAME_SEPARATOR}${id}${NAME_SEPARATOR}${childSuffix}`;\n};\n\nexport const getRegionIdFromThreeName = (name?: string) => {\n  if (!name) {\n    return undefined;\n  }\n  if (name.includes(ObjectTypes.Region) === false) {\n    return undefined;\n  }\n  return name.split(NAME_SEPARATOR)[1];\n};\n\nexport const getThreeUserDataFromRegion = (\n  region: Region,\n  childSuffix?: RegionChildSuffix\n) => {\n  return merge({}, region, {\n    name: getThreeNameFromRegionId(region.id, childSuffix),\n  });\n};\n\nexport const getBricksColumnsAndRowsCount = (currentColumns: number) => {\n  return {\n    columns: currentColumns,\n    rows: currentColumns,\n  };\n};\n\nexport const insideRegionTriange = (\n  region: Region,\n  _row: number,\n  column: number\n): {\n  isInside: boolean;\n  lastColumnIndex: number;\n} => {\n  const row = region.rows - _row - 1;\n  if (row >= region.rows || column < 0 || column >= region.columns) {\n    return { isInside: false, lastColumnIndex: 0 };\n  }\n  const min = region.columns % 2 === 0 ? 2 : 1;\n  const ratio = Math.max(0, row) / (region.rows - 1);\n  let beadsCountInRow =\n    min +\n    Math.min(Math.floor((region.columns - min) * ratio), region.columns - min);\n  if (region.columns % 2 != beadsCountInRow % 2) {\n    beadsCountInRow++;\n  }\n  const emptyCells = region.columns - beadsCountInRow;\n  const offsetFromStart = Math.floor(emptyCells / 2);\n  const offsetFromEnd = beadsCountInRow + offsetFromStart;\n  const lastColumnIndex = offsetFromEnd;\n\n  let isInside: boolean = true;\n  if (column < offsetFromStart) {\n    isInside = false;\n  } else if (column >= offsetFromEnd) {\n    isInside = false;\n  }\n  return { isInside, lastColumnIndex };\n};\n\nexport const isActiveRegionCell = (region: Region, index: number) => {\n  if (region.shape === RegionShape.Rectangle) {\n    const newSize = region.rows * region.columns;\n    if (index >= 0 && index < newSize) {\n      const offsetEnabled = region.gridType === RegionGridType.Bricks;\n      if (offsetEnabled) {\n        const row = Math.floor(index / region.columns);\n        const column = Math.floor(index % region.columns);\n        const rowOdd = row % 2 !== 0;\n        const isNotLastColumn = column !== region.columns - 1;\n        if ((rowOdd === true && isNotLastColumn) || rowOdd === false) {\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        return true;\n      }\n    } else {\n      return false;\n    }\n  } else if (region.shape === RegionShape.Triangle) {\n    const row = Math.floor(index / region.columns);\n    const column = Math.floor(index % region.columns);\n    const { isInside, lastColumnIndex } = insideRegionTriange(\n      region,\n      row,\n      column\n    );\n    if (isInside === true) {\n      const offsetEnabled = region.gridType === RegionGridType.Bricks;\n      if (offsetEnabled) {\n        const row = Math.floor(index / region.columns);\n        const column = Math.floor(index % region.columns);\n        const rowOdd = row % 2 !== 0;\n        const isNotLastColumn = column !== lastColumnIndex - 1;\n        if ((rowOdd === true && isNotLastColumn) || rowOdd === false) {\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        return true;\n      }\n    } else {\n      return false;\n    }\n  } else {\n    console.error(\"region shape not handled\", region.shape);\n    return false;\n  }\n};\n\nexport const buildRegion = (props: DeepPartial<Region>): Region => {\n  const defaults: Region = {\n    id: THREE.MathUtils.generateUUID(),\n    position: buildPoint(0, 0),\n    gridType: RegionGridType.Rectangles,\n    shape: RegionShape.Rectangle,\n    height: 10,\n    width: 10,\n    beadIds: [],\n    opacity: 0.5,\n    columns: 3,\n    rows: 3,\n    autoFillBeads: false,\n    snapBeadsToCell: true,\n    canLockOrUnlock: true,\n    isLocked: false,\n    objectType: ObjectTypes.Region,\n    childrenGridIds: [],\n    depth: 1,\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n  };\n  const newRegion = merge(defaults, props);\n  const size = newRegion.rows * newRegion.columns;\n  const newChildrenGridIds = Array(size).fill(undefined);\n  newRegion.childrenGridIds = merge(newChildrenGridIds, props.childrenGridIds);\n\n  return newRegion;\n};\n","// import { log, warn, error } from \"three\";\nconst { log, warn, error } = console;\n\nexport type EventCallback = (data: any, state: any) => void;\nexport interface Events {\n  [key: string]: EventCallback[];\n}\nexport class EventEmitter {\n  _events: Events;\n  constructor() {\n    this._events = {};\n  }\n\n  on(name: string, listener: EventCallback) {\n    if (!this._events[name]) {\n      this._events[name] = [];\n    }\n\n    this._events[name].push(listener);\n  }\n\n  removeListener(name: string, listenerToRemove: EventCallback) {\n    if (!this._events[name]) {\n      error(`Can't remove a listener. Event \"${name}\" doesn't exits.`);\n      return;\n    }\n\n    const filterListeners = (listener) => listener !== listenerToRemove;\n\n    this._events[name] = this._events[name].filter(filterListeners);\n  }\n\n  emit(name: string, data: any, state: any) {\n    log(\"EventEmitter:emit:\", name, data);\n\n    if (!this._events[name]) {\n      warn(`Can't emit an event. Event \"${name}\" doesn't exits.`);\n      return;\n    }\n\n    const fireCallbacks = (callback: EventCallback) => {\n      callback(data, state);\n    };\n\n    this._events[name].forEach(fireCallbacks);\n  }\n}\n\nlet internalEventEmiter: EventEmitter | undefined;\n\nexport const getEventEmitter = () => {\n  if (internalEventEmiter === undefined) {\n    internalEventEmiter = new EventEmitter();\n  }\n  return internalEventEmiter;\n};\n\nexport enum EventNames {\n  updateEditorState = \"updateEditorState\",\n  /**@deprecated */\n  action_changeSelectedBeads_color = \"action_changeSelectedBeads_color\",\n  /**@deprecated */\n  action_changeSelectedBeads_height = \"action_changeSelectedBeads_height\",\n  /**@deprecated */\n  action_changeSelectedBeads_width = \"action_changeSelectedBeads_width\",\n  /**@deprecated */\n  action_changeSelectedBeads_depth = \"action_changeSelectedBeads_depth\",\n  /**@deprecated */\n  action_changeSelectedBeads_type = \"action_changeSelectedBeads_type\",\n  /**@deprecated */\n  action_changeSelectedBeads_rotate = \"action_changeSelectedBeads_rotate\",\n  /**@deprecated */\n  action_selectBeads = \"action_selectBeads\",\n  /**@deprecated */\n  action_deleteBeads = \"action_deleteBeads\",\n  /**@deprecated */\n  action_addBeadOnClick = \"action_addBeadOnClick\",\n  /**@deprecated */\n  action_updateLight = \"action_updateLight\",\n  /**@deprecated */\n  action_readSavedCanvas = \"action_readSavedCanvas\",\n  /**@deprecated */\n  startAppEvent = \"startAppEvent\",\n  /**@deprecated */\n  action_movedSelected = \"action_movedSelected\",\n  /**@deprecated */\n  action_changeBeadColorToBeadTemplate = \"action_changeBeadColorToBeadTemplate\",\n  /**@deprecated */\n  action_fastAddBeads = \"action_fastAddBeads\",\n  /**@deprecated */\n  action_snapToLineSelectedBeads = \"action_snapToLineSelectedBeads\",\n  /**@deprecated */\n  action_onChangeEditorMode = \"action_onChangeEditorMode\",\n  /**@deprecated */\n  action_deleteSelectedBeads = \"action_deleteSelectedBeads\",\n  /**@deprecated */\n  action_addRegion = \"action_addRegion\",\n  /**@deprecated */\n  action_selectRegions = \"action_selectRegions\",\n  /**@deprecated */\n  action_selectIntersectObjects = \"action_selectIntersectObjects\",\n  /**@deprecated */ \n  action_updateZoomSCale = \"action_updateZoomSCale\",\n  /**@deprecated */ \n  action_updateEditBBox = \"action_updateEditBBox\",\n  /**@deprecated */ \n  action_unselectAll = \"action_unselectAll\",\n  /**@deprecated */ \n  action_selectIntersectObject = \"action_selectIntersectObject\",\n  /**@deprecated */ \n  action_moveClickedObject = \"action_moveClickedObject\",\n  /**@deprecated */ \n  action_moveAllSelectedObjects = \"action_moveAllSelectedObjects\",\n  /**@deprecated */ \n  action_deleteObjects = \"action_deleteObjects\",\n}\n","import { getThreeNameFromBeadId } from \"./Bead\";\nimport { getThreeNameFromEditBBoxId } from \"./EditBBox\";\nimport { AppObject, Editor, ObjectTypes } from \"./Editor\";\nimport { getThreeNameFromGroupId } from \"./Group\";\nimport { getThreeNameFromPreviewProject3DId } from \"./PreviewProject3D\";\nimport { getThreeNameFromRegionId } from \"./Region\";\n\nexport const getStateObjectFromObjectId = (\n  objectId: string,\n  objectType: ObjectTypes\n) => {\n  let name: string | undefined = undefined;\n\n  if (objectType === ObjectTypes.Bead) {\n    name = getThreeNameFromBeadId(objectId);\n  } else if (objectType === ObjectTypes.Region) {\n    name = getThreeNameFromRegionId(objectId);\n  } else if (objectType === ObjectTypes.Group) {\n    name = getThreeNameFromGroupId(objectId);\n  } else if (objectType === ObjectTypes.PreviewProject3D) {\n    name = getThreeNameFromPreviewProject3DId(objectId);\n  } else if (objectType === ObjectTypes.SceneEditBBox) {\n    name = getThreeNameFromEditBBoxId(objectId);\n  }\n\n  if (name === undefined) {\n    console.warn(\"name is empty for id\", objectId);\n    return undefined;\n  }\n  return name;\n};\n","// import {\n// \tBufferGeometry,\n// \tFileLoader,\n// \tFloat32BufferAttribute,\n// \tGroup,\n// \tLineBasicMaterial,\n// \tLineSegments,\n// \tLoader,\n// \tMaterial,\n// \tMesh,\n// \tMeshPhongMaterial,\n// \tPoints,\n// \tPointsMaterial,\n// \tVector3\n// } from '../../../build/three.module.js';\nimport * as THREE from 'three'\nconst {\n\tBufferGeometry,\n\tFileLoader,\n\tFloat32BufferAttribute,\n\tGroup,\n\tLineBasicMaterial,\n\tLineSegments,\n\tLoader,\n\tMaterial,\n\tMesh,\n\tMeshPhongMaterial,\n\tPoints,\n\tPointsMaterial,\n\tVector3\n} = THREE;\n\nvar OBJLoader = ( function () {\n\n\t// o object_name | g group_name\n\tvar object_pattern = /^[og]\\s*(.+)?/;\n\t// mtllib file_reference\n\tvar material_library_pattern = /^mtllib /;\n\t// usemtl material_name\n\tvar material_use_pattern = /^usemtl /;\n\t// usemap map_name\n\tvar map_use_pattern = /^usemap /;\n\n\tvar vA = new Vector3();\n\tvar vB = new Vector3();\n\tvar vC = new Vector3();\n\n\tvar ab = new Vector3();\n\tvar cb = new Vector3();\n\n\tfunction ParserState() {\n\n\t\tvar state = {\n\t\t\tobjects: [],\n\t\t\tobject: {},\n\n\t\t\tvertices: [],\n\t\t\tnormals: [],\n\t\t\tcolors: [],\n\t\t\tuvs: [],\n\n\t\t\tmaterials: {},\n\t\t\tmaterialLibraries: [],\n\n\t\t\tstartObject: function ( name, fromDeclaration ) {\n\n\t\t\t\t// If the current object (initial from reset) is not from a g/o declaration in the parsed\n\t\t\t\t// file. We need to use it for the first parsed g/o to keep things in sync.\n\t\t\t\tif ( this.object && this.object.fromDeclaration === false ) {\n\n\t\t\t\t\tthis.object.name = name;\n\t\t\t\t\tthis.object.fromDeclaration = ( fromDeclaration !== false );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tvar previousMaterial = ( this.object && typeof this.object.currentMaterial === 'function' ? this.object.currentMaterial() : undefined );\n\n\t\t\t\tif ( this.object && typeof this.object._finalize === 'function' ) {\n\n\t\t\t\t\tthis.object._finalize( true );\n\n\t\t\t\t}\n\n\t\t\t\tthis.object = {\n\t\t\t\t\tname: name || '',\n\t\t\t\t\tfromDeclaration: ( fromDeclaration !== false ),\n\n\t\t\t\t\tgeometry: {\n\t\t\t\t\t\tvertices: [],\n\t\t\t\t\t\tnormals: [],\n\t\t\t\t\t\tcolors: [],\n\t\t\t\t\t\tuvs: [],\n\t\t\t\t\t\thasUVIndices: false\n\t\t\t\t\t},\n\t\t\t\t\tmaterials: [],\n\t\t\t\t\tsmooth: true,\n\n\t\t\t\t\tstartMaterial: function ( name, libraries ) {\n\n\t\t\t\t\t\tvar previous = this._finalize( false );\n\n\t\t\t\t\t\t// New usemtl declaration overwrites an inherited material, except if faces were declared\n\t\t\t\t\t\t// after the material, then it must be preserved for proper MultiMaterial continuation.\n\t\t\t\t\t\tif ( previous && ( previous.inherited || previous.groupCount <= 0 ) ) {\n\n\t\t\t\t\t\t\tthis.materials.splice( previous.index, 1 );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar material = {\n\t\t\t\t\t\t\tindex: this.materials.length,\n\t\t\t\t\t\t\tname: name || '',\n\t\t\t\t\t\t\tmtllib: ( Array.isArray( libraries ) && libraries.length > 0 ? libraries[ libraries.length - 1 ] : '' ),\n\t\t\t\t\t\t\tsmooth: ( previous !== undefined ? previous.smooth : this.smooth ),\n\t\t\t\t\t\t\tgroupStart: ( previous !== undefined ? previous.groupEnd : 0 ),\n\t\t\t\t\t\t\tgroupEnd: - 1,\n\t\t\t\t\t\t\tgroupCount: - 1,\n\t\t\t\t\t\t\tinherited: false,\n\n\t\t\t\t\t\t\tclone: function ( index ) {\n\n\t\t\t\t\t\t\t\tvar cloned = {\n\t\t\t\t\t\t\t\t\tindex: ( typeof index === 'number' ? index : this.index ),\n\t\t\t\t\t\t\t\t\tname: this.name,\n\t\t\t\t\t\t\t\t\tmtllib: this.mtllib,\n\t\t\t\t\t\t\t\t\tsmooth: this.smooth,\n\t\t\t\t\t\t\t\t\tgroupStart: 0,\n\t\t\t\t\t\t\t\t\tgroupEnd: - 1,\n\t\t\t\t\t\t\t\t\tgroupCount: - 1,\n\t\t\t\t\t\t\t\t\tinherited: false\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tcloned.clone = this.clone.bind( cloned );\n\t\t\t\t\t\t\t\treturn cloned;\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.materials.push( material );\n\n\t\t\t\t\t\treturn material;\n\n\t\t\t\t\t},\n\n\t\t\t\t\tcurrentMaterial: function () {\n\n\t\t\t\t\t\tif ( this.materials.length > 0 ) {\n\n\t\t\t\t\t\t\treturn this.materials[ this.materials.length - 1 ];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn undefined;\n\n\t\t\t\t\t},\n\n\t\t\t\t\t_finalize: function ( end ) {\n\n\t\t\t\t\t\tvar lastMultiMaterial = this.currentMaterial();\n\t\t\t\t\t\tif ( lastMultiMaterial && lastMultiMaterial.groupEnd === - 1 ) {\n\n\t\t\t\t\t\t\tlastMultiMaterial.groupEnd = this.geometry.vertices.length / 3;\n\t\t\t\t\t\t\tlastMultiMaterial.groupCount = lastMultiMaterial.groupEnd - lastMultiMaterial.groupStart;\n\t\t\t\t\t\t\tlastMultiMaterial.inherited = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Ignore objects tail materials if no face declarations followed them before a new o/g started.\n\t\t\t\t\t\tif ( end && this.materials.length > 1 ) {\n\n\t\t\t\t\t\t\tfor ( var mi = this.materials.length - 1; mi >= 0; mi -- ) {\n\n\t\t\t\t\t\t\t\tif ( this.materials[ mi ].groupCount <= 0 ) {\n\n\t\t\t\t\t\t\t\t\tthis.materials.splice( mi, 1 );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Guarantee at least one empty material, this makes the creation later more straight forward.\n\t\t\t\t\t\tif ( end && this.materials.length === 0 ) {\n\n\t\t\t\t\t\t\tthis.materials.push( {\n\t\t\t\t\t\t\t\tname: '',\n\t\t\t\t\t\t\t\tsmooth: this.smooth\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn lastMultiMaterial;\n\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t// Inherit previous objects material.\n\t\t\t\t// Spec tells us that a declared material must be set to all objects until a new material is declared.\n\t\t\t\t// If a usemtl declaration is encountered while this new object is being parsed, it will\n\t\t\t\t// overwrite the inherited material. Exception being that there was already face declarations\n\t\t\t\t// to the inherited material, then it will be preserved for proper MultiMaterial continuation.\n\n\t\t\t\tif ( previousMaterial && previousMaterial.name && typeof previousMaterial.clone === 'function' ) {\n\n\t\t\t\t\tvar declared = previousMaterial.clone( 0 );\n\t\t\t\t\tdeclared.inherited = true;\n\t\t\t\t\tthis.object.materials.push( declared );\n\n\t\t\t\t}\n\n\t\t\t\tthis.objects.push( this.object );\n\n\t\t\t},\n\n\t\t\tfinalize: function () {\n\n\t\t\t\tif ( this.object && typeof this.object._finalize === 'function' ) {\n\n\t\t\t\t\tthis.object._finalize( true );\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tparseVertexIndex: function ( value, len ) {\n\n\t\t\t\tvar index = parseInt( value, 10 );\n\t\t\t\treturn ( index >= 0 ? index - 1 : index + len / 3 ) * 3;\n\n\t\t\t},\n\n\t\t\tparseNormalIndex: function ( value, len ) {\n\n\t\t\t\tvar index = parseInt( value, 10 );\n\t\t\t\treturn ( index >= 0 ? index - 1 : index + len / 3 ) * 3;\n\n\t\t\t},\n\n\t\t\tparseUVIndex: function ( value, len ) {\n\n\t\t\t\tvar index = parseInt( value, 10 );\n\t\t\t\treturn ( index >= 0 ? index - 1 : index + len / 2 ) * 2;\n\n\t\t\t},\n\n\t\t\taddVertex: function ( a, b, c ) {\n\n\t\t\t\tvar src = this.vertices;\n\t\t\t\tvar dst = this.object.geometry.vertices;\n\n\t\t\t\tdst.push( src[ a + 0 ], src[ a + 1 ], src[ a + 2 ] );\n\t\t\t\tdst.push( src[ b + 0 ], src[ b + 1 ], src[ b + 2 ] );\n\t\t\t\tdst.push( src[ c + 0 ], src[ c + 1 ], src[ c + 2 ] );\n\n\t\t\t},\n\n\t\t\taddVertexPoint: function ( a ) {\n\n\t\t\t\tvar src = this.vertices;\n\t\t\t\tvar dst = this.object.geometry.vertices;\n\n\t\t\t\tdst.push( src[ a + 0 ], src[ a + 1 ], src[ a + 2 ] );\n\n\t\t\t},\n\n\t\t\taddVertexLine: function ( a ) {\n\n\t\t\t\tvar src = this.vertices;\n\t\t\t\tvar dst = this.object.geometry.vertices;\n\n\t\t\t\tdst.push( src[ a + 0 ], src[ a + 1 ], src[ a + 2 ] );\n\n\t\t\t},\n\n\t\t\taddNormal: function ( a, b, c ) {\n\n\t\t\t\tvar src = this.normals;\n\t\t\t\tvar dst = this.object.geometry.normals;\n\n\t\t\t\tdst.push( src[ a + 0 ], src[ a + 1 ], src[ a + 2 ] );\n\t\t\t\tdst.push( src[ b + 0 ], src[ b + 1 ], src[ b + 2 ] );\n\t\t\t\tdst.push( src[ c + 0 ], src[ c + 1 ], src[ c + 2 ] );\n\n\t\t\t},\n\n\t\t\taddFaceNormal: function ( a, b, c ) {\n\n\t\t\t\tvar src = this.vertices;\n\t\t\t\tvar dst = this.object.geometry.normals;\n\n\t\t\t\tvA.fromArray( src, a );\n\t\t\t\tvB.fromArray( src, b );\n\t\t\t\tvC.fromArray( src, c );\n\n\t\t\t\tcb.subVectors( vC, vB );\n\t\t\t\tab.subVectors( vA, vB );\n\t\t\t\tcb.cross( ab );\n\n\t\t\t\tcb.normalize();\n\n\t\t\t\tdst.push( cb.x, cb.y, cb.z );\n\t\t\t\tdst.push( cb.x, cb.y, cb.z );\n\t\t\t\tdst.push( cb.x, cb.y, cb.z );\n\n\t\t\t},\n\n\t\t\taddColor: function ( a, b, c ) {\n\n\t\t\t\tvar src = this.colors;\n\t\t\t\tvar dst = this.object.geometry.colors;\n\n\t\t\t\tif ( src[ a ] !== undefined ) dst.push( src[ a + 0 ], src[ a + 1 ], src[ a + 2 ] );\n\t\t\t\tif ( src[ b ] !== undefined ) dst.push( src[ b + 0 ], src[ b + 1 ], src[ b + 2 ] );\n\t\t\t\tif ( src[ c ] !== undefined ) dst.push( src[ c + 0 ], src[ c + 1 ], src[ c + 2 ] );\n\n\t\t\t},\n\n\t\t\taddUV: function ( a, b, c ) {\n\n\t\t\t\tvar src = this.uvs;\n\t\t\t\tvar dst = this.object.geometry.uvs;\n\n\t\t\t\tdst.push( src[ a + 0 ], src[ a + 1 ] );\n\t\t\t\tdst.push( src[ b + 0 ], src[ b + 1 ] );\n\t\t\t\tdst.push( src[ c + 0 ], src[ c + 1 ] );\n\n\t\t\t},\n\n\t\t\taddDefaultUV: function () {\n\n\t\t\t\tvar dst = this.object.geometry.uvs;\n\n\t\t\t\tdst.push( 0, 0 );\n\t\t\t\tdst.push( 0, 0 );\n\t\t\t\tdst.push( 0, 0 );\n\n\t\t\t},\n\n\t\t\taddUVLine: function ( a ) {\n\n\t\t\t\tvar src = this.uvs;\n\t\t\t\tvar dst = this.object.geometry.uvs;\n\n\t\t\t\tdst.push( src[ a + 0 ], src[ a + 1 ] );\n\n\t\t\t},\n\n\t\t\taddFace: function ( a, b, c, ua, ub, uc, na, nb, nc ) {\n\n\t\t\t\tvar vLen = this.vertices.length;\n\n\t\t\t\tvar ia = this.parseVertexIndex( a, vLen );\n\t\t\t\tvar ib = this.parseVertexIndex( b, vLen );\n\t\t\t\tvar ic = this.parseVertexIndex( c, vLen );\n\n\t\t\t\tthis.addVertex( ia, ib, ic );\n\t\t\t\tthis.addColor( ia, ib, ic );\n\n\t\t\t\t// normals\n\n\t\t\t\tif ( na !== undefined && na !== '' ) {\n\n\t\t\t\t\tvar nLen = this.normals.length;\n\n\t\t\t\t\tia = this.parseNormalIndex( na, nLen );\n\t\t\t\t\tib = this.parseNormalIndex( nb, nLen );\n\t\t\t\t\tic = this.parseNormalIndex( nc, nLen );\n\n\t\t\t\t\tthis.addNormal( ia, ib, ic );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis.addFaceNormal( ia, ib, ic );\n\n\t\t\t\t}\n\n\t\t\t\t// uvs\n\n\t\t\t\tif ( ua !== undefined && ua !== '' ) {\n\n\t\t\t\t\tvar uvLen = this.uvs.length;\n\n\t\t\t\t\tia = this.parseUVIndex( ua, uvLen );\n\t\t\t\t\tib = this.parseUVIndex( ub, uvLen );\n\t\t\t\t\tic = this.parseUVIndex( uc, uvLen );\n\n\t\t\t\t\tthis.addUV( ia, ib, ic );\n\n\t\t\t\t\tthis.object.geometry.hasUVIndices = true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// add placeholder values (for inconsistent face definitions)\n\n\t\t\t\t\tthis.addDefaultUV();\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\taddPointGeometry: function ( vertices ) {\n\n\t\t\t\tthis.object.geometry.type = 'Points';\n\n\t\t\t\tvar vLen = this.vertices.length;\n\n\t\t\t\tfor ( var vi = 0, l = vertices.length; vi < l; vi ++ ) {\n\n\t\t\t\t\tvar index = this.parseVertexIndex( vertices[ vi ], vLen );\n\n\t\t\t\t\tthis.addVertexPoint( index );\n\t\t\t\t\tthis.addColor( index );\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\taddLineGeometry: function ( vertices, uvs ) {\n\n\t\t\t\tthis.object.geometry.type = 'Line';\n\n\t\t\t\tvar vLen = this.vertices.length;\n\t\t\t\tvar uvLen = this.uvs.length;\n\n\t\t\t\tfor ( var vi = 0, l = vertices.length; vi < l; vi ++ ) {\n\n\t\t\t\t\tthis.addVertexLine( this.parseVertexIndex( vertices[ vi ], vLen ) );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( var uvi = 0, l = uvs.length; uvi < l; uvi ++ ) {\n\n\t\t\t\t\tthis.addUVLine( this.parseUVIndex( uvs[ uvi ], uvLen ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t\tstate.startObject( '', false );\n\n\t\treturn state;\n\n\t}\n\n\t//\n\n\tfunction OBJLoader( manager ) {\n\n\t\tLoader.call( this, manager );\n\n\t\tthis.materials = null;\n\n\t}\n\n\tOBJLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\n\n\t\tconstructor: OBJLoader,\n\n\t\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\t\tvar scope = this;\n\n\t\t\tvar loader = new FileLoader( this.manager );\n\t\t\tloader.setPath( this.path );\n\t\t\tloader.setRequestHeader( this.requestHeader );\n\t\t\tloader.setWithCredentials( this.withCredentials );\n\t\t\tloader.load( url, function ( text ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\tonLoad( scope.parse( text ) );\n\n\t\t\t\t} catch ( e ) {\n\n\t\t\t\t\tif ( onError ) {\n\n\t\t\t\t\t\tonError( e );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.error( e );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tscope.manager.itemError( url );\n\n\t\t\t\t}\n\n\t\t\t}, onProgress, onError );\n\n\t\t},\n\n\t\tsetMaterials: function ( materials ) {\n\n\t\t\tthis.materials = materials;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tparse: function ( text ) {\n\n\t\t\tvar state = new ParserState();\n\n\t\t\tif ( text.indexOf( '\\r\\n' ) !== - 1 ) {\n\n\t\t\t\t// This is faster than String.split with regex that splits on both\n\t\t\t\ttext = text.replace( /\\r\\n/g, '\\n' );\n\n\t\t\t}\n\n\t\t\tif ( text.indexOf( '\\\\\\n' ) !== - 1 ) {\n\n\t\t\t\t// join lines separated by a line continuation character (\\)\n\t\t\t\ttext = text.replace( /\\\\\\n/g, '' );\n\n\t\t\t}\n\n\t\t\tvar lines = text.split( '\\n' );\n\t\t\tvar line = '', lineFirstChar = '';\n\t\t\tvar lineLength = 0;\n\t\t\tvar result = [];\n\n\t\t\t// Faster to just trim left side of the line. Use if available.\n\t\t\tvar trimLeft = ( typeof ''.trimLeft === 'function' );\n\n\t\t\tfor ( var i = 0, l = lines.length; i < l; i ++ ) {\n\n\t\t\t\tline = lines[ i ];\n\n\t\t\t\tline = trimLeft ? line.trimLeft() : line.trim();\n\n\t\t\t\tlineLength = line.length;\n\n\t\t\t\tif ( lineLength === 0 ) continue;\n\n\t\t\t\tlineFirstChar = line.charAt( 0 );\n\n\t\t\t\t// @todo invoke passed in handler if any\n\t\t\t\tif ( lineFirstChar === '#' ) continue;\n\n\t\t\t\tif ( lineFirstChar === 'v' ) {\n\n\t\t\t\t\tvar data = line.split( /\\s+/ );\n\n\t\t\t\t\tswitch ( data[ 0 ] ) {\n\n\t\t\t\t\t\tcase 'v':\n\t\t\t\t\t\t\tstate.vertices.push(\n\t\t\t\t\t\t\t\tparseFloat( data[ 1 ] ),\n\t\t\t\t\t\t\t\tparseFloat( data[ 2 ] ),\n\t\t\t\t\t\t\t\tparseFloat( data[ 3 ] )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif ( data.length >= 7 ) {\n\n\t\t\t\t\t\t\t\tstate.colors.push(\n\t\t\t\t\t\t\t\t\tparseFloat( data[ 4 ] ),\n\t\t\t\t\t\t\t\t\tparseFloat( data[ 5 ] ),\n\t\t\t\t\t\t\t\t\tparseFloat( data[ 6 ] )\n\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t// if no colors are defined, add placeholders so color and vertex indices match\n\n\t\t\t\t\t\t\t\tstate.colors.push( undefined, undefined, undefined );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'vn':\n\t\t\t\t\t\t\tstate.normals.push(\n\t\t\t\t\t\t\t\tparseFloat( data[ 1 ] ),\n\t\t\t\t\t\t\t\tparseFloat( data[ 2 ] ),\n\t\t\t\t\t\t\t\tparseFloat( data[ 3 ] )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'vt':\n\t\t\t\t\t\t\tstate.uvs.push(\n\t\t\t\t\t\t\t\tparseFloat( data[ 1 ] ),\n\t\t\t\t\t\t\t\tparseFloat( data[ 2 ] )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( lineFirstChar === 'f' ) {\n\n\t\t\t\t\tvar lineData = line.substr( 1 ).trim();\n\t\t\t\t\tvar vertexData = lineData.split( /\\s+/ );\n\t\t\t\t\tvar faceVertices = [];\n\n\t\t\t\t\t// Parse the face vertex data into an easy to work with format\n\n\t\t\t\t\tfor ( var j = 0, jl = vertexData.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tvar vertex = vertexData[ j ];\n\n\t\t\t\t\t\tif ( vertex.length > 0 ) {\n\n\t\t\t\t\t\t\tvar vertexParts = vertex.split( '/' );\n\t\t\t\t\t\t\tfaceVertices.push( vertexParts );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Draw an edge between the first vertex and all subsequent vertices to form an n-gon\n\n\t\t\t\t\tvar v1 = faceVertices[ 0 ];\n\n\t\t\t\t\tfor ( var j = 1, jl = faceVertices.length - 1; j < jl; j ++ ) {\n\n\t\t\t\t\t\tvar v2 = faceVertices[ j ];\n\t\t\t\t\t\tvar v3 = faceVertices[ j + 1 ];\n\n\t\t\t\t\t\tstate.addFace(\n\t\t\t\t\t\t\tv1[ 0 ], v2[ 0 ], v3[ 0 ],\n\t\t\t\t\t\t\tv1[ 1 ], v2[ 1 ], v3[ 1 ],\n\t\t\t\t\t\t\tv1[ 2 ], v2[ 2 ], v3[ 2 ]\n\t\t\t\t\t\t);\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( lineFirstChar === 'l' ) {\n\n\t\t\t\t\tvar lineParts = line.substring( 1 ).trim().split( ' ' );\n\t\t\t\t\tvar lineVertices = [], lineUVs = [];\n\n\t\t\t\t\tif ( line.indexOf( '/' ) === - 1 ) {\n\n\t\t\t\t\t\tlineVertices = lineParts;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tfor ( var li = 0, llen = lineParts.length; li < llen; li ++ ) {\n\n\t\t\t\t\t\t\tvar parts = lineParts[ li ].split( '/' );\n\n\t\t\t\t\t\t\tif ( parts[ 0 ] !== '' ) lineVertices.push( parts[ 0 ] );\n\t\t\t\t\t\t\tif ( parts[ 1 ] !== '' ) lineUVs.push( parts[ 1 ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.addLineGeometry( lineVertices, lineUVs );\n\n\t\t\t\t} else if ( lineFirstChar === 'p' ) {\n\n\t\t\t\t\tvar lineData = line.substr( 1 ).trim();\n\t\t\t\t\tvar pointData = lineData.split( ' ' );\n\n\t\t\t\t\tstate.addPointGeometry( pointData );\n\n\t\t\t\t} else if ( ( result = object_pattern.exec( line ) ) !== null ) {\n\n\t\t\t\t\t// o object_name\n\t\t\t\t\t// or\n\t\t\t\t\t// g group_name\n\n\t\t\t\t\t// WORKAROUND: https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\t// var name = result[ 0 ].substr( 1 ).trim();\n\t\t\t\t\tvar name = ( ' ' + result[ 0 ].substr( 1 ).trim() ).substr( 1 );\n\n\t\t\t\t\tstate.startObject( name );\n\n\t\t\t\t} else if ( material_use_pattern.test( line ) ) {\n\n\t\t\t\t\t// material\n\n\t\t\t\t\tstate.object.startMaterial( line.substring( 7 ).trim(), state.materialLibraries );\n\n\t\t\t\t} else if ( material_library_pattern.test( line ) ) {\n\n\t\t\t\t\t// mtl file\n\n\t\t\t\t\tstate.materialLibraries.push( line.substring( 7 ).trim() );\n\n\t\t\t\t} else if ( map_use_pattern.test( line ) ) {\n\n\t\t\t\t\t// the line is parsed but ignored since the loader assumes textures are defined MTL files\n\t\t\t\t\t// (according to https://www.okino.com/conv/imp_wave.htm, 'usemap' is the old-style Wavefront texture reference method)\n\n\t\t\t\t\tconsole.warn( 'THREE.OBJLoader: Rendering identifier \"usemap\" not supported. Textures must be defined in MTL files.' );\n\n\t\t\t\t} else if ( lineFirstChar === 's' ) {\n\n\t\t\t\t\tresult = line.split( ' ' );\n\n\t\t\t\t\t// smooth shading\n\n\t\t\t\t\t// @todo Handle files that have varying smooth values for a set of faces inside one geometry,\n\t\t\t\t\t// but does not define a usemtl for each face set.\n\t\t\t\t\t// This should be detected and a dummy material created (later MultiMaterial and geometry groups).\n\t\t\t\t\t// This requires some care to not create extra material on each smooth value for \"normal\" obj files.\n\t\t\t\t\t// where explicit usemtl defines geometry groups.\n\t\t\t\t\t// Example asset: examples/models/obj/cerberus/Cerberus.obj\n\n\t\t\t\t\t/*\n\t\t\t\t\t * http://paulbourke.net/dataformats/obj/\n\t\t\t\t\t * or\n\t\t\t\t\t * http://www.cs.utah.edu/~boulos/cs3505/obj_spec.pdf\n\t\t\t\t\t *\n\t\t\t\t\t * From chapter \"Grouping\" Syntax explanation \"s group_number\":\n\t\t\t\t\t * \"group_number is the smoothing group number. To turn off smoothing groups, use a value of 0 or off.\n\t\t\t\t\t * Polygonal elements use group numbers to put elements in different smoothing groups. For free-form\n\t\t\t\t\t * surfaces, smoothing groups are either turned on or off; there is no difference between values greater\n\t\t\t\t\t * than 0.\"\n\t\t\t\t\t */\n\t\t\t\t\tif ( result.length > 1 ) {\n\n\t\t\t\t\t\tvar value = result[ 1 ].trim().toLowerCase();\n\t\t\t\t\t\tstate.object.smooth = ( value !== '0' && value !== 'off' );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// ZBrush can produce \"s\" lines #11707\n\t\t\t\t\t\tstate.object.smooth = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tvar material = state.object.currentMaterial();\n\t\t\t\t\tif ( material ) material.smooth = state.object.smooth;\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Handle null terminated files without exception\n\t\t\t\t\tif ( line === '\\0' ) continue;\n\n\t\t\t\t\tconsole.warn( 'THREE.OBJLoader: Unexpected line: \"' + line + '\"' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tstate.finalize();\n\n\t\t\tvar container = new Group();\n\t\t\tcontainer.materialLibraries = [].concat( state.materialLibraries );\n\n\t\t\tvar hasPrimitives = ! ( state.objects.length === 1 && state.objects[ 0 ].geometry.vertices.length === 0 );\n\n\t\t\tif ( hasPrimitives === true ) {\n\n\t\t\t\tfor ( var i = 0, l = state.objects.length; i < l; i ++ ) {\n\n\t\t\t\t\tvar object = state.objects[ i ];\n\t\t\t\t\tvar geometry = object.geometry;\n\t\t\t\t\tvar materials = object.materials;\n\t\t\t\t\tvar isLine = ( geometry.type === 'Line' );\n\t\t\t\t\tvar isPoints = ( geometry.type === 'Points' );\n\t\t\t\t\tvar hasVertexColors = false;\n\n\t\t\t\t\t// Skip o/g line declarations that did not follow with any faces\n\t\t\t\t\tif ( geometry.vertices.length === 0 ) continue;\n\n\t\t\t\t\tvar buffergeometry = new BufferGeometry();\n\n\t\t\t\t\tbuffergeometry.setAttribute( 'position', new Float32BufferAttribute( geometry.vertices, 3 ) );\n\n\t\t\t\t\tif ( geometry.normals.length > 0 ) {\n\n\t\t\t\t\t\tbuffergeometry.setAttribute( 'normal', new Float32BufferAttribute( geometry.normals, 3 ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( geometry.colors.length > 0 ) {\n\n\t\t\t\t\t\thasVertexColors = true;\n\t\t\t\t\t\tbuffergeometry.setAttribute( 'color', new Float32BufferAttribute( geometry.colors, 3 ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( geometry.hasUVIndices === true ) {\n\n\t\t\t\t\t\tbuffergeometry.setAttribute( 'uv', new Float32BufferAttribute( geometry.uvs, 2 ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create materials\n\n\t\t\t\t\tvar createdMaterials = [];\n\n\t\t\t\t\tfor ( var mi = 0, miLen = materials.length; mi < miLen; mi ++ ) {\n\n\t\t\t\t\t\tvar sourceMaterial = materials[ mi ];\n\t\t\t\t\t\tvar materialHash = sourceMaterial.name + '_' + sourceMaterial.smooth + '_' + hasVertexColors;\n\t\t\t\t\t\tvar material = state.materials[ materialHash ];\n\n\t\t\t\t\t\tif ( this.materials !== null ) {\n\n\t\t\t\t\t\t\tmaterial = this.materials.create( sourceMaterial.name );\n\n\t\t\t\t\t\t\t// mtl etc. loaders probably can't create line materials correctly, copy properties to a line material.\n\t\t\t\t\t\t\tif ( isLine && material && ! ( material instanceof LineBasicMaterial ) ) {\n\n\t\t\t\t\t\t\t\tvar materialLine = new LineBasicMaterial();\n\t\t\t\t\t\t\t\tMaterial.prototype.copy.call( materialLine, material );\n\t\t\t\t\t\t\t\tmaterialLine.color.copy( material.color );\n\t\t\t\t\t\t\t\tmaterial = materialLine;\n\n\t\t\t\t\t\t\t} else if ( isPoints && material && ! ( material instanceof PointsMaterial ) ) {\n\n\t\t\t\t\t\t\t\tvar materialPoints = new PointsMaterial( { size: 10, sizeAttenuation: false } );\n\t\t\t\t\t\t\t\tMaterial.prototype.copy.call( materialPoints, material );\n\t\t\t\t\t\t\t\tmaterialPoints.color.copy( material.color );\n\t\t\t\t\t\t\t\tmaterialPoints.map = material.map;\n\t\t\t\t\t\t\t\tmaterial = materialPoints;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( material === undefined ) {\n\n\t\t\t\t\t\t\tif ( isLine ) {\n\n\t\t\t\t\t\t\t\tmaterial = new LineBasicMaterial();\n\n\t\t\t\t\t\t\t} else if ( isPoints ) {\n\n\t\t\t\t\t\t\t\tmaterial = new PointsMaterial( { size: 1, sizeAttenuation: false } );\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tmaterial = new MeshPhongMaterial();\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tmaterial.name = sourceMaterial.name;\n\t\t\t\t\t\t\tmaterial.flatShading = sourceMaterial.smooth ? false : true;\n\t\t\t\t\t\t\tmaterial.vertexColors = hasVertexColors;\n\n\t\t\t\t\t\t\tstate.materials[ materialHash ] = material;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcreatedMaterials.push( material );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create mesh\n\n\t\t\t\t\tvar mesh;\n\n\t\t\t\t\tif ( createdMaterials.length > 1 ) {\n\n\t\t\t\t\t\tfor ( var mi = 0, miLen = materials.length; mi < miLen; mi ++ ) {\n\n\t\t\t\t\t\t\tvar sourceMaterial = materials[ mi ];\n\t\t\t\t\t\t\tbuffergeometry.addGroup( sourceMaterial.groupStart, sourceMaterial.groupCount, mi );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( isLine ) {\n\n\t\t\t\t\t\t\tmesh = new LineSegments( buffergeometry, createdMaterials );\n\n\t\t\t\t\t\t} else if ( isPoints ) {\n\n\t\t\t\t\t\t\tmesh = new Points( buffergeometry, createdMaterials );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tmesh = new Mesh( buffergeometry, createdMaterials );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( isLine ) {\n\n\t\t\t\t\t\t\tmesh = new LineSegments( buffergeometry, createdMaterials[ 0 ] );\n\n\t\t\t\t\t\t} else if ( isPoints ) {\n\n\t\t\t\t\t\t\tmesh = new Points( buffergeometry, createdMaterials[ 0 ] );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tmesh = new Mesh( buffergeometry, createdMaterials[ 0 ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tmesh.name = object.name;\n\n\t\t\t\t\tcontainer.add( mesh );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// if there is only the default parser state object with no geometry data, interpret data as point cloud\n\n\t\t\t\tif ( state.vertices.length > 0 ) {\n\n\t\t\t\t\tvar material = new PointsMaterial( { size: 1, sizeAttenuation: false } );\n\n\t\t\t\t\tvar buffergeometry = new BufferGeometry();\n\n\t\t\t\t\tbuffergeometry.setAttribute( 'position', new Float32BufferAttribute( state.vertices, 3 ) );\n\n\t\t\t\t\tif ( state.colors.length > 0 && state.colors[ 0 ] !== undefined ) {\n\n\t\t\t\t\t\tbuffergeometry.setAttribute( 'color', new Float32BufferAttribute( state.colors, 3 ) );\n\t\t\t\t\t\tmaterial.vertexColors = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tvar points = new Points( buffergeometry, material );\n\t\t\t\t\tcontainer.add( points );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn container;\n\n\t\t}\n\n\t} );\n\n\treturn OBJLoader;\n\n} )();\n\nexport { OBJLoader };\n","// import { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\";\nimport { OBJLoader } from \"./OBJLoader\";\nimport * as THREE from \"three\";\n\n/**@ts-ignore */\n// eslint-disable-next-line import/no-webpack-loader-syntax\n// import toho_sphere_v1_2020_02_24 from \"!!raw-loader!./models3d/toho_sphere_v1_2020_02_24.obj\";\n/**@ts-ignore */\n// eslint-disable-next-line import/no-webpack-loader-syntax\n// import toho_miyuki_v2_2020_02_24 from \"!!raw-loader!./models3d/toho_miyuki_v2_2020_02_24.obj\";\n/**@ts-ignore */\n// eslint-disable-next-line import/no-webpack-loader-syntax\n// import toho_15_v4_2020_02_24 from \"!!raw-loader!./models3d/toho_15_v4_2020_02_24.obj\";\nimport { BeadTypes } from \"../editorObjects/Editor\";\n\nconst base3dModels: Base3dModels = {\n  toho_sphere: { model: null, bbox: null },\n  toho_miyuki: { model: null, bbox: null },\n  toho_15: { model: null, bbox: null },\n  model_cylinder: { model: null, bbox: null },\n  model_fire_polish: { model: null, bbox: null },\n  model_toho_round: { model: null, bbox: null },\n};\n\nexport type Base3dModelNames =\n  | \"toho_sphere\"\n  | \"toho_miyuki\"\n  | \"toho_15\"\n  | \"model_cylinder\"\n  | \"model_fire_polish\"\n  | \"model_toho_round\";\n\nexport type Base3dModels = {\n  [day in Base3dModelNames]: {\n    model: THREE.Object3D | null;\n    bbox: THREE.Box3 | null;\n  };\n};\n\nconst isDev = !process.env.NODE_ENV || process.env.NODE_ENV === \"development\";\nconst modelsHost = isDev\n  ? \"./models3d/\"\n  : \"https://rpcal.github.io/coralinio-preview/build/models3d/\";\n\nexport const loadAppModels = async (appThree) => {\n  const objLoader = new OBJLoader();\n  // var objLoader = new THREE.OBJLoader();\n  // const objLoader = new THREE.ObjectLoader();\n\n  //@TODO: Przelicz wielkosci aby uzyc ich przy dodawaniu kolek\n  {\n    try {\n      // const objLoader = new OBJLoader();\n      // const object = objLoader.parse(toho_sphere_v1_2020_02_24);\n      const object = await objLoader.loadAsync(\n        modelsHost + \"toho_sphere_v1_2020_02_24.obj\"\n      );\n      console.log(\"OBJLoader: \", \"odczytano plik toho_sphere_v1_2020_02_24 \");\n      base3dModels[\"toho_sphere\"].model = object.clone();\n      base3dModels[\"toho_sphere\"].bbox = new THREE.Box3().setFromObject(object);\n    } catch (err) {\n      console.error(\n        \"OBJLoader: \",\n        \"nie mozna doczytac toho_sphere_v1_2020_02_24\"\n      );\n    }\n  }\n\n  {\n    try {\n      // const objLoader = new THREE.ObjectLoader();\n      // const objLoader = new OBJLoader();\n      // const object = objLoader.parse(toho_miyuki_v2_2020_02_24);\n      const object = await objLoader.loadAsync(\n        modelsHost + \"toho_miyuki_v2_2020_02_24.obj\"\n      );\n      console.log(\"OBJLoader: \", \"odczytano plik diamondModelText \");\n      base3dModels[\"toho_miyuki\"].model = object.clone();\n      base3dModels[\"toho_miyuki\"].bbox = new THREE.Box3().setFromObject(object);\n    } catch (err) {\n      console.error(\"OBJLoader: \", \"nie mozna doczytac diamondModelText\");\n    }\n  }\n\n  {\n    try {\n      // const objLoader = new THREE.ObjectLoader();\n      // const objLoader = new OBJLoader();\n      // const object = objLoader.parse(toho_15_v4_2020_02_24);\n      const object = await objLoader.loadAsync(\n        modelsHost + \"toho_miyuki_v2_2020_02_24.obj\"\n      );\n      console.log(\"OBJLoader: \", \"odczytano plik modelToho15v3a \");\n      base3dModels[\"toho_15\"].model = object.clone();\n      base3dModels[\"toho_15\"].bbox = new THREE.Box3().setFromObject(object);\n    } catch (err) {\n      console.error(\"OBJLoader: \", \"nie mozna doczytac modelToho15v3a\");\n    }\n  }\n\n  {\n    try {\n      const object = await objLoader.loadAsync(\n        modelsHost + \"model_cylinder.obj\"\n      );\n      console.log(\"OBJLoader: \", \"odczytano plik model_cylinder \");\n      base3dModels[\"model_cylinder\"].model = object.clone();\n      base3dModels[\"model_cylinder\"].bbox = new THREE.Box3().setFromObject(\n        object\n      );\n    } catch (err) {\n      console.error(\"OBJLoader: \", \"nie mozna doczytac model_cylinder\");\n    }\n  }\n\n  {\n    try {\n      const object = await objLoader.loadAsync(\n        modelsHost + \"model_fire_polish.obj\"\n      );\n      console.log(\"OBJLoader: \", \"odczytano plik model_fire_polish \");\n      base3dModels[\"model_fire_polish\"].model = object.clone();\n      base3dModels[\"model_fire_polish\"].bbox = new THREE.Box3().setFromObject(\n        object\n      );\n    } catch (err) {\n      console.error(\"OBJLoader: \", \"nie mozna doczytac model_fire_polish\");\n    }\n  }\n\n  {\n    try {\n      const object = await objLoader.loadAsync(\n        modelsHost + \"model_toho_round.obj\"\n      );\n      console.log(\"OBJLoader: \", \"odczytano plik model_toho_round \");\n      base3dModels[\"model_toho_round\"].model = object.clone();\n      base3dModels[\"model_toho_round\"].bbox = new THREE.Box3().setFromObject(\n        object\n      );\n    } catch (err) {\n      console.error(\"OBJLoader: \", \"nie mozna doczytac model_toho_round\");\n    }\n  }\n\n  // @INFO: Loading external models\n  // {\n  //   const objLoader = new OBJLoader();\n  //   const baseBeadPath = \"./3dmodels/bead_2020_02_05.obj\";\n  //   objLoader.load(\n  //     baseBeadPath,\n  //     (object) => {\n  //       console.log(\"OBJLoader: \", \"odczytano plik: \", baseBeadPath);\n  //       object.position.set(10, 10, 10);\n  //       object.scale.x = 10;\n  //       object.scale.y = 10;\n  //       object.scale.z = 10;\n  //       base3dModels[\"baseBead\"] = object.clone();\n  //     },\n  //     (xhr) => {\n  //       console.log(\n  //         \"OBJLoader: \",\n  //         (xhr.loaded / xhr.total) * 100 + \"% loaded\"\n  //       );\n  //     },\n  //     (error) => {\n  //       console.error(\"OBJLoader: \", error);\n  //     }\n  //   );\n  // }\n\n  // scene.background = new THREE.TextureLoader().load(require('./img/background.jpg').default);\n  //  {\n  //     var bg_geometry = new THREE.PlaneGeometry(1000, 1000, 1);\n  //     var bg_material = new THREE.MeshBasicMaterial({\n  //       color: \"#ccc\",\n  //       side: THREE.DoubleSide,\n  //     });\n  //     var bg_plane = new THREE.Mesh(bg_geometry, bg_material);\n  //     scene.add(bg_plane);\n  //   }\n\n  //   {\n  //     var bg_geometry = new THREE.PlaneGeometry(1000, 1000, 1);\n  //     var bg_material = new THREE.MeshBasicMaterial({\n  //       color: \"#ccc\",\n  //       side: THREE.DoubleSide,\n  //     });\n  //     var bg_plane = new THREE.Mesh(bg_geometry, bg_material);\n  //     scene.add(bg_plane);\n  //   }\n};\n\nexport const getModelFromBeadType = (type: BeadTypes) => {\n  let beadModel: THREE.Object3D | undefined;\n\n  if (type === BeadTypes.TOHO_MIYUKI) {\n    if (base3dModels.toho_miyuki.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded diamond\");\n      return beadModel;\n    }\n    beadModel = base3dModels.toho_miyuki.model.clone();\n  }\n\n  if (type === BeadTypes.TOHO_15) {\n    if (base3dModels.toho_15.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.toho_15.model.clone();\n  }\n\n  if (type === BeadTypes.TOHO_SPHERE) {\n    if (base3dModels.toho_sphere.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.toho_sphere.model.clone();\n  }\n\n  if (type === BeadTypes.MODEL_CYLINDER) {\n    if (base3dModels.model_cylinder.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.model_cylinder.model.clone();\n  }\n\n  if (type === BeadTypes.MODEL_FIRE_POLISH) {\n    if (base3dModels.model_fire_polish.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.model_fire_polish.model.clone();\n  }\n\n  if (type === BeadTypes.MODEL_TOHO_ROUND) {\n    if (base3dModels.model_toho_round.model === null) {\n      console.error(\"triggerAddBeadToScene: 3dModel is not loaded baseBead\");\n      return beadModel;\n    }\n    beadModel = base3dModels.model_toho_round.model.clone();\n  }\n\n  return beadModel;\n};\n\nexport const getModelBBoxFromBeadType = (type: BeadTypes) => {\n  if (type === BeadTypes.TOHO_MIYUKI) {\n    return base3dModels.toho_miyuki.bbox;\n  }\n\n  if (type === BeadTypes.TOHO_15) {\n    return base3dModels.toho_15.bbox;\n  }\n\n  if (type === BeadTypes.TOHO_SPHERE) {\n    return base3dModels.toho_sphere.bbox;\n  }\n\n  if (type === BeadTypes.MODEL_CYLINDER) {\n    return base3dModels.model_cylinder.bbox;\n  }\n\n  if (type === BeadTypes.MODEL_FIRE_POLISH) {\n    return base3dModels.model_fire_polish.bbox;\n  }\n\n  if (type === BeadTypes.MODEL_TOHO_ROUND) {\n    return base3dModels.model_toho_round.bbox;\n  }\n\n  console.warn(\"missing model for bead type : \", type);\n\n  return null;\n};\n","import { Editor } from \"../editorObjects/Editor\";\nimport { ImmerReducer } from \"immer-reducer\";\nimport { Store } from \"../controllers/store\";\n\nexport class MainImmerReducer extends ImmerReducer<Editor> {\n  // /** @deprecated */\n  // action_test() {}\n  // /** @deprecated */\n  // action_restoreState() {}\n  updateEditorState(newState: Store) {\n    this.draftState.objects = newState.objects;\n    this.draftState.selectedIds = newState.selectedIds;\n    this.draftState.ui = newState.ui;\n    this.draftState.board = newState.board;\n    this.draftState.history = newState.history;\n  }\n}\n","import {\n  Editor,\n  EditorMode,\n  BeadTypes,\n  EditorMenuMain,\n  EditorGridType,\n  BrushType,\n  RegionGridType,\n} from \"../editorObjects/Editor\";\nimport { buildPoint } from \"../editorObjects/Point\";\nimport { composeReducers } from \"immer-reducer\";\nimport { createActionCreators, createReducerFunction } from \"immer-reducer\";\nimport { DraggableOperationsImmerReducer } from \"./DraggableOperationsImmerReducer\";\nimport { PersistImmerReducer } from \"./PersistImmerReducer\";\nimport { ChangeEditorModeImmerReducer } from \"./ChangeEditorModeImmerReducer\";\nimport { MainImmerReducer } from \"./MainImmerReducer\";\nimport { MouseSelectionImmerReducer } from \"./MouseSelectionImmerReducer\";\nimport { ToolbarImmerReducer } from \"./ToolbarImmerReducer\";\nimport { defaulBeadColor } from \"../components/colors\";\nimport { TopbarImmerReducer } from \"./TopbarImmerReducer\";\nimport { PaintImmerReducer } from \"./PaintImmerReducer\";\nimport { buildBead } from \"../editorObjects/Bead\";\nimport { produce } from \"immer\";\nimport { getEventEmitter } from \"../EventEmitter\";\nimport { RegionImmerReducer } from \"./RegionImmerReducer\";\nimport * as THREE from \"three\";\nimport { defaultStore } from \"../controllers/store\";\n\n// const defaultBead = buildBead({});\n\n// const defaultAppData: Editor = {\n//   appData: {\n//     objects: {},\n//     beads: {},\n//     lines: {},\n//     regions: {},\n//   },\n// ui: {\n//   zoomScale: 1,\n//   lights: [\n//     {\n//       id: THREE.MathUtils.generateUUID(),\n//       type: \"THREE.DirectionalLight\",\n//       name: \"main_light_1\",\n//       color: \"#FFF\",\n//       intensity: 0.8,\n//       position: {\n//         x: 0,\n//         y: 0,\n//         z: 10,\n//       },\n//     },\n//     {\n//       id: THREE.MathUtils.generateUUID(),\n//       type: \"THREE.DirectionalLight\",\n//       name: \"main_light_2\",\n//       color: \"#FFF\",\n//       intensity: 0.4,\n//       position: {\n//         x: 0,\n//         y: 0,\n//         z: 10,\n//       },\n//     },\n//   ],\n// lineSettings: {\n//   settings: {\n//     beadsAutoCount: true,\n//     beadsAutoSpacing: true,\n//     beadsCount: 0,\n//     beadsSpacing: 0,\n//     defaultBead: {\n//       type: BeadTypes.TOHO_15,\n//       rotateX: 90,\n//       rotateY: 0,\n//       rotateZ: 0,\n//       color: defaulBeadColor,\n//       height: 52,\n//       width: 52,\n//       keepAspectRatio: false,\n//     },\n//   },\n// },\n// saveInfo: {\n//   saved: false,\n//   haveUnsavedChanges: false,\n// },\n// selectedRegionsIds: {},\n// selectedRegionsIdsCount: 0,\n// selectedLinesIds: {},\n// selectedLinesIdsCount: 0,\n// selectedBeadsIds: {},\n// selectedBeadsIdsCount: 0,\n\n// selectedIds: [],\n// selectedIdsAsKeys: {},\n// selectedIdsCount: 0,\n// selectedTopBarPosition: undefined,\n// editBBox: undefined,\n// mouseSelection: {\n//   start: buildPoint(0, 0),\n//   end: buildPoint(0, 0),\n//   isDragStarted: false,\n//   isDragged: false,\n// },\n// currentMenuMainOpen: EditorMenuMain.None,\n// grid: {\n//   id: THREE.MathUtils.generateUUID(),\n//   type: EditorGridType.Hex,\n//   hexSize: 30,\n//   snapEnabled: true,\n//   isVisible: true,\n//   width: 30,\n//   height: 30,\n// },\n// brush: {\n//   type: BrushType.Color,\n//   size: 50,\n//   color: defaulBeadColor,\n// },\n// background: {\n//   image: {\n//     url: \"\",\n//     scale: 1,\n//     position: buildPoint(0, 0),\n//     opacity: 0.5,\n//   },\n// },\n// beadsTemplate: {\n//   color: defaultBead.color,\n//   width: defaultBead.width,\n//   height: defaultBead.height,\n//   depth: defaultBead.depth,\n//   keepAspectRatio: defaultBead.keepAspectRatio,\n//   rotateX: defaultBead.rotateX,\n//   rotateY: defaultBead.rotateY,\n//   rotateZ: defaultBead.rotateZ,\n//   type: defaultBead.type,\n// },\n// currentBeadChain: {\n//   isDragEnabled: false,\n//   beadIds: [],\n// },\n// sceneWrapperWidth: 0,\n// sceneWrapperHeight: 0,\n// sceneWrapperPosition: {\n//   x: 0,\n//   y: 0,\n//   angle: 0,\n//   scale: 0,\n//   top: 0,\n//   left: 0,\n// },\n// regionTemplate: {\n//   gridType: RegionGridType.Rectangles,\n// },\n// },\n// mode: EditorMode.SelectOrMove,\n// };\n\nexport const Actions = {\n  Main: createActionCreators(MainImmerReducer),\n  // Draggable: createActionCreators(DraggableOperationsImmerReducer),\n  // Persist: createActionCreators(PersistImmerReducer),\n  // ChangeEditorMode: createActionCreators(ChangeEditorModeImmerReducer),\n  // MouseSelection: createActionCreators(MouseSelectionImmerReducer),\n  // Toolbar: createActionCreators(ToolbarImmerReducer),\n  // Topbar: createActionCreators(TopbarImmerReducer),\n  // Paint: createActionCreators(PaintImmerReducer),\n  // Region: createActionCreators(RegionImmerReducer),\n};\n\n// const eventEmitter = getEventEmitter();\n\n// const reducerForEventEmitter = produce((state, action) => {\n//   eventEmitter.emit(action.type, action.payload, state);\n// }, {});\n\nexport const store = composeReducers(\n  createReducerFunction(MainImmerReducer, defaultStore)\n  // createReducerFunction(DraggableOperationsImmerReducer, defaultAppData),\n  // createReducerFunction(PersistImmerReducer, defaultAppData),\n  // createReducerFunction(ToolbarImmerReducer, defaultAppData),\n  // createReducerFunction(TopbarImmerReducer, defaultAppData),\n  // createReducerFunction(ChangeEditorModeImmerReducer, defaultAppData),\n  // createReducerFunction(MouseSelectionImmerReducer, defaultAppData),\n  // createReducerFunction(PaintImmerReducer, defaultAppData),\n  // createReducerFunction(RegionImmerReducer, defaultAppData),\n  // reducerForEventEmitter\n);\n","import { applyMiddleware, createStore } from \"redux\";\n// import thunk from \"redux-thunk\";\nimport { store } from \"./store\";\n\nexport const appStore = createStore(\n  store,\n  // \"__REDUX_DEVTOOLS_EXTENSION__\" in window &&\n  //   (window as any).__REDUX_DEVTOOLS_EXTENSION__()\n  // applyMiddleware(thunk)\n);\n","import { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport * as THREE from \"three\";\nimport { Group, groupIdKey, ObjectTypes } from \"../../../editorObjects/Editor\";\nimport { getStore } from \"../../../controllers/store\";\n\nexport class MouseEventsBase {\n  boundingClientRect: DOMRect | undefined;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  intersects: THREE.Intersection[];\n\n  constructor() {\n    this.boundingClientRect = undefined;\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n    this.intersects = [];\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {}\n\n  onMove(event: PointerEvent) {}\n\n  onUp(event: PointerEvent) {}\n\n  getIntersect(clientX: number, clientY: number) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n\n    if (this.boundingClientRect === undefined) {\n      return [];\n    }\n\n    const { width, height, top, left } = this.boundingClientRect;\n    this.mouse.x = ((clientX - left) / width) * 2 - 1;\n    this.mouse.y = -((clientY - top) / height) * 2 + 1;\n    this.raycaster.setFromCamera(this.mouse, appThree.camera);\n    // @TODO: use raycaster with layers \n    // this.raycaster.layers.\n    return this.raycaster.intersectObjects(appThree.scene.children, true);\n  }\n\n  getIntersectObjects(clientX: number, clientY: number) {\n    return this.getObjectsFromIntersect(this.getIntersect(clientX, clientY));\n  }\n\n  getActiveObjectsFromIntersect(clientX: number, clientY: number) {\n    const intersects = this.getIntersect(clientX, clientY);\n    return intersects.filter((obj) => {\n      const data = obj.object.userData;\n      const isLocked = data?.isLocked ?? false;\n      const objectType = data?.objectType ?? undefined;\n      return (\n        // isLocked === false &&\n        objectType === ObjectTypes.Bead ||\n        objectType === ObjectTypes.Region ||\n        objectType === ObjectTypes.Group ||\n        objectType === ObjectTypes.PreviewProject3D\n        // || objectType === ObjectTypes.SceneEditBBox\n      );\n    });\n  }\n\n  getObjectsFromIntersect(intersects: THREE.Intersection[]) {\n    const { Bead, Region, SceneEditBBox } = ObjectTypes;\n    return intersects.filter((obj) => {\n      const objectType = obj?.object?.userData?.objectType ?? undefined;\n      return (\n        objectType === Bead ||\n        objectType === Region ||\n        objectType === SceneEditBBox\n      );\n    });\n  }\n\n  getIdsFromGroupOrInGroup(objectId: string) {\n    const store = getStore();\n    if (store.objects[objectId] === undefined) {\n      return [];\n    }\n    // store.objects[objectId].objectType;\n    const isGroup = store.objects[objectId].objectType === ObjectTypes.Group;\n    const isInGroup =\n      store.objects[objectId][groupIdKey] !== undefined &&\n      store.objects[objectId][groupIdKey].length > 0;\n    const groupId = store.objects[objectId][groupIdKey];\n    if (isGroup) {\n      return (store.objects[objectId] as Group).childrenIds;\n    } else if (isInGroup) {\n      return [groupId, ...(store.objects[groupId] as Group).childrenIds];\n    } else {\n      return [];\n    }\n  }\n\n  groupObjectsByTypeFromIntersect(\n    intersects: THREE.Intersection[],\n    maxItems?: number\n  ) {\n    const { Bead, Region, SceneEditBBox } = ObjectTypes;\n    const result: {\n      Bead: THREE.Intersection[];\n      Region: THREE.Intersection[];\n      SceneEditBBox: THREE.Intersection[];\n    } = {\n      Bead: [],\n      Region: [],\n      SceneEditBBox: [],\n    };\n    const selected: number[] = [];\n    intersects.forEach((obj, index) => {\n      if (maxItems !== undefined) {\n        if (selected.length >= maxItems) {\n          return;\n        }\n      }\n      const id = obj?.object?.userData?.id ?? undefined;\n      const objectType = obj?.object?.userData?.objectType ?? undefined;\n      const isLocked = obj?.object?.userData?.isLocked ?? false;\n\n      if (id !== undefined) {\n        if (objectType !== undefined) {\n          result[objectType].push(obj);\n          selected.push(index);\n        }\n      }\n    });\n    return result;\n  }\n}\n","import { AddObjects, AppEventType } from \"../../../controllers/AppEventType\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { buildBead } from \"../../../editorObjects/Bead\";\nimport {\n  Bead,\n  BeadTypes,\n  EditorMode,\n  ObjectTypes,\n} from \"../../../editorObjects/Editor\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { getModelBBoxFromBeadType } from \"../../loadModels\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeAddBead extends MouseEventsBase {\n  constructor() {\n    super();\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    const bbox = getModelBBoxFromBeadType(BeadTypes.TOHO_15);\n    let width = 1;\n    let height = 1;\n    let depth = 1;\n    if (bbox) {\n      width = Math.abs(bbox.max.x - bbox.min.x);\n      height = Math.abs(bbox.max.y - bbox.min.y);\n      depth = Math.abs(bbox.max.z - bbox.min.z);\n    }\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    const action1: AddObjects = {\n      name: AppEventType.AddObjects,\n      payload: {\n        objects: [\n          {\n            position: { x: x, y: y, z: 1 },\n            width,\n            height,\n            objectType: ObjectTypes.Bead,\n          },\n        ],\n      },\n    };\n    sendEvent(action1);\n  }\n\n  onMove(event: PointerEvent) {}\n\n  onUp(event: PointerEvent) {}\n}\n","export class MouseDragHelper {\n  isDragged: boolean = false;\n  isDragStarted: boolean = false;\n  end: { x: number; y: number } = { x: 0, y: 0 };\n  start: { x: number; y: number } = { x: 0, y: 0 };\n  shouldBehaveLikeMove: boolean = false;\n\n  onDown(x: number, y: number) {\n    this.isDragStarted = true;\n    this.start.x = x;\n    this.start.y = y;\n    this.end.x = x;\n    this.end.y = y;\n  }\n  \n  onUp() {\n    this.isDragStarted = false;\n    this.isDragged = false;\n    this.start.x = 0;\n    this.start.y = 0;\n    this.end.x = 0;\n    this.end.y = 0;\n    this.shouldBehaveLikeMove = false;\n  }\n\n  onMove(x: number, y: number) {\n    if (this.isDragStarted == true) {\n      this.end.x = x;\n      this.end.y = y;\n      if (this.isDragged === false) {\n        const { start, end } = this;\n        const deltaX = end.x - start.x;\n        const deltaY = end.y - start.y;\n\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\n          this.isDragged = true;\n        }\n      }\n    }\n  }\n}\n","import { Vector2 } from \"three\";\n\nexport class MouseSelectionHelper {\n  element: HTMLDivElement;\n  renderer: any;\n  startPoint: Vector2;\n  pointTopLeft: Vector2;\n  pointBottomRight: Vector2;\n  isDown: boolean;\n\n  constructor() {\n    this.element = document.createElement(\"div\");\n    this.element.style.pointerEvents = \"none\";\n    this.element.style.background = \"rgba(75, 160, 255, 0.3)\";\n    this.element.style.border = \"1px solid #55aaff\";\n    this.element.style.position = \"absolute\";\n    this.element.style.zIndex = \"2\";\n    this.startPoint = new Vector2();\n    this.pointTopLeft = new Vector2();\n    this.pointBottomRight = new Vector2();\n    this.isDown = false;\n  }\n\n  setRenderer(renderer) {\n    this.renderer = renderer;\n  }\n\n  onDown(screenX: number, screenY: number) {\n    this.isDown = true;\n\n    if (this.renderer.domElement && this.renderer.domElement.parentElement) {\n      this.renderer.domElement.parentElement.appendChild(this.element);\n    }\n    // document.body.appendChild(this.element);\n\n    // this.element.setAttribute(\"style\", `\n    //   left: ${screenX}px;\n    //   top: ${screenY}px;\n    //   width: 0px;\n    //   height: 0px;\n    // `);\n\n    if (this.element) {\n      this.element.style.left = screenX + \"px\";\n      this.element.style.top = screenY + \"px\";\n      this.element.style.width = \"0px\";\n      this.element.style.height = \"0px\";\n    }\n\n    this.startPoint.x = screenX;\n    this.startPoint.y = screenY;\n  }\n\n  onMove(screenX: number, screenY: number) {\n    if (this.isDown) {\n      this.pointBottomRight.x = Math.max(this.startPoint.x, screenX);\n      this.pointBottomRight.y = Math.max(this.startPoint.y, screenY);\n      this.pointTopLeft.x = Math.min(this.startPoint.x, screenX);\n      this.pointTopLeft.y = Math.min(this.startPoint.y, screenY);\n\n      if (this.element) {\n        this.element.style.left = this.pointTopLeft.x + \"px\";\n        this.element.style.top = this.pointTopLeft.y + \"px\";\n        this.element.style.width =\n          this.pointBottomRight.x - this.pointTopLeft.x + \"px\";\n        this.element.style.height =\n          this.pointBottomRight.y - this.pointTopLeft.y + \"px\";\n      }\n    }\n  }\n\n  onUp() {\n    // document.body.removeChild(this.element);\n    if (this.element && this.element.parentElement !== null) {\n      this.element.parentElement.removeChild(this.element);\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport {\n  AddObjects,\n  AppEventType,\n  ChangeUiSettings,\n} from \"../../../controllers/AppEventType\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { getBeadIdFromThreeName } from \"../../../editorObjects/Bead\";\nimport {\n  EditorMode,\n  ObjectTypes,\n  Point,\n  Region,\n} from \"../../../editorObjects/Editor\";\nimport { buildPoint } from \"../../../editorObjects/Point\";\nimport { buildRegion } from \"../../../editorObjects/Region\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"./../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"./../MouseSelectionHelper\";\nimport { screenToWorld } from \"./../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeAddRegion extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  mouseSelectionHelper: MouseSelectionHelper;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { top, left } = this.boundingClientRect;\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n    this.mouseSelectionHelper.onDown(screenX, screenY);\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { width, height, top, left } = this.boundingClientRect;\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n    this.mouseSelectionHelper.onMove(screenX, screenY);\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onMove(x, y);\n  }\n\n  onUp(event: PointerEvent) {\n    // const { getState, dispatch } = appStore;\n    // const { dispatch } = appStore;\n    // const state = getState();\n    const minX = Math.min(\n      this.mouseDragHelper.start.x,\n      this.mouseDragHelper.end.x\n    );\n    const minY = Math.min(\n      this.mouseDragHelper.start.y,\n      this.mouseDragHelper.end.y\n    );\n    const width = Math.abs(\n      this.mouseDragHelper.end.x - this.mouseDragHelper.start.x\n    );\n    const height = Math.abs(\n      this.mouseDragHelper.end.y - this.mouseDragHelper.start.y\n    );\n    // let defaultRegion: Partial<Region> = {\n    //  ...this.draftState.ui.regionTemplate,\n    // };\n    // defaultRegion.id = undefined;\n    // defaultRegion.position = buildPoint(minX + width / 2, minY + height / 2);\n    // defaultRegion.height = height;\n    // defaultRegion.width = width;\n\n    const action1: AddObjects = {\n      name: AppEventType.AddObjects,\n      payload: {\n        objects: [\n          {\n            objectType: ObjectTypes.Region,\n            height,\n            width,\n            position: {\n              x: minX + width / 2,\n              y: minY + height / 2,\n              z: 1\n            },\n          },\n        ],\n      },\n    };\n    sendEvent(action1);\n    const action2: ChangeUiSettings = {\n      name: AppEventType.ChangeUiSettings,\n      payload: {\n        uiSettings: {\n          mode: EditorMode.SelectOrMove,\n        },\n      },\n    };\n    sendEvent(action2);\n    // dispatch(\n    //   Actions.Region.action_addRegion(\n    //     this.mouseDragHelper.start as Point,\n    //     this.mouseDragHelper.end as Point\n    //   )\n    // );\n    // dispatch(\n    //   Actions.ChangeEditorMode.action_onChangeEditorMode(\n    //     EditorMode.SelectOrMove\n    //   )\n    // );\n    this.mouseDragHelper.onUp();\n    this.mouseSelectionHelper.onUp();\n  }\n}\n","import * as THREE from \"three\";\nimport { AppEventType, RemoveObjects } from \"../../../controllers/AppEventType\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport { getBeadIdFromThreeName } from \"../../../editorObjects/Bead\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"./../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"./../MouseSelectionHelper\";\nimport { screenToWorld } from \"./../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeDelete extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  mouseSelectionHelper: MouseSelectionHelper;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n    if (appThree.el === null) {\n      throw new Error(\"no el in dom\");\n    }\n    const { top, left } = appThree.el.getBoundingClientRect();\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n    this.mouseSelectionHelper.onDown(screenX, screenY);\n  }\n\n  onMove(event: PointerEvent) {}\n\n  onUp(event: PointerEvent) {\n    // const { getState, dispatch } = appStore;\n    // const state = getState();\n    if (this.mouseDragHelper.isDragged === true) {\n      // do nothing\n    } else if (\n      this.mouseDragHelper.isDragged === false &&\n      this.mouseDragHelper.isDragStarted === true\n    ) {\n      if (appThree.el !== null) {\n        const {\n          width,\n          height,\n          top,\n          left,\n        } = appThree.el.getBoundingClientRect();\n        this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n        this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n\n        this.intersects = this.getActiveObjectsFromIntersect(\n          event.clientX,\n          event.clientY\n        );\n        const firstClickedActiveObject = this.intersects.length > 0;\n\n        if (firstClickedActiveObject) {\n          console.log(\n            \"usuwam firstClickedActiveObject\",\n            firstClickedActiveObject,\n            this.intersects[0].object.userData.id\n          );\n          const objectId = this.intersects[0].object.userData.id;\n          const childrenIds = this.getIdsFromGroupOrInGroup(objectId);\n          const action: RemoveObjects = {\n            name: AppEventType.RemoveObjects,\n            payload: {\n              ids: [objectId, ...childrenIds],\n            },\n          };\n          sendEvent(action);\n          // dispatch(\n          //   Actions.Toolbar.action_deleteObjects([\n          //     this.intersects[0].object.userData.id,\n          //   ])\n          // );\n        }\n        // this.raycaster.setFromCamera(this.mouse, appThree.camera);\n        // const intersects = this.raycaster.intersectObjects(\n        //   appThree.scene.children,\n        //   true\n        // );\n        // const beadsIds: string[] = [];\n        // intersects.forEach((e) => {\n        //   const id = getBeadIdFromThreeName(e.object.name);\n        //   if (id !== undefined) {\n        //     if (state.appData.beads[id]) {\n        //       beadsIds.push(id);\n        //     } else {\n        //       console.warn(\"bead id missing in store\", id);\n        //     }\n        //   }\n        // });\n        // dispatch(Actions.Toolbar.action_deleteBeads(beadsIds));\n      }\n    } else {\n      // do nothing\n    }\n    this.mouseDragHelper.onUp();\n    this.mouseSelectionHelper.onUp();\n  }\n}\n","import { appStore } from \"../immerReducers/appStore\";\nimport { Actions } from \"../immerReducers/store\";\nimport { Store } from \"./store\";\n\nexport const refreshReactState = (newState: Store) => {\nconst { dispatch } = appStore;\ndispatch(Actions.Main.updateEditorState(newState))\n}","import { xor } from \"lodash\";\n\nexport const keyCodeToKeyName = {\n  8: \"backspace\",\n  9: \"tab\",\n  13: \"enter\",\n  16: \"shift\",\n  17: \"ctrl\",\n  18: \"alt\",\n  20: \"capslock\",\n  27: \"escape\",\n  32: \"space\",\n  33: \"pageup\",\n  34: \"pagedown\",\n  35: \"end\",\n  36: \"home\",\n  37: \"left\",\n  38: \"up\",\n  39: \"right\",\n  40: \"down\",\n  45: \"ins\",\n  46: \"del\",\n  91: \"meta\",\n  93: \"meta\",\n  224: \"meta\",\n\n  106: \"*\",\n  107: \"+\",\n  109: \"-\",\n  110: \".\",\n  111: \"/\",\n  186: \";\",\n  187: \"=\",\n  188: \",\",\n  189: \"-\",\n  190: \".\",\n  191: \"/\",\n  192: \"`\",\n  219: \"[\",\n  220: \"\\\\\",\n  221: \"]\",\n  222: \"'\",\n\n  ArrowUp: \"Up\",\n  ArrowDown: \"Down\",\n  ArrowLeft: \"Left\",\n  ArrowRight: \"Right\",\n};\n\nexport const modifiers = {\n  ShiftLeft: \"shift\",\n  ShiftRight: \"shift\",\n  AltLeft: \"alt\",\n  AltRight: \"alt\",\n  MetaLeft: \"meta\",\n  MetaRight: \"meta\",\n  ControlLeft: \"control\",\n  ControlRight: \"control\",\n};\n\nexport const isEventModifier = (event) => {\n  // new browsers\n  if (\"code\" in event) {\n    return !!modifiers[event.code];\n  }\n\n  // old browsers\n  return (\n    event.which === 16 ||\n    event.which === 17 ||\n    event.which === 18 ||\n    event.which === 91\n  );\n};\n\nexport const getKeyEventName = (event) => {\n  let keyName = \"\";\n  const keys: string[] = [];\n\n  if (\"code\" in event) {\n    keyName = keyCodeToKeyName[event.code]\n      ? keyCodeToKeyName[event.code]\n      : event.code;\n  } else {\n    const keyCode = event.which;\n    keyName = String.fromCharCode(keyCode).toLowerCase();\n    if (keyCodeToKeyName[keyCode]) {\n      keyName = keyCodeToKeyName[keyCode];\n    }\n  }\n\n  //   if (event.altKey) {\n  //     keys.push(\"Alt\");\n  //   }\n\n  //   if (event.shiftKey) {\n  //     keys.push(\"Shift\");\n  //   }\n\n  //   if (event.ctrlKey) {\n  //     keys.push(\"Ctrl\");\n  //   }\n\n  //   if (event.metaKey) {\n  //     keys.push(\"Meta\");\n  //   }\n\n  keys.push(keyName);\n\n  return keys.join(\"+\");\n};\n\nexport const isInputElement = (element) => {\n  if (!element || !element.tagName) {\n    return false;\n  }\n\n  return (\n    element.tagName === \"BUTTON\" ||\n    element.tagName === \"INPUT\" ||\n    element.tagName === \"SELECT\" ||\n    element.tagName === \"TEXTAREA\"\n  );\n};\n\nexport const defaultMonitor = (eventName) => {\n  // console.log(\":keyboard event:\", eventName);\n};\n\nexport const isInputEvent = (event) => {\n  return isInputElement(event.target || event.nativeEvent.target);\n};\n\nlet __preventDefaultEvents = false;\nlet __ignoreInputEvents = false;\nlet __pressed = {};\nlet __element: Element | Document | undefined = undefined;\nlet __subscriptions = {};\nlet __monitor: (\n  eventName: string,\n  matched: boolean,\n  event: any\n) => void = defaultMonitor;\n\nexport function initKeybinding(element: Element | Document | null = null) {\n  if (typeof window === \"undefined\") {\n    // not a browser environment?\n    return false;\n  }\n\n  // default element is the window document\n  if (element === null) {\n    __element = window.document;\n  }\n\n  // ignore input events, except when the element is an input.\n  __ignoreInputEvents = !isInputElement(__element);\n\n  let hidden, visibilityChange;\n  if (typeof document.hidden !== \"undefined\") {\n    // Opera 12.10 and Firefox 18 and later support\n    hidden = \"hidden\";\n    visibilityChange = \"visibilitychange\";\n  } else if (typeof (document as any).msHidden !== \"undefined\") {\n    hidden = \"msHidden\";\n    visibilityChange = \"msvisibilitychange\";\n  } else if (typeof (document as any).webkitHidden !== \"undefined\") {\n    hidden = \"webkitHidden\";\n    visibilityChange = \"webkitvisibilitychange\";\n  }\n  function handleVisibilityChange() {\n    // console.log(\"handleVisibilityChange.... \", document[hidden]);\n    if (document[hidden]) {\n      __pressed = {};\n    }\n  }\n  if (\n    typeof document.addEventListener === \"undefined\" ||\n    hidden === undefined\n  ) {\n    console.warn(\n      \"This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API.\"\n    );\n  } else {\n    document.addEventListener(visibilityChange, handleVisibilityChange, false);\n    // console.log(\"podpinamm... visibilityChange\");\n  }\n}\n\n// creates a subscription and returns the unsubscribe function;\nexport const subscribeKeys = (\n  name: string,\n  callback: (event: KeyboardEvent, pressed: string[]) => void\n) => {\n  // Subscripton names are lowercased so both 'Shift+Space' and 'shift+space' works.\n  name = name.toLowerCase();\n  // remove spaces so both 'Shift + Space' and 'shift+space' works.\n  name.replace(/\\s/, \"\");\n\n  if (typeof __subscriptions[name] === \"undefined\") {\n    __subscriptions[name] = [];\n  }\n\n  __subscriptions[name].push(callback);\n\n  return {\n    unsubscribe: () => {\n      const index = __subscriptions[name].indexOf(callback);\n      __subscriptions[name].splice(index, 1);\n    },\n  };\n};\n\n// alows to set a monitor function that will run on every event\nexport function setMonitor(\n  enabled: boolean,\n  monitorFn?: (eventName: string, matched: boolean, event: any) => void\n) {\n  if (enabled === false) {\n    __monitor = () => {};\n  } else {\n    if (monitorFn !== undefined) {\n      __monitor = monitorFn;\n    } else {\n      __monitor = defaultMonitor;\n    }\n  }\n}\n\nexport function startListeningKeys() {\n  if (__element !== undefined) {\n    (__element as any).addEventListener(\"keydown\", handleKeyEvent);\n    __element.addEventListener(\"keyup\", unhandleKeyEvent);\n  }\n}\n\nexport function stopListeningKeys() {\n  if (__element !== undefined) {\n    (__element as any).removeEventListener(\"keydown\", handleKeyEvent);\n    __element.removeEventListener(\"keyup\", unhandleKeyEvent);\n  }\n}\n\nexport function setPreventDefault(newValue: boolean) {\n  __preventDefaultEvents = newValue;\n}\n\nexport function isPressedKey(eventName: string) {\n  return __pressed[eventName] === true;\n}\nexport function isPressedKeys(eventNames: string[]) {\n  return xor(Object.keys(__pressed), eventNames).length === 0;\n}\n\nexport function getKeysPressed() {\n  return Object.keys(__pressed);\n}\n\nfunction unhandleKeyEvent(event: Event) {\n  __pressed = {};\n}\n\n// listens to the event and fires the appropiate event subscription\nfunction handleKeyEvent(event: KeyboardEvent) {\n  if (__preventDefaultEvents === true) {\n    event.preventDefault();\n  }\n\n  //   console.log(\"handleKeyEventhandleKeyEvent\", 1);\n  //   if (isEventModifier(event)) {\n  //     return;\n  //   }\n  //   console.log(\"handleKeyEventhandleKeyEvent\", 2);\n\n  //   if (__ignoreInputEvents && isInputEvent(event)) {\n  //     return;\n  //   }\n\n  const eventName = getKeyEventName(event);\n  const listeners = __subscriptions[eventName.toLowerCase()] || [];\n\n  if (typeof __monitor === \"function\") {\n    const matched = listeners.length > 0;\n    __monitor(eventName, matched, event);\n  }\n  __pressed[eventName.toLowerCase()] = true;\n\n  if (listeners.length > 0) {\n    event.preventDefault();\n  }\n\n  let propagate = true;\n\n  for (let i = listeners.length - 1; i >= 0; i--) {\n    if (listeners[i]) {\n      propagate = listeners[i](event, Object.keys(__pressed));\n    }\n    if (propagate === false) {\n      break;\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport { Frustum, Vector3 } from \"three\";\nimport { ObjectTypes } from \"../../editorObjects/Editor\";\n\nexport class SelectionFilter {\n  frustum: THREE.Frustum = new Frustum();\n  center: THREE.Vector3 = new Vector3();\n\n  tmpPoint: THREE.Vector3 = new Vector3();\n\n  vecNear: THREE.Vector3 = new Vector3();\n  vecTopLeft: THREE.Vector3 = new Vector3();\n  vecTopRight: THREE.Vector3 = new Vector3();\n  vecDownRight: THREE.Vector3 = new Vector3();\n  vecDownLeft: THREE.Vector3 = new Vector3();\n  vecFarTopLeft: THREE.Vector3 = new Vector3();\n  vecFarTopRight: THREE.Vector3 = new Vector3();\n  vecFarDownRight: THREE.Vector3 = new Vector3();\n  vecFarDownLeft: THREE.Vector3 = new Vector3();\n\n  vectemp1: THREE.Vector3 = new Vector3();\n  vectemp2: THREE.Vector3 = new Vector3();\n  vectemp3: THREE.Vector3 = new Vector3();\n  startPoint: THREE.Vector3;\n  endPoint: THREE.Vector3;\n  collection: any[];\n  deep: number = Number.MAX_VALUE;\n  camera?: THREE.OrthographicCamera;\n  scene?: THREE.Scene;\n  selectedIds: string[];\n\n  constructor() {\n    this.startPoint = new Vector3();\n    this.endPoint = new Vector3();\n    this.collection = [];\n    this.selectedIds = [];\n  }\n\n  setCamera(camera: THREE.OrthographicCamera) {\n    this.camera = camera;\n  }\n\n  setScene(scene: THREE.Scene) {\n    this.scene = scene;\n  }\n\n  select(startPoint?: THREE.Vector3, endPoint?: THREE.Vector3) {\n    this.startPoint = startPoint ?? this.startPoint;\n    this.endPoint = endPoint ?? this.endPoint;\n    this.collection = [];\n\n    if (!this.scene) {\n      return this.collection;\n    }\n\n    this.selectedIds = [];\n    this.updateFrustum(this.startPoint, this.endPoint);\n\n    // @TODO: NEED pixel-perfect match\n    this.searchChildInFrustum(this.frustum, this.scene);\n    this.selectedIds = [];\n    // this.scene.children.forEach((child) => {\n    //   child.traverse((object) => {\n    //     if (object instanceof THREE.Mesh && object.name.length > 0) {\n    //       // @TODO: NEED pixel-perfect match\n    //       const bbox = new THREE.Box3().setFromObject(object);\n    //       if (this.frustum.intersectsBox(bbox)) {\n    //         this.collection.push(object);\n    //       }\n    //       if (this.frustum.intersectsObject(object)) {\n    //         this.collection.push(object);\n    //       }\n    //     }\n    //   });\n    // });\n    return this.collection;\n  }\n\n  selectIds(startPoint?: THREE.Vector3, endPoint?: THREE.Vector3) {\n    this.startPoint = startPoint ?? this.startPoint;\n    this.endPoint = endPoint ?? this.endPoint;\n    this.collection = [];\n\n    if (!this.scene) {\n      return this.collection;\n    }\n\n    this.selectedIds = [];\n    this.updateFrustum(this.startPoint, this.endPoint);\n    this.searchChildInFrustum(this.frustum, this.scene);\n    return this.selectedIds\n  }\n\n\n  updateFrustum(_startPoint?: THREE.Vector3, _endPoint?: THREE.Vector3) {\n    if (!this.camera) {\n      return;\n    }\n    const startPoint = _startPoint ?? this.startPoint;\n    const endPoint = _endPoint ?? this.endPoint;\n\n    // Avoid invalid frustum\n    if (startPoint.x === endPoint.x) {\n      endPoint.x += Number.EPSILON;\n    }\n\n    if (startPoint.y === endPoint.y) {\n      endPoint.y += Number.EPSILON;\n    }\n\n    this.camera.updateProjectionMatrix();\n    this.camera.updateMatrixWorld();\n\n    if (this.camera.isOrthographicCamera) {\n      var left = Math.min(startPoint.x, endPoint.x);\n      var top = Math.max(startPoint.y, endPoint.y);\n      var right = Math.max(startPoint.x, endPoint.x);\n      var down = Math.min(startPoint.y, endPoint.y);\n\n      this.vecTopLeft.set(left, top, -1);\n      this.vecTopRight.set(right, top, -1);\n      this.vecDownRight.set(right, down, -1);\n      this.vecDownLeft.set(left, down, -1);\n\n      this.vecFarTopLeft.set(left, top, 1);\n      this.vecFarTopRight.set(right, top, 1);\n      this.vecFarDownRight.set(right, down, 1);\n      this.vecFarDownLeft.set(left, down, 1);\n\n      this.vecTopLeft.unproject(this.camera);\n      this.vecTopRight.unproject(this.camera);\n      this.vecDownRight.unproject(this.camera);\n      this.vecDownLeft.unproject(this.camera);\n\n      this.vecFarTopLeft.unproject(this.camera);\n      this.vecFarTopRight.unproject(this.camera);\n      this.vecFarDownRight.unproject(this.camera);\n      this.vecFarDownLeft.unproject(this.camera);\n\n      var planes = this.frustum.planes;\n\n      planes[0].setFromCoplanarPoints(\n        this.vecTopLeft,\n        this.vecFarTopLeft,\n        this.vecFarTopRight\n      );\n      planes[1].setFromCoplanarPoints(\n        this.vecTopRight,\n        this.vecFarTopRight,\n        this.vecFarDownRight\n      );\n      planes[2].setFromCoplanarPoints(\n        this.vecFarDownRight,\n        this.vecFarDownLeft,\n        this.vecDownLeft\n      );\n      planes[3].setFromCoplanarPoints(\n        this.vecFarDownLeft,\n        this.vecFarTopLeft,\n        this.vecTopLeft\n      );\n      planes[4].setFromCoplanarPoints(\n        this.vecTopRight,\n        this.vecDownRight,\n        this.vecDownLeft\n      );\n      planes[5].setFromCoplanarPoints(\n        this.vecFarDownRight,\n        this.vecFarTopRight,\n        this.vecFarTopLeft\n      );\n      planes[5].normal.multiplyScalar(-1);\n    } else {\n      console.error(\"THREE.SelectionBox: Unsupported camera type.\");\n    }\n  }\n\n  // @INFO: Not used, there is need for pixel perfect raycasting\n  searchChildInFrustum(frustum: THREE.Frustum, object: any) {\n    if (object.isMesh || object.isLine || object.isPoints) {\n      if (object.material !== undefined) {\n        // if (object.geometry.boundingSphere === null) {\n        //   object.geometry.computeBoundingSphere();\n        // }\n        const data = object.userData;\n        const id = data?.id ?? undefined;\n        if (id !== undefined) {\n          // const isLocked = data?.isLocked ?? false;\n          const objectType = data?.objectType ?? undefined;\n          const isAppObject =\n            objectType === ObjectTypes.Bead ||\n            objectType === ObjectTypes.Region ||\n            objectType === ObjectTypes.Group ||\n            objectType === ObjectTypes.PreviewProject3D;\n\n          if (isAppObject === true) {\n            const bbox = new THREE.Box3().setFromObject(object);\n            if (frustum.intersectsBox(bbox)) {\n              if (this.selectedIds.includes(id) === false) {\n                this.collection.push(object);\n                this.selectedIds.push(id);\n              }\n            }\n          }\n        }\n\n        // this.center.copy(\n        //   object.geometry.boundingSphere.center\n        // );\n        // this.center.applyMatrix4(object.matrixWorld);\n        // if (frustum.containsPoint(this.center)) {\n        //   this.collection.push(object);\n        // }\n      }\n    }\n\n    if (object.children && object.children.length > 0) {\n      for (var x = 0; x < object.children.length; x++) {\n        this.searchChildInFrustum(frustum, object.children[x]);\n      }\n    }\n  }\n}\n","import { EditorMode } from \"../../editorObjects/Editor\";\nimport { appThree } from \"../renderThreejs\";\nimport { MouseEventsEditorModeAddBead } from \"./mouseEventEditorMode/MouseEventsEditorModeAddBead\";\nimport { MouseEventsEditorModeAddRegion } from \"./mouseEventEditorMode/MouseEventsEditorModeAddRegion\";\nimport { MouseEventsEditorModeDelete } from \"./mouseEventEditorMode/MouseEventsEditorModeDelete\";\nimport { MouseEventsEditorModeSelectOrMove } from \"./mouseEventEditorMode/MouseEventsEditorModeSelectOrMove\";\nimport { MouseEventsEditorModeIdle } from \"./mouseEventEditorMode/MouseEventsEditorModeIdle\";\nimport { MouseEventsEditorModePaint } from \"./mouseEventEditorMode/MouseEventsEditorModePaint\";\nimport { MouseEventsEditorModeSelectMultiple } from \"./mouseEventEditorMode/MouseEventsEditorModeSelectMultiple\";\nimport { getStore } from \"../../controllers/store\";\nimport {\n  AppEventType,\n  ChangeUiSettingsZoom,\n} from \"../../controllers/AppEventType\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport { setMousePositionAtWindow } from \"./mouseScreenPosition\";\n\nlet moudeEditorModeIdle,\n  moudeEditorModeSelectOrMove,\n  moudeEditorModePaint,\n  moudeEditorModeDelete,\n  moudeEditorModeAddRegion,\n  moudeEditorModeAddBead,\n  moudeEditorModeSelectMultiple;\n\nexport const initMouseListeners = () => {\n  window.addEventListener(\"resize\", onWindowResize, false);\n\n  appThree.el.addEventListener(\"pointerdown\", onPointerDown, false);\n  appThree.el.addEventListener(\"pointermove\", onPointerMove, false);\n  appThree.el.addEventListener(\"pointerup\", onPointerUp, false);\n  appThree.el.addEventListener(\"mouseout\", onPointerOut, false);\n  appThree.el.addEventListener(\"wheel\", onWheel, false);\n\n  moudeEditorModeIdle = new MouseEventsEditorModeIdle();\n  moudeEditorModeSelectOrMove = new MouseEventsEditorModeSelectOrMove();\n  moudeEditorModePaint = new MouseEventsEditorModePaint();\n  moudeEditorModeDelete = new MouseEventsEditorModeDelete();\n  moudeEditorModeAddRegion = new MouseEventsEditorModeAddRegion();\n  moudeEditorModeAddBead = new MouseEventsEditorModeAddBead();\n  moudeEditorModeSelectMultiple = new MouseEventsEditorModeSelectMultiple();\n};\n\nfunction onWheel(event) {\n  event.preventDefault();\n  if (appThree.el === null) {\n    return;\n  }\n\n  const store = getStore();\n  // const { width, height, top, left } = appThree.el.getBoundingClientRect();\n\n  // const screenX = event.clientX - left;\n  // const screenY = event.clientY - top;\n\n  // const cameraX = appThree.camera.position.x;\n  // const cameraY = appThree.camera.position.y;\n\n  // const mouseXInWorldBefore = (screenX - width / 2) * store.ui.zoomScale;\n  // const mouseYInWorldBefore = -1 * (screenY - height / 2) * store.ui.zoomScale;\n\n  // const zoomChange = store.ui.zoomScale >= 0.35 ? 0.02 * 5 : 0.01;\n  // const zoomMax = 100;\n  // const zoomMin = 0.0125;\n  // let sceneScale = 1;\n  // sceneScale = store.ui.zoomScale + Math.sign(event.deltaY) * zoomChange;\n  // sceneScale = Math.min(Math.max(zoomMin, sceneScale), zoomMax);\n\n  // const mouseXInWorldAfter = (screenX - width / 2) * sceneScale;\n  // const mouseYInWorldAfter = -1 * (screenY - height / 2) * sceneScale;\n\n  // appThree.camera.left = (width * sceneScale) / -2;\n  // appThree.camera.right = (width * sceneScale) / 2;\n  // appThree.camera.top = (height * sceneScale) / 2;\n  // appThree.camera.bottom = (height * sceneScale) / -2;\n  // appThree.camera.updateProjectionMatrix();\n\n  // const diffX = mouseXInWorldBefore - mouseXInWorldAfter;\n  // const diffY = mouseYInWorldBefore - mouseYInWorldAfter;\n\n  // appThree.camera.position.x = cameraX + diffX;\n  // appThree.camera.position.y = cameraY + diffY;\n  // appThree.camera.lookAt(\n  //   appThree.camera.position.x,\n  //   appThree.camera.position.y,\n  //   0\n  // );\n\n  // const rect10x10FromScreenToWorld = getRect10x10FromScreenToWorld();\n  // appThree.camera.userData = { sceneScale, rect10x10FromScreenToWorld };\n\n  const updateUiEvent: ChangeUiSettingsZoom = {\n    name: AppEventType.ChangeUiSettingsZoom,\n    payload: {\n      zoomType: \"zoomByScroll\",\n      useAnimation: false,\n      clientX: event.clientX,\n      clientY: event.clientY,\n      scrollDelta: event.deltaY,\n    },\n  };\n  sendEvent(updateUiEvent);\n\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onWheel(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onWheel(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onWheel(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onWheel(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onWheel(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onWheel(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onWheel(event);\n  }\n}\n\nfunction onWindowResize(event) {\n  if (appThree.el !== null) {\n    const { width, height } = appThree.el.getBoundingClientRect();\n    appThree.camera.left = width / -2;\n    appThree.camera.right = width / 2;\n    appThree.camera.top = height / 2;\n    appThree.camera.bottom = height / -2;\n    appThree.camera.updateProjectionMatrix();\n    appThree.renderer.setSize(width, height);\n  }\n\n  const store = getStore();\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onResize(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onResize(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onResize(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onResize(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onResize(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onResize(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onResize(event);\n  }\n}\n\nfunction onPointerDown(event: PointerEvent) {\n  const store = getStore();\n\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onDown(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onDown(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onDown(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onDown(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onDown(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onDown(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onDown(event);\n  }\n}\n\nfunction onPointerUp(event: MouseEvent) {\n  const store = getStore();\n  if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onUp(event);\n  } else if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onUp(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onUp(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onUp(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onUp(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onUp(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onUp(event);\n  }\n}\n\nfunction onPointerOut(event: MouseEvent) {\n  setMousePositionAtWindow(undefined, undefined);\n  onPointerUp(event);\n}\n\nfunction onPointerMove(event: MouseEvent) {\n  setMousePositionAtWindow(event.clientX, event.clientY);\n\n  const store = getStore();\n\n  if (store.ui.mode === EditorMode.Idle) {\n    moudeEditorModeIdle.onMove(event);\n  } else if (store.ui.mode === EditorMode.SelectOrMove) {\n    moudeEditorModeSelectOrMove.onMove(event);\n  } else if (store.ui.mode === EditorMode.PaintBeads) {\n    moudeEditorModePaint.onMove(event);\n  } else if (store.ui.mode === EditorMode.AddRegion) {\n    moudeEditorModeAddRegion.onMove(event);\n  } else if (store.ui.mode === EditorMode.DeleteBeads) {\n    moudeEditorModeDelete.onMove(event);\n  } else if (store.ui.mode === EditorMode.AddBeads) {\n    moudeEditorModeAddBead.onMove(event);\n  } else if (store.ui.mode === EditorMode.SelectMultiple) {\n    moudeEditorModeSelectMultiple.onMove(event);\n  }\n}\n","import { appThree } from \"../../renderThreejs\";\nimport * as THREE from \"three\";\nimport { getStore } from \"../../../controllers/store\";\n\nexport class MouseEventsIdle {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n\n  constructor() {\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n\n    if (this.boundingClientRect === undefined) {\n      return [];\n    }\n\n    this.isCameraGrabed = true;\n\n    this.boundingClientRect = appThree.el.getBoundingClientRect();\n    const { top, left } = this.boundingClientRect;\n\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n\n    this.startDragMousePosition.x = screenX;\n    this.startDragMousePosition.y = screenY;\n\n    this.startDragCamera.x = appThree.camera.position.x;\n    this.startDragCamera.y = appThree.camera.position.y;\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n\n    if (this.isCameraGrabed === true) {\n      const store = getStore();\n\n      const { top, left } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n      const sceneScale = store.ui.zoomScale;\n\n      const screenMouseDiffX = this.startDragMousePosition.x - screenX;\n      const screenMouseDiffY = this.startDragMousePosition.y - screenY;\n\n      const mouseDiffXInWorldSpace = screenMouseDiffX * sceneScale;\n      const mouseDiffYInWorldSpace = screenMouseDiffY * sceneScale;\n\n      const cameraX = this.startDragCamera.x + mouseDiffXInWorldSpace;\n      const cameraY = this.startDragCamera.y - mouseDiffYInWorldSpace;\n\n      appThree.camera.position.x = cameraX;\n      appThree.camera.position.y = cameraY;\n      appThree.camera.lookAt(cameraX, cameraY, 0);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    this.boundingClientRect = undefined;\n    if (this.isCameraGrabed === true) {\n      this.isCameraGrabed = false;\n    }\n  }\n}\n","import { produce } from \"immer\";\nimport {\n  AppEventType,\n  ChangeObjectsProperty,\n  ChangeSelectObjects,\n} from \"../../../controllers/AppEventType\";\nimport { refreshReactState } from \"../../../controllers/refreshReactState\";\nimport { getStore, setStore } from \"../../../controllers/store\";\nimport { sendEvent } from \"../../../controllers/storeController\";\nimport {\n  AppObject,\n  Bead,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n  Region,\n} from \"../../../editorObjects/Editor\";\nimport { getStateObjectFromObjectId } from \"../../../editorObjects/editorGetters\";\nimport { logger } from \"../../../logger\";\nimport { getTopBarPosition } from \"../../eventEmitterHandlers\";\nimport { getKeysPressed, isPressedKey } from \"../../keyboard/keyMap\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"../MouseSelectionHelper\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport { SelectionFilter } from \"../SelectionFilter\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\nimport { MouseEventsIdle } from \"./MouseEventsIdle\";\n\nexport class MouseEventsEditorModeSelectOrMove extends MouseEventsBase {\n  actionType:\n    | \"moveCamera\"\n    | \"moveAllSelectedObjects\"\n    | \"moveEditBBox\"\n    | \"moveObjectGroup\"\n    | \"moveSingleObject\"\n    | \"selectMultipleObjects\"\n    | \"deselectMultipleObjects\"\n    | undefined;\n  // isCameraGrabed: boolean;\n  // startDragMousePosition: THREE.Vector2;\n  // startDragCamera: THREE.Vector2;\n  // boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  // mouse: THREE.Vector2;\n  // raycaster: THREE.Raycaster;\n  selectionBox: SelectionFilter;\n  mouseSelectionHelper: MouseSelectionHelper;\n  prevEditBBox: any | undefined;\n  mouseEventsIdle: MouseEventsIdle;\n\n  constructor() {\n    super();\n    // this.boundingClientRect = undefined;\n    // this.isCameraGrabed = false;\n    // this.startDragMousePosition = new THREE.Vector2();\n    // this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    // this.mouse = new THREE.Vector2();\n    // this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n\n    this.selectionBox = new SelectionFilter();\n    this.selectionBox.setCamera(appThree.camera);\n    this.selectionBox.setScene(appThree.scene);\n\n    this.mouseEventsIdle = new MouseEventsIdle();\n    this.actionType = undefined;\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    logger.trace(\n      \"MouseEventsEditorModeSelectOrMove: jak z kliknieciem???\",\n      getKeysPressed(),\n      isPressedKey(\"space\")\n    );\n\n    if (isPressedKey(\"space\")) {\n      this.actionType = \"moveCamera\";\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      this.mouseEventsIdle.onDown(event);\n      logger.trace(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    // event.altKey;\n    // event.shiftKey;\n    // event.ctrlKey;\n\n    // if (isPressedKey(\"altleft\") || isPressedKey(\"altright\")) {\n    if (event.altKey) {\n      // if (firstSelectedLocked === true) {\n      //   return;\n      // }\n      this.actionType = \"deselectMultipleObjects\";\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      if (appThree.el !== null) {\n        this.boundingClientRect = appThree.el.getBoundingClientRect();\n      }\n      if (this.boundingClientRect === undefined) {\n        return;\n      }\n      const { top, left, width, height } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n\n      this.mouseSelectionHelper.onDown(screenX, screenY);\n\n      this.selectionBox.startPoint.set(\n        ((event.clientX - left) / width) * 2 - 1,\n        -((event.clientY - top) / height) * 2 + 1,\n        0\n      );\n      logger.trace(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    if (event.shiftKey) {\n      // if (firstSelectedLocked === true) {\n      //   return;\n      // }\n      // if (isPressedKey(\"shiftleft\") || isPressedKey(\"shiftright\")) {\n      this.actionType = \"selectMultipleObjects\";\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      if (appThree.el !== null) {\n        this.boundingClientRect = appThree.el.getBoundingClientRect();\n      }\n      if (this.boundingClientRect === undefined) {\n        return;\n      }\n      const { top, left, width, height } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n\n      this.mouseSelectionHelper.onDown(screenX, screenY);\n\n      this.selectionBox.startPoint.set(\n        ((event.clientX - left) / width) * 2 - 1,\n        -((event.clientY - top) / height) * 2 + 1,\n        0\n      );\n      logger.trace(\n        \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n        this.actionType\n      );\n      return;\n    }\n\n    this.actionType = undefined;\n    this.intersects = this.getActiveObjectsFromIntersect(\n      event.clientX,\n      event.clientY\n    );\n    const firstClickedActiveObject = this.intersects.length > 0;\n\n    if (firstClickedActiveObject) {\n      // object,camera,renderer.domElement.width,renderer.domElement.height,true\n      // const value = getTopBarPositionInScreen(this.intersects[0].object);\n      // const el = document.querySelector(\n      //   \".actions-wrapper\"\n      // ) as HTMLDivElement | null;\n      // if (el !== null) {\n      //   el.style.position = \"fixed\";\n      //   el.style.top = `${value.y}px`;\n      //   el.style.left = `${value.x}px`;\n      //   el.style.transform = \"none\";\n      // }\n      // logger.trace(\"???\", value);\n\n      // const { getState } = appStore;\n      // const state = getState();\n      const store = getStore();\n      const id = this.intersects[0].object.userData.id ?? undefined;\n      // const clicked = store.objects[id]\n      const clicked = this.intersects[0].object.userData as AppObject;\n      const clickedId = clicked.id;\n      // store\n      const clickedItemInSelectedObjects = store.selectedIds.includes(\n        clickedId\n      );\n\n      let selectedIsLocked: any = false;\n      store.selectedIds.forEach((id) => {\n        if (store.objects[id].isLocked === true) {\n          selectedIsLocked = true;\n        }\n      });\n\n      if (clicked.isLocked === true) {\n        sendEvent(this.getSelectionForSingleObjectIdAction(clickedId));\n        // if (store.selectedIds.length === 0) {\n        //   // sendEvent(\n        //   //   this.getSelectionAppendAction([clickedId], undefined, false)\n        //   // );\n        //   sendEvent(this.getSelectionForSingleObjectIdAction(clickedId))\n        // } else {\n        //   sendEvent(this.getSelectionForSingleObjectIdAction(clickedId));\n        //   // do nothing\n        // }\n      } else if (selectedIsLocked === true) {\n        sendEvent(this.getSelectionForSingleObjectIdAction(clickedId));\n        // nothing\n      } else if (clickedItemInSelectedObjects) {\n        this.actionType = \"moveAllSelectedObjects\";\n        const { x, y } = screenToWorld(event.clientX, event.clientY);\n        // logger.trace(\"-------------- \", event.clientX, event.clientY, x, y);\n        this.mouseDragHelper.onDown(x, y);\n      } else {\n        const isEditBBox =\n          clicked.objectType !== undefined &&\n          clicked.objectType === ObjectTypes.SceneEditBBox;\n\n        if (isEditBBox) {\n          this.actionType = \"moveEditBBox\";\n          const { x, y } = screenToWorld(event.clientX, event.clientY);\n          this.mouseDragHelper.onDown(x, y);\n        } else {\n          const isGroup =\n            clicked.objectType !== undefined &&\n            clicked.objectType === ObjectTypes.Group;\n\n          const isGroupChild =\n            clicked[groupIdKey] !== undefined && clicked[groupIdKey].length > 0;\n\n          const isClickedOnGroup = isGroup || isGroupChild;\n\n          if (isClickedOnGroup) {\n            this.actionType = \"moveObjectGroup\";\n          } else {\n            this.actionType = \"moveSingleObject\";\n          }\n          const { x, y } = screenToWorld(event.clientX, event.clientY);\n          this.mouseDragHelper.onDown(x, y);\n        }\n      }\n    } else {\n      this.actionType = \"moveCamera\";\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onDown(x, y);\n      this.mouseEventsIdle.onDown(event);\n    }\n\n    logger.trace(\n      \"MouseEventsEditorModeSelectOrMove: onDown action type\",\n      this.actionType\n    );\n\n    // if (this.intersects.length > 0) {\n    //   this.actionType = \"objectMove\";\n    //   const { x, y } = screenToWorld(event.clientX, event.clientY);\n    //   this.mouseDragHelper.onDown(x, y);\n    //   // action_unselectAll\n    //   // this.createEditBBox();\n    // } else {\n    //   this.actionType = \"cameraMove\";\n    //   this.mouseEventsIdle.onDown(event);\n    // }\n\n    // if (\n    //   state.ui.selectedBeadsIdsCount === 0 &&\n    //   state.ui.selectedRegionsIdsCount === 0\n    // ) {\n    //   const { width, height, top, left } = this.boundingClientRect;\n    //   const screenX = event.clientX - left;\n    //   const screenY = event.clientY - top;\n    //   this.mouseSelectionHelper.onDown(screenX, screenY);\n    //   this.selectionBox.startPoint.set(\n    //     ((event.clientX - left) / width) * 2 - 1,\n    //     -((event.clientY - top) / height) * 2 + 1,\n    //     0\n    //   );\n    // } else {\n    //   const { width, height, top, left } = this.boundingClientRect;\n    //   this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n    //   this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n    //   this.raycaster.setFromCamera(this.mouse, appThree.camera);\n\n    //   const intersects = this.raycaster.intersectObjects(\n    //     appThree.scene.children,\n    //     true\n    //   );\n\n    //   if (intersects.length > 0) {\n    //   }\n    //   const beadsIds: string[] = [];\n    //   const regionIds: string[] = [];\n    //   const editBBoxIds: string[] = [];\n    //   intersects.forEach((e) => {\n    //     const name = e.object.name;\n    //     const beadId = getBeadIdFromThreeName(name);\n    //     if (beadId !== undefined) {\n    //       if (state.appData.beads[beadId]) {\n    //         if (beadsIds.includes(beadId) === false) {\n    //           beadsIds.push(beadId);\n    //           return;\n    //         }\n    //       } else {\n    //         console.warn(\"bead id missing in store\", beadId);\n    //       }\n    //     }\n\n    //     const regionId = getRegionIdFromThreeName(name);\n    //     if (regionId !== undefined) {\n    //       if (state.appData.regions[regionId]) {\n    //         if (regionIds.includes(regionId) === false) {\n    //           regionIds.push(regionId);\n    //           return;\n    //         }\n    //       } else {\n    //         console.warn(\"region id missing in store\", regionId);\n    //       }\n    //     }\n\n    //     const editBBoxId = getEditBBoxIdFromThreeName(name);\n    //     if (editBBoxId !== undefined) {\n    //       if (state.ui.editBBox && state.ui.editBBox.id === editBBoxId) {\n    //         if (editBBoxIds.includes(editBBoxId) === false) {\n    //           editBBoxIds.push(editBBoxId);\n    //           return;\n    //         }\n    //       } else {\n    //         console.warn(\"editbbox id missing in store\", editBBoxId);\n    //       }\n    //     }\n    //   });\n\n    //   if (editBBoxIds.length > 0) {\n    //     this.mouseDragHelper.shouldBehaveLikeMove = true;\n    //     this.createEditBBox();\n    //   } else {\n    //     const diffBeads = difference(\n    //       beadsIds,\n    //       Object.keys(state.ui.selectedBeadsIds)\n    //     );\n\n    //     const diffRegions = difference(\n    //       regionIds,\n    //       Object.keys(state.ui.selectedRegionsIds)\n    //     );\n\n    //     if (\n    //       (beadsIds.length > 0 && diffBeads.length === 0) ||\n    //       (regionIds.length > 0 && diffRegions.length === 0)\n    //     ) {\n    //       this.mouseDragHelper.shouldBehaveLikeMove = true;\n    //       this.createEditBBox();\n    //     } else {\n    //       const { width, height, top, left } = this.boundingClientRect;\n    //       const screenX = event.clientX - left;\n    //       const screenY = event.clientY - top;\n    //       this.mouseSelectionHelper.onDown(screenX, screenY);\n    //       this.selectionBox.startPoint.set(\n    //         ((event.clientX - left) / width) * 2 - 1,\n    //         -((event.clientY - top) / height) * 2 + 1,\n    //         0\n    //       );\n    //     }\n    //   }\n    // }\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.actionType === undefined) {\n      return;\n    }\n\n    // logger.trace(\"jak z kliknieciem???\", getKeysPressed(), isPressedKey(\"space\"));\n\n    if (this.actionType === \"moveCamera\") {\n      const { x, y } = screenToWorld(event.clientX, event.clientY);\n      this.mouseDragHelper.onMove(x, y);\n      this.mouseEventsIdle.onMove(event);\n      this.updateUIAtMove(false);\n    }\n\n    if (this.actionType === \"moveAllSelectedObjects\") {\n      this.moveAllSelectedObjects(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === \"moveSingleObject\") {\n      this.moveSingleObject(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === \"moveObjectGroup\") {\n      this.moveObjectGroup(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === \"moveEditBBox\") {\n      this.moveEditBBox(event.clientX, event.clientY);\n    }\n\n    if (this.actionType === \"selectMultipleObjects\") {\n      this.selectMultipleObjects(event.clientX, event.clientY, true);\n    }\n\n    if (this.actionType === \"deselectMultipleObjects\") {\n      this.selectMultipleObjects(event.clientX, event.clientY, false);\n    }\n\n    // if (this.actionType === \"objectMove\") {\n    //   const { x, y } = screenToWorld(event.clientX, event.clientY);\n    //   this.mouseDragHelper.onMove(x, y);\n    //   this.moveSelectedObjectsByDiff();\n    //   // this.refreshEditBBox();\n    // }\n    // if (this.boundingClientRect === undefined) {\n    //   return;\n    // }\n    // const { getState, dispatch } = appStore;\n    // const state = getState();\n\n    // const { width, height, top, left } = this.boundingClientRect;\n\n    // if (this.mouseDragHelper.shouldBehaveLikeMove === true) {\n    //   const { x, y } = screenToWorld(event.clientX, event.clientY);\n    //   this.mouseDragHelper.onMove(x, y);\n    //   const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    //   const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    //   Object.keys(state.ui.selectedBeadsIds).forEach((beadId) => {\n    //     const name = getThreeNameFromBeadId(beadId);\n    //     const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //     if (object !== undefined) {\n    //       object.position.x = state.appData.beads[beadId].position.x + diffX;\n    //       object.position.y = state.appData.beads[beadId].position.y + diffY;\n    //     }\n    //   });\n    //   Object.keys(state.ui.selectedRegionsIds).forEach((regionId) => {\n    //     const name = getThreeNameFromRegionId(\n    //       regionId,\n    //       RegionChildSuffix.CONTENT\n    //     );\n    //     const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //     if (object !== undefined) {\n    //       object.position.x =\n    //         state.appData.regions[regionId].position.x + diffX;\n    //       object.position.y =\n    //         state.appData.regions[regionId].position.y + diffY;\n    //     }\n    //   });\n\n    //   if (this.prevEditBBox) {\n    //     this.refreshEditBBox(diffX, diffY);\n    //   }\n    // } else {\n    //   if (this.mouseDragHelper.isDragStarted === true) {\n    //     const { x, y } = screenToWorld(event.clientX, event.clientY);\n\n    //     this.mouseDragHelper.onMove(x, y);\n\n    //     if (this.mouseDragHelper.isDragStarted === true) {\n    //       this.selectionBox.endPoint.set(\n    //         ((event.clientX - left) / width) * 2 - 1,\n    //         -((event.clientY - top) / height) * 2 + 1,\n    //         1\n    //       );\n\n    //       const allSelected = this.selectionBox.select();\n    //       const beadsIds: string[] = [];\n    //       const regionIds: string[] = [];\n    //       allSelected.forEach((object) => {\n    //         const beadId = getBeadIdFromThreeName(object.name);\n    //         if (beadId !== undefined) {\n    //           if (state.appData.beads[beadId]) {\n    //             if (beadsIds.includes(beadId) === false) {\n    //               beadsIds.push(beadId);\n    //             }\n    //           } else {\n    //             console.warn(\"bead id missing in store\", beadId);\n    //           }\n    //         }\n\n    //         const regionId = getRegionIdFromThreeName(object.name);\n    //         if (regionId !== undefined) {\n    //           if (state.appData.regions[regionId]) {\n    //             if (regionIds.includes(regionId) === false) {\n    //               regionIds.push(regionId);\n    //             }\n    //           } else {\n    //             console.warn(\"region id missing in store\", regionId);\n    //           }\n    //         }\n    //       });\n\n    //       dispatch(\n    //         Actions.MouseSelection.action_selectIntersectObjects(\n    //           beadsIds,\n    //           regionIds\n    //         )\n    //       );\n    //     }\n    //   }\n\n    //   const screenX = event.clientX - left;\n    //   const screenY = event.clientY - top;\n\n    //   this.mouseSelectionHelper.onMove(screenX, screenY);\n    // }\n  }\n\n  onUp(event: PointerEvent) {\n    // stopListeningKeys();\n    if (this.actionType === undefined) {\n      return;\n    }\n\n    // const { dispatch } = appStore;\n\n    if (this.actionType === \"moveCamera\") {\n      this.mouseEventsIdle.onUp(event);\n      if (this.mouseDragHelper.isDragged === false) {\n        const store = getStore();\n        const action: ChangeSelectObjects = {\n          name: AppEventType.ChangeSelectObjects,\n          payload: {\n            change: store.selectedIds.map((id) => {\n              return {\n                id,\n                isSelected: false,\n              };\n            }),\n          },\n        };\n        sendEvent(action);\n        // dispatch(Actions.MouseSelection.action_unselectAll());\n      } else {\n        this.updateUIAtMove(true);\n        const store = getStore();\n        const newStore = produce(store, (draft) => {\n          const position = getTopBarPosition(\n            store.selectedIds.map((id) => {\n              return { id, objectType: store.objects[id].objectType };\n            })\n          );\n          draft.ui.selectedTopBarPosition = position;\n        });\n        setStore(newStore);\n        refreshReactState(newStore);\n      }\n      this.mouseDragHelper.onUp();\n    }\n\n    if (this.actionType === \"moveObjectGroup\") {\n      this.updateUIAtMove(true);\n      if (this.mouseDragHelper.isDragged === true) {\n        logger.trace(\n          \"MouseEventsEditorModeSelectOrMove: aktualizuje pozycje groupy i wiele\"\n        );\n        const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n        const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          const ids = this.getIdsFromGroupOrInGroup(objectId);\n          // logger.trace(\"??\", ids, objectId);\n          sendEvent(\n            this.getMoveObjectsAction([objectId, ...ids], diffX, diffY)\n          );\n          // const store = getStore();\n          // const action: ChangeObjectsProperty = {\n          //   name: AppEventType.ChangeObjectsProperty,\n          //   payload: {\n          //     change: [\n          //       {\n          //         id: objectId,\n          //         property: {\n          //           position: {\n          //             x: store.objects[objectId].position.x + diffX,\n          //             y: store.objects[objectId].position.y + diffY,\n          //           },\n          //         },\n          //       },\n          //     ],\n          //   },\n          // };\n          // sendEvent(action);\n\n          // dispatch(\n          //   Actions.MouseSelection.action_moveClickedObject(\n          //     diffX,\n          //     diffY,\n          //     objectId\n          //   )\n          // );\n        }\n        this.mouseDragHelper.onUp();\n      } else {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          if (\n            isPressedKey(\"controlleft\") ||\n            isPressedKey(\"controlright\") ||\n            isPressedKey(\"shiftleft\") ||\n            isPressedKey(\"shiftright\")\n          ) {\n            const store = getStore();\n            const clickedObjectIsLocked =\n              store.objects[objectId] !== undefined\n                ? store.objects[objectId].isLocked === true\n                : false;\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n              // nothing\n            } else if (clickedObjectIsLocked === false) {\n              sendEvent(\n                this.getSelectionAppendAction([objectId], undefined, false)\n              );\n            }\n            // dispatch(\n            //   Actions.MouseSelection.action_appendSelectIntersectObject([\n            //     objectId,\n            //   ])\n            // );\n          } else {\n            const store = getStore();\n            if (store.selectedIds.length === 0) {\n              sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n            } else {\n              const clickedObjectIsLocked =\n                store.objects[objectId] !== undefined\n                  ? store.objects[objectId].isLocked === true\n                  : false;\n              let selectedIsLocked: any = false;\n              store.selectedIds.forEach((id) => {\n                if (store.objects[id].isLocked === true) {\n                  selectedIsLocked = true;\n                }\n              });\n              if (selectedIsLocked === true) {\n                // nothing\n              } else if (clickedObjectIsLocked === false) {\n                sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n              }\n            }\n            // sendEvent(this.getSelectionAppendAction([objectId], true));\n            // dispatch(\n            //   Actions.MouseSelection.action_selectIntersectObject(objectId)\n            // );\n          }\n        }\n        logger.trace(\"MouseEventsEditorModeSelectOrMove: zaznaczam group\");\n        this.mouseDragHelper.onUp();\n      }\n    }\n\n    if (this.actionType === \"moveSingleObject\") {\n      this.updateUIAtMove(true);\n      if (this.mouseDragHelper.isDragged === true) {\n        \n        logger.trace(\n          \"MouseEventsEditorModeSelectOrMove: aktualizuje pozycje single object\"\n        );\n        const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n        const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          sendEvent(this.getMoveObjectsAction([objectId], diffX, diffY));\n          // dispatch(\n          //   Actions.MouseSelection.action_moveClickedObject(\n          //     diffX,\n          //     diffY,\n          //     objectId\n          //   )\n          // );\n        }\n\n        this.mouseDragHelper.onUp();\n      } else {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (objectId !== undefined) {\n          if (\n            isPressedKey(\"controlleft\") ||\n            isPressedKey(\"controlright\") ||\n            isPressedKey(\"shiftleft\") ||\n            isPressedKey(\"shiftright\")\n          ) {\n            const store = getStore();\n            const clickedObjectIsLocked =\n              store.objects[objectId] !== undefined\n                ? store.objects[objectId].isLocked === true\n                : false;\n\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n              // nothing\n            } else if (clickedObjectIsLocked === false) {\n              sendEvent(\n                this.getSelectionAppendAction([objectId], undefined, true)\n              );\n            }\n            // dispatch(\n            //   Actions.MouseSelection.action_appendSelectIntersectObject([\n            //     objectId,\n            //   ])\n            // );\n          } else {\n            const store = getStore();\n            if (store.selectedIds.length === 0) {\n              sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n            } else {\n              const clickedObjectIsLocked =\n                store.objects[objectId] !== undefined\n                  ? store.objects[objectId].isLocked === true\n                  : false;\n              let selectedIsLocked: any = false;\n              store.selectedIds.forEach((id) => {\n                if (store.objects[id].isLocked === true) {\n                  selectedIsLocked = true;\n                }\n              });\n              if (selectedIsLocked === true) {\n                // nothing\n              } else if (clickedObjectIsLocked === false) {\n                sendEvent(this.getSelectionForSingleObjectIdAction(objectId));\n              }\n            }\n\n            // dispatch(\n            //   Actions.MouseSelection.action_selectIntersectObject(objectId)\n            // );\n          }\n        }\n        logger.trace(\n          \"MouseEventsEditorModeSelectOrMove: zaznaczam single object\"\n        );\n        this.mouseDragHelper.onUp();\n      }\n    }\n\n    if (this.actionType === \"moveAllSelectedObjects\") {\n      this.updateUIAtMove(true);\n\n      if (this.mouseDragHelper.isDragged === true) {\n        logger.trace(\n          \"MouseEventsEditorModeSelectOrMove: aktualizuje pozycje wszystkich zaznaczonych\"\n        );\n        const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n        const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n        const store = getStore();\n        sendEvent(this.getMoveObjectsAction(store.selectedIds, diffX, diffY));\n        if (appThree.additionalData.selectedBBox !== undefined) {\n          appThree.additionalData.selectedBBox.topLeft.x += diffX;\n          appThree.additionalData.selectedBBox.topLeft.y += diffY;\n          appThree.additionalData.selectedBBox.topRight.x += diffX;\n          appThree.additionalData.selectedBBox.topRight.y += diffY;\n          appThree.additionalData.selectedBBox.bottomLeft.x += diffX;\n          appThree.additionalData.selectedBBox.bottomLeft.y += diffY;\n          appThree.additionalData.selectedBBox.bottomRight.x += diffX;\n          appThree.additionalData.selectedBBox.bottomRight.y += diffY;\n        }\n        // dispatch(\n        //   Actions.MouseSelection.action_moveAllSelectedObjects(diffX, diffY)\n        // );\n        this.mouseDragHelper.onUp();\n      } else {\n        const objectId =\n          this.intersects?.[0]?.object?.userData?.id ?? undefined;\n        if (\n          isPressedKey(\"controlleft\") ||\n          isPressedKey(\"controlright\") ||\n          isPressedKey(\"shiftleft\") ||\n          isPressedKey(\"shiftright\")\n        ) {\n          sendEvent(\n            this.getSelectionAppendAction([objectId], undefined, false)\n          );\n          // dispatch(\n          //   Actions.MouseSelection.action_appendSelectIntersectObject([\n          //     objectId,\n          //   ])\n          // );\n        }\n        this.mouseDragHelper.onUp();\n      }\n\n      // const { getState } = appStore;\n      // const state = getState();\n      // if (state.ui.editBBox !== undefined) {\n      //   const objectId = state.ui.editBBox.id;\n      //   const name = getStateObjectFromObjectId(\n      //     objectId,\n      //     ObjectTypes.SceneEditBBox\n      //   );\n      //   if (name === undefined) {\n      //     return;\n      //   }\n\n      //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      //   if (object === undefined) {\n      //     console.warn(\"object not found in app scene for id\", objectId, name);\n      //     return;\n      //   }\n\n      //   object.visible = true;\n      // }\n    }\n\n    if (this.actionType === \"moveEditBBox\") {\n      if (this.mouseDragHelper.isDragged === true) {\n        logger.trace(\n          \"MouseEventsEditorModeSelectOrMove: aktualizuje pozycje wszystkich zaznaczonych i edit bbox\"\n        );\n        const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n        const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n        const store = getStore();\n        sendEvent(this.getMoveObjectsAction(store.selectedIds, diffX, diffY));\n        // dispatch(\n        //   Actions.MouseSelection.action_moveAllSelectedObjects(diffX, diffY)\n        // );\n        this.mouseDragHelper.onUp();\n      } else {\n        const store = getStore();\n        const action: ChangeSelectObjects = {\n          name: AppEventType.ChangeSelectObjects,\n          payload: {\n            change: store.selectedIds.map((id) => {\n              return {\n                id,\n                isSelected: false,\n              };\n            }),\n          },\n        };\n        sendEvent(action);\n        // dispatch(Actions.MouseSelection.action_unselectAll());\n        this.mouseDragHelper.onUp();\n      }\n\n      // const { getState } = appStore;\n      // const state = getState();\n      // if (state.ui.editBBox !== undefined) {\n      //   const objectId = state.ui.editBBox.id;\n      //   const name = getStateObjectFromObjectId(\n      //     objectId,\n      //     ObjectTypes.SceneEditBBox\n      //   );\n      //   if (name === undefined) {\n      //     return;\n      //   }\n\n      //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      //   if (object === undefined) {\n      //     console.warn(\"object not found in app scene for id\", objectId, name);\n      //     return;\n      //   }\n\n      //   object.visible = true;\n      // }\n    }\n\n    if (this.actionType === \"selectMultipleObjects\") {\n      if (isPressedKey(\"shiftleft\") || isPressedKey(\"shiftright\")) {\n        if (this.mouseDragHelper.isDragged === false) {\n          this.intersects = this.getActiveObjectsFromIntersect(\n            event.clientX,\n            event.clientY\n          );\n          console.log(\"??\", this.intersects)\n          const firstClickedActiveObject = this.intersects.length > 0;\n          if (firstClickedActiveObject) {\n            const clicked = this.intersects[0].object.userData as AppObject;\n            const clickedId = clicked.id;\n            if (clickedId !== undefined) {\n              const store = getStore();\n              const clickedObjectIsLocked =\n                store.objects[clickedId] !== undefined\n                  ? store.objects[clickedId].isLocked === true\n                  : false;\n              let selectedIsLocked: any = false;\n              store.selectedIds.forEach((id) => {\n                if (store.objects[id].isLocked === true) {\n                  selectedIsLocked = true;\n                }\n              });\n              if (selectedIsLocked === true) {\n                // nothing\n              } else if (clickedObjectIsLocked === false) {\n                sendEvent(\n                  this.getSelectionAppendAction([clickedId], undefined, false)\n                );\n              }\n\n              // dispatch(\n              //   Actions.MouseSelection.action_appendSelectIntersectObject([\n              //     clickedId,\n              //   ])\n              // );\n            }\n          }\n          this.intersects = [];\n        } else {\n          if (this.boundingClientRect !== undefined) {\n            const { top, left, width, height } = this.boundingClientRect;\n            this.selectionBox.endPoint.set(\n              ((event.clientX - left) / width) * 2 - 1,\n              -((event.clientY - top) / height) * 2 + 1,\n              1\n            );\n            const store = getStore();\n            let selectedIsLocked: any = false;\n            store.selectedIds.forEach((id) => {\n              if (store.objects[id].isLocked === true) {\n                selectedIsLocked = true;\n              }\n            });\n            if (selectedIsLocked === true) {\n              // nothing\n            } else {\n              // const { dispatch } = appStore;\n              const allSelectedIds = this.selectionBox.selectIds();\n\n              sendEvent(\n                this.getSelectionAppendAction(allSelectedIds, true, false)\n              );\n            }\n            // dispatch(\n            //   Actions.MouseSelection.action_appendSelectIntersectObject(\n            //     allSelectedIds,\n            //     true,\n            //     true\n            //   )\n            // );\n          }\n        }\n      }\n      this.mouseDragHelper.onUp();\n      this.mouseSelectionHelper.onUp();\n    }\n\n    if (this.actionType === \"deselectMultipleObjects\") {\n      if (isPressedKey(\"altleft\") || isPressedKey(\"altright\")) {\n        if (this.mouseDragHelper.isDragged === false) {\n          this.intersects = this.getActiveObjectsFromIntersect(\n            event.clientX,\n            event.clientY\n          );\n          const firstClickedActiveObject = this.intersects.length > 0;\n          if (firstClickedActiveObject) {\n            const clicked = this.intersects[0].object.userData as AppObject;\n            const clickedId = clicked.id;\n            if (clickedId !== undefined) {\n              sendEvent(\n                this.getSelectionAppendAction([clickedId], false, true)\n              );\n\n              // dispatch(\n              //   Actions.MouseSelection.action_appendSelectIntersectObject(\n              //     [clickedId],\n              //     true,\n              //     false\n              //   )\n              // );\n            }\n          }\n\n          this.intersects = [];\n        } else {\n          if (this.boundingClientRect !== undefined) {\n            const { top, left, width, height } = this.boundingClientRect;\n            this.selectionBox.endPoint.set(\n              ((event.clientX - left) / width) * 2 - 1,\n              -((event.clientY - top) / height) * 2 + 1,\n              1\n            );\n            // const { dispatch } = appStore;\n            const allSelectedIds = this.selectionBox.selectIds();\n\n            sendEvent(\n              this.getSelectionAppendAction(allSelectedIds, false, false)\n            );\n            // dispatch(\n            //   Actions.MouseSelection.action_appendSelectIntersectObject(\n            //     allSelectedIds,\n            //     true,\n            //     false\n            //   )\n            // );\n          }\n        }\n      }\n\n      this.mouseDragHelper.onUp();\n      this.mouseSelectionHelper.onUp();\n    }\n\n    // if (this.actionType === \"objectMove\") {\n    //   const objects = this.groupObjectsByTypeFromIntersect(this.intersects, 1);\n    //   const beadIds: string[] = objects.Bead.map((e) => e.object.userData.id);\n    //   const regionIds: string[] = objects.Region.map(\n    //     (e) => e.object.userData.id\n    //   );\n\n    //   if (this.mouseDragHelper.isDragged === true) {\n    //     const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    //     const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    //     dispatch(\n    //       Actions.MouseSelectionaction_movedSelectedOrIntersected(diffX, diffY, beadIds, regionIds)\n    //     );\n    //   } else {\n    //     dispatch(Actions.MouseSelectionaction_selectIntersectObjects(beadIds, regionIds));\n    //   }\n\n    //   this.mouseDragHelper.onUp();\n    // }\n\n    this.actionType = undefined;\n    // const { getState, dispatch } = appStore;\n    // const state = getState();\n    // if (this.mouseDragHelper.shouldBehaveLikeMove === true) {\n    //   const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    //   const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    //   if (this.prevEditBBox) {\n    //     this.refreshEditBBox(diffX, diffY);\n    //   }\n    //   this.mouseDragHelper.shouldBehaveLikeMove = false;\n    //   this.prevEditBBox = undefined;\n    //   dispatch(Actions.MouseSelection.action_movedSelected(diffX, diffY));\n    // } else {\n    //   if (this.mouseDragHelper.isDragged === true) {\n    //     // do nothing\n    //   } else if (\n    //     this.mouseDragHelper.isDragged === false &&\n    //     this.mouseDragHelper.isDragStarted === true\n    //   ) {\n    //     if (this.boundingClientRect === undefined) {\n    //       return;\n    //     }\n\n    //     const { width, height, top, left } = this.boundingClientRect;\n    //     this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n    //     this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n    //     this.raycaster.setFromCamera(this.mouse, appThree.camera);\n    //     const intersects = this.raycaster.intersectObjects(\n    //       appThree.scene.children,\n    //       true\n    //     );\n    //     const beadsIds: string[] = [];\n    //     const regionIds: string[] = [];\n    //     intersects.forEach((e) => {\n    //       const name = e.object.name;\n    //       const beadId = getBeadIdFromThreeName(name);\n    //       if (beadId !== undefined) {\n    //         if (state.appData.beads[beadId]) {\n    //           if (beadsIds.includes(beadId) === false) {\n    //             beadsIds.push(beadId);\n    //           }\n    //         } else {\n    //           console.warn(\"bead id missing in store\", beadId);\n    //         }\n    //       }\n\n    //       const regionId = getRegionIdFromThreeName(name);\n    //       if (regionId !== undefined) {\n    //         if (state.appData.regions[regionId]) {\n    //           if (regionIds.includes(regionId) === false) {\n    //             regionIds.push(regionId);\n    //           }\n    //         } else {\n    //           console.warn(\"region id missing in store\", regionId);\n    //         }\n    //       }\n    //     });\n\n    //     dispatch(\n    //       Actions.MouseSelection.action_selectIntersectObjects(\n    //         beadsIds,\n    //         regionIds\n    //       )\n    //     );\n    //   } else {\n    //     dispatch(Actions.MouseSelection.action_selectIntersectObjects([], []));\n    //   }\n    // }\n    // this.mouseDragHelper.onUp();\n    // this.mouseSelectionHelper.onUp();\n  }\n\n  getMoveObjectsAction(objectIds: string[], diffX: number, diffY: number) {\n    const store = getStore();\n\n    const ids: string[] = [];\n    const change: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n    objectIds.forEach((objectId) => {\n      const childrenIds = this.getIdsFromGroupOrInGroup(objectId);\n      if (store.objects[objectId] !== undefined) {\n        if (ids.includes(objectId) === false) {\n          ids.push(objectId);\n          change.push({\n            id: objectId,\n            properties: {\n              position: {\n                x: store.objects[objectId].position.x + diffX,\n                y: store.objects[objectId].position.y + diffY,\n                z: store.objects[objectId].position.z,\n              },\n            },\n          });\n        }\n      }\n      childrenIds.forEach((id) => {\n        if (store.objects[id] !== undefined) {\n          if (ids.includes(objectId) === false) {\n            ids.push(objectId);\n            change.push({\n              id: id,\n              properties: {\n                position: {\n                  x: store.objects[id].position.x + diffX,\n                  y: store.objects[id].position.y + diffY,\n                  z: store.objects[objectId].position.z,\n                },\n              },\n            });\n          }\n        }\n      });\n    });\n\n    const action: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: change,\n      },\n    };\n\n    return action;\n  }\n\n  getSelectionForSingleObjectIdAction(id: string) {\n    const store = getStore();\n    const change: ChangeSelectObjects[\"payload\"][\"change\"] = [];\n\n    store.selectedIds.forEach((_id) => {\n      const childrenIds = this.getIdsFromGroupOrInGroup(_id);\n      change.push({\n        id: _id,\n        isSelected: false,\n      });\n      childrenIds.forEach((__id) => {\n        change.push({\n          id: __id,\n          isSelected: false,\n        });\n      });\n    });\n\n    change.push({\n      id,\n      isSelected: true,\n    });\n    const childrenIds = this.getIdsFromGroupOrInGroup(id);\n    childrenIds.forEach((_id) => {\n      change.push({\n        id: _id,\n        isSelected: true,\n      });\n    });\n\n    const action: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change,\n      },\n    };\n\n    return action;\n  }\n\n  getSelectionAppendAction(\n    objectIds: string[],\n    _newIsSelected?: boolean,\n    _addWithIsLock?: boolean\n  ) {\n    const store = getStore();\n    const change: ChangeSelectObjects[\"payload\"][\"change\"] = [];\n    const addWithIsLock = _addWithIsLock ?? false;\n\n    // logger.trace(\"**** getSelectionAppendAction ---- 00 \", _addWithIsLock);\n\n    objectIds.forEach((objectId) => {\n      const isLocked =\n        store.objects[objectId] !== undefined &&\n        store.objects[objectId].isLocked === true;\n\n      // logger.trace(\n      //   \"**** getSelectionAppendAction ---- \",\n      //   objectId,\n      //   addWithIsLock === true,\n      //   addWithIsLock === false && isLocked === false,\n      //   addWithIsLock === true ||\n      //     (addWithIsLock === false && isLocked === false),\n      //   \"IsLocked: \",\n      //   isLocked\n      // );\n      if (\n        addWithIsLock === true ||\n        (addWithIsLock === false && isLocked === false)\n      ) {\n        const isSelected = store.selectedIds.includes(objectId) === true;\n        const newSelected =\n          _newIsSelected === undefined ? !isSelected : _newIsSelected;\n        const childrenIds = this.getIdsFromGroupOrInGroup(objectId);\n        change.push({\n          id: objectId,\n          isSelected: newSelected,\n        });\n        childrenIds.forEach((id) => {\n          change.push({\n            id: id,\n            isSelected: newSelected,\n          });\n        });\n      }\n    });\n\n    const action: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change,\n      },\n    };\n\n    return action;\n  }\n\n  selectMultipleObjects(\n    clientX: number,\n    clientY: number,\n    shouldBeSelected: boolean\n  ) {\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n    const { top, left, width, height } = this.boundingClientRect;\n    const screenX = clientX - left;\n    const screenY = clientY - top;\n    this.mouseSelectionHelper.onMove(screenX, screenY);\n\n    // this.selectionBox.endPoint.set(\n    //   ((clientX - left) / width) * 2 - 1,\n    //   -((clientY - top) / height) * 2 + 1,\n    //   1\n    // );\n    // const { dispatch } = appStore;\n    // const allSelectedIds = this.selectionBox.selectIds();\n\n    // allSelectedIds.forEach((id) => {\n    //   dispatch(\n    //     Actions.MouseSelection.action_appendSelectIntersectObject(\n    //       id,\n    //       true,\n    //       shouldBeSelected\n    //     )\n    //   );\n    // });\n  }\n\n  moveSingleObject(clientX: number, clientY: number) {\n    // const { getState } = appStore;\n    // const state = getState();\n    const store = getStore();\n\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n    const clicked = this.intersects[0].object.userData;\n    const objectId = clicked.id;\n    if (objectId === undefined) {\n      console.warn(\"objectId not found in clicked item\", clicked);\n      return;\n    }\n    const obj = store.objects[objectId];\n    if (obj === undefined) {\n      console.warn(\"objectId not found in app store\", objectId, clicked);\n      return;\n    }\n    const name = getStateObjectFromObjectId(objectId, obj.objectType);\n    if (name === undefined) {\n      return;\n    }\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object === undefined) {\n      console.warn(\"object not found in app state for id\", objectId, clicked);\n      return;\n    }\n\n    if (store.objects[objectId].objectType === ObjectTypes.Region) {\n      const region = store.objects[objectId] as Region;\n      if (region.snapBeadsToCell === true) {\n        if (region.childrenGridIds.length > 0) {\n          region.childrenGridIds.forEach((id) => {\n            if (id !== undefined && store.objects[id] !== undefined) {\n              const bead = store.objects[id];\n              if (bead === undefined) {\n                console.warn(\"object not exists in app\", objectId);\n                return;\n              }\n              const name = getStateObjectFromObjectId(bead.id, bead.objectType);\n              if (name === undefined) {\n                return;\n              }\n              const child_object = appThree.scene.getObjectByUserDataProperty(\n                \"name\",\n                name\n              );\n              if (child_object === undefined) {\n                console.warn(\n                  \"object not found in app scene for id\",\n                  objectId,\n                  name\n                );\n                return;\n              }\n              child_object.position.x = store.objects[id].position.x + diffX;\n              child_object.position.y = store.objects[id].position.y + diffY;\n            }\n          });\n        }\n      }\n    }\n\n    // logger.trace(\"przesuwam...\", diffX, diffY);\n    object.position.x = store.objects[objectId].position.x + diffX;\n    object.position.y = store.objects[objectId].position.y + diffY;\n\n    this.updateUIAtMove(false);\n  }\n\n  moveObjectGroup(clientX: number, clientY: number) {\n    // const { dispatch, getState } = appStore;\n    // const state = getState();\n    const store = getStore();\n\n    const { x, y } = screenToWorld(clientX, clientY);\n\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n    const clicked = this.intersects[0].object.userData;\n    let objectId = clicked.id;\n    if (objectId === undefined) {\n      console.warn(\"objectId not found in clicked item\", clicked);\n      return;\n    }\n    let group = store.objects[objectId];\n    if (group === undefined) {\n      console.warn(\"objectId not found in app store\", objectId);\n      return;\n    }\n\n    // const isGroup =\n    //   group.objectType !== undefined && group.objectType === ObjectTypes.Group;\n\n    const isGroupChild =\n      group[groupIdKey] !== undefined && group[groupIdKey].length > 0;\n\n    if (isGroupChild) {\n      objectId = group[groupIdKey];\n      group = store.objects[objectId];\n    }\n\n    const name = getStateObjectFromObjectId(objectId, group.objectType);\n    if (name === undefined) {\n      return;\n    }\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object === undefined) {\n      console.warn(\"object not found in app state for id\", objectId);\n      return;\n    }\n    object.position.x = store.objects[objectId].position.x + diffX;\n    object.position.y = store.objects[objectId].position.y + diffY;\n\n    (group as Group).childrenIds.forEach((id) => {\n      const children: AppObject | undefined = store.objects[id];\n      if (children === undefined) {\n        console.warn(\"object not exists in app\", id);\n        return;\n      }\n      const name = getStateObjectFromObjectId(children.id, children.objectType);\n      if (name === undefined) {\n        return;\n      }\n      const child = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (child === undefined) {\n        console.warn(\"object not found in app scene for id\", id, name);\n        return;\n      }\n      child.position.x = store.objects[id].position.x + diffX;\n      child.position.y = store.objects[id].position.y + diffY;\n    });\n\n    this.updateUIAtMove(false);\n  }\n\n  moveEditBBox(clientX: number, clientY: number) {\n    this.moveAllSelectedObjects(clientX, clientY);\n    // const { dispatch, getState } = appStore;\n    // const state = getState();\n\n    const store = getStore();\n    // if (state.ui.editBBox !== undefined) {\n    //   const objectId = state.ui.editBBox.id;\n    //   const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    //   const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    //   const name = getStateObjectFromObjectId(\n    //     objectId,\n    //     ObjectTypes.SceneEditBBox\n    //   );\n    //   if (name === undefined) {\n    //     return;\n    //   }\n\n    //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //   if (object === undefined) {\n    //     console.warn(\"object not found in app scene for id\", objectId, name);\n    //     return;\n    //   }\n\n    //   object.position.x = object.userData.position.x + diffX;\n    //   object.position.y = object.userData.position.y + diffY;\n    // }\n  }\n\n  moveAllSelectedObjects(clientX: number, clientY: number) {\n    // const { dispatch, getState } = appStore;\n    // const state = getState();\n\n    const { x, y } = screenToWorld(clientX, clientY);\n    this.mouseDragHelper.onMove(x, y);\n\n    const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n    const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n    // logger.trace(\"-------------- \", clientX, clientY, x, y, diffX, diffY);\n\n    const store = getStore();\n\n    store.selectedIds.forEach((objectId) => {\n      const obj: AppObject | undefined = store.objects[objectId];\n      if (obj === undefined) {\n        console.warn(\"object not exists in app\", objectId);\n        return;\n      }\n      const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n      if (name === undefined) {\n        return;\n      }\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        console.warn(\"object not found in app scene for id\", objectId, name);\n        return;\n      }\n\n      if (store.objects[objectId].objectType === ObjectTypes.Region) {\n        if (appThree.additionalData.selectedBBox !== undefined) {\n          for (let i = appThree.scene.children.length - 1; i >= 0; i--) {\n            if (appThree.scene.children[i].layers.mask === 4) {\n              const name = appThree.scene.children[i].userData[\"name\"];\n\n              appThree.scene.children[i].position.x =\n                appThree.additionalData.selectedBBox[name].x + diffX;\n\n              appThree.scene.children[i].position.y =\n                appThree.additionalData.selectedBBox[name].y + diffY;\n            }\n          }\n        }\n        const region = store.objects[objectId] as Region;\n        if (region.snapBeadsToCell === true) {\n          if (region.childrenGridIds.length > 0) {\n            region.childrenGridIds.forEach((id) => {\n              if (id !== undefined && store.objects[id] !== undefined) {\n                const bead = store.objects[id];\n                if (bead === undefined) {\n                  console.warn(\"object not exists in app\", objectId);\n                  return;\n                }\n                const name = getStateObjectFromObjectId(\n                  bead.id,\n                  bead.objectType\n                );\n                if (name === undefined) {\n                  return;\n                }\n                const child_object = appThree.scene.getObjectByUserDataProperty(\n                  \"name\",\n                  name\n                );\n                if (child_object === undefined) {\n                  console.warn(\n                    \"object not found in app scene for id\",\n                    objectId,\n                    name\n                  );\n                  return;\n                }\n                child_object.position.x = store.objects[id].position.x + diffX;\n                child_object.position.y = store.objects[id].position.y + diffY;\n              }\n            });\n          }\n        }\n      }\n\n      object.position.x = store.objects[objectId].position.x + diffX;\n      object.position.y = store.objects[objectId].position.y + diffY;\n    });\n\n    this.updateUIAtMove(false);\n    // if (state.ui.editBBox !== undefined) {\n    //   const objectId = state.ui.editBBox.id;\n    //   const name = getStateObjectFromObjectId(\n    //     objectId,\n    //     ObjectTypes.SceneEditBBox\n    //   );\n    //   if (name === undefined) {\n    //     return;\n    //   }\n\n    //   const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    //   if (object === undefined) {\n    //     console.warn(\"object not found in app scene for id\", objectId, name);\n    //     return;\n    //   }\n\n    //   object.visible = false;\n    // }\n  }\n\n  updateUIAtMove(visible: boolean) {\n    if (visible === false) {\n      this.hideTopBar();\n    } else {\n      this.showTopBar();\n    }\n  }\n\n  hideTopBar() {\n    const selector = \".selected-objects-top-bar\";\n    const topBar = document.querySelector(selector) as HTMLDivElement | null;\n    if (topBar === null) {\n      return;\n    }\n    topBar.style.display = \"none\";\n  }\n\n  showTopBar() {\n    const selector = \".selected-objects-top-bar\";\n    const topBar = document.querySelector(selector) as HTMLDivElement | null;\n    if (topBar === null) {\n      return;\n    }\n    topBar.style.display = \"block\";\n  }\n\n  // moveSelectedObjectsByDiff() {\n  //   const { getState } = appStore;\n  //   const state = getState();\n  //   // const store = getStore()\n\n  //   const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n  //   const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n\n  //   const objects = this.groupObjectsByTypeFromIntersect(this.intersects, 1);\n  //   const regionIds: string[] = Object.keys(state.ui.selectedRegionsIds);\n  //   objects.Region.forEach((obj) => {\n  //     const id = obj.object.userData.id ?? undefined;\n  //     if (id !== undefined) {\n  //       if (regionIds.includes(id) === false) {\n  //         regionIds.push(id);\n  //       }\n  //     }\n  //   });\n\n  //   const beadIds: string[] = Object.keys(state.ui.selectedBeadsIds);\n  //   objects.Bead.forEach((obj) => {\n  //     const id = obj.object.userData.id ?? undefined;\n  //     if (id !== undefined) {\n  //       if (beadIds.includes(id) === false) {\n  //         beadIds.push(id);\n  //       }\n  //     }\n  //   });\n\n  //   beadIds.forEach((beadId) => {\n  //     const name = getThreeNameFromBeadId(beadId);\n  //     const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //     if (object !== undefined) {\n  //       object.position.x = state.appData.beads[beadId].position.x + diffX;\n  //       object.position.y = state.appData.beads[beadId].position.y + diffY;\n  //     }\n  //   });\n\n  //   regionIds.forEach((regionId) => {\n  //     const name = getThreeNameFromRegionId(regionId);\n  //     const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //     if (object !== undefined) {\n  //       object.position.x = state.appData.regions[regionId].position.x + diffX;\n  //       object.position.y = state.appData.regions[regionId].position.y + diffY;\n  //     }\n  //   });\n  // }\n\n  // createEditBBox() {\n  //   const { getState } = appStore;\n  //   const state = getState();\n  //   getEventEmitter().emit(\n  //     EventNames.action_updateEditBBox,\n  //     {\n  //       editBBox: state.ui.editBBox,\n  //       prevEditBBox: state.ui.editBBox,\n  //     },\n  //     state\n  //   );\n\n  //   return;\n\n  //   // if (state.ui.editBBox === undefined) {\n  //   //   this.prevEditBBox = undefined;\n  //   //   return;\n  //   // }\n  //   // const name = getThreeNameFromEditBBoxId(state.ui.editBBox.id);\n  //   // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //   // if (object === undefined) {\n  //   //   this.prevEditBBox = undefined;\n  //   //   return;\n  //   // }\n  //   // this.prevEditBBox = {\n  //   //   id: state.ui.editBBox.id,\n  //   //   x: object.position.x,\n  //   //   y: object.position.y,\n  //   // };\n\n  //   // const nameTL = getThreeNameFromEditBBoxId(\n  //   //   state.ui.editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n  //   // );\n  //   // const objectTL = appThree.scene.getObjectByUserDataProperty(\"name\", nameTL);\n  //   // if (objectTL !== undefined) {\n  //   //   this.prevEditBBox.resizeXTL = objectTL.position.x;\n  //   //   this.prevEditBBox.resizeYTL = objectTL.position.y;\n  //   // }\n\n  //   // const nameTR = getThreeNameFromEditBBoxId(\n  //   //   state.ui.editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n  //   // );\n  //   // const objectTR = appThree.scene.getObjectByUserDataProperty(\"name\", nameTR);\n  //   // if (objectTR !== undefined) {\n  //   //   this.prevEditBBox.resizeXTR = objectTR.position.x;\n  //   //   this.prevEditBBox.resizeYTR = objectTR.position.y;\n  //   // }\n  //   // const nameBL = getThreeNameFromEditBBoxId(\n  //   //   state.ui.editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n  //   // );\n  //   // const objectBL = appThree.scene.getObjectByUserDataProperty(\"name\", nameBL);\n  //   // if (objectBL !== undefined) {\n  //   //   this.prevEditBBox.resizeXBL = objectBL.position.x;\n  //   //   this.prevEditBBox.resizeYBL = objectBL.position.y;\n  //   // }\n  //   // const nameBR = getThreeNameFromEditBBoxId(\n  //   //   state.ui.editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n  //   // );\n  //   // const objectBR = appThree.scene.getObjectByUserDataProperty(\"name\", nameBR);\n  //   // if (objectBR !== undefined) {\n  //   //   this.prevEditBBox.resizeXBR = objectBR.position.x;\n  //   //   this.prevEditBBox.resizeYBR = objectBR.position.y;\n  //   // }\n  // }\n\n  // refreshEditBBox() {\n  //   const { getState } = appStore;\n  //   const state = getState();\n  //   getEventEmitter().emit(\n  //     EventNames.action_updateEditBBox,\n  //     {\n  //       editBBox: state.ui.editBBox,\n  //       prevEditBBox: state.ui.editBBox,\n  //     },\n  //     state\n  //   );\n\n  //   return;\n\n  //   // if (this.prevEditBBox === undefined) {\n  //   //   return;\n  //   // }\n  //   // const diffX = this.mouseDragHelper.end.x - this.mouseDragHelper.start.x;\n  //   // const diffY = this.mouseDragHelper.end.y - this.mouseDragHelper.start.y;\n  //   // const name = getThreeNameFromEditBBoxId(this.prevEditBBox.id);\n  //   // const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //   // if (object !== undefined) {\n  //   //   object.position.x = this.prevEditBBox.x + diffX;\n  //   //   object.position.y = this.prevEditBBox.y + diffY;\n  //   // }\n\n  //   // const nameTL = getThreeNameFromEditBBoxId(\n  //   //   this.prevEditBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n  //   // );\n  //   // const objectTL = appThree.scene.getObjectByUserDataProperty(\"name\", nameTL);\n  //   // if (objectTL !== undefined) {\n  //   //   objectTL.position.x = this.prevEditBBox.resizeXTL + diffX;\n  //   //   objectTL.position.y = this.prevEditBBox.resizeYTL + diffY;\n  //   // }\n\n  //   // const nameTR = getThreeNameFromEditBBoxId(\n  //   //   this.prevEditBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n  //   // );\n  //   // const objectTR = appThree.scene.getObjectByUserDataProperty(\"name\", nameTR);\n  //   // if (objectTR !== undefined) {\n  //   //   objectTR.position.x = this.prevEditBBox.resizeXTR + diffX;\n  //   //   objectTR.position.y = this.prevEditBBox.resizeYTR + diffY;\n  //   // }\n\n  //   // const nameBL = getThreeNameFromEditBBoxId(\n  //   //   this.prevEditBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n  //   // );\n  //   // const objectBL = appThree.scene.getObjectByUserDataProperty(\"name\", nameBL);\n  //   // if (objectBL !== undefined) {\n  //   //   objectBL.position.x = this.prevEditBBox.resizeXBL + diffX;\n  //   //   objectBL.position.y = this.prevEditBBox.resizeYBL + diffY;\n  //   // }\n  //   // const nameBR = getThreeNameFromEditBBoxId(\n  //   //   this.prevEditBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n  //   // );\n  //   // const objectBR = appThree.scene.getObjectByUserDataProperty(\"name\", nameBR);\n  //   // if (objectBR !== undefined) {\n  //   //   objectBR.position.x = this.prevEditBBox.resizeXBR + diffX;\n  //   //   objectBR.position.y = this.prevEditBBox.resizeYBR + diffY;\n  //   // }\n  // }\n}\n","import * as THREE from \"three\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeIdle extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    this.isCameraGrabed = true;\n\n    if (appThree.el === null) {\n      return;\n    }\n\n    this.boundingClientRect = appThree.el.getBoundingClientRect();\n    const { top, left } = this.boundingClientRect;\n\n    const screenX = event.clientX - left;\n    const screenY = event.clientY - top;\n\n    this.startDragMousePosition.x = screenX;\n    this.startDragMousePosition.y = screenY;\n\n    this.startDragCamera.x = appThree.camera.position.x;\n    this.startDragCamera.y = appThree.camera.position.y;\n  }\n\n  onMove(event: PointerEvent) {\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n\n    if (this.isCameraGrabed === true) {\n      const { getState } = appStore;\n      const state = getState();\n\n      const { top, left } = this.boundingClientRect;\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n      const sceneScale = state.ui.zoomScale;\n\n      const screenMouseDiffX = this.startDragMousePosition.x - screenX;\n      const screenMouseDiffY = this.startDragMousePosition.y - screenY;\n\n      const mouseDiffXInWorldSpace = screenMouseDiffX * sceneScale;\n      const mouseDiffYInWorldSpace = screenMouseDiffY * sceneScale;\n\n      const cameraX = this.startDragCamera.x + mouseDiffXInWorldSpace;\n      const cameraY = this.startDragCamera.y - mouseDiffYInWorldSpace;\n\n      appThree.camera.position.x = cameraX;\n      appThree.camera.position.y = cameraY;\n      appThree.camera.lookAt(cameraX, cameraY, 0);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    this.boundingClientRect = undefined;\n    if (this.isCameraGrabed === true) {\n      this.isCameraGrabed = false;\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport { getBeadIdFromThreeName } from \"../../../editorObjects/Bead\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"./../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"./../MouseSelectionHelper\";\nimport { screenToWorld } from \"./../screenToWorld\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModePaint extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  mouseSelectionHelper: MouseSelectionHelper;\n\n  \n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {\n    if (appThree.el !== null) {\n      this.boundingClientRect = appThree.el.getBoundingClientRect();\n    }\n    const { x, y } = screenToWorld(event.clientX, event.clientY);\n    this.mouseDragHelper.onDown(x, y);\n  }\n\n  onMove(event: PointerEvent) {\n    const { getState, dispatch } = appStore;\n    const state = getState();\n\n    if (this.boundingClientRect === undefined) {\n      return;\n    }\n\n    if (this.mouseDragHelper.isDragStarted === true) {\n      const { width, height, top, left } = this.boundingClientRect;\n\n      this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n      this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n\n      this.raycaster.setFromCamera(this.mouse, appThree.camera);\n      const intersects = this.raycaster.intersectObjects(\n        appThree.scene.children,\n        true\n      );\n\n      // if (intersects.length > 0) {\n      //   const beadsIds: string[] = [];\n      //   intersects.forEach((e) => {\n      //     const name = e.object.name;\n      //     const beadId = getBeadIdFromThreeName(name);\n      //     if (beadId !== undefined) {\n      //       if (state.appData.beads[beadId]) {\n      //         if (beadsIds.includes(beadId) === false) {\n      //           beadsIds.push(beadId);\n      //         }\n      //         return;\n      //       } else {\n      //         console.warn(\n      //           \"bead id missing in store\",\n      //           beadId,\n      //           name,\n      //           Object.keys(state.appData.beads).includes(beadId),\n      //           Object.keys(state.appData.beads)\n      //         );\n      //       }\n      //     }\n      //   });\n      //   if (beadsIds.length > 0) {\n      //     dispatch(\n      //       Actions.Toolbar.action_changeBeadColorToBeadTemplate(beadsIds)\n      //     );\n      //   }\n      // }\n\n      const screenX = event.clientX - left;\n      const screenY = event.clientY - top;\n      this.mouseSelectionHelper.onMove(screenX, screenY);\n    }\n  }\n\n  onUp(event: PointerEvent) {\n    const { getState, dispatch } = appStore;\n    const state = getState();\n    if (this.mouseDragHelper.isDragged === true) {\n      // do nothing\n    } else if (\n      this.mouseDragHelper.isDragged === false &&\n      this.mouseDragHelper.isDragStarted === true\n    ) {\n      if (this.boundingClientRect === undefined) {\n        return;\n      }\n      const { width, height, top, left } = this.boundingClientRect;\n\n      this.mouse.x = ((event.clientX - left) / width) * 2 - 1;\n      this.mouse.y = -((event.clientY - top) / height) * 2 + 1;\n\n      this.raycaster.setFromCamera(this.mouse, appThree.camera);\n      const intersects = this.raycaster.intersectObjects(\n        appThree.scene.children,\n        true\n      );\n\n      // if (intersects.length > 0) {\n      //   const beadsIds: string[] = [];\n      //   intersects.forEach((e) => {\n      //     const id = getBeadIdFromThreeName(e.object.name);\n      //     if (id !== undefined) {\n      //       if (state.appData.beads[id]) {\n      //         beadsIds.push(id);\n      //       } else {\n      //         console.warn(\"bead id missing in store\", id);\n      //       }\n      //     }\n      //   });\n      //   if (beadsIds.length > 0) {\n      //     dispatch(\n      //       Actions.Toolbar.action_changeBeadColorToBeadTemplate(beadsIds)\n      //     );\n      //   }\n      // }\n    }\n\n    this.mouseDragHelper.onUp();\n    this.mouseSelectionHelper.onUp();\n  }\n}\n","import { difference } from \"lodash\";\nimport * as THREE from \"three\";\nimport {\n  getBeadIdFromThreeName,\n  getThreeNameFromBeadId,\n} from \"../../../editorObjects/Bead\";\nimport {\n  EditBBoxChildSuffix,\n  getEditBBoxIdFromThreeName,\n  getThreeNameFromEditBBoxId,\n} from \"../../../editorObjects/EditBBox\";\nimport { EditBBox } from \"../../../editorObjects/Editor\";\nimport { buildPoint } from \"../../../editorObjects/Point\";\nimport {\n  getRegionIdFromThreeName,\n  getThreeNameFromRegionId,\n  RegionChildSuffix,\n} from \"../../../editorObjects/Region\";\nimport { appStore } from \"../../../immerReducers/appStore\";\nimport { Actions } from \"../../../immerReducers/store\";\nimport { appThree } from \"../../renderThreejs\";\nimport { MouseDragHelper } from \"../MouseDragHelper\";\nimport { MouseSelectionHelper } from \"../MouseSelectionHelper\";\nimport { screenToWorld } from \"../screenToWorld\";\nimport { SelectionFilter } from \"../SelectionFilter\";\nimport { MouseEventsBase } from \"./MouseEventsBase\";\n\nexport class MouseEventsEditorModeSelectMultiple extends MouseEventsBase {\n  isCameraGrabed: boolean;\n  startDragMousePosition: THREE.Vector2;\n  startDragCamera: THREE.Vector2;\n  boundingClientRect: DOMRect | undefined;\n  mouseDragHelper: MouseDragHelper;\n  mouse: THREE.Vector2;\n  raycaster: THREE.Raycaster;\n  selectionBox: SelectionFilter;\n  mouseSelectionHelper: MouseSelectionHelper;\n  prevEditBBox: any | undefined;\n\n  constructor() {\n    super();\n    this.boundingClientRect = undefined;\n    this.isCameraGrabed = false;\n    this.startDragMousePosition = new THREE.Vector2();\n    this.startDragCamera = new THREE.Vector2();\n    this.mouseDragHelper = new MouseDragHelper();\n    this.mouse = new THREE.Vector2();\n    this.raycaster = new THREE.Raycaster();\n\n    this.mouseSelectionHelper = new MouseSelectionHelper();\n    this.mouseSelectionHelper.setRenderer(appThree.renderer);\n\n    this.selectionBox = new SelectionFilter();\n    this.selectionBox.setCamera(appThree.camera);\n    this.selectionBox.setScene(appThree.scene);\n  }\n\n  onWheel(event: PointerEvent) {}\n\n  onResize(event: PointerEvent) {}\n\n  onDown(event: PointerEvent) {}\n\n  onMove(event: PointerEvent) {}\n\n  onUp(event: PointerEvent) {}\n}\n","import * as THREE from \"three\";\n\nlet mousePosition: undefined | THREE.Vector2 = undefined;\nexport const getMousePositionAtWindow = () => {\n  return mousePosition;\n};\nexport const setMousePositionAtWindow = (clientX?: number, clientY?: number) => {\n  if (!clientX || !clientY) {\n    mousePosition = undefined;\n  } else {\n    const newPos = new THREE.Vector2();\n    newPos.x = clientX;\n    newPos.y = clientY;\n    mousePosition = newPos;\n  }\n//   console.log(\"new mouse position\", mousePosition);\n};\n","import { appThree } from \"../renderThreejs\";\nimport { screenToWorld } from \"./screenToWorld\";\n\nexport const getRect10x10FromScreenToWorld = () => {\n  const viewportOffset = appThree.el.getBoundingClientRect();\n  const w = 10;\n  const h = 10;\n  const x1 = viewportOffset.left;\n  const x2 = viewportOffset.left + w;\n  const y1 = viewportOffset.top;\n  const y2 = viewportOffset.top + h;\n  const pos1 = screenToWorld(x1, y1);\n  const pos2 = screenToWorld(x2, y2);\n  const maxX = Math.max(pos1.x, pos2.x);\n  const minX = Math.min(pos1.x, pos2.x);\n  const minY = Math.min(pos1.y, pos2.y);\n  const maxY = Math.max(pos1.y, pos2.y);\n  const rect10x10FromScreenToWorld = {\n    min: {\n      x: minX,\n      y: minY,\n    },\n    max: {\n      x: maxX,\n      y: maxY,\n    },\n    w: maxX - minX,\n    h: maxY - minY,\n  };\n  return rect10x10FromScreenToWorld;\n};\n","import produce from \"immer\";\nimport { times } from \"lodash\";\nimport {\n  AddObjects,\n  RemoveObjects,\n  ChangeSelectObjects,\n  ChangeObjectsProperty,\n  ClipboardCut,\n  ClipboardPaste,\n  AddMultipleBeads,\n  ChangeSelectedObjectsAlignment,\n  DuplicateObjects,\n  GroupObjects,\n  UngroupObjects,\n} from \"./AppEventType\";\nimport { SimpleHistoryEvent } from \"./store\";\nimport { sendEvent } from \"./storeController\";\n\nexport interface HistoryEvent<D, R, U> {\n  do: D;\n  redo: R;\n  undo: U;\n  createdAt: string;\n}\nexport interface AddObjectsHistory\n  extends HistoryEvent<AddObjects, AddObjects, RemoveObjects> {}\n\nexport interface DuplicateObjectsHistory\n  extends HistoryEvent<DuplicateObjects, DuplicateObjects, RemoveObjects> {}\n\nexport interface RemoveObjectsHistory\n  extends HistoryEvent<RemoveObjects, RemoveObjects, AddObjects> {}\nexport interface ChangeSelectObjectsHistory\n  extends HistoryEvent<\n    ChangeSelectObjects,\n    ChangeSelectObjects,\n    ChangeSelectObjects\n  > {}\nexport interface ChangeObjectsPropertyHistory\n  extends HistoryEvent<\n    ChangeObjectsProperty,\n    ChangeObjectsProperty,\n    ChangeObjectsProperty\n  > {}\nexport interface ClipboardCutHistory\n  extends HistoryEvent<ClipboardCut, ClipboardCut, ClipboardPaste> {}\nexport interface ClipboardPasteHistory\n  extends HistoryEvent<ClipboardPaste, ClipboardPaste, RemoveObjects> {}\nexport interface AddMultipleBeadsHistory\n  extends HistoryEvent<AddMultipleBeads, AddObjects, RemoveObjects> {}\nexport interface ChangeSelectedObjectsAlignmentHistory\n  extends HistoryEvent<\n    ChangeSelectedObjectsAlignment,\n    ChangeSelectedObjectsAlignment,\n    ChangeObjectsProperty\n  > {}\nexport interface GroupObjectsHistory\n  extends HistoryEvent<GroupObjects, GroupObjects, UngroupObjects> {}\nexport interface UngroupObjectsHistory\n  extends HistoryEvent<UngroupObjects, UngroupObjects, GroupObjects> {}\n\nexport type AppHistoryEvents =\n  | AddObjectsHistory\n  | RemoveObjectsHistory\n  | ChangeSelectObjectsHistory\n  | ChangeObjectsPropertyHistory\n  | ClipboardCutHistory\n  | ClipboardPasteHistory\n  | AddMultipleBeadsHistory\n  | ChangeSelectedObjectsAlignmentHistory\n  | DuplicateObjectsHistory\n  | GroupObjectsHistory\n  | UngroupObjectsHistory;\n\nexport class AppHistory {\n  events: AppHistoryEvents[] = [];\n  index: number = 0;\n  maxHistoryRecords: number = 100;\n  push(arg: AppHistoryEvents): void {\n    const len = this.events.length;\n    if (len !== this.index) {\n      this.events.splice(this.index, len - this.index);\n    }\n    this.events.push(arg);\n    this.index += 1;\n    if (this.events.length > this.maxHistoryRecords) {\n      const diff = this.events.length - this.maxHistoryRecords;\n      this.events.splice(0, diff);\n      this.index = this.index - diff;\n    }\n  }\n  front(): AppHistoryEvents | undefined {\n    const event = this.events[this.index];\n    this.index += 1;\n    if (this.index > this.events.length) {\n      this.index = this.events.length;\n    }\n    return event;\n  }\n  back(): AppHistoryEvents | undefined {\n    const event = this.events[this.index - 1];\n    this.index -= 1;\n    if (this.index <= 0) {\n      this.index = 0;\n    }\n    return event;\n  }\n  getSimpleHistoryEvents() {\n    return this.events.map((e, i) => {\n      return {\n        name: e.do.name,\n        isActive: i < this.index,\n        createdAt: e.createdAt,\n      } as SimpleHistoryEvent;\n    });\n  }\n  canRedo() {\n    return this.index !== this.events.length;\n  }\n  canUndo() {\n    return this.index > 0;\n  }\n}\n\nexport const undoHistory = () => {\n  const history = getHistory();\n  const lastEvent = history.back();\n  if (lastEvent !== undefined) {\n    sendEvent(lastEvent.undo, false);\n  }\n};\n\nexport const redoHistory = () => {\n  const history = getHistory();\n  const lastEvent = history.front();\n  if (lastEvent !== undefined) {\n    sendEvent(lastEvent.redo, false);\n  }\n};\n\nexport const jumpToIndexHistory = (index: number) => {\n  const history = getHistory();\n  const lastIndex = history.index - 1;\n\n  if (index === lastIndex) {\n    // do nothing\n  } else if (index >= 0 && index < lastIndex) {\n    times(lastIndex - index).forEach(() => {\n      undoHistory();\n    });\n  } else if (index < history.events.length && index > lastIndex) {\n    times(index - lastIndex).forEach(() => {\n      redoHistory();\n    });\n  }\n};\n\nlet history: AppHistory;\n\nexport const initHistory = () => {\n  history = new AppHistory();\n};\n\nexport const getHistory = () => {\n  return history;\n};\n","import * as THREE from \"three\";\nimport { addLightFromUI, triggerAddBeadToScene } from \"./eventEmitterHandlers\";\nimport { AppObject, Bead, ObjectTypes } from \"../editorObjects/Editor\";\nimport { AppThreeScene } from \"./renderThreejs\";\nimport { getStore } from \"../controllers/store\";\n\nexport let thumbnailsGenerator: ThumbnailsGenerator;\n\nexport const initThumbnailsGenerator = () => {\n  try {\n    const rootEl = document.createElement(\"div\");\n    rootEl.setAttribute(\"id\", \"thumbnailsGeneratorRoot\");\n    thumbnailsGenerator = new ThumbnailsGenerator(rootEl);\n    rootEl.appendChild(thumbnailsGenerator.renderer.domElement);\n    rootEl.style.display = \"none\";\n    document.body.appendChild(rootEl);\n    // loadAppModels(thumbnailsGenerator);\n  } catch (err) {\n    console.error(\"initThumbnailsGenerator err:\", err.toString());\n  }\n};\n\nclass ThumbnailsGenerator {\n  el: HTMLElement;\n  // camera: THREE.OrthographicCamera;\n  scene: AppThreeScene;\n  renderer: THREE.WebGLRenderer;\n  cache: { [key: string]: string };\n  constructor(el: HTMLElement) {\n    this.el = el;\n    this.cache = {};\n    // const { width, height } = el.getBoundingClientRect();\n\n    // this.camera = new THREE.OrthographicCamera(\n    //   width / -2,\n    //   width / 2,\n    //   height / 2,\n    //   height / -2,\n    //   0,\n    //   1000\n    // );\n\n    // this.camera.position.set(0, 0, 500);\n    // this.camera.lookAt(0, 0, 0);\n\n    this.scene = new THREE.Scene() as any;\n    this.scene.background = new THREE.Color(\"#fff\");\n\n    this.renderer = new THREE.WebGLRenderer({\n      antialias: true,\n      preserveDrawingBuffer: true,\n    });\n    // this.renderer.setSize(width, height);\n  }\n\n  getObjectThumbnail(\n    object: AppObject,\n    imgWidth: number,\n    imgHeight: number,\n    forceCache: boolean = false\n  ) {\n    const cacheData: any = {\n      imgWidth,\n      imgHeight,\n      width: object.width,\n      height: object.height,\n      depth: object.depth,\n      rotateX: object.rotateX,\n      rotateY: object.rotateY,\n      rotateZ: object.rotateZ,\n    };\n    if (object.objectType === ObjectTypes.Bead) {\n      cacheData.type = (object as Bead).type;\n      cacheData.color = (object as Bead).color;\n    }\n\n    const cacheId = JSON.stringify(cacheData);\n    if (forceCache === true || this.cache[cacheId] === undefined) {\n      const content = this.createObjectThumbnail(object, imgWidth, imgHeight);\n      if (content === undefined) {\n        return undefined;\n      } else {\n        this.cache[cacheId] = content;\n      }\n    }\n    return this.cache[cacheId];\n  }\n\n  createObjectThumbnail(\n    object: AppObject,\n    imgWidth: number,\n    imgHeight: number\n  ) {\n    try {\n      this.renderer.setSize(imgWidth, imgHeight);\n\n      this.scene.clear();\n\n      if (object.objectType !== ObjectTypes.Bead) {\n        console.warn(\"object.objectType not supported yet\");\n        return;\n      }\n\n      const object3d = triggerAddBeadToScene(object as Bead, this.scene);\n\n      if (object3d === undefined) {\n        console.warn(\"triggerAddBeadToScene object not created in scene\");\n        return;\n      }\n\n      object3d.position.x = 0;\n      object3d.position.y = 0;\n\n      const bbox = new THREE.Box3();\n      bbox.expandByObject(object3d);\n\n      let width = 1;\n      let height = 1;\n      // let depth = 1;\n\n      if (bbox) {\n        width = Math.abs(bbox.max.x - bbox.min.x);\n        height = Math.abs(bbox.max.y - bbox.min.y);\n        // depth = Math.abs(bbox.max.z - bbox.min.z);\n      }\n\n      const objectRatio = width / height;\n      const ratioImage = imgWidth / imgHeight;\n      let baseWidth = 1;\n      let baseHeight = 1;\n      if (ratioImage < objectRatio) {\n        baseWidth = width;\n        baseHeight = baseWidth * ratioImage;\n      } else {\n        baseHeight = height;\n        baseWidth = baseHeight / ratioImage;\n      }\n      const halfWidth = (baseWidth + baseWidth * 0.1) / 2;\n      const halfHeight = (baseHeight + baseHeight * 0.1) / 2;\n\n      const camera = new THREE.OrthographicCamera(\n        halfWidth * -1,\n        halfWidth,\n        halfHeight,\n        halfHeight * -1,\n        0,\n        1000\n      );\n\n      camera.position.set(0, 0, 500);\n      camera.lookAt(0, 0, 0);\n\n      const store = getStore();\n      store.ui.lights.forEach((lightConfig) => {\n        addLightFromUI(lightConfig, this.scene);\n      });\n\n      this.renderer.render(this.scene, camera);\n\n      const MIME_TYPE = \"image/png\";\n      const content = this.renderer.domElement.toDataURL(MIME_TYPE);\n      //   .replace(\"image/png\", \"image/octet-stream\");\n      // const link = document.createElement(\"a\");\n      // document.body.appendChild(link);\n      // link.download = \"coralinio-preview.png\";\n      // link.href = content;\n      // link.click();\n      // document.body.removeChild(link);\n\n      this.scene.clear();\n\n      return content;\n\n      // var img = new Image();\n      // img.src = content;\n      // img.id = \"1111111111111111\"\n      // document.body.appendChild(img);\n    } catch (e) {\n      console.log(\"getObjectThumbnail error:\", e);\n      return;\n    }\n  }\n}\n","import * as THREE from \"three\";\nimport { initEventEmitterHandlers } from \"./eventEmitterHandlers\";\nimport { loadAppModels } from \"./loadModels\";\nimport { initMouseListeners } from \"./mouseListeners/mouseListeners\";\nimport { getRect10x10FromScreenToWorld } from \"./mouseListeners/getRect10x10FromScreenToWorld\";\nimport {\n  initKeybinding,\n  startListeningKeys,\n  subscribeKeys,\n} from \"./keyboard/keyMap\";\nimport {\n  initHistory,\n  redoHistory,\n  undoHistory,\n} from \"../controllers/AppHistory\";\nimport { getStore, initStore } from \"../controllers/store\";\nimport { clipboardCopy, clipboardCut, clipboardPaste } from \"./clipboard\";\nimport { initThumbnailsGenerator } from \"./thumbnailsGenerator\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { AppEventType, RemoveObjects } from \"../controllers/AppEventType\";\nimport { Point } from \"../editorObjects/Editor\";\nimport { logger } from \"../logger\";\n\nexport let appThree: AppThree;\n\nexport const renderThreejs = (\n  el: HTMLElement | null,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  return initCanvasApp(el, canvas, context);\n};\n\nexport const unmountThreejs = (el: HTMLElement | null) => {\n  if (el !== undefined && el !== null) {\n    el.innerHTML = \"\";\n\n    if (el.classList && el.classList.contains(\"active\") === true) {\n      el.classList.remove(\"active\");\n    }\n  }\n  return new Promise((resolve) => {\n    resolve(undefined);\n  });\n};\n\nconst initCanvasApp = async (\n  el: HTMLElement | null,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  if (el === null) {\n    logger.warn(\"no html el element found\");\n    return;\n  }\n\n  if (el.classList.contains(\"active\") === false) {\n    el.classList.add(\"active\");\n  }\n\n  try {\n    logger.trace(\"initCanvasApp...1\");\n    initStore();\n    initHistory();\n    initKeybinding();\n    logger.log(\"initCanvasApp...2\");\n    appThree = new AppThree(el, canvas, context);\n    el.appendChild(appThree.renderer.domElement);\n    await loadAppModels(appThree);\n    initMouseListeners();\n    initEventEmitterHandlers();\n    requestAnimationFrame(threeRender);\n    // startListeningKeys();\n    logger.log(\"initCanvasApp...4\");\n\n    const rect10x10FromScreenToWorld = getRect10x10FromScreenToWorld();\n    appThree.camera.userData = { sceneScale: 1, rect10x10FromScreenToWorld };\n    // subscribeKeys(\"keyz\", (event, pressed) => {\n    //   if (event.ctrlKey || event.metaKey) {\n    //     logger.trace(\"listener:: undohistory\");\n    //     undoHistory();\n    //   }\n    //   return false;\n    // });\n    // subscribeKeys(\"keyy\", (event, pressed) => {\n    //   if (event.ctrlKey || event.metaKey) {\n    //     logger.trace(\"listener:: redohistory\");\n    //     redoHistory();\n    //   }\n    //   return false;\n    // });\n    // subscribeKeys(\"keyc\", (event, pressed) => {\n    //   if (event.ctrlKey || event.metaKey) {\n    //     logger.trace(\"listener:: copy\");\n    //     clipboardCopy();\n    //   }\n    //   return false;\n    // });\n    // subscribeKeys(\"keyx\", (event, pressed) => {\n    //   if (event.ctrlKey || event.metaKey) {\n    //     logger.trace(\"listener:: cut\");\n    //     clipboardCut();\n    //   }\n    //   return false;\n    // });\n    // subscribeKeys(\"keyv\", (event, pressed) => {\n    //   if (event.ctrlKey || event.metaKey) {\n    //     logger.trace(\"listener:: paste\");\n    //     clipboardPaste();\n    //   }\n    //   return false;\n    // });\n    // subscribeKeys(\"delete\", (event, pressed) => {\n    //   logger.trace(\"listener:: delete\");\n    //   const store = getStore();\n    //   if (store.selectedIds.length > 0) {\n    //     const action: RemoveObjects = {\n    //       name: AppEventType.RemoveObjects,\n    //       payload: {\n    //         ids: store.selectedIds,\n    //       },\n    //     };\n    //     sendEvent(action);\n    //   }\n    //   return false;\n    // });\n\n    // console.log(\"co w odpowiedzi?\", rectangle(0, 0, 2, 2, {} as any, {\n    //   brickSize: 10,\n    //   brickHeight: 25,\n    //   brickWidth: 20,\n    //   color: \"red\",\n    //   filled: true,\n    //   palette: [],\n    // }));\n    initThumbnailsGenerator();\n  } catch (err) {\n    console.error(\"err:\", err.toString());\n  }\n  return;\n};\n\nexport interface AppThreeScene extends THREE.Scene {\n  getObjectByUserDataProperty: (\n    name: string,\n    value: any\n  ) => undefined | THREE.Object3D;\n}\n\nclass AppThree {\n  el: HTMLElement;\n  camera: THREE.OrthographicCamera;\n  scene: AppThreeScene;\n  renderer: THREE.WebGLRenderer;\n  additionalData: {\n    selectedBBox:\n      | {\n          topLeft: Point;\n          topRight: Point;\n          bottomLeft: Point;\n          bottomRight: Point;\n        }\n      | undefined;\n  };\n  objects: Map<String, THREE.Object3D>;\n  constructor(\n    el: HTMLElement,\n    canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n    context: WebGLRenderingContext | undefined\n  ) {\n    this.el = el;\n    const { width, height } = el.getBoundingClientRect();\n\n    this.additionalData = {\n      selectedBBox: undefined,\n    };\n    this.objects = new Map<String, THREE.Object3D>();\n    this.camera = new THREE.OrthographicCamera(\n      width / -2,\n      width / 2,\n      height / 2,\n      height / -2,\n      0,\n      1000\n    );\n\n    this.camera.position.set(0, 0, 500);\n    this.camera.lookAt(0, 0, 0);\n    this.camera.layers.enable(2);\n\n    this.scene = new THREE.Scene() as any;\n    this.scene.background = new THREE.Color(\"#f2f2f2\");\n\n    this.renderer = new THREE.WebGLRenderer({\n      canvas: canvas ?? undefined,\n      context: context ?? undefined,\n      antialias: true,\n      preserveDrawingBuffer: true,\n    });\n    // this.renderer.setPixelRatio(window.devicePixelRatio);\n\n    this.renderer.setSize(width, height);\n  }\n}\n\nfunction threeRender() {\n  if (needToResizeRendererToDisplaySize(appThree.renderer)) {\n    appThree.camera.updateProjectionMatrix();\n  }\n\n  appThree.renderer.render(appThree.scene, appThree.camera);\n  requestAnimationFrame(threeRender);\n}\n\nfunction needToResizeRendererToDisplaySize(renderer) {\n  const canvas = renderer.domElement;\n  const width = canvas.clientWidth;\n  const height = canvas.clientHeight;\n  const needResize = canvas.width !== width || canvas.height !== height;\n  if (needResize) {\n    renderer.setSize(width, height, false);\n  }\n  return needResize;\n}\n\n// @TODO: HOW TO EXTEND THREE JS MODULE?\n// declare module \"three\" {\n//   export class Object3D {\n//     getObjectByUserDataProperty: (\n//       name: string,\n//       value: any\n//     ) => undefined | Object3D;\n//   }\n// }\n// source: https://github.com/mrdoob/three.js/blob/0fbc8afb348198e4924d9805d1d4be5869264418/src/core/Object3D.js#L85\n// source: https://discourse.threejs.org/t/getobject-by-any-custom-property-present-in-userdata-of-object/3378\n(THREE.Object3D.prototype as any).getObjectByUserDataProperty = function (\n  name: string,\n  value: any\n) {\n  if (this.userData[name] === value) return this;\n\n  for (var i = 0, l = this.children.length; i < l; i++) {\n    var child = this.children[i];\n    var object = child.getObjectByUserDataProperty(name, value);\n\n    if (object !== undefined) {\n      return object;\n    }\n  }\n\n  return undefined;\n};\n","import * as THREE from \"three\";\nimport { getStore } from \"../../controllers/store\";\nimport { appStore } from \"../../immerReducers/appStore\";\nimport { appThree } from \"../renderThreejs\";\n\nexport const screenToWorld = (\n  clientX: number,\n  clientY: number\n): THREE.Vector2 => {\n  if (appThree.el === null) {\n    throw new Error(\"no el in dom\");\n  }\n  if (!appStore) {\n    throw new Error(\"no el in dom\");\n  }\n  // const { getState } = appStore;\n  // const state = getState();\n  const store = getStore();\n  const sceneScale = store.ui.zoomScale;\n  const { width, height, top, left } = appThree.el.getBoundingClientRect();\n  const screenX = clientX - left; // canvasX\n  const screenY = clientY - top; // canvasY\n  const x = (screenX - width / 2) * sceneScale + appThree.camera.position.x;\n  const y = (-screenY + height / 2) * sceneScale + appThree.camera.position.y;\n  return new THREE.Vector2(x, y);\n};\n\nexport const worldToScreen = (pos: THREE.Vector3) => {\n  if (!appStore) {\n    throw new Error(\"no el in dom\");\n  }\n  // const { getState } = appStore;\n  // const state = getState();\n  // const store = getStore();\n  // const sceneScale = store.ui.zoomScale;\n  const { width, height, top, left } = appThree.el.getBoundingClientRect();\n  var vector = pos.clone();\n  // vector.setFromMatrixPosition(obj.matrixWorld);\n  var widthHalf = width / 2;\n  var heightHalf = height / 2;\n  \n  vector.project(appThree.camera);\n  // console.log(\"??? \", vector)\n  // console.log(\"------\", vector.x, vector.y, sceneScale);\n  vector.x = vector.x * widthHalf + widthHalf + left;\n  vector.y = -(vector.y * heightHalf) + heightHalf + top;\n  return vector;\n};\n\nexport const getTopBarPositionInScreenFromObject = (bbox: THREE.Box3) => {\n  // const pos = worldToScreen(obj);\n\n  // const bbox = new THREE.Box3();\n  // bbox.expandByObject(obj);\n  if (isFinite(bbox.min.x) === false || isFinite(bbox.max.y) === false) {\n    return undefined;\n  }\n\n  // const offset = new THREE.Vector3();\n  // offset.x = bbox.min.x;\n  // offset.y = bbox.min.y;\n\n  // console.log(\n  //   \"getTopBarPositionInScreenFromObject bbox.min\",\n  //   bbox.min,\n  //   bbox.max\n  // );\n\n  // bbox.getCenter().x\n  var vector = new THREE.Vector3();\n  vector.x = bbox.min.x + (bbox.max.x - bbox.min.x) / 2;\n  vector.y = bbox.max.y;\n\n  // vector = obj.localToWorld(vector);\n  // vector.sub(offset);\n  const pos2 = worldToScreen(vector);\n\n  if(pos2.x < 0){\n    pos2.x = 0;\n  } \n  if(pos2.y < 70){\n    pos2.y = 70;\n  } \n\n  // var vector2 = new THREE.Vector3();\n  // vector2.add()\n  // vector.add(pos2)\n\n  return pos2;\n};\n\nexport const getTopBarPositionInScreenFromBBox = (vector: THREE.Vector3) => {\n  return worldToScreen(vector);\n};\n","import { cloneDeep, merge, times } from \"lodash\";\nimport * as THREE from \"three\";\nimport { ChangeObjectsProperty } from \"../controllers/AppEventType\";\nimport {\n  BeadChildSuffix,\n  getThreeNameFromBeadId,\n  getThreeUserDataFromBead,\n} from \"../editorObjects/Bead\";\nimport {\n  EditBBoxChildSuffix,\n  getThreeNameFromEditBBoxId,\n  getThreeUserDataFromEditBBox,\n} from \"../editorObjects/EditBBox\";\nimport {\n  AppObject,\n  Bead,\n  BeadMaterialTypes,\n  BeadTypes,\n  EditBBox,\n  Editor,\n  Group,\n  NAME_SEPARATOR,\n  ObjectTypes,\n  PreviewProject3D,\n  Region,\n  RegionGridType,\n  RegionShape,\n  ThreeGridHelperConfig,\n  ThreeLightConfig,\n} from \"../editorObjects/Editor\";\nimport { getStateObjectFromObjectId } from \"../editorObjects/editorGetters\";\nimport {\n  getThreeUserDataFromGroup,\n  GroupChildSuffix,\n} from \"../editorObjects/Group\";\nimport {\n  getThreeUserDataFromPreviewProject3D,\n  PreviewProject3DChildSuffix,\n} from \"../editorObjects/PreviewProject3D\";\nimport {\n  getThreeNameFromRegionId,\n  getThreeUserDataFromRegion,\n  isActiveRegionCell,\n  RegionChildSuffix,\n} from \"../editorObjects/Region\";\nimport { EventNames, getEventEmitter } from \"../EventEmitter\";\nimport { logger } from \"../logger\";\nimport { getModelBBoxFromBeadType, getModelFromBeadType } from \"./loadModels\";\nimport { getTopBarPositionInScreenFromObject } from \"./mouseListeners/screenToWorld\";\nimport { appThree, AppThreeScene } from \"./renderThreejs\";\n\ntype SelectBBoxRect = {\n  id: string;\n  position: THREE.Vector3;\n  width: number;\n  height: number;\n  depth: number;\n  rotation: THREE.Vector3;\n};\nclass SelectBBox {\n  rotation: THREE.Vector3;\n  position: THREE.Vector3;\n  width: number;\n  height: number;\n  depth: number;\n  rectangles: SelectBBoxRect[];\n  internalId: string;\n  dotBrName: string;\n  dotBlName: string;\n  dotTrName: string;\n  dotTlName: string;\n  selectBboxGroupName: string;\n  selectBBoxBgName: string;\n  boxGeometry: THREE.BoxGeometry;\n  obj: THREE.Mesh<THREE.BoxGeometry, THREE.Material | THREE.Material[]>;\n\n  constructor() {\n    this.rotation = new THREE.Vector3(0, 0, 0);\n    this.position = new THREE.Vector3(0, 0, 0);\n    this.width = 0;\n    this.height = 0;\n    this.depth = 0;\n    this.rectangles = [];\n    this.internalId = THREE.MathUtils.generateUUID();\n    this.selectBboxGroupName = getThreeNameFromEditBBoxId(this.internalId);\n    this.selectBBoxBgName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.BG\n    );\n    this.dotBrName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n    );\n    this.dotBlName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n    );\n    this.dotTrName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n    );\n    this.dotTlName = getThreeNameFromEditBBoxId(\n      this.internalId,\n      EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n    );\n    this.boxGeometry = new THREE.BoxGeometry(1, 1, 1);\n    this.obj = new THREE.Mesh(this.boxGeometry);\n  }\n\n  updateRect(rectangle: SelectBBoxRect, isSelected: boolean) {\n    let toDelete = false;\n    let toCreate = false;\n    const rectIndex = this.rectangles.findIndex((e) => e.id === rectangle.id);\n    const isRectExists = rectIndex !== -1;\n\n    if (isSelected === true && isRectExists === false) {\n      toCreate = true;\n    } else if (isSelected === false && isRectExists === true) {\n      toDelete = true;\n    }\n\n    if (toCreate === false && toDelete === false) {\n      return;\n    }\n\n    if (toDelete) {\n      this.rectangles.splice(rectIndex, 1);\n    }\n\n    if (toCreate) {\n      this.rectangles.push(cloneDeep(rectangle));\n    }\n\n    if (this.rectangles.length === 1) {\n      this.rotation = this.rectangles[0].rotation;\n    } else {\n      this.rotation = new THREE.Vector3(0, 0, 0);\n    }\n\n    const bbox = new THREE.Box3();\n    this.rectangles.forEach((rect) => {\n      const { width, height, depth, position, rotation } = rect;\n      this.obj.scale.set(width, height, depth);\n      this.obj.position.set(position.x, position.y, position.z);\n      this.obj.rotation.set(\n        THREE.MathUtils.DEG2RAD * rotation.x,\n        THREE.MathUtils.DEG2RAD * rotation.y,\n        THREE.MathUtils.DEG2RAD * rotation.z\n      );\n      bbox.expandByObject(this.obj);\n    });\n    this.position = new THREE.Vector3();\n    bbox.getCenter(this.position);\n    this.width = bbox.max.x - bbox.min.x;\n    this.height = bbox.max.y - bbox.min.y;\n    this.depth = bbox.max.z - bbox.min.z;\n\n    if (this.rectangles.length === 0) {\n      const object = appThree.objects.get(this.selectBboxGroupName);\n      if (object !== undefined) {\n        if (object.parent !== undefined && object.parent !== null) {\n          object.parent.remove(object);\n        }\n      }\n      appThree.objects.delete(this.dotBlName);\n      appThree.objects.delete(this.dotBrName);\n      appThree.objects.delete(this.dotTlName);\n      appThree.objects.delete(this.dotTrName);\n      appThree.objects.delete(this.selectBBoxBgName);\n      appThree.objects.delete(this.selectBboxGroupName);\n    } else {\n      const object = appThree.objects.get(this.selectBboxGroupName);\n\n      if (object === undefined) {\n        // create bbox\n        const selectBBoxGoup = new THREE.Group();\n        selectBBoxGoup.userData.name = this.selectBboxGroupName;\n\n        const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n        const material = new THREE.MeshBasicMaterial({\n          color: \"rgb(0,0,0)\",\n          side: THREE.FrontSide,\n          opacity: 0.2,\n          transparent: true,\n        });\n        const selectBBoxBg = new THREE.Mesh(geometry, material);\n        selectBBoxBg.userData.name = this.selectBBoxBgName;\n\n        const x1 = -0.5;\n        const x2 = 0.5;\n        const y1 = -0.5;\n        const y2 = 0.5;\n        const rectShape = new THREE.Shape()\n          .moveTo(x1, y1)\n          .lineTo(x2, y1)\n          .lineTo(x2, y2)\n          .lineTo(x1, y2);\n\n        rectShape.autoClose = true;\n\n        const _rectLinesPoints = rectShape.getPoints();\n        const _rectLinesGeometryPoints = new THREE.BufferGeometry().setFromPoints(\n          _rectLinesPoints\n        );\n        const _rectLinesMaterial = new THREE.MeshBasicMaterial({\n          color: 0x0040f0,\n          opacity: 1,\n          transparent: true,\n        });\n        const selectBBoxLines = new THREE.Line(\n          _rectLinesGeometryPoints,\n          _rectLinesMaterial\n        );\n\n        const resizeDots = getResizeDots(this.internalId, bbox);\n\n        resizeDots.forEach((dot) => {\n          appThree.objects.set(dot.userData.name, dot);\n          selectBBoxGoup.attach(dot);\n        });\n\n        selectBBoxBg.add(selectBBoxLines);\n        selectBBoxGoup.add(selectBBoxBg);\n        appThree.scene.add(selectBBoxGoup);\n\n        appThree.objects.set(this.selectBboxGroupName, selectBBoxGoup);\n        appThree.objects.set(this.selectBBoxBgName, selectBBoxBg);\n      }\n\n      const _bg = appThree.objects.get(this.selectBBoxBgName);\n      if (_bg !== undefined) {\n        _bg.position.set(this.position.x, this.position.y, this.position.z);\n        _bg.scale.set(this.width, this.height, this.depth);\n        // _bg.rotation.set(this.rotation.x, this.rotation.y, this.rotation.z);\n      }\n      // debugger;\n\n      const _dotTl = appThree.objects.get(this.dotTlName);\n      if (_dotTl !== undefined) {\n        const v1 = new THREE.Vector3(\n          bbox.min.x - this.position.x,\n          bbox.min.y - this.position.y,\n          bbox.min.z - this.position.z\n        );\n        const e = new THREE.Euler();\n        e.setFromVector3(\n          new THREE.Vector3(\n            THREE.MathUtils.DEG2RAD * this.rotation.x,\n            THREE.MathUtils.DEG2RAD * this.rotation.y,\n            THREE.MathUtils.DEG2RAD * this.rotation.z\n          )\n        );\n        const m1 = new THREE.Matrix4();\n        m1.makeRotationFromEuler(e);\n        // v1.applyMatrix4(m1);\n        _dotTl.position.set(\n          this.position.x + v1.x,\n          this.position.y + v1.y,\n          this.position.z + v1.z\n        );\n      }\n\n      const _dotTr = appThree.objects.get(this.dotTrName);\n      if (_dotTr !== undefined) {\n        const v1 = new THREE.Vector3(\n          bbox.max.x - this.position.x,\n          bbox.min.y - this.position.y,\n          bbox.min.z - this.position.z\n        );\n        const e = new THREE.Euler();\n        e.setFromVector3(\n          new THREE.Vector3(\n            THREE.MathUtils.DEG2RAD * this.rotation.x,\n            THREE.MathUtils.DEG2RAD * this.rotation.y,\n            THREE.MathUtils.DEG2RAD * this.rotation.z\n          )\n        );\n        const m1 = new THREE.Matrix4();\n        m1.makeRotationFromEuler(e);\n        // v1.applyMatrix4(m1);\n        _dotTr.position.set(\n          this.position.x + v1.x,\n          this.position.y + v1.y,\n          this.position.z + v1.z\n        );\n      }\n\n      const _dotBl = appThree.objects.get(this.dotBlName);\n      if (_dotBl !== undefined) {\n        const v1 = new THREE.Vector3(\n          bbox.min.x - this.position.x,\n          bbox.max.y - this.position.y,\n          bbox.min.z - this.position.z\n        );\n        const e = new THREE.Euler();\n        e.setFromVector3(\n          new THREE.Vector3(\n            THREE.MathUtils.DEG2RAD * this.rotation.x,\n            THREE.MathUtils.DEG2RAD * this.rotation.y,\n            THREE.MathUtils.DEG2RAD * this.rotation.z\n          )\n        );\n        const m1 = new THREE.Matrix4();\n        m1.makeRotationFromEuler(e);\n        // v1.applyMatrix4(m1);\n        _dotBl.position.set(\n          this.position.x + v1.x,\n          this.position.y + v1.y,\n          this.position.z + v1.z\n        );\n      }\n\n      const _dotBr = appThree.objects.get(this.dotBrName);\n      if (_dotBr !== undefined) {\n        const v1 = new THREE.Vector3(\n          bbox.max.x - this.position.x,\n          bbox.max.y - this.position.y,\n          bbox.min.z - this.position.z\n        );\n        const e = new THREE.Euler();\n        e.setFromVector3(\n          new THREE.Vector3(\n            THREE.MathUtils.DEG2RAD * this.rotation.x,\n            THREE.MathUtils.DEG2RAD * this.rotation.y,\n            THREE.MathUtils.DEG2RAD * this.rotation.z\n          )\n        );\n        const m1 = new THREE.Matrix4();\n        m1.makeRotationFromEuler(e);\n        // v1.applyMatrix4(m1);\n        _dotBr.position.set(\n          this.position.x + v1.x,\n          this.position.y + v1.y,\n          this.position.z + v1.z\n        );\n      }\n    }\n  }\n}\n\nlet selectBBoxInstance: SelectBBox | null = null;\nexport const getSelectBBox = (): SelectBBox => {\n  if (selectBBoxInstance == null) {\n    selectBBoxInstance = new SelectBBox();\n  }\n  return selectBBoxInstance;\n};\nexport const clearSelectBBox = () => {\n  selectBBoxInstance = null;\n};\n\n/**@deprecated */\nexport const initEventEmitterHandlers = () => {\n  const eventEmitter = getEventEmitter();\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_color, (data) => {\n    data.beadIds.forEach((id) => {\n      const name = getThreeNameFromBeadId(id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n      if (object === undefined) {\n        return;\n      }\n\n      object.traverse((child) => {\n        if (child instanceof THREE.Mesh) {\n          if (child.material) {\n            (child.material as THREE.MeshPhysicalMaterial).color.set(\n              data.color\n            );\n          }\n        }\n      });\n    });\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_height, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      const bbox = getModelBBoxFromBeadType(bead.type);\n      let width = 1;\n      let height = 1;\n      let depth = 1;\n      if (bbox) {\n        width = Math.abs(bbox.max.x - bbox.min.x);\n        height = Math.abs(bbox.max.y - bbox.min.y);\n        depth = Math.abs(bbox.max.z - bbox.min.z);\n      }\n      object.scale.x = bead.width / width;\n      object.scale.y = bead.height / height;\n      object.scale.z = bead.depth / depth;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_unselectAll, (data) => {\n    data.diffStateSelectedIds.forEach((obj) => {\n      if (obj.objectType === ObjectTypes.Bead) {\n        triggerSelectBead(obj.id, obj.isSelected);\n      } else if (obj.objectType === ObjectTypes.Region) {\n        triggerSelectRegion(obj.id, obj.isSelected);\n      }\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_width, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      const bbox = getModelBBoxFromBeadType(bead.type);\n      let width = 1;\n      let height = 1;\n      let depth = 1;\n      if (bbox) {\n        width = Math.abs(bbox.max.x - bbox.min.x);\n        height = Math.abs(bbox.max.y - bbox.min.y);\n        depth = Math.abs(bbox.max.z - bbox.min.z);\n      }\n      object.scale.x = bead.width / width;\n      object.scale.y = bead.height / height;\n      object.scale.z = bead.depth / depth;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_depth, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      const bbox = getModelBBoxFromBeadType(bead.type);\n      let width = 1;\n      let height = 1;\n      let depth = 1;\n      if (bbox) {\n        width = Math.abs(bbox.max.x - bbox.min.x);\n        height = Math.abs(bbox.max.y - bbox.min.y);\n        depth = Math.abs(bbox.max.z - bbox.min.z);\n      }\n      object.scale.x = bead.width / width;\n      object.scale.y = bead.height / height;\n      object.scale.z = bead.depth / depth;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_type, (data) => {\n    data.beadIds.forEach((id) => {\n      const name = getThreeNameFromBeadId(id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      appThree.scene.remove(object);\n    });\n\n    data.beads.forEach((bead: Bead) => {\n      triggerAddBeadToScene(bead, appThree.scene);\n      triggerSelectBead(bead.id, true);\n    });\n\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_changeSelectedBeads_rotate, (data) => {\n    data.beadIds.forEach((id) => {\n      const name = getThreeNameFromBeadId(id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n\n      object.rotation.x = THREE.MathUtils.DEG2RAD * data.rotateX;\n      object.rotation.y = THREE.MathUtils.DEG2RAD * data.rotateY;\n      object.rotation.z = THREE.MathUtils.DEG2RAD * data.rotateZ;\n    });\n\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_selectBeads, (data) => {\n    data.diffStates.forEach((bead) => {\n      const id = Object.keys(bead)[0];\n      const value = Object.values(bead)[0] as boolean;\n      triggerSelectBead(id, value);\n    });\n  });\n\n  eventEmitter.on(EventNames.action_selectIntersectObject, (data) => {\n    data.diffStateSelectedIds.forEach((obj) => {\n      if (obj.objectType === ObjectTypes.Bead) {\n        triggerSelectBead(obj.id, obj.isSelected);\n      } else if (obj.objectType === ObjectTypes.Region) {\n        triggerSelectRegion(obj.id, obj.isSelected);\n      }\n    });\n\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_selectIntersectObjects, (data) => {\n    if (data?.selectedBeads?.diffStates) {\n      data.selectedBeads?.diffStates?.forEach((bead) => {\n        const id = Object.keys(bead)[0];\n        const value = Object.values(bead)[0] as boolean;\n        triggerSelectBead(id, value);\n      });\n    }\n    if (data?.selectedRegions?.diffStates) {\n      data.selectedRegions?.diffStates?.forEach((region) => {\n        const id = Object.keys(region)[0];\n        const value = Object.values(region)[0] as boolean;\n        triggerSelectRegion(id, value);\n      });\n    }\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_updateZoomSCale, (data) => {\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_updateEditBBox, (data) => {\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_selectRegions, (data) => {\n    const selectedIds: string[] = [];\n    data.diffStates.forEach((bead) => {\n      const id = Object.keys(bead)[0];\n      const value = Object.values(bead)[0] as boolean;\n      triggerSelectRegion(id, value);\n      if (value === true) {\n        selectedIds.push(id);\n      }\n    });\n  });\n\n  eventEmitter.on(EventNames.action_deleteBeads, (data) => {\n    triggerDeleteBeadIds(data.beadIds);\n  });\n\n  eventEmitter.on(EventNames.action_deleteSelectedBeads, (data) => {\n    triggerDeleteBeadIds(data.beadIds);\n  });\n\n  eventEmitter.on(EventNames.action_deleteObjects, (data) => {\n    triggerDeleteObjectIds(data.toDeleteObjectIds);\n  });\n\n  eventEmitter.on(EventNames.action_addBeadOnClick, (data) => {\n    const bead = data.bead as Bead;\n    triggerAddBeadToScene(bead, appThree.scene);\n  });\n\n  eventEmitter.on(EventNames.action_updateLight, (data) => {\n    const { name, field, value } = data;\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object !== undefined) {\n      const light = object as THREE.DirectionalLight;\n      if (data.field === \"color\") {\n        light.color = data.value;\n      }\n      if (data.field === \"intensity\") {\n        light.intensity = data.value;\n      }\n    }\n  });\n\n  eventEmitter.on(EventNames.action_addRegion, (data) => {\n    const region = data.region as Region;\n    triggerRegionToScene(region);\n  });\n\n  eventEmitter.on(EventNames.action_moveClickedObject, (data) => {\n    data.movedObjects.forEach((obj) => {\n      const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n      if (name === undefined) {\n        return;\n      }\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.position.x = obj.position.x;\n      object.position.y = obj.position.y;\n    });\n  });\n\n  eventEmitter.on(EventNames.action_moveAllSelectedObjects, (data) => {\n    data.movedObjects.forEach((obj) => {\n      const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n      if (name === undefined) {\n        return;\n      }\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.position.x = obj.position.x;\n      object.position.y = obj.position.y;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.action_movedSelected, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id, BeadChildSuffix.MAIN);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.position.x = bead.position.x;\n      object.position.y = bead.position.y;\n    });\n    data.regions.forEach((region: Region) => {\n      const name = getThreeNameFromRegionId(region.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      logger.trace(\"co bylo?\", object.position.x, region.position.x);\n      object.position.x = region.position.x;\n      object.position.y = region.position.y;\n    });\n    triggerUpdateEditBBox(data.editBBox, data.prevEditBBox);\n  });\n\n  eventEmitter.on(EventNames.updateEditorState, () => {});\n\n  eventEmitter.on(EventNames.action_changeBeadColorToBeadTemplate, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.traverse((child) => {\n        if (child instanceof THREE.Mesh) {\n          child.material = new THREE.MeshPhysicalMaterial({\n            flatShading: true,\n            reflectivity: 1,\n            color: data.color,\n          });\n        }\n      });\n    });\n  });\n\n  eventEmitter.on(EventNames.action_fastAddBeads, (data) => {\n    Object.keys(data.beads).forEach((id) => {\n      const bead = data.beads[id] as Bead;\n      triggerAddBeadToScene(bead, appThree.scene);\n    });\n\n    data.prevSelectedBeadIds.forEach((beadId) => {\n      triggerSelectBead(beadId, false);\n    });\n  });\n\n  eventEmitter.on(EventNames.action_snapToLineSelectedBeads, (data) => {\n    data.beads.forEach((bead: Bead) => {\n      const name = getThreeNameFromBeadId(bead.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        return;\n      }\n      object.position.x = bead.position.x;\n      object.position.y = bead.position.y;\n    });\n  });\n\n  eventEmitter.on(EventNames.action_onChangeEditorMode, (data) => {\n    data.prevSelectedBeadIds.forEach((beadId) => {\n      triggerSelectBead(beadId, false);\n    });\n  });\n\n  eventEmitter.on(EventNames.action_readSavedCanvas, (data) => {\n    Object.keys(data.objects).forEach((id) => {\n      const obj = data.objects[id] as AppObject;\n      if (obj.objectType === ObjectTypes.Bead) {\n        triggerAddBeadToScene(obj as Bead, appThree.scene);\n      } else if (obj.objectType === ObjectTypes.Region) {\n        triggerRegionToScene(obj as Region);\n      } else if (obj.objectType === ObjectTypes.Group) {\n        triggerGroupToScene(obj as Group);\n      } else if (obj.objectType === ObjectTypes.PreviewProject3D) {\n        triggerPreviewProject3DToScene(obj as PreviewProject3D);\n      }\n    });\n    // Object.keys(data.beads).forEach((id) => {\n    //   const bead = data.beads[id] as Bead;\n    //   triggerAddBeadToScene(bead);\n    // });\n    // Object.keys(data.regions).forEach((id) => {\n    //   const region = data.regions[id] as Region;\n    //   triggerRegionToScene(region);\n    // });\n  });\n\n  eventEmitter.on(EventNames.startAppEvent, (data: { state: Editor }) => {\n    console.log(\"startAppEvent: ...\", data.state.ui.lights);\n\n    if (data.state.ui.lights && data.state.ui.lights.length > 0) {\n      data.state.ui.lights.forEach((l) => {\n        if (l.type === \"THREE.DirectionalLight\") {\n          const light = new THREE.DirectionalLight(l.color, l.intensity);\n          light.position.set(\n            l.position?.x ?? 0,\n            l.position?.y ?? 0,\n            l.position?.z ?? 10\n          );\n          light.name = l.name;\n          light.userData = merge({}, light, {\n            objectType: ObjectTypes.SceneLight,\n            name: `${ObjectTypes.SceneLight}${NAME_SEPARATOR}${light.id}`,\n          });\n          appThree.scene.add(light);\n        }\n      });\n    }\n    if (data.state.ui.grid.isVisible) {\n      const size = 100000;\n      const grid = new THREE.GridHelper(1, size / 10, \"#e9e9e9\", \"#eee\");\n      grid.position.x = 0;\n      grid.position.y = 0;\n      grid.position.z = -500;\n      grid.scale.x = size;\n      grid.scale.y = size;\n      grid.scale.z = size;\n\n      grid.rotation.x = THREE.MathUtils.DEG2RAD * 90;\n      grid.rotation.y = THREE.MathUtils.DEG2RAD * 0;\n      grid.rotation.z = THREE.MathUtils.DEG2RAD * 0;\n      grid.userData = merge({}, data.state.ui.grid, {\n        objectType: ObjectTypes.SceneBackgroundGrid,\n        name: `${ObjectTypes.SceneBackgroundGrid}${NAME_SEPARATOR}${data.state.ui.grid.id}`,\n      });\n\n      appThree.scene.add(grid);\n    }\n  });\n};\n\nexport const clearThreeScene = () => {\n  appThree.scene.clear();\n};\n\nexport const addLightFromUI = (\n  config: ThreeLightConfig,\n  scene: AppThreeScene\n) => {\n  if (config.type === \"THREE.DirectionalLight\") {\n    const light = new THREE.DirectionalLight(config.color, config.intensity);\n    light.position.set(\n      config.position?.x ?? 0,\n      config.position?.y ?? 0,\n      config.position?.z ?? 10\n    );\n    light.name = config.name;\n    light.userData = merge({}, light, {\n      objectType: ObjectTypes.SceneLight,\n      name: `${ObjectTypes.SceneLight}${NAME_SEPARATOR}${light.id}`,\n    });\n    scene.add(light);\n  }\n};\n\nexport const addGridFromUi = (config: ThreeGridHelperConfig) => {\n  const size = 100000;\n  const grid = new THREE.GridHelper(1, size / 10, \"#e9e9e9\", \"#eee\");\n  grid.position.x = 0;\n  grid.position.y = 0;\n  grid.position.z = -500;\n  grid.scale.x = size;\n  grid.scale.y = size;\n  grid.scale.z = size;\n\n  grid.rotation.x = THREE.MathUtils.DEG2RAD * 90;\n  grid.rotation.y = THREE.MathUtils.DEG2RAD * 0;\n  grid.rotation.z = THREE.MathUtils.DEG2RAD * 0;\n  grid.userData = merge({}, config, {\n    objectType: ObjectTypes.SceneBackgroundGrid,\n    name: `${ObjectTypes.SceneBackgroundGrid}${NAME_SEPARATOR}${config.id}`,\n  });\n  appThree.scene.add(grid);\n};\n\nexport const addObjectByObjectType = (object: AppObject) => {\n  const { objectType } = object;\n  if (objectType === ObjectTypes.Bead) {\n    triggerAddBeadToScene(object as any, appThree.scene);\n  }\n  if (objectType === ObjectTypes.Region) {\n    triggerRegionToScene(object as any);\n  }\n  if (objectType === ObjectTypes.Group) {\n    triggerGroupToScene(object as any);\n  }\n  if (objectType === ObjectTypes.PreviewProject3D) {\n    triggerPreviewProject3DToScene(object as any);\n  }\n};\n\nexport const updateObjectsProperty = (event: ChangeObjectsProperty) => {\n  // @TODO: update\n  // event.payload.change.forEach(obj => {\n  //   obj.id\n  // })\n};\n\nexport const getTopBarPosition = (\n  objects: { id: string; objectType: ObjectTypes }[]\n) => {\n  const bbox = new THREE.Box3();\n\n  objects.forEach((obj) => {\n    const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n    if (name === undefined) {\n      return;\n    }\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object === undefined) {\n      return;\n    }\n    bbox.expandByObject(object);\n  });\n\n  return getTopBarPositionInScreenFromObject(bbox);\n  // console.log('jaki mam bbox?', bbox.min, bbox.max)\n};\n\nexport const updateObjectPosition = (\n  objectId: string,\n  objectType: ObjectTypes,\n  positionX: number,\n  positionY: number\n) => {\n  const name = getStateObjectFromObjectId(objectId, objectType);\n  if (name === undefined) {\n    return;\n  }\n  const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  if (object === undefined) {\n    return;\n  }\n  object.position.x = positionX;\n  object.position.y = positionY;\n};\n\nexport const triggerSelectBead = (id: string, shouldSelect: boolean) => {\n  const name = getThreeNameFromBeadId(id);\n  const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n  if (object === undefined) {\n    return;\n  }\n\n  (object as any).traverse((child) => {\n    if (child instanceof THREE.Mesh) {\n      if (child.material) {\n        if (shouldSelect === true) {\n          (child.material as THREE.MeshPhysicalMaterial).emissive.set(0x171717);\n        } else {\n          (child.material as THREE.MeshPhysicalMaterial).emissive.set(0);\n        }\n      }\n    }\n  });\n  if (shouldSelect === true) {\n    const bbox = new THREE.Box3();\n\n    bbox.expandByObject(object as any);\n\n    const x = bbox.min.x;\n    const y = bbox.min.y;\n    const w = Math.abs(bbox.max.x - bbox.min.x);\n    const h = Math.abs(bbox.max.y - bbox.min.y);\n    const z = 1;\n\n    // const material = new THREE.LineBasicMaterial({\n    //   color: \"#5794fc\",\n    // });\n\n    const width = 1;\n    const height = 1;\n    const rectWidth = width - 0.0;\n    const rectHeight = height - 0.0;\n    const rectShape = new THREE.Shape()\n      .moveTo(rectWidth / 2, rectHeight / 2)\n      .lineTo((rectWidth / 2) * -1, rectHeight / 2)\n      .lineTo((rectWidth / 2) * -1, (rectHeight / 2) * -1)\n      .lineTo(rectWidth / 2, (rectHeight / 2) * -1);\n\n    rectShape.autoClose = true;\n\n    const _rectPoints = rectShape.getPoints();\n    const _rectGeometryPoints = new THREE.BufferGeometry().setFromPoints(\n      _rectPoints\n    );\n    const _lineMaterial = new THREE.MeshBasicMaterial({ color: 0x0040f0 });\n    const lines = new THREE.Line(_rectGeometryPoints, _lineMaterial);\n\n    // const geometry = new THREE.BufferGeometry().setFromPoints(points);\n\n    // const lines = new THREE.LineSegments(geometry, material);\n\n    // const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n    // const material = new THREE.MeshBasicMaterial({\n    //   color: \"#5794fc\",\n    //   side: THREE.FrontSide,\n    //   opacity: 0.99,\n    //   transparent: false,\n    // });\n    // const lines = new THREE.Mesh(geometry, material);\n    lines.userData = getThreeUserDataFromBead(\n      (object as any).userData,\n      BeadChildSuffix.SELECTION_CHILD\n    );\n\n    const rectangleFrame = new THREE.Group();\n    rectangleFrame.userData = getThreeUserDataFromBead(\n      (object as any).userData,\n      BeadChildSuffix.SELECTION\n    );\n    // rectangleFrame.scale.x = 1;\n    // rectangleFrame.scale.y = 1;\n    // rectangleFrame.scale.z = 1;\n    rectangleFrame.userData.position.x = x + w / 2;\n    rectangleFrame.userData.position.y = y + h / 2;\n    rectangleFrame.position.x = x + w / 2;\n    rectangleFrame.position.y = y + h / 2;\n    rectangleFrame.position.z = -460;\n    rectangleFrame.scale.x = w;\n    rectangleFrame.scale.y = h;\n    rectangleFrame.scale.z = z;\n    rectangleFrame.add(lines);\n    object.attach(rectangleFrame);\n  } else {\n    const name = getThreeNameFromBeadId(id, BeadChildSuffix.SELECTION);\n    const _object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (_object === undefined) {\n      return;\n    }\n    object.remove(_object);\n  }\n};\n\nexport const triggerRegionToScene = (region: Region) => {\n  const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  // @TODO: zmiana koloru i opacity\n  const material = new THREE.MeshBasicMaterial({\n    color: \"rgb(0,0,0)\",\n    side: THREE.FrontSide,\n    opacity: 0.1,\n    transparent: true,\n  });\n  const regionBgThree = new THREE.Mesh(geometry, material);\n  regionBgThree.userData = getThreeUserDataFromRegion(\n    region,\n    RegionChildSuffix.BG\n  );\n\n  const regionGridCellsThree = new THREE.Group();\n  regionGridCellsThree.userData = getThreeUserDataFromRegion(\n    region,\n    RegionChildSuffix.GRID_CELLS\n  );\n\n  region.childrenGridIds.forEach((beadId, index) => {\n    const row = Math.floor(index / region.columns);\n    const column = Math.floor(index % region.columns);\n    const isCellActive = isActiveRegionCell(region, index);\n    const cellWidth = 1 / region.columns;\n    const cellHeight = 1 / region.rows;\n    const halfWidth = cellWidth / 2;\n    const halfHeight = cellHeight / 2;\n    const x1 = halfWidth;\n    const x2 = -halfWidth;\n    const y1 = halfHeight;\n    const y2 = -halfHeight;\n    const rectShape = new THREE.Shape()\n      .moveTo(x1, y1)\n      .lineTo(x2, y1)\n      .lineTo(x2, y2)\n      .lineTo(x1, y2);\n\n    rectShape.autoClose = true;\n\n    const _rectPoints = rectShape.getPoints();\n    const _rectGeometryPoints = new THREE.BufferGeometry().setFromPoints(\n      _rectPoints\n    );\n    const _lineMaterial = new THREE.MeshBasicMaterial({\n      color: isCellActive ? 0x0040f0 : \"red\",\n      opacity: isCellActive ? 1 : 0,\n      transparent: isCellActive ? false : true,\n    });\n    const _cell = new THREE.Line(_rectGeometryPoints, _lineMaterial);\n    _cell.userData = getThreeUserDataFromRegion(\n      region,\n      RegionChildSuffix.GRID_CELL\n    );\n    const offsetEnabled = region.gridType === RegionGridType.Bricks;\n    const offsetX = offsetEnabled ? (row % 2 === 0 ? 0 : halfWidth) : 0;\n    const x = cellWidth * column + halfWidth;\n    _cell.position.x = x + offsetX - 0.5;\n    const y = cellHeight * row + halfHeight;\n    _cell.position.y = y - 0.5;\n    regionGridCellsThree.add(_cell);\n  });\n\n  const regionThree = new THREE.Group();\n  regionThree.userData = getThreeUserDataFromRegion(\n    region,\n    RegionChildSuffix.MAIN\n  );\n  regionThree.position.x = region.position.x;\n  regionThree.position.y = region.position.y;\n  regionThree.position.z = -300;\n  regionThree.scale.x = region.width;\n  regionThree.scale.y = region.height;\n  regionThree.scale.z = 1;\n\n  regionThree.rotation.x = THREE.MathUtils.DEG2RAD * region.rotateX;\n  regionThree.rotation.y = THREE.MathUtils.DEG2RAD * region.rotateY;\n  regionThree.rotation.z = THREE.MathUtils.DEG2RAD * region.rotateZ;\n\n  regionThree.add(regionBgThree);\n  regionThree.add(regionGridCellsThree);\n\n  // regionThree.layers.set(2)\n  // regionThree.layers.enableAll();\n  appThree.scene.add(regionThree);\n\n  // @TODO: CHeck lines\n  // const material = new THREE.LineBasicMaterial({ color: 0x0000ff });\n  // material.linewidth = 10\n  // const points: THREE.Vector3[] = [];\n  // points.push(new THREE.Vector3(-10, 0, 0));\n  // points.push(new THREE.Vector3(0, 10, 0));\n  // points.push(new THREE.Vector3(10, 0, 0));\n  // const geometry = new THREE.BufferGeometry().setFromPoints(points);\n  // const line = new THREE.Line(geometry, material);\n  // appThree.scene.add(line)\n};\n\nexport const triggerAddBeadToScene = (bead: Bead, scene: AppThreeScene) => {\n  const beadType = bead.type;\n  //  const beadTHREEObject = new THREE.Group();\n  const beadModel = getModelFromBeadType(beadType);\n\n  if (beadModel === undefined) {\n    console.warn(\"beadModel not found for type: \", beadType, bead.id);\n    return;\n  }\n\n  const object = scene.getObjectByUserDataProperty(\"id\", bead.id);\n\n  if (object !== undefined) {\n    console.warn(\"bead already in scene\", bead.id);\n    return;\n  }\n\n  beadModel.traverse((child) => {\n    child.userData = getThreeUserDataFromBead(bead, BeadChildSuffix.ANY);\n    if (child instanceof THREE.Mesh) {\n      if (bead.material === BeadMaterialTypes.Mat) {\n        child.material = new THREE.MeshPhysicalMaterial({\n          reflectivity: 1,\n          color: bead.color,\n        });\n      } else if (bead.material === BeadMaterialTypes.Shiny) {\n        child.material = new THREE.MeshPhongMaterial({\n          color: bead.color,\n        });\n      } else {\n        console.warn(\"unknow BeadMaterialTypes:\", bead.material);\n      }\n\n      // child.material = new THREE.MeshLambertMaterial({\n      //   color: bead.color,\n      // });\n\n      // child.material = new THREE.MeshStandardMaterial({\n      //   color: bead.color,\n      //   metalness: 0,\n      //   roughness: 0.5,\n      // });\n\n      // child.material = new THREE.MeshDepthMaterial();\n\n      // child.material = new THREE.MeshPhysicalMaterial({\n      //   flatShading: true,\n      //   reflectivity: 1,\n      //   color: bead.color,\n      // });\n    }\n    // child.layers.set(2);\n    if ((child as any).geometry) {\n      (child as any).geometry.computeBoundingBox();\n    }\n  });\n\n  const bbox = getModelBBoxFromBeadType(beadType);\n  let width: number = 1;\n  let height: number = 1;\n  let depth: number = 1;\n  if (bbox) {\n    width = Math.abs(bbox.max.x - bbox.min.x);\n    height = Math.abs(bbox.max.y - bbox.min.y);\n    depth = Math.abs(bbox.max.z - bbox.min.z);\n  }\n\n  beadModel.scale.x = bead.width / width;\n  beadModel.scale.y = bead.height / height;\n  beadModel.scale.z = bead.depth / depth;\n\n  beadModel.rotation.x = THREE.MathUtils.DEG2RAD * bead.rotateX;\n  beadModel.rotation.y = THREE.MathUtils.DEG2RAD * bead.rotateY;\n  beadModel.rotation.z = THREE.MathUtils.DEG2RAD * bead.rotateZ;\n\n  beadModel.position.x = bead.position.x;\n  beadModel.position.y = bead.position.y;\n  beadModel.position.z = bead.position.z;\n\n  beadModel.userData = getThreeUserDataFromBead(bead);\n  // beadModel.layers.set(2);\n\n  // beadTHREEObject.add(beadModel);\n\n  scene.add(beadModel);\n  return beadModel;\n};\n\nexport const triggerGroupToScene = (group: Group) => {\n  const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  const material = new THREE.MeshBasicMaterial({\n    color: \"rgb(0,0,0)\",\n    side: THREE.FrontSide,\n    opacity: 0.2,\n    transparent: true,\n  });\n  const groupBgThree = new THREE.Mesh(geometry, material);\n  groupBgThree.userData = getThreeUserDataFromGroup(group, GroupChildSuffix.BG);\n\n  const groupThree = new THREE.Group();\n  groupThree.userData = getThreeUserDataFromGroup(group, GroupChildSuffix.MAIN);\n  groupThree.position.x = group.position.x;\n  groupThree.position.y = group.position.y;\n  groupThree.position.z = -400;\n  groupThree.scale.x = group.width;\n  groupThree.scale.y = group.height;\n  groupThree.scale.z = 1;\n\n  // groupThree.rotation.x = THREE.MathUtils.DEG2RAD * group.rotateX;\n  // groupThree.rotation.y = THREE.MathUtils.DEG2RAD * group.rotateY;\n  // groupThree.rotation.z = THREE.MathUtils.DEG2RAD * group.rotateZ;\n  groupThree.add(groupBgThree);\n\n  appThree.scene.add(groupThree);\n};\n\nexport const triggerPreviewProject3DToScene = (\n  previewProject3D: PreviewProject3D\n) => {\n  const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  const material = new THREE.MeshBasicMaterial({\n    color: \"rgb(0,0,0)\",\n    side: THREE.FrontSide,\n    opacity: 0.1,\n    transparent: true,\n  });\n  const groupBgThree = new THREE.Mesh(geometry, material);\n  groupBgThree.userData = getThreeUserDataFromPreviewProject3D(\n    previewProject3D,\n    PreviewProject3DChildSuffix.BG\n  );\n\n  const groupThree = new THREE.Group();\n  groupThree.userData = getThreeUserDataFromPreviewProject3D(\n    previewProject3D,\n    PreviewProject3DChildSuffix.MAIN\n  );\n  groupThree.position.x = previewProject3D.position.x;\n  groupThree.position.y = previewProject3D.position.y;\n  // groupThree.position.z = -500;\n  groupThree.scale.x = previewProject3D.width;\n  groupThree.scale.y = previewProject3D.height;\n  groupThree.scale.z = 1;\n\n  // groupThree.rotation.x = THREE.MathUtils.DEG2RAD * previewProject3D.rotateX;\n  // groupThree.rotation.y = THREE.MathUtils.DEG2RAD * previewProject3D.rotateY;\n  // groupThree.rotation.z = THREE.MathUtils.DEG2RAD * previewProject3D.rotateZ;\n\n  groupThree.add(groupBgThree);\n\n  appThree.scene.add(groupThree);\n};\n\nexport const triggerDeleteObjectIds = (\n  objects: { id: string; objectType: ObjectTypes }[]\n) => {\n  objects.forEach((obj) => {\n    const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n    if (name === undefined) {\n      console.warn(\n        \"triggerDeleteObjectIds:: name cant be created\",\n        obj.id,\n        obj.objectType\n      );\n      return;\n    }\n    const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n    if (object === undefined) {\n      console.warn(\"triggerDeleteObjectIds:: object not found by name\", name);\n      return;\n    }\n\n    appThree.scene.remove(object);\n\n    const __object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n    if (__object !== undefined) {\n      console.warn(\n        \"triggerDeleteObjectIds:: try double - object found by name in scene \",\n        name\n      );\n    }\n  });\n};\n\nexport const triggerDeleteBeadIds = (beadIds: string[]) => {\n  beadIds.forEach((beadId) => {\n    while (true) {\n      const name = getThreeNameFromBeadId(beadId);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        break;\n      }\n      appThree.scene.remove(object);\n    }\n    while (true) {\n      const name = getThreeNameFromBeadId(beadId, BeadChildSuffix.ANY);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object === undefined) {\n        break;\n      }\n      appThree.scene.remove(object);\n    }\n  });\n};\n\nexport const triggerUpdateEditBBox = (\n  editBBox: EditBBox | undefined,\n  prevEditBBox: EditBBox | undefined\n) => {\n  if (editBBox === undefined) {\n    if (prevEditBBox !== undefined) {\n      const name = getThreeNameFromEditBBoxId(prevEditBBox.id);\n      const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n      if (object !== undefined) {\n        appThree.scene.remove(object);\n      }\n\n      // const nameB = getThreeNameFromEditBBoxId(\n      //   prevEditBBox.id,\n      //   EditBBoxChildSuffix.RESIZE_CONTAINER\n      // );\n      // const objectB = appThree.scene.getObjectByUserDataProperty(\n      //   \"name\",\n      //   nameB\n      // );\n      // if (objectB !== undefined) {\n      //   appThree.scene.remove(objectB);\n      // }\n    }\n    return;\n  }\n\n  const rect10x10FromScreenToWorld =\n    appThree.camera.userData[\"rect10x10FromScreenToWorld\"];\n  const dotSize = (rect10x10FromScreenToWorld.w ?? 10) * 0.5;\n\n  // if (prevEditBBox === undefined) {\n  //   const editBBoxThree = new THREE.Group();\n\n  //   const geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n  //   const material = new THREE.MeshBasicMaterial({\n  //     color: \"#5794fc\",\n  //     side: THREE.FrontSide,\n  //     opacity: 0.1,\n  //     transparent: true,\n  //   });\n  //   const editBBoxBgThree = new THREE.Mesh(geometry, material);\n  //   editBBoxBgThree.userData = getThreeUserDataFromEditBBox(\n  //     editBBox,\n  //     EditBBoxChildSuffix.BG\n  //   );\n\n  //   const bbox = new THREE.Box3();\n\n  //   if (editBBox.selectedIds.length > 0) {\n  //     editBBox.selectedIds.forEach((obj) => {\n  //       const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n  //       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //       if (object === undefined) {\n  //         return;\n  //       }\n  //       bbox.expandByObject(object);\n  //     });\n  //   }\n\n  //   // if (editBBox.beadIds.length > 0) {\n  //   //   editBBox.beadIds.forEach((beadId) => {\n  //   //     const name = getThreeNameFromBeadId(beadId);\n  //   //     const object = appThree.scene.getObjectByUserDataProperty(\n  //   //       \"name\",\n  //   //       name\n  //   //     );\n  //   //     if (object === undefined) {\n  //   //       return;\n  //   //     }\n  //   //     bbox.expandByObject(object);\n  //   //   });\n  //   // }\n\n  //   // if (editBBox.regionsIds.length > 0) {\n  //   //   editBBox.regionsIds.forEach((regionsId) => {\n  //   //     const name = getThreeNameFromRegionId(regionsId);\n  //   //     const object = appThree.scene.getObjectByUserDataProperty(\n  //   //       \"name\",\n  //   //       name\n  //   //     );\n  //   //     if (object === undefined) {\n  //   //       return;\n  //   //     }\n  //   //     bbox.expandByObject(object);\n  //   //   });\n  //   // }\n\n  //   const x = bbox.min.x;\n  //   const y = bbox.min.y;\n  //   const w = Math.abs(bbox.max.x - bbox.min.x);\n  //   const h = Math.abs(bbox.max.y - bbox.min.y);\n  //   const z = 1;\n\n  //   editBBoxThree.userData = getThreeUserDataFromEditBBox(editBBox);\n  //   editBBoxThree.userData.position.x = x + w / 2;\n  //   editBBoxThree.userData.position.y = y + h / 2;\n  //   editBBoxThree.position.x = x + w / 2;\n  //   editBBoxThree.position.y = y + h / 2;\n  //   editBBoxThree.position.z = -460;\n  //   editBBoxThree.scale.x = w;\n  //   editBBoxThree.scale.y = h;\n  //   editBBoxThree.scale.z = z;\n  //   editBBoxThree.add(editBBoxBgThree);\n\n  //   // const editBBoxResizeThree = new THREE.Group();\n  //   // editBBoxResizeThree.userData = getThreeUserDataFromEditBBox(\n  //   //   editBBox,\n  //   //   EditBBoxChildSuffix.RESIZE_CONTAINER\n  //   // );\n  //   // editBBoxResizeThree.scale.x = 1;\n  //   // editBBoxResizeThree.scale.y = 1;\n  //   // editBBoxResizeThree.scale.z = 1;\n  //   // const __material = new THREE.MeshLambertMaterial({ color: \"#ffffff\" });\n  //   // const __boxGeometry = new THREE.CircleGeometry(1, 16);\n  //   // const _whiteDot = new THREE.Mesh(__boxGeometry, __material);\n  //   // _whiteDot.scale.x = 0.8;\n  //   // _whiteDot.scale.y = 0.8;\n  //   // _whiteDot.renderOrder = 2;\n\n  //   // const ___material = new THREE.MeshLambertMaterial({ color: \"#a9a9a9\" });\n  //   // const ___boxGeometry = new THREE.CircleGeometry(1, 16);\n  //   // const _grayDot = new THREE.Mesh(___boxGeometry, ___material);\n  //   // _grayDot.scale.x = 1;\n  //   // _grayDot.scale.y = 1;\n  //   // _grayDot.renderOrder = 1;\n\n  //   // const _baseDot = new THREE.Group();\n  //   // _baseDot.attach(_grayDot);\n  //   // _baseDot.attach(_whiteDot);\n\n  //   // const _dotTL = _baseDot.clone();\n  //   // _dotTL.position.x = bbox.min.x;\n  //   // _dotTL.position.y = bbox.max.y;\n  //   // _dotTL.scale.x = dotSize;\n  //   // _dotTL.scale.y = dotSize;\n  //   // _dotTL.userData = getThreeUserDataFromEditBBox(\n  //   //   editBBox,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n  //   // );\n  //   // editBBoxResizeThree.attach(_dotTL);\n\n  //   // const _dotTR = _baseDot.clone();\n  //   // _dotTR.position.x = bbox.max.x;\n  //   // _dotTR.position.y = bbox.max.y;\n  //   // _dotTR.scale.x = dotSize;\n  //   // _dotTR.scale.y = dotSize;\n  //   // _dotTR.userData = getThreeUserDataFromEditBBox(\n  //   //   editBBox,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n  //   // );\n  //   // editBBoxResizeThree.attach(_dotTR);\n\n  //   // const _dotBL = _baseDot.clone();\n  //   // _dotBL.position.x = bbox.min.x;\n  //   // _dotBL.position.y = bbox.min.y;\n  //   // _dotBL.scale.x = dotSize;\n  //   // _dotBL.scale.y = dotSize;\n  //   // _dotBL.userData = getThreeUserDataFromEditBBox(\n  //   //   editBBox,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n  //   // );\n  //   // editBBoxResizeThree.attach(_dotBL);\n\n  //   // const _dotBR = _baseDot.clone();\n  //   // _dotBR.position.x = bbox.max.x;\n  //   // _dotBR.position.y = bbox.min.y;\n  //   // _dotBR.scale.x = dotSize;\n  //   // _dotBR.scale.y = dotSize;\n  //   // _dotBL.userData = getThreeUserDataFromEditBBox(\n  //   //   editBBox,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n  //   // );\n  //   // editBBoxResizeThree.attach(_dotBR);\n\n  //   // appThree.scene.add(editBBoxResizeThree);\n  //   appThree.scene.add(editBBoxThree);\n  // } else {\n  //   const name = getThreeNameFromEditBBoxId(prevEditBBox.id);\n  //   const editBBoxThree = appThree.scene.getObjectByUserDataProperty(\n  //     \"name\",\n  //     name\n  //   );\n\n  //   if (editBBoxThree === undefined) {\n  //     return;\n  //   }\n\n  //   const bbox = new THREE.Box3();\n\n  //   if (editBBox.selectedIds.length > 0) {\n  //     editBBox.selectedIds.forEach((obj) => {\n  //       const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n  //       const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n  //       if (object === undefined) {\n  //         return;\n  //       }\n\n  //       bbox.expandByObject(object);\n\n  //       const isGroup = obj.objectType === ObjectTypes.Group;\n  //       const isInGroup = obj.groupId !== undefined && obj.groupId.length > 0;\n  //       if (isGroup || isInGroup) {\n  //         console.log(\"robie bbox dla grupy..\", obj.id, obj.groupId);\n  //       }\n  //     });\n  //   }\n\n  //   // if (editBBox.beadIds.length > 0) {\n  //   //   editBBox.beadIds.forEach((beadId) => {\n  //   //     const name = getThreeNameFromBeadId(beadId);\n  //   //     const object = appThree.scene.getObjectByUserDataProperty(\n  //   //       \"name\",\n  //   //       name\n  //   //     );\n  //   //     if (object === undefined) {\n  //   //       return;\n  //   //     }\n  //   //     bbox.expandByObject(object);\n  //   //   });\n  //   // }\n\n  //   // if (editBBox.regionsIds.length > 0) {\n  //   //   editBBox.regionsIds.forEach((regionsId) => {\n  //   //     const name = getThreeNameFromRegionId(regionsId);\n  //   //     const object = appThree.scene.getObjectByUserDataProperty(\n  //   //       \"name\",\n  //   //       name\n  //   //     );\n  //   //     if (object === undefined) {\n  //   //       return;\n  //   //     }\n  //   //     bbox.expandByObject(object);\n  //   //   });\n  //   // }\n\n  //   const x = bbox.min.x;\n  //   const y = bbox.min.y;\n  //   const w = Math.abs(bbox.max.x - bbox.min.x);\n  //   const h = Math.abs(bbox.max.y - bbox.min.y);\n\n  //   console.log(\"jaki jest bbxo?\", bbox, x, y, w, h);\n\n  //   editBBoxThree.userData.position.x = x + w / 2;\n  //   editBBoxThree.userData.position.y = y + h / 2;\n  //   editBBoxThree.position.x = x + w / 2;\n  //   editBBoxThree.position.y = y + h / 2;\n  //   // editBBoxThree.position.z = 200;\n  //   editBBoxThree.scale.x = w;\n  //   editBBoxThree.scale.y = h;\n  //   editBBoxThree.scale.z = 1;\n\n  //   // const nameTL = getThreeNameFromEditBBoxId(\n  //   //   editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n  //   // );\n  //   // const _dotTL = appThree.scene.getObjectByUserDataProperty(\"name\", nameTL);\n  //   // if (_dotTL !== undefined) {\n  //   //   _dotTL.position.x = bbox.min.x;\n  //   //   _dotTL.position.y = bbox.max.y;\n  //   //   _dotTL.scale.x = dotSize;\n  //   //   _dotTL.scale.y = dotSize;\n  //   // }\n  //   // const nameTR = getThreeNameFromEditBBoxId(\n  //   //   editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n  //   // );\n  //   // const _dotTR = appThree.scene.getObjectByUserDataProperty(\"name\", nameTR);\n  //   // if (_dotTR !== undefined) {\n  //   //   _dotTR.position.x = bbox.max.x;\n  //   //   _dotTR.position.y = bbox.max.y;\n  //   //   _dotTR.scale.x = dotSize;\n  //   //   _dotTR.scale.y = dotSize;\n  //   // }\n  //   // const nameBL = getThreeNameFromEditBBoxId(\n  //   //   editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n  //   // );\n  //   // const _dotBL = appThree.scene.getObjectByUserDataProperty(\"name\", nameBL);\n  //   // if (_dotBL !== undefined) {\n  //   //   _dotBL.position.x = bbox.min.x;\n  //   //   _dotBL.position.y = bbox.min.y;\n  //   //   _dotBL.scale.x = dotSize;\n  //   //   _dotBL.scale.y = dotSize;\n  //   // }\n  //   // const nameBR = getThreeNameFromEditBBoxId(\n  //   //   editBBox.id,\n  //   //   EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n  //   // );\n  //   // const _dotBR = appThree.scene.getObjectByUserDataProperty(\"name\", nameBR);\n  //   // if (_dotBR !== undefined) {\n  //   //   _dotBR.position.x = bbox.max.x;\n  //   //   _dotBR.position.y = bbox.min.y;\n  //   //   _dotBR.scale.x = dotSize;\n  //   //   _dotBR.scale.y = dotSize;\n  //   // }\n  // }\n};\n\nexport const triggerSelectRegion = (id: string, shouldSelect: boolean) => {\n  const name = getThreeNameFromRegionId(id);\n  const object = appThree.scene.getObjectByUserDataProperty(\"name\", name);\n\n  if (object === undefined) {\n    console.warn(\"triggerSelectRegion: object not found by name\", name);\n    return;\n  }\n\n  // if (shouldSelect === true) {\n  //   // if (appThree.additionalData.selectedBBox !== undefined) {\n  //   //   return;\n  //   // }\n  //   // console.log(\"dodaj kropki\");\n\n  //   const bbox = new THREE.Box3();\n  //   bbox.expandByObject(object);\n  //   // console.log('jaki bbox?', bbox);\n  //   const resizeGroup = getResizeDots(bbox);\n  //   resizeGroup.forEach((obj) => {\n  //     appThree.scene.attach(obj);\n  //   });\n\n  //   appThree.additionalData.selectedBBox = {\n  //     topLeft: {\n  //       x: bbox.min.x,\n  //       y: bbox.max.y,\n  //       z: 0,\n  //     },\n  //     topRight: {\n  //       x: bbox.max.x,\n  //       y: bbox.max.y,\n  //       z: 0,\n  //     },\n  //     bottomLeft: {\n  //       x: bbox.min.x,\n  //       y: bbox.min.y,\n  //       z: 0,\n  //     },\n  //     bottomRight: {\n  //       x: bbox.max.x,\n  //       y: bbox.min.y,\n  //       z: 0,\n  //     },\n  //   };\n\n  //   // object.attach(resizeGroup)\n  // } else {\n  //   // console.log(\"usun kropki\");\n  //   for (let i = appThree.scene.children.length - 1; i >= 0; i--) {\n  //     if (appThree.scene.children[i].layers.mask === 4) {\n  //       appThree.scene.remove(appThree.scene.children[i]);\n  //     }\n  //   }\n\n  //   appThree.additionalData.selectedBBox = undefined;\n  // }\n};\n\nconst getResizeDots = (id: string, bbox: THREE.Box3) => {\n  const objects: THREE.Object3D[] = [];\n  const sceneScale = appThree.camera.userData[\"sceneScale\"];\n  const dotSize = sceneScale; //(rect10x10FromScreenToWorld.w ?? 10) * 0.5;\n  const layerN = 2;\n\n  const __material = new THREE.MeshLambertMaterial({ color: \"#ffffff\" });\n  const __boxGeometry = new THREE.CircleGeometry(1, 16);\n  const _whiteDot = new THREE.Mesh(__boxGeometry, __material);\n  _whiteDot.scale.x = 10;\n  _whiteDot.scale.y = 10;\n  _whiteDot.renderOrder = 2;\n  _whiteDot.layers.set(layerN);\n\n  const ___material = new THREE.MeshLambertMaterial({ color: \"#a9a9a9\" });\n  const ___boxGeometry = new THREE.CircleGeometry(1, 16);\n  const _grayDot = new THREE.Mesh(___boxGeometry, ___material);\n  _grayDot.scale.x = 12;\n  _grayDot.scale.y = 12;\n  _grayDot.renderOrder = 1;\n  _grayDot.layers.set(layerN);\n\n  const _baseDot = new THREE.Group();\n  _baseDot.attach(_grayDot);\n  _baseDot.attach(_whiteDot);\n\n  const _dotTL = _baseDot.clone();\n  _dotTL.position.x = bbox.min.x;\n  _dotTL.position.y = bbox.max.y;\n  _dotTL.scale.x = dotSize;\n  _dotTL.scale.y = dotSize;\n  _dotTL.layers.set(layerN);\n  _dotTL.userData.name = getThreeNameFromEditBBoxId(\n    id,\n    EditBBoxChildSuffix.DOT_RESIZE_TOP_LEFT\n  );\n  objects.push(_dotTL);\n\n  const _dotTR = _baseDot.clone();\n  _dotTR.position.x = bbox.max.x;\n  _dotTR.position.y = bbox.max.y;\n  _dotTR.scale.x = dotSize;\n  _dotTR.scale.y = dotSize;\n  _dotTR.layers.set(layerN);\n  _dotTR.userData.name = getThreeNameFromEditBBoxId(\n    id,\n    EditBBoxChildSuffix.DOT_RESIZE_TOP_RIGHT\n  );\n  objects.push(_dotTR);\n\n  const _dotBL = _baseDot.clone();\n  _dotBL.position.x = bbox.min.x;\n  _dotBL.position.y = bbox.min.y;\n  _dotBL.scale.x = dotSize;\n  _dotBL.scale.y = dotSize;\n  _dotBL.layers.set(layerN);\n  _dotBL.userData.name = getThreeNameFromEditBBoxId(\n    id,\n    EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_LEFT\n  );\n  objects.push(_dotBL);\n\n  const _dotBR = _baseDot.clone();\n  _dotBR.position.x = bbox.max.x;\n  _dotBR.position.y = bbox.min.y;\n  _dotBR.scale.x = dotSize;\n  _dotBR.scale.y = dotSize;\n  _dotBR.layers.set(layerN);\n  _dotBR.userData.name = getThreeNameFromEditBBoxId(\n    id,\n    EditBBoxChildSuffix.DOT_RESIZE_BOTTOM_RIGHT\n  );\n  objects.push(_dotBR);\n  return objects;\n};\n","import { AppEvents } from \"../AppEventType\";\nimport { Store } from \"../store\";\nimport { AppHistory } from \"../AppHistory\";\nimport produce from \"immer\";\nimport { getTopBarPosition } from \"../../threejs/eventEmitterHandlers\";\nimport { getMousePositionAtWindow } from \"../../threejs/mouseListeners/mouseScreenPosition\";\nimport { appThree } from \"../../threejs/renderThreejs\";\n\nexport class BaseEventHandler<T extends AppEvents> {\n  store: Store;\n  event: T;\n  history: AppHistory;\n  saveToHistory: boolean;\n  constructor(\n    event: T,\n    store: Store,\n    history: AppHistory,\n    saveToHistory: boolean\n  ) {\n    this.store = store;\n    this.history = history;\n    this.event = event;\n    this.saveToHistory = saveToHistory;\n  }\n\n  getNewStoreWithTopBarPosition(store: Store) {\n    return produce(store, (draft) => {\n      const position = getTopBarPosition(\n        store.selectedIds.map((id) => {\n          return { id, objectType: store.objects[id].objectType };\n        })\n      );\n      draft.ui.selectedTopBarPosition = position;\n    });\n  }\n\n  getCenterPosition() {\n    const { width, height, top, left } = appThree.el.getBoundingClientRect();\n    const posX = left + width / 2;\n    const posY = top + height / 2;\n    return { posX, posY };\n  }\n\n  getMousePosition() {\n    let posX = 0;\n    let posY = 0;\n    const pos = getMousePositionAtWindow();\n    if (pos === undefined) {\n      const center = this.getCenterPosition();\n      posX = center.posX;\n      posY = center.posY;\n    } else {\n      posX = pos.x;\n      posY = pos.y;\n    }\n    return { posX, posY };\n  }\n\n  getStoreWithHistory(_store?: Store) {\n    const store = _store === undefined ? this.store : _store;\n    return produce(store, (draft) => {\n      draft.history.canRedo = this.history.canRedo();\n      draft.history.canUndo = this.history.canUndo();\n      draft.history.events = this.history.getSimpleHistoryEvents();\n    });\n  }\n}\n","import { produce } from \"immer\";\nimport * as THREE from \"three\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport {\n  AppObject,\n  Bead,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n  Region,\n} from \"../../editorObjects/Editor\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { buildPreviewProject3D } from \"../../editorObjects/PreviewProject3D\";\nimport { buildRegion } from \"../../editorObjects/Region\";\nimport {\n  getSelectBBox,\n  getTopBarPosition,\n  triggerSelectBead,\n  triggerSelectRegion,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { screenToWorld } from \"../../threejs/mouseListeners/screenToWorld\";\nimport { AppEvents } from \"../AppEventType\";\nimport { BaseEventHandler } from \"./BaseEventHandler\";\n\nexport interface IBaseEventHandler {\n  run(refreshThreejs: boolean, refreshReact: boolean): void;\n}\nexport class StoreObjectHandler<T extends AppEvents>\n  extends BaseEventHandler<T>\n  implements IBaseEventHandler {\n  run(refreshThreejs: boolean = true, refreshReact: boolean = true) {}\n\n  getAppObjectFromCloneAppObject(object: Partial<AppObject>) {\n    if (object.objectType === undefined) {\n      console.warn(\"object type not found in payload: \", object);\n      return undefined;\n    }\n    if (object.objectType === ObjectTypes.Bead) {\n      return buildBead(object);\n    }\n    if (object.objectType === ObjectTypes.Region) {\n      return buildRegion(object);\n    }\n    if (object.objectType === ObjectTypes.Group) {\n      return buildGroup(object);\n    }\n    if (object.objectType === ObjectTypes.PreviewProject3D) {\n      return buildPreviewProject3D(object);\n    }\n    console.warn(\"unknow object type from payload: \", object);\n    return undefined;\n  }\n\n  selectObjectOnThreeScene(object: AppObject, isSelected: boolean) {\n    if (object === undefined) {\n      return;\n    }\n\n    const selectBbox = getSelectBBox();\n    selectBbox.updateRect(\n      {\n        depth: object.depth,\n        height: object.height,\n        width: object.width,\n        id: object.id,\n        position: new THREE.Vector3(\n          object.position.x,\n          object.position.y,\n          object.position.z\n        ),\n        rotation: new THREE.Vector3(\n          object.rotateX,\n          object.rotateY,\n          object.rotateZ\n        ),\n      },\n      isSelected\n    );\n\n    // if (object.objectType === ObjectTypes.Bead) {\n    //   triggerSelectBead(object.id, isSelected);\n    // }\n    // if (object.objectType === ObjectTypes.Region) {\n    //   triggerSelectRegion(object.id, isSelected);\n    // }\n  }\n\n  deleteSelectedObjectsFromStore(ids: string[], objects: AppObject[]) {\n    return produce(this.store, (draft) => {\n      ids.forEach((id) => {\n        const object = this.store.objects[id];\n        if (draft.selectedIds.includes(id)) {\n          const index = draft.selectedIds.indexOf(id);\n          draft.selectedIds.splice(index, 1);\n          this.selectObjectOnThreeScene(object, false);\n        }\n\n        if (draft.objects[object.id] !== undefined) {\n          objects.push(object);\n          if (object.objectType === ObjectTypes.Region) {\n            (object as Region).childrenGridIds.forEach((_beadId) => {\n              if (_beadId !== undefined) {\n                (draft.objects[_beadId] as Bead).regionId = undefined;\n              }\n            });\n          }\n          delete draft.objects[object.id];\n        }\n      });\n\n      draft.ui.selectedTopBarPosition = getTopBarPosition(\n        draft.selectedIds.map((id) => {\n          return { id, objectType: draft.objects[id].objectType };\n        })\n      );\n    });\n  }\n\n  getPositionDiffFromMousePosition(objects: AppObject[]) {\n    const { posX, posY } = this.getMousePosition();\n    const worldPos = screenToWorld(posX, posY);\n    const bbox = new THREE.Box3();\n    objects.forEach((object) => {\n      const w = object.width / 2;\n      const h = object.height / 2;\n      const x = object.position.x;\n      const y = object.position.y;\n      bbox.expandByPoint(new THREE.Vector3().set(x - w, y - h, 0.1));\n      bbox.expandByPoint(new THREE.Vector3().set(x + w, y - h, 0.2));\n      bbox.expandByPoint(new THREE.Vector3().set(x - w, y + h, 0.1));\n      bbox.expandByPoint(new THREE.Vector3().set(x + w, y + h, 0.1));\n    });\n    const bboxCenter = new THREE.Vector3();\n    bbox.getCenter(bboxCenter);\n    const diffX = worldPos.x - bboxCenter.x;\n    const diffY = worldPos.y - bboxCenter.y;\n    return {\n      diffX,\n      diffY,\n    };\n  }\n\n  moveObjectsByDiff(objects: AppObject[], diffX: number, diffY: number) {\n    objects.forEach((object) => {\n      if (object.objectType === ObjectTypes.Group) {\n        object.position.x = object.position.x + diffX;\n        object.position.y = object.position.y + diffY;\n        objects.forEach((obj) => {\n          if ((object as Group).childrenIds.includes(obj.id)) {\n            obj.position.x = obj.position.x + diffX;\n            obj.position.y = obj.position.y + diffY;\n          }\n        });\n      } else {\n        if (object[groupIdKey] === undefined) {\n          object.position.x = object.position.x + diffX;\n          object.position.y = object.position.y + diffY;\n        }\n      }\n    });\n  }\n}\n","import produce from \"immer\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { AddObjects, AppEventType } from \"../AppEventType\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { setStore, shouldRefreshReact, shouldRefreshThree } from \"../store\";\nimport { AddObjectsHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  AppObject,\n  Bead,\n  ObjectTypes,\n  Region,\n} from \"../../editorObjects/Editor\";\nimport { buildRegion } from \"../../editorObjects/Region\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { buildPreviewProject3D } from \"../../editorObjects/PreviewProject3D\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class AddObjectHandler extends StoreObjectHandler<AddObjects> {\n  run() {\n    const objects: AppObject[] = [];\n    let newStore = produce(this.store, (draft) => {\n      this.event.payload.objects.forEach((object) => {\n        let newObject = this.getAppObjectFromCloneAppObject(object);\n        if (newObject == undefined) {\n          return;\n        }\n        if (newObject.objectType === ObjectTypes.Region) {\n          (newObject as Region).childrenGridIds.forEach((_beadId) => {\n            if (_beadId !== undefined) {\n              (draft.objects[_beadId] as Bead).regionId = newObject!.id;\n            }\n          });\n        }\n        draft.objects[newObject.id] = newObject;\n        objects.push(newObject);\n      });\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: AddObjectsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.AddObjects,\n          payload: { objects: objects },\n        },\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: { ids: objects.map((b) => b.id) },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    setStore(newStore);\n\n    if (shouldRefreshThree()) {\n      objects.forEach((obj) => {\n        addObjectByObjectType(obj);\n      });\n    }\n\n    if (shouldRefreshReact()) {\n      refreshReactState(newStore);\n    }\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { AppObject, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { AppEventType, RemoveObjects } from \"../AppEventType\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { setStore, shouldRefreshReact, shouldRefreshThree } from \"../store\";\nimport { RemoveObjectsHistory } from \"../AppHistory\";\nimport {\n  getTopBarPosition,\n  triggerDeleteObjectIds,\n  triggerSelectBead,\n  triggerSelectRegion,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class RemoveObjectHandler extends StoreObjectHandler<RemoveObjects> {\n  run() {\n    const { ids } = this.event.payload;\n    const objects: AppObject[] = [];\n    let newStore = this.deleteSelectedObjectsFromStore(ids, objects);\n\n    if (this.saveToHistory) {\n      const historyEvent: RemoveObjectsHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.AddObjects,\n          payload: { objects },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    setStore(newStore);\n\n    if (shouldRefreshThree()) {\n      triggerDeleteObjectIds(\n        objects.map((obj) => {\n          return { id: obj.id, objectType: obj.objectType };\n        })\n      );\n    }\n    \n    if (shouldRefreshReact()) {\n      refreshReactState(newStore);\n    }\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { ChangeSelectObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { appThree } from \"../../threejs/renderThreejs\";\n\nexport class ChangeSelectObjectsHandler extends StoreObjectHandler<ChangeSelectObjects> {\n  run() {\n    const { change } = this.event.payload;\n\n    const historyChange: { id: string; isSelected: boolean }[] = [];\n    let newStore = produce(this.store, (draft) => {\n      change.forEach((obj) => {\n        if (draft.objects[obj.id] === undefined) {\n          console.warn(\"no object found in store\", obj.id);\n          return;\n        }\n        if (draft.selectedIds.includes(obj.id) === true) {\n          if (obj.isSelected === true) {\n            // do nothing\n          } else {\n            draft.selectedIds.splice(draft.selectedIds.indexOf(obj.id), 1);\n          }\n        } else {\n          if (obj.isSelected === true) {\n            draft.selectedIds.push(obj.id);\n          } else {\n            // nothing\n          }\n        }\n        historyChange.push({\n          id: obj.id,\n          isSelected: obj.isSelected,\n        });\n      });\n    });\n    // setStore(newStore);\n\n    // @INFO: Remove later\n    // if (this.saveToHistory) {\n    //   const historyEvent: ChangeSelectObjectsHistory = {\n    //     do: this.event,\n    //     redo: this.event,\n    //     undo: {\n    //       name: AppEventType.ChangeSelectObjects,\n    //       payload: { change: historyChange },\n    //     },\n    //   };\n    //   this.history.push(historyEvent);\n    // }\n    // appThree.additionalData.selectedBBox = undefined;\n\n    historyChange.forEach((change) => {\n      const object = newStore.objects[change.id];\n      if (object === undefined) {\n        return;\n      }\n      this.selectObjectOnThreeScene(object, change.isSelected);\n    });\n    // refreshReactState(newStore);\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport {\n  addObjectByObjectType,\n  triggerDeleteObjectIds,\n  updateObjectPosition,\n} from \"../../threejs/eventEmitterHandlers\";\nimport {\n  ChangeObjectsProperty,\n  AppEventType,\n  ChangeObject,\n} from \"../AppEventType\";\nimport { ChangeObjectsPropertyHistory } from \"../AppHistory\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport {\n  setStore,\n  shouldRefreshReact,\n  shouldRefreshThree,\n  Store,\n} from \"../store\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport {\n  AppObject,\n  Bead,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n  Point,\n  Region,\n  RegionGridType,\n  RegionShape,\n} from \"../../editorObjects/Editor\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\nimport { WritableDraft } from \"immer/dist/internal\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { contain } from \"../../editorObjects/Point\";\nimport { isActiveRegionCell } from \"../../editorObjects/Region\";\nimport { logger } from \"../../logger\";\n\ntype ObjectsMap = { [key: string]: AppObject };\n\nexport class ChangeObjectsPropertyHandler extends StoreObjectHandler<ChangeObjectsProperty> {\n  run() {\n    const added: AppObject[] = [];\n    const updated: ObjectsMap = {};\n    const removed: AppObject[] = [];\n    const { changes } = this.event.payload;\n    const historyChanges: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n    let newStore = produce(this.store, (draft) => {\n      changes.forEach((_singleChange) => {\n        if (draft.objects[_singleChange.id] === undefined) {\n          logger.warn(\"no object found in store\", _singleChange.id);\n          return;\n        }\n        const singleHistoryChange: ChangeObject = {\n          id: _singleChange.id,\n          properties: {},\n          relatedChanges: [],\n          shouldBeCreated: [],\n          shouldBeDeleted: [],\n        };\n        const keyNames = Object.keys(_singleChange.properties);\n        if (singleHistoryChange !== undefined) {\n          keyNames.forEach((key) => {\n            singleHistoryChange.properties[key] = cloneDeep(\n              draft.objects[_singleChange.id][key]\n            );\n          });\n        }\n        keyNames.forEach((key) => {\n          draft.objects[_singleChange.id][key] = cloneDeep(\n            _singleChange.properties[key]\n          );\n        });\n\n        if (_singleChange.relatedChanges) {\n          _singleChange.relatedChanges.forEach((_singeRelatedChange) => {\n            if (draft.objects[_singeRelatedChange.id] === undefined) {\n              logger.warn(\"no object found in store\", _singeRelatedChange.id);\n              return;\n            }\n            const keyNames = Object.keys(_singeRelatedChange.properties);\n            keyNames.forEach((key) => {\n              draft.objects[_singeRelatedChange.id][key] = cloneDeep(\n                _singeRelatedChange.properties[key]\n              );\n            });\n          });\n        }\n\n        historyChanges.push(singleHistoryChange);\n      });\n\n      changes.forEach((_singleChange, index) => {\n        if (draft.objects[_singleChange.id] === undefined) {\n          logger.warn(\"no object found in store\", _singleChange.id);\n          return;\n        }\n        const objectType = draft.objects[_singleChange.id].objectType;\n        const singleHistoryChange = historyChanges[index];\n\n        if (objectType === ObjectTypes.Bead) {\n          this.whenBead(\n            _singleChange,\n            draft,\n            singleHistoryChange,\n            added,\n            updated,\n            removed\n          );\n        }\n\n        if (objectType === ObjectTypes.Region) {\n          this.whenRegion(\n            _singleChange,\n            draft,\n            singleHistoryChange,\n            added,\n            updated,\n            removed\n          );\n        }\n      });\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: ChangeObjectsPropertyHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.ChangeObjectsProperty,\n          payload: {\n            changes: this.event.payload.changes.map(\n              ({ id, properties, relatedChanges }) => {\n                const index = historyChanges.findIndex((e) => e.id === id);\n                const exists = index !== -1;\n                const shouldBeCreated = exists\n                  ? historyChanges[index].shouldBeDeleted\n                  : [];\n                const shouldBeDeleted = exists\n                  ? historyChanges[index].shouldBeCreated\n                  : [];\n\n                return {\n                  id,\n                  properties,\n                  relatedChanges,\n                  shouldBeCreated,\n                  shouldBeDeleted,\n                };\n              }\n            ),\n          },\n        },\n        undo: {\n          name: AppEventType.ChangeObjectsProperty,\n          payload: { changes: historyChanges },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n\n    newStore = this.getStoreWithHistory(newStore);\n\n    if (shouldRefreshThree()) {\n      // @INFO: CHANGES IN THREEJS\n      changes.forEach((_singleChange) => {\n        this.applyChangesToThree(_singleChange, newStore);\n        notifyBackend([\n          {\n            action: SaveEventType.UPDATE,\n            createdAt: new Date().toISOString(),\n            object: newStore.objects[_singleChange.id],\n          },\n        ]);\n\n        if (_singleChange.relatedChanges) {\n          _singleChange.relatedChanges.forEach((_singeRelatedChange) => {\n            this.applyChangesToThree(_singeRelatedChange, newStore);\n            notifyBackend([\n              {\n                action: SaveEventType.UPDATE,\n                createdAt: new Date().toISOString(),\n                object: newStore.objects[_singeRelatedChange.id],\n              },\n            ]);\n          });\n        }\n      });\n    }\n\n    if (shouldRefreshThree()) {\n      if (added.length > 0) {\n        added.forEach((obj) => {\n          addObjectByObjectType(obj);\n        });\n\n        notifyBackend(\n          added.map((object) => {\n            return {\n              action: SaveEventType.CREATE,\n              createdAt: new Date().toISOString(),\n              object,\n            };\n          })\n        );\n      }\n\n      const updatedKeys = Object.keys(updated);\n      if (updatedKeys.length > 0) {\n        triggerDeleteObjectIds(\n          updatedKeys.map((id) => {\n            return {\n              id,\n              objectType: newStore.objects[id].objectType,\n            };\n          })\n        );\n\n        updatedKeys.map((id) => {\n          addObjectByObjectType(newStore.objects[id]);\n        });\n\n        notifyBackend(\n          updatedKeys.map((id) => {\n            return {\n              action: SaveEventType.UPDATE,\n              createdAt: new Date().toISOString(),\n              object: newStore.objects[id],\n            };\n          })\n        );\n      }\n\n      if (removed.length > 0) {\n        triggerDeleteObjectIds(\n          removed.map((obj) => {\n            return { id: obj.id, objectType: obj.objectType };\n          })\n        );\n        notifyBackend(\n          removed.map((object) => {\n            return {\n              action: SaveEventType.DELETE,\n              createdAt: new Date().toISOString(),\n              object,\n            };\n          })\n        );\n      }\n    }\n\n    if (shouldRefreshThree()) {\n      newStore = this.getNewStoreWithTopBarPosition(newStore);\n    }\n\n    setStore(newStore);\n\n    if (shouldRefreshReact()) {\n      refreshReactState(newStore);\n    }\n  }\n\n  applyChangesToThree(_singleChange: ChangeObject, _store: Store) {\n    if (_store.objects[_singleChange.id] === undefined) {\n      logger.warn(\"no object found in store\", _singleChange.id);\n      return;\n    }\n    const object = _store.objects[_singleChange.id];\n    const inGroup =\n      object[groupIdKey] !== undefined && object[groupIdKey].length > 0;\n\n    const positionKey: keyof AppObject = \"position\";\n    // const objectType = _store.objects[_singleChange.id].objectType;\n    const keyNames = Object.keys(_singleChange.properties);\n    const isPositionOnly =\n      keyNames.length === 1 && keyNames.includes(positionKey) === true;\n    if (isPositionOnly && inGroup === false) {\n      updateObjectPosition(\n        _singleChange.id,\n        object.objectType,\n        object.position.x,\n        object.position.y\n      );\n    }\n    // else if (objectType === ObjectTypes.Region) {\n    // const isShapeOnly =\n    // keyNames.length === 1 && keyNames.includes(\"shape\") === true;\n    // }\n    else {\n      triggerDeleteObjectIds([\n        {\n          id: _singleChange.id,\n          objectType: object.objectType,\n        },\n      ]);\n\n      addObjectByObjectType(object);\n\n      if (inGroup) {\n        if (\n          object[groupIdKey] !== undefined &&\n          _store.objects[object[groupIdKey]]\n        ) {\n          (_store.objects[object[groupIdKey]] as Group).childrenIds.forEach(\n            (id) => {\n              const obj = _store.objects[id];\n              triggerDeleteObjectIds([\n                {\n                  id: id,\n                  objectType: obj.objectType,\n                },\n              ]);\n              addObjectByObjectType(obj);\n            }\n          );\n        }\n      }\n    }\n  }\n\n  whenBead(\n    _singleChange: ChangeObject,\n    draft: WritableDraft<Store>,\n    singleHistoryChange: ChangeObject,\n    added: AppObject[],\n    updated: ObjectsMap,\n    removed: AppObject[]\n  ) {\n    const positionKey: keyof AppObject = \"position\";\n    const regionIdKey: keyof Bead = \"regionId\";\n    const childrenGridIdsKey: keyof Region = \"childrenGridIds\";\n    const keyNames = Object.keys(_singleChange.properties);\n\n    if (keyNames.includes(positionKey)) {\n      let isBeadFoundRegion = false;\n      const bead = draft.objects[_singleChange.id] as Bead;\n      const regionId = (draft.objects[_singleChange.id] as Bead).regionId;\n\n      if (regionId !== undefined) {\n        const region = draft.objects[regionId] as Region;\n        if (this.isRegionContainBead(region, bead) === true) {\n          const { column, row, index: newIndex } = this.getRegionCellIndex(\n            bead.position.x,\n            bead.position.y,\n            region\n          );\n          // if (column < 0) {\n          //   console.warn(\"whenBead :: column < 0\", column, row, bead.id);\n          // }\n          const isActiveCell = isActiveRegionCell(region, newIndex);\n          if (isActiveCell === true) {\n            const oldIndex = region.childrenGridIds.indexOf(bead.id);\n            if (oldIndex !== -1 && oldIndex !== newIndex) {\n              draft.objects[regionId][childrenGridIdsKey][oldIndex] = undefined;\n            }\n            if (\n              draft.objects[regionId][childrenGridIdsKey][newIndex] !==\n              undefined\n            ) {\n              draft.objects[regionId][childrenGridIdsKey][newIndex] = bead.id;\n              isBeadFoundRegion = true;\n              if (region.snapBeadsToCell === true) {\n                const position = this.getRegionCellCenter(region, row, column);\n                draft.objects[bead.id].position.x = position.x;\n                draft.objects[bead.id].position.y = position.y;\n              }\n            }\n          }\n        }\n      }\n\n      if (isBeadFoundRegion === false) {\n        Object.keys(draft.objects).forEach((regionId) => {\n          if (draft.objects[regionId].objectType !== ObjectTypes.Region) {\n            return;\n          }\n          const region = draft.objects[regionId] as Region;\n\n          if (this.isRegionContainBead(region, bead) === false) {\n            return;\n          }\n          const { column, row, index: newIndex } = this.getRegionCellIndex(\n            bead.position.x,\n            bead.position.y,\n            region\n          );\n\n          // if (column < 0) {\n          //   console.warn(\"whenBead :: column < 0\", column, row, bead.id);\n          // }\n          const isActiveCell = isActiveRegionCell(region, newIndex);\n          if (isActiveCell === true) {\n            if (region.childrenGridIds[newIndex] === undefined) {\n              const currentIndex = region.childrenGridIds.indexOf(bead.id);\n              if (currentIndex !== -1 && currentIndex !== newIndex) {\n                draft.objects[regionId][childrenGridIdsKey][\n                  currentIndex\n                ] = undefined;\n              }\n              draft.objects[regionId][childrenGridIdsKey][newIndex] = bead.id;\n\n              updated[regionId] = cloneDeep(draft.objects[regionId]);\n\n              if (draft.objects[bead.id][regionIdKey] !== undefined) {\n                const oldRegionId = draft.objects[bead.id][regionIdKey];\n                const oldRegion = draft.objects[oldRegionId] as Region;\n                const currentIndex = oldRegion.childrenGridIds.indexOf(bead.id);\n                if (currentIndex !== -1) {\n                  draft.objects[oldRegionId][childrenGridIdsKey][\n                    currentIndex\n                  ] = undefined;\n                  updated[oldRegionId] = cloneDeep(draft.objects[oldRegionId]);\n                }\n              }\n\n              draft.objects[bead.id][regionIdKey] = region.id;\n              isBeadFoundRegion = true;\n\n              if (region.snapBeadsToCell === true) {\n                const position = this.getRegionCellCenter(region, row, column);\n                draft.objects[bead.id].position.x = position.x;\n                draft.objects[bead.id].position.y = position.y;\n              }\n            } else if (region.childrenGridIds[newIndex] === bead.id) {\n              if (region.snapBeadsToCell === true) {\n                const position = this.getRegionCellCenter(region, row, column);\n                draft.objects[bead.id].position.x = position.x;\n                draft.objects[bead.id].position.y = position.y;\n                isBeadFoundRegion = true;\n              }\n            }\n          }\n        });\n      }\n\n      if (isBeadFoundRegion === false) {\n        if (regionId !== undefined) {\n          const region = draft.objects[regionId] as Region;\n          const currentIndex = region.childrenGridIds.indexOf(bead.id);\n          if (currentIndex !== -1) {\n            draft.objects[regionId][childrenGridIdsKey][\n              currentIndex\n            ] = undefined;\n\n            updated[regionId] = cloneDeep(draft.objects[regionId]);\n          }\n\n          (draft.objects[_singleChange.id] as Bead).regionId = undefined;\n        }\n      }\n    }\n  }\n\n  whenRegion(\n    _singleChange: ChangeObject,\n    draft: WritableDraft<Store>,\n    singleHistoryChange: ChangeObject,\n    added: AppObject[],\n    updated: ObjectsMap,\n    removed: AppObject[]\n  ) {\n    const keyNames = Object.keys(_singleChange.properties);\n    const shapeKey: keyof Region = \"shape\";\n    const gridTypeKey: keyof Region = \"gridType\";\n    const autoFillBeadsKey: keyof Region = \"autoFillBeads\";\n    const snapBeadsToCellKey: keyof Region = \"snapBeadsToCell\";\n    const rowsKey: keyof Region = \"rows\";\n    const columnsKey: keyof Region = \"columns\";\n    const positionKey: keyof Region = \"position\";\n\n    const { shouldBeDeleted } = _singleChange;\n\n    if (shouldBeDeleted !== undefined && shouldBeDeleted.length > 0) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const tempIds: string[] = [];\n\n      shouldBeDeleted.forEach((bead) => {\n        if (draft.objects[bead.id] === undefined) {\n          logger.warn(\"whenRegion:: bead not found\", bead.id);\n          return;\n        }\n\n        tempIds.push(bead.id);\n        removed.push(cloneDeep(bead));\n        delete draft.objects[bead.id];\n      });\n\n      region.childrenGridIds.forEach((id, index) => {\n        if (id !== undefined && tempIds.includes(id)) {\n          (draft.objects[region.id] as Region).childrenGridIds[\n            index\n          ] = undefined;\n        }\n      });\n    }\n\n    if (\n      keyNames.includes(rowsKey) ||\n      keyNames.includes(columnsKey) ||\n      keyNames.includes(shapeKey) ||\n      keyNames.includes(gridTypeKey)\n    ) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const oldRows = singleHistoryChange.properties[rowsKey];\n      const oldColumns = singleHistoryChange.properties[columnsKey];\n      const oldShape = singleHistoryChange.properties[shapeKey];\n      const oldGridType = singleHistoryChange.properties[gridTypeKey];\n      const autoFillBeadsEnabled = region[autoFillBeadsKey] === true;\n      if (oldRows === undefined || oldColumns === undefined) {\n        logger.warn(\"missing keys: rowsKey && columnsKey\");\n        (draft.objects[region.id] as Region).childrenGridIds.forEach(\n          (beadId) => {\n            if (beadId === undefined) {\n              return;\n            }\n            const bead = draft.objects[beadId] as Bead;\n            if (bead === undefined) {\n              logger.warn(\"toDeleteBeadIds:: bead not found\", beadId);\n              return;\n            }\n\n            singleHistoryChange.shouldBeCreated!.push(cloneDeep(bead));\n            removed.push(cloneDeep(bead));\n            delete draft.objects[beadId];\n          }\n        );\n        const newSize = region.rows * region.columns;\n        (draft.objects[region.id] as Region).childrenGridIds = Array(\n          newSize\n        ).fill(undefined);\n      } else if (\n        oldShape !== region.shape ||\n        oldRows !== region.rows ||\n        oldColumns !== region.columns ||\n        oldGridType !== region.gridType\n      ) {\n        const {\n          toDeleteBeadIds,\n          newChildrenGridIds,\n        } = this.getRegionChildrenGridIdsAfterResize(\n          region,\n          autoFillBeadsEnabled,\n          oldRows,\n          oldColumns\n        );\n\n        toDeleteBeadIds.forEach((beadId) => {\n          const bead = draft.objects[beadId] as Bead;\n          if (bead === undefined) {\n            logger.warn(\"toDeleteBeadIds:: bead not found\", beadId);\n            return;\n          }\n\n          singleHistoryChange.shouldBeCreated!.push(cloneDeep(bead));\n          removed.push(cloneDeep(bead));\n          delete draft.objects[beadId];\n        });\n\n        (draft.objects[region.id] as Region).childrenGridIds = cloneDeep(\n          newChildrenGridIds\n        );\n      }\n    }\n\n    if (\n      keyNames.includes(positionKey) ||\n      keyNames.includes(snapBeadsToCellKey)\n    ) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const snapBeadsToCellEnabled = region[snapBeadsToCellKey] === true;\n      if (snapBeadsToCellEnabled) {\n        region.childrenGridIds.forEach((id, index) => {\n          if (id !== undefined) {\n            const bead = draft.objects[id] as Bead;\n            if (bead !== undefined) {\n              const oldPosition = cloneDeep(bead.position);\n              const { row, column } = this.getRegionCellIndex(\n                bead.position.x,\n                bead.position.y,\n                region\n              );\n              const { x, y } = this.getRegionCellCenter(region, row, column);\n              draft.objects[id].position.x = x;\n              draft.objects[id].position.y = y;\n              updated[id] = cloneDeep(draft.objects[id]);\n              singleHistoryChange.relatedChanges?.push({\n                id,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                },\n              });\n            }\n          } else {\n            const region = draft.objects[_singleChange.id] as Region;\n            let foundObject = false;\n            Object.keys(draft.objects).forEach((id) => {\n              if (foundObject === true) {\n                return;\n              }\n              if (draft.objects[id].objectType !== ObjectTypes.Bead) {\n                return;\n              }\n\n              const bead = draft.objects[id] as Bead;\n\n              if (bead.groupId !== undefined) {\n                return;\n              }\n\n              if (bead.regionId !== undefined) {\n                return;\n              }\n\n              const isActiveCell = isActiveRegionCell(region, index);\n              if (isActiveCell === false) {\n                return;\n              }\n\n              if (this.isRegionCellContainBead(region, bead, index) === false) {\n                return;\n              }\n\n              const oldPosition = cloneDeep(bead.position);\n              const { row, column } = this.getRegionCellIndex(\n                bead.position.x,\n                bead.position.y,\n                region\n              );\n              const { x, y } = this.getRegionCellCenter(region, row, column);\n\n              (draft.objects[_singleChange.id] as Region).childrenGridIds[\n                index\n              ] = bead.id;\n\n              (draft.objects[bead.id] as Bead).regionId = region.id;\n\n              draft.objects[bead.id].position.x = x;\n              draft.objects[bead.id].position.y = y;\n\n              singleHistoryChange.relatedChanges?.push({\n                id: bead.id,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                  regionId: undefined,\n                },\n              });\n\n              updated[bead.id] = cloneDeep(draft.objects[bead.id]);\n              foundObject = true;\n            });\n          }\n        });\n      } else {\n        const region = draft.objects[_singleChange.id] as Region;\n        const size = region.rows * region.columns;\n        const newChildrenGridIds = Array(size).fill(undefined);\n\n        let emptyCellsCount = size;\n        const keys = Object.keys(draft.objects);\n        for (let i = 0; i < keys.length; i++) {\n          if (emptyCellsCount <= 0) {\n            break;\n          }\n\n          const id = keys[i];\n\n          if (draft.objects[id].objectType !== ObjectTypes.Bead) {\n            continue;\n          }\n\n          const bead = draft.objects[id] as Bead;\n\n          if (bead.groupId !== undefined) {\n            continue;\n          }\n\n          if (this.isRegionContainBead(region, bead) === false) {\n            continue;\n          }\n\n          const { index } = this.getRegionCellIndex(\n            bead.position.x,\n            bead.position.y,\n            region\n          );\n\n          if (index >= 0 && newChildrenGridIds[index] === undefined) {\n            newChildrenGridIds[index] = bead.id;\n            emptyCellsCount = emptyCellsCount - 1;\n          }\n        }\n\n        // obecne beadsy na regionie... ktory bead wypad z regionu?\n        (draft.objects[_singleChange.id] as Region).childrenGridIds.forEach(\n          (beadId) => {\n            if (beadId !== undefined && draft.objects[beadId] !== undefined) {\n              if (newChildrenGridIds.includes(beadId) === false) {\n                singleHistoryChange.relatedChanges?.push({\n                  id: beadId,\n                  properties: {\n                    regionId: (draft.objects[beadId] as Bead).regionId,\n                  },\n                });\n              }\n\n              (draft.objects[beadId] as Bead).regionId = undefined;\n\n              updated[beadId] = cloneDeep(draft.objects[beadId]);\n            }\n          }\n        );\n\n        // tworzymy relacje bead->region dla nowo wybranych beads\n        newChildrenGridIds.forEach((beadId) => {\n          if (beadId !== undefined) {\n            if ((draft.objects[beadId] as Bead).regionId === undefined) {\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  regionId: undefined,\n                },\n              });\n            } else {\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  regionId: (draft.objects[beadId] as Bead).regionId,\n                },\n              });\n            }\n            (draft.objects[beadId] as Bead).regionId = region.id;\n\n            updated[beadId] = cloneDeep(draft.objects[beadId]);\n          }\n        });\n\n        (draft.objects[_singleChange.id] as Region).childrenGridIds = cloneDeep(\n          newChildrenGridIds\n        );\n      }\n    }\n\n    if (\n      keyNames.includes(autoFillBeadsKey) ||\n      keyNames.includes(rowsKey) ||\n      keyNames.includes(columnsKey) ||\n      keyNames.includes(positionKey) ||\n      keyNames.includes(gridTypeKey)\n    ) {\n      const region = draft.objects[_singleChange.id] as Region;\n      const autoFillBeadsEnabled = region[autoFillBeadsKey] === true;\n      const snapBeadsToCellEnabled = region[snapBeadsToCellKey] === true;\n      const size = region.rows * region.columns;\n      if (region.childrenGridIds.length !== size) {\n        logger.warn(\n          \"region childrenIds size have not correct value\",\n          size,\n          region.childrenGridIds.length,\n          region.childrenGridIds\n        );\n        return;\n      }\n\n      if (autoFillBeadsEnabled) {\n        let nextIdIndexFromCreated = { value: 0 };\n        let nextIdIndexFromDeleted = 0;\n        region.childrenGridIds.forEach((beadId, index) => {\n          // @TODO: obecnie nie jest uwzgledniony rotate dla regionu.\n\n          const isActiveCell = isActiveRegionCell(region, index);\n\n          if (isActiveCell === false) {\n            return;\n          }\n\n          if (beadId === undefined) {\n            const { x, y } = this.getRegionCellCenterFromCellIndex(\n              region,\n              index\n            );\n            const id = this.getIdFromUndoOrRedo(\n              _singleChange,\n              nextIdIndexFromCreated,\n              nextIdIndexFromDeleted\n            );\n            const bead = buildBead({\n              id: id,\n              color: \"red\",\n              regionId: region.id,\n            });\n            bead.position.x = x;\n            bead.position.y = y;\n            draft.objects[bead.id] = bead;\n            (draft.objects[region.id] as Region).childrenGridIds[index] =\n              bead.id;\n            added.push(cloneDeep(bead));\n            singleHistoryChange.shouldBeDeleted!.push(cloneDeep(bead));\n          } else {\n            const bead = draft.objects[beadId] as Bead;\n            if (bead !== undefined) {\n              const oldPosition = cloneDeep(bead.position);\n              const { x, y } = this.getRegionCellCenterFromCellIndex(\n                region,\n                index\n              );\n              draft.objects[beadId].position.x = x;\n              draft.objects[beadId].position.y = y;\n              updated[beadId] = cloneDeep(draft.objects[beadId]);\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                },\n              });\n            }\n          }\n        });\n      } else {\n        if (snapBeadsToCellEnabled) {\n          region.childrenGridIds.forEach((beadId, index) => {\n            const isActiveCell = isActiveRegionCell(region, index);\n\n            if (isActiveCell === false) {\n              return;\n            }\n\n            if (beadId !== undefined) {\n              const bead = draft.objects[beadId] as Bead;\n              const oldPosition = cloneDeep(bead.position);\n              const { x, y } = this.getRegionCellCenterFromCellIndex(\n                region,\n                index\n              );\n\n              draft.objects[beadId].position.x = x;\n              draft.objects[beadId].position.y = y;\n\n              updated[beadId] = cloneDeep(draft.objects[beadId]);\n\n              singleHistoryChange.relatedChanges?.push({\n                id: beadId,\n                properties: {\n                  position: {\n                    x: oldPosition.x,\n                    y: oldPosition.y,\n                    z: oldPosition.z,\n                  },\n                },\n              });\n            } else {\n              const region = draft.objects[_singleChange.id] as Region;\n\n              let foundObject = false;\n              Object.keys(draft.objects).forEach((id) => {\n                if (foundObject === true) {\n                  return;\n                }\n                if (draft.objects[id].objectType !== ObjectTypes.Bead) {\n                  return;\n                }\n\n                const bead = draft.objects[id] as Bead;\n\n                if (bead.groupId !== undefined) {\n                  return;\n                }\n\n                if (bead.regionId !== undefined) {\n                  return;\n                }\n\n                if (\n                  this.isRegionCellContainBead(region, bead, index) === false\n                ) {\n                  return;\n                }\n                const { x, y } = this.getRegionCellCenterFromCellIndex(\n                  region,\n                  index\n                );\n\n                (draft.objects[_singleChange.id] as Region).childrenGridIds[\n                  index\n                ] = bead.id;\n\n                (draft.objects[bead.id] as Bead).regionId = region.id;\n\n                const oldPosition = cloneDeep(bead.position);\n\n                draft.objects[bead.id].position.x = x;\n                draft.objects[bead.id].position.y = y;\n\n                singleHistoryChange.relatedChanges?.push({\n                  id: bead.id,\n                  properties: {\n                    position: {\n                      x: oldPosition.x,\n                      y: oldPosition.y,\n                      z: oldPosition.z,\n                    },\n                    regionId: undefined,\n                  },\n                });\n\n                updated[bead.id] = cloneDeep(draft.objects[bead.id]);\n                foundObject = true;\n              });\n            }\n          });\n        }\n      }\n    }\n  }\n\n  getIdFromUndoOrRedo(\n    _singleChange: ChangeObject,\n    nextIdIndexFromCreated: { value: number },\n    nextIdIndexFromDeleted: number\n  ) {\n    let id: string | undefined = undefined;\n\n    const { shouldBeCreated } = _singleChange;\n\n    if (\n      shouldBeCreated !== undefined &&\n      shouldBeCreated[nextIdIndexFromCreated.value]?.id !== undefined\n    ) {\n      id = shouldBeCreated[nextIdIndexFromCreated.value]?.id ?? undefined;\n      nextIdIndexFromCreated.value = nextIdIndexFromCreated.value + 1;\n    }\n    return id;\n  }\n\n  getRegionChildrenGridIdsAfterResize(\n    region: Region,\n    autoFillBeadsEnabled: boolean,\n    oldRows: number,\n    oldColumns: number\n  ): { toDeleteBeadIds: any; newChildrenGridIds: any } {\n    let newChildrenGridIds: (string | undefined)[] = [];\n    let toDeleteBeadIds: string[] = [];\n\n    if (region.shape === RegionShape.Rectangle) {\n      const newRows = region.rows;\n      const newColumns = region.columns;\n      const newSize = region.rows * region.columns;\n\n      newChildrenGridIds = Array(newSize).fill(undefined);\n      toDeleteBeadIds = [];\n\n      for (let i = 0; i < region.childrenGridIds.length; i++) {\n        const oldIndex = i;\n        const oldCurrentRow = Math.floor(i / oldColumns);\n        const oldCurrentCol = Math.floor(i % oldColumns);\n\n        let newIndex: number = oldCurrentCol + oldCurrentRow * newColumns;\n        const newIndexIsActive = isActiveRegionCell(region, newIndex);\n\n        if (\n          newIndexIsActive === false ||\n          oldCurrentCol >= newColumns ||\n          oldCurrentRow >= newRows\n        ) {\n          newIndex = newSize;\n\n          if (autoFillBeadsEnabled) {\n            const beadId = region.childrenGridIds[oldIndex];\n            if (beadId !== undefined) {\n              if (toDeleteBeadIds.includes(beadId) === false) {\n                toDeleteBeadIds.push(beadId);\n              }\n            }\n          }\n        }\n\n        if (newIndex < newSize && newIndexIsActive === true) {\n          newChildrenGridIds[newIndex] = region.childrenGridIds[oldIndex];\n        }\n      }\n    } else if (region.shape === RegionShape.Triangle) {\n      const newColumns = region.columns;\n      const newSize = region.rows * region.columns;\n\n      newChildrenGridIds = Array(newSize).fill(undefined);\n      toDeleteBeadIds = [];\n\n      for (let i = 0; i < region.childrenGridIds.length; i++) {\n        const oldCurrentRow = Math.floor(i / oldColumns);\n        const oldCurrentCol = Math.floor(i % oldColumns);\n        const oldMiddle = oldColumns / 2;\n        const newMiddle = newColumns / 2;\n        const diffMiddle =\n          newMiddle - oldMiddle < 0\n            ? Math.ceil(newMiddle - oldMiddle)\n            : Math.floor(newMiddle - oldMiddle);\n\n        const newColumn = oldCurrentCol + diffMiddle;\n        const newRow = oldCurrentRow;\n        const newIndex = newRow * newColumns + newColumn;\n        const oldIndex = i;\n\n        const newIndexInTriangle =\n          isActiveRegionCell(region, newIndex) &&\n          newColumn >= 0 &&\n          newColumn < newColumns &&\n          newRow < region.rows;\n\n        if (newIndexInTriangle === false) {\n          if (autoFillBeadsEnabled) {\n            const beadId = region.childrenGridIds[oldIndex];\n            if (beadId !== undefined) {\n              if (toDeleteBeadIds.includes(beadId) === false) {\n                toDeleteBeadIds.push(beadId);\n              }\n            }\n          }\n        } else {\n          if (newChildrenGridIds[newIndex] === undefined) {\n            newChildrenGridIds[newIndex] = region.childrenGridIds[oldIndex];\n          } else {\n            if (autoFillBeadsEnabled) {\n              if (\n                toDeleteBeadIds.includes(region.childrenGridIds[oldIndex]!) ===\n                false\n              ) {\n                toDeleteBeadIds.push(region.childrenGridIds[oldIndex]!);\n              }\n            }\n          }\n        }\n      }\n    } else {\n      logger.error(\"region shape not handled\", region.shape);\n    }\n\n    return {\n      toDeleteBeadIds,\n      newChildrenGridIds,\n    };\n  }\n\n  isRegionContainBead(region: Region, bead: Bead) {\n    const regionTopLeftX = region.position.x - region.width / 2;\n    const regionTopLeftY = region.position.y - region.height / 2;\n\n    const containBead = contain(\n      {\n        x: regionTopLeftX,\n        y: regionTopLeftY,\n        z: 0,\n      },\n      {\n        x: region.position.x + region.width / 2,\n        y: region.position.y + region.height / 2,\n        z: 0,\n      },\n      {\n        x: bead.position.x,\n        y: bead.position.y,\n        z: 0,\n      }\n    );\n\n    return containBead;\n  }\n\n  isRegionCellContainBead(region: Region, bead: Bead, cellIndex: number) {\n    const currentRow = Math.floor(cellIndex / region.columns);\n    const currentCol = Math.floor(cellIndex % region.columns);\n    const cellW = region.width / region.columns;\n    const cellH = region.height / region.rows;\n    const regionTopLeftX = region.position.x - region.width / 2;\n    const regionTopLeftY = region.position.y - region.height / 2;\n\n    const offsetEnabled = region.gridType === RegionGridType.Bricks;\n    const _offsetX = offsetEnabled ? (currentRow % 2 === 0 ? 0 : cellW / 2) : 0;\n\n    const containBead = contain(\n      {\n        x: regionTopLeftX + currentCol * cellW + _offsetX,\n        y: regionTopLeftY + currentRow * cellH,\n        z: 0,\n      },\n      {\n        x: regionTopLeftX + currentCol * cellW + cellW + _offsetX,\n        y: regionTopLeftY + currentRow * cellH + cellH,\n        z: 0,\n      },\n      {\n        x: bead.position.x,\n        y: bead.position.y,\n        z: 0,\n      }\n    );\n\n    return containBead;\n  }\n\n  getRegionCellCenterFromCellIndex(region: Region, cellIndex: number) {\n    const currentRow = Math.floor(cellIndex / region.columns);\n    const currentCol = Math.floor(cellIndex % region.columns);\n    return this.getRegionCellCenter(region, currentRow, currentCol);\n  }\n\n  getRegionCellCenter(region: Region, rowIndex: number, columnIndex: number) {\n    const cellW = region.width / region.columns;\n    const cellH = region.height / region.rows;\n    const offsetEnabled = region.gridType === RegionGridType.Bricks;\n    const _offsetX = offsetEnabled ? (rowIndex % 2 === 0 ? 0 : cellW / 2) : 0;\n    const offsetX = columnIndex * cellW + _offsetX;\n    const offsetY = rowIndex * cellH;\n    const startX = region.position.x - region.width / 2;\n    const startY = region.position.y - region.height / 2;\n    const posX = startX + offsetX + cellW / 2;\n    const posY = startY + offsetY + cellH / 2;\n    const position: Point = {\n      x: posX,\n      y: posY,\n      z: 0,\n    };\n    return position;\n  }\n\n  getRegionCellIndex(x: number, y: number, region: Region) {\n    const regionTopLeftX = region.position.x - region.width / 2;\n    const regionTopLeftY = region.position.y - region.height / 2;\n    const cellW = region.width / region.columns;\n    const cellH = region.height / region.rows;\n    const row = Math.floor((y - regionTopLeftY) / cellH);\n    const offsetEnabled = region.gridType === RegionGridType.Bricks;\n    const _offsetX = offsetEnabled ? (row % 2 === 0 ? 0 : cellW / 2) : 0;\n    const distX = x - regionTopLeftX - _offsetX;\n    const column = Math.floor(distX / cellW);\n    const index = column < 0 ? -1 : row * region.columns + column;\n    return { index, row, column };\n  }\n}\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport { ChangeUiSettings } from \"../AppEventType\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\n\nexport class ChangeUiSettingsHandler extends BaseEventHandler<ChangeUiSettings> {\n  run() {\n    const { uiSettings } = this.event.payload;\n    let newStore = produce(this.store, (draft) => {\n      Object.keys(uiSettings).forEach((keyName) => {\n        draft.ui[keyName] = cloneDeep(uiSettings[keyName]);\n      });\n    });\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import { cloneDeep } from \"lodash\";\nimport * as THREE from \"three\";\nimport {\n  AddObjects,\n  AppEventType,\n  ChangeSelectObjects,\n  ClipboardCopy,\n  ClipboardCut,\n  ClipboardPaste,\n  RemoveObjects,\n} from \"../controllers/AppEventType\";\nimport { getStore } from \"../controllers/store\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { AppObject, Group, ObjectTypes } from \"../editorObjects/Editor\";\n\nexport interface ClipboardContent {\n  objects: AppObject[];\n}\nlet clipboardContent: ClipboardContent | undefined = undefined;\n\nexport const setClipboardBoardContent = (\n  content: ClipboardContent | undefined\n) => {\n  clipboardContent = content;\n};\n\nexport const getClipboardBoardContent = () => {\n  return clipboardContent;\n};\n\nexport const clipboardCopy = () => {\n  const event: ClipboardCopy = {\n    name: AppEventType.ClipboardCopy,\n    payload: {},\n  };\n  sendEvent(event);\n};\n\nexport const clipboardCut = () => {\n  const event: ClipboardCut = {\n    name: AppEventType.ClipboardCut,\n    payload: {},\n  };\n  sendEvent(event);\n};\n\nexport const clipboardPaste = () => {\n  if (clipboardContent === undefined) {\n    return;\n  }\n  const event: ClipboardPaste = {\n    name: AppEventType.ClipboardPaste,\n    payload: {\n      objects: clipboardContent.objects,\n    },\n  };\n  sendEvent(event);\n};\n","import { ClipboardCopy } from \"../AppEventType\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { setClipboardBoardContent } from \"../../threejs/clipboard\";\nimport { cloneDeep } from \"lodash\";\n\nexport class ClipboardCopyHandler extends BaseEventHandler<ClipboardCopy> {\n  run() {\n\n    const objects = this.store.selectedIds.map((id) => {\n      return cloneDeep(this.store.objects[id]);\n    });\n    setClipboardBoardContent({\n      objects,\n    });\n  }\n}\n\n\n","import { AppEventType, ClipboardCut } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { ClipboardCutHistory } from \"../AppHistory\";\nimport { triggerDeleteObjectIds } from \"../../threejs/eventEmitterHandlers\";\nimport { AppObject } from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setClipboardBoardContent } from \"../../threejs/clipboard\";\nimport { cloneDeep } from \"lodash\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class ClipboardCutHandler extends StoreObjectHandler<ClipboardCut> {\n  run() {\n    const ids: string[] = [];\n    const objects: AppObject[] = [];\n    const clonedObjects = this.store.selectedIds.map((id) => {\n      ids.push(id);\n      return cloneDeep(this.store.objects[id]);\n    });\n    setClipboardBoardContent({\n      objects: clonedObjects,\n    });\n    let newStore = this.deleteSelectedObjectsFromStore(ids, objects);\n\n    if (this.saveToHistory) {\n      const historyEvent: ClipboardCutHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.ClipboardPaste,\n          payload: {\n            objects: clonedObjects,\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    setStore(newStore);\n\n    triggerDeleteObjectIds(\n      objects.map((obj) => {\n        return { id: obj.id, objectType: obj.objectType };\n      })\n    );\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { AppEventType, ClipboardPaste } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { ClipboardPasteHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  AppObject,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n} from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { cloneDeep } from \"lodash\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\n/**\n * SUPER POWER!!!\n */\nexport class ClipboardPasteHandler extends StoreObjectHandler<ClipboardPaste> {\n  run() {\n    const mapIds = {};\n    const objects: AppObject[] = [];\n    this.event.payload.objects.forEach((obj) => {\n      if (!obj.id) {\n        return;\n      }\n      const oldId = obj.id;\n      const clone = cloneDeep(obj);\n      delete (clone as any).id;\n      let newObject = this.getAppObjectFromCloneAppObject(clone);\n      if (newObject == undefined) {\n        return;\n      }\n      mapIds[oldId] = newObject.id;\n      objects.push(newObject);\n    });\n    const { diffX, diffY } = this.getPositionDiffFromMousePosition(objects);\n    this.moveObjectsByDiff(objects, diffX, diffY);\n    objects.forEach((object) => {\n      if (object.objectType === ObjectTypes.Group) {\n        const newChildrenIds: string[] = [];\n        (object as Group).childrenIds.forEach((id) => {\n          newChildrenIds.push(mapIds[id]);\n        });\n        (object as Group).childrenIds = newChildrenIds;\n      }\n      if (object[groupIdKey] !== undefined) {\n        object[groupIdKey] = mapIds[object[groupIdKey]];\n      }\n    });\n    this.store.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(this.store.objects[id], false);\n    });\n    let newStore = produce(this.store, (draft) => {\n      draft.selectedIds = [];\n      objects.forEach((object) => {\n        draft.objects[object.id] = object;\n        draft.selectedIds.push(object.id);\n      });\n    });\n    objects.forEach((object) => {\n      addObjectByObjectType(object);\n      this.selectObjectOnThreeScene(object, true);\n    });\n    if (this.saveToHistory) {\n      const historyEvent: ClipboardPasteHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: {\n            ids: objects.map((object) => {\n              return object.id;\n            }),\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { AddMultipleBeads, AppEventType } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { AddMultipleBeadsHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport { AppObject } from \"../../editorObjects/Editor\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport { cloneDeep, times } from \"lodash\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class AddMultipleBeadsHandler extends StoreObjectHandler<AddMultipleBeads> {\n  run() {\n    const objects: AppObject[] = [];\n    if (this.event.payload.figure === \"rectangle\") {\n      const defaultBead = buildBead({});\n      const beadMargin = 2;\n      times(this.event.payload.rows).forEach((row) => {\n        times(this.event.payload.columns).forEach((col) => {\n          const x = ((defaultBead.width ?? 1) + beadMargin) * row;\n          const y = ((defaultBead.height ?? 1) + beadMargin) * col * -1;\n          const bead = buildBead({\n            position: {\n              x,\n              y,\n            },\n          });\n          objects.push(bead);\n        });\n      });\n    } else {\n      console.warn(\"figure not found in event payload\");\n    }\n\n    const { diffX, diffY } = this.getPositionDiffFromMousePosition(objects);\n    this.moveObjectsByDiff(objects, diffX, diffY);\n\n    let newStore = produce(this.store, (draft) => {\n      objects.forEach((object) => {\n        draft.objects[object.id] = object;\n        draft.selectedIds.push(object.id);\n      });\n    });\n\n    this.store.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(this.store.objects[id], false);\n    });\n    objects.forEach((object) => {\n      addObjectByObjectType(object);\n      this.selectObjectOnThreeScene(object, true);\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: AddMultipleBeadsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.AddObjects,\n          payload: {\n            objects: cloneDeep(objects),\n          },\n        },\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: { ids: objects.map((object) => object.id) },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { ChangeUiSettingsZoom } from \"../AppEventType\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { getRect10x10FromScreenToWorld } from \"../../threejs/mouseListeners/getRect10x10FromScreenToWorld\";\nimport { appThree } from \"../../threejs/renderThreejs\";\n\nexport class ChangeUiSettingsZoomHandler extends BaseEventHandler<ChangeUiSettingsZoom> {\n  run() {\n    const { zoomType } = this.event.payload;\n    const screenCenter = this.getCenterPosition();\n\n    if (zoomType === \"zoomByScroll\") {\n      let { scrollDelta, clientX, clientY } = this.event.payload;\n      if (!clientX) {\n        clientX = screenCenter.posX;\n      }\n      if (!clientY) {\n        clientY = screenCenter.posY;\n      }\n      if (!scrollDelta) {\n        scrollDelta = 1;\n      }\n      const { top, left } = appThree.el.getBoundingClientRect();\n      const screenX = clientX - left;\n      const screenY = clientY - top;\n      const scrollSign = Math.sign(scrollDelta);\n      this.updateByScroll(screenX, screenY, scrollSign);\n    } else if (zoomType === \"zoomInScreenCenter\") {\n      this.updateByScroll(screenCenter.posX, screenCenter.posY, -1);\n    } else if (zoomType === \"zoomOutScreenCenter\") {\n      this.updateByScroll(screenCenter.posX, screenCenter.posY, 1);\n    }\n  }\n\n  updateByScroll(screenX: number, screenY: number, scrollSign: number) {\n    const { width, height } = appThree.el.getBoundingClientRect();\n    const cameraX = appThree.camera.position.x;\n    const cameraY = appThree.camera.position.y;\n\n    const mouseXInWorldBefore = (screenX - width / 2) * this.store.ui.zoomScale;\n    const mouseYInWorldBefore =\n      -1 * (screenY - height / 2) * this.store.ui.zoomScale;\n\n    const zoomChange = this.store.ui.zoomScale >= 0.35 ? 0.02 * 5 : 0.01;\n    const zoomMax = 100;\n    const zoomMin = 0.0125;\n    let sceneScale = 1;\n    sceneScale = this.store.ui.zoomScale + scrollSign * zoomChange;\n    sceneScale = Math.min(Math.max(zoomMin, sceneScale), zoomMax);\n\n    const mouseXInWorldAfter = (screenX - width / 2) * sceneScale;\n    const mouseYInWorldAfter = -1 * (screenY - height / 2) * sceneScale;\n\n    appThree.camera.left = (width * sceneScale) / -2;\n    appThree.camera.right = (width * sceneScale) / 2;\n    appThree.camera.top = (height * sceneScale) / 2;\n    appThree.camera.bottom = (height * sceneScale) / -2;\n    appThree.camera.updateProjectionMatrix();\n\n    const diffX = mouseXInWorldBefore - mouseXInWorldAfter;\n    const diffY = mouseYInWorldBefore - mouseYInWorldAfter;\n\n    appThree.camera.position.x = cameraX + diffX;\n    appThree.camera.position.y = cameraY + diffY;\n    appThree.camera.lookAt(\n      appThree.camera.position.x,\n      appThree.camera.position.y,\n      0\n    );\n\n    const rect10x10FromScreenToWorld = getRect10x10FromScreenToWorld();\n    appThree.camera.userData = { sceneScale, rect10x10FromScreenToWorld };\n\n    let newStore = produce(this.store, (draft) => {\n      draft.ui.zoomScale = sceneScale;\n    });\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    appThree.scene.children.forEach((child) => {\n      if (child.layers.mask === 4) {\n        child.scale.x = sceneScale;\n        child.scale.y = sceneScale;\n        child.scale.z = sceneScale;\n      }\n    });\n  }\n}\n","import produce from \"immer\";\nimport { ChangeUiSettingsSidebar, ChangeUiSettingsZoom } from \"../AppEventType\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\n\nexport class ChangeUiSettingsSidebarHandler extends BaseEventHandler<ChangeUiSettingsSidebar> {\n  run() {\n    const { panel, open, toggle } = this.event.payload;\n    let newStore = produce(this.store, (draft) => {\n      let newOpen = open;\n\n      if (panel === \"objects\") {\n        if (\n          toggle !== undefined &&\n          toggle === true &&\n          draft.ui.rightSidebar.panel === \"objects\"\n        ) {\n          newOpen = !draft.ui.rightSidebar.isOpen;\n        }\n        draft.ui.rightSidebar.isOpen = newOpen;\n        draft.ui.rightSidebar.panel = newOpen === false ? undefined : \"objects\";\n      }\n      if (panel === \"history\") {\n        if (\n          toggle !== undefined &&\n          toggle === true &&\n          draft.ui.rightSidebar.panel === \"history\"\n        ) {\n          newOpen = !draft.ui.rightSidebar.isOpen;\n        }\n        draft.ui.rightSidebar.isOpen = newOpen;\n        draft.ui.rightSidebar.panel = newOpen === false ? undefined : \"history\";\n      }\n\n      if (panel === \"comments\") {\n        if (\n          toggle !== undefined &&\n          toggle === true &&\n          draft.ui.leftSidebar.panel === \"comments\"\n        ) {\n          newOpen = !draft.ui.leftSidebar.isOpen;\n        }\n        draft.ui.leftSidebar.isOpen = newOpen;\n        draft.ui.leftSidebar.panel = newOpen === false ? undefined : \"comments\";\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport { updateObjectPosition } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  ChangeObjectsProperty,\n  AppEventType,\n  ChangeObject,\n  ChangeSelectedObjectsAlignment,\n  SnapToLineType,\n} from \"../AppEventType\";\nimport { ChangeSelectedObjectsAlignmentHistory } from \"../AppHistory\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { setStore } from \"../store\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class ChangeObjectsAlignmentHandler extends StoreObjectHandler<ChangeSelectedObjectsAlignment> {\n  run() {\n    const { snapType, selectedIds } = this.event.payload;\n    const updates: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n    const historyChanges: ChangeObjectsProperty[\"payload\"][\"changes\"] = [];\n\n    let newStore = produce(this.store, (draft) => {\n      let maxX: number | undefined = undefined;\n      let minX: number | undefined = undefined;\n      let maxY: number | undefined = undefined;\n      let minY: number | undefined = undefined;\n\n      selectedIds.forEach((_id) => {\n        if (draft.objects[_id] === undefined) {\n          console.warn(\"no object found in store\", _id);\n          return;\n        }\n        const pos = draft.objects[_id].position;\n        const w = draft.objects[_id].width;\n        const h = draft.objects[_id].height;\n\n        if (minX === undefined) {\n          minX = pos.x;\n        } else if (pos.x < minX) {\n          minX = pos.x;\n        }\n\n        if (maxX === undefined) {\n          maxX = pos.x;\n        } else if (pos.x > maxX) {\n          maxX = pos.x;\n        }\n\n        if (minY === undefined) {\n          minY = pos.y;\n        } else if (pos.y < minY) {\n          minY = pos.y;\n        }\n\n        if (maxY === undefined) {\n          maxY = pos.y;\n        } else if (pos.y > maxY) {\n          maxY = pos.y;\n        }\n      });\n\n      if (snapType === SnapToLineType.X_MIN) {\n        if (minX !== undefined) {\n          const newPos = minX;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.x = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.X_MIDDLE) {\n        if (minX !== undefined && maxX !== undefined) {\n          const newPos = minX + (maxX - minX) / 2;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.x = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.X_MAX) {\n        if (maxX !== undefined) {\n          const newPos = maxX;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.x = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.Y_MIN) {\n        if (minY !== undefined) {\n          const newPos = minY;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.y = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.Y_MIDDLE) {\n        if (minY !== undefined && maxY !== undefined) {\n          const newPos = minY + (maxY - minY) / 2;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.y = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else if (snapType === SnapToLineType.Y_MAX) {\n        if (maxY !== undefined) {\n          const newPos = maxY;\n          selectedIds.forEach((id) => {\n            const singleHistoryChange: ChangeObject = {\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            };\n            historyChanges.push(singleHistoryChange);\n            draft.objects[id].position.y = newPos;\n            updates.push({\n              id: id,\n              properties: {\n                position: cloneDeep(draft.objects[id].position),\n              },\n            });\n          });\n        }\n      } else {\n        console.error(\"unknow SnapToLineType\", snapType);\n      }\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: ChangeSelectedObjectsAlignmentHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.ChangeObjectsProperty,\n          payload: { changes: historyChanges },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n\n    newStore = this.getStoreWithHistory(newStore);\n\n    // @INFO: CHANGES IN THREEJS\n    updates.forEach((_singleChange) => {\n      if (newStore.objects[_singleChange.id] === undefined) {\n        console.warn(\"no object found in store\", _singleChange.id);\n        return;\n      }\n      const object = newStore.objects[_singleChange.id];\n      updateObjectPosition(\n        _singleChange.id,\n        object.objectType,\n        object.position.x,\n        object.position.y\n      );\n    });\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      updates.map((_singleChange) => {\n        return {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: newStore.objects[_singleChange.id],\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { AddObjects, AppEventType, DuplicateObjects } from \"../AppEventType\";\nimport { BaseEventHandler } from \"../BaseHandlers/BaseEventHandler\";\nimport { setStore } from \"../store\";\nimport { AddObjectsHistory, DuplicateObjectsHistory } from \"../AppHistory\";\nimport { addObjectByObjectType } from \"../../threejs/eventEmitterHandlers\";\nimport {\n  AppObject,\n  Group,\n  groupIdKey,\n  ObjectTypes,\n} from \"../../editorObjects/Editor\";\nimport { buildRegion } from \"../../editorObjects/Region\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { buildPreviewProject3D } from \"../../editorObjects/PreviewProject3D\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { cloneDeep } from \"lodash\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class DuplicateObjectsHandler extends StoreObjectHandler<DuplicateObjects> {\n  run() {\n    const mapIds = {};\n    const objects: AppObject[] = [];\n    this.event.payload.objects.forEach((obj) => {\n      if (!obj.id) {\n        return;\n      }\n      const oldId = obj.id;\n      const clone = cloneDeep(obj);\n      delete (clone as any).id;\n      let newObject = this.getAppObjectFromCloneAppObject(clone);\n      if (newObject == undefined) {\n        return;\n      }\n      mapIds[oldId] = newObject.id;\n      objects.push(newObject);\n    });\n    // const offsetY = Math.random() * 3 * (Math.random() < 0.5 ? -1 : 1);\n    // const offsetX = Math.random() * 3 * (Math.random() < 0.5 ? -1 : 1);\n    const { diffX, diffY } = this.getPositionDiffFromMousePosition(objects);\n    this.moveObjectsByDiff(objects, diffX, diffY);\n    // this.moveObjectsByDiff(objects, diffX + offsetX, diffY + offsetY);\n    objects.forEach((object) => {\n      if (object.objectType === ObjectTypes.Group) {\n        const newChildrenIds: string[] = [];\n        (object as Group).childrenIds.forEach((id) => {\n          newChildrenIds.push(mapIds[id]);\n        });\n        (object as Group).childrenIds = newChildrenIds;\n      }\n      if (object[groupIdKey] !== undefined) {\n        object[groupIdKey] = mapIds[object[groupIdKey]];\n      }\n    });\n    this.store.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(this.store.objects[id], false);\n    });\n    let newStore = produce(this.store, (draft) => {\n      draft.selectedIds = [];\n      objects.forEach((object) => {\n        draft.objects[object.id] = object;\n        draft.selectedIds.push(object.id);\n      });\n    });\n    objects.forEach((object) => {\n      addObjectByObjectType(object);\n      this.selectObjectOnThreeScene(object, true);\n    });\n    if (this.saveToHistory) {\n      const historyEvent: DuplicateObjectsHistory = {\n        do: this.event,\n        redo: this.event,\n        undo: {\n          name: AppEventType.RemoveObjects,\n          payload: {\n            ids: objects.map((object) => {\n              return object.id;\n            }),\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n\n    notifyBackend(\n      objects.map((object) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object,\n        };\n      })\n    );\n  }\n}\n","import produce from \"immer\";\nimport { AppEventType, GroupObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { GroupObjectsHistory } from \"../AppHistory\";\nimport {\n  addObjectByObjectType,\n  triggerDeleteObjectIds,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { Group, groupIdKey, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport * as THREE from \"three\";\nimport { getStateObjectFromObjectId } from \"../../editorObjects/editorGetters\";\nimport { appThree } from \"../../threejs/renderThreejs\";\nimport { cloneDeep } from \"lodash\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class GroupObjectsHandler extends StoreObjectHandler<GroupObjects> {\n  run() {\n    const idsGroups: string[] = [];\n    const idsObjectsWithoutGroups: string[] = [];\n    const idsInGroup: string[] = [];\n    const removed: GroupObjects[\"payload\"][\"removed\"] = [];\n    const added: Group[] = [];\n\n    let newStore = produce(this.store, (draft) => {\n      let groupCount: any = 0;\n      let inGroupCount: any = 0;\n      let noGroupCount: any = 0;\n      this.event.payload.objects.forEach((objId) => {\n        if (draft.objects[objId.id] === undefined) {\n          console.warn(\"object not found in store\", objId.id);\n          return;\n        }\n        const object = draft.objects[objId.id];\n        const isGroup = object.objectType === ObjectTypes.Group;\n        const isInGroup =\n          object[groupIdKey] !== undefined && object[groupIdKey].length > 0;\n        if (isGroup) {\n          if (idsGroups.includes(object.id) === false) {\n            groupCount = groupCount + 1;\n            idsGroups.push(object.id);\n          }\n        } else if (isInGroup) {\n          inGroupCount = inGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n          idsInGroup.push(object.id);\n          if (\n            object[groupIdKey] &&\n            draft.objects[object[groupIdKey]] !== undefined\n          ) {\n            if (idsGroups.includes(object[groupIdKey]) === false) {\n              groupCount = groupCount + 1;\n              idsGroups.push(object[groupIdKey]);\n            }\n          }\n        } else {\n          noGroupCount = noGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n        }\n      });\n\n      if (\n        this.event.payload.removed !== undefined &&\n        this.event.payload.removed.length > 0\n      ) {\n        draft.selectedIds = [];\n        this.event.payload.removed.forEach((group) => {\n          if (group === undefined) {\n            return;\n          }\n          if (group.id === undefined) {\n            return;\n          }\n\n          const bbox = new THREE.Box3();\n\n          group.childrenIds.forEach((id) => {\n            const obj = draft.objects[id];\n            if (obj === undefined) {\n              return;\n            }\n            const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n            if (name === undefined) {\n              return;\n            }\n            const object = appThree.scene.getObjectByUserDataProperty(\n              \"name\",\n              name\n            );\n            if (object === undefined) {\n              return;\n            }\n            bbox.expandByObject(object);\n          });\n\n          const w = bbox.max.x - bbox.min.x;\n          const h = bbox.max.y - bbox.min.y;\n          const newGroup = buildGroup({\n            id: group.id,\n            childrenIds: group.childrenIds,\n            position: {\n              x: bbox.min.x + w / 2,\n              y: bbox.min.y + h / 2,\n            },\n            width: w,\n            height: h,\n          });\n\n          draft.objects[group.id] = newGroup;\n\n          added.push(newGroup);\n          draft.selectedIds.push(newGroup.id);\n\n          if (group.childrenIds !== undefined && group.childrenIds.length > 0) {\n            group.childrenIds.forEach((id) => {\n              if (draft.objects[id] === undefined) {\n                console.warn(\"object not found after group.childrenIds...\");\n                return;\n              }\n              draft.objects[id][groupIdKey] = newGroup.id;\n              draft.selectedIds.push(id);\n            });\n          }\n        });\n      } else {\n        idsGroups.forEach((id) => {\n          if (draft.objects[id] === undefined) {\n            return;\n          }\n          this.selectObjectOnThreeScene(draft.objects[id], false);\n          removed.push(cloneDeep(draft.objects[id] as Group));\n          delete draft.objects[id];\n        });\n\n        const bbox = new THREE.Box3();\n\n        idsObjectsWithoutGroups.forEach((id) => {\n          const obj = draft.objects[id];\n          const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n          if (name === undefined) {\n            return;\n          }\n          const object = appThree.scene.getObjectByUserDataProperty(\n            \"name\",\n            name\n          );\n          if (object === undefined) {\n            return;\n          }\n          bbox.expandByObject(object);\n        });\n\n        let newGroupId: string | undefined = undefined;\n\n        if (this.event.payload.added !== undefined) {\n          newGroupId = this.event.payload.added.id;\n        }\n\n        const w = bbox.max.x - bbox.min.x;\n        const h = bbox.max.y - bbox.min.y;\n        const newGroup = buildGroup({\n          id: newGroupId,\n          position: {\n            x: bbox.min.x + w / 2,\n            y: bbox.min.y + h / 2,\n          },\n          width: w,\n          height: h,\n          childrenIds: idsObjectsWithoutGroups,\n        });\n        draft.objects[newGroup.id] = newGroup;\n        added.push(newGroup);\n\n        idsObjectsWithoutGroups.forEach((id) => {\n          draft.objects[id][groupIdKey] = newGroup.id;\n        });\n\n        draft.selectedIds = [newGroup.id, ...idsObjectsWithoutGroups];\n      }\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: GroupObjectsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.GroupObjects,\n          payload: {\n            objects: this.event.payload.objects.map(({ id }) => {\n              return cloneDeep({ id });\n            }),\n            removed: this.event.payload.removed?.map(({ id, childrenIds }) => {\n              return cloneDeep({ id, childrenIds });\n            }),\n            added: added[0]\n              ? {\n                  id: added[0].id,\n                  childrenIds: added[0].childrenIds,\n                }\n              : undefined,\n          },\n        },\n        undo: {\n          name: AppEventType.UngroupObjects,\n          payload: {\n            objects: newStore.selectedIds.map((id) => {\n              return cloneDeep({ id });\n            }),\n            removed: removed.map(({ id, childrenIds }) => {\n              return cloneDeep({ id, childrenIds });\n            }),\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    this.event.payload.objects.forEach((object) => {\n      this.selectObjectOnThreeScene(object as any, false);\n    });\n\n    triggerDeleteObjectIds(\n      this.event.payload.objects.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    triggerDeleteObjectIds(\n      removed.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    idsObjectsWithoutGroups.forEach((id) => {\n      addObjectByObjectType(newStore.objects[id]);\n    });\n\n    added.forEach((obj) => {\n      addObjectByObjectType(newStore.objects[obj.id]);\n    });\n\n    newStore.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(newStore.objects[id], true);\n    });\n\n    notifyBackend(\n      added.map(({ id }) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      idsObjectsWithoutGroups.map((id) => {\n        return {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      removed.map(({ id }) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(this.store.objects[id]),\n        };\n      })\n    );\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import produce from \"immer\";\nimport { Group, groupIdKey, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { AppEventType, UngroupObjects } from \"../AppEventType\";\nimport { setStore } from \"../store\";\nimport { UngroupObjectsHistory } from \"../AppHistory\";\nimport {\n  addObjectByObjectType,\n  triggerDeleteObjectIds,\n} from \"../../threejs/eventEmitterHandlers\";\nimport { refreshReactState } from \"../refreshReactState\";\nimport { StoreObjectHandler } from \"../BaseHandlers/StoreObjectHandler\";\nimport dayjs from \"dayjs\";\nimport { cloneDeep } from \"lodash\";\nimport { buildGroup } from \"../../editorObjects/Group\";\nimport * as THREE from \"three\";\nimport { getStateObjectFromObjectId } from \"../../editorObjects/editorGetters\";\nimport { appThree } from \"../../threejs/renderThreejs\";\nimport { notifyBackend, SaveEventType } from \"../../ApiService\";\n\nexport class UngroupObjectsHandler extends StoreObjectHandler<UngroupObjects> {\n  run() {\n    const idsGroups: string[] = [];\n    const idsInGroup: string[] = [];\n    const idsObjectsWithoutGroups: string[] = [];\n    const removed: UngroupObjects[\"payload\"][\"removed\"] = [];\n    const added: Group[] = [];\n\n    let newStore = produce(this.store, (draft) => {\n      let groupCount: any = 0;\n      let inGroupCount: any = 0;\n      let noGroupCount: any = 0;\n\n      this.event.payload.objects.forEach((objId) => {\n        if (draft.objects[objId.id] === undefined) {\n          console.warn(\"object not found in store\", objId.id);\n          return;\n        }\n        const object = draft.objects[objId.id];\n        const isGroup = object.objectType === ObjectTypes.Group;\n        const isInGroup =\n          object[groupIdKey] !== undefined && object[groupIdKey].length > 0;\n        if (isGroup) {\n          if (idsGroups.includes(object.id) === false) {\n            groupCount = groupCount + 1;\n            idsGroups.push(object.id);\n          }\n        } else if (isInGroup) {\n          inGroupCount = inGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n          idsInGroup.push(object.id);\n          if (\n            object[groupIdKey] !== undefined &&\n            draft.objects[object[groupIdKey]]\n          ) {\n            if (idsGroups.includes(object[groupIdKey]) === false) {\n              groupCount = groupCount + 1;\n              idsGroups.push(object[groupIdKey]);\n            }\n          }\n        } else {\n          noGroupCount = noGroupCount + 1;\n          idsObjectsWithoutGroups.push(object.id);\n        }\n      });\n\n      if (\n        this.event.payload.removed !== undefined &&\n        this.event.payload.removed.length > 0\n      ) {\n        draft.selectedIds = [];\n        this.event.payload.objects.forEach(({ id }) => {\n          if (draft.objects[id] === undefined) {\n            return;\n          }\n          if (draft.objects[id].objectType === ObjectTypes.Group) {\n            this.selectObjectOnThreeScene(draft.objects[id], false);\n            const childrenIds = (draft.objects[id] as Group).childrenIds;\n            childrenIds.forEach((id) => {\n              draft.objects[id][groupIdKey] = undefined;\n            });\n            removed.push(cloneDeep({ childrenIds, id }));\n            delete draft.objects[id];\n            return;\n          }\n          draft.objects[id][groupIdKey] = undefined;\n        });\n        this.event.payload.removed.forEach((group) => {\n          if (group === undefined) {\n            return;\n          }\n          if (group.id === undefined) {\n            return;\n          }\n\n          const bbox = new THREE.Box3();\n\n          group.childrenIds.forEach((id) => {\n            const obj = draft.objects[id];\n            if (obj === undefined) {\n              return;\n            }\n            const name = getStateObjectFromObjectId(obj.id, obj.objectType);\n            if (name === undefined) {\n              return;\n            }\n            const object = appThree.scene.getObjectByUserDataProperty(\n              \"name\",\n              name\n            );\n            if (object === undefined) {\n              return;\n            }\n            bbox.expandByObject(object);\n          });\n\n          const w = bbox.max.x - bbox.min.x;\n          const h = bbox.max.y - bbox.min.y;\n          const newGroup = buildGroup({\n            id: group.id,\n            childrenIds: group.childrenIds,\n            position: {\n              x: bbox.min.x + w / 2,\n              y: bbox.min.y + h / 2,\n            },\n            width: w,\n            height: h,\n          });\n\n          draft.objects[group.id] = newGroup;\n          added.push(newGroup);\n          draft.selectedIds.push(newGroup.id);\n\n          if (group.childrenIds) {\n            group.childrenIds.forEach((id) => {\n              if (draft.objects[id] === undefined) {\n                return;\n              }\n              draft.objects[id][groupIdKey] = newGroup.id;\n              draft.selectedIds.push(id);\n            });\n          }\n        });\n      } else {\n        idsGroups.forEach((id) => {\n          if (draft.objects[id] === undefined) {\n            return;\n          }\n          this.selectObjectOnThreeScene(draft.objects[id], false);\n          const childrenIds = (draft.objects[id] as Group).childrenIds;\n          childrenIds.forEach((id) => {\n            draft.objects[id][groupIdKey] = undefined;\n          });\n          removed.push(cloneDeep({ id, childrenIds }));\n          delete draft.objects[id];\n        });\n      }\n\n      draft.selectedIds = [...idsObjectsWithoutGroups];\n    });\n\n    if (this.saveToHistory) {\n      const historyEvent: UngroupObjectsHistory = {\n        do: this.event,\n        redo: {\n          name: AppEventType.UngroupObjects,\n          payload: {\n            objects: newStore.selectedIds.map((id) => {\n              return cloneDeep({ id });\n            }),\n            removed: this.event.payload.removed?.map(({ id, childrenIds }) => {\n              return cloneDeep({ id, childrenIds });\n            }),\n          },\n        },\n        undo: {\n          name: AppEventType.GroupObjects,\n          payload: {\n            objects: this.event.payload.objects,\n            removed: removed.map(({ id, childrenIds }) => {\n              return { id, childrenIds };\n            }),\n          },\n        },\n        createdAt: dayjs().toISOString(),\n      };\n      this.history.push(historyEvent);\n    }\n    newStore = this.getStoreWithHistory(newStore);\n\n    this.event.payload.objects.forEach((object) => {\n      this.selectObjectOnThreeScene(object as any, false);\n    });\n\n    triggerDeleteObjectIds(\n      removed.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    // @TODO: po ungroup nie powinno by usuwania i dodawania wszystkich obiektow zaleznych\n    triggerDeleteObjectIds(\n      this.event.payload.objects.map(({ id }) => {\n        if (this.store.objects[id] === undefined) {\n          return { id, objectType: \"\" } as any;\n        }\n        return { id, objectType: this.store.objects[id].objectType };\n      })\n    );\n\n    added.forEach((obj) => {\n      addObjectByObjectType(newStore.objects[obj.id]);\n    });\n\n    idsObjectsWithoutGroups.forEach((id) => {\n      addObjectByObjectType(newStore.objects[id]);\n    });\n\n    newStore.selectedIds.forEach((id) => {\n      this.selectObjectOnThreeScene(newStore.objects[id], true);\n    });\n\n    notifyBackend(\n      added.map(({ id }) => {\n        return {\n          action: SaveEventType.CREATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      idsObjectsWithoutGroups.map((id) => {\n        return {\n          action: SaveEventType.UPDATE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(newStore.objects[id]),\n        };\n      })\n    );\n\n    notifyBackend(\n      removed.map(({ id }) => {\n        return {\n          action: SaveEventType.DELETE,\n          createdAt: new Date().toISOString(),\n          object: cloneDeep(this.store.objects[id]),\n        };\n      })\n    );\n\n    newStore = this.getNewStoreWithTopBarPosition(newStore);\n    setStore(newStore);\n    refreshReactState(newStore);\n  }\n}\n","import { AddObjectHandler } from \"./EventHandlers/AddObjectHandler\";\nimport { AppEvents, AppEventType } from \"./AppEventType\";\nimport { getStore, shouldRefreshReact, shouldRefreshThree } from \"./store\";\nimport { RemoveObjectHandler } from \"./EventHandlers/RemoveObjectHandler\";\nimport { ChangeSelectObjectsHandler } from \"./EventHandlers/ChangeSelectObjectsHandler\";\nimport { ChangeObjectsPropertyHandler } from \"./EventHandlers/ChangeObjectsPropertyHandler\";\nimport { getHistory } from \"./AppHistory\";\nimport { ChangeUiSettingsHandler } from \"./EventHandlers/ChangeUiSettingsHandler\";\nimport { ClipboardCopyHandler } from \"./EventHandlers/ClipboardCopyHandler\";\nimport { ClipboardCutHandler } from \"./EventHandlers/ClipboardCutHandler\";\nimport { ClipboardPasteHandler } from \"./EventHandlers/ClipboardPasteHandler\";\nimport { AddMultipleBeadsHandler } from \"./EventHandlers/AddMultipleBeadsHandler\";\nimport { ChangeUiSettingsZoomHandler } from \"./EventHandlers/ChangeUiSettingsZoomHandler\";\nimport { ChangeUiSettingsSidebarHandler } from \"./EventHandlers/ChangeUiSettingsSidebarHandler\";\nimport { ChangeObjectsAlignmentHandler } from \"./EventHandlers/ChangeObjectsAlignmentHandler\";\nimport { DuplicateObjectsHandler } from \"./EventHandlers/DuplicateObjectsHandler\";\nimport { GroupObjectsHandler } from \"./EventHandlers/GroupObjectsHandler\";\nimport { UngroupObjectsHandler } from \"./EventHandlers/UngroupObjectsHandler\";\nimport { IBaseEventHandler } from \"./BaseHandlers/StoreObjectHandler\";\nimport { logger } from \"../logger\";\n\nexport const sendEvent = (event: AppEvents, saveToHistory: boolean = true) => {\n  logger.log(\n    \"dispatchEvent\",\n    event.name,\n    event.payload,\n    \"saveToHistory\",\n    saveToHistory\n  );\n\n  const classNames: { [key in AppEventType]: any } = {\n    [AppEventType.AddObjects]: AddObjectHandler,\n    [AppEventType.RemoveObjects]: RemoveObjectHandler,\n    [AppEventType.ChangeSelectObjects]: ChangeSelectObjectsHandler,\n    [AppEventType.ChangeObjectsProperty]: ChangeObjectsPropertyHandler,\n    [AppEventType.ChangeUiSettings]: ChangeUiSettingsHandler,\n    [AppEventType.ChangeObjectsProperty]: ChangeObjectsPropertyHandler,\n    [AppEventType.ClipboardCopy]: ClipboardCopyHandler,\n    [AppEventType.ClipboardCut]: ClipboardCutHandler,\n    [AppEventType.ClipboardPaste]: ClipboardPasteHandler,\n    [AppEventType.AddMultipleBeads]: AddMultipleBeadsHandler,\n    [AppEventType.ChangeUiSettingsZoom]: ChangeUiSettingsZoomHandler,\n    [AppEventType.ChangeUiSettingsSidebar]: ChangeUiSettingsSidebarHandler,\n    [AppEventType.ChangeObjectsAlignment]: ChangeObjectsAlignmentHandler,\n    [AppEventType.DuplicateObjects]: DuplicateObjectsHandler,\n    [AppEventType.GroupObjects]: GroupObjectsHandler,\n    [AppEventType.UngroupObjects]: UngroupObjectsHandler,\n  };\n\n  if (classNames[event.name] !== undefined) {\n    const history = getHistory();\n    const store = getStore();\n    const className = classNames[event.name];\n    const handler = new className(\n      event as any,\n      store,\n      history,\n      saveToHistory\n    ) as IBaseEventHandler;\n    handler.run(shouldRefreshThree(), shouldRefreshReact());\n  } else {\n    console.warn(\"event handler not found to name\", event);\n  }\n\n  // const history = getHistory();\n  // const store = getStore();\n  // if (event.name === AppEventType.AddObjects) {\n  //   new AddObjectHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.RemoveObjects) {\n  //   new RemoveObjectHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ChangeSelectObjects) {\n  //   new ChangeSelectObjectsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ChangeObjectsProperty) {\n  //   new ChangeObjectsPropertyHandler(\n  //     event,\n  //     store,\n  //     history,\n  //     saveToHistory\n  //   ).run();\n  // } else if (event.name === AppEventType.ChangeUiSettings) {\n  //   new ChangeUiSettingsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ClipboardCopy) {\n  //   new ClipboardCopyHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ClipboardCut) {\n  //   new ClipboardCutHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ClipboardPaste) {\n  //   new ClipboardPasteHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.AddMultipleBeads) {\n  //   new AddMultipleBeadsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ChangeUiSettingsZoom) {\n  //   new ChangeUiSettingsZoomHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.ChangeUiSettingsSidebar) {\n  //   new ChangeUiSettingsSidebarHandler(\n  //     event,\n  //     store,\n  //     history,\n  //     saveToHistory\n  //   ).run();\n  // } else if (event.name === AppEventType.ChangeObjectsAlignment) {\n  //   new ChangeObjectsAlignmentHandler(\n  //     event,\n  //     store,\n  //     history,\n  //     saveToHistory\n  //   ).run();\n  // } else if (event.name === AppEventType.DuplicateObjects) {\n  //   new DuplicateObjectsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.GroupObjects) {\n  //   new GroupObjectsHandler(event, store, history, saveToHistory).run();\n  // } else if (event.name === AppEventType.UngroupObjects) {\n  //   new UngroupObjectsHandler(event, store, history, saveToHistory).run();\n  // } else {\n  //   console.warn(\"event handler not found to name\", event);\n  // }\n\n  return event;\n};\n","import React from \"react\";\nimport {\n  faAddressBook,\n  faAlignLeft,\n  faArrowsAlt,\n  faBorderNone,\n  faBurn,\n  faChevronDown,\n  faCrosshairs,\n  faLock,\n  faObjectGroup,\n  faObjectUngroup,\n  faSearch,\n  faShapes,\n  faSync,\n  faTimes,\n  faUnlock,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faEllipsisH } from \"@fortawesome/free-solid-svg-icons\";\nimport { ActionsTypes } from \"./ActionsTypes\";\nimport { useSelector } from \"react-redux\";\nimport { Bead, Editor } from \"../../editorObjects/Editor\";\nimport styled from \"styled-components\";\nimport {\n  AppEventType,\n  ChangeObject,\n  ChangeObjectsProperty,\n  ChangeSelectObject,\n  ChangeSelectObjects,\n  GroupObjects,\n  UngroupObjects,\n} from \"../../controllers/AppEventType\";\nimport { getStore } from \"../../controllers/store\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport { cloneDeep } from \"lodash\";\n\nexport const ActionsIconsWrapper: React.FC<{\n  actions: ActionsTypes[];\n  selectedAction?: ActionsTypes;\n  onClick: any;\n}> = (props) => {\n  return (\n    <GroupActionsStyles>\n      <div className={\"actions-group\"}>\n        {props.actions.map((action, index) => {\n          if (action === ActionsTypes.More) {\n            return (\n              <IconActionsTypeMore\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.EditBeadColor) {\n            return (\n              <IconActionsTypeEditBeadColor\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.EditRegionGridType) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faShapes} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditRegionGridSettings) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faBorderNone} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditPosition) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faCrosshairs} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditRotate) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faSync} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditWidthHeight) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faArrowsAlt} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditWidthHeightDepth) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faArrowsAlt} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.Alignment) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faAlignLeft} />\n\n                      <FontAwesomeIcon icon={faChevronDown} size={\"sm\"} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditBeadType) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faShapes} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.EditBeadProduct) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faSearch} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.Lock) {\n            return (\n              <IconActionsLock\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.Unlock) {\n            return (\n              <IconActionsUnlock\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.EditBeadMaterial) {\n            //@TODO: Gdy wybranych jest kilka roznych wartosci, ikona powinna odpowiadac wybranym\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <div className={\"align-icons-wrapper\"}>\n                      <FontAwesomeIcon icon={faBurn} />\n                    </div>\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          } else if (action === ActionsTypes.Group) {\n            return (\n              <IconActionsGroup\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else if (action === ActionsTypes.Ungroup) {\n            return (\n              <IconActionsUngroup\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              />\n            );\n          } else {\n            return (\n              <ItemActionWrapper\n                onClick={props.onClick}\n                type={action}\n                key={index}\n                selectedAction={props.selectedAction}\n              >\n                <div className={\"icon-action-type\"}>\n                  <div\n                    // @TRANSLATION\n                    data-tip={action}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    <FontAwesomeIcon icon={faTimes} />\n                  </div>\n                </div>\n              </ItemActionWrapper>\n            );\n          }\n        })}\n      </div>\n    </GroupActionsStyles>\n  );\n};\n\nexport const GroupActionsStyles = styled.div`\n  height: 100%;\n\n  .more-icon-action-type {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 40px;\n    svg path {\n      fill: var(--gray);\n    }\n    div {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n  }\n  .icon-action-type-color {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 50px;\n  }\n  .icon-action-type {\n    width: 50px;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: var(--standardPadding);\n    padding-right: var(--standardPadding);\n  }\n  .icon-action-type-color {\n    .value {\n      height: 30px;\n      width: 30px;\n      background: transparent;\n      border-radius: 30px;\n      border: 1px solid #000;\n    }\n  }\n  .action-item-wrapper {\n    height: 100%;\n    transition: all 0.4s ease-in-out;\n  }\n  .action-item-wrapper.active {\n    background: rgba(0, 0, 0, 0.2);\n  }\n  .actions-group {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    position: relative;\n    height: 100%;\n    &:before {\n      content: \"\";\n      position: absolute;\n      top: 50%;\n      left: calc(var(--standardPadding) * -1);\n      height: 70%;\n      transform: translate(0, -50%);\n      width: 1px;\n      background: var(--gray);\n    }\n  }\n  .align-icons-wrapper {\n    column-gap: var(--standardPadding);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  .long-press-wrapper {\n    height: 100%;\n    position: relative;\n    &.active {\n      .long-press-ghost {\n        max-width: 100%;\n      }\n    }\n    .long-press-ghost {\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 2;\n      overflow: hidden;\n      background: #eee;\n      max-width: 0%;\n      height: 100%;\n      transition-property: all;\n      animation-timing-function: cubic-bezier(0.25, 0.1, 1, 1);\n      animation-fill-mode: forwards;\n      width: 100%;\n    }\n    .long-press-icon {\n      position: relative;\n      z-index: 3;\n      height: 100%;\n      width: 110px;\n      display: flex;\n      column-gap: var(--standardPadding);\n      padding-left: 30px;\n      .icon-wrapper {\n        position: absolute;\n        top: 50%;\n        left: 5px;\n        transform: translate(0, -50%);\n        font-size: 18px;\n      }\n\n      .label-wrapper {\n        font-size: 13px;\n        display: flex;\n        justify-content: center;\n        text-align: center;\n        align-content: center;\n        position: absolute;\n        top: 50%;\n        left: 30px;\n        transform: translate(0, -50%);\n      }\n    }\n  }\n`;\n\nexport const ItemActionWrapper: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const elRef = React.useRef<HTMLDivElement | null>(null);\n  const onClick = () => {\n    if (elRef.current) {\n      const { offsetLeft, offsetParent, offsetWidth } = elRef.current;\n      let groupOffsetLeft = 0;\n      if (offsetParent) {\n        groupOffsetLeft = (offsetParent as HTMLDivElement).offsetLeft;\n      } else {\n        console.warn(\"ref parent element not found\");\n      }\n      const halfWidth = offsetWidth / 2;\n      const finalOffsetLeft = groupOffsetLeft + offsetLeft + halfWidth;\n      props.onClick(props.type, finalOffsetLeft);\n    } else {\n      console.warn(\"ref element not found\");\n    }\n  };\n  return (\n    <div\n      className={`action-item-wrapper ${\n        props.selectedAction !== undefined &&\n        props.selectedAction === props.type\n          ? \"active\"\n          : \"\"\n      }`}\n      ref={(e) => (elRef.current = e)}\n      onClick={onClick}\n    >\n      {props.children}\n    </div>\n  );\n};\n\nexport const IconActionsTypeMore: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  return (\n    <ItemActionWrapper\n      onClick={props.onClick}\n      type={props.type}\n      selectedAction={props.selectedAction}\n    >\n      <div className={`more-icon-action-type `}>\n        <div\n          // @TRANSLATION\n          data-tip={\"Color\"}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <FontAwesomeIcon icon={faEllipsisH} />\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nexport const IconActionsTypeEditBeadColor: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const backgroundColors = useSelector((state: Editor) => {\n    const colors: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const color = (state.objects[id] as Bead).color;\n      if (colors.includes(color) === false) {\n        colors.push(color);\n      }\n    });\n    return colors;\n  });\n\n  if (backgroundColors.length === 0) {\n    return <React.Fragment />;\n  }\n\n  return (\n    <ItemActionWrapper\n      onClick={props.onClick}\n      type={props.type}\n      selectedAction={props.selectedAction}\n    >\n      <div className={\"icon-action-type-color\"}>\n        <div\n          // @TRANSLATION\n          data-tip={\"More\"}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div\n            className={\"value\"}\n            style={{\n              background: `linear-gradient(to right, ${\n                backgroundColors.length === 1\n                  ? [backgroundColors[0], backgroundColors[0]].join()\n                  : backgroundColors.slice(0, 10).join()\n              })`,\n            }}\n          >\n            &nbsp;\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nconst IconActionsUnlock: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const [startLongPress, setStartLongPress] = React.useState(false);\n  const ms = 600;\n  const onSuccess = () => {\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              isLocked: false,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n    props.onClick(undefined, undefined);\n  };\n\n  React.useEffect(() => {\n    let timerId;\n    if (startLongPress) {\n      timerId = setTimeout(onSuccess, ms);\n    } else {\n      clearTimeout(timerId);\n    }\n\n    return () => {\n      clearTimeout(timerId);\n    };\n  }, [startLongPress]);\n\n  const start = React.useCallback(() => {\n    setStartLongPress(true);\n  }, []);\n\n  const stop = React.useCallback(() => {\n    setStartLongPress(false);\n  }, []);\n\n  return (\n    <div\n      onMouseDown={start}\n      onMouseUp={stop}\n      onMouseLeave={stop}\n      onTouchStart={start}\n      onTouchEnd={stop}\n      className={`long-press-wrapper ${startLongPress ? \"active\" : \"\"}`}\n    >\n      <div\n        className={`long-press-ghost`}\n        style={{ transitionDuration: `${ms}ms` }}\n      >\n        &nbsp;\n      </div>\n      <div className={\"long-press-icon\"}>\n        <div className={\"icon-wrapper\"}>\n          <FontAwesomeIcon icon={faLock} />\n        </div>\n        <div className={\"label-wrapper\"}>\n          <span>Long press to unlock</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst IconActionsLock: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const onClick = () => {\n    const store = getStore();\n    const _event: ChangeSelectObjects = {\n      name: AppEventType.ChangeSelectObjects,\n      payload: {\n        change: store.selectedIds.map((id) => {\n          const _change: ChangeSelectObject = {\n            id,\n            isSelected: false,\n          };\n          return _change;\n        }),\n      },\n    };\n    sendEvent(_event);\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              isLocked: true,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <ItemActionWrapper onClick={onClick} type={ActionsTypes.Lock}>\n      <div className={\"icon-action-type\"}>\n        <div\n          // @TRANSLATION\n          data-tip={ActionsTypes.Lock}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div className={\"align-icons-wrapper\"}>\n            <FontAwesomeIcon icon={faUnlock} />\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nconst IconActionsGroup: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const onClick = () => {\n    const store = getStore();\n    const _event: GroupObjects = {\n      name: AppEventType.GroupObjects,\n      payload: {\n        objects: store.selectedIds.map((id) => {\n          return cloneDeep(store.objects[id]);\n        }),\n      },\n    };\n    sendEvent(_event);\n  };\n  return (\n    <ItemActionWrapper onClick={onClick} type={props.type}>\n      <div className={\"icon-action-type\"}>\n        <div\n          // @TRANSLATION\n          data-tip={props.type}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div className={\"align-icons-wrapper\"}>\n            <FontAwesomeIcon icon={faObjectGroup} />\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n\nconst IconActionsUngroup: React.FC<{\n  onClick: any;\n  type: ActionsTypes;\n  selectedAction?: ActionsTypes;\n}> = (props) => {\n  const onClick = () => {\n    const store = getStore();\n    const _event: UngroupObjects = {\n      name: AppEventType.UngroupObjects,\n      payload: {\n        objects: store.selectedIds.map((id) => {\n          return cloneDeep(store.objects[id]);\n        }),\n      },\n    };\n    sendEvent(_event);\n  };\n  return (\n    <ItemActionWrapper onClick={onClick} type={props.type}>\n      <div className={\"icon-action-type\"}>\n        <div\n          // @TRANSLATION\n          data-tip={props.type}\n          data-place={\"bottom\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n        >\n          <div className={\"align-icons-wrapper\"}>\n            <FontAwesomeIcon icon={faObjectUngroup} />\n          </div>\n        </div>\n      </div>\n    </ItemActionWrapper>\n  );\n};\n","// ts-nocheck\n\nimport React, { Component } from \"react\";\n// import PropTypes from \"prop-types\";\n\nconst KEYCODE_UP = 38;\nconst KEYCODE_DOWN = 40;\nconst IS_BROWSER = typeof document != \"undefined\";\nconst RE_NUMBER = /^[+-]?((\\.\\d+)|(\\d+(\\.\\d+)?))$/;\nconst RE_INCOMPLETE_NUMBER = /^([+-]0?|[0-9]*\\.0*|[+-]\\.0*|[+-]?\\d+\\.)?$/;\n\n/**\n * Just a simple helper to provide support for older IEs. This is not exactly a\n * polyfill for classList.add but it does what we need with minimal effort.\n * Works with single className only!\n */\nfunction addClass(element, className) {\n  if (element.classList) {\n    return element.classList.add(className);\n  }\n  if (!element.className.search(new RegExp(\"\\\\b\" + className + \"\\\\b\"))) {\n    element.className = \" \" + className;\n  }\n}\n\n/**\n * Just a simple helper to provide support for older IEs. This is not exactly a\n * polyfill for classList.remove but it does what we need with minimal effort.\n * Works with single className only!\n */\nfunction removeClass(element, className) {\n  if (element.className) {\n    if (element.classList) {\n      return element.classList.remove(className);\n    }\n\n    element.className = element.className.replace(\n      new RegExp(\"\\\\b\" + className + \"\\\\b\", \"g\"),\n      \"\"\n    );\n  }\n}\n\n/**\n * Lookup the object.prop and returns it. If it happens to be a function,\n * executes it with args and returns it's return value. It the prop does not\n * exist on the object, or if it equals undefined, or if it is a function that\n * returns undefined the defaultValue will be returned instead.\n * @param  {Object} object       The object to look into\n * @param  {String} prop         The property name\n * @param  {*}      defaultValue The default value\n * @param  {*[]}    args         Any additional arguments to pass to the\n *                               function (if the prop is a function).\n * @return {*}                   Whatever happens to be the return value\n */\nfunction access(object, prop, defaultValue, ...args) {\n  let result = object[prop];\n  if (typeof result == \"function\") {\n    result = result(...args);\n  }\n  return result === undefined ? defaultValue : result;\n}\n\n/* eslint-disable */\ntype NumericInputState = {\n  selectionStart?: number | null;\n  selectionEnd?: number | null;\n  btnDownHover?: boolean;\n  btnDownActive?: boolean;\n  btnUpHover?: boolean;\n  btnUpActive?: boolean;\n  value?: number | null;\n  stringValue?: string;\n};\n/*eslint-enable*/\n\ninterface NumericInputProps {\n  step?: any;\n  min?: any;\n  max?: any;\n  precision?: any;\n  maxLength?: any;\n  parse?: any;\n  format?: any;\n  className?: any;\n  disabled?: any;\n  readOnly?: any;\n  required?: any;\n  snap?: any;\n  noValidate?: any;\n  style?: any;\n  noStyle?: any;\n  type?: any;\n  pattern?: any;\n  onFocus?: any;\n  onBlur?: any;\n  onKeyDown?: any;\n  onChange?: any;\n  onInvalid?: any;\n  onValid?: any;\n  onInput?: any;\n  onSelect?: any;\n  size?: any;\n  value?: any;\n  defaultValue?: any;\n  strict?: any;\n  componentClass?: any;\n  mobile?: any;\n}\n\nexport class NumericInput extends Component<\n  NumericInputProps,\n  NumericInputState\n> {\n  // static propTypes = {\n  //   step: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   min: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   max: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   precision: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  //   maxLength: PropTypes.number,\n  //   parse: PropTypes.func,\n  //   format: PropTypes.func,\n  //   className: PropTypes.string,\n  //   disabled: PropTypes.bool,\n  //   readOnly: PropTypes.bool,\n  //   required: PropTypes.bool,\n  //   snap: PropTypes.bool,\n  //   noValidate: PropTypes.oneOfType([PropTypes.bool, PropTypes.string]),\n  //   style: PropTypes.oneOfType([PropTypes.object, PropTypes.bool]),\n  //   noStyle: PropTypes.bool,\n  //   type: PropTypes.string,\n  //   pattern: PropTypes.string,\n  //   onFocus: PropTypes.func,\n  //   onBlur: PropTypes.func,\n  //   onKeyDown: PropTypes.func,\n  //   onChange: PropTypes.func,\n  //   onInvalid: PropTypes.func,\n  //   onValid: PropTypes.func,\n  //   onInput: PropTypes.func,\n  //   onSelect: PropTypes.func,\n  //   size: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  //   value: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  //   defaultValue: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  //   strict: PropTypes.bool,\n  //   componentClass: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n  //   mobile(props, propName) {\n  //     let prop = props[propName];\n  //     if (\n  //       prop !== true &&\n  //       prop !== false &&\n  //       prop !== \"auto\" &&\n  //       typeof prop != \"function\"\n  //     ) {\n  //       return new Error(\n  //         'The \"mobile\" prop must be true, false, \"auto\" or a function'\n  //       );\n  //     }\n  //   },\n  // };\n\n  /**\n   * The default behavior is to start from 0, use step of 1 and display\n   * integers\n   */\n  static defaultProps = {\n    step: 1,\n    min: Number.MIN_SAFE_INTEGER || -9007199254740991,\n    max: Number.MAX_SAFE_INTEGER || 9007199254740991,\n    precision: null,\n    parse: null,\n    format: null,\n    mobile: \"auto\",\n    strict: false,\n    componentClass: \"input\",\n    style: {},\n  };\n\n  /**\n   * This are the default styles that act as base for all the component\n   * instances. One can modify this object to change the default styles\n   * of all the widgets on the page.\n   */\n  static style = {\n    // The wrapper (span)\n    wrap: {\n      position: \"relative\",\n      display: \"inline-block\",\n    },\n\n    \"wrap.hasFormControl\": {\n      display: \"block\",\n    },\n\n    // The increase button arrow (i)\n    arrowUp: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 0,\n      height: 0,\n      borderWidth: \"0 0.6ex 0.6ex 0.6ex\",\n      borderColor: \"transparent transparent rgba(0, 0, 0, 0.7)\",\n      borderStyle: \"solid\",\n      margin: \"-0.3ex 0 0 -0.56ex\",\n    },\n\n    // The decrease button arrow (i)\n    arrowDown: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 0,\n      height: 0,\n      borderWidth: \"0.6ex 0.6ex 0 0.6ex\",\n      borderColor: \"rgba(0, 0, 0, 0.7) transparent transparent\",\n      borderStyle: \"solid\",\n      margin: \"-0.3ex 0 0 -0.56ex\",\n    },\n\n    // The vertical segment of the plus sign (for mobile only)\n    plus: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 2,\n      height: 10,\n      background: \"rgba(0,0,0,.7)\",\n      margin: \"-5px 0 0 -1px\",\n    },\n\n    // The horizontal segment of the plus/minus signs (for mobile only)\n    minus: {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      width: 10,\n      height: 2,\n      background: \"rgba(0,0,0,.7)\",\n      margin: \"-1px 0 0 -5px\",\n    },\n\n    // Common styles for the up/down buttons (b)\n    btn: {\n      position: \"absolute\",\n      right: 2,\n      width: \"2.26ex\",\n      borderColor: \"rgba(0,0,0,.1)\",\n      borderStyle: \"solid\",\n      textAlign: \"center\",\n      cursor: \"default\",\n      transition: \"all 0.1s\",\n      background: \"rgba(0,0,0,.1)\",\n      boxShadow:\n        \"-1px -1px 3px rgba(0,0,0,.1) inset,\" +\n        \"1px 1px 3px rgba(255,255,255,.7) inset\",\n    },\n\n    btnUp: {\n      top: 2,\n      bottom: \"50%\",\n      borderRadius: \"2px 2px 0 0\",\n      borderWidth: \"1px 1px 0 1px\",\n    },\n\n    \"btnUp.mobile\": {\n      width: \"3.3ex\",\n      bottom: 2,\n      boxShadow: \"none\",\n      borderRadius: 2,\n      borderWidth: 1,\n    },\n\n    btnDown: {\n      top: \"50%\",\n      bottom: 2,\n      borderRadius: \"0 0 2px 2px\",\n      borderWidth: \"0 1px 1px 1px\",\n    },\n\n    \"btnDown.mobile\": {\n      width: \"3.3ex\",\n      bottom: 2,\n      left: 2,\n      top: 2,\n      right: \"auto\",\n      boxShadow: \"none\",\n      borderRadius: 2,\n      borderWidth: 1,\n    },\n\n    \"btn:hover\": {\n      background: \"rgba(0,0,0,.2)\",\n    },\n\n    \"btn:active\": {\n      background: \"rgba(0,0,0,.3)\",\n      boxShadow:\n        \"0 1px 3px rgba(0,0,0,.2) inset,\" +\n        \"-1px -1px 4px rgba(255,255,255,.5) inset\",\n    },\n\n    \"btn:disabled\": {\n      opacity: 0.5,\n      boxShadow: \"none\",\n      cursor: \"not-allowed\",\n    },\n\n    // The input (input[type=\"text\"])\n    input: {\n      paddingRight: \"3ex\",\n      boxSizing: \"border-box\",\n      fontSize: \"inherit\",\n    },\n\n    // The input with bootstrap class\n    \"input:not(.form-control)\": {\n      border: \"1px solid #ccc\",\n      borderRadius: 2,\n      paddingLeft: 4,\n      display: \"block\",\n      WebkitAppearance: \"none\",\n      lineHeight: \"normal\",\n    },\n\n    \"input.mobile\": {\n      paddingLeft: \" 3.4ex\",\n      paddingRight: \"3.4ex\",\n      textAlign: \"center\",\n    },\n\n    \"input:focus\": {},\n\n    \"input:disabled\": {\n      color: \"rgba(0, 0, 0, 0.3)\",\n      textShadow: \"0 1px 0 rgba(255, 255, 255, 0.8)\",\n    },\n  };\n\n  /**\n   * When click and hold on a button - the speed of auto changing the value.\n   * This is a static property and can be modified if needed.\n   */\n  static SPEED = 50;\n\n  /**\n   * When click and hold on a button - the delay before auto changing the value.\n   * This is a static property and can be modified if needed.\n   */\n  static DELAY = 500;\n\n  /**\n   * The constant indicating up direction (or increasing in general)\n   */\n  static DIRECTION_UP = \"up\";\n\n  /**\n   * The constant indicating down direction (or decreasing in general)\n   */\n  static DIRECTION_DOWN = \"down\";\n\n  /**\n   * The step timer\n   * @type {Number}\n   */\n  /**\n   * The step timer\n   * @type {Number}\n   */\n  _timer!: any;\n\n  /**\n   * This holds the last known validation error. We need to compare that with\n   * new errors and detect validation changes...\n   * @type {[type]}\n   */\n  /**\n   * This holds the last known validation error. We need to compare that with\n   * new errors and detect validation changes...\n   * @type {[type]}\n   */\n  _valid!: string;\n\n  _isStrict: boolean;\n  _ignoreValueChange!: boolean;\n  _isMounted!: boolean;\n  _inputFocus!: boolean;\n  // onTouchEnd: any;\n  refsWrapper: any;\n  refsInput: any;\n\n  /**\n   * The state of the component\n   * @type {Object}\n   */\n  state: NumericInputState;\n\n  /**\n   * The stop method (need to declare it here to use it in the constructor)\n   * @type {Function}\n   */\n  // stop: any;\n\n  /**\n   * Set the initial state and bind this.stop to the instance.\n   */\n  constructor(args: any) {\n    super(args);\n\n    this._isStrict = !!this.props.strict;\n\n    this.state = {\n      btnDownHover: false,\n      btnDownActive: false,\n      btnUpHover: false,\n      btnUpActive: false,\n      stringValue: \"\",\n      ...this._propsToState(this.props),\n    };\n    this.stop = this.stop.bind(this);\n    this.onTouchEnd = this.onTouchEnd.bind(this);\n    this.refsInput = null;\n    this.refsWrapper = null;\n  }\n\n  _propsToState(props) {\n    let out: NumericInputState = {};\n\n    if (props.hasOwnProperty(\"value\")) {\n      out.stringValue = String(\n        props.value || props.value === 0 ? props.value : \"\"\n      ).trim();\n\n      out.value = out.stringValue !== \"\" ? this._parse(props.value) : null;\n    } else if (!this._isMounted && props.hasOwnProperty(\"defaultValue\")) {\n      out.stringValue = String(\n        props.defaultValue || props.defaultValue === 0 ? props.defaultValue : \"\"\n      ).trim();\n\n      out.value =\n        props.defaultValue !== \"\" ? this._parse(props.defaultValue) : null;\n    }\n\n    return out;\n  }\n\n  /**\n   * Special care is taken for the \"value\" prop:\n   * - If not provided - set it to null\n   * - If the prop is a number - use it as is\n   * - Otherwise:\n   *     1. Convert it to string (falsy values become \"\")\n   *     2. Then trim it.\n   *     3. Then parse it to number (delegating to this.props.parse if any)\n   */\n  componentWillReceiveProps(props: NumericInputProps): void {\n    this._isStrict = !!props.strict;\n    let nextState = this._propsToState(props);\n    if (Object.keys(nextState).length) {\n      this._ignoreValueChange = true;\n      this.setState(nextState, () => {\n        this._ignoreValueChange = false;\n      });\n    }\n  }\n\n  /**\n   * Save the input selection right before rendering\n   */\n  componentWillUpdate(): void {\n    this.saveSelection();\n  }\n\n  /**\n   * After the component has been rendered into the DOM, do whatever is\n   * needed to \"reconnect\" it to the outer world, i.e. restore selection,\n   * call some of the callbacks, validate etc.\n   */\n  componentDidUpdate(\n    prevProps: NumericInputProps,\n    prevState: NumericInputProps\n  ): void {\n    // Call the onChange if needed. This is placed here because there are\n    // many reasons for changing the value and this is the common place\n    // that can capture them all\n\n    if (\n      !this._ignoreValueChange && // no onChange if re-rendered with different value prop\n      prevState.value !== this.state.value && // no onChange if the value remains the same\n      (!isNaN(this.state.value ?? Number.NaN) || this.state.value === null) // only if changing to number or null\n    ) {\n      this._invokeEventCallback(\n        \"onChange\",\n        this.state.value,\n        this.refsInput.value,\n        this.refsInput\n      );\n    }\n\n    // focus the input is needed (for example up/down buttons set\n    // this._inputFocus to true)\n    if (this._inputFocus) {\n      this.refsInput.focus();\n\n      // Restore selectionStart (if any)\n      if (this.state.selectionStart || this.state.selectionStart === 0) {\n        this.refsInput.selectionStart = this.state.selectionStart;\n      }\n\n      // Restore selectionEnd (if any)\n      if (this.state.selectionEnd || this.state.selectionEnd === 0) {\n        this.refsInput.selectionEnd = this.state.selectionEnd;\n      }\n    }\n\n    this.checkValidity();\n  }\n\n  /**\n   * This is used to clear the timer if any\n   */\n  componentWillUnmount(): void {\n    this._isMounted = false;\n    this.stop();\n  }\n\n  /**\n   * Adds getValueAsNumber and setValue methods to the input DOM element.\n   */\n  componentDidMount(): void {\n    this._isMounted = true;\n    this.refsInput.getValueAsNumber = () => this.state.value || 0;\n\n    this.refsInput.setValue = (value) => {\n      this.setState({\n        value: this._parse(value),\n        stringValue: value,\n      });\n    };\n\n    // This is a special case! If the component has the \"autoFocus\" prop\n    // and the browser did focus it we have to pass that to the onFocus\n    if (\n      !this._inputFocus &&\n      IS_BROWSER &&\n      document.activeElement === this.refsInput\n    ) {\n      this._inputFocus = true;\n      this.refsInput.focus();\n      this._invokeEventCallback(\"onFocus\", {\n        target: this.refsInput,\n        type: \"focus\",\n      });\n    }\n\n    this.checkValidity();\n  }\n\n  /**\n   * Saves the input selection in the state so that it can be restored after\n   * updates\n   */\n  saveSelection(): void {\n    this.state.selectionStart = this.refsInput.selectionStart;\n    this.state.selectionEnd = this.refsInput.selectionEnd;\n  }\n\n  /**\n   * Unless noValidate is set to true, the component will check the\n   * existing validation state (if any) and will toggle the \"has-error\"\n   * CSS class on the wrapper\n   */\n  checkValidity(): void {\n    let valid,\n      validationError = \"\";\n\n    let supportsValidation = !!this.refsInput.checkValidity;\n\n    // noValidate\n    let noValidate = !!(\n      this.props.noValidate && this.props.noValidate != \"false\"\n    );\n\n    this.refsInput.noValidate = noValidate;\n\n    // If \"noValidate\" is set or \"checkValidity\" is not supported then\n    // consider the element valid. Otherwise consider it invalid and\n    // make some additional checks below\n    valid = noValidate || !supportsValidation;\n\n    if (valid) {\n      validationError = \"\";\n    } else {\n      // In some browsers once a pattern is set it cannot be removed. The\n      // browser sets it to \"\" instead which results in validation\n      // failures...\n      if (this.refsInput.pattern === \"\") {\n        this.refsInput.pattern = this.props.required ? \".+\" : \".*\";\n      }\n\n      // Now check validity\n      if (supportsValidation) {\n        this.refsInput.checkValidity();\n        valid = this.refsInput.validity.valid;\n\n        if (!valid) {\n          validationError = this.refsInput.validationMessage;\n        }\n      }\n\n      // Some browsers might fail to validate maxLength\n      if (valid && supportsValidation && this.props.maxLength) {\n        if (this.refsInput.value.length > this.props.maxLength) {\n          validationError = \"This value is too long\";\n        }\n      }\n    }\n\n    validationError =\n      validationError ||\n      (valid ? \"\" : this.refsInput.validationMessage || \"Unknown Error\");\n\n    let validStateChanged = this._valid !== validationError;\n    this._valid = validationError;\n    if (validationError) {\n      addClass(this.refsWrapper, \"has-error\");\n      if (validStateChanged) {\n        this._invokeEventCallback(\n          \"onInvalid\",\n          validationError,\n          this.state.value,\n          this.refsInput.value\n        );\n      }\n    } else {\n      removeClass(this.refsWrapper, \"has-error\");\n      if (validStateChanged) {\n        this._invokeEventCallback(\n          \"onValid\",\n          this.state.value,\n          this.refsInput.value\n        );\n      }\n    }\n  }\n\n  /**\n   * Used internally to parse the argument x to it's numeric representation.\n   * If the argument cannot be converted to finite number returns 0; If a\n   * \"precision\" prop is specified uses it round the number with that\n   * precision (no fixed precision here because the return value is float, not\n   * string).\n   */\n  _toNumber(x: any): number {\n    let n = parseFloat(x);\n    if (isNaN(n) || !isFinite(n)) {\n      n = 0;\n    }\n\n    if (this._isStrict) {\n      let precision = access(this.props, \"precision\", null, this);\n      let q = Math.pow(10, precision === null ? 10 : precision);\n      let _min = +access(\n        this.props,\n        \"min\",\n        NumericInput.defaultProps.min,\n        this\n      );\n      let _max = +access(\n        this.props,\n        \"max\",\n        NumericInput.defaultProps.max,\n        this\n      );\n      n = Math.min(Math.max(n, _min), _max);\n      n = Math.round(n * q) / q;\n    }\n\n    return n;\n  }\n\n  /**\n   * This is used internally to parse any string into a number. It will\n   * delegate to this.props.parse function if one is provided. Otherwise it\n   * will just use parseFloat.\n   * @private\n   */\n  _parse(x: string): number {\n    x = String(x);\n    if (typeof this.props.parse == \"function\") {\n      return parseFloat(this.props.parse(x));\n    }\n    return parseFloat(x);\n  }\n\n  /**\n   * This is used internally to format a number to it's display representation.\n   * It will invoke the this.props.format function if one is provided.\n   * @private\n   */\n  _format(n: number): string {\n    let _n: string = this._toNumber(n).toString();\n    let precision = access(this.props, \"precision\", null, this);\n    if (precision !== null) {\n      _n = n.toFixed(precision);\n    }\n\n    _n += \"\";\n\n    if (this.props.format) {\n      return this.props.format(_n);\n    }\n\n    return _n;\n  }\n\n  /**\n   * The internal method that actually sets the new value on the input\n   * @private\n   */\n  _step(n: number, callback?: any): boolean {\n    let _isStrict = this._isStrict;\n    this._isStrict = true;\n\n    let _step = +access(\n      this.props,\n      \"step\",\n      NumericInput.defaultProps.step,\n      this,\n      n > 0 ? NumericInput.DIRECTION_UP : NumericInput.DIRECTION_DOWN\n    );\n\n    let _n = this._toNumber((this.state.value || 0) + _step * n);\n\n    if (this.props.snap) {\n      _n = Math.round(_n / _step) * _step;\n    }\n\n    this._isStrict = _isStrict;\n\n    if (_n !== this.state.value) {\n      this.setState({ value: _n, stringValue: _n + \"\" }, callback);\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * This binds the Up/Down arrow key listeners\n   */\n  _onKeyDown(...args: Array<any>): void {\n    args[0].persist();\n    this._invokeEventCallback(\"onKeyDown\", ...args);\n    let e = args[0];\n    if (!e.isDefaultPrevented()) {\n      if (e.keyCode === KEYCODE_UP) {\n        e.preventDefault();\n        this._step(e.ctrlKey || e.metaKey ? 0.1 : e.shiftKey ? 10 : 1);\n      } else if (e.keyCode === KEYCODE_DOWN) {\n        e.preventDefault();\n        this._step(e.ctrlKey || e.metaKey ? -0.1 : e.shiftKey ? -10 : -1);\n      } else {\n        let value = this.refsInput.value,\n          length = value.length;\n        if (e.keyCode === 8) {\n          // backspace\n          if (\n            this.refsInput.selectionStart == this.refsInput.selectionEnd &&\n            this.refsInput.selectionEnd > 0 &&\n            value.length &&\n            value.charAt(this.refsInput.selectionEnd - 1) === \".\"\n          ) {\n            e.preventDefault();\n            this.refsInput.selectionStart = this.refsInput.selectionEnd =\n              this.refsInput.selectionEnd - 1;\n          }\n        } else if (e.keyCode === 46) {\n          // delete\n          if (\n            this.refsInput.selectionStart == this.refsInput.selectionEnd &&\n            this.refsInput.selectionEnd < length + 1 &&\n            value.length &&\n            value.charAt(this.refsInput.selectionEnd) === \".\"\n          ) {\n            e.preventDefault();\n            this.refsInput.selectionStart = this.refsInput.selectionEnd =\n              this.refsInput.selectionEnd + 1;\n          }\n        } else if (e.keyCode === 46) {\n          // @TODO: doda obsuge klikniecia enter\n        }\n      }\n    }\n  }\n\n  /**\n   * Stops the widget from auto-changing by clearing the timer (if any)\n   */\n  stop(): void {\n    if (this._timer) {\n      clearTimeout(this._timer);\n    }\n  }\n\n  /**\n   * Increments the value with one step and the enters a recursive calls\n   * after DELAY. This is bound to the mousedown event on the \"up\" button\n   * and will be stopped on mouseout/mouseup.\n   * @param {Boolean} _recursive The method is passing this to itself while\n   *  it is in recursive mode.\n   * @return void\n   */\n  increase(_recursive: boolean = false, callback?: Function): void {\n    this.stop();\n    this._step(1, callback);\n    let _max = +access(this.props, \"max\", NumericInput.defaultProps.max, this);\n    if (\n      isNaN(this.state.value ?? Number.NaN) ||\n      +(this.state.value ?? Number.NaN) < _max\n    ) {\n      this._timer = setTimeout(\n        () => {\n          this.increase(true);\n        },\n        _recursive ? NumericInput.SPEED : NumericInput.DELAY\n      );\n    }\n  }\n\n  /**\n   * Decrements the value with one step and the enters a recursive calls\n   * after DELAY. This is bound to the mousedown event on the \"down\" button\n   * and will be stopped on mouseout/mouseup.\n   * @param {Boolean} _recursive The method is passing this to itself while\n   *  it is in recursive mode.\n   * @return void\n   */\n  decrease(_recursive: boolean = false, callback?: Function): void {\n    this.stop();\n    this._step(-1, callback);\n    let _min = +access(this.props, \"min\", NumericInput.defaultProps.min, this);\n    if (\n      isNaN(this.state.value ?? Number.NaN) ||\n      +(this.state.value ?? Number.NaN) > _min\n    ) {\n      this._timer = setTimeout(\n        () => {\n          this.decrease(true);\n        },\n        _recursive ? NumericInput.SPEED : NumericInput.DELAY\n      );\n    }\n  }\n\n  /**\n   * Handles the mousedown event on the up/down buttons. Changes The\n   * internal value and sets up a delay for auto increment/decrement\n   * (until mouseup or mouseleave)\n   */\n  onMouseDown(dir: \"up\" | \"down\", callback?: Function): void {\n    if (dir == \"down\") {\n      this.decrease(false, callback);\n    } else if (dir == \"up\") {\n      this.increase(false, callback);\n    }\n  }\n\n  /**\n   * Handles the touchstart event on the up/down buttons. Changes The\n   * internal value and DOES NOT sets up a delay for auto increment/decrement.\n   * Note that this calls e.preventDefault() so the event is not used for\n   * creating a virtual mousedown after it\n   */\n  onTouchStart(dir: \"up\" | \"down\", e: Event): void {\n    e.preventDefault();\n    if (dir == \"down\") {\n      this.decrease();\n    } else if (dir == \"up\") {\n      this.increase();\n    }\n  }\n\n  onTouchEnd(e: Event): void {\n    e.preventDefault();\n    this.stop();\n  }\n\n  /**\n   * Helper method to invoke event callback functions if they are provided\n   * in the props.\n   * @param {String} callbackName The name of the function prop\n   * @param {*[]} args Any additional argument are passed thru\n   */\n  _invokeEventCallback(callbackName: string, ...args: Array<any>): void {\n    if (typeof this.props[callbackName] == \"function\") {\n      this.props[callbackName].call(null, ...args);\n    }\n  }\n\n  /**\n   * Renders an input wrapped in relative span and up/down buttons\n   * @return {Component}\n   */\n  render() {\n    let props = this.props;\n    let state = this.state;\n    let css: any = {};\n\n    let {\n      // These are ignored in rendering\n      step,\n      min,\n      max,\n      precision,\n      parse,\n      format,\n      mobile,\n      snap,\n      componentClass,\n      value,\n      type,\n      style,\n      defaultValue,\n      onInvalid,\n      onValid,\n      strict,\n      noStyle,\n\n      // The rest are passed to the input\n      ...rest\n    } = this.props;\n\n    noStyle = noStyle || style === false;\n\n    // Build the styles\n    for (let x in NumericInput.style) {\n      css[x] = Object.assign(\n        {},\n        NumericInput.style[x],\n        style ? style[x] || {} : {}\n      );\n    }\n\n    let hasFormControl =\n      props.className && /\\bform-control\\b/.test(props.className);\n\n    if (mobile == \"auto\") {\n      mobile = IS_BROWSER && \"ontouchstart\" in document;\n    }\n\n    if (typeof mobile == \"function\") {\n      mobile = mobile.call(this);\n    }\n    mobile = !!mobile;\n\n    let attrs = {\n      wrap: {\n        style: noStyle ? null : css.wrap,\n        className: \"react-numeric-input\",\n        ref: (e) => {\n          if (e != null && e != undefined) {\n            this.refsWrapper = e;\n          }\n        },\n        onMouseUp: undefined,\n        onMouseLeave: undefined,\n      },\n      input: {\n        ref: (e) => {\n          if (e != null && e != undefined) {\n            this.refsInput = e;\n          }\n        },\n        type: \"text\",\n        style: noStyle\n          ? null\n          : Object.assign(\n              {},\n              css.input,\n              !hasFormControl ? css[\"input:not(.form-control)\"] : {},\n              this._inputFocus ? css[\"input:focus\"] : {}\n            ),\n        ...rest,\n      },\n      btnUp: {\n        onMouseEnter: undefined,\n        onMouseDown: undefined,\n        onMouseUp: undefined,\n        onMouseLeave: undefined,\n        onTouchStart: undefined,\n        onTouchEnd: undefined,\n        style: noStyle\n          ? null\n          : Object.assign(\n              {},\n              css.btn,\n              css.btnUp,\n              props.disabled || props.readOnly\n                ? css[\"btn:disabled\"]\n                : state.btnUpActive\n                ? css[\"btn:active\"]\n                : state.btnUpHover\n                ? css[\"btn:hover\"]\n                : {}\n            ),\n      },\n      btnDown: {\n        onMouseEnter: undefined,\n        onMouseDown: undefined,\n        onMouseUp: undefined,\n        onMouseLeave: undefined,\n        onTouchStart: undefined,\n        onTouchEnd: undefined,\n        style: noStyle\n          ? null\n          : Object.assign(\n              {},\n              css.btn,\n              css.btnDown,\n              props.disabled || props.readOnly\n                ? css[\"btn:disabled\"]\n                : state.btnDownActive\n                ? css[\"btn:active\"]\n                : state.btnDownHover\n                ? css[\"btn:hover\"]\n                : {}\n            ),\n      },\n    };\n\n    let stringValue = String(\n      // if state.stringValue is set and not empty\n      state.stringValue ||\n        // else if state.value is set and not null|undefined\n        (state.value || state.value === 0 ? state.value : \"\") ||\n        // or finally use \"\"\n        \"\"\n    );\n\n    let loose = !this._isStrict && (this._inputFocus || !this._isMounted);\n\n    // incomplete number\n    if (loose && RE_INCOMPLETE_NUMBER.test(stringValue)) {\n      (attrs.input as any).value = stringValue;\n    }\n\n    // Not a number and not empty (loose mode only)\n    else if (loose && stringValue && !RE_NUMBER.test(stringValue)) {\n      (attrs.input as any).value = stringValue;\n    }\n\n    // number\n    else if (state.value || state.value === 0) {\n      (attrs.input as any).value = this._format(state.value);\n    }\n\n    // empty\n    else {\n      (attrs.input as any).value = \"\";\n    }\n\n    if (hasFormControl && !noStyle) {\n      Object.assign(attrs.wrap.style, css[\"wrap.hasFormControl\"]);\n    }\n\n    // mobile\n    if (mobile && !noStyle) {\n      Object.assign(attrs.input.style, css[\"input.mobile\"]);\n      Object.assign(attrs.btnUp.style, css[\"btnUp.mobile\"]);\n      Object.assign(attrs.btnDown.style, css[\"btnDown.mobile\"]);\n    }\n\n    // Attach event listeners if the widget is not disabled\n    if (!props.disabled && !props.readOnly) {\n      Object.assign(attrs.wrap, {\n        onMouseUp: this.stop,\n        onMouseLeave: this.stop,\n      });\n\n      Object.assign(attrs.btnUp, {\n        onTouchStart: this.onTouchStart.bind(this, \"up\"),\n        onTouchEnd: this.onTouchEnd,\n        onMouseEnter: () => {\n          this.setState({\n            btnUpHover: true,\n          });\n        },\n        onMouseLeave: () => {\n          this.stop();\n          this.setState({\n            btnUpHover: false,\n            btnUpActive: false,\n          });\n        },\n        onMouseUp: () => {\n          this.setState({\n            btnUpHover: true,\n            btnUpActive: false,\n          });\n        },\n        onMouseDown: (...args) => {\n          args[0].preventDefault();\n          args[0].persist();\n          this._inputFocus = true;\n          this.setState(\n            {\n              btnUpHover: true,\n              btnUpActive: true,\n            },\n            () => {\n              this._invokeEventCallback(\"onFocus\", ...args);\n              this.onMouseDown(\"up\");\n            }\n          );\n        },\n      });\n\n      Object.assign(attrs.btnDown, {\n        onTouchStart: this.onTouchStart.bind(this, \"down\"),\n        onTouchEnd: this.onTouchEnd,\n        onMouseEnter: () => {\n          this.setState({\n            btnDownHover: true,\n          });\n        },\n        onMouseLeave: () => {\n          this.stop();\n          this.setState({\n            btnDownHover: false,\n            btnDownActive: false,\n          });\n        },\n        onMouseUp: () => {\n          this.setState({\n            btnDownHover: true,\n            btnDownActive: false,\n          });\n        },\n        onMouseDown: (...args) => {\n          args[0].preventDefault();\n          args[0].persist();\n          this._inputFocus = true;\n          this.setState(\n            {\n              btnDownHover: true,\n              btnDownActive: true,\n            },\n            () => {\n              this._invokeEventCallback(\"onFocus\", ...args);\n              this.onMouseDown(\"down\");\n            }\n          );\n        },\n      });\n\n      Object.assign(attrs.input, {\n        onChange: (e) => {\n          const original = e.target.value;\n          let val: number | null = this._parse(original);\n          if (isNaN(val)) {\n            val = null;\n          }\n          this.setState({\n            value: this._isStrict ? this._toNumber(val) : val,\n            stringValue: original,\n          });\n        },\n        onKeyDown: this._onKeyDown.bind(this),\n        onInput: (...args) => {\n          this.saveSelection();\n          this._invokeEventCallback(\"onInput\", ...args);\n        },\n        onSelect: (...args) => {\n          this.saveSelection();\n          this._invokeEventCallback(\"onSelect\", ...args);\n        },\n        onFocus: (...args) => {\n          args[0].persist();\n          this._inputFocus = true;\n          const val = this._parse(args[0].target.value);\n          this.setState(\n            {\n              value: val,\n              stringValue: val || val === 0 ? val + \"\" : \"\",\n            },\n            () => {\n              this._invokeEventCallback(\"onFocus\", ...args);\n            }\n          );\n        },\n        onBlur: (...args) => {\n          let _isStrict = this._isStrict;\n          this._isStrict = true;\n          args[0].persist();\n          this._inputFocus = false;\n          const val = this._parse(args[0].target.value);\n          this.setState(\n            {\n              value: val,\n            },\n            () => {\n              this._invokeEventCallback(\"onBlur\", ...args);\n              this._isStrict = _isStrict;\n            }\n          );\n        },\n      });\n    } else {\n      if (!noStyle && props.disabled) {\n        Object.assign(attrs.input.style, css[\"input:disabled\"]);\n      }\n    }\n\n    const InputTag = componentClass || \"input\";\n\n    if (mobile) {\n      return (\n        <span {...attrs.wrap}>\n          <InputTag {...attrs.input} />\n          <b {...attrs.btnUp}>\n            <i style={noStyle ? null : css.minus} />\n            <i style={noStyle ? null : css.plus} />\n          </b>\n          <b {...attrs.btnDown}>\n            <i style={noStyle ? null : css.minus} />\n          </b>\n        </span>\n      );\n    }\n\n    return (\n      <span {...attrs.wrap}>\n        <InputTag {...attrs.input} />\n        <b {...attrs.btnUp}>\n          <i style={noStyle ? null : css.arrowUp} />\n        </b>\n        <b {...attrs.btnDown}>\n          <i style={noStyle ? null : css.arrowDown} />\n        </b>\n      </span>\n    );\n  }\n}\n","import {\n  faAlignCenter,\n  faAlignLeft,\n  faAlignRight,\n  faCheck,\n  faCircle,\n  faExclamationCircle,\n  faExclamationTriangle,\n  faGripHorizontal,\n  faPlay,\n  faSquare,\n  faSquareFull,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React from \"react\";\nimport { ColorResult, SwatchesPicker } from \"react-color\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport {\n  AppEvents,\n  AppEventType,\n  ChangeObject,\n  ChangeObjectsProperty,\n  ChangeSelectedObjectsAlignment,\n  ChangeUiSettings,\n  ClipboardCopy,\n  DuplicateObjects,\n  RemoveObjects,\n  SnapToLineType,\n} from \"../../controllers/AppEventType\";\nimport { getStore, setStore } from \"../../controllers/store\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport {\n  Editor,\n  Bead,\n  RegionShape,\n  Region,\n  BeadTypes,\n  BeadMaterialTypes,\n  ObjectTypes,\n  RegionGridType,\n} from \"../../editorObjects/Editor\";\nimport { ActionsTypes } from \"./ActionsTypes\";\nimport { NumericInput } from \"./NumericInput\";\nimport Slider from \"rc-slider\";\nimport \"rc-slider/assets/index.css\";\nimport { ChangeObjectsAlignmentHandler } from \"../../controllers/EventHandlers/ChangeObjectsAlignmentHandler\";\nimport { produce } from \"immer\";\nimport { refreshReactState } from \"../../controllers/refreshReactState\";\nimport { cloneDeep } from \"lodash\";\nimport { buildBead } from \"../../editorObjects/Bead\";\nimport { thumbnailsGenerator } from \"../../threejs/thumbnailsGenerator\";\nimport { getBricksColumnsAndRowsCount } from \"../../editorObjects/Region\";\n\nconst createSliderWithTooltip = Slider.createSliderWithTooltip;\nconst SliderPlus = createSliderWithTooltip(Slider);\n\nexport const PopupWrapper: React.FC<{\n  offsetLeft: number;\n  type: ActionsTypes;\n}> = (props) => {\n  let leftOffset = props.offsetLeft;\n  if (\n    props.type === ActionsTypes.EditRotate ||\n    props.type === ActionsTypes.EditPosition\n  ) {\n    leftOffset = props.offsetLeft - 150;\n  }\n  if (\n    props.type === ActionsTypes.EditWidthHeight ||\n    props.type === ActionsTypes.EditWidthHeightDepth\n  ) {\n    leftOffset = props.offsetLeft - 250;\n  }\n  return (\n    <PopupWrapperStyles>\n      <div\n        className={\"popup-wrapper\"}\n        style={{\n          left: leftOffset,\n        }}\n      >\n        {props.type === ActionsTypes.EditBeadColor ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadColorPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.More ? (\n          <div className={\"popup-wrapper-content\"}>\n            <MorePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRegionShape ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRegionShapePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRegionGridType ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRegionGridTypePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRegionGridSettings ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRegionGridSettingsPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditPosition ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditPositionPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditRotate ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditRotatePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditWidthHeight ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditWidthHeightPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditWidthHeightDepth ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditWidthHeightDepthPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.Alignment ? (\n          <div className={\"popup-wrapper-content\"}>\n            <AlignmentPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditBeadType ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadTypePopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditBeadProduct ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadProductPopup />\n          </div>\n        ) : null}\n\n        {props.type === ActionsTypes.EditBeadMaterial ? (\n          <div className={\"popup-wrapper-content\"}>\n            <EditBeadMaterialPopup />\n          </div>\n        ) : null}\n\n        {/* @TODO: REFACTOR THAT */}\n        {!(\n          props.type === ActionsTypes.More ||\n          props.type === ActionsTypes.EditRegionGridType ||\n          props.type === ActionsTypes.EditPosition ||\n          props.type === ActionsTypes.EditRotate ||\n          props.type === ActionsTypes.EditWidthHeight ||\n          props.type === ActionsTypes.EditWidthHeightDepth ||\n          props.type === ActionsTypes.Alignment ||\n          props.type === ActionsTypes.EditRegionGridSettings ||\n          props.type === ActionsTypes.EditRegionShape ||\n          props.type === ActionsTypes.EditBeadType ||\n          props.type === ActionsTypes.EditBeadProduct ||\n          props.type === ActionsTypes.EditBeadMaterial ||\n          props.type === ActionsTypes.EditBeadColor\n        ) ? (\n          <div className={\"popup-wrapper-content\"}>\n            <div>popup of type: {props.type}</div>\n          </div>\n        ) : null}\n      </div>\n    </PopupWrapperStyles>\n  );\n};\n\nexport const PopupWrapperStyles = styled.div`\n  .popup-wrapper {\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    background: #fff;\n    transform: translate(-50%, 0);\n    margin-top: 8px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    padding: var(--standardPadding);\n  }\n  .region-type-selection {\n    display: flex;\n    column-gap: var(--standardPadding);\n  }\n  .region-type-item {\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n    &.active {\n      background: rgba(0, 0, 0, 0.1);\n    }\n    svg path {\n      transition: all 0.4s ease-in-out;\n    }\n    &:hover {\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .columns-input {\n    width: 120px;\n  }\n  .fieldset-wrapper fieldset {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    column-gap: var(--standardPadding);\n  }\n  .region-grid-settings {\n    display: flex;\n    flex-direction: column;\n    row-gap: var(--standardPadding);\n  }\n`;\n\nconst EditBeadColorPopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const backgroundColors = useSelector((state: Editor) => {\n    const colors: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const color = (state.objects[id] as Bead).color;\n      if (colors.includes(color) === false) {\n        colors.push(color);\n      }\n    });\n    return colors;\n  });\n\n  const onSelectColor = (color: ColorResult) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              color: color.hex,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <div>\n      <SwatchesPicker\n        width={300}\n        height={300}\n        onChangeComplete={onSelectColor}\n        color={backgroundColors.length > 1 ? undefined : backgroundColors[0]}\n      />\n    </div>\n  );\n};\n\nconst EditBeadTypePopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const types = useSelector((state: Editor) => {\n    const types: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const type = (state.objects[id] as Bead).type;\n      if (types.includes(type) === false) {\n        types.push(type);\n      }\n    });\n    return types;\n  });\n\n  const onSelect = (type: BeadTypes) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              type,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(BeadTypes.TOHO_MIYUKI);\n  };\n  const onSelectCircle = () => {\n    onSelect(BeadTypes.TOHO_SPHERE);\n  };\n  const onSelectTriangle = () => {\n    onSelect(BeadTypes.TOHO_15);\n  };\n  return (\n    <div style={{ display: \"flex\" }}>\n      <div\n        onClick={onSelectRectange}\n        className={`region-type-item ${\n          types.length === 1 && types[0] === BeadTypes.TOHO_MIYUKI\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        <FontAwesomeIcon icon={faSquareFull} />\n      </div>\n      <div\n        onClick={onSelectCircle}\n        className={`region-type-item ${\n          types.length === 1 && types[0] === BeadTypes.TOHO_SPHERE\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        <FontAwesomeIcon icon={faCircle} />\n      </div>\n      <div\n        onClick={onSelectTriangle}\n        className={`region-type-item ${\n          types.length === 1 && types[0] === BeadTypes.TOHO_15 ? \"active\" : \"\"\n        }`}\n      >\n        <FontAwesomeIcon icon={faSquare} />\n      </div>\n    </div>\n  );\n};\n\nconst EditBeadProductPopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const types = useSelector((state: Editor) => {\n    const types: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const type = (state.objects[id] as Bead).type;\n      if (types.includes(type) === false) {\n        types.push(type);\n      }\n    });\n    return types;\n  });\n  const onSelect = (type: BeadTypes) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              type,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(BeadTypes.TOHO_MIYUKI);\n  };\n  const onSelectCircle = () => {\n    onSelect(BeadTypes.TOHO_SPHERE);\n  };\n  const onSelectTriangle = () => {\n    onSelect(BeadTypes.TOHO_15);\n  };\n  const onSelectMore = () => {\n    const store = getStore();\n    const modalSearchProducts = cloneDeep(store.ui.modalSearchProducts);\n    modalSearchProducts.isOpen = true;\n    modalSearchProducts.successAction = \"updateBeadType\";\n    const event: ChangeUiSettings = {\n      name: AppEventType.ChangeUiSettings,\n      payload: {\n        uiSettings: {\n          modalSearchProducts,\n        },\n      },\n    };\n    sendEvent(event);\n  };\n  const bead1 = buildBead({ type: BeadTypes.TOHO_MIYUKI });\n  const bead2 = buildBead({ type: BeadTypes.TOHO_SPHERE });\n  const bead3 = buildBead({ type: BeadTypes.TOHO_15 });\n  // @TODO: doda ostatnio wybrane produkty do popup\n  return (\n    <div style={{ display: \"flex\", flexDirection: \"column\" }}>\n      <div style={{ display: \"flex\" }}>\n        <div\n          onClick={onSelectRectange}\n          className={`region-type-item ${\n            types.length === 1 && types[0] === BeadTypes.TOHO_MIYUKI\n              ? \"active\"\n              : \"\"\n          }`}\n        >\n          <img src={thumbnailsGenerator.getObjectThumbnail(bead1, 30, 30)} />\n        </div>\n        <div\n          onClick={onSelectCircle}\n          className={`region-type-item ${\n            types.length === 1 && types[0] === BeadTypes.TOHO_SPHERE\n              ? \"active\"\n              : \"\"\n          }`}\n        >\n          <img src={thumbnailsGenerator.getObjectThumbnail(bead2, 30, 30)} />\n        </div>\n        <div\n          onClick={onSelectTriangle}\n          className={`region-type-item ${\n            types.length === 1 && types[0] === BeadTypes.TOHO_15 ? \"active\" : \"\"\n          }`}\n        >\n          <img src={thumbnailsGenerator.getObjectThumbnail(bead3, 30, 30)} />\n        </div>\n      </div>\n\n      <div onClick={onSelectMore} style={{ cursor: \"pointer\" }}>\n        {/* @TRANS */}\n        Show all Products\n      </div>\n    </div>\n  );\n};\n\nconst EditBeadMaterialPopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const materialTypes = useSelector((state: Editor) => {\n    const types: string[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const type = (state.objects[id] as Bead).material;\n      if (types.includes(type) === false) {\n        types.push(type);\n      }\n    });\n    return types;\n  });\n\n  const onSelect = (material: BeadMaterialTypes) => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const change: ChangeObject = {\n            id,\n            properties: {\n              material,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(BeadMaterialTypes.Mat);\n  };\n  const onSelectCircle = () => {\n    onSelect(BeadMaterialTypes.Shiny);\n  };\n  return (\n    <div\n      style={{\n        width: 100,\n        display: \"flex\",\n        flexDirection: \"column\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n      }}\n    >\n      <div\n        onClick={onSelectRectange}\n        className={`region-type-item ${\n          materialTypes.length === 1 &&\n          materialTypes[0] === BeadMaterialTypes.Mat\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        {/* @TRANS */}\n        Mat\n      </div>\n      <div\n        onClick={onSelectCircle}\n        className={`region-type-item ${\n          materialTypes.length === 1 &&\n          materialTypes[0] === BeadMaterialTypes.Shiny\n            ? \"active\"\n            : \"\"\n        }`}\n      >\n        {/* @TRANS */}\n        Shine\n      </div>\n    </div>\n  );\n};\n\nconst EditRegionGridTypePopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n\n  const onSelect = (gridType: RegionGridType) => {\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const region = store.objects[id] as Region;\n          const properties: ChangeObject[\"properties\"] = {\n            gridType,\n            shape: region.shape,\n            columns: region.columns,\n            rows: region.rows,\n          };\n          const columnsKey: keyof Region = \"columns\";\n          const rowsKey: keyof Region = \"rows\";\n          if (\n            gridType === RegionGridType.Bricks &&\n            region.shape === RegionShape.Triangle\n          ) {\n            const cols = (store.objects[id] as Region).columns;\n            const { columns, rows } = getBricksColumnsAndRowsCount(cols);\n            properties[columnsKey] = columns;\n            properties[rowsKey] = rows;\n          }\n          const change: ChangeObject = {\n            id,\n            properties,\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRect = () => {\n    onSelect(RegionGridType.Rectangles);\n  };\n  const onSelectBricks = () => {\n    onSelect(RegionGridType.Bricks);\n  };\n  return (\n    <div className={\"region-type-selection\"}>\n      <div onClick={onSelectRect} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faGripHorizontal} />\n      </div>\n      <div onClick={onSelectBricks} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faAlignCenter} />\n      </div>\n    </div>\n  );\n};\n\nconst EditRegionShapePopup: React.FC<{}> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n\n  const onSelect = (shape: RegionShape) => {\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: selectedIds.map((id) => {\n          const region = store.objects[id] as Region;\n          const columnsKey: keyof Region = \"columns\";\n          const rowsKey: keyof Region = \"rows\";\n          const properties: ChangeObject[\"properties\"] = {\n            shape: shape,\n            gridType: region.gridType,\n            columns: region.columns,\n            rows: region.rows,\n          };\n          if (\n            region.gridType === RegionGridType.Bricks &&\n            shape === RegionShape.Triangle\n          ) {\n            const cols = (store.objects[id] as Region).columns;\n            const { columns, rows } = getBricksColumnsAndRowsCount(cols);\n            properties[columnsKey] = columns;\n            properties[rowsKey] = rows;\n          }\n          const change: ChangeObject = {\n            id,\n            properties,\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onSelectRectange = () => {\n    onSelect(RegionShape.Rectangle);\n  };\n  // @TODO: doda kolejne ksztaty takie jak koo czy trojkt\n  //   const onSelectCircle = () => {\n  //     onSelect(RegionShape.Circle);\n  //   };\n  const onSelectTriangle = () => {\n    onSelect(RegionShape.Triangle);\n  };\n  return (\n    <div className={\"region-type-selection\"}>\n      <div onClick={onSelectRectange} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faSquare} />\n      </div>\n      {/* <div onClick={onSelectCircle} className={\"region-type-item\"}>\n        <FontAwesomeIcon icon={faCircle} />\n      </div> */}\n      <div onClick={onSelectTriangle} className={\"region-type-item\"}>\n        <FontAwesomeIcon\n          icon={faPlay}\n          style={{ transform: \"rotate(-90deg)\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst EditRegionGridSettingsPopup: React.FC<{}> = () => {\n  const { columns, rows, showRows } = useSelector((state: Editor) => {\n    const columns: number[] = [];\n    const rows: number[] = [];\n    let onlyBricks: boolean = true;\n    let onlyShapeTriange: boolean = true;\n    state.selectedIds.forEach((id) => {\n      if (state.objects[id] === undefined) {\n        return;\n      }\n      if (state.objects[id].objectType !== ObjectTypes.Region) {\n        onlyBricks = false;\n        onlyShapeTriange = false;\n        return;\n      }\n      if ((state.objects[id] as Region).gridType !== RegionGridType.Bricks) {\n        onlyBricks = false;\n      }\n\n      if ((state.objects[id] as Region).shape !== RegionShape.Triangle) {\n        onlyShapeTriange = false;\n      }\n\n      const _columns = (state.objects[id] as Region).columns;\n      const _rows = (state.objects[id] as Region).rows;\n      if (columns.includes(_columns) === false) {\n        columns.push(_columns);\n      }\n      if (rows.includes(_rows) === false) {\n        rows.push(_rows);\n      }\n    });\n    return {\n      columns,\n      rows,\n      showRows: !(\n        (onlyBricks as boolean) === true &&\n        (onlyShapeTriange as boolean) === true\n      ),\n    };\n  });\n\n  const onChangeRows = (values: number) => {\n    if (values === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const region = store.objects[id] as Region;\n          const change: ChangeObject = {\n            id,\n            properties: {\n              shape: region.shape,\n              gridType: region.gridType,\n              columns: region.columns,\n              rows: values,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeColumns = (values: number) => {\n    if (values === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const region = store.objects[id] as Region;\n          const properties: ChangeObject[\"properties\"] = {\n            columns: values,\n            rows: region.rows,\n            shape: region.shape,\n            gridType: region.gridType,\n          };\n          if (showRows === false) {\n            const columnsKey: keyof Region = \"columns\";\n            const rowsKey: keyof Region = \"rows\";\n            const { columns, rows } = getBricksColumnsAndRowsCount(values);\n            properties[columnsKey] = columns;\n            properties[rowsKey] = rows;\n          }\n          const change: ChangeObject = {\n            id,\n            properties,\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div className={\"region-grid-settings\"}>\n      <div className={\"region-grid-settings-columns\"}>\n        <InputTypeNumber\n          defaultValue={columns.length > 1 ? undefined : columns[0]}\n          max={20}\n          min={1}\n          step={1}\n          showDecimal={false}\n          // @trans\n          label={\"Columns: \"}\n          onChange={onChangeColumns}\n        />\n      </div>\n      {showRows ? (\n        <div className={\"region-grid-settings-rows\"}>\n          <InputTypeNumber\n            max={20}\n            min={1}\n            step={1}\n            defaultValue={rows.length > 1 ? undefined : rows[0]}\n            showDecimal={false}\n            // @trans\n            label={\"Rows: \"}\n            onChange={onChangeRows}\n          />\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nconst InputTypeNumber: React.FC<{\n  defaultValue: number | undefined;\n  label: string;\n  onChange: (values: number) => void;\n  min: number;\n  max: number;\n  step: number;\n  showDecimal: boolean;\n}> = (props) => {\n  function roundTo(n) {\n    var negative = false;\n    var digits = 2;\n    if (n < 0) {\n      negative = true;\n      n = n * -1;\n    }\n    var multiplicator = Math.pow(10, digits);\n    n = parseFloat((n * multiplicator).toFixed(11));\n    n = (Math.round(n) / multiplicator).toFixed(digits);\n    if (negative) {\n      n = (n * -1).toFixed(digits);\n    }\n    return n;\n  }\n\n  return (\n    <div>\n      <div className={\"fieldset-wrapper\"}>\n        <fieldset>\n          <label>{props.label}</label>\n          <NumericInput\n            min={props.min}\n            max={props.max}\n            step={props.step}\n            className={\"columns-input\"}\n            value={props.defaultValue}\n            strict={true}\n            onChange={props.onChange}\n            mobile={true}\n            format={props.showDecimal ? roundTo : undefined}\n            // parse={roundTo}\n          />\n        </fieldset>\n      </div>\n    </div>\n  );\n};\n\nconst EditPositionPopup: React.FC<{}> = (props) => {\n  const { x, y, z } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    const result_z: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _x = state.objects[id].position.x;\n      const _y = state.objects[id].position.y;\n      const _z = state.objects[id].position.z;\n      if (result_x.includes(_x) === false) {\n        result_x.push(_x);\n      }\n      if (result_y.includes(_y) === false) {\n        result_y.push(_y);\n      }\n      if (result_z.includes(_z) === false) {\n        result_z.push(_z);\n      }\n    });\n    return {\n      x: result_x,\n      y: result_y,\n      z: result_z,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const object = store.objects[id];\n          const change: ChangeObject = {\n            id,\n            properties: {\n              position: {\n                x: newValue,\n                y: object.position.y,\n                z: object.position.z,\n              },\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const object = store.objects[id];\n          const change: ChangeObject = {\n            id,\n            properties: {\n              position: {\n                x: object.position.x,\n                y: newValue,\n                z: object.position.z,\n              },\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  // const onChangeZ = (newValue: number) => {\n  //   if (newValue === undefined) {\n  //     return;\n  //   }\n  //   const store = getStore();\n  //   const event: ChangeObjectsProperty = {\n  //     name: AppEventType.ChangeObjectsProperty,\n  //     payload: {\n  //       changes: store.selectedIds.map((id) => {\n  //         if (!store.objects[id]) {\n  //           return {\n  //             id,\n  //             properties: {},\n  //           };\n  //         }\n  //         const object = store.objects[id];\n  //         const change: ChangeObject = {\n  //           id,\n  //           properties: {\n  //             position: {\n  //               x: object.position.x,\n  //               y: object.position.y,\n  //               z: newValue,\n  //             },\n  //           },\n  //         };\n  //         return change;\n  //       }),\n  //     },\n  //   };\n  //   sendEvent(event);\n  // };\n  return (\n    <div>\n      <span>Position: </span>\n      <br />\n      <InputTypeNumber\n        defaultValue={x.length > 1 ? undefined : x[0]}\n        min={-1000}\n        max={1000}\n        showDecimal={false}\n        step={0.1}\n        // @trans\n        label={\"X: \"}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={x.length > 1 ? 0 : x[0]}\n        onChange={onChangeX}\n        min={-1000}\n        max={1000}\n      />\n      <InputTypeNumber\n        defaultValue={y.length > 1 ? undefined : y[0]}\n        min={-1000}\n        max={1000}\n        showDecimal={false}\n        step={0.1}\n        // @trans\n        label={\"Y: \"}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={y.length > 1 ? 0 : y[0]}\n        onChange={onChangeY}\n        min={-1000}\n        max={1000}\n      />\n      {/* @TODO: doda obsluge zmiany position z */}\n      {/* <InputTypeNumber\n        defaultValue={z.length > 1 ? undefined : z[0]}\n        min={-500}\n        max={500}\n        // @trans\n        label={\"Z: \"}\n        onChange={onChangeZ}\n      />\n      <SliderWrapper value={z.length > 1 ? 0 : z[0]} onChange={onChangeZ}\n        min={-1000}\n        max={1000} /> */}\n    </div>\n  );\n};\n\nconst SliderWrapper: React.FC<{\n  value: number;\n  onChange: any;\n  min: number;\n  max: number;\n}> = (props) => {\n  const [value, setValue] = React.useState<number>(props.value);\n  return (\n    <div style={{ marginBottom: 8, marginTop: 8 }}>\n      <SliderPlus\n        step={1}\n        min={props.min}\n        max={props.max}\n        value={value}\n        onChange={(value) => {\n          setValue(value);\n        }}\n        onAfterChange={(value) => {\n          props.onChange(value);\n        }}\n      />\n    </div>\n  );\n};\n\nconst EditRotatePopup: React.FC<{}> = (props) => {\n  const { x, y, z } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    const result_z: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _x = state.objects[id].rotateX;\n      const _y = state.objects[id].rotateY;\n      const _z = state.objects[id].rotateZ;\n      if (result_x.includes(_x) === false) {\n        result_x.push(_x);\n      }\n      if (result_y.includes(_y) === false) {\n        result_y.push(_y);\n      }\n      if (result_z.includes(_z) === false) {\n        result_z.push(_z);\n      }\n    });\n    return {\n      x: result_x,\n      y: result_y,\n      z: result_z,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              rotateX: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              rotateY: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeZ = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              rotateZ: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div>\n      <span>Rotate: </span>\n      <br />\n      <InputTypeNumber\n        defaultValue={x.length > 1 ? undefined : x[0]}\n        min={-360}\n        max={360}\n        showDecimal={false}\n        step={1}\n        // @trans\n        label={\"X: \"}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={x.length > 1 ? 0 : x[0]}\n        onChange={onChangeX}\n        max={360}\n        min={-360}\n      />\n      <InputTypeNumber\n        defaultValue={y.length > 1 ? undefined : y[0]}\n        min={-360}\n        max={360}\n        showDecimal={false}\n        step={1}\n        // @trans\n        label={\"Y: \"}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={y.length > 1 ? 0 : y[0]}\n        onChange={onChangeY}\n        max={360}\n        min={-360}\n      />\n\n      <InputTypeNumber\n        defaultValue={z.length > 1 ? undefined : z[0]}\n        min={-360}\n        max={360}\n        step={1}\n        showDecimal={false}\n        // @trans\n        label={\"Z: \"}\n        onChange={onChangeZ}\n      />\n      <SliderWrapper\n        value={z.length > 1 ? 0 : z[0]}\n        onChange={onChangeZ}\n        max={360}\n        min={-360}\n      />\n    </div>\n  );\n};\n\nconst EditWidthHeightPopup: React.FC<{}> = (props) => {\n  const { width, height } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _width = state.objects[id].width;\n      const _height = state.objects[id].height;\n      if (result_x.includes(_width) === false) {\n        result_x.push(_width);\n      }\n      if (result_y.includes(_height) === false) {\n        result_y.push(_height);\n      }\n    });\n    return {\n      width: result_x,\n      height: result_y,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              width: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              height: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div>\n      <br />\n      <InputTypeNumber\n        defaultValue={width.length > 1 ? undefined : width[0]}\n        max={500}\n        min={1}\n        step={0.1}\n        showDecimal={true}\n        // @trans\n        label={\"Width: \"}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={width.length > 1 ? 0 : width[0]}\n        onChange={onChangeX}\n        max={500}\n        min={1}\n      />\n      <InputTypeNumber\n        defaultValue={height.length > 1 ? undefined : height[0]}\n        max={500}\n        min={1}\n        step={0.1}\n        showDecimal={true}\n        // @trans\n        label={\"Height: \"}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={height.length > 1 ? 0 : height[0]}\n        onChange={onChangeY}\n        max={500}\n        min={1}\n      />\n    </div>\n  );\n};\n\nconst EditWidthHeightDepthPopup: React.FC<{}> = (props) => {\n  const { width, height, depth } = useSelector((state: Editor) => {\n    const result_x: number[] = [];\n    const result_y: number[] = [];\n    const result_z: number[] = [];\n    state.selectedIds.forEach((id) => {\n      if (!state.objects[id]) {\n        return;\n      }\n      const _x = state.objects[id].width;\n      const _y = state.objects[id].height;\n      const _z = state.objects[id].depth;\n      if (result_x.includes(_x) === false) {\n        result_x.push(_x);\n      }\n      if (result_y.includes(_y) === false) {\n        result_y.push(_y);\n      }\n      if (result_z.includes(_z) === false) {\n        result_z.push(_z);\n      }\n    });\n    return {\n      width: result_x,\n      height: result_y,\n      depth: result_z,\n    };\n  });\n\n  const onChangeX = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              width: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeY = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              height: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onChangeZ = (newValue: number) => {\n    if (newValue === undefined) {\n      return;\n    }\n    const store = getStore();\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: store.selectedIds.map((id) => {\n          if (!store.objects[id]) {\n            return {\n              id,\n              properties: {},\n            };\n          }\n          const change: ChangeObject = {\n            id,\n            properties: {\n              depth: newValue,\n            },\n          };\n          return change;\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n\n  return (\n    <div>\n      <span>Size: </span>\n      <br />\n      <InputTypeNumber\n        defaultValue={width.length > 1 ? undefined : width[0]}\n        min={1}\n        max={500}\n        showDecimal={true}\n        step={0.1}\n        // @trans\n        label={\"Width: \"}\n        onChange={onChangeX}\n      />\n      <SliderWrapper\n        value={width.length > 1 ? 0 : width[0]}\n        onChange={onChangeX}\n        min={1}\n        max={500}\n      />\n      <InputTypeNumber\n        defaultValue={height.length > 1 ? undefined : height[0]}\n        min={1}\n        max={500}\n        showDecimal={true}\n        step={0.1}\n        // @trans\n        label={\"Height: \"}\n        onChange={onChangeY}\n      />\n      <SliderWrapper\n        value={height.length > 1 ? 0 : height[0]}\n        onChange={onChangeY}\n        min={1}\n        max={500}\n      />\n\n      <InputTypeNumber\n        defaultValue={depth.length > 1 ? undefined : depth[0]}\n        min={1}\n        max={500}\n        showDecimal={true}\n        step={0.1}\n        // @trans\n        label={\"Depth: \"}\n        onChange={onChangeZ}\n      />\n      <SliderWrapper\n        value={depth.length > 1 ? 0 : depth[0]}\n        onChange={onChangeZ}\n        min={1}\n        max={500}\n      />\n    </div>\n  );\n};\n\nconst AlignmentPopup: React.FC<{}> = (props) => {\n  const sendSnapTo = (snapType: SnapToLineType) => {\n    const store = getStore();\n\n    const event: ChangeSelectedObjectsAlignment = {\n      name: AppEventType.ChangeObjectsAlignment,\n      payload: {\n        selectedIds: store.selectedIds,\n        snapType,\n      },\n    };\n    sendEvent(event);\n  };\n\n  const onClickAlighXLeft = () => {\n    sendSnapTo(SnapToLineType.X_MIN);\n  };\n  const onClickAlighXMiddle = () => {\n    sendSnapTo(SnapToLineType.X_MIDDLE);\n  };\n  const onClickAlighXRight = () => {\n    sendSnapTo(SnapToLineType.X_MAX);\n  };\n  const onClickAlighYLeft = () => {\n    sendSnapTo(SnapToLineType.Y_MIN);\n  };\n  const onClickAlighYMiddle = () => {\n    sendSnapTo(SnapToLineType.Y_MIDDLE);\n  };\n  const onClickAlighYRight = () => {\n    sendSnapTo(SnapToLineType.Y_MAX);\n  };\n  const uiButton = getComputedStyle(document.body).getPropertyValue(\n    \"--uiButton\"\n  );\n  return (\n    <div>\n      X: <br />\n      <button onClick={onClickAlighXLeft}>\n        <FontAwesomeIcon icon={faAlignLeft} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighXMiddle}>\n        <FontAwesomeIcon icon={faAlignCenter} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighXRight}>\n        <FontAwesomeIcon icon={faAlignRight} color={uiButton} size={\"lg\"} />\n      </button>\n      <br />\n      <br />\n      Y: <br />\n      <button onClick={onClickAlighYLeft}>\n        <FontAwesomeIcon icon={faAlignLeft} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighYMiddle}>\n        <FontAwesomeIcon icon={faAlignCenter} color={uiButton} size={\"lg\"} />\n      </button>\n      <button onClick={onClickAlighYRight}>\n        <FontAwesomeIcon icon={faAlignRight} color={uiButton} size={\"lg\"} />\n      </button>\n    </div>\n  );\n};\n\nconst MorePopup: React.FC<{}> = (props) => {\n  const onlyRegionsInfo = useSelector((state: Editor) => {\n    let snapToCellChecked: \"allFalse\" | \"mixed\" | \"allTrue\" | \"unknow\" =\n      \"unknow\";\n    let autoFillChecked: \"allFalse\" | \"mixed\" | \"allTrue\" | \"unknow\" = \"unknow\";\n    let regionIds: string[] = [];\n    let onlyRegions: boolean = state.selectedIds.length > 0 ? true : false;\n    for (let i = 0; i < state.selectedIds.length; i++) {\n      const id = state.selectedIds[i];\n      if (state.objects[id] === undefined) {\n        continue;\n      }\n      const objectType = state.objects[id].objectType;\n      if (objectType !== ObjectTypes.Region) {\n        onlyRegions = false;\n        break;\n      }\n\n      const _value1 = (state.objects[id] as Region).snapBeadsToCell;\n      if (snapToCellChecked === \"unknow\") {\n        snapToCellChecked = _value1 === true ? \"allTrue\" : \"allFalse\";\n      } else {\n        if (snapToCellChecked === \"allTrue\" && _value1 === false) {\n          snapToCellChecked = \"mixed\";\n        } else if (snapToCellChecked === \"allFalse\" && _value1 === true) {\n          snapToCellChecked = \"mixed\";\n        }\n      }\n\n      const _value2 = (state.objects[id] as Region).autoFillBeads;\n      if (autoFillChecked === \"unknow\") {\n        autoFillChecked = _value2 === true ? \"allTrue\" : \"allFalse\";\n      } else {\n        if (autoFillChecked === \"allTrue\" && _value2 === false) {\n          autoFillChecked = \"mixed\";\n        } else if (autoFillChecked === \"allFalse\" && _value2 === true) {\n          autoFillChecked = \"mixed\";\n        }\n      }\n\n      regionIds.push(id);\n    }\n    return { onlyRegions, snapToCellChecked, autoFillChecked, regionIds };\n  });\n\n  const onClickDuplicate = () => {\n    const store = getStore();\n    const event: DuplicateObjects = {\n      name: AppEventType.DuplicateObjects,\n      payload: {\n        objects: store.selectedIds.map((id) => store.objects[id]),\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickDelete = () => {\n    const store = getStore();\n    const event: RemoveObjects = {\n      name: AppEventType.RemoveObjects,\n      payload: {\n        ids: store.selectedIds,\n      },\n    };\n    sendEvent(event);\n  };\n  // const onClickCopy = () => {\n  //   const event: ClipboardCopy = {\n  //     name: AppEventType.ClipboardCopy,\n  //     payload: {},\n  //   };\n  //   sendEvent(event);\n  // };\n  const onClickAutofill = () => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: onlyRegionsInfo.regionIds.map((id) => {\n          let newValue: boolean = true;\n          if (onlyRegionsInfo.autoFillChecked === \"allTrue\") {\n            newValue = false;\n          } else if (onlyRegionsInfo.autoFillChecked === \"allFalse\") {\n            newValue = true;\n          } else {\n            newValue = true;\n          }\n          return {\n            id,\n            properties: {\n              autoFillBeads: newValue,\n            },\n          };\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickSnaptocell = () => {\n    const event: ChangeObjectsProperty = {\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: onlyRegionsInfo.regionIds.map((id) => {\n          let newValue: boolean = true;\n          if (onlyRegionsInfo.snapToCellChecked === \"allTrue\") {\n            newValue = false;\n          } else if (onlyRegionsInfo.snapToCellChecked === \"allFalse\") {\n            newValue = true;\n          } else {\n            newValue = true;\n          }\n          return {\n            id,\n            properties: {\n              snapBeadsToCell: newValue,\n            },\n          };\n        }),\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        minWidth: 220,\n      }}\n    >\n      {onlyRegionsInfo.onlyRegions === true ? (\n        <React.Fragment>\n          {/* @TRANS */}\n          <div onClick={onClickAutofill}>\n            <span>Autofill</span>\n            {onlyRegionsInfo.autoFillChecked === \"allTrue\" ? (\n              <FontAwesomeIcon icon={faCheck} color={\"#000\"} />\n            ) : null}\n            {onlyRegionsInfo.autoFillChecked === \"mixed\" ? (\n              <FontAwesomeIcon icon={faExclamationCircle} color={\"#444\"} />\n            ) : null}\n          </div>\n\n          {/* @TRANS */}\n          <div onClick={onClickSnaptocell}>\n            <span>Snap to cell</span>\n            {onlyRegionsInfo.snapToCellChecked === \"allTrue\" ? (\n              <FontAwesomeIcon icon={faCheck} color={\"#000\"} />\n            ) : null}\n\n            {onlyRegionsInfo.snapToCellChecked === \"mixed\" ? (\n              <FontAwesomeIcon icon={faExclamationCircle} color={\"#444\"} />\n            ) : null}\n          </div>\n        </React.Fragment>\n      ) : null}\n      {/* <div onClick={onClickCopy}>Copy</div> */}\n      {/* @TRANS */}\n      <div onClick={onClickDuplicate}>Duplicate</div>\n      {/* @TRANS */}\n      <div onClick={onClickDelete}>Delete</div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Bead, Editor, Group, ObjectTypes } from \"../../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { Actions, ActionsTypes, MapActionObjectType } from \"./ActionsTypes\";\nimport { ActionsIconsWrapper } from \"./ActionsIconsWrapper\";\nimport { PopupWrapper } from \"./PopupWrapper\";\nimport { getStore } from \"../../controllers/store\";\n\nexport const TopBarContent: React.FC<{ x: number; y: number }> = (props) => {\n  const selectedIds = useSelector((state: Editor) => {\n    return state.selectedIds;\n  });\n  const actionsGrouped = useSelector((state: Editor) => {\n    const selectedActions: ActionsTypes[] = [];\n    state.selectedIds.forEach((id) => {\n      if (state.objects[id]) {\n        const objectType = state.objects[id].objectType;\n        const actionsForType = MapActionObjectType[objectType];\n        if (selectedActions.length === 0) {\n          actionsForType.forEach((action) => {\n            selectedActions.push(action);\n          });\n        } else {\n          for (let i = selectedActions.length - 1; i >= 0; i--) {\n            const action = selectedActions[i];\n            if (actionsForType.includes(action) === false) {\n              selectedActions.splice(selectedActions.indexOf(action), 1);\n            }\n          }\n        }\n      }\n    });\n    const result: ActionsTypes[][] = [];\n    let groupedResults: { [key: string]: ActionsTypes[] } = {};\n    selectedActions.forEach((action) => {\n      if (Actions[action]) {\n        if (action === ActionsTypes.Alignment) {\n          if (state.selectedIds.length === 1) {\n            return;\n          }\n        }\n        if (action === ActionsTypes.Lock || action === ActionsTypes.Unlock) {\n          if (state.selectedIds.length === 1) {\n            const id = state.selectedIds[0];\n            const obj = state.objects[id];\n            if (obj.isLocked === true) {\n              groupedResults = {};\n              groupedResults[Actions[ActionsTypes.Unlock].groupId] = [\n                ActionsTypes.Unlock,\n              ];\n              return false;\n            }\n            if (obj.isLocked === false && action === ActionsTypes.Unlock) {\n              return;\n            }\n          } else {\n            let containsLockedGroup: any = false;\n            state.selectedIds.forEach((objectId) => {\n              if (state.objects[objectId] === undefined) {\n                return;\n              }\n\n              const isGroup =\n                state.objects[objectId].objectType === ObjectTypes.Group;\n              const groupIdKey: keyof Bead = \"groupId\";\n              const isInGroup =\n                state.objects[objectId][groupIdKey] !== undefined &&\n                state.objects[objectId][groupIdKey]!.length > 0;\n              const groupId = state.objects[objectId][groupIdKey]!;\n              if (isGroup) {\n                const obj = state.objects[objectId];\n                if (obj.isLocked === true) {\n                  groupedResults = {};\n                  groupedResults[Actions[ActionsTypes.Unlock].groupId] = [\n                    ActionsTypes.Unlock,\n                  ];\n                  containsLockedGroup = true;\n                  return false;\n                }\n                if (obj.isLocked === false && action === ActionsTypes.Unlock) {\n                  containsLockedGroup = true;\n                  return;\n                }\n              } else if (isInGroup) {\n                const obj = state.objects[groupId];\n                if (obj.isLocked === true) {\n                  groupedResults = {};\n                  groupedResults[Actions[ActionsTypes.Unlock].groupId] = [\n                    ActionsTypes.Unlock,\n                  ];\n                  containsLockedGroup = true;\n                  return false;\n                }\n                if (obj.isLocked === false && action === ActionsTypes.Unlock) {\n                  containsLockedGroup = true;\n                  return;\n                }\n              }\n            });\n            if (containsLockedGroup === true) {\n              return;\n            } else {\n              if (action === ActionsTypes.Unlock) {\n                return;\n              }\n            }\n          }\n        }\n        if (action === ActionsTypes.Group || action === ActionsTypes.Ungroup) {\n          if (state.selectedIds.length === 1) {\n            return;\n          } else {\n            //@TODO: zmienic typ z any na boolean\n            let containsRegion: any = false;\n            let anySelectedBeadInRegion: any = false;\n\n            // let containsGroup: any = false;\n            // let allCount: any = state.selectedIds.length;\n            let groupCount: any = 0;\n            let inGroupCount: any = 0;\n            let noGroupCount: any = 0;\n\n            state.selectedIds.forEach((objectId) => {\n              if (containsRegion === true) {\n                return;\n              }\n              if (anySelectedBeadInRegion === true) {\n                return;\n              }\n              if (state.objects[objectId] === undefined) {\n                return;\n              }\n              if (state.objects[objectId].objectType === ObjectTypes.Region) {\n                containsRegion = true;\n                return;\n              }\n\n              if (state.objects[objectId].objectType === ObjectTypes.Bead) {\n                if ((state.objects[objectId] as Bead).regionId !== undefined) {\n                  anySelectedBeadInRegion = true;\n                  return;\n                }\n              }\n\n              const isGroup =\n                state.objects[objectId].objectType === ObjectTypes.Group;\n\n              const groupIdKey: keyof Bead = \"groupId\";\n              const isInGroup =\n                state.objects[objectId][groupIdKey] !== undefined &&\n                state.objects[objectId][groupIdKey]!.length > 0;\n              if (isGroup) {\n                groupCount = groupCount + 1;\n              } else if (isInGroup) {\n                inGroupCount = inGroupCount + 1;\n              } else {\n                noGroupCount = noGroupCount + 1;\n              }\n            });\n\n            if (containsRegion === true) {\n              return;\n            }\n\n            if (anySelectedBeadInRegion === true) {\n              return;\n            }\n\n            // console.log(\n            //   \"------------- jak jest?\",\n            //   allCount,\n            //   groupCount,\n            //   inGroupCount,\n            //   noGroupCount\n            // );\n            if (noGroupCount === 0 && groupCount > 0) {\n              if (action === ActionsTypes.Group) {\n                return;\n              }\n            } else if (groupCount > 0 || inGroupCount > 0) {\n              // do nothing\n            } else {\n              if (action === ActionsTypes.Ungroup) {\n                return;\n              }\n            }\n          }\n        }\n        if (!groupedResults[Actions[action].groupId]) {\n          groupedResults[Actions[action].groupId] = [action];\n        } else {\n          groupedResults[Actions[action].groupId].push(action);\n        }\n      }\n    });\n    Object.keys(groupedResults)\n      .sort((groupIdA, groupIdB) => {\n        const firstActionA = groupedResults[groupIdA][0];\n        const firstActionB = groupedResults[groupIdB][0];\n        const groupSortOrderA = Actions[firstActionA].groupSortOrder;\n        const groupSortOrderB = Actions[firstActionB].groupSortOrder;\n        return groupSortOrderA === groupSortOrderB\n          ? 0\n          : groupSortOrderA > groupSortOrderB\n          ? 1\n          : -1;\n      })\n      .forEach((groupId) => {\n        const actions = groupedResults[groupId].sort((actionA, actionB) => {\n          return Actions[actionA].sortOrder === Actions[actionB].sortOrder\n            ? 0\n            : Actions[actionA].sortOrder > Actions[actionB].sortOrder\n            ? 1\n            : -1;\n        });\n        result.push(actions);\n      });\n    return result;\n  });\n  const [popupInfo, setPopupInfo] = React.useState<{\n    isOpen: boolean;\n    type: ActionsTypes | undefined;\n    offsetLeft: number;\n  }>({\n    isOpen: false,\n    type: undefined,\n    offsetLeft: 0,\n  });\n  const onClickAnyIcon = (type: ActionsTypes, offsetLeft: number) => {\n    const newValue = type === popupInfo.type ? !popupInfo.isOpen : true;\n    setPopupInfo({\n      isOpen: newValue,\n      type,\n      offsetLeft,\n    });\n  };\n\n  React.useEffect(() => {\n    setPopupInfo({\n      isOpen: false,\n      type: undefined,\n      offsetLeft: 0,\n    });\n  }, [selectedIds]);\n\n  return (\n    <div\n      className={`selected-objects-top-bar`}\n      style={{\n        top: props.y,\n        left: props.x,\n      }}\n    >\n      <div className={\"content-wrapper\"}>\n        <div className={\"action-icons-wrapper\"}>\n          {actionsGrouped.map((actions, index) => {\n            return (\n              <ActionsIconsWrapper\n                key={index}\n                actions={actions}\n                onClick={onClickAnyIcon}\n                selectedAction={\n                  popupInfo.isOpen === true && popupInfo.type !== undefined\n                    ? popupInfo.type\n                    : undefined\n                }\n              />\n            );\n          })}\n        </div>\n\n        {popupInfo.isOpen === true && popupInfo.type !== undefined ? (\n          <PopupWrapper\n            offsetLeft={popupInfo.offsetLeft}\n            type={popupInfo.type}\n          />\n        ) : null}\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Bead, Editor } from \"../../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport { TopBarContent } from \"./TopBarContent\";\n\nexport const SelectedObjectsTopBar: React.FC<{}> = (props) => {\n  const selectedTopBarPosition = useSelector((state: Editor) => {\n    return state.ui.selectedTopBarPosition;\n  });\n\n\n  if (selectedTopBarPosition === undefined) {\n    return null;\n  }\n\n  return (\n    <SelectedObjectsTopBarStyles\n      style={{\n        zIndex:\n          selectedTopBarPosition === undefined\n            ? \"-5\"\n            : (\"var(--zIndexSelectedObjectsTopBar)\" as any),\n      }}\n    >\n      {selectedTopBarPosition !== undefined ? (\n        <TopBarContent\n          x={selectedTopBarPosition.x}\n          y={selectedTopBarPosition.y}\n        />\n      ) : null}\n    </SelectedObjectsTopBarStyles>\n  );\n};\n\nexport const SelectedObjectsTopBarStyles = styled.div`\n  .selected-objects-top-bar {\n    position: fixed;\n    top: 100px;\n    z-index: var(--zIndexSelectedObjectsTopBar);\n  }\n\n  .content-wrapper {\n    position: absolute;\n    left: 50%;\n    transform: translate(-50%, -65px);\n    height: 55px;\n    padding: 0 12px;\n    background: #fff;\n    border-radius: 4;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n  }\n  .action-icons-wrapper {\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n    column-gap: calc(var(--standardPadding) * 2);\n    width: 100%;\n    height: 100%;\n  }\n\n  .action-icons-wrapper > div:nth-last-child(1) .actions-group:before {\n    background: transparent;\n  }\n\n  .action-icons-wrapper > div:first-child .actions-group:before {\n    background: transparent;\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faTimes } from \"@fortawesome/free-solid-svg-icons\";\nimport { getStore, setStore } from \"../controllers/store\";\nimport produce from \"immer\";\nimport { refreshReactState } from \"../controllers/refreshReactState\";\nimport styled from \"styled-components\";\n\nexport const ModalEditProject: React.FC<{}> = () => {\n  const project = useSelector((state: Editor) => {\n    return state.board;\n  });\n  const [name, setName] = React.useState(project?.name ?? \"\");\n  if (!project) {\n    return <React.Fragment />;\n  }\n  if (project.editModalVisible === false) {\n    return <React.Fragment />;\n  }\n  const onClickCancel = () => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.editModalVisible = false;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const setNewProjectName = (newName: string) => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.name = newName;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n\n  return (\n    <ModalEditProjectStyles>\n      <div className={\"edit-modal-popup\"}>\n        <div className={\"edit-modal-popup-overlay\"} onClick={onClickCancel}>\n          &nbsp;\n        </div>\n        <div className={\"edit-modal-popup-content-wrapper\"}>\n          <div className={\"edit-modal-popup-content\"}>\n            <div className={\"btn-cancel\"} onClick={onClickCancel}>\n              <FontAwesomeIcon icon={faTimes} color={\"#000\"} />\n            </div>\n\n            <h2>Edycja projektu</h2>\n            <div>\n              <input\n                name={\"name\"}\n                className={\"input\"}\n                value={name}\n                onChange={(event) => {\n                  setName(event.target.value);\n                }}\n                onBlur={(event) => {\n                  const newName = event.target.value;\n                  if (newName.length > 0) {\n                    setNewProjectName(newName);\n                  }\n                }}\n              />\n            </div>\n\n            <div className={\"actions\"}></div>\n          </div>\n        </div>\n      </div>\n    </ModalEditProjectStyles>\n  );\n};\n\nexport const ModalEditProjectStyles = styled.div`\n  .edit-modal-popup {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 100;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    overflow-x: hidden;\n    overflow-y: auto;\n  }\n  .edit-modal-popup-overlay {\n    background: rgba(0, 0, 0, 0.4);\n    transition: all 0.4s ease-in-out;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n  .edit-modal-popup-content-wrapper {\n    position: absolute;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100%;\n  }\n  .edit-modal-popup-content {\n    background: #fff;\n    padding: 32px;\n    width: 520px;\n    box-sizing: border-box;\n    transition: all 0.25s ease-out;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    transition: all 0.4s ease-in-out;\n    z-index: 2;\n    position: relative;\n  }\n  .actions {\n    display: flex;\n    justify-content: flex-end;\n  }\n  .btn-cancel {\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 5;\n    width: 45px;\n    height: 45px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    /* border: 1px solid #eee; */\n    /* color: #000; */\n    /* padding: 10px 15px; */\n    /* border-radius: 4px; */\n    /* width: 90px; */\n    cursor: pointer;\n  }\n  .input {\n    border: none;\n    border-bottom: 1px solid rgba(5, 0, 56, 0.2);\n    padding: 8px 0 4px;\n    font-size: 24px;\n    transition: all 0.4s ease-in-out;\n    border-radius: 0;\n    box-shadow: none;\n    margin-bottom: 10px;\n\n    &:hover {\n      border-bottom-color: rgba(5, 0, 56, 0.4);\n    }\n    &:focus {\n      border-bottom-color: var(--uiButtonActive);\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faReply,\n  faStar as faStarSolid,\n  faUpload,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { faStar as faStarRegular } from \"@fortawesome/free-regular-svg-icons\";\nimport { redoHistory, undoHistory } from \"../controllers/AppHistory\";\nimport { getStore, setStore } from \"../controllers/store\";\nimport produce from \"immer\";\nimport { refreshReactState } from \"../controllers/refreshReactState\";\nimport { appThree } from \"../threejs/renderThreejs\";\nimport styled from \"styled-components\";\nimport { Link } from \"react-router-dom\";\n\nexport const ProjectInfoWrapper: React.FC<{}> = (props) => {\n  const { canRedo, canUndo } = useSelector((state: Editor) => {\n    const { canRedo, canUndo } = state.history;\n    return {\n      canRedo,\n      canUndo,\n    };\n  });\n  const board = useSelector((state: Editor) => {\n    return state.board;\n  });\n  const onClickRedo = () => {\n    if (canRedo) {\n      redoHistory();\n    }\n  };\n  const onClickUndo = () => {\n    if (canUndo) {\n      undoHistory();\n    }\n  };\n  const onClickName = () => {\n    if (!board) {\n      return;\n    }\n    if (!board.canToggleToFavourite) {\n      return;\n    }\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.editModalVisible = true;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const onClickLogo = () => {\n    // window.alert(\"back to home\");\n  };\n  const onClickFavourite = () => {\n    if (!board) {\n      return;\n    }\n    if (!board.canToggleToFavourite) {\n      return;\n    }\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.board) {\n        draft.board.isFavourite = !draft.board.isFavourite;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const onClickExportAsImage = () => {\n    try {\n      const content = appThree.renderer.domElement\n        .toDataURL(\"image/png\")\n        .replace(\"image/png\", \"image/octet-stream\");\n      const link = document.createElement(\"a\");\n      document.body.appendChild(link);\n      link.download = \"coralinio-preview.png\";\n      link.href = content;\n      link.click();\n      document.body.removeChild(link);\n    } catch (e) {\n      console.log(e);\n      return;\n    }\n  };\n\n  return (\n    <ProjectInfoWrapperStyles>\n      <div className={\"project-info-wrapper\"}>\n        <div className={\"block-with-info\"}>\n          <div\n            className=\"coralinio-logo\"\n            onClick={onClickLogo}\n            // @TRANSLATION\n            data-tip={\"Back to Home\"}\n            data-place={\"bottom\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <Link to=\"/\">coralinio</Link>\n            </div>\n          </div>\n\n          {board?.name ? (\n            <div\n              className={\"project-name\"}\n              onClick={onClickName}\n              data-tip={board?.name ?? \"\"}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <div className={\"value\"}>{board?.name ?? \"\"}</div>\n            </div>\n          ) : null}\n\n          {board?.canToggleToFavourite ? (\n            <div\n              className={\"add-to-fav\"}\n              onClick={onClickFavourite}\n              // @TRANSLATION\n              data-tip={\n                board.isFavourite === true\n                  ? \"Remove from favourite\"\n                  : \"Add to favourite\"\n              }\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <FontAwesomeIcon\n                icon={board.isFavourite ? faStarSolid : faStarRegular}\n              />\n            </div>\n          ) : null}\n\n          {board?.canExportAsImage ? (\n            <div\n              className={\"export-as-image\"}\n              onClick={onClickExportAsImage}\n              // @TRANSLATION\n              data-tip={\"Export as Image\"}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <FontAwesomeIcon icon={faUpload} />\n            </div>\n          ) : null}\n        </div>\n\n        {canRedo || canUndo ? (\n          <div className={\"block-with-history\"}>\n            <div\n              className={`undo-button ${canUndo ? \"active\" : \"inactive\"}`}\n              onClick={onClickUndo}\n              // @TRANSLATION\n              data-tip={\"UNDO\"}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <span className=\"icon\">\n                <FontAwesomeIcon icon={faReply} />\n              </span>\n            </div>\n\n            <div\n              className={`redo-button ${canRedo ? \"active\" : \"inactive\"} `}\n              onClick={onClickRedo}\n              // @TRANSLATION\n              data-tip={\"REDO\"}\n              data-place={\"bottom\"}\n              data-type={\"dark\"}\n              data-effect={\"solid\"}\n            >\n              <span className=\"icon\">\n                <FontAwesomeIcon\n                  icon={faReply}\n                  style={{ transform: \"scaleX(-1)\" }}\n                />\n              </span>\n            </div>\n          </div>\n        ) : null}\n      </div>\n    </ProjectInfoWrapperStyles>\n  );\n};\n\nexport const ProjectInfoWrapperStyles = styled.div`\n  .project-info-wrapper {\n    position: absolute;\n    top: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: 10;\n    display: flex;\n    column-gap: calc(var(--standardPadding) * 2);\n    transition: all 0.4s ease-in-out;\n  }\n  .block-with-info {\n    background: #fff;\n    height: 55px;\n    display: flex;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n    column-gap: calc(var(--standardPadding) * 2);\n\n    .coralinio-logo {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      .value {\n        width: 120px;\n        transition: all 0.4s ease-in-out;\n        a {\n          transition: all 0.4s ease-in-out;\n          font-size: 29px;\n          font-family: \"Fredoka One\", cursive;\n          font-weight: 400;\n          text-transform: lowercase;\n          color: var(--uiButton);\n        }\n        &:hover a {\n          color: var(--uiButtonActive);\n        }\n      }\n    }\n    .project-name {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: \"\";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      .value {\n        font-size: 20px;\n        max-width: 200px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        font-family: \"Open Sans\", sans-serif;\n        font-weight: 400;\n      }\n    }\n    .add-to-fav {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: \"\";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n    .export-as-image {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      &:before {\n        content: \"\";\n        margin-left: 0px;\n        margin-right: calc(var(--standardPadding) * 2);\n        height: 60%;\n        width: 1px;\n        background: var(--gray);\n      }\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n    }\n  }\n\n  .block-with-history {\n    display: flex;\n    background: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 55px;\n\n    .redo-button,\n    .undo-button {\n      width: 45px;\n      height: 100%;\n      padding-left: calc(var(--standardPadding) * 2);\n      padding-right: calc(var(--standardPadding) * 2);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      transition: all 0.4s ease-in-out;\n      svg path {\n        transition: all 0.4s ease-in-out;\n      }\n      &.active:hover {\n        svg path {\n          fill: var(--uiButtonActive);\n        }\n      }\n      &.inactive {\n        svg path {\n          fill: var(--uiButtonInActive);\n        }\n      }\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faMinus, faPlus } from \"@fortawesome/free-solid-svg-icons\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport {\n  AppEventType,\n  ChangeUiSettingsZoom,\n} from \"../controllers/AppEventType\";\nimport styled from \"styled-components\";\n\nexport const MinimapWrapper: React.FC<{}> = (props) => {\n  const { zoomScale } = useSelector((state: Editor) => {\n    const { zoomScale } = state.ui;\n    return {\n      zoomScale,\n    };\n  });\n  const onClickPlus = () => {\n    const updateUiEvent: ChangeUiSettingsZoom = {\n      name: AppEventType.ChangeUiSettingsZoom,\n      payload: {\n        zoomType: \"zoomInScreenCenter\",\n        useAnimation: true,\n      },\n    };\n    sendEvent(updateUiEvent);\n  };\n  const onClickMinus = () => {\n    const updateUiEvent: ChangeUiSettingsZoom = {\n      name: AppEventType.ChangeUiSettingsZoom,\n      payload: {\n        zoomType: \"zoomOutScreenCenter\",\n        useAnimation: true,\n      },\n    };\n    sendEvent(updateUiEvent);\n  };\n  return (\n    <MinimapWrapperStyles>\n      <div className={\"minimap-wrapper\"}>\n        <div className={\"minimap-wrapper-content\"}>\n          <div\n            className={\"item\"}\n            onClick={onClickMinus}\n            // @TRANSLATION\n            data-tip={\"Zoom Out\"}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon icon={faMinus} />\n            </div>\n          </div>\n          <div\n            className={\"item\"}\n            onClick={onClickPlus}\n            // @TRANSLATION\n            data-tip={`Zoom In`}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon icon={faPlus} />\n            </div>\n          </div>\n          <div\n            className={\"item-text\"}\n            // @TRANSLATION\n            data-tip={`Zoom percentage`}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>{Math.round((1 / zoomScale) * 100)}%</div>\n          </div>\n        </div>\n      </div>\n    </MinimapWrapperStyles>\n  );\n};\n\nexport const MinimapWrapperStyles = styled.div`\n  .minimap-wrapper {\n    position: absolute;\n    z-index: var(--zIndexMinimap);\n    bottom: var(--standardPadding);\n    right: var(--standardPadding);\n    transition: all 0.4s ease-in-out;\n    width: var(--minimapWidth);\n  }\n  .minimap-wrapper-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding) / 2;\n  }\n  .item {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 45px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    cursor: pointer;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .item-text {\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 70px;\n    transition: all 0.4s ease-in-out;\n    color: var(--uiButton);\n    font-size: 18px;\n    font-weight: 600;\n  }\n`;\n","import React from \"react\";\nimport { Bead, Editor, ObjectTypes } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { thumbnailsGenerator } from \"../threejs/thumbnailsGenerator\";\nimport { cloneDeep } from \"lodash\";\n\nexport const BeadsSummary: React.FC<{}> = () => {\n  const { groupedCount } = useSelector((state: Editor) => {\n    const groups: {\n      [key: string]: {\n        count: number;\n        example: Bead;\n        textName: string;\n        textTooltip: string;\n      };\n    } = {};\n    Object.keys(state.objects).forEach((id) => {\n      if (state.objects[id].objectType === ObjectTypes.Bead) {\n        const bead = state.objects[id] as Bead;\n        const groupData: any = {\n          width: bead.width,\n          height: bead.height,\n          depth: bead.depth,\n          // rotateX: bead.rotateX,\n          // rotateY: bead.rotateY,\n          // rotateZ: bead.rotateZ,\n          type: bead.type,\n          color: bead.color,\n        };\n        const groupId = JSON.stringify(groupData);\n\n        if (groups[groupId] === undefined) {\n          const item = cloneDeep(bead) as Bead;\n          item.rotateX = 90;\n          item.rotateY = 0;\n          item.rotateZ = 0;\n          groups[groupId] = {\n            count: 1,\n            example: item,\n            textName: `${item.color}`,\n            textTooltip: `${item.color} - 1x`,\n          };\n        } else {\n          const newCount = groups[groupId].count + 1;\n          groups[groupId].count = newCount;\n          groups[groupId].textTooltip = `${bead.color} - ${newCount}x`;\n        }\n      }\n    });\n    const groupedCount: {\n      count: number;\n      example: Bead;\n      textName: string;\n      textTooltip: string;\n      textCount: string;\n    }[] = [];\n    const maxGroups = 10;\n    Object.keys(groups).forEach((id, index) => {\n      if (index > maxGroups) {\n        return;\n      }\n      const group = groups[id];\n      const textCount = `${group.count}x`;\n      groupedCount.push({\n        count: group.count,\n        example: group.example,\n        textName: group.textName,\n        textTooltip: group.textName,\n        textCount,\n      });\n    });\n    return {\n      groupedCount,\n    };\n  });\n  const onClickOpenObjectsPanel = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        panel: \"objects\",\n        open: true,\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <BeadsSummaryStyles>\n      <div className={\"beads-summary\"}>\n        <div\n          className={\"beads-summary-content\"}\n          onClick={onClickOpenObjectsPanel}\n        >\n          {groupedCount.map((group, index) => {\n            if (!group) {\n              return null;\n            }\n            if (!group.example) {\n              return null;\n            }\n            if (!thumbnailsGenerator) {\n              return null;\n            }\n            const imgSrc = thumbnailsGenerator.getObjectThumbnail(\n              group.example,\n              30,\n              30\n            );\n            return (\n              <div\n                className={\"bead-count\"}\n                key={index}\n                // @TRANSLATION\n                data-tip={group.textTooltip}\n                data-place={\"top\"}\n                data-type={\"dark\"}\n                data-effect={\"solid\"}\n              >\n                <span className={\"preview\"}>\n                  <img src={imgSrc} />\n                </span>\n                <span className={\"value\"}>{group.textCount}</span>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </BeadsSummaryStyles>\n  );\n};\n\nexport const BeadsSummaryStyles = styled.div`\n  .beads-summary {\n    position: absolute;\n    bottom: var(--standardPadding);\n    right: calc(var(--standardPadding) + 170px + var(--standardPadding));\n    z-index: var(--zIndexBeadsSummary);\n    transition: all 0.4s ease-in-out;\n  }\n  .beads-summary-content {\n    background: #fff;\n    display: flex;\n    column-gap: var(--standardPadding);\n    height: 55px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding-left: calc(var(--standardPadding) * 2);\n    padding-right: calc(var(--standardPadding) * 2);\n  }\n  .bead-count {\n    display: flex;\n    flex-direction: column;\n    cursor: pointer;\n\n    .value {\n      font-size: 15px;\n      font-weight: 600;\n    }\n\n    .preview {\n      width: 30px;\n      height: 30px;\n      /* border: 1px solid #eee; */\n      /* border-radius: 30px; */\n      /* font-size: 8px; */\n      /* line-height: 27px; */\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      white-space: nowrap;\n      overflow: hidden;\n    }\n  }\n`;\n","import React from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faPlus,\n  faEdit,\n  faArrowsAlt,\n  faPaintBrush,\n  faPlusSquare,\n  faTh,\n  faTrashAlt,\n  faTable,\n  faSquare,\n  faBraille,\n  faMousePointer,\n  faSquareFull,\n  faCircle,\n  faExpand,\n  faReply,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { AppObject, EditorMode } from \"../../editorObjects/Editor\";\n// import { uiButton } from \"../colors\";\nimport { useDispatch } from \"react-redux\";\nimport { Actions } from \"../../immerReducers/store\";\nimport { times } from \"lodash\";\nimport ReactTooltip from \"react-tooltip\";\nimport styled from \"styled-components\";\nimport { sendEvent } from \"../../controllers/storeController\";\nimport {\n  AddMultipleBeads,\n  AddObjects,\n  AppEventType,\n  ChangeUiSettings,\n} from \"../../controllers/AppEventType\";\nimport { getStore } from \"../../controllers/store\";\n\nexport const EditorModes = ({ editorMode }) => {\n  // const dispatch = useDispatch();\n\n  const onChangeEditorMode = (newEditorMode: EditorMode) => {\n    const action: ChangeUiSettings = {\n      name: AppEventType.ChangeUiSettings,\n      payload: {\n        uiSettings: {\n          mode: newEditorMode,\n        },\n      },\n    };\n    sendEvent(action);\n    // dispatch(Actions.ChangeEditorMode.action_onChangeEditorMode(newEditorMode));\n  };\n\n  return (\n    <div className=\"\">\n      {/* <StateButton\n        label={\"Przegldanie\"}\n        icon={<FontAwesomeIcon icon={faMousePointer} />}\n        onClick={() => onChangeEditorMode(EditorMode.Idle)}\n        isSelected={editorMode === EditorMode.Idle}\n      /> */}\n\n      <StateButton\n        label={\"Zaznacz lub przesu\"}\n        icon={<FontAwesomeIcon icon={faMousePointer} />}\n        onClick={() => onChangeEditorMode(EditorMode.SelectOrMove)}\n        isSelected={editorMode === EditorMode.SelectOrMove}\n      />\n\n      <StateButton\n        label={\"Zaznacz wiele koralikw\"}\n        icon={<FontAwesomeIcon icon={faExpand} />}\n        onClick={() => onChangeEditorMode(EditorMode.SelectMultiple)}\n        isSelected={editorMode === EditorMode.SelectMultiple}\n      />\n\n      {/* <StateButton\n        label={\"Edit Lines\"}\n        icon={<FontAwesomeIcon icon={faEdit} />}\n        onClick={() => onChangeEditorMode(EditorMode.EditLines)}\n        isSelected={editorMode === EditorMode.EditLines}\n      /> */}\n      {/* <StateButton\n        label={\"AddLine\"}\n        icon={<FontAwesomeIcon icon={faPlus} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddLine)}\n        isSelected={editorMode === EditorMode.AddLine}\n      /> */}\n\n      <StateButton\n        label={\"Dodaj koraliki\"}\n        icon={<FontAwesomeIcon icon={faCircle} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddBeads)}\n        isSelected={editorMode === EditorMode.AddBeads}\n      />\n\n      <StateButton\n        label={\"Pomaluj koraliki\"}\n        icon={<FontAwesomeIcon icon={faPaintBrush} />}\n        onClick={() => onChangeEditorMode(EditorMode.PaintBeads)}\n        isSelected={editorMode === EditorMode.PaintBeads}\n      />\n\n      <StateButton\n        label={\"Usu koraliki\"}\n        icon={<FontAwesomeIcon icon={faTrashAlt} />}\n        onClick={() => onChangeEditorMode(EditorMode.DeleteBeads)}\n        isSelected={editorMode === EditorMode.DeleteBeads}\n      />\n\n      <StateButton\n        label={\"Dodaj region z siatk\"}\n        testId={\"btnAddRegion\"}\n        icon={<FontAwesomeIcon icon={faTable} />}\n        onClick={() => onChangeEditorMode(EditorMode.AddRegion)}\n        isSelected={editorMode === EditorMode.AddRegion}\n      />\n\n      <FastAddBeadsButton\n        label={\"Dodaj wiele koralikw\"}\n        icon={<FontAwesomeIcon icon={faTh} />}\n      />\n    </div>\n  );\n};\n\nconst StateButton: React.FC<{\n  label: string;\n  isSelected: boolean;\n  onClick: any;\n  icon: React.ReactChild;\n  testId?: string;\n}> = (props) => {\n  return (\n    <ButtonStyles>\n      <div\n        className={`action-button ${props.isSelected ? \"is-active\" : \"\"}`}\n        onClick={props.onClick}\n        data-tip={props.label}\n        data-place={\"right\"}\n        data-type={\"dark\"}\n        data-effect={\"solid\"}\n        data-test={props.testId}\n      >\n        <span className=\"icon\">{props.icon}</span>\n      </div>\n    </ButtonStyles>\n  );\n};\n\nconst ButtonStyles = styled.div`\n  .action-button {\n    border: none;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: var(--uiButton);\n    animation: all 0.5s ease-in-out;\n    min-height: 40px;\n    .icon svg,\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      animation: all 0.5s ease-in-out;\n    }\n  }\n  .action-button:hover,\n  .action-button.is-active {\n    color: var(--uiButtonActive);\n    .icon svg path,\n    .icon svg circle,\n    .icon svg rect {\n      fill: var(--uiButtonActive);\n    }\n  }\n`;\n\nconst FastAddBeadsButton: React.FC<{ label: string; icon: any }> = (props) => {\n  const dispatch = useDispatch();\n  const defaultDimesions = [20, 20];\n  const defaultSelected = [1, 1];\n  const [dimensions, setDimensions] = React.useState<number[]>(\n    defaultDimesions\n  );\n  const [selected, setSelected] = React.useState<number[]>(defaultSelected);\n  const [selectionVisible, setVisible] = React.useState<boolean>(false);\n\n  const toggleSelection = () => {\n    setVisible(!selectionVisible);\n  };\n  const onSelect = (rowIndex: number, colIndex: number) => {\n    // dispatch(Actions.Toolbar.action_fastAddBeads(rowIndex, colIndex));\n    const action: AddMultipleBeads = {\n      name: AppEventType.AddMultipleBeads,\n      payload: {\n        rows: rowIndex,\n        columns: colIndex,\n        figure: \"rectangle\",\n      },\n    };\n    sendEvent(action);\n\n    toggleSelection();\n    setDimensions(defaultDimesions);\n    setSelected(defaultSelected);\n  };\n  const onCancel = () => {\n    setDimensions(defaultDimesions);\n    setVisible(false);\n  };\n  return (\n    <div style={{ position: \"relative\" }}>\n      <ButtonStyles>\n        <div\n          className={`action-button ${selectionVisible ? \"is-active\" : \"\"}`}\n          onClick={toggleSelection}\n          data-tip={selectionVisible === true ? undefined : props.label}\n          data-place={\"right\"}\n          data-type={\"dark\"}\n          data-effect={\"solid\"}\n          data-tip-disable={selectionVisible === true}\n        >\n          <span className={`icon`}>{props.icon}</span>\n        </div>\n      </ButtonStyles>\n\n      {selectionVisible === true ? (\n        <SelectionStyles>\n          <SelectionFrame\n            selected={selected}\n            dimensions={dimensions}\n            setSelected={setSelected}\n            setDimensions={setDimensions}\n            onSelect={onSelect}\n            onCancel={onCancel}\n          />\n        </SelectionStyles>\n      ) : null}\n    </div>\n  );\n};\n\nconst SelectionFrame: React.FC<{\n  selected: number[];\n  dimensions: number[];\n  setSelected: any;\n  setDimensions: any;\n  onSelect: (a: number, b: number) => void;\n  onCancel: any;\n}> = (props) => {\n  const divRef = React.useRef<any | null>(null);\n  useOutsideClick(divRef, () => {\n    props.onCancel();\n  });\n  return (\n    <div className=\"selection\">\n      <div\n        className={\"rect-wrapper\"}\n        style={{ width: props.dimensions[0] * 15 }}\n        ref={(e) => {\n          divRef.current = e;\n        }}\n      >\n        {times(props.dimensions[0]).map((rowIndex) => (\n          <div className={\"row-wrapper\"} key={rowIndex}>\n            {times(props.dimensions[1]).map((colIndex) => {\n              const onMouseEnter = () => {\n                props.setSelected([rowIndex + 1, colIndex + 1]);\n\n                // @TODO:\n                // const max = 20;\n                // const min = 5;\n\n                // // const isLastCol = dimensions[1] - 1 === colIndex;\n                // // const isLastRow = dimensions[0] - 1 === rowIndex;\n                // // if (isLastCol || isLastRow) {\n                //   let nextRow = rowIndex;\n                //   if (rowIndex < min - 1) {\n                //     nextRow = min;\n                //   } else if (rowIndex > max) {\n                //     nextRow = max;\n                //   } else {\n                //     const isLast = dimensions[0] - 1 === rowIndex;\n                //     if (isLast) {\n                //       nextRow = Math.min(max, dimensions[0] + 1);\n                //     } else {\n                //       nextRow = rowIndex;\n                //     }\n                //   }\n                //   const nextCol = 5;\n                //   // let nextCol = colIndex;\n                //   // if (colIndex < min - 1) {\n                //   //   nextCol = min;\n                //   // } else if (colIndex > max) {\n                //   //   nextCol = max;\n                //   // } else {\n                //   //   const isLast = dimensions[1] - 1 === colIndex;\n                //   //   if (isLast) {\n                //   //     nextCol = Math.min(max, dimensions[1] + 1);\n                //   //   } else {\n                //   //     nextCol = colIndex;\n                //   //   }\n                //   // }\n\n                //   console.log(\"zmianiam wielkosc:\", nextRow, nextCol);\n                //   props.setDimensions([nextRow, nextCol]);\n                // }\n              };\n              const onClick = () => {\n                props.onSelect(rowIndex + 1, colIndex + 1);\n              };\n              return (\n                <div\n                  key={colIndex}\n                  className={`rect ${\n                    colIndex < props.selected[1] && rowIndex < props.selected[0]\n                      ? \"selected\"\n                      : \"\"\n                  }`}\n                  onMouseEnter={onMouseEnter}\n                  onClick={onClick}\n                >\n                  &nbsp;\n                </div>\n              );\n            })}\n          </div>\n        ))}\n      </div>\n      <div className={\"label-wrapper\"}>\n        {props.selected[0]}x{props.selected[1]}\n      </div>\n    </div>\n  );\n};\n\nconst useOutsideClick = (ref, callback) => {\n  const handleClick = (e) => {\n    if (ref.current && !ref.current.contains(e.target)) {\n      callback();\n    }\n  };\n\n  React.useEffect(() => {\n    document.addEventListener(\"click\", handleClick);\n\n    return () => {\n      document.removeEventListener(\"click\", handleClick);\n    };\n  });\n};\n\nconst SelectionStyles = styled.div`\n  .selection {\n    position: absolute;\n    top: 0px;\n    left: 65px;\n    min-width: calc(5 * 10px + 20px);\n    min-height: 100px;\n    background: #fff;\n    z-index: 10;\n    border: 1px solid #dbdbdb;\n    padding: 10px 10px 0px 10px;\n    box-sizing: border-box;\n  }\n  .selection .rect-wrapper {\n    display: flex;\n  }\n  .selection .label-wrapper {\n    font-size: 12px;\n    color: #000;\n    text-align: center;\n    width: 100%;\n  }\n  .selection .rect {\n    width: 15px;\n    height: 15px;\n    border: 1px solid #fff;\n    background: transparent;\n    padding: 1px;\n    box-shadow: inset 0px 0px 0px 1px #e3e1e1;\n  }\n  .selection .rect.selected {\n    background: var(--btns_bg);\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { EditorModes } from \"./Toolbar/EditorModes\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\n\nexport const ActionsWrapper: React.FC<{}> = () => {\n  const editorMode = useSelector((state: Editor) => {\n    return state.ui.mode;\n  });\n\n  return (\n    <ActionsWrapperStyles>\n      <div className=\"actions-wrapper\">\n        <div className={\"actions-content\"}>\n          <EditorModes editorMode={editorMode} />\n        </div>\n      </div>\n    </ActionsWrapperStyles>\n  );\n};\n\nexport const ActionsWrapperStyles = styled.div`\n  .actions-wrapper {\n    position: absolute;\n    z-index: var(--zIndexActions);\n    left: var(--standardPadding);\n    top: 50%;\n    transform: translate(0, -50%);\n    width: 56px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 0;\n    transition: all 0.4s ease-in-out;\n  }\n  .actions-content {\n    padding: 0;\n    background-color: rgba(255, 255, 255, 1);\n    padding: 12px 0;\n    transition: height 0.2s linear, top 0.2s linear;\n    border-radius: 4px;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    width: 100%;\n  }\n`;\n","import { faTimes } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React from \"react\";\nimport styled from \"styled-components\";\n\nexport const PanelContentStyles = styled.div`\n  .content-wrapper {\n    padding: calc(var(--standardPadding) * 2);\n    position: relative;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: flex-start;\n    flex-direction: column;\n    overflow: auto;\n    max-height: 100%;\n  }\n  .close-wrapper {\n    position: absolute;\n    top: calc(var(--standardPadding) * 1);\n    right: calc(var(--standardPadding) * 1);\n    width: 40px;\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n  }\n  .title {\n    font-size: 30px;\n    font-weight: 600;\n    margin-bottom: var(--standardPadding);\n  }\n`;\n\nexport const CloseButton: React.FC<{ onClick: any }> = (props) => {\n  return (\n    <div className={\"close-wrapper\"} onClick={props.onClick}>\n      <FontAwesomeIcon icon={faTimes} color={\"#000\"} size={\"2x\"} />\n    </div>\n  );\n};\n","import React from \"react\";\nimport { AppObject, Editor, ObjectTypes } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport styled from \"styled-components\";\nimport { CloseButton, PanelContentStyles } from \"./PanelContentStyles\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faHistory } from \"@fortawesome/free-solid-svg-icons\";\nimport dayjs from \"dayjs\";\nimport { jumpToIndexHistory } from \"../controllers/AppHistory\";\nimport { thumbnailsGenerator } from \"../threejs/thumbnailsGenerator\";\n\nexport const RightSidebar: React.FC<{}> = () => {\n  const rightSidebar = useSelector((state: Editor) => {\n    return state.ui.rightSidebar;\n  });\n\n  return (\n    <RightSidebarStyles>\n      <div className={\"right-sidebar-wrapper\"}>\n        {rightSidebar.isOpen === true ? (\n          <>\n            {rightSidebar.panel === \"history\" ? <HistoryPanel /> : null}\n\n            {rightSidebar.panel === \"objects\" ? <ObjectsPanel /> : null}\n          </>\n        ) : null}\n      </div>\n    </RightSidebarStyles>\n  );\n};\n\nexport const RightSidebarStyles = styled.div`\n  .right-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    right: calc(var(--leftSidebarWidth) * -1);\n    width: var(--leftSidebarWidth);\n    z-index: var(--zIndexRightSidebar);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n`;\n\nconst HistoryPanel: React.FC<{}> = () => {\n  const onClickCloseHistory = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: false,\n        panel: \"history\",\n      },\n    };\n    sendEvent(event);\n  };\n  const events = useSelector((state: Editor) => {\n    return state.history.events;\n  });\n  return (\n    <PanelContentStyles>\n      <div className={\"content-wrapper\"}>\n        <div className={\"title\"}>History events</div>\n        <CloseButton onClick={onClickCloseHistory} />\n        <HistoryPanelStyles>\n          <div className={\"events\"}>\n            {events.map((_, i, events) => {\n              const index = events.length - 1 - i;\n              const event = events[index];\n              if (!event) {\n                return <React.Fragment />;\n              }\n              const onClickHistoryItem = () => {\n                jumpToIndexHistory(index);\n              };\n              const fullCreatedAt = dayjs(event.createdAt).format();\n              return (\n                <div\n                  key={i}\n                  className={`event ${event.isActive ? \"active\" : \"inactive\"}`}\n                  onClick={onClickHistoryItem}\n                >\n                  <div className={\"icon\"}>\n                    <FontAwesomeIcon icon={faHistory} />\n                  </div>\n                  <div className={\"name\"}>{event.name}</div>\n                  <div\n                    className={\"time\"}\n                    // @TRANSLATION\n                    data-tip={fullCreatedAt}\n                    data-place={\"bottom\"}\n                    data-type={\"dark\"}\n                    data-effect={\"solid\"}\n                  >\n                    {dayjs(event.createdAt).format(\"HH:mm:ss\")}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </HistoryPanelStyles>\n      </div>\n    </PanelContentStyles>\n  );\n};\n\nconst HistoryPanelStyles = styled.div`\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .events {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow: scroll;\n  }\n  .event {\n    display: grid;\n    grid-template-columns: 45px 1fr 100px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    cursor: pointer;\n    &.active {\n      background: #fff;\n      .icon {\n        svg path {\n          fill: #000;\n        }\n      }\n      .name {\n        color: #000;\n      }\n    }\n    &.inactive {\n      .icon {\n        svg path {\n          fill: #e9e9e9;\n        }\n      }\n      .name {\n        color: #e9e9e9;\n      }\n    }\n    &:hover {\n      background: #ccc;\n    }\n\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .time {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      white-space: nowrap;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      color: #c9c9c9;\n    }\n  }\n`;\n\nconst ObjectsPanel: React.FC<{}> = () => {\n  const onClickCloseObjects = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: false,\n        panel: \"objects\",\n      },\n    };\n    sendEvent(event);\n  };\n\n  const objects = useSelector((state: Editor) => {\n    return state.objects;\n  });\n  type Filters = \"all\" | \"beads\" | \"groups\" | \"other\";\n  const [filterSelected, setFilterSelected] = React.useState<Filters>(\"all\");\n  const [selectedObjects, setSelectedObjects] = React.useState<AppObject[]>([]);\n  const onClickFilter = (filter: Filters) => {\n    setFilterSelected(filter);\n    if (filter === \"all\") {\n      setSelectedObjects(\n        Object.keys(objects).map((id) => {\n          return objects[id];\n        })\n      );\n    } else if (filter === \"beads\") {\n      setSelectedObjects(\n        Object.keys(objects)\n          .map((id) => {\n            return objects[id];\n          })\n          .filter((e) => e.objectType === ObjectTypes.Bead)\n      );\n    } else if (filter === \"groups\") {\n      setSelectedObjects(\n        Object.keys(objects)\n          .map((id) => {\n            return objects[id];\n          })\n          .filter((e) => e.objectType === ObjectTypes.Group)\n      );\n    } else if (filter === \"other\") {\n      setSelectedObjects(\n        Object.keys(objects)\n          .map((id) => {\n            return objects[id];\n          })\n          .filter(\n            (e) =>\n              !(\n                e.objectType === ObjectTypes.Bead ||\n                e.objectType === ObjectTypes.Group\n              )\n          )\n      );\n    }\n  };\n  const onClickFilterAll = () => {\n    onClickFilter(\"all\");\n  };\n  const onClickFilterBeads = () => {\n    onClickFilter(\"beads\");\n  };\n  const onClickFilterGroups = () => {\n    onClickFilter(\"groups\");\n  };\n  const onClickFilterOther = () => {\n    onClickFilter(\"other\");\n  };\n\n  React.useEffect(() => {\n    onClickFilter(filterSelected);\n  }, [objects]);\n  return (\n    <PanelContentStyles>\n      <div className={\"content-wrapper\"}>\n        <div className={\"title\"}>Objects</div>\n        <CloseButton onClick={onClickCloseObjects} />\n        <ObjectsPanelStyles>\n          <div className={\"filters\"}>\n            <div\n              className={`filter ${filterSelected === \"all\" ? \"active\" : \"\"}`}\n              onClick={onClickFilterAll}\n              // @TRANS\n            >\n              All\n            </div>\n            <div\n              className={`filter ${filterSelected === \"beads\" ? \"active\" : \"\"}`}\n              onClick={onClickFilterBeads}\n              // @TRANS\n            >\n              Beads\n            </div>\n            <div\n              className={`filter ${\n                filterSelected === \"groups\" ? \"active\" : \"\"\n              }`}\n              onClick={onClickFilterGroups}\n              // @TRANS\n            >\n              Groups\n            </div>\n            <div\n              className={`filter ${filterSelected === \"other\" ? \"active\" : \"\"}`}\n              onClick={onClickFilterOther}\n              // @TRANS\n            >\n              Others\n            </div>\n          </div>\n          <div className={\"objects\"}>\n            {selectedObjects.map((object, index) => {\n              if (!object) {\n                return <React.Fragment />;\n              }\n\n              const isBead = object.objectType === ObjectTypes.Bead;\n              const onClickObject = () => {\n                if (isBead) {\n                  thumbnailsGenerator.getObjectThumbnail(object, 500, 500);\n                }\n              };\n              return (\n                <div key={index} className={\"object\"} onClick={onClickObject}>\n                  <div className={\"icon\"}>\n                    {isBead ? (\n                      <img\n                        src={thumbnailsGenerator.getObjectThumbnail(\n                          object,\n                          30,\n                          30\n                        )}\n                      />\n                    ) : (\n                      <FontAwesomeIcon icon={faHistory} />\n                    )}\n                  </div>\n                  <div className={\"name\"}>{object.objectType}</div>\n                  <div className={\"id\"}>ID:{object.id}</div>\n                </div>\n              );\n            })}\n          </div>\n        </ObjectsPanelStyles>\n      </div>\n    </PanelContentStyles>\n  );\n};\n\nconst ObjectsPanelStyles = styled.div`\n  width: 100%;\n  height: calc(100vh - 50px);\n  overflow: scroll;\n\n  .filters {\n    background: #ebebef;\n    border-radius: 4px;\n    padding: 2px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    .filter {\n      border-radius: 4px;\n      padding: 10px 15px;\n    }\n    .filter.active {\n      background: #fff;\n    }\n  }\n\n  .objects {\n    width: 100%;\n    margin-bottom: 100px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n  }\n  .object {\n    display: grid;\n    grid-template-columns: 45px 1fr 200px;\n    column-gap: var(--standardPadding);\n    border-bottom: 1px solid #e9e9e9;\n    min-height: 40px;\n    transition: all 0.4s ease-in-out;\n    margin-bottom: var(--standardPadding);\n    width: 100%;\n    &:hover {\n      background: #e9e9e9;\n    }\n    .icon {\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .name {\n      width: 100%;\n      height: 100%;\n      font-size: 18px;\n      overflow: hidden;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n    }\n    .id {\n      font-size: 10px;\n      text-overflow: clip;\n      white-space: nowrap;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      width: 100%;\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { CloseButton, PanelContentStyles } from \"./PanelContentStyles\";\n\nexport const LeftSidebar: React.FC<{}> = () => {\n  const leftSidebar = useSelector((state: Editor) => {\n    return state.ui.leftSidebar;\n  });\n  return (\n    <LeftSidebarStyles>\n      <div className={\"left-sidebar-wrapper\"}>\n        {leftSidebar.isOpen === true ? (\n          <>{leftSidebar.panel === \"comments\" ? <CommentsPanel /> : null}</>\n        ) : null}\n      </div>\n    </LeftSidebarStyles>\n  );\n};\n\nexport const LeftSidebarStyles = styled.div`\n  .left-sidebar-wrapper {\n    position: absolute;\n    top: 0;\n    left: calc(var(--leftSidebarWidth) * -1);\n    z-index: var(--zIndexLeftSidebar);\n    width: var(--leftSidebarWidth);\n    display: flex;\n    transition: all 0.4s ease-in-out;\n    background: #fff;\n    height: 100%;\n    & > div {\n      width: 100%;\n      height: 100%;\n    }\n  }\n`;\n\nconst CommentsPanel: React.FC<{}> = () => {\n  const onClickCloseComments = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: false,\n        panel: \"comments\",\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <PanelContentStyles>\n      <div className={\"content-wrapper\"}>\n        <div className={\"title\"}>Comments</div>\n        <div>List is empty...</div>\n        <CloseButton onClick={onClickCloseComments} />\n      </div>\n    </PanelContentStyles>\n  );\n};\n","import React from \"react\";\nimport {\n  AppEventType,\n  ChangeUiSettingsSidebar,\n} from \"../controllers/AppEventType\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faAngleDoubleLeft,\n  faAngleDoubleRight,\n  faComment,\n  faHistory,\n  faListAlt,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport styled from \"styled-components\";\nimport { useSelector } from \"react-redux\";\nimport { Editor } from \"../editorObjects/Editor\";\n\nexport const BottomBar: React.FC<{}> = (props) => {\n  const [isOpen, setIsOpen] = React.useState(true);\n  const leftSidebar = useSelector((state: Editor) => {\n    return state.ui.leftSidebar;\n  });\n  const rightSidebar = useSelector((state: Editor) => {\n    return state.ui.rightSidebar;\n  });\n  const toggleBar = () => {\n    setIsOpen(!isOpen);\n  };\n  const onClickOpenComments = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: true,\n        panel: \"comments\",\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickOpenHistory = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: true,\n        panel: \"history\",\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  const onClickOpenObjects = () => {\n    const event: ChangeUiSettingsSidebar = {\n      name: AppEventType.ChangeUiSettingsSidebar,\n      payload: {\n        open: true,\n        panel: \"objects\",\n        toggle: true,\n      },\n    };\n    sendEvent(event);\n  };\n  return (\n    <BottomBarStyles>\n      <div className={`bottom-bar-wrapper ${isOpen ? \"open\" : \"closed\"}`}>\n        <div className={\"buttons\"}>\n          <div\n            className={`item ${\n              leftSidebar.panel === \"comments\" ? \"active\" : \"inactive\"\n            }`}\n            onClick={onClickOpenComments}\n            // @TRANSLATION\n            data-tip={`Comments`}\n            data-place={\"top\"}\n            data-type={\"dark\"}\n            data-effect={\"solid\"}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon icon={faComment} />\n            </div>\n          </div>\n          <div\n            className={`item ${\n              rightSidebar.panel === \"history\" ? \"active\" : \"inactive\"\n            }`}\n            onClick={onClickOpenHistory}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon\n                icon={faHistory}\n                // @TRANSLATION\n                data-tip={`History events`}\n                data-place={\"top\"}\n                data-type={\"dark\"}\n                data-effect={\"solid\"}\n              />\n            </div>\n          </div>\n          <div\n            className={`item ${\n              rightSidebar.panel === \"objects\" ? \"active\" : \"inactive\"\n            }`}\n            onClick={onClickOpenObjects}\n          >\n            <div className={\"value\"}>\n              <FontAwesomeIcon\n                icon={faListAlt}\n                // @TRANSLATION\n                data-tip={`Objects`}\n                data-place={\"top\"}\n                data-type={\"dark\"}\n                data-effect={\"solid\"}\n              />\n            </div>\n          </div>\n        </div>\n        <div className={\"toggle-item\"} onClick={toggleBar}>\n          <div className={\"value\"}>\n            <FontAwesomeIcon\n              icon={isOpen ? faAngleDoubleLeft : faAngleDoubleRight}\n            />\n          </div>\n        </div>\n      </div>\n    </BottomBarStyles>\n  );\n};\n\nexport const BottomBarStyles = styled.div`\n  .bottom-bar-wrapper {\n    position: absolute;\n    bottom: var(--standardPadding);\n    left: var(--standardPadding);\n    z-index: var(--zIndexBottomBar);\n    width: auto;\n    display: flex;\n    /* transition: all 0.4s ease-in-out; */\n    background: #fff;\n    height: 55px;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1),\n      left 0.4s ease-in-out;\n    &.open {\n    }\n    &.closed {\n      .buttons {\n        width: 0;\n      }\n    }\n  }\n  .buttons {\n    overflow: hidden;\n    transition: width 0.2s cubic-bezier(0.25, 0.1, 0.25, 0.1);\n    width: 100%;\n    white-space: nowrap;\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      transition: all 0.4s ease-in-out;\n      fill: var(--uiButton);\n    }\n    &.active,\n    &:hover {\n      color: var(--uiButtonActive);\n      svg path {\n        fill: var(--uiButtonActive);\n      }\n    }\n  }\n  .toggle-item {\n    width: 45px;\n    height: 55px;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    svg path {\n      fill: #e9e9e9;\n    }\n  }\n`;\n","import React from \"react\";\nimport { Bead, Editor, ObjectTypes } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faChevronCircleDown,\n  faChevronCircleUp,\n  faChevronDown,\n  faChevronUp,\n  faSearch,\n  faTimes,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { getStore, setStore, StoreUiSettings } from \"../controllers/store\";\nimport produce from \"immer\";\nimport { refreshReactState } from \"../controllers/refreshReactState\";\nimport styled from \"styled-components\";\nimport { BeadResponse, fetchBeadProducts } from \"../ApiService\";\nimport { debounce } from \"lodash\";\nimport { thumbnailsGenerator } from \"../threejs/thumbnailsGenerator\";\nimport { sendEvent } from \"../controllers/storeController\";\nimport { AppEventType } from \"../controllers/AppEventType\";\n\nexport const ModalSearchProducts: React.FC<{}> = () => {\n  const modalSearchProducts = useSelector((state: Editor) => {\n    return state.ui.modalSearchProducts;\n  });\n\n  if (!modalSearchProducts) {\n    return <React.Fragment />;\n  }\n  if (modalSearchProducts.isOpen === false) {\n    return <React.Fragment />;\n  }\n  return <Content modalSearchProducts={modalSearchProducts} />;\n};\n\nconst Content: React.FC<{\n  modalSearchProducts: StoreUiSettings[\"modalSearchProducts\"];\n}> = (props) => {\n  const productsRef = React.useRef<null | HTMLDivElement>(null);\n  const [q, setQ] = React.useState(props.modalSearchProducts?.q ?? \"\");\n  const [producer, setProducer] = React.useState(\n    props.modalSearchProducts?.producer ?? \"\"\n  );\n  const [color, setColor] = React.useState(\n    props.modalSearchProducts?.color ?? \"\"\n  );\n\n  type DataType = { bead: Bead; item: BeadResponse };\n  const [advBlockVisible, setAdvBlockVisible] = React.useState<boolean>(\n    props.modalSearchProducts?.advBlockVisible ?? false\n  );\n  const [loading, setLoading] = React.useState<undefined | boolean>(undefined);\n  const [error, setError] = React.useState<undefined | string>(undefined);\n  const [data, setData] = React.useState<undefined | DataType[]>(\n    props.modalSearchProducts.cachedResponse ?? []\n  );\n\n  const onClickCancel = () => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.ui.modalSearchProducts) {\n        draft.ui.modalSearchProducts.isOpen = false;\n        draft.ui.modalSearchProducts.q = q;\n        draft.ui.modalSearchProducts.producer = producer;\n        draft.ui.modalSearchProducts.color = color;\n        draft.ui.modalSearchProducts.advBlockVisible = advBlockVisible;\n      }\n      if (productsRef && productsRef.current) {\n        draft.ui.modalSearchProducts.scrollPosition =\n          productsRef.current.scrollTop;\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n  };\n  const onStartSearch = (_q?: string, _producer?: string, _color?: string) => {\n    if (loading === true) {\n      return;\n    }\n    setLoading(true);\n    fetchBeadProducts(_q ?? q, _producer ?? producer, _color ?? color)\n      .then(({ response }) => {\n        setData(response);\n        setLoading(undefined);\n        setError(undefined);\n      })\n      .catch((err) => {\n        setLoading(undefined);\n        setError(err);\n      });\n  };\n  const toggleAdvBlock = () => {\n    setAdvBlockVisible(!advBlockVisible);\n  };\n  const onSelectProduct = (item: DataType) => {\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      if (draft.ui.modalSearchProducts) {\n        draft.ui.modalSearchProducts.isOpen = false;\n        draft.ui.modalSearchProducts.q = q;\n        draft.ui.modalSearchProducts.producer = producer;\n        draft.ui.modalSearchProducts.color = color;\n        draft.ui.modalSearchProducts.advBlockVisible = advBlockVisible;\n        if (data) {\n          draft.ui.modalSearchProducts.cachedResponse = data;\n        }\n        if (productsRef && productsRef.current) {\n          draft.ui.modalSearchProducts.scrollPosition =\n            productsRef.current.scrollTop;\n        }\n      }\n    });\n    setStore(newStore);\n    refreshReactState(newStore);\n    sendEvent({\n      name: AppEventType.ChangeObjectsProperty,\n      payload: {\n        changes: newStore.selectedIds\n          .filter((id) => {\n            if (!newStore.objects[id]) {\n              return false;\n            }\n            if (newStore.objects[id].objectType !== ObjectTypes.Bead) {\n              return false;\n            }\n            return true;\n          })\n          .map((id) => {\n            const { height, width, depth, type, color, material } = item.bead;\n            return {\n              id,\n              properties: {\n                height,\n                width,\n                depth,\n                type,\n                color,\n                material,\n              },\n            };\n          }),\n      },\n    });\n  };\n  const onClickClearQ = () => {\n    setQ(\"\");\n    triggerSearch(\"\");\n  };\n\n  const onClickClearProducer = () => {\n    setProducer(\"\");\n    triggerSearch(undefined, \"\");\n  };\n\n  const onClickClearColor = () => {\n    setColor(\"\");\n    triggerSearch(undefined, undefined, \"\");\n  };\n\n  const onClickSearch = () => {\n    triggerSearch();\n  };\n\n  const triggerSearch = (_q?: string, _producer?: string, _color?: string) => {\n    onStartSearch(_q, _producer, _color);\n  };\n\n  //   React.useEffect(() => {\n  //     verify();\n  //   }, [q]);\n\n  //   const verify = React.useCallback(\n  //     debounce(() => {\n  //       onStartSearch();\n  //     }, 500),\n  //     []\n  //   );\n\n  const onClickBeadProducer = (search: string) => {\n    if (producer === search) {\n      setProducer(\"\");\n      triggerSearch(q, search, color);\n    } else {\n      setProducer(search);\n      triggerSearch(q, search, color);\n    }\n  };\n\n  const onClickBeadColorCategory = (search: string) => {\n    if (color === search) {\n      setColor(\"\");\n      triggerSearch(q, producer, search);\n    } else {\n      setColor(search);\n      triggerSearch(q, producer, search);\n    }\n  };\n\n  return (\n    <ModalSearchProductsStyles>\n      <div className={\"modal-search-products-popup\"}>\n        <div\n          className={\"modal-search-products-popup-overlay\"}\n          onClick={onClickCancel}\n        >\n          &nbsp;\n        </div>\n        <div className={\"modal-search-products-popup-content-wrapper\"}>\n          <div className={\"modal-search-products-popup-content\"}>\n            <div className={\"btn-cancel\"} onClick={onClickCancel}>\n              <FontAwesomeIcon icon={faTimes} color={\"#000\"} />\n            </div>\n\n            {/* <div className=\"modal-title\">Wyszukaj produkt</div> */}\n            <div className=\"inputs-wrapper\">\n              <div className=\"simple-inputs-wrapper\">\n                <div className={\"one-input-wrapper\"}>\n                  <input\n                    name={\"q\"}\n                    className={\"input\"}\n                    placeholder={\"Wyszukaj produkt\"}\n                    autoComplete={\"off\"}\n                    onKeyPress={(event: any) => {\n                      if (event.key === \"Enter\") {\n                        triggerSearch();\n                      }\n                    }}\n                    value={q}\n                    onChange={(event) => {\n                      setQ(event.target.value);\n                    }}\n                  />\n\n                  {q.length > 0 ? (\n                    <div className={\"clear-input\"} onClick={onClickClearQ}>\n                      <FontAwesomeIcon icon={faTimes} />\n                    </div>\n                  ) : null}\n                </div>\n                <button onClick={onClickSearch}>\n                  <FontAwesomeIcon icon={faSearch} />\n                </button>\n                <button onClick={toggleAdvBlock}>\n                  More{\" \"}\n                  <FontAwesomeIcon\n                    icon={\n                      advBlockVisible === true ? faChevronUp : faChevronDown\n                    }\n                  />\n                </button>\n              </div>\n\n              {advBlockVisible === true ? (\n                <div className=\"adv-wrapper\">\n                  <div>\n                    <div className={\"bead-colors-category-wrapper\"}>\n                      <BeadColorCategory\n                        search={\"czarny\"}\n                        hex={\"black\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"czarny\"}\n                      />\n                      <BeadColorCategory\n                        search={\"niebieski\"}\n                        hex={\"blue\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"niebieski\"}\n                      />\n                      <BeadColorCategory\n                        search={\"biay\"}\n                        hex={\"white\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"biay\"}\n                      />\n                      <BeadColorCategory\n                        search={\"zielony\"}\n                        hex={\"green\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"zielony\"}\n                      />\n                      <BeadColorCategory\n                        search={\"czerwony\"}\n                        hex={\"red\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"czerwony\"}\n                      />\n                      <BeadColorCategory\n                        search={\"pomaraczowy\"}\n                        hex={\"orange\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"pomaraczowy\"}\n                      />\n                      <BeadColorCategory\n                        search={\"szary\"}\n                        hex={\"gray\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"szary\"}\n                      />\n                      <BeadColorCategory\n                        search={\"brazowy\"}\n                        hex={\"brown\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"brazowy\"}\n                      />\n                      <BeadColorCategory\n                        search={\"fioletowy\"}\n                        hex={\"purple\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"fioletowy\"}\n                      />\n                      <BeadColorCategory\n                        search={\"zoty\"}\n                        hex={\"gold\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"zoty\"}\n                      />\n                      <BeadColorCategory\n                        search={\"rowy\"}\n                        hex={\"pink\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"rowy\"}\n                      />\n                      <BeadColorCategory\n                        search={\"ty\"}\n                        hex={\"yellow\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"ty\"}\n                      />\n                      <BeadColorCategory\n                        search={\"srebrny\"}\n                        hex={\"#eee\"}\n                        onClick={onClickBeadColorCategory}\n                        isSelected={color === \"srebrny\"}\n                      />\n\n                      {color.length > 0 ? (\n                        <div\n                          className={\"clear-input\"}\n                          onClick={onClickClearColor}\n                        >\n                          <FontAwesomeIcon icon={faTimes} />\n                        </div>\n                      ) : null}\n                    </div>\n                  </div>\n\n                  <div className={\"bead-producers-wrapper\"}>\n                    <ProducerItem\n                      label={\"TOHO\"}\n                      value={\"toho\"}\n                      isSelected={producer === \"toho\"}\n                      onClick={onClickBeadProducer}\n                    />\n                    <ProducerItem\n                      label={\"MIYUKI\"}\n                      value={\"miyuki\"}\n                      isSelected={producer === \"miyuki\"}\n                      onClick={onClickBeadProducer}\n                    />\n                    <ProducerItem\n                      label={\"FirePolish\"}\n                      value={\"firepolish\"}\n                      onClick={onClickBeadProducer}\n                      isSelected={producer === \"firepolish\"}\n                    />\n\n                    {producer.length > 0 ? (\n                      <div\n                        className={\"clear-input\"}\n                        onClick={onClickClearProducer}\n                      >\n                        <FontAwesomeIcon icon={faTimes} />\n                      </div>\n                    ) : null}\n                  </div>\n                </div>\n              ) : null}\n            </div>\n            <div className={\"content-wrapper\"}>\n              {loading ? <div>loading...</div> : null}\n              {error ? <div>error: {error}</div> : null}\n              {data ? (\n                <div className={\"products\"} ref={productsRef}>\n                  {data.map((item) => {\n                    const onClick = () => {\n                      onSelectProduct(item);\n                    };\n                    return (\n                      <div\n                        key={item.item.bead_product_uuid}\n                        className={\"item\"}\n                        onClick={onClick}\n                      >\n                        <div className={\"img\"}>\n                          <img\n                            src={thumbnailsGenerator.getObjectThumbnail(\n                              item.bead,\n                              100,\n                              100\n                            )}\n                          />\n                        </div>\n                        <h2>{item.item.display_name}</h2>\n                      </div>\n                    );\n                  })}\n                </div>\n              ) : null}\n            </div>\n          </div>\n        </div>\n      </div>\n    </ModalSearchProductsStyles>\n  );\n};\n\nconst ProducerItem: React.FC<{\n  value: string;\n  label: string;\n  onClick: any;\n  isSelected: boolean;\n}> = (props) => {\n  const onClick = () => {\n    props.onClick(props.value);\n  };\n  return (\n    <div\n      className={`bead-producer-item ${props.isSelected ? \"selected\" : \"\"}`}\n      onClick={onClick}\n    >\n      {props.label}\n    </div>\n  );\n};\n\nconst BeadColorCategory: React.FC<{\n  search: string;\n  hex: string;\n  onClick: any;\n  isSelected: boolean;\n}> = (props) => {\n  const onClick = () => {\n    props.onClick(props.search);\n  };\n  return (\n    <div\n      className={`bead-color-category-item ${\n        props.isSelected ? \"selected\" : \"\"\n      }`}\n      onClick={onClick}\n      style={{ backgroundColor: props.hex }}\n    >\n      &nbsp;\n    </div>\n  );\n};\n\nexport const ModalSearchProductsStyles = styled.div`\n  .modal-search-products-popup {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 9999;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    overflow-x: hidden;\n    overflow-y: auto;\n    max-height: 100vh;\n  }\n  .modal-search-products-popup-overlay {\n    background: rgba(0, 0, 0, 0.4);\n    transition: all 0.4s ease-in-out;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n  .modal-search-products-popup-content-wrapper {\n    position: absolute;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100%;\n  }\n  .modal-search-products-popup-content {\n    background: #fff;\n    padding: 32px;\n    width: 650px;\n    box-sizing: border-box;\n    transition: all 0.25s ease-out;\n    box-shadow: 0 8px 16px 0 rgb(0 0 0 / 12%);\n    border-radius: 4px;\n    transition: all 0.4s ease-in-out;\n    z-index: 2;\n    position: relative;\n  }\n  .bead-color-category-item {\n    width: 30px;\n    height: 30px;\n    border-radius: 30px;\n    display: flex;\n    border: 1px solid #dedede;\n    margin-right: var(--standardPadding);\n    margin-bottom: var(--standardPadding);\n    background: #eee;\n    cursor: pointer;\n    &.selected {\n      border: 2px solid #000;\n    }\n  }\n  .bead-colors-category-wrapper {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n    position: relative;\n\n    .clear-input {\n      position: relative;\n      top: -4px;\n      right: 0;\n      height: 30px;\n      width: 40px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n    }\n  }\n  .bead-producer-item {\n    font-size: 12px;\n    display: flex;\n    height: 35px;\n    border-radius: 8px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    border: 1px solid #dedede;\n    padding: var(--standardPadding);\n    margin-right: var(--standardPadding);\n    margin-bottom: var(--standardPadding);\n    background: #fff;\n    cursor: pointer;\n    &.selected {\n      background: #eee;\n    }\n  }\n  .bead-producers-wrapper {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n    position: relative;\n\n    .clear-input {\n      position: relative;\n      top: -5px;\n      right: 0;\n      height: 35px;\n      width: 40px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n    }\n  }\n  .actions {\n    display: flex;\n    justify-content: flex-end;\n  }\n  .modal-title {\n    font-size: 20px;\n    text-align: left;\n  }\n  .btn-cancel {\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 5;\n    width: 45px;\n    height: 45px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    /* border: 1px solid #eee; */\n    /* color: #000; */\n    /* padding: 10px 15px; */\n    /* border-radius: 4px; */\n    /* width: 90px; */\n    cursor: pointer;\n  }\n  .input {\n    border: none;\n    border-bottom: 1px solid rgba(5, 0, 56, 0.2);\n    padding: 8px 0 4px;\n    font-size: 24px;\n    transition: all 0.4s ease-in-out;\n    border-radius: 0;\n    box-shadow: none;\n    margin-bottom: 10px;\n\n    &:hover {\n      border-bottom-color: rgba(5, 0, 56, 0.4);\n    }\n    &:focus {\n      border-bottom-color: var(--uiButtonActive);\n    }\n  }\n  .inputs-wrapper {\n  }\n  .simple-inputs-wrapper {\n    display: flex;\n    column-gap: var(--standardPadding);\n    margin-bottom: var(--standardPadding);\n    width: 450px;\n\n    .one-input-wrapper {\n      position: relative;\n      input {\n        width: 100%;\n      }\n      .clear-input {\n        position: absolute;\n        top: 0;\n        right: 0;\n        height: calc(100% - 11px);\n        width: 50px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n      }\n    }\n    button {\n      background: none;\n      border: 1px solid #eee;\n      border-radius: var(--standardPadding);\n      padding: var(--standardPadding);\n      height: 42px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      column-gap: var(--standardPadding);\n    }\n  }\n  .content-wrapper {\n    .products {\n      display: grid;\n      column-gap: var(--standardPadding);\n      grid-template-columns: 1fr 1fr 1fr;\n      overflow-y: scroll;\n      max-height: 500px;\n      padding-right: var(--standardPadding);\n      &::-webkit-scrollbar-thumb {\n        background: var(--uiButtonActive);\n        border: 1px solid #cfcfcf;\n        border-radius: 60px;\n      }\n      &::-webkit-scrollbar-track {\n        background: #fff;\n        border: 1px solid #e4e4e4;\n      }\n      &::-webkit-scrollbar {\n        width: var(--standardPadding);\n      }\n    }\n    .item {\n      border: 1px solid #eee;\n      border-radius: 6px;\n      padding: var(--standardPadding);\n      margin-bottom: var(--standardPadding);\n      cursor: pointer;\n      transition: all 0.3s ease-in-out;\n      &:hover {\n        border: 1px solid var(--uiButtonActive);\n      }\n      .img {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n      h2 {\n        font-size: 12px;\n      }\n    }\n  }\n`;\n","import React from \"react\";\nimport { Editor } from \"../editorObjects/Editor\";\nimport { useSelector } from \"react-redux\";\nimport { SelectedObjectsTopBar } from \"./SelectedObjectsTopBar/SelectedObjectsTopBar\";\nimport ReactTooltip from \"react-tooltip\";\nimport { ModalEditProject } from \"./ModalEditProject\";\nimport { ProjectInfoWrapper } from \"./ProjectInfoWrapper\";\nimport { MinimapWrapper } from \"./MinimapWrapper\";\nimport { BeadsSummary } from \"./BeadsSummary\";\nimport { ActionsWrapper } from \"./ActionsWrapper\";\nimport { RightSidebar } from \"./RightSidebar\";\nimport { LeftSidebar } from \"./LeftSidebar\";\nimport { BottomBar } from \"./BottomBar\";\nimport styled from \"styled-components\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faSyncAlt } from \"@fortawesome/free-solid-svg-icons\";\nimport { ModalSearchProducts } from \"./ModalSearchProducts\";\n\nexport const EditorScene = () => {\n  const leftSidebarOpen = useSelector((state: Editor) => {\n    return state.ui.leftSidebar.isOpen;\n  });\n  const rightSidebarOpen = useSelector((state: Editor) => {\n    return state.ui.rightSidebar.isOpen;\n  });\n\n  return (\n    <div>\n      <ReactTooltip />\n      <ModalEditProject />\n      <ModalSearchProducts />\n      <EditorMainStyles>\n        <div\n          className={`scene \n          ${leftSidebarOpen ? \"left-sidebar-open\" : \"\"} \n          ${rightSidebarOpen ? \"right-sidebar-open\" : \"\"}`}\n        >\n          <LoadingInfo />\n          <ProjectInfoWrapper />\n          <MinimapWrapper />\n          <BeadsSummary />\n          <ActionsWrapper />\n          <BottomBar />\n          <LeftSidebar />\n          <RightSidebar />\n\n          <SelectedObjectsTopBar />\n        </div>\n      </EditorMainStyles>\n    </div>\n  );\n};\n\nconst EditorMainStyles = styled.div`\n  .scene {\n    border: 1px solid #e0e0e0;\n    position: relative;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: flex-start;\n    box-sizing: border-box;\n    height: 100vh;\n\n    .block-loading {\n      position: absolute;\n      top: 0;\n      left: 0;\n      background: rgba(255, 255, 255, 0.9);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      height: 100%;\n      z-index: var(--zIndexBlockLoading);\n      svg {\n        animation: rotating 2s linear infinite;\n      }\n    }\n\n    &.right-sidebar-open {\n      .right-sidebar-wrapper {\n        right: 0;\n      }\n\n      .minimap-wrapper {\n        right: calc(var(--standardPadding) + var(--leftSidebarWidth));\n      }\n      .beads-summary {\n        right: calc(\n          var(--standardPadding) + var(--leftSidebarWidth) +\n            var(--standardPadding) + var(--minimapWidth)\n        );\n      }\n    }\n\n    &.left-sidebar-open {\n      .left-sidebar-wrapper {\n        left: 0;\n      }\n      .project-info-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .actions-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n      .bottom-bar-wrapper {\n        left: calc(var(--standardPadding) + var(--rightSidebarWidth));\n      }\n    }\n  }\n\n  @keyframes rotating {\n    from {\n      -ms-transform: rotate(0deg);\n      -moz-transform: rotate(0deg);\n      -webkit-transform: rotate(0deg);\n      -o-transform: rotate(0deg);\n      transform: rotate(0deg);\n    }\n    to {\n      -ms-transform: rotate(360deg);\n      -moz-transform: rotate(360deg);\n      -webkit-transform: rotate(360deg);\n      -o-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n`;\n\nconst LoadingInfo: React.FC<{}> = () => {\n  const loading = useSelector((state: Editor) => {\n    return state.ui.blockThreejs.loading;\n  });\n\n  if (loading === false) {\n    return <div data-test={\"blockLoadingLoaded\"}></div>;\n  }\n\n  return (\n    <div className={\"block-loading\"} data-test={\"blockLoading\"}>\n      <FontAwesomeIcon icon={faSyncAlt} />\n    </div>\n  );\n};\n\n/* .scene-wrapper {\n    position: relative;\n    outline: none;\n    user-select: none;\n    width: calc(100% - 100px - 300px);\n    height: calc(100vh - 71px);\n    background: #e4e4e4;\n    box-sizing: border-box;\n    overflow: hidden;\n  } */\n// const ToolBarStyles = styled.div`\n//   .fieldset {\n//     padding-bottom: 5px;\n//     padding-top: 5px;\n//     display: flex;\n//     justify-content: flex-start;\n//     align-items: center;\n//   }\n\n//   .fieldset .label {\n//     font-family: \"Open Sans\", sans-serif;\n//     font-size: 16px;\n//     line-height: 30px;\n//     font-weight: 300;\n//     padding: 0;\n//     margin: 0;\n//     padding-left: 10px;\n//     padding-right: 10px;\n//     display: flex;\n//     flex-direction: row;\n//     flex-wrap: nowrap;\n//     align-items: center;\n//   }\n\n//   .fieldset .input {\n//     border: none;\n//     background: none;\n//     border-bottom: 1px solid #dfdfdf;\n//     color: #6e6e6e;\n//     font-size: 14px;\n//     line-height: 30px;\n//     font-family: \"Open Sans\", sans-serif;\n//     box-shadow: none;\n//     max-width: 200px;\n//     padding: 0;\n//     margin: 0;\n//   }\n\n//   .fieldset .input[type=\"number\"] {\n//     max-width: 50px;\n//   }\n// `;\n\n// class PanZoomWrapper extends React.Component<{ children, updatePosition }> {\n//   htmlDivInstance: HTMLDivElement | null = null;\n//   componentDidMount() {\n//     if (this.htmlDivInstance !== null) {\n//       const boundingClientRect = this.htmlDivInstance.getBoundingClientRect();\n//       this.props.updatePosition(boundingClientRect);\n//     }\n//   }\n//   render() {\n//     return (\n//       <div ref={refInstance => this.htmlDivInstance = refInstance}>\n//         {this.props.children}\n//       </div>\n//     )\n//   }\n// }\n\n// const Lights: React.FC<{}> = (props) => {\n//   const dispatch = useDispatch();\n//   const lights = useSelector((state: Editor) => {\n//     return state.ui.lights;\n//   });\n//   return (\n//     <LightsStyles>\n//       <div className={\"toolbar-lights\"}>\n//         {lights.map((l, index) => {\n//           const onChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n//             const newValue = Number(event.target.value) / 100;\n//             // console.log(\"co mam?\", newValue);\n//             // dispatch(\n//             //   Actions.Toolbar.action_updateLight(index, \"intensity\", newValue)\n//             // );\n//           };\n//           return (\n//             <div key={l.name} className={\"light\"}>\n//               <div className={\"info\"}>{JSON.stringify(l)}</div>\n//               <div className={\"fields\"}>\n//                 <fieldset>\n//                   <label>intensity: </label>\n//                   <input\n//                     type=\"range\"\n//                     name={`${l.name}_${l.intensity}`}\n//                     value={(l.intensity ?? 0) * 100}\n//                     onChange={onChange}\n//                     min=\"1\"\n//                     max=\"99\"\n//                     step=\"1\"\n//                   />\n//                 </fieldset>\n//               </div>\n//             </div>\n//           );\n//         })}\n//       </div>\n//     </LightsStyles>\n//   );\n// };\n// const LightsStyles = styled.div`\n//   .toolbar-lights {\n//     background: #ddd;\n//     width: 100%;\n//     border: none;\n//     box-sizing: border-box;\n//     position: absolute;\n//     bottom: 0;\n//     left: 0;\n//   }\n//   .light {\n//     border: 1px solid #000;\n//     border-radius: 3px;\n//     margin-bottom: 10px;\n//     padding: 10px;\n//   }\n//   .light .info {\n//     font-size: 11px;\n//     line-height: 13px;\n//     display: block;\n//     margin-bottom: 5px;\n//     width: 100%;\n//     overflow: hidden;\n//     word-break: break-all;\n//     white-space: pre-line;\n//   }\n//   .light .fields {\n//     display: flex;\n//     justify-content: center;\n//     align-items: center;\n//   }\n//   .light .fields fieldset {\n//     display: flex;\n//     justify-content: center;\n//     align-items: center;\n//     column-gap: 10px;\n//   }\n// `;\n\n// const state = useSelector((state: Editor) => {\n//   return state;\n// });\n// const store = useStore();\n// const state = store.getState();\n// console.log(\"EditorRerender: \", state);\n\n// @TODO: Dodac funkcje ktora zostaje uruchomiona po rozpoczeciu aplikajci\n// const dispatch = useDispatch();\n// const [firstPass, setFirstPass] = useState(false);\n// useEffect(() => {\n//   if (process.env.NODE_ENV && process.env.NODE_ENV === \"development\") {\n//     if (firstPass === false) {\n//       dispatch(Actions.Persist.action_readSavedCanvas());\n//       // dispatch(\n//       //   Actions.ChangeEditorMode.action_onChangeEditorMode(\n//       //     EditorMode.EditLines\n//       //   )\n//       // );\n//       // dispatch(Actions.Draggable.action_onClickLastestLine());\n//       setFirstPass(true);\n//     }\n//   }\n// });\n\n// const panZoomRef = useRef<any>(null);\n\n// if (!state) {\n//   return <div>Error in app</div>;\n// }\n\n// const preventPan = (event, x, y) => {\n//   console.log('??', event, x, y)\n//   return true;\n// }\n\n// const onStateChange = (event) => {\n//   if (panZoomRef && panZoomRef.current !== null) {\n//     const boundingClientRect = panZoomRef.current.getContainerBoundingRect();\n//     dispatch(\n//       Actions.Draggable.action_updateSceneZoom({\n//         ...event,\n//         top: boundingClientRect.top,\n//         left: boundingClientRect.left,\n//       })\n//     );\n//   } else {\n//     dispatch(\n//       Actions.Draggable.action_updateSceneZoom({\n//         ...event,\n//         top: 0,\n//         left: 0,\n//       })\n//     );\n//   }\n// };\n// const onResizeSceneWrapper = (width, height) => {\n//   dispatch(\n//     Actions.Draggable.action_updateSceneWrapperSize({\n//       width,\n//       height,\n//     })\n//   );\n// };\n\n// const updatePosition = (event) => {\n//   dispatch(Actions.Draggable.action_updatePanZoomWrapperRect(event));\n// }\n\n{\n  /* <div className={\"scene-wrapper\"}> */\n}\n\n{\n  /* <div className=\"topbar-wrapper\">\n          <TopbarMain />\n          <TopbarSecoundary />\n        </div> */\n}\n{\n  /* <ReactResizeDetector\n            handleWidth\n            handleHeight\n            skipOnMount={false}\n            onResize={onResizeSceneWrapper}\n          /> */\n}\n{\n  /* <PanZoom\n          style={{ width: \"100%\", height: \"100%\", position: \"absolute\" }}\n          disabled={editorMode !== EditorMode.Idle}\n          ref={panZoomRef}\n          onStateChange={onStateChange}\n          keyMapping={{\n            \"87\": { x: 0, y: -1, z: 0 },\n            \"83\": { x: 0, y: 1, z: 0 },\n            \"65\": { x: -1, y: 0, z: 0 },\n            \"68\": { x: 1, y: 0, z: 0 }\n          }}\n        >\n          <div>{`This content can be panned and zoomed.`}</div>\n          <BackgroundImage />\n\n          <AddBeadsMode isActive={editorMode === EditorMode.AddBeads} />\n\n          <MouseSelectionBeads\n            isVisible={editorMode === EditorMode.EditBeads}\n          />\n\n          <DisplayBeads mode={editorMode} />\n\n         \n\n          <DisplayGridLines isVisible={editorMode === EditorMode.EditLines} />\n\n          <GroupSelectionPlaceholder mode={editorMode} />\n\n          <Brush isVisible={editorMode === EditorMode.PaintBeads} />\n        </PanZoom> */\n}\n{\n  /* <DisplayLines mode={editorMode} /> */\n}\n{\n  /* <AddLineMode isActive={editorMode === EditorMode.AddLine} /> */\n}\n\n{\n  /* <MouseSelectionLines isVisible={editorMode === EditorMode.EditLines} /> */\n}\n{\n  /* </div> */\n}\n\n{\n  /* <div className={\"toolbar-wrapper\"}>\n            <div className={\"toolbar-content\"}> */\n}\n{\n  /* <ToolBarStyles> */\n}\n{\n  /* <ToolbarEditLines isVisible={editorMode === EditorMode.EditLines} /> */\n}\n{\n  /* <ToolbarEditBeads\n                isVisible={editorMode === EditorMode.SelectOrMove}\n              /> */\n}\n{\n  /* <ToolbarAddLine isVisible={editorMode === EditorMode.AddLine} /> */\n}\n{\n  /* <ToolbarIdle isVisible={editorMode === EditorMode.Idle} /> */\n}\n{\n  /* <ToolbarPaint isVisible={editorMode === EditorMode.PaintBeads} /> */\n}\n{\n  /* <ToolbarAddBeads isVisible={editorMode === EditorMode.AddBeads} /> */\n}\n\n{\n  /* <Lights /> */\n}\n{\n  /* <ChangeLinePosition mode={editorMode} />\n\n        <PickBeadType mode={editorMode} />\n        <ChangeBeadRotate mode={editorMode} />\n        <PickBeadColor mode={editorMode} />\n        <LineInspector mode={editorMode} />\n\n        <EditToolbar mode={editorMode} /> */\n}\n{\n  /* </ToolBarStyles> */\n}\n{\n  /* </div>\n          </div> */\n}\n","import { fetchBoard } from \"../ApiService\";\nimport { AppEvents } from \"../controllers/AppEventType\";\nimport { buildBead } from \"../editorObjects/Bead\";\nimport { AppObject, BeadTypes, RegionShape } from \"../editorObjects/Editor\";\nimport { buildGroup } from \"../editorObjects/Group\";\nimport { buildPoint } from \"../editorObjects/Point\";\nimport { buildPreviewProject3D } from \"../editorObjects/PreviewProject3D\";\nimport { buildRegion } from \"../editorObjects/Region\";\nimport { getModelBBoxFromBeadType } from \"./loadModels\";\n\nexport const getProjectData = (\n  id: string\n): Promise<{ board: { uuid: string; name: string }; objects: AppObject[] }> => {\n  if (id === \"\") {\n    return new Promise((resolve, reject) => {\n      resolve({\n        board: { name: \"---\", uuid: \"\" },\n        objects: [],\n      });\n    });\n  }\n  \n  if (id === \"demo\") {\n    return new Promise((resolve, reject) => {\n      getDemoProjectData().then((response) => {\n        resolve(response);\n      });\n    });\n  }\n\n  return new Promise((resolve, reject) => {\n    fetchBoard(id)\n      .then((response) => {\n        resolve(response);\n      })\n      .catch((err) => reject(err));\n  });\n};\n\nexport const getDemoProjectData = (): Promise<{\n  board: { uuid: string; name: string };\n  objects: AppObject[];\n}> => {\n  return new Promise((resolve, reject) => {\n    const objects = {};\n    const bbox = getModelBBoxFromBeadType(BeadTypes.TOHO_SPHERE);\n    let width = 1;\n    let height = 1;\n    let depth = 1;\n    if (bbox) {\n      width = Math.abs(bbox.max.x - bbox.min.x);\n      height = Math.abs(bbox.max.y - bbox.min.y);\n      depth = Math.abs(bbox.max.z - bbox.min.z);\n    }\n    // for (let i = 0; i < 10 * 10; i = i + 10) {\n    //   for (let j = 0; j < 10 * 50; j = j + 10) {\n    //     const b1 = buildBead({\n    //       width,\n    //       height,\n    //       depth,\n    //       type: BeadTypes.TOHO_SPHERE,\n    //       color: Math.random() > 0.5 ? \"red\" : \"blue\",\n    //       position: {\n    //         x: i,\n    //         y: j,\n    //       },\n    //     });\n    //     objects[b1.id] = b1;\n    //   }\n    // }\n\n    // const region = buildRegion({\n    //   height: 100,\n    //   width: 100,\n    //   shape: RegionShape.Rectangle,\n    //   settings: {\n    //     columns: 3,\n    //     rows: 3,\n    //   },\n    //   position: buildPoint(-100, -110),\n    // });\n\n    // objects[region.id] = region;\n\n    // const region2 = buildRegion({\n    //   height: 200,\n    //   width: 200,\n    //   shape: RegionShape.Triangle,\n    //   settings: {\n    //     columns: 4,\n    //     rows: 2,\n    //   },\n    //   position: buildPoint(-300, -10),\n    // });\n\n    // objects[region2.id] = region2;\n\n    // const group = buildGroup({\n    //   height: 250,\n    //   width: 250,\n    //   position: buildPoint(250, 250),\n    // });\n    // const subRegion = buildRegion({\n    //   height: 50,\n    //   width: 50,\n    //   position: buildPoint(200, 200),\n    //   groupId: group.id,\n    // });\n    // const subBead = buildBead({\n    //   width,\n    //   height,\n    //   depth,\n    //   type: BeadTypes.TOHO_SPHERE,\n    //   position: buildPoint(300, 300),\n    //   groupId: group.id,\n    // });\n    // group.childrenIds = [subBead.id, subRegion.id];\n    // objects[subBead.id] = subBead;\n    // objects[subRegion.id] = subRegion;\n    // objects[group.id] = group;\n\n    // const previewProject3D = buildPreviewProject3D({\n    //   height: 50,\n    //   width: 50,\n    //   position: buildPoint(500, 500),\n    //   color: \"red\",\n    // });\n    // objects[previewProject3D.id] = previewProject3D;\n\n    resolve({\n      board: {\n        uuid: \"123\",\n        name: \"Projekt testowy\",\n      },\n      objects: Object.keys(objects).map((id) => {\n        return objects[id];\n      }),\n    });\n  });\n};\n","import produce from \"immer\";\nimport { cloneDeep } from \"lodash\";\nimport { AppEventType } from \"./controllers/AppEventType\";\nimport { redoHistory, undoHistory } from \"./controllers/AppHistory\";\nimport { refreshReactState } from \"./controllers/refreshReactState\";\nimport {\n  emptyStore,\n  getStore,\n  setStore,\n  shouldRefreshReact,\n  shouldRefreshThree,\n} from \"./controllers/store\";\nimport { sendEvent } from \"./controllers/storeController\";\nimport { buildBead } from \"./editorObjects/Bead\";\nimport {\n  ObjectTypes,\n  RegionGridType,\n  RegionShape,\n} from \"./editorObjects/Editor\";\nimport { buildRegion } from \"./editorObjects/Region\";\nimport { logger } from \"./logger\";\nimport { getDemoProjectData, getProjectData } from \"./threejs/apiControler\";\nimport {\n  clearThreeScene,\n  addLightFromUI,\n  addGridFromUi,\n  addObjectByObjectType,\n} from \"./threejs/eventEmitterHandlers\";\nimport { appThree } from \"./threejs/renderThreejs\";\n\nexport const prepareBoard = (id: string) => {\n  return getProjectData(id).then((data) => {\n    return new Promise((resolve, reject) => {\n      const refreshThreejs = shouldRefreshThree();\n      const refreshReact = shouldRefreshReact();\n\n      if (refreshThreejs) {\n        clearThreeScene();\n      }\n\n      const store = getStore();\n\n      const newStore = produce(store, (draft) => {\n        draft.board = cloneDeep(emptyStore.board);\n        draft.history = cloneDeep(emptyStore.history);\n        draft.objects = cloneDeep(emptyStore.objects);\n        draft.selectedIds = cloneDeep(emptyStore.selectedIds);\n        draft.ui = cloneDeep(emptyStore.ui);\n\n        if (data.objects !== undefined && data.objects.length > 0) {\n          data.objects.forEach((object) => {\n            draft.objects[object.id] = object;\n          });\n        }\n\n        draft.board.name = data.board?.name ?? \"\";\n        draft.board.uuid = data.board?.uuid ?? \"\";\n        draft.board.canEdit = true;\n        draft.ui.blockThreejs.loading = false;\n      });\n\n      setStore(newStore);\n\n      if (refreshThreejs) {\n        store.ui.lights.forEach((light) => {\n          addLightFromUI(light, appThree.scene);\n        });\n      }\n\n      if (refreshThreejs) {\n        if (store.ui.grid) {\n          addGridFromUi(store.ui.grid);\n        }\n      }\n\n      if (refreshThreejs) {\n        Object.keys(newStore.objects).forEach((id) => {\n          addObjectByObjectType(newStore.objects[id]);\n        });\n      }\n\n      if (refreshReact) {\n        refreshReactState(newStore);\n      }\n\n      // testRegionsWithMoveAndNoSnap()\n      // testRegionsWithBricks();\n      testRegions();\n      resolve(undefined);\n    });\n  });\n};\n\nexport const clearBoard = (id: string) => {\n  return new Promise<void>((resolve) => {\n    clearThreeScene();\n    const store = getStore();\n    const newStore = produce(store, (draft) => {\n      draft = cloneDeep(emptyStore);\n    });\n\n    refreshReactState(newStore);\n    resolve();\n  });\n};\n\nconst testRegionsWithBricks = () => {\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [\n        {\n          id: \"regionA\",\n          objectType: ObjectTypes.Region,\n          width: 100,\n          height: 100,\n          position: {\n            x: 0,\n            y: 0,\n            z: 0,\n          },\n          columns: 7,\n          rows: 7,\n          gridType: RegionGridType.Bricks,\n          shape: RegionShape.Triangle,\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            autoFillBeads: true,\n            snapBeadsToCell: true,\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            position: {\n              x: -50,\n              y: 0,\n              z: 0,\n            },\n          },\n        },\n      ],\n    },\n  });\n};\n\nconst testRegionsWithMoveAndNoSnap = () => {\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [\n        {\n          id: \"regionA\",\n          objectType: ObjectTypes.Region,\n          width: 100,\n          height: 100,\n          position: {\n            x: 0,\n            y: 0,\n            z: 0,\n          },\n          columns: 5,\n          rows: 2,\n          shape: RegionShape.Triangle,\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            autoFillBeads: true,\n            snapBeadsToCell: true,\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            columns: 5,\n            rows: 2,\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            snapBeadsToCell: false,\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            position: {\n              x: -50,\n              y: 0,\n              z: 0,\n            },\n          },\n        },\n      ],\n    },\n  });\n  sendEvent({\n    name: AppEventType.ChangeObjectsProperty,\n    payload: {\n      changes: [\n        {\n          id: \"regionA\",\n          properties: {\n            position: {\n              x: -150,\n              y: 0,\n              z: 0,\n            },\n          },\n        },\n      ],\n    },\n  });\n\n  // undoHistory();\n  // undoHistory();\n  // undoHistory();\n  // redoHistory();\n  // redoHistory();\n  // redoHistory();\n  // testRegions();\n};\n\nexport const testRegions = () => {\n  const beadr = buildBead({\n    id: \"beadr\",\n    color: \"red\",\n    position: {\n      x: 0,\n      y: 0,\n    },\n\n    // width: 10,\n    // height: 10,\n    // depth: 10,\n  });\n  const beadg = buildBead({\n    id: \"beadg\",\n    color: \"green\",\n    position: {\n      x: 50,\n      y: 0,\n    },\n  });\n  const beadb = buildBead({\n    id: \"beadb\",\n    color: \"blue\",\n    position: {\n      x: 100,\n      y: 0,\n    },\n  });\n\n  const regionA = buildRegion({\n    id: \"regionA\",\n    position: {\n      x: 100,\n      y: 100,\n    },\n    width: 100,\n    height: 100,\n    columns: 6,\n    rows: 6,\n  });\n\n  const regionB = buildRegion({\n    id: \"regionB\",\n    position: {\n      x: 250,\n      y: 100,\n    },\n    width: 100,\n    height: 100,\n    columns: 6,\n    rows: 6,\n  });\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [beadr, beadg, beadb, regionA, regionB],\n    },\n  });\n  // sendEvent({\n  //   name: AppEventType.ChangeSelectObjects,\n  //   payload: {\n  //     change: [{ id: \"regionA\", isSelected: true }],\n  //   },\n  // });\n  // sendEvent({\n  //   name: AppEventType.ChangeUiSettingsZoom,\n  //   payload: {\n  //     zoomType: \"zoomInScreenCenter\",\n  //     useAnimation: false,\n  //   },\n  // });\n  // sendEvent({\n  //   name: AppEventType.ChangeUiSettingsZoom,\n  //   payload: {\n  //     zoomType: \"zoomOutScreenCenter\",\n  //     useAnimation: false,\n  //   },\n  // });\n};\n\nconst testGroup = () => {\n  const beadr = buildBead({\n    id: \"beadr\",\n    color: \"red\",\n    position: {\n      x: 0,\n      y: 0,\n    },\n  });\n  const beadg = buildBead({\n    id: \"beadg\",\n    color: \"green\",\n    position: {\n      x: 50,\n      y: 0,\n    },\n  });\n  const beadb = buildBead({\n    id: \"beadb\",\n    color: \"blue\",\n    position: {\n      x: 100,\n      y: 0,\n    },\n  });\n  sendEvent({\n    name: AppEventType.AddObjects,\n    payload: {\n      objects: [beadr, beadg, beadb],\n    },\n  });\n  const __s1 = getStore();\n  logger.log(\"__s1\", Object.keys(__s1.objects));\n  sendEvent({\n    name: AppEventType.GroupObjects,\n    payload: {\n      objects: [__s1.objects[\"beadr\"], __s1.objects[\"beadg\"]],\n    },\n  });\n  const __s2 = getStore();\n  logger.log(\"__s2\", Object.keys(__s2.objects));\n  sendEvent({\n    name: AppEventType.GroupObjects,\n    payload: {\n      objects: [\n        __s2.objects[\"beadr\"],\n        __s2.objects[\"beadg\"],\n        __s2.objects[\"beadb\"],\n      ],\n    },\n  });\n  const __s2a = getStore();\n  logger.log(\"__s2a\", Object.keys(__s2a.objects));\n  undoHistory();\n  const __s3 = getStore();\n  logger.log(\"__s3\", Object.keys(__s3.objects));\n  undoHistory();\n  const __s3a = getStore();\n  logger.log(\"__s3a\", Object.keys(__s3a.objects));\n  redoHistory();\n  const __s4 = getStore();\n  logger.log(\"__s4\", Object.keys(__s4.objects));\n  redoHistory();\n  const __s4a = getStore();\n  logger.log(\"__s4a\", Object.keys(__s4a.objects));\n};\n","import React from \"react\";\nimport { EditorScene } from \"./components/Editor\";\nimport { Provider } from \"react-redux\";\nimport { appStore } from \"./immerReducers/appStore\";\nimport { useParams } from \"react-router-dom\";\nimport { renderThreejs, unmountThreejs } from \"./threejs/renderThreejs\";\nimport { clearBoard, prepareBoard } from \"./prepareBoard\";\nimport { AppData } from \"./AppData\";\nimport { startBatchQueue, stopBatchQueue } from \"./ApiService\";\n\nexport const onStart = (\n  uuid: string,\n  data: AppData,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  renderThreejs(\n    canvas === undefined ? document.getElementById(\"threejs\") : (canvas as any),\n    canvas,\n    context\n  ).then(() => {\n    prepareBoard(uuid);\n\n    if (uuid !== \"demo\" && data.save_events === true) {\n      startBatchQueue(uuid);\n    }\n  });\n};\n\nexport const onEnd = (\n  uuid: string,\n  data: AppData,\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined,\n  context: WebGLRenderingContext | undefined\n) => {\n  stopBatchQueue(uuid);\n  clearBoard(uuid);\n  unmountThreejs(\n    canvas === undefined ? document.getElementById(\"threejs\") : (canvas as any)\n  );\n};\n\nexport const PageBoard: React.FC<{\n  data: AppData;\n  canvas: HTMLCanvasElement | OffscreenCanvas | undefined;\n  context: WebGLRenderingContext | undefined;\n}> = (props) => {\n  let { uuid } = useParams<{ uuid: string }>();\n\n  React.useEffect(() => {\n    onStart(uuid, props.data, props.canvas, props.context);\n    return () => {\n      onEnd(uuid, props.data, props.canvas, props.context);\n    };\n  }, []);\n\n  return (\n    <div className=\"App\">\n      <Provider store={appStore}>\n        <EditorScene />\n      </Provider>\n    </div>\n  );\n};\n","import { AppData } from \"./AppData\";\nimport React from \"react\";\nimport { createContext } from \"use-context-selector\";\n\nconst initialState: State = {\n  isAuthorized: false,\n  data: undefined,\n};\n\nexport const AuthContext = createContext<{ state: State; dispatch: Dispatch }>({\n  state: initialState,\n  dispatch: () => null,\n});\n\ntype State =\n  | {\n      isAuthorized: true;\n      data: AppData;\n    }\n  | {\n      isAuthorized: false;\n      data: undefined;\n    };\n\ntype Action = { type: \"logout\" };\ntype Dispatch = (action: Action) => void;\n\nconst reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"logout\":\n      return {\n        isAuthorized: false,\n        data: undefined,\n      };\n    default:\n      return state;\n  }\n};\n\nexport const useValue = (startState: State) => {\n  return React.useReducer(reducer, startState);\n};\n","import React from \"react\";\nimport { Link, useHistory, useLocation } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { useContextSelector, useContextUpdate } from \"use-context-selector\";\nimport { AppData } from \"./AppData\";\nimport { AuthContext } from \"./AuthContext\";\n\nexport const PageHome: React.FC<{\n  data: AppData;\n}> = () => {\n  const dispatch = useContextSelector(AuthContext, (ctx) => ctx.dispatch);\n  const history = useHistory();\n  const onClickLogout = () => {\n    window.localStorage.removeItem(\"coralinio_jwt\");\n    setTimeout(() => {\n      window.location.href = \"/\";\n      dispatch({\n        type: \"logout\",\n      });\n      // history.replace(\"/\");\n    }, 50);\n  };\n  const onClickBoards = () => {\n    history.push(\"/boards\");\n  };\n  return (\n    <PageStyles>\n      <div>\n        <h2>Welcome</h2>\n        <button\n          onClick={onClickBoards}\n          className={\"btn-light\"}\n          data-test={\"boards\"}\n        >\n          Boards\n        </button>\n        <button\n          onClick={onClickLogout}\n          className={\"btn-light\"}\n          data-test={\"logout\"}\n        >\n          Logout\n        </button>\n      </div>\n    </PageStyles>\n  );\n};\n\nconst PageStyles = styled.div`\n  padding: 1em;\n  .btn-light {\n    display: inline-block;\n    font-weight: 400;\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    border: 1px solid transparent;\n    padding: 0.375rem 0.75rem;\n    font-size: 1rem;\n    line-height: 1.5;\n    border-radius: 0.25rem;\n    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\n      border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n    color: #212529;\n    background-color: #f8f9fa;\n    border-color: #000;\n    margin-bottom: 10px;\n    margin-right: 10px;\n    cursor: pointer;\n  }\n  h2 {\n    margin-bottom: 0.5rem;\n    font-family: inherit;\n    font-weight: 500;\n    line-height: 1.2;\n    color: inherit;\n    font-size: 2rem;\n  }\n`;\n","import React from \"react\";\n\nexport const PageNoMatch: React.FC<{ data: any }> = (props) => {\n  return <div>page NO MATCH</div>;\n};\n","import React from \"react\";\nexport const PageNotAutorized: React.FC<{ data: any }> = (props) => {\n  return <div>Not autorized</div>;\n};\n","import React from \"react\";\nimport { createGlobalStyle, css } from \"styled-components\";\n\nconst BulmaReset = css`\n  /* Bulma Base */\n  /*! minireset.css v0.0.6 | MIT License | github.com/jgthms/minireset.css */\n  html,\n  body,\n  p,\n  ol,\n  ul,\n  li,\n  dl,\n  dt,\n  dd,\n  blockquote,\n  figure,\n  fieldset,\n  legend,\n  textarea,\n  pre,\n  iframe,\n  hr,\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    margin: 0;\n    padding: 0;\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    font-size: 100%;\n    font-weight: normal;\n  }\n\n  ul {\n    list-style: none;\n  }\n\n  button,\n  input,\n  select,\n  textarea {\n    margin: 0;\n  }\n\n  html {\n    box-sizing: border-box;\n  }\n\n  *,\n  *::before,\n  *::after {\n    box-sizing: inherit;\n  }\n\n  img,\n  video {\n    height: auto;\n    max-width: 100%;\n  }\n\n  iframe {\n    border: 0;\n  }\n\n  table {\n    border-collapse: collapse;\n    border-spacing: 0;\n  }\n\n  td,\n  th {\n    padding: 0;\n  }\n\n  td:not([align]),\n  th:not([align]) {\n    text-align: inherit;\n  }\n\n  html {\n    background-color: white;\n    font-size: 16px;\n    -moz-osx-font-smoothing: grayscale;\n    -webkit-font-smoothing: antialiased;\n    min-width: 300px;\n    overflow-x: hidden;\n    overflow-y: scroll;\n    text-rendering: optimizeLegibility;\n    -webkit-text-size-adjust: 100%;\n    -moz-text-size-adjust: 100%;\n    -ms-text-size-adjust: 100%;\n    text-size-adjust: 100%;\n  }\n\n  article,\n  aside,\n  figure,\n  footer,\n  header,\n  hgroup,\n  section {\n    display: block;\n  }\n\n  body,\n  button,\n  input,\n  optgroup,\n  select,\n  textarea {\n    font-family: BlinkMacSystemFont, -apple-system, \"Segoe UI\", \"Roboto\",\n      \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\",\n      \"Helvetica Neue\", \"Helvetica\", \"Arial\", sans-serif;\n  }\n\n  code,\n  pre {\n    -moz-osx-font-smoothing: auto;\n    -webkit-font-smoothing: auto;\n    font-family: monospace;\n  }\n\n  body {\n    color: #4a4a4a;\n    font-size: 1em;\n    font-weight: 400;\n    line-height: 1.5;\n  }\n\n  a {\n    color: #3273dc;\n    cursor: pointer;\n    text-decoration: none;\n  }\n\n  a strong {\n    color: currentColor;\n  }\n\n  a:hover {\n    color: #363636;\n  }\n\n  code {\n    background-color: whitesmoke;\n    color: #da1039;\n    font-size: 0.875em;\n    font-weight: normal;\n    padding: 0.25em 0.5em 0.25em;\n  }\n\n  hr {\n    background-color: whitesmoke;\n    border: none;\n    display: block;\n    height: 2px;\n    margin: 1.5rem 0;\n  }\n\n  img {\n    height: auto;\n    max-width: 100%;\n  }\n\n  input[type=\"checkbox\"],\n  input[type=\"radio\"] {\n    vertical-align: baseline;\n  }\n\n  small {\n    font-size: 0.875em;\n  }\n\n  span {\n    font-style: inherit;\n    font-weight: inherit;\n  }\n\n  strong {\n    color: #363636;\n    font-weight: 700;\n  }\n\n  fieldset {\n    border: none;\n  }\n\n  pre {\n    -webkit-overflow-scrolling: touch;\n    background-color: whitesmoke;\n    color: #4a4a4a;\n    font-size: 0.875em;\n    overflow-x: auto;\n    padding: 1.25rem 1.5rem;\n    white-space: pre;\n    word-wrap: normal;\n  }\n\n  pre code {\n    background-color: transparent;\n    color: currentColor;\n    font-size: 1em;\n    padding: 0;\n  }\n\n  table td,\n  table th {\n    vertical-align: top;\n  }\n\n  table td:not([align]),\n  table th:not([align]) {\n    text-align: inherit;\n  }\n\n  table th {\n    color: #363636;\n  }\n`;\n\nconst AppReactStyles = css`\n  body {\n    font-family: \"Open Sans\", sans-serif;\n  }\n\n  .App {\n    text-align: center;\n    background: #f6f6f6;\n  }\n\n  .topbar-wrapper {\n    height: 70px;\n    background: #f6f6f6;\n    padding-left: 0px;\n    padding-top: 0px;\n    width: 100%;\n    border-bottom: 2px solid #e0e0e0;\n    box-sizing: border-box;\n  }\n\n  #threejs {\n  }\n  #threejs.active {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    z-index: 2;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n\n  /*\n\n\n\n\n\n\n\n\n\n\n\n\n*/\n\n  .line {\n    position: absolute;\n    background: #5a5a5a;\n    width: 0;\n    height: 0;\n  }\n\n  .line-start {\n    position: absolute;\n    background: #5a5a5a;\n  }\n\n  .line-end {\n    position: absolute;\n    background: #5a5a5a;\n  }\n\n  .add-line-wrapper {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0);\n    z-index: 100;\n  }\n\n  .bead-item {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 5;\n    height: 20px;\n    width: 20px;\n    background: #bbb;\n  }\n\n  .button {\n    font-family: \"Open Sans\", sans-serif;\n    font-weight: 300;\n    font-size: 13px;\n    color: #000;\n  }\n\n  .mouse-selection {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0);\n    z-index: 9;\n  }\n\n  .toolbar-wrapper {\n    position: relative;\n    background: #f6f6f6;\n    width: 300px;\n    border-left: 2px solid #e0e0e0;\n    box-sizing: border-box;\n    right: -100px;\n  }\n\n  .topbar-wrapper .fieldset {\n    /* border-top: 1px solid #dfdfdf;\n  border-bottom: 1px solid #dfdfdf; */\n    padding-bottom: 5px;\n    padding-top: 5px;\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .topbar-wrapper .fieldset .label {\n    font-family: \"Open Sans\", sans-serif;\n    font-size: 13px;\n    line-height: 30px;\n    font-weight: 300;\n    padding: 0;\n    margin: 0;\n    padding-left: 10px;\n    padding-right: 10px;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    align-items: center;\n  }\n\n  .topbar-wrapper .fieldset .input {\n    border: none;\n    background: none;\n    border-bottom: 1px solid #dfdfdf;\n    color: #6e6e6e;\n    font-size: 14px;\n    line-height: 30px;\n    font-family: \"Open Sans\", sans-serif;\n    box-shadow: none;\n    max-width: 200px;\n    padding: 0;\n    margin: 0;\n  }\n`;\n\nconst AppVariables = css`\n  :root {\n    --text: #000;\n    --uiButton: rgba(5, 0, 56, 1);\n    --uiButtonActive: #c96ca3;\n    --uiButtonInActive: rgba(5, 0, 56, 0.2);\n    --bg: #f7dcec;\n    --btns_bg: #c96ca3;\n    --btns_text: #fff;\n    --title: #7c72a9;\n    --color_secoundary: #7c72a9;\n    --gray: rgba(0, 0, 0, 0.15);\n\n    --zIndexModal: 1000;\n    --zIndexMinimap: 500;\n    --zIndexProjectInfo: 500;\n    --zIndexBeadsSummary: 500;\n    --zIndexActions: 500;\n    --zIndexActions: 500;\n    --zIndexLeftSidebar: 510;\n    --zIndexRightSidebar: 510;\n    --zIndexBottomBar: 510;\n    --zIndexSelectedObjectsTopBar: 100;\n    --zIndexBlockLoading: 10;\n\n    --standardPadding: 8px;\n    --minimapWidth: 170px;\n    --leftSidebarWidth: 480px;\n    --rightSidebarWidth: 480px;\n  }\n`;\n\nexport const AppFonts = css`\n  @import url(\"https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i&display=swap\");\n  @import url(\"https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap\");\n`;\n\nexport const GlobalAppStyles = createGlobalStyle`\n    ${AppVariables}\n    ${BulmaReset}\n    ${AppReactStyles}\n`;\n","import React from \"react\";\n// import \"bulma/css/bulma.css\";\n// import \"./App.css\";\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\nimport { AppData } from \"./AppData\";\nimport { PageBoards } from \"./PageBoards\";\nimport { PageBoard } from \"./PageBoard\";\nimport { PageHome } from \"./PageHome\";\nimport { PageNoMatch } from \"./PageNoMatch\";\nimport { PageNotAutorized } from \"./PageNotAutorized\";\nimport { useContextSelector } from \"use-context-selector\";\nimport { AuthContext, useValue } from \"./AuthContext\";\nimport { logger } from \"./logger\";\nimport { AppFonts, GlobalAppStyles } from \"./GlobalAppStyles\";\n\nconst App: React.FC<{\n  data: AppData;\n}> = (props) => {\n  logger.log(\"render App.tsx\");\n  const isAuthorized = (props.data?.token ?? \"\").length > 0;\n  const [state, dispatch] = useValue(\n    isAuthorized === true\n      ? {\n          isAuthorized: true,\n          data: props.data,\n        }\n      : {\n          isAuthorized: false,\n          data: undefined,\n        }\n  );\n  return (\n    <AuthContext.Provider value={{ state, dispatch }}>\n      <GlobalAppStyles></GlobalAppStyles>\n      <style>{AppFonts}</style>\n      <Routes data={props.data} />\n    </AuthContext.Provider>\n  );\n};\n\nconst Routes: React.FC<{\n  data: AppData;\n}> = (props) => {\n  const isAuthorized = useContextSelector(\n    AuthContext,\n    (ctx) => ctx.state.isAuthorized\n  );\n  return (\n    <Router hashType={\"slash\"}>\n      {isAuthorized ? (\n        <Switch>\n          <Route exact path=\"/\">\n            <PageHome data={props.data} />\n          </Route>\n          <Route exact path=\"/boards\">\n            <PageBoards data={props.data} />\n          </Route>\n          <Route exact path=\"/board/:uuid\">\n            <PageBoard\n              data={props.data}\n              canvas={undefined}\n              context={undefined}\n            />\n          </Route>\n          <Route path=\"*\">\n            <PageNoMatch data={props.data} />\n          </Route>\n        </Switch>\n      ) : (\n        <Switch>\n          <Route exact path=\"/\">\n            <PageNotAutorized data={props.data} />\n          </Route>\n          <Route path=\"*\">\n            <PageNoMatch data={props.data} />\n          </Route>\n        </Switch>\n      )}\n    </Router>\n  );\n};\n\nexport default App;\n\n// \"homepage\": \"https://rpcal.github.io/coralinio-preview/build/\",\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport { AppData } from \"./AppData\";\nimport packageJson from \"./../package.json\";\nimport { setApiFromAppData } from \"./ApiService\";\nimport { merge } from \"lodash\";\n\nconst isDev = !process.env.NODE_ENV || process.env.NODE_ENV === \"development\";\nconsole.log(\"start app with version: \", packageJson.version, \"isDev\", isDev);\nconst root = document.getElementById(\"root\");\nif (root !== null) {\n  const threejs = document.createElement(\"div\");\n  threejs.setAttribute(\"id\", \"threejs\");\n  if (root.parentNode) {\n    root.parentNode.insertBefore(threejs, root.nextSibling);\n  }\n\n  try {\n    let data: AppData = isDev\n      ? {\n          apiHost: \"http://localhost:9000/\",\n          token:\n            \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1dWlkIjoiYzY2Nzg4Y2QtZjM2OS1mNWU5LWFmOTEtYjhlNWI3NmIyNDZhIiwidXNlcm5hbWUiOiJyb2JlZWUiLCJpYXQiOjE2MTcyNTc3NjJ9.LgUWUiFdkarrIfR5FORUI6cnEBHyPgCDmJJXAQlEuBQ\",\n          // token: \"\",\n          user: {\n            username: \"robeee\",\n            uuid: \"dc073641-01a4-107e-ae84-d3ec995bfc80\",\n          },\n          save_events: false,\n        }\n      : {\n          apiHost: \"\",\n          save_events: true,\n          token: \"\",\n          user: {\n            username: \"\",\n            uuid: \"\",\n          },\n        };\n    const hash = root.getAttribute(\"data-hash\");\n    if (hash) {\n      const hashData = JSON.parse(hash);\n      data = merge({}, data, hashData);\n    }\n    setApiFromAppData(data);\n    ReactDOM.render(<App data={data} />, root);\n  } catch (err) {}\n}\n"],"sourceRoot":""}